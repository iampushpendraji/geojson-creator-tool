(self.webpackChunkgeojson_creator_tool=self.webpackChunkgeojson_creator_tool||[]).push([[643],{6089:(Mt,Ye,ue)=>{"use strict";var ae=ue(9095),pe=ue(4703),b="value",c="\n  ",Z={};function ce(H){var q=Array.isArray(H);return function(ee){var ie=be(Z.plainArray,ee);if(ie)return ie;if(q&&ee.length!==H.length)return"an array with "+H.length+" items";for(var ne=0;ne<ee.length;ne++)if(ie=be(q?H[ne]:H,ee[ne]))return[ne].concat(ie)}}function be(H,q){if(null!=q||H.hasOwnProperty("__required")){var K=H(q);if(K)return Array.isArray(K)?K:[K]}}function ye(H,q){var K=H.length,X=H[K-1],ee=H.slice(0,K-1);return 0===ee.length&&(ee=[b]),q=pe(q,{path:ee}),"function"==typeof X?X(q):ge(q,function $e(H){return"must be "+function xe(H){return/^an? /.test(H)?H:/^[aeiou]/i.test(H)?"an "+H:/^[a-z]/i.test(H)?"a "+H:H}(H)+"."}(X))}function Te(H){return H.length<2?H[0]:2===H.length?H.join(" or "):H.slice(0,-1).join(", ")+", or "+H.slice(-1)}function ge(H,q){return(Oe(H.path)?"Item at position ":"")+H.path.join(".")+" "+q}function Oe(H){return"number"==typeof H[H.length-1]||"number"==typeof H[0]}Z.assert=function(H,q){return q=q||{},function(K){var X=be(H,K);if(X){var ee=ye(X,q);throw q.apiName&&(ee=q.apiName+": "+ee),new Error(ee)}}},Z.shape=function(q){var K=function We(H){return Object.keys(H||{}).map(function(q){return{key:q,value:H[q]}})}(q);return function(ee){var ie=be(Z.plainObject,ee);if(ie)return ie;for(var ne,he=[],re=0;re<K.length;re++)(ie=be(K[re].value,ee[ne=K[re].key]))&&he.push([ne].concat(ie));return he.length<2?he[0]:function(nt){he=he.map(function(Ee){return"- "+Ee[0]+": "+ye(Ee,nt).split("\n").join(c)});var ze=nt.path.join(".");return"The following properties"+(ze===b?"":" of "+ze)+" have invalid values:"+c+he.join(c)}}},Z.strictShape=function(q){var K=Z.shape(q);return function(ee){var ie=K(ee);if(ie)return ie;var ne=Object.keys(ee).reduce(function(se,he){return void 0===q[he]&&se.push(he),se},[]);return 0!==ne.length?function(){return"The following keys are invalid: "+ne.join(", ")}:void 0}},Z.arrayOf=function(q){return ce(q)},Z.tuple=function(){var q=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return ce(q)},Z.required=function(q){function K(X){return null==X?function(ee){return ge(ee,Oe(ee.path)?"cannot be undefined/null.":"is required.")}:q.apply(this,arguments)}return K.__required=!0,K},Z.oneOfType=function(){var q=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(X){var ee=q.map(function(ie){return be(ie,X)}).filter(Boolean);if(ee.length===q.length)return ee.every(function(ie){return 1===ie.length&&"string"==typeof ie[0]})?Te(ee.map(function(ie){return ie[0]})):ee.reduce(function(ie,ne){return ne.length>ie.length?ne:ie})}},Z.equal=function(q){return function(X){if(X!==q)return JSON.stringify(q)}},Z.oneOf=function(){var q=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),K=q.map(function(X){return Z.equal(X)});return Z.oneOfType.apply(this,K)},Z.range=function(q){var K=q[0],X=q[1];return function(ie){if(be(Z.number,ie)||ie<K||ie>X)return"number between "+K+" & "+X+" (inclusive)"}},Z.any=function(){},Z.boolean=function(q){if("boolean"!=typeof q)return"boolean"},Z.number=function(q){if("number"!=typeof q)return"number"},Z.plainArray=function(q){if(!Array.isArray(q))return"array"},Z.plainObject=function(q){if(!ae(q))return"object"},Z.string=function(q){if("string"!=typeof q)return"string"},Z.func=function(q){if("function"!=typeof q)return"function"},Z.validate=be,Z.processMessage=ye,Mt.exports=Z},9095:Mt=>{"use strict";var Ye=Object.prototype.toString;Mt.exports=function(ue){var ae;return"[object Object]"===Ye.call(ue)&&(null===(ae=Object.getPrototypeOf(ue))||ae===Object.getPrototypeOf({}))}},8527:function(Mt){Mt.exports=function(){"use strict";var Ye=function(R,W){var Ce={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},Et={on:function(et,Bt,br){if(void 0===Ce[et])throw new Error("Invalid event type: "+et);Ce[et].push({selector:Bt,fn:br})},render:function(et){W.store.featureChanged(et)}},Gt=function(et,Bt){for(var br=Ce[et],wr=br.length;wr--;){var Wr=br[wr];if(Wr.selector(Bt)){Wr.fn.call(Et,Bt)||W.store.render(),W.ui.updateMapClasses();break}}};return R.start.call(Et),{render:R.render,stop:function(){R.stop&&R.stop()},trash:function(){R.trash&&(R.trash(),W.store.render())},combineFeatures:function(){R.combineFeatures&&R.combineFeatures()},uncombineFeatures:function(){R.uncombineFeatures&&R.uncombineFeatures()},drag:function(et){Gt("drag",et)},click:function(et){Gt("click",et)},mousemove:function(et){Gt("mousemove",et)},mousedown:function(et){Gt("mousedown",et)},mouseup:function(et){Gt("mouseup",et)},mouseout:function(et){Gt("mouseout",et)},keydown:function(et){Gt("keydown",et)},keyup:function(et){Gt("keyup",et)},touchstart:function(et){Gt("touchstart",et)},touchmove:function(et){Gt("touchmove",et)},touchend:function(et){Gt("touchend",et)},tap:function(et){Gt("tap",et)}}};function ae(R){var W=0;if(R&&R.length>0){W+=Math.abs(pe(R[0]));for(var Ce=1;Ce<R.length;Ce++)W-=Math.abs(pe(R[Ce]))}return W}function pe(R){var W,Ce,Et,Gt,et,Bt,br=0,wr=R.length;if(wr>2){for(Bt=0;Bt<wr;Bt++)Bt===wr-2?(Et=wr-2,Gt=wr-1,et=0):Bt===wr-1?(Et=wr-1,Gt=0,et=1):(Et=Bt,Gt=Bt+1,et=Bt+2),W=R[Et],Ce=R[Gt],br+=(b(R[et][0])-b(W[0]))*Math.sin(b(Ce[1]));br=6378137*br*6378137/2}return br}function b(R){return R*Math.PI/180}var c_geometry=function R(W){var Ce,Et=0;switch(W.type){case"Polygon":return ae(W.coordinates);case"MultiPolygon":for(Ce=0;Ce<W.coordinates.length;Ce++)Et+=ae(W.coordinates[Ce]);return Et;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Ce=0;Ce<W.geometries.length;Ce++)Et+=R(W.geometries[Ce]);return Et}},q="mapbox-gl-draw-hot",K="mapbox-gl-draw-cold",X="add",ee="move",ne="pointer",se="none",he={POLYGON:"polygon",LINE:"line_string",POINT:"point"},re="Feature",nt="Polygon",ze="LineString",Ze="Point",Ee="FeatureCollection",Ae={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},pt="draw.create",Ue="draw.update",Ar="feature",xr="midpoint",cn="vertex",qn="true",yi="false",ft=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],lr={Point:0,LineString:1,Polygon:2};function st(R,W){var Ce=lr[R.geometry.type]-lr[W.geometry.type];return 0===Ce&&R.geometry.type===nt?R.area-W.area:Ce}function Se(R){if(this._items={},this._nums={},this._length=R?R.length:0,R)for(var W=0,Ce=R.length;W<Ce;W++)this.add(R[W]),void 0!==R[W]&&("string"==typeof R[W]?this._items[R[W]]=W:this._nums[R[W]]=W)}Se.prototype.add=function(R){return this.has(R)||(this._length++,"string"==typeof R?this._items[R]=this._length:this._nums[R]=this._length),this},Se.prototype.delete=function(R){return!1===this.has(R)||(this._length--,delete this._items[R],delete this._nums[R]),this},Se.prototype.has=function(R){return!("string"!=typeof R&&"number"!=typeof R||void 0===this._items[R]&&void 0===this._nums[R])},Se.prototype.values=function(){var R=this,W=[];return Object.keys(this._items).forEach(function(Ce){W.push({k:Ce,v:R._items[Ce]})}),Object.keys(this._nums).forEach(function(Ce){W.push({k:JSON.parse(Ce),v:R._nums[Ce]})}),W.sort(function(Ce,Et){return Ce.v-Et.v}).map(function(Ce){return Ce.k})},Se.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var _e=[Ar,xr,cn],ve={click:function(R,W,Ce){return Je(R,W,Ce,Ce.options.clickBuffer)},touch:function(R,W,Ce){return Je(R,W,Ce,Ce.options.touchBuffer)}};function Je(R,W,Ce,Et){if(null===Ce.map)return[];var Wr,kt,Gt=R?(void 0===(kt=Et)&&(kt=0),[[(Wr=R).point.x-kt,Wr.point.y-kt],[Wr.point.x+kt,Wr.point.y+kt]]):W,et={};Ce.options.styles&&(et.layers=Ce.options.styles.map(function(Wr){return Wr.id}));var Bt=Ce.map.queryRenderedFeatures(Gt,et).filter(function(Wr){return-1!==_e.indexOf(Wr.properties.meta)}),br=new Se,wr=[];return Bt.forEach(function(Wr){var kt=Wr.properties.id;br.has(kt)||(br.add(kt),wr.push(Wr))}),function(Wr){return Wr.map(function(kt){return kt.geometry.type===nt&&(kt.area=c_geometry({type:re,property:{},geometry:kt.geometry})),kt}).sort(st).map(function(kt){return delete kt.area,kt})}(wr)}function St(R,W){var Ce=ve.click(R,null,W),Et={mouse:se};return Ce[0]&&(Et.mouse=Ce[0].properties.active===qn?ee:ne,Et.feature=Ce[0].properties.meta),-1!==W.events.currentModeName().indexOf("draw")&&(Et.mouse=X),W.ui.queueMapClasses(Et),W.ui.updateMapClasses(),Ce[0]}function Xt(R,W){var Ce=R.x-W.x,Et=R.y-W.y;return Math.sqrt(Ce*Ce+Et*Et)}function gr(R,W,Ce){void 0===Ce&&(Ce={});var Et=null!=Ce.fineTolerance?Ce.fineTolerance:4,Gt=null!=Ce.grossTolerance?Ce.grossTolerance:12,et=null!=Ce.interval?Ce.interval:500;R.point=R.point||W.point,R.time=R.time||W.time;var Bt=Xt(R.point,W.point);return Bt<Et||Bt<Gt&&W.time-R.time<et}function _r(R,W,Ce){void 0===Ce&&(Ce={});var Et=null!=Ce.tolerance?Ce.tolerance:25,Gt=null!=Ce.interval?Ce.interval:250;return R.point=R.point||W.point,R.time=R.time||W.time,Xt(R.point,W.point)<Et&&W.time-R.time<Gt}function rr(R,W){return R(W={exports:{}},W.exports),W.exports}var En=rr(function(R){var W=R.exports=function(Ce,Et){if(Et||(Et=16),void 0===Ce&&(Ce=128),Ce<=0)return"0";for(var Gt=Math.log(Math.pow(2,Ce))/Math.log(Et),et=2;Gt===1/0;et*=2)Gt=Math.log(Math.pow(2,Ce/et))/Math.log(Et)*et;var Bt=Gt-Math.floor(Gt),br="";for(et=0;et<Math.floor(Gt);et++)br=Math.floor(Math.random()*Et).toString(Et)+br;if(Bt){var wr=Math.pow(Et,Bt);br=Math.floor(Math.random()*wr).toString(Et)+br}var Wr=parseInt(br,Et);return Wr!==1/0&&Wr>=Math.pow(2,Ce)?W(Ce,Et):br};W.rack=function(Ce,Et,Gt){var et=function(br){var wr=0;do{if(wr++>10){if(!Gt)throw new Error("too many ID collisions, use more bits");Ce+=Gt}var Wr=W(Ce,Et)}while(Object.hasOwnProperty.call(Bt,Wr));return Bt[Wr]=br,Wr},Bt=et.hats={};return et.get=function(br){return et.hats[br]},et.set=function(br,wr){return et.hats[br]=wr,et},et.bits=Ce||128,et.base=Et||16,et}}),un=function(R,W){this.ctx=R,this.properties=W.properties||{},this.coordinates=W.geometry.coordinates,this.id=W.id||En(),this.type=W.geometry.type};un.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},un.prototype.incomingCoords=function(R){this.setCoordinates(R)},un.prototype.setCoordinates=function(R){this.coordinates=R,this.changed()},un.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},un.prototype.setProperty=function(R,W){this.properties[R]=W},un.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:re,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},un.prototype.internal=function(R){var W={id:this.id,meta:Ar,"meta:type":this.type,active:yi,mode:R};if(this.ctx.options.userProperties)for(var Ce in this.properties)W["user_"+Ce]=this.properties[Ce];return{type:re,properties:W,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var Lr=function(R,W){un.call(this,R,W)};(Lr.prototype=Object.create(un.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},Lr.prototype.updateCoordinate=function(R,W,Ce){this.coordinates=3===arguments.length?[W,Ce]:[R,W],this.changed()},Lr.prototype.getCoordinate=function(){return this.getCoordinates()};var Cn=function(R,W){un.call(this,R,W)};(Cn.prototype=Object.create(un.prototype)).isValid=function(){return this.coordinates.length>1},Cn.prototype.addCoordinate=function(R,W,Ce){this.changed();var Et=parseInt(R,10);this.coordinates.splice(Et,0,[W,Ce])},Cn.prototype.getCoordinate=function(R){var W=parseInt(R,10);return JSON.parse(JSON.stringify(this.coordinates[W]))},Cn.prototype.removeCoordinate=function(R){this.changed(),this.coordinates.splice(parseInt(R,10),1)},Cn.prototype.updateCoordinate=function(R,W,Ce){var Et=parseInt(R,10);this.coordinates[Et]=[W,Ce],this.changed()};var ti=function(R,W){un.call(this,R,W),this.coordinates=this.coordinates.map(function(Ce){return Ce.slice(0,-1)})};(ti.prototype=Object.create(un.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(function(R){return R.length>2})},ti.prototype.incomingCoords=function(R){this.coordinates=R.map(function(W){return W.slice(0,-1)}),this.changed()},ti.prototype.setCoordinates=function(R){this.coordinates=R,this.changed()},ti.prototype.addCoordinate=function(R,W,Ce){this.changed();var Et=R.split(".").map(function(Gt){return parseInt(Gt,10)});this.coordinates[Et[0]].splice(Et[1],0,[W,Ce])},ti.prototype.removeCoordinate=function(R){this.changed();var W=R.split(".").map(function(Et){return parseInt(Et,10)}),Ce=this.coordinates[W[0]];Ce&&(Ce.splice(W[1],1),Ce.length<3&&this.coordinates.splice(W[0],1))},ti.prototype.getCoordinate=function(R){var W=R.split(".").map(function(Et){return parseInt(Et,10)});return JSON.parse(JSON.stringify(this.coordinates[W[0]][W[1]]))},ti.prototype.getCoordinates=function(){return this.coordinates.map(function(R){return R.concat([R[0]])})},ti.prototype.updateCoordinate=function(R,W,Ce){this.changed();var Et=R.split("."),Gt=parseInt(Et[0],10),et=parseInt(Et[1],10);void 0===this.coordinates[Gt]&&(this.coordinates[Gt]=[]),this.coordinates[Gt][et]=[W,Ce]};var Jn={MultiPoint:Lr,MultiLineString:Cn,MultiPolygon:ti},zn=function(R,W,Ce,Et,Gt){var et=Ce.split("."),Bt=parseInt(et[0],10),br=et[1]?et.slice(1).join("."):null;return R[Bt][W](br,Et,Gt)},di=function(R,W){if(un.call(this,R,W),delete this.coordinates,this.model=Jn[W.geometry.type],void 0===this.model)throw new TypeError(W.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(W.geometry.coordinates)};function Qr(R){this.map=R.map,this.drawConfig=JSON.parse(JSON.stringify(R.options||{})),this._ctx=R}(di.prototype=Object.create(un.prototype))._coordinatesToFeatures=function(R){var W=this,Ce=this.model.bind(this);return R.map(function(Et){return new Ce(W.ctx,{id:En(),type:re,properties:{},geometry:{coordinates:Et,type:W.type.replace("Multi","")}})})},di.prototype.isValid=function(){return this.features.every(function(R){return R.isValid()})},di.prototype.setCoordinates=function(R){this.features=this._coordinatesToFeatures(R),this.changed()},di.prototype.getCoordinate=function(R){return zn(this.features,"getCoordinate",R)},di.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(R){return R.type===nt?R.getCoordinates():R.coordinates})))},di.prototype.updateCoordinate=function(R,W,Ce){zn(this.features,"updateCoordinate",R,W,Ce),this.changed()},di.prototype.addCoordinate=function(R,W,Ce){zn(this.features,"addCoordinate",R,W,Ce),this.changed()},di.prototype.removeCoordinate=function(R){zn(this.features,"removeCoordinate",R),this.changed()},di.prototype.getFeatures=function(){return this.features},Qr.prototype.setSelected=function(R){return this._ctx.store.setSelected(R)},Qr.prototype.setSelectedCoordinates=function(R){var W=this;this._ctx.store.setSelectedCoordinates(R),R.reduce(function(Ce,Et){return void 0===Ce[Et.feature_id]&&(Ce[Et.feature_id]=!0,W._ctx.store.get(Et.feature_id).changed()),Ce},{})},Qr.prototype.getSelected=function(){return this._ctx.store.getSelected()},Qr.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Qr.prototype.isSelected=function(R){return this._ctx.store.isSelected(R)},Qr.prototype.getFeature=function(R){return this._ctx.store.get(R)},Qr.prototype.select=function(R){return this._ctx.store.select(R)},Qr.prototype.deselect=function(R){return this._ctx.store.deselect(R)},Qr.prototype.deleteFeature=function(R,W){return void 0===W&&(W={}),this._ctx.store.delete(R,W)},Qr.prototype.addFeature=function(R){return this._ctx.store.add(R)},Qr.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Qr.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Qr.prototype.setActionableState=function(R){return void 0===R&&(R={}),this._ctx.events.actionable({trash:R.trash||!1,combineFeatures:R.combineFeatures||!1,uncombineFeatures:R.uncombineFeatures||!1})},Qr.prototype.changeMode=function(R,W,Ce){return void 0===W&&(W={}),void 0===Ce&&(Ce={}),this._ctx.events.changeMode(R,W,Ce)},Qr.prototype.updateUIClasses=function(R){return this._ctx.ui.queueMapClasses(R)},Qr.prototype.activateUIButton=function(R){return this._ctx.ui.setActiveButton(R)},Qr.prototype.featuresAt=function(R,W,Ce){if(void 0===Ce&&(Ce="click"),"click"!==Ce&&"touch"!==Ce)throw new Error("invalid buffer type");return ve[Ce](R,W,this._ctx)},Qr.prototype.newFeature=function(R){var W=R.geometry.type;return W===Ze?new Lr(this._ctx,R):W===ze?new Cn(this._ctx,R):W===nt?new ti(this._ctx,R):new di(this._ctx,R)},Qr.prototype.isInstanceOf=function(R,W){if(R===Ze)return W instanceof Lr;if(R===ze)return W instanceof Cn;if(R===nt)return W instanceof ti;if("MultiFeature"===R)return W instanceof di;throw new Error("Unknown feature class: "+R)},Qr.prototype.doRender=function(R){return this._ctx.store.featureChanged(R)},Qr.prototype.onSetup=function(){},Qr.prototype.onDrag=function(){},Qr.prototype.onClick=function(){},Qr.prototype.onMouseMove=function(){},Qr.prototype.onMouseDown=function(){},Qr.prototype.onMouseUp=function(){},Qr.prototype.onMouseOut=function(){},Qr.prototype.onKeyUp=function(){},Qr.prototype.onKeyDown=function(){},Qr.prototype.onTouchStart=function(){},Qr.prototype.onTouchMove=function(){},Qr.prototype.onTouchEnd=function(){},Qr.prototype.onTap=function(){},Qr.prototype.onStop=function(){},Qr.prototype.onTrash=function(){},Qr.prototype.onCombineFeature=function(){},Qr.prototype.onUncombineFeature=function(){},Qr.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var wo={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Po=Object.keys(wo);function Xn(R){return[].concat(R).filter(function(W){return void 0!==W})}function Os(){var R=this;if(!R.ctx.map||void 0===R.ctx.map.getSource(q))return wr();var W=R.ctx.events.currentModeName();R.ctx.ui.queueMapClasses({mode:W});var Ce=[],Et=[];R.isDirty?Et=R.getAllIds():(Ce=R.getChangedIds().filter(function(Wr){return void 0!==R.get(Wr)}),Et=R.sources.hot.filter(function(Wr){return Wr.properties.id&&-1===Ce.indexOf(Wr.properties.id)&&void 0!==R.get(Wr.properties.id)}).map(function(Wr){return Wr.properties.id})),R.sources.hot=[];var Gt=R.sources.cold.length;R.sources.cold=R.isDirty?[]:R.sources.cold.filter(function(Wr){return-1===Ce.indexOf(Wr.properties.id||Wr.properties.parent)});var et=Gt!==R.sources.cold.length||Et.length>0;function Bt(Wr,kt){var hr=R.get(Wr).internal(W);R.ctx.events.currentModeRender(hr,function(Er){R.sources[kt].push(Er)})}if(Ce.forEach(function(Wr){return Bt(Wr,"hot")}),Et.forEach(function(Wr){return Bt(Wr,"cold")}),et&&R.ctx.map.getSource(K).setData({type:Ee,features:R.sources.cold}),R.ctx.map.getSource(q).setData({type:Ee,features:R.sources.hot}),R._emitSelectionChange&&(R.ctx.map.fire("draw.selectionchange",{features:R.getSelected().map(function(Wr){return Wr.toGeoJSON()}),points:R.getSelectedCoordinates().map(function(Wr){return{type:re,properties:{},geometry:{type:Ze,coordinates:Wr.coordinates}}})}),R._emitSelectionChange=!1),R._deletedFeaturesToEmit.length){var br=R._deletedFeaturesToEmit.map(function(Wr){return Wr.toGeoJSON()});R._deletedFeaturesToEmit=[],R.ctx.map.fire("draw.delete",{features:br})}function wr(){R.isDirty=!1,R.clearChangedIds()}wr(),R.ctx.map.fire("draw.render",{})}function Bn(R){var W,Ce=this;this._features={},this._featureIds=new Se,this._selectedFeatureIds=new Se,this._selectedCoordinates=[],this._changedFeatureIds=new Se,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=R,this.sources={hot:[],cold:[]},this.render=function(){W||(W=requestAnimationFrame(function(){W=null,Os.call(Ce)}))},this.isDirty=!1}function Mr(R,W){var Ce=R._selectedCoordinates.filter(function(Et){return R._selectedFeatureIds.has(Et.feature_id)});R._selectedCoordinates.length===Ce.length||W.silent||(R._emitSelectionChange=!0),R._selectedCoordinates=Ce}Bn.prototype.createRenderBatch=function(){var R=this,W=this.render,Ce=0;return this.render=function(){Ce++},function(){R.render=W,Ce>0&&R.render()}},Bn.prototype.setDirty=function(){return this.isDirty=!0,this},Bn.prototype.featureChanged=function(R){return this._changedFeatureIds.add(R),this},Bn.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},Bn.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},Bn.prototype.getAllIds=function(){return this._featureIds.values()},Bn.prototype.add=function(R){return this.featureChanged(R.id),this._features[R.id]=R,this._featureIds.add(R.id),this},Bn.prototype.delete=function(R,W){var Ce=this;return void 0===W&&(W={}),Xn(R).forEach(function(Et){Ce._featureIds.has(Et)&&(Ce._featureIds.delete(Et),Ce._selectedFeatureIds.delete(Et),W.silent||-1===Ce._deletedFeaturesToEmit.indexOf(Ce._features[Et])&&Ce._deletedFeaturesToEmit.push(Ce._features[Et]),delete Ce._features[Et],Ce.isDirty=!0)}),Mr(this,W),this},Bn.prototype.get=function(R){return this._features[R]},Bn.prototype.getAll=function(){var R=this;return Object.keys(this._features).map(function(W){return R._features[W]})},Bn.prototype.select=function(R,W){var Ce=this;return void 0===W&&(W={}),Xn(R).forEach(function(Et){Ce._selectedFeatureIds.has(Et)||(Ce._selectedFeatureIds.add(Et),Ce._changedFeatureIds.add(Et),W.silent||(Ce._emitSelectionChange=!0))}),this},Bn.prototype.deselect=function(R,W){var Ce=this;return void 0===W&&(W={}),Xn(R).forEach(function(Et){Ce._selectedFeatureIds.has(Et)&&(Ce._selectedFeatureIds.delete(Et),Ce._changedFeatureIds.add(Et),W.silent||(Ce._emitSelectionChange=!0))}),Mr(this,W),this},Bn.prototype.clearSelected=function(R){return void 0===R&&(R={}),this.deselect(this._selectedFeatureIds.values(),{silent:R.silent}),this},Bn.prototype.setSelected=function(R,W){var Ce=this;return void 0===W&&(W={}),R=Xn(R),this.deselect(this._selectedFeatureIds.values().filter(function(Et){return-1===R.indexOf(Et)}),{silent:W.silent}),this.select(R.filter(function(Et){return!Ce._selectedFeatureIds.has(Et)}),{silent:W.silent}),this},Bn.prototype.setSelectedCoordinates=function(R){return this._selectedCoordinates=R,this._emitSelectionChange=!0,this},Bn.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},Bn.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},Bn.prototype.getSelected=function(){var R=this;return this._selectedFeatureIds.values().map(function(W){return R.get(W)})},Bn.prototype.getSelectedCoordinates=function(){var R=this;return this._selectedCoordinates.map(function(W){return{coordinates:R.get(W.feature_id).getCoordinate(W.coord_path)}})},Bn.prototype.isSelected=function(R){return this._selectedFeatureIds.has(R)},Bn.prototype.setFeatureProperty=function(R,W,Ce){this.get(R).setProperty(W,Ce),this.featureChanged(R)},Bn.prototype.storeMapConfig=function(){var R=this;ft.forEach(function(W){R.ctx.map[W]&&(R._mapInitialConfig[W]=R.ctx.map[W].isEnabled())})},Bn.prototype.restoreMapConfig=function(){var R=this;Object.keys(this._mapInitialConfig).forEach(function(W){R._mapInitialConfig[W]?R.ctx.map[W].enable():R.ctx.map[W].disable()})},Bn.prototype.getInitialConfigValue=function(R){return void 0===this._mapInitialConfig[R]||this._mapInitialConfig[R]};var Wo=function(){for(var R=arguments,W={},Ce=0;Ce<arguments.length;Ce++){var Et=R[Ce];for(var Gt in Et)Ys.call(Et,Gt)&&(W[Gt]=Et[Gt])}return W},Ys=Object.prototype.hasOwnProperty,Sn=["mode","feature","mouse"];function aa(R){var W=null,Ce=null,Et={onRemove:function(){return R.map.off("load",Et.connect),clearInterval(Ce),Et.removeLayers(),R.store.restoreMapConfig(),R.ui.removeButtons(),R.events.removeEventListeners(),R.ui.clearMapClasses(),R.map=null,R.container=null,R.store=null,W&&W.parentNode&&W.parentNode.removeChild(W),W=null,this},connect:function(){R.map.off("load",Et.connect),clearInterval(Ce),Et.addLayers(),R.store.storeMapConfig(),R.events.addEventListeners()},onAdd:function(Gt){var et=Gt.fire;return Gt.fire=function(Bt,br){var wr=arguments;return 1===et.length&&1!==arguments.length&&(wr=[Wo({},{type:Bt},br)]),et.apply(Gt,wr)},R.map=Gt,R.events=function(Bt){var br=Object.keys(Bt.options.modes).reduce(function(fr,nn){return fr[nn]=function is(R){var W=Object.keys(R);return function(Ce,Et){void 0===Et&&(Et={});var Gt={},et=W.reduce(function(Bt,br){return Bt[br]=R[br],Bt},new Qr(Ce));return{start:function(){var Bt=this;Gt=et.onSetup(Et),Po.forEach(function(br){var wr,Wr=wo[br],kt=function(){return!1};R[Wr]&&(kt=function(){return!0}),Bt.on(br,kt,(wr=Wr,function(hr){return et[wr](Gt,hr)}))})},stop:function(){et.onStop(Gt)},trash:function(){et.onTrash(Gt)},combineFeatures:function(){et.onCombineFeatures(Gt)},uncombineFeatures:function(){et.onUncombineFeatures(Gt)},render:function(Bt,br){et.toDisplayFeatures(Gt,Bt,br)}}}}(Bt.options.modes[nn]),fr},{}),wr={},Wr={},kt={},hr=null,Er=null;kt.drag=function(fr,nn){nn({point:fr.point,time:(new Date).getTime()})?(Bt.ui.queueMapClasses({mouse:"drag"}),Er.drag(fr)):fr.originalEvent.stopPropagation()},kt.mousedrag=function(fr){kt.drag(fr,function(nn){return!gr(wr,nn)})},kt.touchdrag=function(fr){kt.drag(fr,function(nn){return!_r(Wr,nn)})},kt.mousemove=function(fr){if(1===(void 0!==fr.originalEvent.buttons?fr.originalEvent.buttons:fr.originalEvent.which))return kt.mousedrag(fr);var nn=St(fr,Bt);fr.featureTarget=nn,Er.mousemove(fr)},kt.mousedown=function(fr){wr={time:(new Date).getTime(),point:fr.point};var nn=St(fr,Bt);fr.featureTarget=nn,Er.mousedown(fr)},kt.mouseup=function(fr){var nn=St(fr,Bt);fr.featureTarget=nn,gr(wr,{point:fr.point,time:(new Date).getTime()})?Er.click(fr):Er.mouseup(fr)},kt.mouseout=function(fr){Er.mouseout(fr)},kt.touchstart=function(fr){if(fr.originalEvent.preventDefault(),Bt.options.touchEnabled){Wr={time:(new Date).getTime(),point:fr.point};var nn=ve.touch(fr,null,Bt)[0];fr.featureTarget=nn,Er.touchstart(fr)}},kt.touchmove=function(fr){if(fr.originalEvent.preventDefault(),Bt.options.touchEnabled)return Er.touchmove(fr),kt.touchdrag(fr)},kt.touchend=function(fr){if(fr.originalEvent.preventDefault(),Bt.options.touchEnabled){var nn=ve.touch(fr,null,Bt)[0];fr.featureTarget=nn,_r(Wr,{time:(new Date).getTime(),point:fr.point})?Er.tap(fr):Er.touchend(fr)}};var Jr=function(fr){return!(8===fr||46===fr||fr>=48&&fr<=57)};function yn(fr,nn,In){void 0===In&&(In={}),Er.stop();var xn=br[fr];if(void 0===xn)throw new Error(fr+" is not valid");hr=fr;var _o=xn(Bt,nn);Er=Ye(_o,Bt),In.silent||Bt.map.fire("draw.modechange",{mode:fr}),Bt.store.setDirty(),Bt.store.render()}kt.keydown=function(fr){"mapboxgl-canvas"===(fr.srcElement||fr.target).classList[0]&&(8!==fr.keyCode&&46!==fr.keyCode||!Bt.options.controls.trash?Jr(fr.keyCode)?Er.keydown(fr):49===fr.keyCode&&Bt.options.controls.point?yn(Ae.DRAW_POINT):50===fr.keyCode&&Bt.options.controls.line_string?yn(Ae.DRAW_LINE_STRING):51===fr.keyCode&&Bt.options.controls.polygon&&yn(Ae.DRAW_POLYGON):(fr.preventDefault(),Er.trash()))},kt.keyup=function(fr){Jr(fr.keyCode)&&Er.keyup(fr)},kt.zoomend=function(){Bt.store.changeZoom()},kt.data=function(fr){if("style"===fr.dataType){var nn=Bt.setup,In=Bt.map,_o=Bt.store;Bt.options.styles.some(function(Zr){return In.getLayer(Zr.id)})||(nn.addLayers(),_o.setDirty(),_o.render())}};var ao={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Er=Ye(br[hr=Bt.options.defaultMode](Bt),Bt)},changeMode:yn,actionable:function(fr){var nn=!1;Object.keys(fr).forEach(function(In){if(void 0===ao[In])throw new Error("Invalid action type");ao[In]!==fr[In]&&(nn=!0),ao[In]=fr[In]}),nn&&Bt.map.fire("draw.actionable",{actions:ao})},currentModeName:function(){return hr},currentModeRender:function(fr,nn){return Er.render(fr,nn)},fire:function(fr,nn){kt[fr]&&kt[fr](nn)},addEventListeners:function(){Bt.map.on("mousemove",kt.mousemove),Bt.map.on("mousedown",kt.mousedown),Bt.map.on("mouseup",kt.mouseup),Bt.map.on("data",kt.data),Bt.map.on("touchmove",kt.touchmove),Bt.map.on("touchstart",kt.touchstart),Bt.map.on("touchend",kt.touchend),Bt.container.addEventListener("mouseout",kt.mouseout),Bt.options.keybindings&&(Bt.container.addEventListener("keydown",kt.keydown),Bt.container.addEventListener("keyup",kt.keyup))},removeEventListeners:function(){Bt.map.off("mousemove",kt.mousemove),Bt.map.off("mousedown",kt.mousedown),Bt.map.off("mouseup",kt.mouseup),Bt.map.off("data",kt.data),Bt.map.off("touchmove",kt.touchmove),Bt.map.off("touchstart",kt.touchstart),Bt.map.off("touchend",kt.touchend),Bt.container.removeEventListener("mouseout",kt.mouseout),Bt.options.keybindings&&(Bt.container.removeEventListener("keydown",kt.keydown),Bt.container.removeEventListener("keyup",kt.keyup))},trash:function(fr){Er.trash(fr)},combineFeatures:function(){Er.combineFeatures()},uncombineFeatures:function(){Er.uncombineFeatures()},getMode:function(){return hr}}}(R),R.ui=function(Bt){var br={},wr=null,Wr={mode:null,feature:null,mouse:null},kt={mode:null,feature:null,mouse:null};function hr(fr){kt=Wo(kt,fr)}function Er(){var fr,nn;if(Bt.container){var In=[],xn=[];Sn.forEach(function(_o){kt[_o]!==Wr[_o]&&(In.push(_o+"-"+Wr[_o]),null!==kt[_o]&&xn.push(_o+"-"+kt[_o]))}),In.length>0&&(fr=Bt.container.classList).remove.apply(fr,In),xn.length>0&&(nn=Bt.container.classList).add.apply(nn,xn),Wr=Wo(Wr,kt)}}function Jr(fr,nn){void 0===nn&&(nn={});var In=document.createElement("button");return In.className="mapbox-gl-draw_ctrl-draw-btn "+nn.className,In.setAttribute("title",nn.title),nn.container.appendChild(In),In.addEventListener("click",function(xn){if(xn.preventDefault(),xn.stopPropagation(),xn.target===wr)return yn(),void nn.onDeactivate();ao(fr),nn.onActivate()},!0),In}function yn(){wr&&(wr.classList.remove("active"),wr=null)}function ao(fr){yn();var nn=br[fr];nn&&nn&&"trash"!==fr&&(nn.classList.add("active"),wr=nn)}return{setActiveButton:ao,queueMapClasses:hr,updateMapClasses:Er,clearMapClasses:function(){hr({mode:null,feature:null,mouse:null}),Er()},addButtons:function(){var fr=Bt.options.controls,nn=document.createElement("div");return nn.className="mapboxgl-ctrl-group mapboxgl-ctrl",fr&&(fr[he.LINE]&&(br[he.LINE]=Jr(he.LINE,{container:nn,className:"mapbox-gl-draw_line",title:"LineString tool "+(Bt.options.keybindings?"(l)":""),onActivate:function(){return Bt.events.changeMode(Ae.DRAW_LINE_STRING)},onDeactivate:function(){return Bt.events.trash()}})),fr[he.POLYGON]&&(br[he.POLYGON]=Jr(he.POLYGON,{container:nn,className:"mapbox-gl-draw_polygon",title:"Polygon tool "+(Bt.options.keybindings?"(p)":""),onActivate:function(){return Bt.events.changeMode(Ae.DRAW_POLYGON)},onDeactivate:function(){return Bt.events.trash()}})),fr[he.POINT]&&(br[he.POINT]=Jr(he.POINT,{container:nn,className:"mapbox-gl-draw_point",title:"Marker tool "+(Bt.options.keybindings?"(m)":""),onActivate:function(){return Bt.events.changeMode(Ae.DRAW_POINT)},onDeactivate:function(){return Bt.events.trash()}})),fr.trash&&(br.trash=Jr("trash",{container:nn,className:"mapbox-gl-draw_trash",title:"Delete",onActivate:function(){Bt.events.trash()}})),fr.combine_features&&(br.combine_features=Jr("combineFeatures",{container:nn,className:"mapbox-gl-draw_combine",title:"Combine",onActivate:function(){Bt.events.combineFeatures()}})),fr.uncombine_features&&(br.uncombine_features=Jr("uncombineFeatures",{container:nn,className:"mapbox-gl-draw_uncombine",title:"Uncombine",onActivate:function(){Bt.events.uncombineFeatures()}}))),nn},removeButtons:function(){Object.keys(br).forEach(function(fr){var nn=br[fr];nn.parentNode&&nn.parentNode.removeChild(nn),delete br[fr]})}}}(R),R.container=Gt.getContainer(),R.store=new Bn(R),W=R.ui.addButtons(),R.options.boxSelect&&(Gt.boxZoom.disable(),Gt.dragPan.disable(),Gt.dragPan.enable()),Gt.loaded()?Et.connect():(Gt.on("load",Et.connect),Ce=setInterval(function(){Gt.loaded()&&Et.connect()},16)),R.events.start(),W},addLayers:function(){R.map.addSource(K,{data:{type:Ee,features:[]},type:"geojson"}),R.map.addSource(q,{data:{type:Ee,features:[]},type:"geojson"}),R.options.styles.forEach(function(Gt){R.map.addLayer(Gt)}),R.store.setDirty(!0),R.store.render()},removeLayers:function(){R.options.styles.forEach(function(Gt){R.map.getLayer(Gt.id)&&R.map.removeLayer(Gt.id)}),R.map.getSource(K)&&R.map.removeSource(K),R.map.getSource(q)&&R.map.removeSource(q)}};return R.setup=Et,Et}function Cs(R){return function(W){var Ce=W.featureTarget;return!!Ce&&!!Ce.properties&&Ce.properties.meta===R}}function Ge(R){return!!R.featureTarget&&!!R.featureTarget.properties&&R.featureTarget.properties.active===qn&&R.featureTarget.properties.meta===Ar}function le(R){return!!R.featureTarget&&!!R.featureTarget.properties&&R.featureTarget.properties.active===yi&&R.featureTarget.properties.meta===Ar}function we(R){return void 0===R.featureTarget}function qe(R){var W=R.featureTarget;return!!W&&!!W.properties&&W.properties.meta===cn}function ot(R){return!!R.originalEvent&&!0===R.originalEvent.shiftKey}function dt(R){return 27===R.keyCode}function Dt(R){return 13===R.keyCode}var Ot=wt;function wt(R,W){this.x=R,this.y=W}function Ct(R,W){var Ce=W.getBoundingClientRect();return new Ot(R.clientX-Ce.left-(W.clientLeft||0),R.clientY-Ce.top-(W.clientTop||0))}function sr(R,W,Ce,Et){return{type:re,properties:{meta:cn,parent:R,coord_path:Ce,active:Et?qn:yi},geometry:{type:Ze,coordinates:W}}}function Rr(R,W,Ce){void 0===W&&(W={}),void 0===Ce&&(Ce=null);var Et,Gt=R.geometry,et=Gt.type,Bt=Gt.coordinates,br=R.properties&&R.properties.id,wr=[];function Wr(hr,Er){var Jr="",yn=null;hr.forEach(function(ao,fr){var nn=null!=Er?Er+"."+fr:String(fr),In=sr(br,ao,nn,kt(nn));if(W.midpoints&&yn){var xn=function(Zr,zo,Rs){var pn=zo.geometry.coordinates,ji=Rs.geometry.coordinates;if(pn[1]>85||pn[1]<-85||ji[1]>85||ji[1]<-85)return null;var Xo={lng:(pn[0]+ji[0])/2,lat:(pn[1]+ji[1])/2};return{type:re,properties:{meta:xr,parent:Zr,lng:Xo.lng,lat:Xo.lat,coord_path:Rs.properties.coord_path},geometry:{type:Ze,coordinates:[Xo.lng,Xo.lat]}}}(br,yn,In);xn&&wr.push(xn)}yn=In;var _o=JSON.stringify(ao);Jr!==_o&&wr.push(In),0===fr&&(Jr=_o)})}function kt(hr){return!!W.selectedPaths&&-1!==W.selectedPaths.indexOf(hr)}return et===Ze?wr.push(sr(br,Bt,Ce,kt(Ce))):et===nt?Bt.forEach(function(hr,Er){Wr(hr,null!==Ce?Ce+"."+Er:String(Er))}):et===ze?Wr(Bt,Ce):0===et.indexOf("Multi")&&(Et=et.replace("Multi",""),Bt.forEach(function(hr,Er){wr=wr.concat(Rr({type:re,properties:R.properties,geometry:{type:Et,coordinates:hr}},W,Er))})),wr}wt.prototype={clone:function(){return new wt(this.x,this.y)},add:function(R){return this.clone()._add(R)},sub:function(R){return this.clone()._sub(R)},multByPoint:function(R){return this.clone()._multByPoint(R)},divByPoint:function(R){return this.clone()._divByPoint(R)},mult:function(R){return this.clone()._mult(R)},div:function(R){return this.clone()._div(R)},rotate:function(R){return this.clone()._rotate(R)},rotateAround:function(R,W){return this.clone()._rotateAround(R,W)},matMult:function(R){return this.clone()._matMult(R)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(R){return this.x===R.x&&this.y===R.y},dist:function(R){return Math.sqrt(this.distSqr(R))},distSqr:function(R){var W=R.x-this.x,Ce=R.y-this.y;return W*W+Ce*Ce},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(R){return Math.atan2(this.y-R.y,this.x-R.x)},angleWith:function(R){return this.angleWithSep(R.x,R.y)},angleWithSep:function(R,W){return Math.atan2(this.x*W-this.y*R,this.x*R+this.y*W)},_matMult:function(R){var Ce=R[2]*this.x+R[3]*this.y;return this.x=R[0]*this.x+R[1]*this.y,this.y=Ce,this},_add:function(R){return this.x+=R.x,this.y+=R.y,this},_sub:function(R){return this.x-=R.x,this.y-=R.y,this},_mult:function(R){return this.x*=R,this.y*=R,this},_div:function(R){return this.x/=R,this.y/=R,this},_multByPoint:function(R){return this.x*=R.x,this.y*=R.y,this},_divByPoint:function(R){return this.x/=R.x,this.y/=R.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var R=this.y;return this.y=this.x,this.x=-R,this},_rotate:function(R){var W=Math.cos(R),Ce=Math.sin(R),Gt=Ce*this.x+W*this.y;return this.x=W*this.x-Ce*this.y,this.y=Gt,this},_rotateAround:function(R,W){var Ce=Math.cos(R),Et=Math.sin(R),et=W.y+Et*(this.x-W.x)+Ce*(this.y-W.y);return this.x=W.x+Ce*(this.x-W.x)-Et*(this.y-W.y),this.y=et,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},wt.convert=function(R){return R instanceof wt?R:Array.isArray(R)?new wt(R[0],R[1]):R};var mr=function(R){setTimeout(function(){R.map&&R.map.doubleClickZoom&&R._ctx&&R._ctx.store&&R._ctx.store.getInitialConfigValue&&R._ctx.store.getInitialConfigValue("doubleClickZoom")&&R.map.doubleClickZoom.enable()},0)},Yr=function(R){setTimeout(function(){R.map&&R.map.doubleClickZoom&&R.map.doubleClickZoom.disable()},0)},hn=function(R){if(!R||!R.type)return null;var W=en[R.type];return W?"geometry"===W?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:R}]}:"feature"===W?{type:"FeatureCollection",features:[R]}:"featurecollection"===W?R:void 0:null},en={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function Tn(R){switch(R&&R.type||null){case"FeatureCollection":return R.features=R.features.reduce(function(W,Ce){return W.concat(Tn(Ce))},[]),R;case"Feature":return R.geometry?Tn(R.geometry).map(function(W){var Ce={type:"Feature",properties:JSON.parse(JSON.stringify(R.properties)),geometry:W};return void 0!==R.id&&(Ce.id=R.id),Ce}):[R];case"MultiPoint":return R.coordinates.map(function(W){return{type:"Point",coordinates:W}});case"MultiPolygon":return R.coordinates.map(function(W){return{type:"Polygon",coordinates:W}});case"MultiLineString":return R.coordinates.map(function(W){return{type:"LineString",coordinates:W}});case"GeometryCollection":return R.geometries.map(Tn).reduce(function(W,Ce){return W.concat(Ce)},[]);case"Point":case"Polygon":case"LineString":return[R]}}var xi=rr(function(R){var W=R.exports=function(kt){return new Ce(kt)};function Ce(kt){this.value=kt}function Et(kt,hr,Er){var Jr=[],yn=[],ao=!0;return function fr(nn){var In=Er?Gt(nn):nn,xn={},_o=!0,Zr={node:In,node_:nn,path:[].concat(Jr),parent:yn[yn.length-1],parents:yn,key:Jr.slice(-1)[0],isRoot:0===Jr.length,level:Jr.length,circular:null,update:function(pn,ji){Zr.isRoot||(Zr.parent.node[Zr.key]=pn),Zr.node=pn,ji&&(_o=!1)},delete:function(pn){delete Zr.parent.node[Zr.key],pn&&(_o=!1)},remove:function(pn){br(Zr.parent.node)?Zr.parent.node.splice(Zr.key,1):delete Zr.parent.node[Zr.key],pn&&(_o=!1)},keys:null,before:function(pn){xn.before=pn},after:function(pn){xn.after=pn},pre:function(pn){xn.pre=pn},post:function(pn){xn.post=pn},stop:function(){ao=!1},block:function(){_o=!1}};if(!ao)return Zr;function zo(){if("object"==typeof Zr.node&&null!==Zr.node){Zr.keys&&Zr.node_===Zr.node||(Zr.keys=et(Zr.node)),Zr.isLeaf=0==Zr.keys.length;for(var pn=0;pn<yn.length;pn++)if(yn[pn].node_===nn){Zr.circular=yn[pn];break}}else Zr.isLeaf=!0,Zr.keys=null;Zr.notLeaf=!Zr.isLeaf,Zr.notRoot=!Zr.isRoot}zo();var Rs=hr.call(Zr,Zr.node);return void 0!==Rs&&Zr.update&&Zr.update(Rs),xn.before&&xn.before.call(Zr,Zr.node),_o&&("object"!=typeof Zr.node||null===Zr.node||Zr.circular||(yn.push(Zr),zo(),wr(Zr.keys,function(pn,ji){Jr.push(pn),xn.pre&&xn.pre.call(Zr,Zr.node[pn],pn);var Xo=fr(Zr.node[pn]);Er&&Wr.call(Zr.node,pn)&&(Zr.node[pn]=Xo.node),Xo.isLast=ji==Zr.keys.length-1,Xo.isFirst=0==ji,xn.post&&xn.post.call(Zr,Xo),Jr.pop()}),yn.pop()),xn.after&&xn.after.call(Zr,Zr.node)),Zr}(kt).node}function Gt(kt){if("object"==typeof kt&&null!==kt){var hr;if(br(kt))hr=[];else if("[object Date]"===Bt(kt))hr=new Date(kt.getTime?kt.getTime():kt);else if("[object RegExp]"===Bt(kt))hr=new RegExp(kt);else if("[object Error]"===Bt(kt))hr={message:kt.message};else if(function(yn){return"[object Boolean]"===Bt(yn)}(kt))hr=new Boolean(kt);else if(function(yn){return"[object Number]"===Bt(yn)}(kt))hr=new Number(kt);else if(function(yn){return"[object String]"===Bt(yn)}(kt))hr=new String(kt);else if(Object.create&&Object.getPrototypeOf)hr=Object.create(Object.getPrototypeOf(kt));else if(kt.constructor===Object)hr={};else{var Jr=function(){};Jr.prototype=kt.constructor&&kt.constructor.prototype||kt.__proto__||{},hr=new Jr}return wr(et(kt),function(yn){hr[yn]=kt[yn]}),hr}return kt}Ce.prototype.get=function(kt){for(var hr=this.value,Er=0;Er<kt.length;Er++){var Jr=kt[Er];if(!hr||!Wr.call(hr,Jr)){hr=void 0;break}hr=hr[Jr]}return hr},Ce.prototype.has=function(kt){for(var hr=this.value,Er=0;Er<kt.length;Er++){var Jr=kt[Er];if(!hr||!Wr.call(hr,Jr))return!1;hr=hr[Jr]}return!0},Ce.prototype.set=function(kt,hr){for(var Er=this.value,Jr=0;Jr<kt.length-1;Jr++){var yn=kt[Jr];Wr.call(Er,yn)||(Er[yn]={}),Er=Er[yn]}return Er[kt[Jr]]=hr,hr},Ce.prototype.map=function(kt){return Et(this.value,kt,!0)},Ce.prototype.forEach=function(kt){return this.value=Et(this.value,kt,!1),this.value},Ce.prototype.reduce=function(kt,hr){var Er=1===arguments.length,Jr=Er?this.value:hr;return this.forEach(function(yn){this.isRoot&&Er||(Jr=kt.call(this,Jr,yn))}),Jr},Ce.prototype.paths=function(){var kt=[];return this.forEach(function(hr){kt.push(this.path)}),kt},Ce.prototype.nodes=function(){var kt=[];return this.forEach(function(hr){kt.push(this.node)}),kt},Ce.prototype.clone=function(){var kt=[],hr=[];return function Er(Jr){for(var yn=0;yn<kt.length;yn++)if(kt[yn]===Jr)return hr[yn];if("object"==typeof Jr&&null!==Jr){var ao=Gt(Jr);return kt.push(Jr),hr.push(ao),wr(et(Jr),function(fr){ao[fr]=Er(Jr[fr])}),kt.pop(),hr.pop(),ao}return Jr}(this.value)};var et=Object.keys||function(kt){var hr=[];for(var Er in kt)hr.push(Er);return hr};function Bt(kt){return Object.prototype.toString.call(kt)}var br=Array.isArray||function(kt){return"[object Array]"===Object.prototype.toString.call(kt)},wr=function(kt,hr){if(kt.forEach)return kt.forEach(hr);for(var Er=0;Er<kt.length;Er++)hr(kt[Er],Er,kt)};wr(et(Ce.prototype),function(kt){W[kt]=function(hr){var Er=[].slice.call(arguments,1),Jr=new Ce(hr);return Jr[kt].apply(Jr,Er)}});var Wr=Object.hasOwnProperty||function(kt,hr){return hr in kt}}),jr=mn;function mn(R){if(!(this instanceof mn))return new mn(R);this._bbox=R||[1/0,1/0,-1/0,-1/0],this._valid=!!R}mn.prototype.include=function(R){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],R[0]),this._bbox[1]=Math.min(this._bbox[1],R[1]),this._bbox[2]=Math.max(this._bbox[2],R[0]),this._bbox[3]=Math.max(this._bbox[3],R[1]),this},mn.prototype.equals=function(R){var W;return W=R instanceof mn?R.bbox():R,this._bbox[0]==W[0]&&this._bbox[1]==W[1]&&this._bbox[2]==W[2]&&this._bbox[3]==W[3]},mn.prototype.center=function(R){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},mn.prototype.union=function(R){var W;return this._valid=!0,W=R instanceof mn?R.bbox():R,this._bbox[0]=Math.min(this._bbox[0],W[0]),this._bbox[1]=Math.min(this._bbox[1],W[1]),this._bbox[2]=Math.max(this._bbox[2],W[2]),this._bbox[3]=Math.max(this._bbox[3],W[3]),this},mn.prototype.bbox=function(){return this._valid?this._bbox:null},mn.prototype.contains=function(R){if(!R)return this._fastContains();if(!this._valid)return null;var W=R[0],Ce=R[1];return this._bbox[0]<=W&&this._bbox[1]<=Ce&&this._bbox[2]>=W&&this._bbox[3]>=Ce},mn.prototype.intersect=function(R){return this._valid?(W=R instanceof mn?R.bbox():R,!(this._bbox[0]>W[2]||this._bbox[2]<W[0]||this._bbox[3]<W[1]||this._bbox[1]>W[3])):null;var W},mn.prototype._fastContains=function(){return this._valid?new Function("ll","return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]"):new Function("return null;")},mn.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var ro={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},Ho=Object.keys(ro),Ts=function(R){return ki(R).bbox()};function ki(R){for(var W=jr(),Ce=function(R){if(!R)return[];var W=Tn(hn(R)),Ce=[];return W.features.forEach(function(Et){Et.geometry&&(Ce=Ce.concat(function Gt(et){return Array.isArray(et)&&et.length&&"number"==typeof et[0]?[et]:et.reduce(function(Bt,br){return Array.isArray(br)&&Array.isArray(br[0])?Bt.concat(Gt(br)):(Bt.push(br),Bt)},[])}(Et.geometry.coordinates)))}),Ce}(R),Et=0;Et<Ce.length;Et++)W.include(Ce[Et]);return W}function ur(R,W){var Ce=-90,Et=90,Gt=-90,et=90,Bt=270,br=-270;R.forEach(function(Wr){var kt=Ts(Wr),hr=kt[1],Er=kt[3],Jr=kt[0],yn=kt[2];hr>Ce&&(Ce=hr),Er<Et&&(Et=Er),Er>Gt&&(Gt=Er),hr<et&&(et=hr),Jr<Bt&&(Bt=Jr),yn>br&&(br=yn)});var wr=W;return Ce+wr.lat>85&&(wr.lat=85-Ce),Gt+wr.lat>90&&(wr.lat=90-Gt),Et+wr.lat<-85&&(wr.lat=-85-Et),et+wr.lat<-90&&(wr.lat=-90-et),Bt+wr.lng<=-270&&(wr.lng+=360*Math.ceil(Math.abs(wr.lng)/360)),br+wr.lng>=270&&(wr.lng-=360*Math.ceil(Math.abs(wr.lng)/360)),wr}function hs(R,W){var Ce=ur(R.map(function(Et){return Et.toGeoJSON()}),W);R.forEach(function(Et){var Gt,et=Et.getCoordinates(),Bt=function(wr){var Wr={lng:wr[0]+Ce.lng,lat:wr[1]+Ce.lat};return[Wr.lng,Wr.lat]},br=function(wr){return wr.map(function(Wr){return Bt(Wr)})};Et.type===Ze?Gt=Bt(et):Et.type===ze||"MultiPoint"===Et.type?Gt=et.map(Bt):Et.type===nt||"MultiLineString"===Et.type?Gt=et.map(br):"MultiPolygon"===Et.type&&(Gt=et.map(function(wr){return wr.map(function(Wr){return br(Wr)})})),Et.incomingCoords(Gt)})}Ts.polygon=function(R){return ki(R).polygon()},Ts.bboxify=function(R){return xi(R).map(function(W){W&&Ho.some(function(Ce){return!!W[Ce]&&-1!==ro[Ce].indexOf(W.type)})&&(W.bbox=ki(W).bbox(),this.update(W))})};var Kn={onSetup:function(R){var W=this,Ce={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:R.featureIds||[]};return this.setSelected(Ce.initiallySelectedFeatureIds.filter(function(Et){return void 0!==W.getFeature(Et)})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),Ce},fireUpdate:function(){this.map.fire(Ue,{action:"move",features:this.getSelected().map(function(R){return R.toGeoJSON()})})},fireActionable:function(){var R=this,W=this.getSelected(),Ce=W.filter(function(br){return R.isInstanceOf("MultiFeature",br)}),Et=!1;if(W.length>1){Et=!0;var Gt=W[0].type.replace("Multi","");W.forEach(function(br){br.type.replace("Multi","")!==Gt&&(Et=!1)})}this.setActionableState({combineFeatures:Et,uncombineFeatures:Ce.length>0,trash:W.length>0})},getUniqueIds:function(R){return R.length?R.map(function(W){return W.properties.id}).filter(function(W){return void 0!==W}).reduce(function(W,Ce){return W.add(Ce),W},new Se).values():[]},stopExtendedInteractions:function(R){R.boxSelectElement&&(R.boxSelectElement.parentNode&&R.boxSelectElement.parentNode.removeChild(R.boxSelectElement),R.boxSelectElement=null),this.map.dragPan.enable(),R.boxSelecting=!1,R.canBoxSelect=!1,R.dragMoving=!1,R.canDragMove=!1},onStop:function(){mr(this)},onMouseMove:function(R){return this.stopExtendedInteractions(R),!0},onMouseOut:function(R){return!R.dragMoving||this.fireUpdate()}};Kn.onTap=Kn.onClick=function(R,W){return we(W)?this.clickAnywhere(R,W):Cs(cn)(W)?this.clickOnVertex(R,W):(Ce=W).featureTarget&&Ce.featureTarget.properties&&Ce.featureTarget.properties.meta===Ar?this.clickOnFeature(R,W):void 0;var Ce},Kn.clickAnywhere=function(R){var W=this,Ce=this.getSelectedIds();Ce.length&&(this.clearSelectedFeatures(),Ce.forEach(function(Et){return W.doRender(Et)})),mr(this),this.stopExtendedInteractions(R)},Kn.clickOnVertex=function(R,W){this.changeMode(Ae.DIRECT_SELECT,{featureId:W.featureTarget.properties.parent,coordPath:W.featureTarget.properties.coord_path,startPos:W.lngLat}),this.updateUIClasses({mouse:ee})},Kn.startOnActiveFeature=function(R,W){this.stopExtendedInteractions(R),this.map.dragPan.disable(),this.doRender(W.featureTarget.properties.id),R.canDragMove=!0,R.dragMoveLocation=W.lngLat},Kn.clickOnFeature=function(R,W){var Ce=this;Yr(this),this.stopExtendedInteractions(R);var Et=ot(W),Gt=this.getSelectedIds(),et=W.featureTarget.properties.id,Bt=this.isSelected(et);if(!Et&&Bt&&this.getFeature(et).type!==Ze)return this.changeMode(Ae.DIRECT_SELECT,{featureId:et});Bt&&Et?(this.deselect(et),this.updateUIClasses({mouse:ne}),1===Gt.length&&mr(this)):!Bt&&Et?(this.select(et),this.updateUIClasses({mouse:ee})):Bt||Et||(Gt.forEach(function(br){return Ce.doRender(br)}),this.setSelected(et),this.updateUIClasses({mouse:ee})),this.doRender(et)},Kn.onMouseDown=function(R,W){return Ge(W)?this.startOnActiveFeature(R,W):this.drawConfig.boxSelect&&(Ce=W).originalEvent&&Ce.originalEvent.shiftKey&&0===Ce.originalEvent.button?this.startBoxSelect(R,W):void 0;var Ce},Kn.startBoxSelect=function(R,W){this.stopExtendedInteractions(R),this.map.dragPan.disable(),R.boxSelectStartLocation=Ct(W.originalEvent,this.map.getContainer()),R.canBoxSelect=!0},Kn.onTouchStart=function(R,W){if(Ge(W))return this.startOnActiveFeature(R,W)},Kn.onDrag=function(R,W){return R.canDragMove?this.dragMove(R,W):this.drawConfig.boxSelect&&R.canBoxSelect?this.whileBoxSelect(R,W):void 0},Kn.whileBoxSelect=function(R,W){R.boxSelecting=!0,this.updateUIClasses({mouse:X}),R.boxSelectElement||(R.boxSelectElement=document.createElement("div"),R.boxSelectElement.classList.add("mapbox-gl-draw_boxselect"),this.map.getContainer().appendChild(R.boxSelectElement));var Ce=Ct(W.originalEvent,this.map.getContainer()),Et=Math.min(R.boxSelectStartLocation.x,Ce.x),Gt=Math.max(R.boxSelectStartLocation.x,Ce.x),et=Math.min(R.boxSelectStartLocation.y,Ce.y),Bt=Math.max(R.boxSelectStartLocation.y,Ce.y),br="translate("+Et+"px, "+et+"px)";R.boxSelectElement.style.transform=br,R.boxSelectElement.style.WebkitTransform=br,R.boxSelectElement.style.width=Gt-Et+"px",R.boxSelectElement.style.height=Bt-et+"px"},Kn.dragMove=function(R,W){R.dragMoving=!0,W.originalEvent.stopPropagation();var Ce={lng:W.lngLat.lng-R.dragMoveLocation.lng,lat:W.lngLat.lat-R.dragMoveLocation.lat};hs(this.getSelected(),Ce),R.dragMoveLocation=W.lngLat},Kn.onMouseUp=function(R,W){var Ce=this;if(R.dragMoving)this.fireUpdate();else if(R.boxSelecting){var Et=[R.boxSelectStartLocation,Ct(W.originalEvent,this.map.getContainer())],Gt=this.featuresAt(null,Et,"click"),et=this.getUniqueIds(Gt).filter(function(Bt){return!Ce.isSelected(Bt)});et.length&&(this.select(et),et.forEach(function(Bt){return Ce.doRender(Bt)}),this.updateUIClasses({mouse:ee}))}this.stopExtendedInteractions(R)},Kn.toDisplayFeatures=function(R,W,Ce){W.properties.active=this.isSelected(W.properties.id)?qn:yi,Ce(W),this.fireActionable(),W.properties.active===qn&&W.geometry.type!==Ze&&Rr(W).forEach(Ce)},Kn.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Kn.onCombineFeatures=function(){var R=this.getSelected();if(!(0===R.length||R.length<2)){for(var W=[],Ce=[],Et=R[0].type.replace("Multi",""),Gt=0;Gt<R.length;Gt++){var et=R[Gt];if(et.type.replace("Multi","")!==Et)return;et.type.includes("Multi")?et.getCoordinates().forEach(function(br){W.push(br)}):W.push(et.getCoordinates()),Ce.push(et.toGeoJSON())}if(Ce.length>1){var Bt=this.newFeature({type:re,properties:Ce[0].properties,geometry:{type:"Multi"+Et,coordinates:W}});this.addFeature(Bt),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([Bt.id]),this.map.fire("draw.combine",{createdFeatures:[Bt.toGeoJSON()],deletedFeatures:Ce})}this.fireActionable()}},Kn.onUncombineFeatures=function(){var R=this,W=this.getSelected();if(0!==W.length){for(var Ce=[],Et=[],Gt=function(Bt){var br=W[Bt];R.isInstanceOf("MultiFeature",br)&&(br.getFeatures().forEach(function(wr){R.addFeature(wr),wr.properties=br.properties,Ce.push(wr.toGeoJSON()),R.select([wr.id])}),R.deleteFeature(br.id,{silent:!0}),Et.push(br.toGeoJSON()))},et=0;et<W.length;et++)Gt(et);Ce.length>1&&this.map.fire("draw.uncombine",{createdFeatures:Ce,deletedFeatures:Et}),this.fireActionable()}};var Jo=Cs(cn),Ou=Cs(xr),Ko={fireUpdate:function(){this.map.fire(Ue,{action:"change_coordinates",features:this.getSelected().map(function(R){return R.toGeoJSON()})})},fireActionable:function(R){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:R.selectedCoordPaths.length>0})},startDragging:function(R,W){this.map.dragPan.disable(),R.canDragMove=!0,R.dragMoveLocation=W.lngLat},stopDragging:function(R){this.map.dragPan.enable(),R.dragMoving=!1,R.canDragMove=!1,R.dragMoveLocation=null},onVertex:function(R,W){this.startDragging(R,W);var Ce=W.featureTarget.properties,Et=R.selectedCoordPaths.indexOf(Ce.coord_path);ot(W)||-1!==Et?ot(W)&&-1===Et&&R.selectedCoordPaths.push(Ce.coord_path):R.selectedCoordPaths=[Ce.coord_path];var Gt=this.pathsToCoordinates(R.featureId,R.selectedCoordPaths);this.setSelectedCoordinates(Gt)},onMidpoint:function(R,W){this.startDragging(R,W);var Ce=W.featureTarget.properties;R.feature.addCoordinate(Ce.coord_path,Ce.lng,Ce.lat),this.fireUpdate(),R.selectedCoordPaths=[Ce.coord_path]},pathsToCoordinates:function(R,W){return W.map(function(Ce){return{feature_id:R,coord_path:Ce}})},onFeature:function(R,W){0===R.selectedCoordPaths.length?this.startDragging(R,W):this.stopDragging(R)},dragFeature:function(R,W,Ce){hs(this.getSelected(),Ce),R.dragMoveLocation=W.lngLat},dragVertex:function(R,W,Ce){for(var Et=R.selectedCoordPaths.map(function(br){return R.feature.getCoordinate(br)}),Gt=ur(Et.map(function(br){return{type:re,properties:{},geometry:{type:Ze,coordinates:br}}}),Ce),et=0;et<Et.length;et++){var Bt=Et[et];R.feature.updateCoordinate(R.selectedCoordPaths[et],Bt[0]+Gt.lng,Bt[1]+Gt.lat)}},clickNoTarget:function(){this.changeMode(Ae.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(Ae.SIMPLE_SELECT)},clickActiveFeature:function(R){R.selectedCoordPaths=[],this.clearSelectedCoordinates(),R.feature.changed()},onSetup:function(R){var W=R.featureId,Ce=this.getFeature(W);if(!Ce)throw new Error("You must provide a featureId to enter direct_select mode");if(Ce.type===Ze)throw new TypeError("direct_select mode doesn't handle point features");var Et={featureId:W,feature:Ce,dragMoveLocation:R.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:R.coordPath?[R.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(W,Et.selectedCoordPaths)),this.setSelected(W),Yr(this),this.setActionableState({trash:!0}),Et},onStop:function(){mr(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(R,W,Ce){R.featureId===W.properties.id?(W.properties.active=qn,Ce(W),Rr(W,{map:this.map,midpoints:!0,selectedPaths:R.selectedCoordPaths}).forEach(Ce)):(W.properties.active=yi,Ce(W)),this.fireActionable(R)},onTrash:function(R){R.selectedCoordPaths.sort(function(W,Ce){return Ce.localeCompare(W,"en",{numeric:!0})}).forEach(function(W){return R.feature.removeCoordinate(W)}),this.fireUpdate(),R.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(R),!1===R.feature.isValid()&&(this.deleteFeature([R.featureId]),this.changeMode(Ae.SIMPLE_SELECT,{}))},onMouseMove:function(R,W){var Ce=Ge(W),Et=Jo(W),Gt=0===R.selectedCoordPaths.length;return this.updateUIClasses(Ce&&Gt||Et&&!Gt?{mouse:ee}:{mouse:se}),this.stopDragging(R),!0},onMouseOut:function(R){return R.dragMoving&&this.fireUpdate(),!0}};Ko.onTouchStart=Ko.onMouseDown=function(R,W){return Jo(W)?this.onVertex(R,W):Ge(W)?this.onFeature(R,W):Ou(W)?this.onMidpoint(R,W):void 0},Ko.onDrag=function(R,W){if(!0===R.canDragMove){R.dragMoving=!0,W.originalEvent.stopPropagation();var Ce={lng:W.lngLat.lng-R.dragMoveLocation.lng,lat:W.lngLat.lat-R.dragMoveLocation.lat};R.selectedCoordPaths.length>0?this.dragVertex(R,W,Ce):this.dragFeature(R,W,Ce),R.dragMoveLocation=W.lngLat}},Ko.onClick=function(R,W){return we(W)?this.clickNoTarget(R,W):Ge(W)?this.clickActiveFeature(R,W):le(W)?this.clickInactive(R,W):void this.stopDragging(R)},Ko.onTap=function(R,W){return we(W)?this.clickNoTarget(R,W):Ge(W)?this.clickActiveFeature(R,W):le(W)?this.clickInactive(R,W):void 0},Ko.onTouchEnd=Ko.onMouseUp=function(R){R.dragMoving&&this.fireUpdate(),this.stopDragging(R)};var ks={};function Pl(R,W){return!!R.lngLat&&R.lngLat.lng===W[0]&&R.lngLat.lat===W[1]}ks.onSetup=function(){var R=this.newFeature({type:re,properties:{},geometry:{type:Ze,coordinates:[]}});return this.addFeature(R),this.clearSelectedFeatures(),this.updateUIClasses({mouse:X}),this.activateUIButton(he.POINT),this.setActionableState({trash:!0}),{point:R}},ks.stopDrawingAndRemove=function(R){this.deleteFeature([R.point.id],{silent:!0}),this.changeMode(Ae.SIMPLE_SELECT)},ks.onTap=ks.onClick=function(R,W){this.updateUIClasses({mouse:ee}),R.point.updateCoordinate("",W.lngLat.lng,W.lngLat.lat),this.map.fire(pt,{features:[R.point.toGeoJSON()]}),this.changeMode(Ae.SIMPLE_SELECT,{featureIds:[R.point.id]})},ks.onStop=function(R){this.activateUIButton(),R.point.getCoordinate().length||this.deleteFeature([R.point.id],{silent:!0})},ks.toDisplayFeatures=function(R,W,Ce){var Et=W.properties.id===R.point.id;if(W.properties.active=Et?qn:yi,!Et)return Ce(W)},ks.onTrash=ks.stopDrawingAndRemove,ks.onKeyUp=function(R,W){if(dt(W)||Dt(W))return this.stopDrawingAndRemove(R,W)};var oi={onSetup:function(){var R=this.newFeature({type:re,properties:{},geometry:{type:nt,coordinates:[[]]}});return this.addFeature(R),this.clearSelectedFeatures(),Yr(this),this.updateUIClasses({mouse:X}),this.activateUIButton(he.POLYGON),this.setActionableState({trash:!0}),{polygon:R,currentVertexPosition:0}},clickAnywhere:function(R,W){if(R.currentVertexPosition>0&&Pl(W,R.polygon.coordinates[0][R.currentVertexPosition-1]))return this.changeMode(Ae.SIMPLE_SELECT,{featureIds:[R.polygon.id]});this.updateUIClasses({mouse:X}),R.polygon.updateCoordinate("0."+R.currentVertexPosition,W.lngLat.lng,W.lngLat.lat),R.currentVertexPosition++,R.polygon.updateCoordinate("0."+R.currentVertexPosition,W.lngLat.lng,W.lngLat.lat)},clickOnVertex:function(R){return this.changeMode(Ae.SIMPLE_SELECT,{featureIds:[R.polygon.id]})},onMouseMove:function(R,W){R.polygon.updateCoordinate("0."+R.currentVertexPosition,W.lngLat.lng,W.lngLat.lat),qe(W)&&this.updateUIClasses({mouse:ne})}};oi.onTap=oi.onClick=function(R,W){return qe(W)?this.clickOnVertex(R,W):this.clickAnywhere(R,W)},oi.onKeyUp=function(R,W){dt(W)?(this.deleteFeature([R.polygon.id],{silent:!0}),this.changeMode(Ae.SIMPLE_SELECT)):Dt(W)&&this.changeMode(Ae.SIMPLE_SELECT,{featureIds:[R.polygon.id]})},oi.onStop=function(R){this.updateUIClasses({mouse:se}),mr(this),this.activateUIButton(),void 0!==this.getFeature(R.polygon.id)&&(R.polygon.removeCoordinate("0."+R.currentVertexPosition),R.polygon.isValid()?this.map.fire(pt,{features:[R.polygon.toGeoJSON()]}):(this.deleteFeature([R.polygon.id],{silent:!0}),this.changeMode(Ae.SIMPLE_SELECT,{},{silent:!0})))},oi.toDisplayFeatures=function(R,W,Ce){var Et=W.properties.id===R.polygon.id;if(W.properties.active=Et?qn:yi,!Et)return Ce(W);if(0!==W.geometry.coordinates.length){var Gt=W.geometry.coordinates[0].length;if(!(Gt<3)){if(W.properties.meta=Ar,Ce(sr(R.polygon.id,W.geometry.coordinates[0][0],"0.0",!1)),Gt>3){var et=W.geometry.coordinates[0].length-3;Ce(sr(R.polygon.id,W.geometry.coordinates[0][et],"0."+et,!1))}if(Gt<=4&&(Ce({type:re,properties:W.properties,geometry:{coordinates:[[W.geometry.coordinates[0][0][0],W.geometry.coordinates[0][0][1]],[W.geometry.coordinates[0][1][0],W.geometry.coordinates[0][1][1]]],type:ze}}),3===Gt))return;return Ce(W)}}},oi.onTrash=function(R){this.deleteFeature([R.polygon.id],{silent:!0}),this.changeMode(Ae.SIMPLE_SELECT)};var Nr={onSetup:function(R){var W,Ce,Et=(R=R||{}).featureId,Gt="forward";if(Et){if(!(W=this.getFeature(Et)))throw new Error("Could not find a feature with the provided featureId");var et=R.from;if(et&&"Feature"===et.type&&et.geometry&&"Point"===et.geometry.type&&(et=et.geometry),et&&"Point"===et.type&&et.coordinates&&2===et.coordinates.length&&(et=et.coordinates),!et||!Array.isArray(et))throw new Error("Please use the `from` property to indicate which point to continue the line from");var Bt=W.coordinates.length-1;if(W.coordinates[Bt][0]===et[0]&&W.coordinates[Bt][1]===et[1])W.addCoordinate.apply(W,[Ce=Bt+1].concat(W.coordinates[Bt]));else{if(W.coordinates[0][0]!==et[0]||W.coordinates[0][1]!==et[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");Gt="backwards",W.addCoordinate.apply(W,[Ce=0].concat(W.coordinates[0]))}}else W=this.newFeature({type:re,properties:{},geometry:{type:ze,coordinates:[]}}),Ce=0,this.addFeature(W);return this.clearSelectedFeatures(),Yr(this),this.updateUIClasses({mouse:X}),this.activateUIButton(he.LINE),this.setActionableState({trash:!0}),{line:W,currentVertexPosition:Ce,direction:Gt}},clickAnywhere:function(R,W){if(R.currentVertexPosition>0&&Pl(W,R.line.coordinates[R.currentVertexPosition-1])||"backwards"===R.direction&&Pl(W,R.line.coordinates[R.currentVertexPosition+1]))return this.changeMode(Ae.SIMPLE_SELECT,{featureIds:[R.line.id]});this.updateUIClasses({mouse:X}),R.line.updateCoordinate(R.currentVertexPosition,W.lngLat.lng,W.lngLat.lat),"forward"===R.direction?(R.currentVertexPosition++,R.line.updateCoordinate(R.currentVertexPosition,W.lngLat.lng,W.lngLat.lat)):R.line.addCoordinate(0,W.lngLat.lng,W.lngLat.lat)},clickOnVertex:function(R){return this.changeMode(Ae.SIMPLE_SELECT,{featureIds:[R.line.id]})},onMouseMove:function(R,W){R.line.updateCoordinate(R.currentVertexPosition,W.lngLat.lng,W.lngLat.lat),qe(W)&&this.updateUIClasses({mouse:ne})}};Nr.onTap=Nr.onClick=function(R,W){if(qe(W))return this.clickOnVertex(R,W);this.clickAnywhere(R,W)},Nr.onKeyUp=function(R,W){Dt(W)?this.changeMode(Ae.SIMPLE_SELECT,{featureIds:[R.line.id]}):dt(W)&&(this.deleteFeature([R.line.id],{silent:!0}),this.changeMode(Ae.SIMPLE_SELECT))},Nr.onStop=function(R){mr(this),this.activateUIButton(),void 0!==this.getFeature(R.line.id)&&(R.line.removeCoordinate(""+R.currentVertexPosition),R.line.isValid()?this.map.fire(pt,{features:[R.line.toGeoJSON()]}):(this.deleteFeature([R.line.id],{silent:!0}),this.changeMode(Ae.SIMPLE_SELECT,{},{silent:!0})))},Nr.onTrash=function(R){this.deleteFeature([R.line.id],{silent:!0}),this.changeMode(Ae.SIMPLE_SELECT)},Nr.toDisplayFeatures=function(R,W,Ce){var Et=W.properties.id===R.line.id;if(W.properties.active=Et?qn:yi,!Et)return Ce(W);W.geometry.coordinates.length<2||(W.properties.meta=Ar,Ce(sr(R.line.id,W.geometry.coordinates["forward"===R.direction?W.geometry.coordinates.length-2:1],""+("forward"===R.direction?W.geometry.coordinates.length-2:1),!1)),Ce(W))};var Vn={simple_select:Kn,direct_select:Ko,draw_point:ks,draw_polygon:oi,draw_line_string:Nr},ai={defaultMode:Ae.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:Vn,controls:{},userProperties:!1},Ws={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},hi={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function ri(R,W){return R.map(function(Ce){return Ce.source?Ce:Wo(Ce,{id:Ce.id+"."+W,source:"hot"===W?q:K})})}var va=rr(function(R,W){var Ce="[object Arguments]",Et="[object Map]",Gt="[object Object]",et="[object Set]",Bt=/^\[object .+?Constructor\]$/,br=/^(?:0|[1-9]\d*)$/,wr={};wr["[object Float32Array]"]=wr["[object Float64Array]"]=wr["[object Int8Array]"]=wr["[object Int16Array]"]=wr["[object Int32Array]"]=wr["[object Uint8Array]"]=wr["[object Uint8ClampedArray]"]=wr["[object Uint16Array]"]=wr["[object Uint32Array]"]=!0,wr[Ce]=wr["[object Array]"]=wr["[object ArrayBuffer]"]=wr["[object Boolean]"]=wr["[object DataView]"]=wr["[object Date]"]=wr["[object Error]"]=wr["[object Function]"]=wr[Et]=wr["[object Number]"]=wr[Gt]=wr["[object RegExp]"]=wr[et]=wr["[object String]"]=wr["[object WeakMap]"]=!1;var Wr="object"==typeof global&&global&&global.Object===Object&&global,kt="object"==typeof self&&self&&self.Object===Object&&self,hr=Wr||kt||Function("return this")(),Er=W&&!W.nodeType&&W,Jr=Er&&R&&!R.nodeType&&R,yn=Jr&&Jr.exports===Er,ao=yn&&Wr.process,fr=function(){try{return ao&&ao.binding&&ao.binding("util")}catch{}}(),nn=fr&&fr.isTypedArray;function In(Lt,tr){for(var kr=-1,An=null==Lt?0:Lt.length;++kr<An;)if(tr(Lt[kr],kr,Lt))return!0;return!1}function xn(Lt){var tr=-1,kr=Array(Lt.size);return Lt.forEach(function(An,go){kr[++tr]=[go,An]}),kr}function _o(Lt){var tr=-1,kr=Array(Lt.size);return Lt.forEach(function(An){kr[++tr]=An}),kr}var Zr,zo,Rs,pn=Array.prototype,Xo=Object.prototype,Ns=hr["__core-js_shared__"],_l=Function.prototype.toString,gs=Xo.hasOwnProperty,Js=(Zr=/[^.]+$/.exec(Ns&&Ns.keys&&Ns.keys.IE_PROTO||""))?"Symbol(src)_1."+Zr:"",Ao=Xo.toString,qi=RegExp("^"+_l.call(gs).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ms=yn?hr.Buffer:void 0,Vi=hr.Symbol,Bo=hr.Uint8Array,ps=Xo.propertyIsEnumerable,lu=pn.splice,la=Vi?Vi.toStringTag:void 0,ku=Object.getOwnPropertySymbols,Yu=Ms?Ms.isBuffer:void 0,ys=(zo=Object.keys,Rs=Object,function(Lt){return zo(Rs(Lt))}),sl=Ea(hr,"DataView"),$o=Ea(hr,"Map"),Fa=Ea(hr,"Promise"),La=Ea(hr,"Set"),Wl=Ea(hr,"WeakMap"),lo=Ea(Object,"create"),_n=Is(sl),Al=Is($o),wi=Is(Fa),ua=Is(La),xa=Is(Wl),al=Vi?Vi.prototype:void 0,Ya=al?al.valueOf:void 0;function ll(Lt){var tr=-1,kr=null==Lt?0:Lt.length;for(this.clear();++tr<kr;){var An=Lt[tr];this.set(An[0],An[1])}}function ba(Lt){var tr=-1,kr=null==Lt?0:Lt.length;for(this.clear();++tr<kr;){var An=Lt[tr];this.set(An[0],An[1])}}function ni(Lt){var tr=-1,kr=null==Lt?0:Lt.length;for(this.clear();++tr<kr;){var An=Lt[tr];this.set(An[0],An[1])}}function wa(Lt){var tr=-1,kr=null==Lt?0:Lt.length;for(this.__data__=new ni;++tr<kr;)this.add(Lt[tr])}function Ri(Lt){var tr=this.__data__=new ba(Lt);this.size=tr.size}function Uo(Lt,tr){for(var kr=Lt.length;kr--;)if(Fs(Lt[kr][0],tr))return kr;return-1}function Ll(Lt){return null==Lt?void 0===Lt?"[object Undefined]":"[object Null]":la&&la in Object(Lt)?function(tr){var kr=gs.call(tr,la),An=tr[la];try{tr[la]=void 0;var go=!0}catch{}var Un=Ao.call(tr);return go&&(kr?tr[la]=An:delete tr[la]),Un}(Lt):Ao.call(Lt)}function si(Lt){return Qo(Lt)&&Ll(Lt)==Ce}function xl(Lt,tr,kr,An,go){return Lt===tr||(null==Lt||null==tr||!Qo(Lt)&&!Qo(tr)?Lt!=Lt&&tr!=tr:function(Un,fo,uo,Sa,Ni,os){var Da=wu(Un),ca=wu(fo),Ca=Da?"[object Array]":fs(Un),Oa=ca?"[object Array]":fs(fo),Ja=(Ca=Ca==Ce?Gt:Ca)==Gt,zs=(Oa=Oa==Ce?Gt:Oa)==Gt,es=Ca==Oa;if(es&&Eu(Un)){if(!Eu(fo))return!1;Da=!0,Ja=!1}if(es&&!Ja)return os||(os=new Ri),Da||Ba(Un)?ms(Un,fo,uo,Sa,Ni,os):function(vo,Pi,Ka,Qs,ds,Go,Lo){switch(Ka){case"[object DataView]":if(vo.byteLength!=Pi.byteLength||vo.byteOffset!=Pi.byteOffset)return!1;vo=vo.buffer,Pi=Pi.buffer;case"[object ArrayBuffer]":return!(vo.byteLength!=Pi.byteLength||!Go(new Bo(vo),new Bo(Pi)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Fs(+vo,+Pi);case"[object Error]":return vo.name==Pi.name&&vo.message==Pi.message;case"[object RegExp]":case"[object String]":return vo==Pi+"";case Et:var Ol=xn;case et:if(Ol||(Ol=_o),vo.size!=Pi.size&&!(1&Qs))return!1;var hl=Lo.get(vo);if(hl)return hl==Pi;Qs|=2,Lo.set(vo,Pi);var So=ms(Ol(vo),Ol(Pi),Qs,ds,Go,Lo);return Lo.delete(vo),So;case"[object Symbol]":if(Ya)return Ya.call(vo)==Ya.call(Pi)}return!1}(Un,fo,Ca,uo,Sa,Ni,os);if(!(1&uo)){var cl=Ja&&gs.call(Un,"__wrapped__"),vs=zs&&gs.call(fo,"__wrapped__");if(cl||vs){var Ks=cl?Un.value():Un,Ul=vs?fo.value():fo;return os||(os=new Ri),Ni(Ks,Ul,uo,Sa,os)}}return!!es&&(os||(os=new Ri),function(vo,Pi,Ka,Qs,ds,Go){var Lo=1&Ka,Ol=Wa(vo),Ga=Ol.length;if(Ga!=Wa(Pi).length&&!Lo)return!1;for(var So=Ga;So--;){var Bi=Ol[So];if(!(Lo?Bi in Pi:gs.call(Pi,Bi)))return!1}var ea=Go.get(vo);if(ea&&Go.get(Pi))return ea==Pi;var ta=!0;Go.set(vo,Pi),Go.set(Pi,vo);for(var ha=Lo;++So<Ga;){var Ta=vo[Bi=Ol[So]],ra=Pi[Bi];if(Qs)var Bs=Lo?Qs(ra,Ta,Bi,Pi,vo,Go):Qs(Ta,ra,Bi,vo,Pi,Go);if(!(void 0===Bs?Ta===ra||ds(Ta,ra,Ka,Qs,Go):Bs)){ta=!1;break}ha||(ha="constructor"==Bi)}if(ta&&!ha){var Ei=vo.constructor,jo=Pi.constructor;Ei==jo||!("constructor"in vo)||!("constructor"in Pi)||"function"==typeof Ei&&Ei instanceof Ei&&"function"==typeof jo&&jo instanceof jo||(ta=!1)}return Go.delete(vo),Go.delete(Pi),ta}(Un,fo,uo,Sa,Ni,os))}(Lt,tr,kr,An,xl,go))}function ms(Lt,tr,kr,An,go,Un){var fo=1&kr,uo=Lt.length,Sa=tr.length;if(uo!=Sa&&!(fo&&Sa>uo))return!1;var Ni=Un.get(Lt);if(Ni&&Un.get(tr))return Ni==tr;var os=-1,Da=!0,ca=2&kr?new wa:void 0;for(Un.set(Lt,tr),Un.set(tr,Lt);++os<uo;){var Ca=Lt[os],Oa=tr[os];if(An)var Ja=fo?An(Oa,Ca,os,tr,Lt,Un):An(Ca,Oa,os,Lt,tr,Un);if(void 0!==Ja){if(Ja)continue;Da=!1;break}if(ca){if(!In(tr,function(zs,es){if(!ca.has(es)&&(Ca===zs||go(Ca,zs,kr,An,Un)))return ca.push(es)})){Da=!1;break}}else if(Ca!==Oa&&!go(Ca,Oa,kr,An,Un)){Da=!1;break}}return Un.delete(Lt),Un.delete(tr),Da}function Wa(Lt){return An=Ii,go=function Ua(Lt){return null!=(tr=Lt)&&za(tr.length)&&!ul(tr)?function vl(Lt,tr){var kr=wu(Lt),An=!kr&&_s(Lt),go=!kr&&!An&&Eu(Lt),Un=!kr&&!An&&!go&&Ba(Lt),fo=kr||An||go||Un,uo=fo?function(os,Da){for(var ca=-1,Ca=Array(os);++ca<os;)Ca[ca]=Da(ca);return Ca}(Lt.length,String):[],Sa=uo.length;for(var Ni in Lt)!tr&&!gs.call(Lt,Ni)||fo&&("length"==Ni||go&&("offset"==Ni||"parent"==Ni)||Un&&("buffer"==Ni||"byteLength"==Ni||"byteOffset"==Ni)||Bl(Ni,Sa))||uo.push(Ni);return uo}(Lt):function Dl(Lt){if(kr=(tr=Lt)&&tr.constructor,tr!==("function"==typeof kr&&kr.prototype||Xo))return ys(Lt);var tr,kr,go=[];for(var Un in Object(Lt))gs.call(Lt,Un)&&"constructor"!=Un&&go.push(Un);return go}(Lt);var tr}(tr=Lt),wu(tr)?go:function(Un,fo){for(var uo=-1,Sa=fo.length,Ni=Un.length;++uo<Sa;)Un[Ni+uo]=fo[uo];return Un}(go,An(tr));var tr,An,go}function uu(Lt,tr){var kr,An,go=Lt.__data__;return("string"==(An=typeof(kr=tr))||"number"==An||"symbol"==An||"boolean"==An?"__proto__"!==kr:null===kr)?go["string"==typeof tr?"string":"hash"]:go.map}function Ea(Lt,tr){var kr=Lt?.[tr];return function wn(Lt){return!(!Ha(Lt)||(tr=Lt,Js&&Js in tr))&&(ul(Lt)?qi:Bt).test(Is(Lt));var tr}(kr)?kr:void 0}ll.prototype.clear=function(){this.__data__=lo?lo(null):{},this.size=0},ll.prototype.delete=function(Lt){var tr=this.has(Lt)&&delete this.__data__[Lt];return this.size-=tr?1:0,tr},ll.prototype.get=function(Lt){var tr=this.__data__;if(lo){var kr=tr[Lt];return"__lodash_hash_undefined__"===kr?void 0:kr}return gs.call(tr,Lt)?tr[Lt]:void 0},ll.prototype.has=function(Lt){var tr=this.__data__;return lo?void 0!==tr[Lt]:gs.call(tr,Lt)},ll.prototype.set=function(Lt,tr){var kr=this.__data__;return this.size+=this.has(Lt)?0:1,kr[Lt]=lo&&void 0===tr?"__lodash_hash_undefined__":tr,this},ba.prototype.clear=function(){this.__data__=[],this.size=0},ba.prototype.delete=function(Lt){var tr=this.__data__,kr=Uo(tr,Lt);return!(kr<0||(kr==tr.length-1?tr.pop():lu.call(tr,kr,1),--this.size,0))},ba.prototype.get=function(Lt){var tr=this.__data__,kr=Uo(tr,Lt);return kr<0?void 0:tr[kr][1]},ba.prototype.has=function(Lt){return Uo(this.__data__,Lt)>-1},ba.prototype.set=function(Lt,tr){var kr=this.__data__,An=Uo(kr,Lt);return An<0?(++this.size,kr.push([Lt,tr])):kr[An][1]=tr,this},ni.prototype.clear=function(){this.size=0,this.__data__={hash:new ll,map:new($o||ba),string:new ll}},ni.prototype.delete=function(Lt){var tr=uu(this,Lt).delete(Lt);return this.size-=tr?1:0,tr},ni.prototype.get=function(Lt){return uu(this,Lt).get(Lt)},ni.prototype.has=function(Lt){return uu(this,Lt).has(Lt)},ni.prototype.set=function(Lt,tr){var kr=uu(this,Lt),An=kr.size;return kr.set(Lt,tr),this.size+=kr.size==An?0:1,this},wa.prototype.add=wa.prototype.push=function(Lt){return this.__data__.set(Lt,"__lodash_hash_undefined__"),this},wa.prototype.has=function(Lt){return this.__data__.has(Lt)},Ri.prototype.clear=function(){this.__data__=new ba,this.size=0},Ri.prototype.delete=function(Lt){var tr=this.__data__,kr=tr.delete(Lt);return this.size=tr.size,kr},Ri.prototype.get=function(Lt){return this.__data__.get(Lt)},Ri.prototype.has=function(Lt){return this.__data__.has(Lt)},Ri.prototype.set=function(Lt,tr){var kr=this.__data__;if(kr instanceof ba){var An=kr.__data__;if(!$o||An.length<199)return An.push([Lt,tr]),this.size=++kr.size,this;kr=this.__data__=new ni(An)}return kr.set(Lt,tr),this.size=kr.size,this};var Ii=ku?function(Lt){return null==Lt?[]:(Lt=Object(Lt),function(tr,kr){for(var An=-1,go=null==tr?0:tr.length,Un=0,fo=[];++An<go;){var uo=tr[An];kr(uo)&&(fo[Un++]=uo)}return fo}(ku(Lt),function(tr){return ps.call(Lt,tr)}))}:function(){return[]},fs=Ll;function Bl(Lt,tr){return!!(tr=tr??9007199254740991)&&("number"==typeof Lt||br.test(Lt))&&Lt>-1&&Lt%1==0&&Lt<tr}function Is(Lt){if(null!=Lt){try{return _l.call(Lt)}catch{}try{return Lt+""}catch{}}return""}function Fs(Lt,tr){return Lt===tr||Lt!=Lt&&tr!=tr}(sl&&"[object DataView]"!=fs(new sl(new ArrayBuffer(1)))||$o&&fs(new $o)!=Et||Fa&&"[object Promise]"!=fs(Fa.resolve())||La&&fs(new La)!=et||Wl&&"[object WeakMap]"!=fs(new Wl))&&(fs=function(Lt){var tr=Ll(Lt),kr=tr==Gt?Lt.constructor:void 0,An=kr?Is(kr):"";if(An)switch(An){case _n:return"[object DataView]";case Al:return Et;case wi:return"[object Promise]";case ua:return et;case xa:return"[object WeakMap]"}return tr});var _s=si(function(){return arguments}())?si:function(Lt){return Qo(Lt)&&gs.call(Lt,"callee")&&!ps.call(Lt,"callee")},wu=Array.isArray,Eu=Yu||function(){return!1};function ul(Lt){if(!Ha(Lt))return!1;var tr=Ll(Lt);return"[object Function]"==tr||"[object GeneratorFunction]"==tr||"[object AsyncFunction]"==tr||"[object Proxy]"==tr}function za(Lt){return"number"==typeof Lt&&Lt>-1&&Lt%1==0&&Lt<=9007199254740991}function Ha(Lt){var tr=typeof Lt;return null!=Lt&&("object"==tr||"function"==tr)}function Qo(Lt){return null!=Lt&&"object"==typeof Lt}var Lt,Ba=nn?(Lt=nn,function(tr){return Lt(tr)}):function(Lt){return Qo(Lt)&&za(Lt.length)&&!!wr[Ll(Lt)]};R.exports=function(Lt,tr){return xl(Lt,tr)}}),zl={Polygon:ti,LineString:Cn,Point:Lr,MultiPolygon:di,MultiLineString:di,MultiPoint:di};var Hs=function(R,W){var Ce={options:R=function(Gt){void 0===Gt&&(Gt={});var et=Wo(Gt);return Gt.controls||(et.controls={}),et.controls=Wo(!1===Gt.displayControlsDefault?hi:Ws,Gt.controls),(et=Wo(ai,et)).styles=ri(et.styles,"cold").concat(ri(et.styles,"hot")),et}(R)};W=function $n(R,W){return W.modes=Ae,W.getFeatureIdsAt=function(Ce){return ve.click({point:Ce},null,R).map(function(Et){return Et.properties.id})},W.getSelectedIds=function(){return R.store.getSelectedIds()},W.getSelected=function(){return{type:Ee,features:R.store.getSelectedIds().map(function(Ce){return R.store.get(Ce)}).map(function(Ce){return Ce.toGeoJSON()})}},W.getSelectedPoints=function(){return{type:Ee,features:R.store.getSelectedCoordinates().map(function(Ce){return{type:re,properties:{},geometry:{type:Ze,coordinates:Ce.coordinates}}})}},W.set=function(Ce){if(void 0===Ce.type||Ce.type!==Ee||!Array.isArray(Ce.features))throw new Error("Invalid FeatureCollection");var Et=R.store.createRenderBatch(),Gt=R.store.getAllIds().slice(),et=W.add(Ce),Bt=new Se(et);return(Gt=Gt.filter(function(br){return!Bt.has(br)})).length&&W.delete(Gt),Et(),et},W.add=function(Ce){var Et=JSON.parse(JSON.stringify(hn(Ce))).features.map(function(Gt){if(Gt.id=Gt.id||En(),null===Gt.geometry)throw new Error("Invalid geometry: null");if(void 0===R.store.get(Gt.id)||R.store.get(Gt.id).type!==Gt.geometry.type){var et=zl[Gt.geometry.type];if(void 0===et)throw new Error("Invalid geometry type: "+Gt.geometry.type+".");var Bt=new et(R,Gt);R.store.add(Bt)}else{var br=R.store.get(Gt.id);br.properties=Gt.properties,va(br.getCoordinates(),Gt.geometry.coordinates)||br.incomingCoords(Gt.geometry.coordinates)}return Gt.id});return R.store.render(),Et},W.get=function(Ce){var Et=R.store.get(Ce);if(Et)return Et.toGeoJSON()},W.getAll=function(){return{type:Ee,features:R.store.getAll().map(function(Ce){return Ce.toGeoJSON()})}},W.delete=function(Ce){return R.store.delete(Ce,{silent:!0}),W.getMode()!==Ae.DIRECT_SELECT||R.store.getSelectedIds().length?R.store.render():R.events.changeMode(Ae.SIMPLE_SELECT,void 0,{silent:!0}),W},W.deleteAll=function(){return R.store.delete(R.store.getAllIds(),{silent:!0}),W.getMode()===Ae.DIRECT_SELECT?R.events.changeMode(Ae.SIMPLE_SELECT,void 0,{silent:!0}):R.store.render(),W},W.changeMode=function(Ce,Et){return void 0===Et&&(Et={}),Ce===Ae.SIMPLE_SELECT&&W.getMode()===Ae.SIMPLE_SELECT?(Gt=Et.featureIds||[],et=R.store.getSelectedIds(),Gt.length===et.length&&JSON.stringify(Gt.map(function(Bt){return Bt}).sort())===JSON.stringify(et.map(function(Bt){return Bt}).sort())||(R.store.setSelected(Et.featureIds,{silent:!0}),R.store.render()),W):(Ce===Ae.DIRECT_SELECT&&W.getMode()===Ae.DIRECT_SELECT&&Et.featureId===R.store.getSelectedIds()[0]||R.events.changeMode(Ce,Et,{silent:!0}),W);var Gt,et},W.getMode=function(){return R.events.getMode()},W.trash=function(){return R.events.trash({silent:!0}),W},W.combineFeatures=function(){return R.events.combineFeatures({silent:!0}),W},W.uncombineFeatures=function(){return R.events.uncombineFeatures({silent:!0}),W},W.setFeatureProperty=function(Ce,Et,Gt){return R.store.setFeatureProperty(Ce,Et,Gt),W},W}(Ce,W),Ce.api=W;var Et=aa(Ce);return W.onAdd=Et.onAdd,W.onRemove=Et.onRemove,W.types=he,W.options=R,W};function Eo(R){Hs(R,this)}return Eo.modes=Vn,Eo}()},2564:(Mt,Ye,ue)=>{"use strict";var ae=ue(9652).x0;function pe(b){this.origin=b.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=b.accessToken,this.version="0.2.0",this.sessionID=this.generateSessionID(),this.userAgent=this.getUserAgent(),this.options=b,this.send=this.send.bind(this),this.countries=b.countries?b.countries.split(","):null,this.types=b.types?b.types.split(","):null,this.bbox=b.bbox?b.bbox:null,this.language=b.language?b.language.split(","):null,this.limit=b.limit?+b.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(b),this.eventQueue=new Array,this.flushInterval=b.flushInterval||1e3,this.maxQueueSize=b.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}pe.prototype={select:function(b,c){var Z=this.getSelectedIndex(b,c),ce=this.getEventPayload("search.select",c);if(ce.resultIndex=Z,ce.resultPlaceName=b.place_name,ce.resultId=b.id,(Z!==this.lastSentIndex||ce.queryString!==this.lastSentInput)&&-1!=Z&&(this.lastSentIndex=Z,this.lastSentInput=ce.queryString,ce.queryString))return this.push(ce)},start:function(b){var c=this.getEventPayload("search.start",b);if(c.queryString)return this.push(c)},keyevent:function(b,c){if(b.key&&!b.metaKey&&-1===[9,27,37,39,13,38,40].indexOf(b.keyCode)){var Z=this.getEventPayload("search.keystroke",c);if(Z.lastAction=b.key,Z.queryString)return this.push(Z)}},send:function(b,c){if(!this.enableEventLogging)return c?c():void 0;var Z=this.getRequestOptions(b);this.request(Z,function(ce){return ce?this.handleError(ce,c):c?c():void 0}.bind(this))},getRequestOptions:function(b){return Array.isArray(b)||(b=[b]),{method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(b)}},getEventPayload:function(b,c){var Z;Z=c.options.proximity?"object"==typeof c.options.proximity?[c.options.proximity.longitude,c.options.proximity.latitude]:"ip"===c.options.proximity?[999,999]:c.options.proximity:null;var ce=c._map?c._map.getZoom():void 0,be={event:b,created:+new Date,sessionIdentifier:this.sessionID,country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:c.options.autocomplete,fuzzyMatch:c.options.fuzzyMatch,proximity:Z,limit:c.options.limit,routing:c.options.routing,worldview:c.options.worldview,mapZoom:ce,keyboardLocale:this.locale};return be.queryString="search.select"===b?c.inputString:"search.select"!=b&&c._inputEl?c._inputEl.value:c.inputString,be},request:function(b,c){var Z=new XMLHttpRequest;for(var ce in Z.onreadystatechange=function(){if(4==this.readyState)return c(204==this.status?null:this.statusText)},Z.open(b.method,b.host+"/"+b.path,!0),b.headers)Z.setRequestHeader(ce,b.headers[ce]);Z.send(b.body)},handleError:function(b,c){if(c)return c(b)},generateSessionID:function(){return ae()},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(b,c){if(c._typeahead){var ce=b.id;return c._typeahead.data.map(function(Te){return Te.id}).indexOf(ce)}},shouldEnableLogging:function(b){return!(!1===b.enableEventLogging||b.origin&&"https://api.mapbox.com"!==b.origin||b.localGeocoder||b.filter)},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(b,c){this.eventQueue.push(b),(this.eventQueue.length>=this.maxQueueSize||c)&&this.flush()},remove:function(){this.flush()}},Mt.exports=pe},3424:Mt=>{Mt.exports={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}},3569:Mt=>{function Ye(){}Ye.prototype={isSupport:function(){return Boolean(window.navigator.geolocation)},getCurrentPosition:function(){const ue={enableHighAccuracy:!0};return new Promise(function(ae,pe){window.navigator.geolocation.getCurrentPosition(ae,pe,ue)})}},Mt.exports=Ye},8545:(Mt,Ye,ue)=>{"use strict";var ae=ue(5562),pe=ue(3082),b=ue(4703),c=ue(9069).EventEmitter,Z=ue(3424),ce=ue(9471),be=ue(7075),ye=ue(2564),Te=ue(1753),$e=ue(6775),xe=ue(3569),ge=ue(5583);function H(q){this._eventEmitter=new c,this.options=b({},this.options,q),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new xe}H.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(q){return q.place_name},render:function(q){var K=q.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+K[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+K.splice(1,K.length).join(",")+"</div></div>"}},addTo:function(q){function K(X,ee){if(!document.body.contains(ee))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const ie=X.onAdd();ee.appendChild(ie)}if(q._controlContainer)q.addControl(this);else if(q instanceof HTMLElement)K(this,q);else{if("string"!=typeof q)throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element");{const X=document.querySelectorAll(q);if(0===X.length)throw new Error("Element ",q,"not found.");if(X.length>1)throw new Error("Geocoder can only be added to a single html element");K(this,X[0])}}},onAdd:function(q){if(q&&"string"!=typeof q&&(this._map=q),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=be(ce({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new ye(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var K=this.container=document.createElement("div");K.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var X=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",pe(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",function(nt){this.eventManager.keyevent(nt,this)}.bind(this));var ee=document.createElement("div");ee.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var ie=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild(ie),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),ee.appendChild(this._clearEl),ee.appendChild(this._loadingEl),K.appendChild(X),K.appendChild(this._inputEl),K.appendChild(ee),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var ne=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(ne),ee.appendChild(this._geolocateEl),this._showGeolocateButton()}var se=this._typeahead=new ae(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),se.getItemValue=this.options.getItemValue;var he=se.list.draw,re=this._footerNode=function We(){var q=document.createElement("div");return q.className="mapboxgl-ctrl-geocoder--powered-by",q.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',q}();return se.list.draw=function(){he.call(this),re.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),re.addEventListener("mouseup",function(){this.selectingListItem=!1}.bind(this)),this.element.appendChild(re)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),K},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then(function(q){this._hideLoadingIcon();const K={geometry:{type:"Point",coordinates:[q.coords.longitude,q.coords.latitude]}};this._handleMarker(K),this._fly(K),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(K),this._showClearButton(),this.fresh=!1;const X={limit:1,language:[this.options.language],query:K.geometry.coordinates,types:["address"]};this.options.localGeocoderOnly?(this._setInputValue(K.geometry.coordinates[0]+","+K.geometry.coordinates[1]),this._eventEmitter.emit("result",{result:K})):this.geocoderService.reverseGeocode(X).send().then(function(ee){const ie=ee.body.features[0];if(ie){const ne=ge.transformFeatureToGeolocationText(ie,this.options.addressAccuracy);this._setInputValue(ne),ie.user_coordinates=K.geometry.coordinates,this._eventEmitter.emit("result",{result:ie})}else this._eventEmitter.emit("result",{result:{user_coordinates:K.geometry.coordinates}})}.bind(this))}.bind(this)).catch(function(q){1===q.code?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}.bind(this))},createIcon:function(q,K){var X=document.createElementNS("http://www.w3.org/2000/svg","svg");return X.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+q),X.setAttribute("viewBox","0 0 18 18"),X.setAttribute("xml:space","preserve"),X.setAttribute("width",18),X.setAttribute("height",18),X.innerHTML=K,X},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(q){this._inputEl.value=q,setTimeout(function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}.bind(this),1)},_onPaste:function(q){var K=(q.clipboardData||window.clipboardData).getData("text");K.length>=this.options.minLength&&this._geocode(K)},_onKeyDown:function(q){var K=27,X=9;if(q.keyCode===K&&this.options.clearAndBlurOnEsc)return this._clear(q),this._inputEl.blur();var ee=q.target&&q.target.shadowRoot?q.target.shadowRoot.activeElement:q.target;if(!ee||!ee.value)return this.fresh=!0,q.keyCode!==X&&this.clear(q),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!q.metaKey&&-1===[X,K,37,39,13,38,40].indexOf(q.keyCode)&&ee.value.length>=this.options.minLength&&this._geocode(ee.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(q){this.options.clearOnBlur&&this._clearOnBlur(q),this.options.collapsed&&this._collapse()},_onChange:function(){var q=this._typeahead.selected;q&&JSON.stringify(q)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(q),this.options.marker&&this._mapboxgl&&this._handleMarker(q),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(q),this._eventEmitter.emit("result",{result:q}),this.eventManager.select(q,this))},_fly:function(q){var K;if(q.properties&&Z[q.properties.short_code])K=b({},this.options.flyTo),this._map&&this._map.fitBounds(Z[q.properties.short_code].bbox,K);else if(q.bbox){var X=q.bbox;K=b({},this.options.flyTo),this._map&&this._map.fitBounds([[X[0],X[1]],[X[2],X[3]]],K)}else K=b({},{zoom:this.options.zoom},this.options.flyTo),q.center?K.center=q.center:q.geometry&&q.geometry.type&&"Point"===q.geometry.type&&q.geometry.coordinates&&(K.center=q.geometry.coordinates),this._map&&this._map.flyTo(K)},_requestType:function(q,K){return q.localGeocoderOnly?1:q.reverseGeocode&&ge.REVERSE_GEOCODE_COORD_RGX.test(K)?2:0},_setupConfig:function(q,K){const ee=/[\s,]+/;var ie=this,ne=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"].reduce(function(he,re){return null==ie.options[re]||(he[re]=["countries","types","language"].indexOf(re)>-1?ie.options[re].split(ee):ie.options[re],"proximity"===re&&"number"==typeof ie.options[re].longitude&&"number"==typeof ie.options[re].latitude&&(he[re]=[ie.options[re].longitude,ie.options[re].latitude])),he},{});switch(q){case 2:var se=K.split(ee).map(function(he){return parseFloat(he,10)});ie.options.flipCoordinates||se.reverse(),ne=b(ne,{query:se,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(he){he in ne&&delete ne[he]});break;case 0:{const he=K.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(he)&&(K=K.replace(/,/g," ")),ne=b(ne,{query:K})}}return ne},_geocode:function(q){this.inputString=q,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:q});const K=this._requestType(this.options,q),X=this._setupConfig(K,q);var ee;switch(K){case 1:ee=Promise.resolve();break;case 0:ee=this.geocoderService.forwardGeocode(X).send();break;case 2:ee=this.geocoderService.reverseGeocode(X).send()}var ie=this.options.localGeocoder&&this.options.localGeocoder(q)||[],ne=[],se=null;return ee.catch(function(he){se=he}.bind(this)).then(function(he){this._hideLoadingIcon();var re={};return he?"200"==he.statusCode&&((re=he.body).request=he.request,re.headers=he.headers):re={type:"FeatureCollection",features:[]},re.config=X,this.fresh&&(this.eventManager.start(this),this.fresh=!1),re.features=re.features?ie.concat(re.features):ie,this.options.externalGeocoder?(ne=this.options.externalGeocoder(q,re.features)||Promise.resolve([])).then(function(nt){return re.features=re.features?nt.concat(re.features):nt,re},function(){return re}):re}.bind(this)).then(function(he){if(se)throw se;this.options.filter&&he.features.length&&(he.features=he.features.filter(this.options.filter)),he.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",he),this._typeahead.update(he.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",he))}.bind(this)).catch(function(he){this._hideLoadingIcon(),this._hideAttribution(),ie.length&&this.options.localGeocoder||ne.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update(ie)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:ie}),this._eventEmitter.emit("error",{error:he})}.bind(this)),ee},_clear:function(q){q&&q.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(q){this._clear(q),this._inputEl.focus()},_clearOnBlur:function(q){q.relatedTarget&&this._clear(q)},_onQueryResult:function(q){var K=q.body;if(K.features.length){var X=K.features[0];this._typeahead.selected=X,this._inputEl.value=X.place_name,this._onChange()}},_updateProximity:function(){if(this._map&&this.options.trackProximity)if(this._map.getZoom()>9){var q=this._map.getCenter().wrap();this.setProximity({longitude:q.lng,latitude:q.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(q){return this._geocode(q).then(this._onQueryResult),this},_renderError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>")},_renderLocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>")},_renderNoResults:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>")},_renderUserDeniedGeolocationError:function(){this._renderMessage("<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>")},_renderMessage:function(q){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(q)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var q=this.options.language.split(",")[0],K=$e.language(q),X=Te.placeholder[K];if(X)return X}return"Search"},setInput:function(q){return this._inputEl.value=q,this._typeahead.selected=null,this._typeahead.clear(),q.length>=this.options.minLength&&this._geocode(q),this},setProximity:function(q,K=!0){return this.options.proximity=q,K&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(q){return q&&"function"==typeof q&&(this._typeahead.render=q),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(q){var K=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=q||this.options.language||K,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(q){return this.options.zoom=q,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(q){return this.options.flyTo=q,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(q){return this.placeholder=q||this._getPlaceholderText(),this._inputEl.placeholder=this.placeholder,this._inputEl.setAttribute("aria-label",this.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(q){return this.options.bbox=q,this},getCountries:function(){return this.options.countries},setCountries:function(q){return this.options.countries=q,this},getTypes:function(){return this.options.types},setTypes:function(q){return this.options.types=q,this},getMinLength:function(){return this.options.minLength},setMinLength:function(q){return this.options.minLength=q,this._typeahead&&(this._typeahead.options.minLength=q),this},getLimit:function(){return this.options.limit},setLimit:function(q){return this.options.limit=q,this._typeahead&&(this._typeahead.options.limit=q),this},getFilter:function(){return this.options.filter},setFilter:function(q){return this.options.filter=q,this},setOrigin:function(q){return this.options.origin=q,this.geocoderService=be(ce({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(q){return this.options.accessToken=q,this.geocoderService=be(ce({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(q){return this.options.autocomplete=q,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(q){return this.options.fuzzyMatch=q,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(q){return this.options.routing=q,this},getRouting:function(){return this.options.routing},setWorldview:function(q){return this.options.worldview=q,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(q){if(this._map){this._removeMarker();var X=b({},{color:"#4668F2"},this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(X),q.center?this.mapMarker.setLngLat(q.center).addTo(this._map):q.geometry&&q.geometry.type&&"Point"===q.geometry.type&&q.geometry.coordinates&&this.mapMarker.setLngLat(q.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(q,K){return this._eventEmitter.on(q,K),this},off:function(q,K){return this._eventEmitter.removeListener(q,K),this.eventManager.remove(),this}},Mt.exports=H},1753:Mt=>{"use strict";Mt.exports={placeholder:{de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"\u05dc\u05d7\u05e4\u05e9",ja:"\u30b5\u30fc\u30c1",lv:"Mekl\u0113t",pt:"Procurar",sr:"\u041f\u0440\u0435\u0442\u0440\u0430\u0433\u0430",zh:"\u641c\u7d22",cs:"Vyhled\xe1v\xe1n\xed",hu:"Keres\xe9s",ka:"\u10eb\u10d8\u10d4\u10d1\u10d0",nb:"S\xf8ke",sk:"Vyh\u013ead\xe1vanie",th:"\u0e04\u0e49\u0e19\u0e2b\u0e32",fi:"Hae",is:"Leita",ko:"\uc218\uc0c9",pl:"Szukaj",sl:"Iskanje",fa:"\u062c\u0633\u062a\u062c\u0648",ru:"\u041f\u043e\u0438\u0441\u043a"}}},5583:Mt=>{function ue(pe){const b=pe.address||"",c=pe.text||"",Z=pe.place_name||"",be={address:Z.split(",")[0],houseNumber:b,street:c,placeName:Z};return pe.context.forEach(function(ye){const Te=ye.id.split(".")[0];be[Te]=ye.text}),be}Mt.exports={transformFeatureToGeolocationText:function Ye(pe,b){const c=ue(pe),Z=["address","street","place","country"];if("function"==typeof b)return b(c);const be=Z.indexOf(b);return(-1===be?Z:Z.slice(be)).reduce(function(ye,Te){return c[Te]?(""!==ye&&(ye+=", "),ye+c[Te]):ye},"")},getAddressInfo:ue,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/}},9471:(Mt,Ye,ue)=>{"use strict";var ae=ue(7454);Mt.exports=ae},7454:(Mt,Ye,ue)=>{"use strict";var ae=ue(753),pe=ue(4176);function b(Z){pe.call(this,Z)}(b.prototype=Object.create(pe.prototype)).constructor=b,b.prototype.sendRequest=ae.browserSend,b.prototype.abortRequest=ae.browserAbort,Mt.exports=function c(Z){return new b(Z)}},753:(Mt,Ye,ue)=>{"use strict";var ae=ue(4332),pe=ue(6158),b=ue(9719),c=ue(8829),Z={};function ye(ge){var Oe=ge.total,We=ge.loaded;return{total:Oe,transferred:We,percent:100*We/Oe}}function Te(ge,Oe){return new Promise(function(We,H){Oe.onprogress=function(X){ge.emitter.emit(b.EVENT_PROGRESS_DOWNLOAD,ye(X))};var q=ge.file;q&&(Oe.upload.onprogress=function(X){ge.emitter.emit(b.EVENT_PROGRESS_UPLOAD,ye(X))}),Oe.onerror=function(X){H(X)},Oe.onabort=function(){var X=new pe({request:ge,type:b.ERROR_REQUEST_ABORTED});H(X)},Oe.onload=function(){if(delete Z[ge.id],Oe.status<200||Oe.status>=400){var X=new pe({request:ge,body:Oe.response,statusCode:Oe.status});H(X)}else We(Oe)};var K=ge.body;"string"==typeof K?Oe.send(K):K?Oe.send(JSON.stringify(K)):q?Oe.send(q):Oe.send(),Z[ge.id]=Oe}).then(function(We){return function be(ge,Oe){return new ae(ge,{body:Oe.response,headers:c(Oe.getAllResponseHeaders()),statusCode:Oe.status})}(ge,We)})}function $e(ge,Oe){var We=ge.url(Oe),H=new window.XMLHttpRequest;return H.open(ge.method,We),Object.keys(ge.headers).forEach(function(q){H.setRequestHeader(q,ge.headers[q])}),H}Mt.exports={browserAbort:function ce(ge){var Oe=Z[ge.id];!Oe||(Oe.abort(),delete Z[ge.id])},sendRequestXhr:Te,browserSend:function xe(ge){return Promise.resolve().then(function(){var Oe=$e(ge,ge.client.accessToken);return Te(ge,Oe)})},createRequestXhr:$e}},4176:(Mt,Ye,ue)=>{"use strict";var ae=ue(8129),pe=ue(4538),b=ue(9719);function c(Z){if(!Z||!Z.accessToken)throw new Error("Cannot create a client without an access token");ae(Z.accessToken),this.accessToken=Z.accessToken,this.origin=Z.origin||b.API_ORIGIN}c.prototype.createRequest=function(ce){return new pe(this,ce)},Mt.exports=c},6158:(Mt,Ye,ue)=>{"use strict";var ae=ue(9719);Mt.exports=function pe(b){var Z,c=b.type||ae.ERROR_HTTP;if(b.body)try{Z=JSON.parse(b.body)}catch{Z=b.body}else Z=null;var ce=b.message||null;ce||("string"==typeof Z?ce=Z:Z&&"string"==typeof Z.message?ce=Z.message:c===ae.ERROR_REQUEST_ABORTED&&(ce="Request aborted")),this.message=ce,this.type=c,this.statusCode=b.statusCode||null,this.request=b.request,this.body=Z}},4538:(Mt,Ye,ue)=>{"use strict";var ae=ue(8129),pe=ue(4703),b=ue(6661),c=ue(3449),Z=ue(9719),ce=1;function be(ye,Te){if(!ye)throw new Error("MapiRequest requires a client");if(!Te||!Te.path||!Te.method)throw new Error("MapiRequest requires an options object with path and method properties");var $e={};Te.body&&($e["content-type"]="application/json");var xe=pe($e,Te.headers),ge=Object.keys(xe).reduce(function(Oe,We){return Oe[We.toLowerCase()]=xe[We],Oe},{});this.id=ce++,this._options=Te,this.emitter=new b,this.client=ye,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=Te.path,this.method=Te.method,this.origin=Te.origin||ye.origin,this.query=Te.query||{},this.params=Te.params||{},this.body=Te.body||null,this.file=Te.file||null,this.encoding=Te.encoding||"utf8",this.sendFileAs=Te.sendFileAs||null,this.headers=ge}be.prototype.url=function(Te){var $e=c.prependOrigin(this.path,this.origin);$e=c.appendQueryObject($e,this.query);var xe=this.params,ge=Te??this.client.accessToken;if(ge){$e=c.appendQueryParam($e,"access_token",ge);var Oe=ae(ge).user;xe=pe({ownerId:Oe},xe)}return c.interpolateRouteParams($e,xe)},be.prototype.send=function(){var Te=this;if(Te.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return Te.sent=!0,Te.client.sendRequest(Te).then(function($e){return Te.response=$e,Te.emitter.emit(Z.EVENT_RESPONSE,$e),$e},function($e){throw Te.error=$e,Te.emitter.emit(Z.EVENT_ERROR,$e),$e})},be.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},be.prototype.eachPage=function(Te){var $e=this;function xe(We){Te(null,We,function H(){delete $e._nextPageRequest;var q=We.nextPage();q&&($e._nextPageRequest=q,Oe(q))})}function ge(We){Te(We,null,function(){})}function Oe(We){We.send().then(xe,ge)}Oe(this)},be.prototype.clone=function(){return this._extend()},be.prototype._extend=function(Te){var $e=pe(this._options,Te);return new be(this.client,$e)},Mt.exports=be},4332:(Mt,Ye,ue)=>{"use strict";var ae=ue(5699);function pe(b,c){this.request=b,this.headers=c.headers,this.rawBody=c.body,this.statusCode=c.statusCode;try{this.body=JSON.parse(c.body||"{}")}catch{this.body=c.body}this.links=ae(this.headers.link)}pe.prototype.hasNextPage=function(){return!!this.links.next},pe.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},Mt.exports=pe},9719:Mt=>{"use strict";Mt.exports={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}},8829:Mt=>{"use strict";Mt.exports=function ue(ae){var pe={};return ae&&ae.trim().split(/[\r|\n]+/).forEach(function(b){var c=function Ye(ae){var pe=ae.indexOf(":");return{name:ae.substring(0,pe).trim().toLowerCase(),value:ae.substring(pe+1).trim()}}(b);pe[c.name]=c.value}),pe}},5699:Mt=>{"use strict";Mt.exports=function ae(pe){return pe?pe.split(/,\s*</).reduce(function(b,c){var Z=function ue(pe){var b=pe.match(/<?([^>]*)>(.*)/);if(!b)return null;var c=b[1],Z=b[2].split(";"),ce=null,be=Z.reduce(function(ye,Te){var $e=function Ye(pe){var b=pe.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return b?{key:b[1],value:b[2]}:null}(Te);return $e?"rel"===$e.key?(ce||(ce=$e.value),ye):(ye[$e.key]=$e.value,ye):ye},{});return ce?{url:c,rel:ce,params:be}:null}(c);return Z?(Z.rel.split(/\s+/).forEach(function(be){b[be]||(b[be]={url:Z.url,params:Z.params})}),b):b},{}):{}}},3449:Mt=>{"use strict";function ue(Z){return Array.isArray(Z)?function Ye(Z){return Z.map(encodeURIComponent).join(",")}(Z):encodeURIComponent(String(Z))}function ae(Z,ce,be){if(!1===be||null===be)return Z;var ye=/\?/.test(Z)?"&":"?",Te=encodeURIComponent(ce);return void 0!==be&&""!==be&&!0!==be&&(Te+="="+ue(be)),""+Z+ye+Te}Mt.exports={appendQueryObject:function pe(Z,ce){if(!ce)return Z;var be=Z;return Object.keys(ce).forEach(function(ye){var Te=ce[ye];void 0!==Te&&(Array.isArray(Te)&&(Te=Te.filter(function($e){return null!=$e}).join(",")),be=ae(be,ye,Te))}),be},appendQueryParam:ae,prependOrigin:function b(Z,ce){if(!ce||"http"===Z.slice(0,4))return Z;var be="/"===Z[0]?"":"/";return""+ce.replace(/\/$/,"")+be+Z},interpolateRouteParams:function c(Z,ce){return ce?Z.replace(/\/:([a-zA-Z0-9]+)/g,function(be,ye){var Te=ce[ye];if(void 0===Te)throw new Error("Unspecified route parameter "+ye);return"/"+ue(Te)}):Z}}},6661:Mt=>{"use strict";var Ye=Object.prototype.hasOwnProperty,ue="~";function ae(){}function pe(ce,be,ye){this.fn=ce,this.context=be,this.once=ye||!1}function b(ce,be,ye,Te,$e){if("function"!=typeof ye)throw new TypeError("The listener must be a function");var xe=new pe(ye,Te||ce,$e),ge=ue?ue+be:be;return ce._events[ge]?ce._events[ge].fn?ce._events[ge]=[ce._events[ge],xe]:ce._events[ge].push(xe):(ce._events[ge]=xe,ce._eventsCount++),ce}function c(ce,be){0==--ce._eventsCount?ce._events=new ae:delete ce._events[be]}function Z(){this._events=new ae,this._eventsCount=0}Object.create&&(ae.prototype=Object.create(null),(new ae).__proto__||(ue=!1)),Z.prototype.eventNames=function(){var ye,Te,be=[];if(0===this._eventsCount)return be;for(Te in ye=this._events)Ye.call(ye,Te)&&be.push(ue?Te.slice(1):Te);return Object.getOwnPropertySymbols?be.concat(Object.getOwnPropertySymbols(ye)):be},Z.prototype.listeners=function(be){var Te=this._events[ue?ue+be:be];if(!Te)return[];if(Te.fn)return[Te.fn];for(var $e=0,xe=Te.length,ge=new Array(xe);$e<xe;$e++)ge[$e]=Te[$e].fn;return ge},Z.prototype.listenerCount=function(be){var Te=this._events[ue?ue+be:be];return Te?Te.fn?1:Te.length:0},Z.prototype.emit=function(be,ye,Te,$e,xe,ge){var Oe=ue?ue+be:be;if(!this._events[Oe])return!1;var q,K,We=this._events[Oe],H=arguments.length;if(We.fn){switch(We.once&&this.removeListener(be,We.fn,void 0,!0),H){case 1:return We.fn.call(We.context),!0;case 2:return We.fn.call(We.context,ye),!0;case 3:return We.fn.call(We.context,ye,Te),!0;case 4:return We.fn.call(We.context,ye,Te,$e),!0;case 5:return We.fn.call(We.context,ye,Te,$e,xe),!0;case 6:return We.fn.call(We.context,ye,Te,$e,xe,ge),!0}for(K=1,q=new Array(H-1);K<H;K++)q[K-1]=arguments[K];We.fn.apply(We.context,q)}else{var ee,X=We.length;for(K=0;K<X;K++)switch(We[K].once&&this.removeListener(be,We[K].fn,void 0,!0),H){case 1:We[K].fn.call(We[K].context);break;case 2:We[K].fn.call(We[K].context,ye);break;case 3:We[K].fn.call(We[K].context,ye,Te);break;case 4:We[K].fn.call(We[K].context,ye,Te,$e);break;default:if(!q)for(ee=1,q=new Array(H-1);ee<H;ee++)q[ee-1]=arguments[ee];We[K].fn.apply(We[K].context,q)}}return!0},Z.prototype.on=function(be,ye,Te){return b(this,be,ye,Te,!1)},Z.prototype.once=function(be,ye,Te){return b(this,be,ye,Te,!0)},Z.prototype.removeListener=function(be,ye,Te,$e){var xe=ue?ue+be:be;if(!this._events[xe])return this;if(!ye)return c(this,xe),this;var ge=this._events[xe];if(ge.fn)ge.fn===ye&&(!$e||ge.once)&&(!Te||ge.context===Te)&&c(this,xe);else{for(var Oe=0,We=[],H=ge.length;Oe<H;Oe++)(ge[Oe].fn!==ye||$e&&!ge[Oe].once||Te&&ge[Oe].context!==Te)&&We.push(ge[Oe]);We.length?this._events[xe]=1===We.length?We[0]:We:c(this,xe)}return this},Z.prototype.removeAllListeners=function(be){var ye;return be?this._events[ye=ue?ue+be:be]&&c(this,ye):(this._events=new ae,this._eventsCount=0),this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.addListener=Z.prototype.on,Z.prefixed=ue,Z.EventEmitter=Z,Mt.exports=Z},7075:(Mt,Ye,ue)=>{"use strict";var ae=ue(4703),pe=ue(9801),b=ue(4313),c=ue(1836),Z=ue(497),ce={},be=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];ce.forwardGeocode=function(ye){pe.assertShape({query:pe.required(pe.string),mode:pe.oneOf("mapbox.places","mapbox.places-permanent"),countries:pe.arrayOf(pe.string),proximity:pe.oneOf(pe.coordinates,"ip"),types:pe.arrayOf(pe.oneOf(be)),autocomplete:pe.boolean,bbox:pe.arrayOf(pe.number),limit:pe.number,language:pe.arrayOf(pe.string),routing:pe.boolean,fuzzyMatch:pe.boolean,worldview:pe.string})(ye),ye.mode=ye.mode||"mapbox.places";var Te=c(ae({country:ye.countries},b(ye,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:b(ye,["mode","query"]),query:Te})},ce.reverseGeocode=function(ye){pe.assertShape({query:pe.required(pe.coordinates),mode:pe.oneOf("mapbox.places","mapbox.places-permanent"),countries:pe.arrayOf(pe.string),types:pe.arrayOf(pe.oneOf(be)),bbox:pe.arrayOf(pe.number),limit:pe.number,language:pe.arrayOf(pe.string),reverseMode:pe.oneOf("distance","score"),routing:pe.boolean,worldview:pe.string})(ye),ye.mode=ye.mode||"mapbox.places";var Te=c(ae({country:ye.countries},b(ye,["country","types","bbox","limit","language","reverseMode","routing","worldview"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:b(ye,["mode","query"]),query:Te})},Mt.exports=Z(ce)},497:(Mt,Ye,ue)=>{"use strict";var ae=ue(4176),pe=ue(7454);Mt.exports=function b(c){return function(Z){var ce;ce=ae.prototype.isPrototypeOf(Z)?Z:pe(Z);var be=Object.create(c);return be.client=ce,be}}},5621:Mt=>{"use strict";Mt.exports=function Ye(ue,ae){return Object.keys(ue).reduce(function(pe,b){return pe[b]=ae(b,ue[b]),pe},{})}},4313:Mt=>{"use strict";Mt.exports=function Ye(ue,ae){var pe=function(b,c){return-1!==ae.indexOf(b)&&void 0!==c};return"function"==typeof ae&&(pe=ae),Object.keys(ue).filter(function(b){return pe(b,ue[b])}).reduce(function(b,c){return b[c]=ue[c],b},{})}},1836:(Mt,Ye,ue)=>{"use strict";var ae=ue(5621);Mt.exports=function pe(b){return ae(b,function(c,Z){return"boolean"==typeof Z?JSON.stringify(Z):Z})}},9801:(Mt,Ye,ue)=>{"use strict";var ae=ue(4703),pe=ue(6089);Mt.exports=ae(pe,{file:function b(be){return typeof window<"u"?be instanceof global.Blob||be instanceof global.ArrayBuffer?void 0:"Blob or ArrayBuffer":"string"!=typeof be&&void 0===be.pipe?"Filename or Readable stream":void 0},date:function Z(be){var ye="date";if("boolean"==typeof be)return ye;try{var Te=new Date(be);if(Te.getTime&&isNaN(Te.getTime()))return ye}catch{return ye}},coordinates:function ce(be){return pe.tuple(pe.number,pe.number)(be)},assertShape:function c(be,ye){return pe.assert(pe.strictShape(be),ye)}})},8129:(Mt,Ye,ue)=>{"use strict";var ae=ue(2049),pe={};function Z(ce,be){return Object.prototype.hasOwnProperty.call(ce,be)}Mt.exports=function b(ce){if(pe[ce])return pe[ce];var be=ce.split("."),ye=be[0],Te=be[1];if(!Te)throw new Error("Invalid token");var $e=function c(ce){try{return JSON.parse(ae.decode(ce))}catch{throw new Error("Invalid token")}}(Te),xe={usage:ye,user:$e.u};return Z($e,"a")&&(xe.authorization=$e.a),Z($e,"exp")&&(xe.expires=1e3*$e.exp),Z($e,"iat")&&(xe.created=1e3*$e.iat),Z($e,"scopes")&&(xe.scopes=$e.scopes),Z($e,"client")&&(xe.client=$e.client),Z($e,"ll")&&(xe.lastLogin=$e.ll),Z($e,"iu")&&(xe.impersonator=$e.iu),pe[ce]=xe,xe}},3054:(Mt,Ye,ue)=>{"use strict";ue.r(Ye),ue.d(Ye,{HomeModule:()=>i0});var ae=ue(6895),pe=ue(8996),b=ue(4650),c=ue(4006),Z=ue(5938);let ce=(()=>{class o{constructor(l,d){this.dialogRef=l,this.data=d,d&&(this.messageData=d.messageData)}ngOnInit(){}closeDialog(l){this.dialogRef.close(l)}}return o.\u0275fac=function(l){return new(l||o)(b.Y36(Z.so),b.Y36(Z.WI))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-confirm-box"]],decls:8,vars:1,consts:[[1,"p-flex","mt-3"],[1,"btn","btn-sm","btn-secondary","me-2",3,"click"],[1,"btn","btn-sm","btn-info","ms-2",3,"click"]],template:function(l,d){1&l&&(b.TgZ(0,"div")(1,"span"),b._uU(2),b.qZA(),b.TgZ(3,"div",0)(4,"button",1),b.NdJ("click",function(){return d.closeDialog(!1)}),b._uU(5,"No"),b.qZA(),b.TgZ(6,"button",2),b.NdJ("click",function(){return d.closeDialog(!0)}),b._uU(7,"Yes"),b.qZA()()()),2&l&&(b.xp6(2),b.Oqu(d.messageData))}}),o})();const be=function(){return{background:"red"}},ye=function(){return{"":""}};function Te(o,a){if(1&o){const l=b.EpF();b.TgZ(0,"span")(1,"img",1),b.NdJ("click",function(){const w=b.CHM(l).$implicit,C=b.oxw();return b.KtG(C.sendMarkerName(w))}),b.qZA()()}if(2&o){const l=a.$implicit,d=b.oxw();b.xp6(1),b.Q6J("ngStyle",l==d.activeMarker?b.DdM(2,be):b.DdM(3,ye))("src","../../../assets/marker-icons/all_maki_icons/svgs/"+l+".svg",b.LSH)}}let $e=(()=>{class o{constructor(l,d){this.dialogRef=l,this.data=d,this.markerList=["aerialway","landmark","airfield","landuse","airport","laundry","alcohol-shop","library","american-football","lighthouse-JP","amusement-park","lighthouse","aquarium","lodging","arrow","logging","art-gallery","marker-stroked","attraction","marker","bakery","mobile-phone","bank-JP","monument-JP","bank","monument","bar","mountain","barrier","museum","baseball","music","basketball","natural","bbq","observation-tower","beach","optician","beer","paint","bicycle-share","park-alt1","bicycle","park","blood-bank","parking-garage","bowling-alley","parking","bridge","pharmacy","building-alt1","picnic-site","building","pitch","bus","place-of-worship","cafe","playground","campsite","police-JP","car-rental","police","car-repair","post-JP","car","post","casino","prison","castle-JP","racetrack-boat","castle","racetrack-cycling","caution","racetrack-horse","cemetery-JP","racetrack","cemetery","rail-light","charging-station","rail-metro","cinema","rail","circle-stroked","ranger-station","circle","recycling","city","religious-buddhist","clothing-store","religious-christian","college-JP","religious-jewish","college","religious-muslim","commercial","religious-shinto","communications-tower","residential-community","confectionery","restaurant-bbq","construction","restaurant-noodle","convenience","restaurant-pizza","cricket","restaurant-seafood","cross","restaurant-sushi","dam","restaurant","danger","road-accident","defibrillator","roadblock","dentist","rocket","diamond","school-JP","doctor","school","dog-park","scooter","drinking-water","shelter","elevator","shoe","embassy","shop","emergency-phone","skateboard","entrance-alt1","skiing","entrance","slaughterhouse","farm","slipway","fast-food","snowmobile","fence","soccer","ferry-JP","square-stroked","ferry","square","fire-station-JP","stadium","fire-station","star-stroked","fitness-centre","star","florist","suitcase","fuel","swimming","furniture","table-tennis","gaming","teahouse","garden-centre","telephone","garden","tennis","gift","theatre","globe","toilet","golf","town-hall","grocery","town","hairdresser","triangle-stroked","harbor","triangle","hardware","veterinary","heart","viewpoint","heliport","village","highway-rest-area","volcano","home","volleyball","horse-riding","warehouse","hospital-JP","waste-basket","hospital","watch","hot-spring","\twater","ice-cream","waterfall","industry","watermill","information","wetland","jewelry-store","wheelchair","karaoke","windmill","landmark-JP","zoo"]}ngOnInit(){this.data&&(this.activeMarker=this.data.markerName)}sendMarkerName(l){this.dialogRef.close(l)}}return o.\u0275fac=function(l){return new(l||o)(b.Y36(Z.so),b.Y36(Z.WI))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-icon-list-dialog"]],decls:1,vars:1,consts:[[4,"ngFor","ngForOf"],["role","button","alt","",1,"p-2",3,"ngStyle","src","click"]],template:function(l,d){1&l&&b.YNc(0,Te,2,4,"span",0),2&l&&b.Q6J("ngForOf",d.markerList)},dependencies:[ae.sg,ae.PC],styles:["img[_ngcontent-%COMP%]:hover{background-color:#0ff}"]}),o})(),xe=(()=>{class o{constructor(){this.showIdentityFeatureStatus=new b.vpe,this.getIdentityFeatureData=new b.vpe}sendShowIdentityFeatureStatus(l){this.showIdentityFeatureStatus.emit(l)}sendIdentityFeatureData(l){this.getIdentityFeatureData.emit(l)}}return o.\u0275fac=function(l){return new(l||o)},o.\u0275prov=b.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var ge=ue(9898);let Oe=(()=>{class o{constructor(){this.getDataTableStatus=new b.vpe,this.getSourceData=new b.vpe,this.getStyleDetails=new b.vpe,this.popData=l=>{this.popUp.setLngLat([l.lngLat.lng,l.lngLat.lat]).setHTML(`<span style='${this.popUpStyle}'>${this.popUpMessage}</span>`).addTo(this.map)}}sendShowDataTableStatus(l){this.getDataTableStatus.emit(l)}sendSourceData(l){this.getSourceData.emit(l)}sendStyleDetails(l){this.getStyleDetails.emit(l)}initializeMapPopUp(){this.popUp=new ge.Popup({closeButton:!1,closeOnClick:!1})}useMapPopUp(l,d,v=""){this.map=l,this.popUpStyle=v,this.popUpMessage=d,l.on("mousemove",this.popData),l.on("mouseout",()=>{this.popUp.remove()})}removeMapPopUp(){this.map.off("mousemove",this.popData),this.popUp.remove()}}return o.\u0275fac=function(l){return new(l||o)},o.\u0275prov=b.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var We=ue(2851);let H=(()=>{class o{constructor(l,d,v,w){this.dataShareService=l,this.styleService=d,this.dialogRef=v,this.data=w,w&&(this.textId=w.textField.id,this.textColor=w.textField.styledetails.styledata.color,this.textName=w.textField.styledetails.styledata.textname,this.textHeight=w.textField.styledetails.styledata.height,this.textWidth=w.textField.styledetails.styledata.width,this.textFontSize=w.textField.styledetails.styledata.textfontsize,this.textLat=w.textField.geometry.coordinates[1],this.textLng=w.textField.geometry.coordinates[0],this.geo_json_main=w.geo_json_main,this.map=w.map)}submitBtn(){this.textFontSize>=5&&this.dialogRef.close({textColor:this.textColor,textLat:this.textLat,textLng:this.textLng,textHeight:this.textHeight,textWidth:this.textWidth,textName:this.textName,textFontSize:this.textFontSize,id:this.textId})}deleteText(){let l=JSON.parse(JSON.stringify({...this.geo_json_main})),d=this.geo_json_main.features.findIndex(v=>v.id==this.textId);l.features.splice(d,1),this.dataShareService.sendSourceData(l),this.styleService.setDataOnMap(this.map,l,!0,!1),this.closeBtn()}closeBtn(){this.dialogRef.close()}ngOnInit(){}}return o.\u0275fac=function(l){return new(l||o)(b.Y36(Oe),b.Y36(X),b.Y36(Z.so),b.Y36(Z.WI))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-text-edit"]],decls:32,vars:7,consts:[[1,"mb-1"],["for","textname"],["type","text","name","","id","textname",3,"ngModel","ngModelChange"],["for","color"],["id","color",3,"colorPicker","colorPickerChange"],["for","textFontSize"],["type","number","name","","id","textFontSize","min","5",3,"ngModel","ngModelChange"],["for","lat"],["type","text","name","","id","lat",3,"ngModel","ngModelChange"],["for","lng"],["type","text","name","","id","lng",3,"ngModel","ngModelChange"],[1,"mt-3","text-center"],[1,"btn","btn-sm","btn-secondary",3,"click"],[1,"btn","btn-sm","btn-success","ms-1",3,"click"],[1,"btn","btn-sm","btn-danger","ms-1",3,"click"]],template:function(l,d){1&l&&(b.TgZ(0,"div",0)(1,"label",1),b._uU(2,"Name"),b.qZA(),b._uU(3," : "),b.TgZ(4,"input",2),b.NdJ("ngModelChange",function(w){return d.textName=w}),b.qZA()(),b.TgZ(5,"div",0)(6,"label",3),b._uU(7,"Color"),b.qZA(),b._uU(8," : "),b.TgZ(9,"input",4),b.NdJ("colorPickerChange",function(w){return d.textColor=w}),b.qZA()(),b.TgZ(10,"div",0)(11,"label",5),b._uU(12,"Size"),b.qZA(),b._uU(13," : "),b.TgZ(14,"input",6),b.NdJ("ngModelChange",function(w){return d.textFontSize=w}),b.qZA()(),b.TgZ(15,"div",0)(16,"label",7),b._uU(17,"Lat"),b.qZA(),b._uU(18," : "),b.TgZ(19,"input",8),b.NdJ("ngModelChange",function(w){return d.textLat=w}),b.qZA()(),b.TgZ(20,"div",0)(21,"label",9),b._uU(22,"Lng"),b.qZA(),b._uU(23," : "),b.TgZ(24,"input",10),b.NdJ("ngModelChange",function(w){return d.textLng=w}),b.qZA()(),b.TgZ(25,"div",11)(26,"button",12),b.NdJ("click",function(){return d.closeBtn()}),b._uU(27,"Close"),b.qZA(),b.TgZ(28,"button",13),b.NdJ("click",function(){return d.submitBtn()}),b._uU(29,"Submit"),b.qZA(),b.TgZ(30,"button",14),b.NdJ("click",function(){return d.deleteText()}),b._uU(31,"Delete"),b.qZA()()),2&l&&(b.xp6(4),b.Q6J("ngModel",d.textName),b.xp6(5),b.Udp("background",d.textColor),b.Q6J("colorPicker",d.textColor),b.xp6(5),b.Q6J("ngModel",d.textFontSize),b.xp6(5),b.Q6J("ngModel",d.textLat),b.xp6(5),b.Q6J("ngModel",d.textLng))},dependencies:[c.Fj,c.wV,c.JJ,c.qQ,c.On,We.Kk],styles:["label[_ngcontent-%COMP%]{width:50px;text-align:left;display:inline-block}input[type=number][_ngcontent-%COMP%]:out-of-range{outline-color:red}"]}),o})();var q=ue(7009);let K=(()=>{class o{constructor(l){this._snackBar=l}openSnackbar(l,d){this._snackBar.open(l,"X",{duration:3e3,horizontalPosition:"end",verticalPosition:"top",panelClass:d})}}return o.\u0275fac=function(l){return new(l||o)(b.LFG(q.ux))},o.\u0275prov=b.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),X=(()=>{class o{constructor(l,d,v,w){this.snackBarService=l,this.matDialog=d,this.dataShareService=v,this.identityFeatureService=w,this.canDeleteMarker=!1,this.newMarkerGeoJSON={type:"FeatureCollection",features:[]},this.fillColorArray=[],this.fillOpacityArray=[],this.fillBorderColorArray=[],this.lineColorArray=[],this.lineWidthArray=[],this.circleRadiusArray=[],this.circleColorArray=[],this.fillBorderWidthArray=[],this.dataState=[],this.currentStateIndex=0,this.isUndoChecked=!1,this.dataShareService.getSourceData.subscribe(C=>{this.geo_json_main=C})}setColorArrayData(l){this.fillColorArray=[],this.fillOpacityArray=[],this.fillBorderColorArray=[],this.fillBorderWidthArray=[],this.lineColorArray=[],this.lineWidthArray=[],this.circleColorArray=[],this.circleRadiusArray=[],this.map=l,this.geo_json_main&&(this.geo_json_main.features.forEach(d=>{void 0!==d.styledetails.styledata.circlecolor&&(this.circleColorArray.push(d.id),this.circleColorArray.push(d.styledetails.styledata.circlecolor)),void 0!==d.styledetails.styledata.circleradius&&(this.circleRadiusArray.push(d.id),this.circleRadiusArray.push(Number(d.styledetails.styledata.circleradius))),void 0!==d.styledetails.styledata.linecolor&&(this.lineColorArray.push(d.id),this.lineColorArray.push(d.styledetails.styledata.linecolor)),void 0!==d.styledetails.styledata.linewidth&&(this.lineWidthArray.push(d.id),this.lineWidthArray.push(Number(d.styledetails.styledata.linewidth))),void 0!==d.styledetails.styledata.fillcolor&&(this.fillColorArray.push(d.id),this.fillColorArray.push(d.styledetails.styledata.fillcolor)),void 0!==d.styledetails.styledata.fillbordercolor&&(this.fillBorderColorArray.push(d.id),this.fillBorderColorArray.push(d.styledetails.styledata.fillbordercolor)),void 0!==d.styledetails.styledata.fillopacity&&(this.fillOpacityArray.push(d.id),this.fillOpacityArray.push(Number(d.styledetails.styledata.fillopacity))),void 0!==d.styledetails.styledata.fillborderwidth&&(this.fillBorderWidthArray.push(d.id),this.fillBorderWidthArray.push(Number(d.styledetails.styledata.fillborderwidth))),null==d.styledetails.styledata.circlecolor&&(this.circleColorArray.push(d.id),this.circleColorArray.push("orange")),null==d.styledetails.styledata.circleradius&&(this.circleRadiusArray.push(d.id),this.circleRadiusArray.push(5)),null==d.styledetails.styledata.linecolor&&(this.lineColorArray.push(d.id),this.lineColorArray.push("orange")),null==d.styledetails.styledata.linewidth&&(this.lineWidthArray.push(d.id),this.lineWidthArray.push(5)),null==d.styledetails.styledata.fillopacity&&(this.fillOpacityArray.push(d.id),this.fillOpacityArray.push(5)),null==d.styledetails.styledata.fillbordercolor&&(this.fillBorderColorArray.push(d.id),this.fillBorderColorArray.push("#3b1513")),null==d.styledetails.styledata.fillcolor&&(this.fillColorArray.push(d.id),this.fillColorArray.push("orange")),null==d.styledetails.styledata.fillborderwidth&&(this.fillBorderWidthArray.push(d.id),this.fillBorderWidthArray.push(2))}),this.setLastElementInEachStyle())}setLastElementInEachStyle(){this.circleColorArray.push("#B42222"),this.circleRadiusArray.push(6),this.lineColorArray.push("#BF93E4"),this.lineWidthArray.push(5),this.fillColorArray.push("#10CAF0"),this.fillBorderColorArray.push("#3b1513"),this.fillBorderWidthArray.push(2),this.fillOpacityArray.push(.4),this.setPaintFinally()}setPaintFinally(){this.map.setPaintProperty("YourMapSourceIdPolygon","fill-color",this.paintArrayCreator("fill-color")),this.map.setPaintProperty("YourMapSourceIdPolygon","fill-opacity",this.paintArrayCreator("fill-opacity")),this.map.setPaintProperty("YourMapSourceIdPolygonLineString","line-color",this.paintArrayCreator("polygon-border-color")),this.map.setPaintProperty("YourMapSourceIdPolygonLineString","line-width",this.paintArrayCreator("polygon-border-width")),this.map.setPaintProperty("YourMapSourceIdPoint","circle-color",this.paintArrayCreator("circle-color")),this.map.setPaintProperty("YourMapSourceIdPoint","circle-radius",this.paintArrayCreator("circle-radius")),this.map.setPaintProperty("YourMapSourceIdLineString","line-color",this.paintArrayCreator("line-color")),this.map.setPaintProperty("YourMapSourceIdLineString","line-width",this.paintArrayCreator("line-width"))}paintArrayCreator(l){let d=["match",["get","featureid"]];return"fill-color"==l&&d.push(...this.fillColorArray),"fill-opacity"==l&&d.push(...this.fillOpacityArray),"polygon-border-color"==l&&d.push(...this.fillBorderColorArray),"polygon-border-width"==l&&d.push(...this.fillBorderWidthArray),"circle-color"==l&&d.push(...this.circleColorArray),"circle-radius"==l&&d.push(...this.circleRadiusArray),"line-color"==l&&d.push(...this.lineColorArray),"line-width"==l&&d.push(...this.lineWidthArray),d}setDataOnMap(l,d,v=!0,w=!0){w&&this.setDataSourceFn(JSON.parse(JSON.stringify({...d}))),v&&this.deleteAllMarkers(),this.newMarkerGeoJSON={type:"FeatureCollection",features:[]},this.map=l;let C={...d};-1==C.features.findIndex(D=>"marker"==D.geometry.type)?(this.map.getSource("YourMapSource").setData(C),C.features.length>0&&this.setColorArrayData(this.map)):this.seprateMarkerLayer(C)}seprateMarkerLayer(l){let d=JSON.parse(JSON.stringify(l)),v=[];if(l.features.forEach((w,C)=>{"marker"==w.geometry.type&&(v.push(C),this.newMarkerGeoJSON.features.push(w))}),v){let w=0;v.forEach(C=>{d.features.splice(C-w,1),w++})}this.map.getSource("YourMapSource").setData(d),l.features.length>0&&this.setColorArrayData(this.map),this.addMarkerLayerOnMap()}addMarkerLayerOnMap(){for(const l of this.newMarkerGeoJSON.features)if(l.styledetails.styledata.markername){let d=`../../assets/marker-icons/all_maki_icons/svgs/${l.styledetails.styledata.markername}.svg`;const v=document.createElement("div"),w=l.styledetails.styledata.height,C=l.styledetails.styledata.width;v.className="marker",v.id=l.styledetails.id,v.style.backgroundImage=`url(${d})`,v.style.width=`${w}px`,v.style.height=`${C}px`,v.style.backgroundSize="100%",v.style.backgroundPosition="center",v.style.backgroundRepeat="no-repeat",v.style.cursor="pointer",v.addEventListener("click",()=>{this.sendIdentityFeatureStatus(l)}),v.addEventListener("contextmenu",()=>{this.sendIdentityFeatureStatus(l)}),new ge.Marker(v).setLngLat(l.geometry.coordinates).addTo(this.map)}else if(l.styledetails.styledata.textname){let d=!0;const v=document.createElement("div"),w=l.styledetails.styledata.width,C=l.styledetails.styledata.height;v.className="marker",v.id=l.styledetails.id,v.innerHTML=`${l.styledetails.styledata.textname}`,v.style.width=`${w}px`,v.style.height=`${C}px`,v.style.backgroundSize="100%",v.style.backgroundPosition="center",v.style.backgroundRepeat="no-repeat",v.style.cursor="pointer",v.style.color=l.styledetails.styledata.color,v.style.fontSize=`${l.styledetails.styledata.textfontsize}px`,new ge.Marker(v,{draggable:!0}).setLngLat(l.geometry.coordinates).addTo(this.map).on("dragend",D=>{if(d){let P={...this.geo_json_main};const z=D.target.getLngLat();let U=P.features.findIndex(j=>v.id==j.id);P.features[U].geometry.coordinates=[z.lng,z.lat],this.setDataOnMap(this.map,P),this.dataShareService.sendSourceData(P)}}),v.addEventListener("contextmenu",()=>{d=this.openTextFieldPopUp(l,d)}),v.addEventListener("click",()=>{this.canDeleteMarker?this.deleteFeature(l):d=this.openTextFieldPopUp(l,d)})}}openTextFieldPopUp(l,d){this.matDialog.open(H,{data:{textField:l,geo_json_main:this.geo_json_main,map:this.map},disableClose:!0}).afterClosed().subscribe(w=>{let C={...this.geo_json_main};if(w){let A=C.features.findIndex(D=>w.id==D.id);C.features[A].geometry.coordinates=[w.textLng,w.textLat],C.features[A].styledetails.styledata.color=w.textColor,C.features[A].styledetails.styledata.height=w.textHeight,C.features[A].styledetails.styledata.width=w.textWidth,C.features[A].styledetails.styledata.textname=w.textName,C.features[A].styledetails.styledata.textfontsize=w.textFontSize}return this.setDataOnMap(this.map,C),this.dataShareService.sendSourceData(C),!1})}setTextFieldData(l){}deleteAllMarkers(){this.newMarkerGeoJSON.features.length>0&&(this.newMarkerGeoJSON.features.forEach(l=>{document.getElementById(`${l.styledetails.id}`).remove()}),this.newMarkerGeoJSON={type:"FeatureCollection",features:[]})}sendIdentityFeatureStatus(l){this.canDeleteMarker?this.deleteFeature(l):this.showIdentityFeature(this.identityFeatureData(l.properties))}deleteFeature(l){let d={...this.geo_json_main},v=d.features.findIndex(w=>w.id==l.properties.featureid);d.features.splice(v,1),this.setDataOnMap(this.map,d),this.dataShareService.sendSourceData(d)}identityFeatureData(l){let d=Object.keys(l),v=[];return d.forEach(w=>{let C={name:"",value:""};C.name=w,C.value=l[w],v.push(C)}),v}showIdentityFeature(l){setTimeout(()=>{this.identityFeatureService.sendShowIdentityFeatureStatus(!1),setTimeout(()=>{this.identityFeatureService.sendShowIdentityFeatureStatus(!0),this.identityFeatureService.sendIdentityFeatureData(l)},200)},0)}setDataSourceFn(l){this.isUndoChecked&&(this.dataState.length=this.currentStateIndex);let d=JSON.parse(JSON.stringify({...l}));this.dataState.push(d),this.currentStateIndex++,this.isUndoChecked=!1}handleUndo(){if(this.dataState.length>0)if(this.currentStateIndex--,this.currentStateIndex<=0)this.snackBarService.openSnackbar("You can't undo from this state'","snackbar-err"),this.currentStateIndex++;else{let l=this.dataState[this.currentStateIndex-1];this.setDataOnMap(this.map,JSON.parse(JSON.stringify({...l})),!0,!1),this.dataShareService.sendSourceData(JSON.parse(JSON.stringify({...l}))),this.setColorArrayData(this.map),this.isUndoChecked=!0}else this.snackBarService.openSnackbar("Please draw some feature first","snackbar-err")}handleRedo(){if(this.dataState.length>0)if(this.currentStateIndex++,this.currentStateIndex>this.dataState.length)this.snackBarService.openSnackbar("You can't redo from this state","snackbar-err"),this.currentStateIndex--;else{let l=this.dataState[this.currentStateIndex-1];this.setDataOnMap(this.map,JSON.parse(JSON.stringify({...l})),!0,!1),this.dataShareService.sendSourceData(JSON.parse(JSON.stringify({...l}))),this.setColorArrayData(this.map),this.isUndoChecked=!0}else this.snackBarService.openSnackbar("Please use undo first","snackbar-err")}}return o.\u0275fac=function(l){return new(l||o)(b.LFG(K),b.LFG(Z.uw),b.LFG(Oe),b.LFG(xe))},o.\u0275prov=b.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var ee=ue(7392),ie=ue(455);function ne(o,a){if(1&o){const l=b.EpF();b.TgZ(0,"div")(1,"div")(2,"img",19),b.NdJ("click",function(){b.CHM(l);const v=b.oxw(3);return b.KtG(v.showMarkerList())}),b.qZA()(),b.TgZ(3,"div",20)(4,"label",21),b._uU(5,"Height"),b.qZA(),b._uU(6," : "),b.TgZ(7,"input",22),b.NdJ("ngModelChange",function(v){b.CHM(l);const w=b.oxw(3);return b.KtG(w.markerHeight=v)}),b.qZA()(),b.TgZ(8,"div",23)(9,"label",24),b._uU(10,"Width"),b.qZA(),b._uU(11," : "),b.TgZ(12,"input",25),b.NdJ("ngModelChange",function(v){b.CHM(l);const w=b.oxw(3);return b.KtG(w.markerWidth=v)}),b.qZA()()()}if(2&o){const l=b.oxw(3);b.xp6(2),b.Q6J("src","../../../assets/marker-icons/all_maki_icons/svgs/"+l.markerName+".svg",b.LSH),b.xp6(5),b.Q6J("ngModel",l.markerHeight),b.xp6(5),b.Q6J("ngModel",l.markerWidth)}}function se(o,a){if(1&o){const l=b.EpF();b.TgZ(0,"div")(1,"div",26)(2,"label",27),b._uU(3,"Background Color"),b.qZA(),b._uU(4," : "),b.TgZ(5,"input",28),b.NdJ("colorPickerChange",function(v){b.CHM(l);const w=b.oxw(3);return b.KtG(w.fillColor=v)}),b.qZA()(),b.TgZ(6,"div",26)(7,"label",29),b._uU(8,"Border Color"),b.qZA(),b._uU(9," : "),b.TgZ(10,"input",30),b.NdJ("colorPickerChange",function(v){b.CHM(l);const w=b.oxw(3);return b.KtG(w.fillBorderColor=v)}),b.qZA()(),b.TgZ(11,"div",26)(12,"label",31),b._uU(13,"Border Width"),b.qZA(),b._uU(14," : "),b.TgZ(15,"input",32),b.NdJ("ngModelChange",function(v){b.CHM(l);const w=b.oxw(3);return b.KtG(w.fillBorderWidth=v)}),b.qZA()(),b.TgZ(16,"div",26)(17,"label",31),b._uU(18,"Fill Opacity"),b.qZA(),b._uU(19," : "),b.TgZ(20,"input",32),b.NdJ("ngModelChange",function(v){b.CHM(l);const w=b.oxw(3);return b.KtG(w.fillOpacity=v)}),b.qZA()()()}if(2&o){const l=b.oxw(3);b.xp6(5),b.Udp("background",l.fillColor),b.Q6J("colorPicker",l.fillColor),b.xp6(5),b.Udp("background",l.fillBorderColor),b.Q6J("colorPicker",l.fillBorderColor),b.xp6(5),b.Q6J("ngModel",l.fillBorderWidth),b.xp6(5),b.Q6J("ngModel",l.fillOpacity)}}function he(o,a){if(1&o){const l=b.EpF();b.TgZ(0,"div")(1,"div",26)(2,"label",29),b._uU(3,"Line Color"),b.qZA(),b._uU(4," : "),b.TgZ(5,"input",30),b.NdJ("colorPickerChange",function(v){b.CHM(l);const w=b.oxw(3);return b.KtG(w.lineColor=v)}),b.qZA()(),b.TgZ(6,"div",26)(7,"label",31),b._uU(8,"Line Width"),b.qZA(),b._uU(9," : "),b.TgZ(10,"input",33),b.NdJ("ngModelChange",function(v){b.CHM(l);const w=b.oxw(3);return b.KtG(w.lineWidth=v)}),b.qZA()()()}if(2&o){const l=b.oxw(3);b.xp6(5),b.Udp("background",l.lineColor),b.Q6J("colorPicker",l.lineColor),b.xp6(5),b.Q6J("ngModel",l.lineWidth)}}function re(o,a){if(1&o){const l=b.EpF();b.TgZ(0,"div")(1,"div",26)(2,"label",29),b._uU(3,"Circle Color"),b.qZA(),b._uU(4," : "),b.TgZ(5,"input",30),b.NdJ("colorPickerChange",function(v){b.CHM(l);const w=b.oxw(3);return b.KtG(w.circleColor=v)}),b.qZA()(),b.TgZ(6,"div",26)(7,"label",31),b._uU(8,"Circle Radius"),b.qZA(),b._uU(9," : "),b.TgZ(10,"input",34),b.NdJ("ngModelChange",function(v){b.CHM(l);const w=b.oxw(3);return b.KtG(w.circleRadius=v)}),b.qZA()()()}if(2&o){const l=b.oxw(3);b.xp6(5),b.Udp("background",l.circleColor),b.Q6J("colorPicker",l.circleColor),b.xp6(5),b.Q6J("ngModel",l.circleRadius)}}function nt(o,a){if(1&o&&(b.TgZ(0,"div")(1,"div",18),b.YNc(2,ne,13,3,"div",7),b.YNc(3,se,21,8,"div",7),b.YNc(4,he,11,4,"div",7),b.YNc(5,re,11,4,"div",7),b.qZA()()),2&o){const l=b.oxw(2);b.xp6(2),b.Q6J("ngIf","marker"==(null==l.geo_json_main||null==l.geo_json_main.features[l.CurrentFeatureindex]||null==l.geo_json_main.features[l.CurrentFeatureindex].geometry?null:l.geo_json_main.features[l.CurrentFeatureindex].geometry.type)),b.xp6(1),b.Q6J("ngIf","Polygon"==(null==l.geo_json_main||null==l.geo_json_main.features[l.CurrentFeatureindex]||null==l.geo_json_main.features[l.CurrentFeatureindex].geometry?null:l.geo_json_main.features[l.CurrentFeatureindex].geometry.type)),b.xp6(1),b.Q6J("ngIf","LineString"==(null==l.geo_json_main||null==l.geo_json_main.features[l.CurrentFeatureindex]||null==l.geo_json_main.features[l.CurrentFeatureindex].geometry?null:l.geo_json_main.features[l.CurrentFeatureindex].geometry.type)),b.xp6(1),b.Q6J("ngIf","Point"==(null==l.geo_json_main||null==l.geo_json_main.features[l.CurrentFeatureindex]||null==l.geo_json_main.features[l.CurrentFeatureindex].geometry?null:l.geo_json_main.features[l.CurrentFeatureindex].geometry.type))}}function ze(o,a){if(1&o&&(b.TgZ(0,"div"),b.YNc(1,nt,6,4,"div",7),b.qZA()),2&o){const l=b.oxw();b.xp6(1),b.Q6J("ngIf",l.geo_json_main)}}function Ze(o,a){if(1&o&&(b.TgZ(0,"table",37)(1,"tr")(2,"td",38),b._uU(3,"Sq. Meters"),b.qZA(),b.TgZ(4,"td",38),b._uU(5),b.qZA()(),b.TgZ(6,"tr")(7,"td",38),b._uU(8,"Sq. Kilometers"),b.qZA(),b.TgZ(9,"td",38),b._uU(10),b.qZA()(),b.TgZ(11,"tr")(12,"td",38),b._uU(13,"Sq. Feet"),b.qZA(),b.TgZ(14,"td",38),b._uU(15),b.qZA()(),b.TgZ(16,"tr")(17,"td",38),b._uU(18,"Acres"),b.qZA(),b.TgZ(19,"td",38),b._uU(20),b.qZA()(),b.TgZ(21,"tr")(22,"td",38),b._uU(23,"Sq. Miles"),b.qZA(),b.TgZ(24,"td",38),b._uU(25),b.qZA()()()),2&o){const l=b.oxw(2);b.xp6(5),b.Oqu(l.polygonMeasurement),b.xp6(5),b.Oqu(l.polygonMeasurement/1e6),b.xp6(5),b.Oqu(10.76*l.polygonMeasurement),b.xp6(5),b.Oqu(.0002471054*l.polygonMeasurement),b.xp6(5),b.Oqu(39e-8*l.polygonMeasurement)}}function Ee(o,a){if(1&o&&(b.TgZ(0,"table",37)(1,"tr")(2,"td",38),b._uU(3,"Meters"),b.qZA(),b.TgZ(4,"td",38),b._uU(5),b.qZA()(),b.TgZ(6,"tr")(7,"td",38),b._uU(8,"Kilometers"),b.qZA(),b.TgZ(9,"td",38),b._uU(10),b.qZA()(),b.TgZ(11,"tr")(12,"td",38),b._uU(13,"Feet"),b.qZA(),b.TgZ(14,"td",38),b._uU(15),b.qZA()(),b.TgZ(16,"tr")(17,"td",38),b._uU(18,"Yards"),b.qZA(),b.TgZ(19,"td",38),b._uU(20),b.qZA()(),b.TgZ(21,"tr")(22,"td",38),b._uU(23,"Miles"),b.qZA(),b.TgZ(24,"td",38),b._uU(25),b.qZA()()()),2&o){const l=b.oxw(2);b.xp6(5),b.Oqu(1e3*l.lineMeasurement),b.xp6(5),b.Oqu(l.lineMeasurement),b.xp6(5),b.Oqu(3280.84*l.lineMeasurement),b.xp6(5),b.Oqu(1093.61*l.lineMeasurement),b.xp6(5),b.Oqu(.621371*l.lineMeasurement)}}function Jt(o,a){if(1&o&&(b.TgZ(0,"table",37)(1,"tr")(2,"td",39),b._uU(3,"Latitude"),b.qZA(),b.TgZ(4,"td",39),b._uU(5),b.qZA()(),b.TgZ(6,"tr")(7,"td",39),b._uU(8,"Longitude"),b.qZA(),b.TgZ(9,"td",39),b._uU(10),b.qZA()()()),2&o){const l=b.oxw(2);b.xp6(5),b.Oqu(l.geo_json_main.features[l.CurrentFeatureindex].geometry.coordinates[0]),b.xp6(5),b.Oqu(l.geo_json_main.features[l.CurrentFeatureindex].geometry.coordinates[1])}}function Nt(o,a){if(1&o&&(b.TgZ(0,"div",35),b.YNc(1,Ze,26,5,"table",36),b.YNc(2,Ee,26,5,"table",36),b.YNc(3,Jt,11,2,"table",36),b.qZA()),2&o){const l=b.oxw();b.xp6(1),b.Q6J("ngIf","Polygon"==(null==l.geo_json_main||null==l.geo_json_main.features[l.CurrentFeatureindex]||null==l.geo_json_main.features[l.CurrentFeatureindex].geometry?null:l.geo_json_main.features[l.CurrentFeatureindex].geometry.type)),b.xp6(1),b.Q6J("ngIf","LineString"==(null==l.geo_json_main||null==l.geo_json_main.features[l.CurrentFeatureindex]||null==l.geo_json_main.features[l.CurrentFeatureindex].geometry?null:l.geo_json_main.features[l.CurrentFeatureindex].geometry.type)),b.xp6(1),b.Q6J("ngIf","Point"==(null==l.geo_json_main||null==l.geo_json_main.features[l.CurrentFeatureindex]||null==l.geo_json_main.features[l.CurrentFeatureindex].geometry?null:l.geo_json_main.features[l.CurrentFeatureindex].geometry.type)||"marker"==(null==l.geo_json_main||null==l.geo_json_main.features[l.CurrentFeatureindex]||null==l.geo_json_main.features[l.CurrentFeatureindex].geometry?null:l.geo_json_main.features[l.CurrentFeatureindex].geometry.type))}}function ke(o,a){if(1&o){const l=b.EpF();b.TgZ(0,"div"),b._UZ(1,"input",42)(2,"input",43),b.TgZ(3,"button",44),b.NdJ("click",function(){b.CHM(l);const v=b.oxw().index,w=b.oxw();return b.KtG(w.removeAttribute(v))}),b._uU(4,"-"),b.qZA()()}if(2&o){const l=b.oxw().index;b.xp6(1),b.Q6J("readonly",0==l),b.xp6(1),b.Q6J("readonly",0==l),b.xp6(1),b.Q6J("disabled",0==l)}}function xt(o,a){if(1&o&&(b.TgZ(0,"div",40)(1,"div",41),b.YNc(2,ke,5,3,"div",7),b.qZA()()),2&o){const l=a.index;b.xp6(1),b.Q6J("formGroupName",l),b.xp6(1),b.Q6J("ngIf",0!==l)}}function Ae(o,a){1&o&&(b.TgZ(0,"div",45),b._uU(1," * Click on marker icon in identity feature to change it "),b.qZA())}let pt=(()=>{class o{constructor(l,d,v,w,C,A){this.identityFeatureService=l,this.dataShareService=d,this._fb=v,this.matDialog=w,this.styleService=C,this.snackbarService=A}ngOnInit(){this.identityFeatureService.showIdentityFeatureStatus.subscribe(l=>{l||this.closeIdentity(),this.showIdentityFeature=l}),this.identityFeatureService.getIdentityFeatureData.subscribe(l=>{this.featureFormData=l,this.setFeatureFormData(),this.findFeatureIndex(),this.setStyleDetails()}),this.dataShareService.getSourceData.subscribe(l=>{this.geo_json_main=l}),this.initializeFormArray()}setStyleDetails(){"marker"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&(this.markerName=this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.markername,this.markerHeight=this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.height,this.markerWidth=this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.width),"Polygon"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&(this.fillColor=this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.fillcolor,this.fillBorderColor=this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.fillbordercolor,this.fillBorderWidth=this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.fillborderwidth,this.fillOpacity=this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.fillopacity,this.polygonMeasurement=this.geo_json_main.features[this.CurrentFeatureindex].measurement.squaremeters),"LineString"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&(this.lineColor=this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.linecolor,this.lineWidth=this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.linewidth,this.lineMeasurement=this.geo_json_main.features[this.CurrentFeatureindex].measurement.kilometers),"Point"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&(this.circleColor=this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.circlecolor,this.circleRadius=this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.circleradius)}saveStyleDetailsInJson(){"marker"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&this.setMarkerStyleDetails(),"Polygon"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&this.setPolygonStyleDetails(),"LineString"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&this.setLineStringStyleDetails(),"Point"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&this.setPointStyleDetails()}setMarkerStyleDetails(){this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.markername=this.markerName,this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.height=this.markerHeight,this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.width=this.markerWidth,this.dataShareService.sendSourceData(this.geo_json_main)}setPolygonStyleDetails(){this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.fillcolor=this.fillColor,this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.fillbordercolor=this.fillBorderColor,this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.fillborderwidth=this.fillBorderWidth,this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.fillopacity=this.fillOpacity,this.dataShareService.sendSourceData(this.geo_json_main)}setLineStringStyleDetails(){this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.linecolor=this.lineColor,this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.linewidth=this.lineWidth}setPointStyleDetails(){this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.circlecolor=this.circleColor,this.geo_json_main.features[this.CurrentFeatureindex].styledetails.styledata.circleradius=this.circleRadius}findFeatureIndex(){this.CurrentFeatureindex=this.geo_json_main.features.findIndex(l=>this.featureFormData[0].value==l.id)}initializeFormArray(){this.featureForm=this._fb.group({identityFormData:this._fb.array([this.putFormData()])})}putFormData(){return this._fb.group({name:["",c.kI.required],value:["",c.kI.required]})}get identityFormData(){return this.featureForm.get("identityFormData")}addNewAttribute(){this.identityFormData.push(this.putFormData())}removeAttribute(l){this.identityFormData.removeAt(l)}setFeatureFormData(){let l=this.featureFormData.length;for(let v=1;v<l;v++)this.addNewAttribute();let d=this.featureFormData.findIndex(v=>"featureid"==v.name);if(0!==d){let v=this.featureFormData.splice(d,1)[0];this.featureFormData.splice(0,0,v)}this.identityFormData.patchValue(this.featureFormData)}submitData(){"Polygon"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&this.fillOpacity>=0&&this.fillBorderWidth>=0&&this.finallySubmitData(),"marker"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&this.markerHeight>=10&&this.markerWidth>=10&&this.finallySubmitData(),"LineString"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&this.lineWidth>=1&&this.finallySubmitData(),"Point"==this.geo_json_main.features[this.CurrentFeatureindex].geometry.type&&this.circleRadius>=1&&this.finallySubmitData()}finallySubmitData(){"VALID"==this.featureForm.status?(this.setDataIn_geo_json_main(this.featureForm.get("identityFormData").value),this.closeIdentity(),this.saveStyleDetailsInJson(),this.styleService.setDataOnMap(this.map,this.geo_json_main)):this.snackbarService.openSnackbar("Please fill all the fields or remove empty fields","snackbar-err")}setDataIn_geo_json_main(l){let d=this.setFormDataForProperties(l);this.setNew_geo_json_main_data(d),this.dataShareService.sendSourceData(this.geo_json_main)}setNew_geo_json_main_data(l){let d=this.geo_json_main.features.findIndex(v=>v.id==l.featureid);this.geo_json_main.features[d].properties=l}setFormDataForProperties(l){let d={};return l.forEach(v=>{d[v.name]=v.value}),d}deleteFeature(){this.matDialog.open(ce,{width:"250px",data:{messageData:"Are You Sure You Want To Delete This Feature"},enterAnimationDuration:"200ms",exitAnimationDuration:"200ms"}).afterClosed().subscribe(d=>{d&&(this.deleteFeatureFromGeojson(this.featureFormData[0].value),this.closeIdentity())})}deleteFeatureFromGeojson(l){let d=this.geo_json_main.features;d.splice(this.CurrentFeatureindex,1),this.geo_json_main.features=d,this.styleService.setDataOnMap(this.map,this.geo_json_main),this.dataShareService.sendSourceData(this.geo_json_main)}showMarkerList(){this.matDialog.open($e,{width:"500px",data:{markerName:this.markerName}}).afterClosed().subscribe(d=>{d&&(this.markerName=d)})}getShowMeasurementStatus(l){this.showMeasurement=l.checked}showIdentity(l){this.featureFormData=l,this.setFeatureFormData(),this.findFeatureIndex(),this.setStyleDetails()}closeIdentity(){this.showIdentityFeature=!1,this.featureForm.reset(),this.identityFormData.controls=[this.putFormData()]}}return o.\u0275fac=function(l){return new(l||o)(b.Y36(xe),b.Y36(Oe),b.Y36(c.qu),b.Y36(Z.uw),b.Y36(X),b.Y36(K))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-identity-feature-side-nav"]],inputs:{map:"map"},decls:32,vars:6,consts:[[1,"identity-feature",3,"ngClass"],[1,"p-flex","shadow-sm"],[1,"cancle-icon",3,"click"],[1,"p-flex","my-2","toggle-div"],[1,"me-2"],[1,"d-block",3,"change"],[1,"ms-2"],[4,"ngIf"],["class","p-flex",4,"ngIf"],[1,"mt-2",3,"formGroup","ngSubmit"],["formArrayName","identityFormData",4,"ngFor","ngForOf"],[1,"p-flex","mb-3"],["type","button",1,"btn","btn-sm","d-flex","btn-primary","mt-2","mb-2",3,"click"],[1,"ms-1"],["type","submit",1,"btn","btn-sm","btn-success","ms-2"],["type","button",1,"d-flex","align-items-center","btn","btn-sm","btn-danger","ms-2",3,"click"],[1,"p-0","m-0","d-flex","align-items-center"],["class","alert alert-danger","style","line-height: 15px;",4,"ngIf"],[1,"mt-2"],["height","35px","width","35px","role","button","alt","",1,"ms-2","fs-1",3,"src","click"],[1,"d-flex","justify-content-center","mt-2"],["for","marker-height"],["id","marker-height","type","number","min","10",3,"ngModel","ngModelChange"],[1,"d-flex","justify-content-center","my-2"],["for","marker-width"],["id","marker-width","type","number","min","10",3,"ngModel","ngModelChange"],[1,"d-flex","justify-content-center","mb-2"],["for","fill-color"],["id","fill-color",3,"colorPicker","colorPickerChange"],["for","fill-outline-color"],["id","fill-outline-color",3,"colorPicker","colorPickerChange"],["for","fill-opacity"],["id","fill-opacity","type","number","min","0",3,"ngModel","ngModelChange"],["id","fill-opacity","type","number","min","1",3,"ngModel","ngModelChange"],["id","fill-opacity","type","number","min","2",3,"ngModel","ngModelChange"],[1,"p-flex"],["class","table w-75",4,"ngIf"],[1,"table","w-75"],["scope","col",1,"border","border-1","border-dark","p-2"],[1,"border","border-1","border-dark","p-2"],["formArrayName","identityFormData"],[1,"text-center",3,"formGroupName"],["type","text","formControlName","name",3,"readonly"],["type","text","formControlName","value",3,"readonly"],["type","button",1,"btn","btn-sm","btn-danger",3,"disabled","click"],[1,"alert","alert-danger",2,"line-height","15px"]],template:function(l,d){1&l&&(b.TgZ(0,"div",0)(1,"header",1)(2,"span"),b._uU(3,"Identity Feature"),b.qZA(),b.TgZ(4,"mat-icon",2),b.NdJ("click",function(){return d.closeIdentity()}),b._uU(5,"cancel"),b.qZA()(),b.TgZ(6,"main")(7,"div",3)(8,"span",4),b._uU(9,"Style"),b.qZA(),b.TgZ(10,"mat-slide-toggle",5),b.NdJ("change",function(w){return d.getShowMeasurementStatus(w)}),b.qZA(),b.TgZ(11,"span",6),b._uU(12,"Info"),b.qZA()(),b.YNc(13,ze,2,1,"div",7),b.YNc(14,Nt,4,3,"div",8),b.TgZ(15,"form",9),b.NdJ("ngSubmit",function(){return d.submitData()}),b.YNc(16,xt,3,2,"div",10),b.TgZ(17,"div",11)(18,"button",12),b.NdJ("click",function(){return d.addNewAttribute()}),b.TgZ(19,"span"),b._uU(20,"+"),b.qZA(),b.TgZ(21,"span",13),b._uU(22,"Add Attribute"),b.qZA()(),b.TgZ(23,"button",14),b._uU(24,"Submit"),b.qZA(),b.TgZ(25,"button",15),b.NdJ("click",function(){return d.deleteFeature()}),b.TgZ(26,"span",16)(27,"mat-icon"),b._uU(28,"delete_forever"),b.qZA(),b.TgZ(29,"span"),b._uU(30,"Delete"),b.qZA()()()()(),b.YNc(31,Ae,2,0,"div",17),b.qZA()()),2&l&&(b.Q6J("ngClass",d.showIdentityFeature?"identity-feature-show":"identity-feature-hide"),b.xp6(13),b.Q6J("ngIf",!d.showMeasurement),b.xp6(1),b.Q6J("ngIf",d.showMeasurement),b.xp6(1),b.Q6J("formGroup",d.featureForm),b.xp6(1),b.Q6J("ngForOf",d.identityFormData.controls),b.xp6(15),b.Q6J("ngIf","marker"==(null==d.geo_json_main||null==d.geo_json_main.features[d.CurrentFeatureindex]||null==d.geo_json_main.features[d.CurrentFeatureindex].geometry?null:d.geo_json_main.features[d.CurrentFeatureindex].geometry.type)))},dependencies:[ae.mk,ae.sg,ae.O5,ee.Hw,ie.Rr,c._Y,c.Fj,c.wV,c.JJ,c.JL,c.qQ,c.sg,c.u,c.x0,c.CE,c.On,We.Kk],styles:[".toggle-div[_ngcontent-%COMP%]  .mat-slide-toggle.mat-checked:not(.mat-disabled) .mat-slide-toggle-thumb{background-color:#00f}.toggle-div[_ngcontent-%COMP%]  .mat-slide-toggle.mat-checked:not(.mat-disabled) .mat-slide-toggle-bar{background-color:#87ceeb}.identity-feature[_ngcontent-%COMP%]{position:absolute;z-index:3;left:0;top:0;bottom:0;margin:auto 0;width:400px;height:50%;background-color:#e2f2f0;border-left:none;transition:transform .5s}.identity-feature-hide[_ngcontent-%COMP%]{transform:translate(-100%)}.identity-feature-show[_ngcontent-%COMP%]{transform:translate(0)}header[_ngcontent-%COMP%]{height:8%;background-color:#0fcaf0;position:relative;font-size:15px;font-weight:bolder}.cancle-icon[_ngcontent-%COMP%]{position:absolute;right:0;cursor:pointer}main[_ngcontent-%COMP%]{height:92%;overflow-y:auto;overflow-x:hidden;scrollbar-color:#10CAF0 #EFF8FF}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#1e3770;border-radius:10px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1}[_ngcontent-%COMP%]::-webkit-scrollbar{width:8px;height:8px}input.ng-invalid.ng-touched[_ngcontent-%COMP%]{border:2px solid red}label[_ngcontent-%COMP%]{width:150px}input[type=number][_ngcontent-%COMP%]:out-of-range{outline-color:red}"]}),o})();var bt=ue(8527);function gr(o){const a=o.featureTarget;return!(!a||!a.properties)&&"vertex"===a.properties.meta}function rr(o){return 27===o.keyCode}function En(o){return 13===o.keyCode}const Lr={enable(o){setTimeout(()=>{!o.map||!o.map.doubleClickZoom||!o._ctx||!o._ctx.store||!o._ctx.store.getInitialConfigValue||!o._ctx.store.getInitialConfigValue("doubleClickZoom")||o.map.doubleClickZoom.enable()},0)},disable(o){setTimeout(()=>{!o.map||!o.map.doubleClickZoom||o.map.doubleClickZoom.disable()},0)}},ti=function Cn(o,a){return!!o.lngLat&&o.lngLat.lng===a[0]&&o.lngLat.lat===a[1]};function Jn(o,a,l,d){return{type:"Feature",properties:{meta:"vertex",parent:o,coord_path:l,active:d?"true":"false"},geometry:{type:"Point",coordinates:a}}}const zn={onSetup:function(){const o=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(o),this.clearSelectedFeatures(),Lr.disable(this),this.updateUIClasses({mouse:"add"}),this.activateUIButton("polygon"),this.setActionableState({trash:!0}),{polygon:o,currentVertexPosition:0}},clickAnywhere:function(o,a){if(o.currentVertexPosition>0&&ti(a,o.polygon.coordinates[0][o.currentVertexPosition-1]))return this.changeMode("simple_select",{featureIds:[o.polygon.id]});this.updateUIClasses({mouse:"add"}),o.polygon.updateCoordinate(`0.${o.currentVertexPosition}`,a.lngLat.lng,a.lngLat.lat),o.currentVertexPosition++,o.polygon.updateCoordinate(`0.${o.currentVertexPosition}`,a.lngLat.lng,a.lngLat.lat)},clickOnVertex:function(o){return this.changeMode("simple_select",{featureIds:[o.polygon.id]})},onMouseMove:function(o,a){o.polygon.updateCoordinate(`0.${o.currentVertexPosition}`,a.lngLat.lng,a.lngLat.lat),gr(a)&&this.updateUIClasses({mouse:"pointer"})}};zn.onTap=zn.onClick=function(o,a){return gr(a)?this.clickOnVertex(o,a):this.clickAnywhere(o,a)},zn.onKeyUp=function(o,a){rr(a)?(this.deleteFeature([o.polygon.id],{silent:!0}),this.changeMode("simple_select")):En(a)&&this.changeMode("simple_select",{featureIds:[o.polygon.id]})},zn.onStop=function(o){this.updateUIClasses({mouse:"none"}),Lr.enable(this),this.activateUIButton(),void 0!==this.getFeature(o.polygon.id)&&(o.polygon.removeCoordinate(`0.${o.currentVertexPosition}`),o.polygon.isValid()?this.map.fire("draw.create",{features:[o.polygon.toGeoJSON()]}):(this.deleteFeature([o.polygon.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},zn.toDisplayFeatures=function(o,a,l){const d=a.properties.id===o.polygon.id;if(a.properties.active=d?"true":"false",!d)return l(a);if(0===a.geometry.coordinates.length)return;const v=a.geometry.coordinates[0].length;if(!(v<3)){if(a.properties.meta="feature",l(Jn(o.polygon.id,a.geometry.coordinates[0][0],"0.0",!1)),v>3){const w=a.geometry.coordinates[0].length-3;l(Jn(o.polygon.id,a.geometry.coordinates[0][w],`0.${w}`,!1))}if(v<=4&&(l({type:"Feature",properties:a.properties,geometry:{coordinates:[[a.geometry.coordinates[0][0][0],a.geometry.coordinates[0][0][1]],[a.geometry.coordinates[0][1][0],a.geometry.coordinates[0][1][1]]],type:"LineString"}}),3===v))return;return l(a)}},zn.onTrash=function(o){this.deleteFeature([o.polygon.id],{silent:!0}),this.changeMode("simple_select")};var Qr=6371008.8,wo={centimeters:100*Qr,centimetres:100*Qr,degrees:Qr/111325,feet:3.28084*Qr,inches:39.37*Qr,kilometers:Qr/1e3,kilometres:Qr/1e3,meters:Qr,metres:Qr,miles:Qr/1609.344,millimeters:1e3*Qr,millimetres:1e3*Qr,nauticalmiles:Qr/1852,radians:1,yards:1.0936*Qr};function Xn(o,a,l){void 0===l&&(l={});var d={type:"Feature"};return(0===l.id||l.id)&&(d.id=l.id),l.bbox&&(d.bbox=l.bbox),d.properties=a||{},d.geometry=o,d}function Bn(o,a,l){if(void 0===l&&(l={}),!o)throw new Error("coordinates is required");if(!Array.isArray(o))throw new Error("coordinates must be an Array");if(o.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Yr(o[0])||!Yr(o[1]))throw new Error("coordinates must contain numbers");return Xn({type:"Point",coordinates:o},a,l)}function Wo(o,a,l){void 0===l&&(l={});for(var d=0,v=o;d<v.length;d++){var w=v[d];if(w.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var C=0;C<w[w.length-1].length;C++)if(w[w.length-1][C]!==w[0][C])throw new Error("First and last Position are not equivalent.")}return Xn({type:"Polygon",coordinates:o},a,l)}function Sn(o,a,l){if(void 0===l&&(l={}),o.length<2)throw new Error("coordinates must be an array of two or more positions");return Xn({type:"LineString",coordinates:o},a,l)}function Ct(o){return o%(2*Math.PI)*180/Math.PI}function sr(o){return o%360*Math.PI/180}function Yr(o){return!isNaN(o)&&null!==o&&!Array.isArray(o)}function Dn(o){if(!o)throw new Error("coord is required");if(!Array.isArray(o)){if("Feature"===o.type&&null!==o.geometry&&"Point"===o.geometry.type)return o.geometry.coordinates;if("Point"===o.type)return o.coordinates}if(Array.isArray(o)&&o.length>=2&&!Array.isArray(o[0])&&!Array.isArray(o[1]))return o;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function xi(o){if(Array.isArray(o))return o;if("Feature"===o.type){if(null!==o.geometry)return o.geometry.coordinates}else if(o.coordinates)return o.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ts(o){return"Feature"===o.type?o.geometry:o}function hs(o){var a=xi(o);if(2===a.length&&!Kn(a[0],a[1]))return a;var l=[],d=a.length-1,v=l.length;l.push(a[0]);for(var w=1;w<d;w++){var C=l[l.length-1];a[w][0]===C[0]&&a[w][1]===C[1]||(l.push(a[w]),(v=l.length)>2&&Jo(l[v-3],l[v-1],l[v-2])&&l.splice(l.length-2,1))}if(l.push(a[a.length-1]),v=l.length,Kn(a[0],a[a.length-1])&&v<4)throw new Error("invalid polygon");return Jo(l[v-3],l[v-1],l[v-2])&&l.splice(l.length-2,1),l}function Kn(o,a){return o[0]===a[0]&&o[1]===a[1]}function Jo(o,a,l){var d=l[0],v=l[1],w=o[0],C=o[1],A=a[0],D=a[1],U=A-w,j=D-C;return 0==(d-w)*j-(v-C)*U&&(Math.abs(U)>=Math.abs(j)?U>0?w<=d&&d<=A:A<=d&&d<=w:j>0?C<=v&&v<=D:D<=v&&v<=C)}function ks(o){var a={type:"Feature"};return Object.keys(o).forEach(function(l){switch(l){case"type":case"properties":case"geometry":return;default:a[l]=o[l]}}),a.properties=Pl(o.properties),a.geometry=Nr(o.geometry),a}function Pl(o){var a={};return o&&Object.keys(o).forEach(function(l){var d=o[l];a[l]="object"==typeof d?null===d?null:Array.isArray(d)?d.map(function(v){return v}):Pl(d):d}),a}function Nr(o){var a={type:o.type};return o.bbox&&(a.bbox=o.bbox),"GeometryCollection"===o.type?(a.geometries=o.geometries.map(function(l){return Nr(l)}),a):(a.coordinates=Vn(o.coordinates),a)}function Vn(o){var a=o;return"object"!=typeof a[0]?a.slice():a.map(function(l){return Vn(l)})}function Ws(o,a,l){if(null!==o)for(var d,v,w,C,A,D,P,j,z=0,U=0,Y=o.type,rt="FeatureCollection"===Y,Fe="Feature"===Y,Tt=rt?o.features.length:1,it=0;it<Tt;it++){A=(j=!!(P=rt?o.features[it].geometry:Fe?o.geometry:o)&&"GeometryCollection"===P.type)?P.geometries.length:1;for(var Ne=0;Ne<A;Ne++){var Qe=0,At=0;if(null!==(C=j?P.geometries[Ne]:P)){D=C.coordinates;var Pt=C.type;switch(z=!l||"Polygon"!==Pt&&"MultiPolygon"!==Pt?0:1,Pt){case null:break;case"Point":if(!1===a(D,U,it,Qe,At))return!1;U++,Qe++;break;case"LineString":case"MultiPoint":for(d=0;d<D.length;d++){if(!1===a(D[d],U,it,Qe,At))return!1;U++,"MultiPoint"===Pt&&Qe++}"LineString"===Pt&&Qe++;break;case"Polygon":case"MultiLineString":for(d=0;d<D.length;d++){for(v=0;v<D[d].length-z;v++){if(!1===a(D[d][v],U,it,Qe,At))return!1;U++}"MultiLineString"===Pt&&Qe++,"Polygon"===Pt&&At++}"Polygon"===Pt&&Qe++;break;case"MultiPolygon":for(d=0;d<D.length;d++){for(At=0,v=0;v<D[d].length;v++){for(w=0;w<D[d][v].length-z;w++){if(!1===a(D[d][v][w],U,it,Qe,At))return!1;U++}At++}Qe++}break;case"GeometryCollection":for(d=0;d<C.geometries.length;d++)if(!1===Ws(C.geometries[d],a,l))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Eo(o,a){var l,d,v,w,C,A,D,P,z,U,j=0,Y="FeatureCollection"===o.type,rt="Feature"===o.type,Fe=Y?o.features.length:1;for(l=0;l<Fe;l++){for(P=Y?o.features[l].properties:rt?o.properties:{},z=Y?o.features[l].bbox:rt?o.bbox:void 0,U=Y?o.features[l].id:rt?o.id:void 0,C=(D=!!(A=Y?o.features[l].geometry:rt?o.geometry:o)&&"GeometryCollection"===A.type)?A.geometries.length:1,v=0;v<C;v++)if(null!==(w=D?A.geometries[v]:A))switch(w.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===a(w,j,P,z,U))return!1;break;case"GeometryCollection":for(d=0;d<w.geometries.length;d++)if(!1===a(w.geometries[d],j,P,z,U))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===a(null,j,P,z,U))return!1;j++}}function W(o,a){Eo(o,function(l,d,v,w,C){var D,A=null===l?null:l.type;switch(A){case null:case"Point":case"LineString":case"Polygon":return!1!==a(Xn(l,v,{bbox:w,id:C}),d,0)&&void 0}switch(A){case"MultiPoint":D="Point";break;case"MultiLineString":D="LineString";break;case"MultiPolygon":D="Polygon"}for(var P=0;P<l.coordinates.length;P++)if(!1===a(Xn({type:D,coordinates:l.coordinates[P]},v),d,P))return!1})}function Wr(o,a){var l=o.x-a.x,d=o.y-a.y;return l*l+d*d}function kt(o,a,l){var d=a.x,v=a.y,w=l.x-d,C=l.y-v;if(0!==w||0!==C){var A=((o.x-d)*w+(o.y-v)*C)/(w*w+C*C);A>1?(d=l.x,v=l.y):A>0&&(d+=w*A,v+=C*A)}return(w=o.x-d)*w+(C=o.y-v)*C}function Er(o,a,l,d,v){for(var C,w=d,A=a+1;A<l;A++){var D=kt(o[A],o[a],o[l]);D>w&&(C=A,w=D)}w>d&&(C-a>1&&Er(o,a,C,d,v),v.push(o[C]),l-C>1&&Er(o,C,l,d,v))}function Jr(o,a){var l=o.length-1,d=[o[0]];return Er(o,0,l,a,d),d.push(o[l]),d}function yn(o,a,l){if(o.length<=2)return o;var d=void 0!==a?a*a:1;return o=l?o:function hr(o,a){for(var v,l=o[0],d=[l],w=1,C=o.length;w<C;w++)Wr(v=o[w],l)>a&&(d.push(v),l=v);return l!==v&&d.push(v),d}(o,d),Jr(o,d)}function nn(o,a,l){return yn(o.map(function(d){return{x:d[0],y:d[1],z:d[2]}}),a,l).map(function(d){return d.z?[d.x,d.y,d.z]:[d.x,d.y]})}function In(o,a,l){return o.map(function(d){var v=d.map(function(C){return{x:C[0],y:C[1]}});if(v.length<4)throw new Error("invalid polygon");for(var w=yn(v,a,l).map(function(C){return[C.x,C.y]});!xn(w);)w=yn(v,a-=.01*a,l).map(function(C){return[C.x,C.y]});return(w[w.length-1][0]!==w[0][0]||w[w.length-1][1]!==w[0][1])&&w.push(w[0]),w})}function xn(o){return!(o.length<3||3===o.length&&o[2][0]===o[0][0]&&o[2][1]===o[0][1])}const _o=function ao(o,a){if(!function hn(o){return!!o&&o.constructor===Object}(a=a||{}))throw new Error("options is invalid");var l=void 0!==a.tolerance?a.tolerance:1,d=a.highQuality||!1,v=a.mutate||!1;if(!o)throw new Error("geojson is required");if(l&&l<0)throw new Error("invalid tolerance");return!0!==v&&(o=function Ko(o){if(!o)throw new Error("geojson is required");switch(o.type){case"Feature":return ks(o);case"FeatureCollection":return function oi(o){var a={type:"FeatureCollection"};return Object.keys(o).forEach(function(l){switch(l){case"type":case"features":return;default:a[l]=o[l]}}),a.features=o.features.map(function(l){return ks(l)}),a}(o);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return Nr(o);default:throw new Error("unknown GeoJSON type")}}(o)),Eo(o,function(w){!function fr(o,a,l){var d=o.type;if("Point"===d||"MultiPoint"===d)return o;!function ur(o,a){void 0===a&&(a={});var l="object"==typeof a?a.mutate:a;if(!o)throw new Error("geojson is required");var d=function ki(o,a){return"FeatureCollection"===o.type?"FeatureCollection":"GeometryCollection"===o.type?"GeometryCollection":"Feature"===o.type&&null!==o.geometry?o.geometry.type:o.type}(o),v=[];switch(d){case"LineString":v=hs(o);break;case"MultiLineString":case"Polygon":xi(o).forEach(function(C){v.push(hs(C))});break;case"MultiPolygon":xi(o).forEach(function(C){var A=[];C.forEach(function(D){A.push(hs(D))}),v.push(A)});break;case"Point":return o;case"MultiPoint":var w={};xi(o).forEach(function(C){var A=C.join("-");Object.prototype.hasOwnProperty.call(w,A)||(v.push(C),w[A]=!0)});break;default:throw new Error(d+" geometry not supported")}o.coordinates?!0===l&&(o.coordinates=v):!0===l?o.geometry.coordinates=v:Xn({type:d,coordinates:v},o.properties,{bbox:o.bbox,id:o.id})}(o,!0);var v=o.coordinates;switch(d){case"LineString":o.coordinates=nn(v,a,l);break;case"MultiLineString":o.coordinates=v.map(function(w){return nn(w,a,l)});break;case"Polygon":o.coordinates=In(v,a,l);break;case"MultiPolygon":o.coordinates=v.map(function(w){return In(w,a,l)})}}(w,l,d)}),o},Zr=Object.assign({},zn);Zr.onSetup=function(){const o=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(o),this.clearSelectedFeatures(),setTimeout(()=>{!this.map||!this.map.dragPan||this.map.dragPan.disable()},0),this.updateUIClasses({mouse:"add"}),this.activateUIButton("polygon"),this.setActionableState({trash:!0}),{polygon:o,currentVertexPosition:0,dragMoving:!1}},Zr.onDrag=Zr.onTouchMove=function(o,a){o.dragMoving=!0,this.updateUIClasses({mouse:"add"}),o.polygon.updateCoordinate(`0.${o.currentVertexPosition}`,a.lngLat.lng,a.lngLat.lat),o.currentVertexPosition++,o.polygon.updateCoordinate(`0.${o.currentVertexPosition}`,a.lngLat.lng,a.lngLat.lat)},Zr.onMouseUp=function(o,a){o.dragMoving&&(this.simplify(o.polygon),this.fireUpdate(),this.changeMode("simple_select",{featureIds:[o.polygon.id]}))},Zr.onTouchEnd=function(o,a){this.onMouseUp(o,a)},Zr.fireUpdate=function(){this.map.fire("draw.update",{action:"move",features:this.getSelected().map(o=>o.toGeoJSON())})},Zr.simplify=function(o){const a=1/Math.pow(1.05,10*this.map.getZoom());_o(o,{mutate:!0,tolerance:a,highQuality:!0})};const zo=Zr;var Rs=ue(6151);const pn={onSetup:function(o){const a=(o=o||{}).featureId;let l,d,v="forward";if(a){if(l=this.getFeature(a),!l)throw new Error("Could not find a feature with the provided featureId");let w=o.from;if(w&&"Feature"===w.type&&w.geometry&&"Point"===w.geometry.type&&(w=w.geometry),w&&"Point"===w.type&&w.coordinates&&2===w.coordinates.length&&(w=w.coordinates),!w||!Array.isArray(w))throw new Error("Please use the `from` property to indicate which point to continue the line from");const C=l.coordinates.length-1;if(l.coordinates[C][0]===w[0]&&l.coordinates[C][1]===w[1])d=C+1,l.addCoordinate(d,...l.coordinates[C]);else{if(l.coordinates[0][0]!==w[0]||l.coordinates[0][1]!==w[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");v="backwards",d=0,l.addCoordinate(d,...l.coordinates[0])}}else l=this.newFeature({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[]}}),d=0,this.addFeature(l);return this.clearSelectedFeatures(),Lr.disable(this),this.updateUIClasses({mouse:"add"}),this.activateUIButton("line_string"),this.setActionableState({trash:!0}),{line:l,currentVertexPosition:d,direction:v}},clickAnywhere:function(o,a){if(o.currentVertexPosition>0&&ti(a,o.line.coordinates[o.currentVertexPosition-1])||"backwards"===o.direction&&ti(a,o.line.coordinates[o.currentVertexPosition+1]))return this.changeMode("simple_select",{featureIds:[o.line.id]});this.updateUIClasses({mouse:"add"}),o.line.updateCoordinate(o.currentVertexPosition,a.lngLat.lng,a.lngLat.lat),"forward"===o.direction?(o.currentVertexPosition++,o.line.updateCoordinate(o.currentVertexPosition,a.lngLat.lng,a.lngLat.lat)):o.line.addCoordinate(0,a.lngLat.lng,a.lngLat.lat)},clickOnVertex:function(o){return this.changeMode("simple_select",{featureIds:[o.line.id]})},onMouseMove:function(o,a){o.line.updateCoordinate(o.currentVertexPosition,a.lngLat.lng,a.lngLat.lat),gr(a)&&this.updateUIClasses({mouse:"pointer"})}};pn.onTap=pn.onClick=function(o,a){if(gr(a))return this.clickOnVertex(o,a);this.clickAnywhere(o,a)},pn.onKeyUp=function(o,a){En(a)?this.changeMode("simple_select",{featureIds:[o.line.id]}):rr(a)&&(this.deleteFeature([o.line.id],{silent:!0}),this.changeMode("simple_select"))},pn.onStop=function(o){Lr.enable(this),this.activateUIButton(),void 0!==this.getFeature(o.line.id)&&(o.line.removeCoordinate(`${o.currentVertexPosition}`),o.line.isValid()?this.map.fire("draw.create",{features:[o.line.toGeoJSON()]}):(this.deleteFeature([o.line.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},pn.onTrash=function(o){this.deleteFeature([o.line.id],{silent:!0}),this.changeMode("simple_select")},pn.toDisplayFeatures=function(o,a,l){const d=a.properties.id===o.line.id;if(a.properties.active=d?"true":"false",!d)return l(a);a.geometry.coordinates.length<2||(a.properties.meta="feature",l(Jn(o.line.id,a.geometry.coordinates["forward"===o.direction?a.geometry.coordinates.length-2:1],""+("forward"===o.direction?a.geometry.coordinates.length-2:1),!1)),l(a))};const ji=pn;function Xo(o){var a=[1/0,1/0,-1/0,-1/0];return Ws(o,function(l){a[0]>l[0]&&(a[0]=l[0]),a[1]>l[1]&&(a[1]=l[1]),a[2]<l[0]&&(a[2]=l[0]),a[3]<l[1]&&(a[3]=l[1])}),a}Xo.default=Xo;const Ns=Xo;function _n(o,a,l){if(void 0===l&&(l={}),!o)throw new Error("point is required");if(!a)throw new Error("polygon is required");var d=Dn(o),v=Ts(a),w=v.type,C=a.bbox,A=v.coordinates;if(C&&!1===function wi(o,a){return a[0]<=o[0]&&a[1]<=o[1]&&a[2]>=o[0]&&a[3]>=o[1]}(d,C))return!1;"Polygon"===w&&(A=[A]);for(var D=!1,P=0;P<A.length&&!D;P++)if(Al(d,A[P][0],l.ignoreBoundary)){for(var z=!1,U=1;U<A[P].length&&!z;)Al(d,A[P][U],!l.ignoreBoundary)&&(z=!0),U++;z||(D=!0)}return D}function Al(o,a,l){var d=!1;a[0][0]===a[a.length-1][0]&&a[0][1]===a[a.length-1][1]&&(a=a.slice(0,a.length-1));for(var v=0,w=a.length-1;v<a.length;w=v++){var C=a[v][0],A=a[v][1],D=a[w][0],P=a[w][1];if(o[1]*(C-D)+A*(D-o[0])+P*(o[0]-C)==0&&(C-o[0])*(D-o[0])<=0&&(A-o[1])*(P-o[1])<=0)return!l;A>o[1]!=P>o[1]&&o[0]<(D-C)*(o[1]-A)/(P-A)+C&&(d=!d)}return d}ue(5943),ue(1335);const Ya=function al(o,a,l){void 0===l&&(l={});var d=Dn(o),v=Dn(a),w=sr(v[1]-d[1]),C=sr(v[0]-d[0]),A=sr(d[1]),D=sr(v[1]),P=Math.pow(Math.sin(w/2),2)+Math.pow(Math.sin(C/2),2)*Math.cos(A)*Math.cos(D);return function dt(o,a){void 0===a&&(a="kilometers");var l=wo[a];if(!l)throw new Error(a+" units is invalid");return o*l}(2*Math.atan2(Math.sqrt(P),Math.sqrt(1-P)),l.units)};var Dl=new ArrayBuffer(16);new Float64Array(Dl),new Uint32Array(Dl),ue(3544);const Sa=function(){function o(a){this.points=a.points||[],this.duration=a.duration||1e4,this.sharpness=a.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=a.stepLength||60,this.length=this.points.length,this.delay=0;for(var l=0;l<this.length;l++)this.points[l].z=this.points[l].z||0;for(l=0;l<this.length-1;l++){var d=this.points[l],v=this.points[l+1];this.centers.push({x:(d.x+v.x)/2,y:(d.y+v.y)/2,z:(d.z+v.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),l=0;l<this.centers.length-1;l++){var w=this.points[l+1].x-(this.centers[l].x+this.centers[l+1].x)/2,C=this.points[l+1].y-(this.centers[l].y+this.centers[l+1].y)/2,A=this.points[l+1].z-(this.centers[l].y+this.centers[l+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[l+1].x+this.sharpness*(this.centers[l].x+w),y:(1-this.sharpness)*this.points[l+1].y+this.sharpness*(this.centers[l].y+C),z:(1-this.sharpness)*this.points[l+1].z+this.sharpness*(this.centers[l].z+A)},{x:(1-this.sharpness)*this.points[l+1].x+this.sharpness*(this.centers[l+1].x+w),y:(1-this.sharpness)*this.points[l+1].y+this.sharpness*(this.centers[l+1].y+C),z:(1-this.sharpness)*this.points[l+1].z+this.sharpness*(this.centers[l+1].z+A)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}return o.prototype.cacheSteps=function(a){var l=[],d=this.pos(0);l.push(0);for(var v=0;v<this.duration;v+=10){var w=this.pos(v);Math.sqrt((w.x-d.x)*(w.x-d.x)+(w.y-d.y)*(w.y-d.y)+(w.z-d.z)*(w.z-d.z))>a&&(l.push(v),d=w)}return l},o.prototype.vector=function(a){var l=this.pos(a+10),d=this.pos(a-10);return{angle:180*Math.atan2(l.y-d.y,l.x-d.x)/3.14,speed:Math.sqrt((d.x-l.x)*(d.x-l.x)+(d.y-l.y)*(d.y-l.y)+(d.z-l.z)*(d.z-l.z))}},o.prototype.pos=function(a){var l=a-this.delay;l<0&&(l=0),l>this.duration&&(l=this.duration-1);var d=l/this.duration;if(d>=1)return this.points[this.length-1];var v=Math.floor((this.points.length-1)*d);return function Ni(o,a,l,d,v){var w=function os(o){var a=o*o;return[a*o,3*a*(1-o),3*o*(1-o)*(1-o),(1-o)*(1-o)*(1-o)]}(o);return{x:v.x*w[0]+d.x*w[1]+l.x*w[2]+a.x*w[3],y:v.y*w[0]+d.y*w[1]+l.y*w[2]+a.y*w[3],z:v.z*w[0]+d.z*w[1]+l.z*w[2]+a.z*w[3]}}((this.length-1)*d-v,this.points[v],this.controls[v][1],this.controls[v+1][0],this.points[v+1])},o}();function Pi(o,a,l,d){void 0===d&&(d={});var v=Dn(o),w=sr(v[0]),C=sr(v[1]),A=sr(l),D=function Dt(o,a){void 0===a&&(a="kilometers");var l=wo[a];if(!l)throw new Error(a+" units is invalid");return o/l}(a,d.units),P=Math.asin(Math.sin(C)*Math.cos(D)+Math.cos(C)*Math.sin(D)*Math.cos(A));return Bn([Ct(w+Math.atan2(Math.sin(A)*Math.sin(D)*Math.cos(C),Math.cos(D)-Math.sin(C)*Math.sin(P))),Ct(P)],d.properties)}function fl(o){return function R(o,a,l){var d=l;return Eo(o,function(v,w,C,A,D){d=0===w&&void 0===l?v:a(d,v,w,C,A,D)}),d}(o,function(a,l){return a+function Nu(o){var l,a=0;switch(o.type){case"Polygon":return Hl(o.coordinates);case"MultiPolygon":for(l=0;l<o.coordinates.length;l++)a+=Hl(o.coordinates[l]);return a;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(l)},0)}function Hl(o){var a=0;if(o&&o.length>0){a+=Math.abs(kl(o[0]));for(var l=1;l<o.length;l++)a-=Math.abs(kl(o[l]))}return a}function kl(o){var a,l,v,w,C,A,D=0,P=o.length;if(P>2){for(A=0;A<P;A++)A===P-2?(v=P-2,w=P-1,C=0):A===P-1?(v=P-1,w=0,C=1):(v=A,w=A+1,C=A+2),a=o[v],l=o[w],D+=(Zn(o[C][0])-Zn(a[0]))*Math.sin(Zn(l[1]));D=6378137*D*6378137/2}return D}function Zn(o){return o*Math.PI/180}function Pa(o,a){return void 0===a&&(a={}),function Gt(o,a,l){var d=l,v=!1;return function Et(o,a){W(o,function(l,d,v){var w=0;if(l.geometry){var C=l.geometry.type;if("Point"!==C&&"MultiPoint"!==C){var A,D=0,P=0,z=0;if(!1===Ws(l,function(U,j,Y,rt,Fe){if(void 0===A||d>D||rt>P||Fe>z)return A=U,D=d,P=rt,z=Fe,void(w=0);var Tt=Sn([A,U],l.properties);if(!1===a(Tt,d,v,Fe,w))return!1;w++,A=U}))return!1}}})}(o,function(w,C,A,D,P){d=!1===v&&void 0===l?w:a(d,w,C,A,D,P),v=!0}),d}(o,function(l,d){var v=d.geometry.coordinates;return l+Ya(v[0],v[1],a)},0)}ue(5469),ue(5406);var dc=Math.PI/180,g=180/Math.PI,i=function(o,a){this.lon=o,this.lat=a,this.x=dc*o,this.y=dc*a};i.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},i.prototype.antipode=function(){return new i(this.lon<0?180+this.lon:-1*(180-this.lon),-1*this.lat)};var h=function(){this.coords=[],this.length=0};h.prototype.move_to=function(o){this.length++,this.coords.push(o)};var _=function(o){this.properties=o||{},this.geometries=[]};_.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var o=[],a=0;a<this.geometries.length;a++)o.push(this.geometries[a].coords);return{geometry:{type:"MultiLineString",coordinates:o},type:"Feature",properties:this.properties}},_.prototype.wkt=function(){for(var o="",a="LINESTRING(",l=function(w){a+=w[0]+" "+w[1]+","},d=0;d<this.geometries.length;d++){if(0===this.geometries[d].coords.length)return"LINESTRING(empty)";this.geometries[d].coords.forEach(l),o+=a.substring(0,a.length-1)+")"}return o};var E=function(o,a,l){if(!o||void 0===o.x||void 0===o.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!a||void 0===a.x||void 0===a.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new i(o.x,o.y),this.end=new i(a.x,a.y),this.properties=l||{};var d=this.start.x-this.end.x,w=Math.pow(Math.sin((this.start.y-this.end.y)/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(d/2),2);if(this.g=2*Math.asin(Math.sqrt(w)),this.g===Math.PI)throw new Error("it appears "+o.view()+" and "+a.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+o+" and "+a)};E.prototype.interpolate=function(o){var a=Math.sin((1-o)*this.g)/Math.sin(this.g),l=Math.sin(o*this.g)/Math.sin(this.g),d=a*Math.cos(this.start.y)*Math.cos(this.start.x)+l*Math.cos(this.end.y)*Math.cos(this.end.x),v=a*Math.cos(this.start.y)*Math.sin(this.start.x)+l*Math.cos(this.end.y)*Math.sin(this.end.x),w=a*Math.sin(this.start.y)+l*Math.sin(this.end.y),C=g*Math.atan2(w,Math.sqrt(Math.pow(d,2)+Math.pow(v,2)));return[g*Math.atan2(v,d),C]},E.prototype.Arc=function(o,a){var l=[];if(!o||o<=2)l.push([this.start.lon,this.start.lat]),l.push([this.end.lon,this.end.lat]);else for(var d=1/(o-1),v=0;v<o;++v){var C=this.interpolate(d*v);l.push(C)}for(var A=!1,D=0,P=a&&a.offset?a.offset:10,z=180-P,U=-180+P,j=360-P,Y=1;Y<l.length;++Y){var rt=l[Y-1][0],Fe=l[Y][0],Tt=Math.abs(Fe-rt);Tt>j&&(Fe>z&&rt<U||rt>z&&Fe<U)?A=!0:Tt>D&&(D=Tt)}var it=[];if(A&&D<P){var Ne=[];it.push(Ne);for(var Qe=0;Qe<l.length;++Qe){var At=parseFloat(l[Qe][0]);if(Qe>0&&Math.abs(At-l[Qe-1][0])>j){var Pt=parseFloat(l[Qe-1][0]),Yt=parseFloat(l[Qe-1][1]),qt=parseFloat(l[Qe][0]),or=parseFloat(l[Qe][1]);if(Pt>-180&&Pt<U&&180===qt&&Qe+1<l.length&&l[Qe-1][0]>-180&&l[Qe-1][0]<U){Ne.push([-180,l[Qe][1]]),Qe++,Ne.push([l[Qe][0],l[Qe][1]]);continue}if(Pt>z&&Pt<180&&-180===qt&&Qe+1<l.length&&l[Qe-1][0]>z&&l[Qe-1][0]<180){Ne.push([180,l[Qe][1]]),Qe++,Ne.push([l[Qe][0],l[Qe][1]]);continue}if(Pt<U&&qt>z){var ct=Pt;Pt=qt,qt=ct;var Hn=Yt;Yt=or,or=Hn}if(Pt>z&&qt<U&&(qt+=360),Pt<=180&&qt>=180&&Pt<qt){var vn=(180-Pt)/(qt-Pt),mi=vn*or+(1-vn)*Yt;Ne.push([l[Qe-1][0]>z?180:-180,mi]),(Ne=[]).push([l[Qe-1][0]>z?-180:180,mi]),it.push(Ne)}else it.push(Ne=[]);Ne.push([At,l[Qe][1]])}else Ne.push([l[Qe][0],l[Qe][1]])}}else{var Mi=[];it.push(Mi);for(var $r=0;$r<l.length;++$r)Mi.push([l[$r][0],l[$r][1]])}for(var Wn=new _(this.properties),On=0;On<it.length;++On){var Zo=new h;Wn.geometries.push(Zo);for(var Fo=it[On],Gi=0;Gi<Fo.length;++Gi)Zo.move_to(Fo[Gi])}return Wn},ue(6952);var fi=[],Yn=[],ii=[],li=[],ui=[],bi=[],_i=[],ci=[],Ai=[],zi=[],Zi=[],Ui=[],Xi=[],$i=[],Yi=[],Wi=[],Hi=[],Ji=[],Ki=[],Qi=[],eo=[],io=[],oo=[],Ci=[];_i[85]=zi[85]=-1,ci[85]=Zi[85]=0,Ai[85]=Ui[85]=1,Ki[85]=io[85]=1,Qi[85]=oo[85]=0,eo[85]=Ci[85]=1,fi[85]=li[85]=0,Yn[85]=ui[85]=-1,ii[85]=Yi[85]=0,Wi[85]=Xi[85]=0,Hi[85]=$i[85]=1,bi[85]=Ji[85]=1,io[1]=io[169]=0,oo[1]=oo[169]=-1,Ci[1]=Ci[169]=0,Xi[1]=Xi[169]=-1,$i[1]=$i[169]=0,Yi[1]=Yi[169]=0,zi[4]=zi[166]=0,Zi[4]=Zi[166]=-1,Ui[4]=Ui[166]=1,Wi[4]=Wi[166]=1,Hi[4]=Hi[166]=0,Ji[4]=Ji[166]=0,_i[16]=_i[154]=0,ci[16]=ci[154]=1,Ai[16]=Ai[154]=1,li[16]=li[154]=1,ui[16]=ui[154]=0,bi[16]=bi[154]=1,Ki[64]=Ki[106]=0,Qi[64]=Qi[106]=1,eo[64]=eo[106]=0,fi[64]=fi[106]=-1,Yn[64]=Yn[106]=0,ii[64]=ii[106]=1,Ki[2]=Ki[168]=0,Qi[2]=Qi[168]=-1,eo[2]=eo[168]=1,io[2]=io[168]=0,oo[2]=oo[168]=-1,Ci[2]=Ci[168]=0,Xi[2]=Xi[168]=-1,$i[2]=$i[168]=0,Yi[2]=Yi[168]=0,Wi[2]=Wi[168]=-1,Hi[2]=Hi[168]=0,Ji[2]=Ji[168]=1,_i[8]=_i[162]=0,ci[8]=ci[162]=-1,Ai[8]=Ai[162]=0,zi[8]=zi[162]=0,Zi[8]=Zi[162]=-1,Ui[8]=Ui[162]=1,Xi[8]=Xi[162]=1,$i[8]=$i[162]=0,Yi[8]=Yi[162]=1,Wi[8]=Wi[162]=1,Hi[8]=Hi[162]=0,Ji[8]=Ji[162]=0,_i[32]=_i[138]=0,ci[32]=ci[138]=1,Ai[32]=Ai[138]=1,zi[32]=zi[138]=0,Zi[32]=Zi[138]=1,Ui[32]=Ui[138]=0,fi[32]=fi[138]=1,Yn[32]=Yn[138]=0,ii[32]=ii[138]=0,li[32]=li[138]=1,ui[32]=ui[138]=0,bi[32]=bi[138]=1,io[128]=io[42]=0,oo[128]=oo[42]=1,Ci[128]=Ci[42]=1,Ki[128]=Ki[42]=0,Qi[128]=Qi[42]=1,eo[128]=eo[42]=0,fi[128]=fi[42]=-1,Yn[128]=Yn[42]=0,ii[128]=ii[42]=1,li[128]=li[42]=-1,ui[128]=ui[42]=0,bi[128]=bi[42]=0,zi[5]=zi[165]=-1,Zi[5]=Zi[165]=0,Ui[5]=Ui[165]=0,io[5]=io[165]=1,oo[5]=oo[165]=0,Ci[5]=Ci[165]=0,Wi[20]=Wi[150]=0,Hi[20]=Hi[150]=1,Ji[20]=Ji[150]=1,li[20]=li[150]=0,ui[20]=ui[150]=-1,bi[20]=bi[150]=1,_i[80]=_i[90]=-1,ci[80]=ci[90]=0,Ai[80]=Ai[90]=1,Ki[80]=Ki[90]=1,Qi[80]=Qi[90]=0,eo[80]=eo[90]=1,Xi[65]=Xi[105]=0,$i[65]=$i[105]=1,Yi[65]=Yi[105]=0,fi[65]=fi[105]=0,Yn[65]=Yn[105]=-1,ii[65]=ii[105]=0,_i[160]=_i[10]=-1,ci[160]=ci[10]=0,Ai[160]=Ai[10]=1,zi[160]=zi[10]=-1,Zi[160]=Zi[10]=0,Ui[160]=Ui[10]=0,io[160]=io[10]=1,oo[160]=oo[10]=0,Ci[160]=Ci[10]=0,Ki[160]=Ki[10]=1,Qi[160]=Qi[10]=0,eo[160]=eo[10]=1,Wi[130]=Wi[40]=0,Hi[130]=Hi[40]=1,Ji[130]=Ji[40]=1,Xi[130]=Xi[40]=0,$i[130]=$i[40]=1,Yi[130]=Yi[40]=0,fi[130]=fi[40]=0,Yn[130]=Yn[40]=-1,ii[130]=ii[40]=0,li[130]=li[40]=0,ui[130]=ui[40]=-1,bi[130]=bi[40]=1,zi[37]=zi[133]=0,Zi[37]=Zi[133]=1,Ui[37]=Ui[133]=1,io[37]=io[133]=0,oo[37]=oo[133]=1,Ci[37]=Ci[133]=0,fi[37]=fi[133]=-1,Yn[37]=Yn[133]=0,ii[37]=ii[133]=0,li[37]=li[133]=1,ui[37]=ui[133]=0,bi[37]=bi[133]=0,Wi[148]=Wi[22]=-1,Hi[148]=Hi[22]=0,Ji[148]=Ji[22]=0,io[148]=io[22]=0,oo[148]=oo[22]=-1,Ci[148]=Ci[22]=1,Ki[148]=Ki[22]=0,Qi[148]=Qi[22]=1,eo[148]=eo[22]=1,li[148]=li[22]=-1,ui[148]=ui[22]=0,bi[148]=bi[22]=1,_i[82]=_i[88]=0,ci[82]=ci[88]=-1,Ai[82]=Ai[88]=1,Wi[82]=Wi[88]=1,Hi[82]=Hi[88]=0,Ji[82]=Ji[88]=1,Xi[82]=Xi[88]=-1,$i[82]=$i[88]=0,Yi[82]=Yi[88]=1,Ki[82]=Ki[88]=0,Qi[82]=Qi[88]=-1,eo[82]=eo[88]=0,_i[73]=_i[97]=0,ci[73]=ci[97]=1,Ai[73]=Ai[97]=0,zi[73]=zi[97]=0,Zi[73]=Zi[97]=-1,Ui[73]=Ui[97]=0,Xi[73]=Xi[97]=1,$i[73]=$i[97]=0,Yi[73]=Yi[97]=0,fi[73]=fi[97]=1,Yn[73]=Yn[97]=0,ii[73]=ii[97]=1,_i[145]=_i[25]=0,ci[145]=ci[25]=-1,Ai[145]=Ai[25]=0,Xi[145]=Xi[25]=1,$i[145]=$i[25]=0,Yi[145]=Yi[25]=1,io[145]=io[25]=0,oo[145]=oo[25]=1,Ci[145]=Ci[25]=1,li[145]=li[25]=-1,ui[145]=ui[25]=0,bi[145]=bi[25]=0,zi[70]=zi[100]=0,Zi[70]=Zi[100]=1,Ui[70]=Ui[100]=0,Wi[70]=Wi[100]=-1,Hi[70]=Hi[100]=0,Ji[70]=Ji[100]=1,Ki[70]=Ki[100]=0,Qi[70]=Qi[100]=-1,eo[70]=eo[100]=1,fi[70]=fi[100]=1,Yn[70]=Yn[100]=0,ii[70]=ii[100]=0,zi[101]=zi[69]=0,Zi[101]=Zi[69]=1,Ui[101]=Ui[69]=0,fi[101]=fi[69]=1,Yn[101]=Yn[69]=0,ii[101]=ii[69]=0,io[149]=io[21]=0,oo[149]=oo[21]=1,Ci[149]=Ci[21]=1,li[149]=li[21]=-1,ui[149]=ui[21]=0,bi[149]=bi[21]=0,Wi[86]=Wi[84]=-1,Hi[86]=Hi[84]=0,Ji[86]=Ji[84]=1,Ki[86]=Ki[84]=0,Qi[86]=Qi[84]=-1,eo[86]=eo[84]=1,_i[89]=_i[81]=0,ci[89]=ci[81]=-1,Ai[89]=Ai[81]=0,Xi[89]=Xi[81]=1,$i[89]=$i[81]=0,Yi[89]=Yi[81]=1,_i[96]=_i[74]=0,ci[96]=ci[74]=1,Ai[96]=Ai[74]=0,zi[96]=zi[74]=-1,Zi[96]=Zi[74]=0,Ui[96]=Ui[74]=1,Ki[96]=Ki[74]=1,Qi[96]=Qi[74]=0,eo[96]=eo[74]=0,fi[96]=fi[74]=1,Yn[96]=Yn[74]=0,ii[96]=ii[74]=1,_i[24]=_i[146]=0,ci[24]=ci[146]=-1,Ai[24]=Ai[146]=1,Wi[24]=Wi[146]=1,Hi[24]=Hi[146]=0,Ji[24]=Ji[146]=1,Xi[24]=Xi[146]=0,$i[24]=$i[146]=1,Yi[24]=Yi[146]=1,li[24]=li[146]=0,ui[24]=ui[146]=-1,bi[24]=bi[146]=0,zi[6]=zi[164]=-1,Zi[6]=Zi[164]=0,Ui[6]=Ui[164]=1,Wi[6]=Wi[164]=-1,Hi[6]=Hi[164]=0,Ji[6]=Ji[164]=0,io[6]=io[164]=0,oo[6]=oo[164]=-1,Ci[6]=Ci[164]=1,Ki[6]=Ki[164]=1,Qi[6]=Qi[164]=0,eo[6]=eo[164]=0,Xi[129]=Xi[41]=0,$i[129]=$i[41]=1,Yi[129]=Yi[41]=1,io[129]=io[41]=0,oo[129]=oo[41]=1,Ci[129]=Ci[41]=0,fi[129]=fi[41]=-1,Yn[129]=Yn[41]=0,ii[129]=ii[41]=0,li[129]=li[41]=0,ui[129]=ui[41]=-1,bi[129]=bi[41]=0,Wi[66]=Wi[104]=0,Hi[66]=Hi[104]=1,Ji[66]=Ji[104]=0,Xi[66]=Xi[104]=-1,$i[66]=$i[104]=0,Yi[66]=Yi[104]=1,Ki[66]=Ki[104]=0,Qi[66]=Qi[104]=-1,eo[66]=eo[104]=0,fi[66]=fi[104]=0,Yn[66]=Yn[104]=-1,ii[66]=ii[104]=1,_i[144]=_i[26]=-1,ci[144]=ci[26]=0,Ai[144]=Ai[26]=0,io[144]=io[26]=1,oo[144]=oo[26]=0,Ci[144]=Ci[26]=1,Ki[144]=Ki[26]=0,Qi[144]=Qi[26]=1,eo[144]=eo[26]=1,li[144]=li[26]=-1,ui[144]=ui[26]=0,bi[144]=bi[26]=1,zi[36]=zi[134]=0,Zi[36]=Zi[134]=1,Ui[36]=Ui[134]=1,Wi[36]=Wi[134]=0,Hi[36]=Hi[134]=1,Ji[36]=Ji[134]=0,fi[36]=fi[134]=0,Yn[36]=Yn[134]=-1,ii[36]=ii[134]=1,li[36]=li[134]=1,ui[36]=ui[134]=0,bi[36]=bi[134]=0,_i[9]=_i[161]=-1,ci[9]=ci[161]=0,Ai[9]=Ai[161]=0,zi[9]=zi[161]=0,Zi[9]=Zi[161]=-1,Ui[9]=Ui[161]=0,Xi[9]=Xi[161]=1,$i[9]=$i[161]=0,Yi[9]=Yi[161]=0,io[9]=io[161]=1,oo[9]=oo[161]=0,Ci[9]=Ci[161]=1,_i[136]=0,ci[136]=1,Ai[136]=1,zi[136]=0,Zi[136]=1,Ui[136]=0,Wi[136]=-1,Hi[136]=0,Ji[136]=1,Xi[136]=-1,$i[136]=0,Yi[136]=0,io[136]=0,oo[136]=-1,Ci[136]=0,Ki[136]=0,Qi[136]=-1,eo[136]=1,fi[136]=1,Yn[136]=0,ii[136]=0,li[136]=1,ui[136]=0,bi[136]=1,_i[34]=0,ci[34]=-1,Ai[34]=0,zi[34]=0,Zi[34]=-1,Ui[34]=1,Wi[34]=1,Hi[34]=0,Ji[34]=0,Xi[34]=1,$i[34]=0,Yi[34]=1,io[34]=0,oo[34]=1,Ci[34]=1,Ki[34]=0,Qi[34]=1,eo[34]=0,fi[34]=-1,Yn[34]=0,ii[34]=1,li[34]=-1,ui[34]=0,bi[34]=0,_i[35]=0,ci[35]=1,Ai[35]=1,zi[35]=0,Zi[35]=-1,Ui[35]=1,Wi[35]=1,Hi[35]=0,Ji[35]=0,Xi[35]=-1,$i[35]=0,Yi[35]=0,io[35]=0,oo[35]=-1,Ci[35]=0,Ki[35]=0,Qi[35]=1,eo[35]=0,fi[35]=-1,Yn[35]=0,ii[35]=1,li[35]=1,ui[35]=0,bi[35]=1,_i[153]=0,ci[153]=1,Ai[153]=1,Xi[153]=-1,$i[153]=0,Yi[153]=0,io[153]=0,oo[153]=-1,Ci[153]=0,li[153]=1,ui[153]=0,bi[153]=1,zi[102]=0,Zi[102]=-1,Ui[102]=1,Wi[102]=1,Hi[102]=0,Ji[102]=0,Ki[102]=0,Qi[102]=1,eo[102]=0,fi[102]=-1,Yn[102]=0,ii[102]=1,_i[155]=0,ci[155]=-1,Ai[155]=0,Xi[155]=1,$i[155]=0,Yi[155]=1,io[155]=0,oo[155]=1,Ci[155]=1,li[155]=-1,ui[155]=0,bi[155]=0,zi[103]=0,Zi[103]=1,Ui[103]=0,Wi[103]=-1,Hi[103]=0,Ji[103]=1,Ki[103]=0,Qi[103]=-1,eo[103]=1,fi[103]=1,Yn[103]=0,ii[103]=0,_i[152]=0,ci[152]=1,Ai[152]=1,Wi[152]=-1,Hi[152]=0,Ji[152]=1,Xi[152]=-1,$i[152]=0,Yi[152]=0,io[152]=0,oo[152]=-1,Ci[152]=0,Ki[152]=0,Qi[152]=-1,eo[152]=1,li[152]=1,ui[152]=0,bi[152]=1,_i[156]=0,ci[156]=-1,Ai[156]=1,Wi[156]=1,Hi[156]=0,Ji[156]=1,Xi[156]=-1,$i[156]=0,Yi[156]=0,io[156]=0,oo[156]=-1,Ci[156]=0,Ki[156]=0,Qi[156]=1,eo[156]=1,li[156]=-1,ui[156]=0,bi[156]=1,_i[137]=0,ci[137]=1,Ai[137]=1,zi[137]=0,Zi[137]=1,Ui[137]=0,Xi[137]=-1,$i[137]=0,Yi[137]=0,io[137]=0,oo[137]=-1,Ci[137]=0,fi[137]=1,Yn[137]=0,ii[137]=0,li[137]=1,ui[137]=0,bi[137]=1,_i[139]=0,ci[139]=1,Ai[139]=1,zi[139]=0,Zi[139]=-1,Ui[139]=0,Xi[139]=1,$i[139]=0,Yi[139]=0,io[139]=0,oo[139]=1,Ci[139]=0,fi[139]=-1,Yn[139]=0,ii[139]=0,li[139]=1,ui[139]=0,bi[139]=1,_i[98]=0,ci[98]=-1,Ai[98]=0,zi[98]=0,Zi[98]=-1,Ui[98]=1,Wi[98]=1,Hi[98]=0,Ji[98]=0,Xi[98]=1,$i[98]=0,Yi[98]=1,Ki[98]=0,Qi[98]=1,eo[98]=0,fi[98]=-1,Yn[98]=0,ii[98]=1,_i[99]=0,ci[99]=1,Ai[99]=0,zi[99]=0,Zi[99]=-1,Ui[99]=1,Wi[99]=1,Hi[99]=0,Ji[99]=0,Xi[99]=-1,$i[99]=0,Yi[99]=1,Ki[99]=0,Qi[99]=-1,eo[99]=0,fi[99]=1,Yn[99]=0,ii[99]=1,zi[38]=0,Zi[38]=-1,Ui[38]=1,Wi[38]=1,Hi[38]=0,Ji[38]=0,io[38]=0,oo[38]=1,Ci[38]=1,Ki[38]=0,Qi[38]=1,eo[38]=0,fi[38]=-1,Yn[38]=0,ii[38]=1,li[38]=-1,ui[38]=0,bi[38]=0,zi[39]=0,Zi[39]=1,Ui[39]=1,Wi[39]=-1,Hi[39]=0,Ji[39]=0,io[39]=0,oo[39]=-1,Ci[39]=1,Ki[39]=0,Qi[39]=1,eo[39]=0,fi[39]=-1,Yn[39]=0,ii[39]=1,li[39]=1,ui[39]=0,bi[39]=0;var Lp=function(o){return[[o.bottomleft,0],[0,0],[0,o.leftbottom]]},Dp=function(o){return[[1,o.rightbottom],[1,0],[o.bottomright,0]]},Op=function(o){return[[o.topright,1],[1,1],[1,o.righttop]]},Uf=function(o){return[[0,o.lefttop],[0,1],[o.topleft,1]]},ph=function(o){return[[o.bottomright,0],[o.bottomleft,0],[0,o.leftbottom],[0,o.lefttop]]},kp=function(o){return[[o.bottomright,0],[o.bottomleft,0],[1,o.righttop],[1,o.rightbottom]]},Gh=function(o){return[[1,o.righttop],[1,o.rightbottom],[o.topleft,1],[o.topright,1]]},fh=function(o){return[[0,o.leftbottom],[0,o.lefttop],[o.topleft,1],[o.topright,1]]},an=[],tn=[],bn=[],ln=[],Qn=[],kn=[],to=[],Li=[];ln[1]=Qn[1]=18,ln[169]=Qn[169]=18,bn[4]=tn[4]=12,bn[166]=tn[166]=12,an[16]=Li[16]=4,an[154]=Li[154]=4,kn[64]=to[64]=22,kn[106]=to[106]=22,bn[2]=kn[2]=17,ln[2]=Qn[2]=18,bn[168]=kn[168]=17,ln[168]=Qn[168]=18,an[8]=ln[8]=9,tn[8]=bn[8]=12,an[162]=ln[162]=9,tn[162]=bn[162]=12,an[32]=Li[32]=4,tn[32]=to[32]=1,an[138]=Li[138]=4,tn[138]=to[138]=1,Qn[128]=Li[128]=21,kn[128]=to[128]=22,Qn[42]=Li[42]=21,kn[42]=to[42]=22,tn[5]=Qn[5]=14,tn[165]=Qn[165]=14,bn[20]=Li[20]=6,bn[150]=Li[150]=6,an[80]=kn[80]=11,an[90]=kn[90]=11,ln[65]=to[65]=3,ln[105]=to[105]=3,an[160]=kn[160]=11,tn[160]=Qn[160]=14,an[10]=kn[10]=11,tn[10]=Qn[10]=14,bn[130]=Li[130]=6,ln[130]=to[130]=3,bn[40]=Li[40]=6,ln[40]=to[40]=3,tn[101]=to[101]=1,tn[69]=to[69]=1,Qn[149]=Li[149]=21,Qn[21]=Li[21]=21,bn[86]=kn[86]=17,bn[84]=kn[84]=17,an[89]=ln[89]=9,an[81]=ln[81]=9,an[96]=to[96]=0,tn[96]=kn[96]=15,an[74]=to[74]=0,tn[74]=kn[74]=15,an[24]=bn[24]=8,ln[24]=Li[24]=7,an[146]=bn[146]=8,ln[146]=Li[146]=7,tn[6]=kn[6]=15,bn[6]=Qn[6]=16,tn[164]=kn[164]=15,bn[164]=Qn[164]=16,ln[129]=Li[129]=7,Qn[129]=to[129]=20,ln[41]=Li[41]=7,Qn[41]=to[41]=20,bn[66]=to[66]=2,ln[66]=kn[66]=19,bn[104]=to[104]=2,ln[104]=kn[104]=19,an[144]=Qn[144]=10,kn[144]=Li[144]=23,an[26]=Qn[26]=10,kn[26]=Li[26]=23,tn[36]=Li[36]=5,bn[36]=to[36]=2,tn[134]=Li[134]=5,bn[134]=to[134]=2,an[9]=Qn[9]=10,tn[9]=ln[9]=13,an[161]=Qn[161]=10,tn[161]=ln[161]=13,tn[37]=Li[37]=5,Qn[37]=to[37]=20,tn[133]=Li[133]=5,Qn[133]=to[133]=20,bn[148]=Qn[148]=16,kn[148]=Li[148]=23,bn[22]=Qn[22]=16,kn[22]=Li[22]=23,an[82]=bn[82]=8,ln[82]=kn[82]=19,an[88]=bn[88]=8,ln[88]=kn[88]=19,an[73]=to[73]=0,tn[73]=ln[73]=13,an[97]=to[97]=0,tn[97]=ln[97]=13,an[145]=ln[145]=9,Qn[145]=Li[145]=21,an[25]=ln[25]=9,Qn[25]=Li[25]=21,tn[70]=to[70]=1,bn[70]=kn[70]=17,tn[100]=to[100]=1,bn[100]=kn[100]=17,an[34]=ln[34]=9,tn[34]=bn[34]=12,Qn[34]=Li[34]=21,kn[34]=to[34]=22,an[136]=Li[136]=4,tn[136]=to[136]=1,bn[136]=kn[136]=17,ln[136]=Qn[136]=18,an[35]=Li[35]=4,tn[35]=bn[35]=12,ln[35]=Qn[35]=18,kn[35]=to[35]=22,an[153]=Li[153]=4,ln[153]=Qn[153]=18,tn[102]=bn[102]=12,kn[102]=to[102]=22,an[155]=ln[155]=9,Qn[155]=Li[155]=23,tn[103]=to[103]=1,bn[103]=kn[103]=17,an[152]=Li[152]=4,bn[152]=kn[152]=17,ln[152]=Qn[152]=18,an[156]=bn[156]=8,ln[156]=Qn[156]=18,kn[156]=Li[156]=23,an[137]=Li[137]=4,tn[137]=to[137]=1,ln[137]=Qn[137]=18,an[139]=Li[139]=4,tn[139]=ln[139]=13,Qn[139]=to[139]=20,an[98]=ln[98]=9,tn[98]=bn[98]=12,kn[98]=to[98]=22,an[99]=to[99]=0,tn[99]=bn[99]=12,ln[99]=kn[99]=19,tn[38]=bn[38]=12,Qn[38]=Li[38]=21,kn[38]=to[38]=22,tn[39]=Li[39]=5,bn[39]=Qn[39]=16,kn[39]=to[39]=22;var on=[];function Xh(o,a,l){return function Vc(o){return(o>0)-(o<0)||+o}((a[0]-o[0])*(l[1]-a[1])-(l[0]-a[0])*(a[1]-o[1]))}function Yf(o,a){return a.geometry.coordinates[0].every(function(l){return _n(Bn(l),o)})}on[1]=on[169]=Lp,on[4]=on[166]=Dp,on[16]=on[154]=Op,on[64]=on[106]=Uf,on[168]=on[2]=ph,on[162]=on[8]=kp,on[138]=on[32]=Gh,on[42]=on[128]=fh,on[5]=on[165]=function(o){return[[0,0],[0,o.leftbottom],[1,o.rightbottom],[1,0]]},on[20]=on[150]=function(o){return[[1,0],[o.bottomright,0],[o.topright,1],[1,1]]},on[80]=on[90]=function(o){return[[1,1],[1,o.righttop],[0,o.lefttop],[0,1]]},on[65]=on[105]=function(o){return[[o.bottomleft,0],[0,0],[0,1],[o.topleft,1]]},on[160]=on[10]=function(o){return[[1,o.righttop],[1,o.rightbottom],[0,o.leftbottom],[0,o.lefttop]]},on[130]=on[40]=function(o){return[[o.topleft,1],[o.topright,1],[o.bottomright,0],[o.bottomleft,0]]},on[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},on[101]=on[69]=function(o){return[[1,o.rightbottom],[1,0],[0,0],[0,1],[o.topleft,1]]},on[149]=on[21]=function(o){return[[o.topright,1],[1,1],[1,0],[0,0],[0,o.leftbottom]]},on[86]=on[84]=function(o){return[[1,0],[o.bottomright,0],[0,o.lefttop],[0,1],[1,1]]},on[89]=on[81]=function(o){return[[1,1],[1,o.righttop],[o.bottomleft,0],[0,0],[0,1]]},on[96]=on[74]=function(o){return[[1,o.righttop],[1,o.rightbottom],[0,o.lefttop],[0,1],[o.topleft,1]]},on[24]=on[146]=function(o){return[[1,1],[1,o.righttop],[o.bottomright,0],[o.bottomleft,0],[o.topright,1]]},on[6]=on[164]=function(o){return[[1,o.rightbottom],[1,0],[o.bottomright,0],[0,o.leftbottom],[0,o.lefttop]]},on[129]=on[41]=function(o){return[[o.topright,1],[o.bottomleft,0],[0,0],[0,o.leftbottom],[o.topleft,1]]},on[66]=on[104]=function(o){return[[o.bottomright,0],[o.bottomleft,0],[0,o.lefttop],[0,1],[o.topleft,1]]},on[144]=on[26]=function(o){return[[1,1],[1,o.righttop],[0,o.leftbottom],[0,o.lefttop],[o.topright,1]]},on[36]=on[134]=function(o){return[[1,o.rightbottom],[1,0],[o.bottomright,0],[o.topleft,1],[o.topright,1]]},on[9]=on[161]=function(o){return[[1,o.righttop],[1,o.rightbottom],[o.bottomleft,0],[0,0],[0,o.leftbottom]]},on[37]=on[133]=function(o){return[[1,o.rightbottom],[1,0],[0,0],[0,o.leftbottom],[o.topleft,1],[o.topright,1]]},on[148]=on[22]=function(o){return[[1,1],[1,0],[o.bottomright,0],[0,o.leftbottom],[0,o.lefttop],[o.topright,1]]},on[82]=on[88]=function(o){return[[1,1],[1,o.righttop],[o.bottomright,0],[o.bottomleft,0],[0,o.lefttop],[0,1]]},on[73]=on[97]=function(o){return[[1,o.righttop],[1,o.rightbottom],[o.bottomleft,0],[0,0],[0,1],[o.topleft,1]]},on[145]=on[25]=function(o){return[[1,1],[1,o.righttop],[o.bottomleft,0],[0,0],[0,o.leftbottom],[o.topright,1]]},on[70]=on[100]=function(o){return[[1,o.rightbottom],[1,0],[o.bottomright,0],[0,o.lefttop],[0,1],[o.topleft,1]]},on[34]=function(o){return[fh(o),kp(o)]},on[35]=function(o){return[[1,o.righttop],[1,o.rightbottom],[o.bottomright,0],[o.bottomleft,0],[0,o.leftbottom],[0,o.lefttop],[o.topleft,1],[o.topright,1]]},on[136]=function(o){return[Gh(o),ph(o)]},on[153]=function(o){return[Op(o),Lp(o)]},on[102]=function(o){return[Dp(o),Uf(o)]},on[155]=function(o){return[[1,1],[1,o.righttop],[o.bottomleft,0],[0,0],[0,o.leftbottom],[o.topright,1]]},on[103]=function(o){return[[1,o.rightbottom],[1,0],[o.bottomright,0],[0,o.lefttop],[0,1],[o.topleft,1]]},on[152]=function(o){return[Op(o),ph(o)]},on[156]=function(o){return[[1,1],[1,o.righttop],[o.bottomright,0],[o.bottomleft,0],[0,o.leftbottom],[0,o.lefttop],[o.topright,1]]},on[137]=function(o){return[Gh(o),Lp(o)]},on[139]=function(o){return[[1,o.righttop],[1,o.rightbottom],[o.bottomleft,0],[0,0],[0,o.leftbottom],[o.topleft,1],[o.topright,1]]},on[98]=function(o){return[kp(o),Uf(o)]},on[99]=function(o){return[[1,o.righttop],[1,o.rightbottom],[o.bottomright,0],[o.bottomleft,0],[0,o.lefttop],[0,1],[o.topleft,1]]},on[38]=function(o){return[Dp(o),fh(o)]},on[39]=function(o){return[[1,o.rightbottom],[1,0],[o.bottomright,0],[0,o.leftbottom],[0,o.lefttop],[o.topleft,1],[o.topright,1]]};const Vp=function(){function o(a){this.id=o.buildId(a),this.coordinates=a,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return o.buildId=function(a){return a.join(",")},o.prototype.removeInnerEdge=function(a){this.innerEdges=this.innerEdges.filter(function(l){return l.from.id!==a.from.id})},o.prototype.removeOuterEdge=function(a){this.outerEdges=this.outerEdges.filter(function(l){return l.to.id!==a.to.id})},o.prototype.addOuterEdge=function(a){this.outerEdges.push(a),this.outerEdgesSorted=!1},o.prototype.sortOuterEdges=function(){var a=this;this.outerEdgesSorted||(this.outerEdges.sort(function(l,d){var v=l.to,w=d.to;if(v.coordinates[0]-a.coordinates[0]>=0&&w.coordinates[0]-a.coordinates[0]<0)return 1;if(v.coordinates[0]-a.coordinates[0]<0&&w.coordinates[0]-a.coordinates[0]>=0)return-1;if(v.coordinates[0]-a.coordinates[0]==0&&w.coordinates[0]-a.coordinates[0]==0)return v.coordinates[1]-a.coordinates[1]>=0||w.coordinates[1]-a.coordinates[1]>=0?v.coordinates[1]-w.coordinates[1]:w.coordinates[1]-v.coordinates[1];var C=Xh(a.coordinates,v.coordinates,w.coordinates);return C<0?1:C>0?-1:Math.pow(v.coordinates[0]-a.coordinates[0],2)+Math.pow(v.coordinates[1]-a.coordinates[1],2)-(Math.pow(w.coordinates[0]-a.coordinates[0],2)+Math.pow(w.coordinates[1]-a.coordinates[1],2))}),this.outerEdgesSorted=!0)},o.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},o.prototype.getOuterEdge=function(a){return this.sortOuterEdges(),this.outerEdges[a]},o.prototype.addInnerEdge=function(a){this.innerEdges.push(a)},o}(),$h=function(){function o(a,l){this.from=a,this.to=l,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return o.prototype.getSymetric=function(){return this.symetric||(this.symetric=new o(this.to,this.from),this.symetric.symetric=this),this.symetric},o.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},o.prototype.isEqual=function(a){return this.from.id===a.from.id&&this.to.id===a.to.id},o.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},o.prototype.toLineString=function(){return Sn([this.from.coordinates,this.to.coordinates])},o.prototype.compareTo=function(a){return Xh(a.from.coordinates,a.to.coordinates,this.to.coordinates)},o}(),ec=function(){function o(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return o.prototype.push=function(a){this.edges.push(a),this.polygon=this.envelope=void 0},o.prototype.get=function(a){return this.edges[a]},Object.defineProperty(o.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),o.prototype.forEach=function(a){this.edges.forEach(a)},o.prototype.map=function(a){return this.edges.map(a)},o.prototype.some=function(a){return this.edges.some(a)},o.prototype.isValid=function(){return!0},o.prototype.isHole=function(){var a=this,l=this.edges.reduce(function(C,A,D){return A.from.coordinates[1]>a.edges[C].from.coordinates[1]&&(C=D),C},0),d=(0===l?this.length:l)-1,v=(l+1)%this.length,w=Xh(this.edges[d].from.coordinates,this.edges[l].from.coordinates,this.edges[v].from.coordinates);return 0===w?this.edges[d].from.coordinates[0]>this.edges[v].from.coordinates[0]:w>0},o.prototype.toMultiPoint=function(){return function le(o,a,l){return void 0===l&&(l={}),Xn({type:"MultiPoint",coordinates:o},a,l)}(this.edges.map(function(a){return a.from.coordinates}))},o.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var a=this.edges.map(function(l){return l.from.coordinates});return a.push(this.edges[0].from.coordinates),this.polygon=Wo([a])},o.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=function vs(o){return function cl(o,a){void 0===a&&(a={});var l=Number(o[0]),d=Number(o[1]),v=Number(o[2]),w=Number(o[3]);if(6===o.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var C=[l,d];return Wo([[C,[v,d],[v,w],[l,w],C]],a.properties,{bbox:o,id:a.id})}(Ns(o))}(this.toPolygon())},o.findEdgeRingContaining=function(a,l){var v,w,d=a.getEnvelope();return l.forEach(function(C){var A=C.getEnvelope();if(w&&(v=w.getEnvelope()),!function qp(o,a){var l=o.geometry.coordinates[0].map(function(C){return C[0]}),d=o.geometry.coordinates[0].map(function(C){return C[1]}),v=a.geometry.coordinates[0].map(function(C){return C[0]}),w=a.geometry.coordinates[0].map(function(C){return C[1]});return Math.max.apply(null,l)===Math.max.apply(null,v)&&Math.max.apply(null,d)===Math.max.apply(null,w)&&Math.min.apply(null,l)===Math.min.apply(null,v)&&Math.min.apply(null,d)===Math.min.apply(null,w)}(A,d)&&Yf(A,d)){for(var D=a.map(function(rt){return rt.from.coordinates}),P=void 0,z=function(rt){C.some(function(Fe){return function Qd(o,a){return o[0]===a[0]&&o[1]===a[1]}(rt,Fe.from.coordinates)})||(P=rt)},U=0,j=D;U<j.length;U++)z(j[U]);P&&C.inside(Bn(P))&&(!w||Yf(v,A))&&(w=C)}}),w},o.prototype.inside=function(a){return _n(a,this.toPolygon())},o}();function xc(o){for(var a=o,l=[];a.parent;)l.unshift(a),a=a.parent;return l}!function(){function o(){this.edges=[],this.nodes={}}o.fromGeoJson=function(a){!function Wf(o){if(!o)throw new Error("No geojson passed");if("FeatureCollection"!==o.type&&"GeometryCollection"!==o.type&&"MultiLineString"!==o.type&&"LineString"!==o.type&&"Feature"!==o.type)throw new Error("Invalid input type '"+o.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(a);var l=new o;return W(a,function(d){(function ro(o,a,l){if(!o)throw new Error("No feature passed");if(!l)throw new Error(".featureOf() requires a name");if(!o||"Feature"!==o.type||!o.geometry)throw new Error("Invalid input to "+l+", Feature with geometry required");if(!o.geometry||o.geometry.type!==a)throw new Error("Invalid input to "+l+": must be a "+a+", given "+o.geometry.type)})(d,"LineString","Graph::fromGeoJson"),function hi(o,a,l,d){var v=l;Ws(o,function(w,C,A,D,P){v=0===C&&void 0===l?w:a(v,w,C,A,D,P)},d)}(d,function(v,w){if(v){var C=l.getNode(v),A=l.getNode(w);l.addEdge(C,A)}return w})}),l},o.prototype.getNode=function(a){var l=Vp.buildId(a),d=this.nodes[l];return d||(d=this.nodes[l]=new Vp(a)),d},o.prototype.addEdge=function(a,l){var d=new $h(a,l),v=d.getSymetric();this.edges.push(d),this.edges.push(v)},o.prototype.deleteDangles=function(){var a=this;Object.keys(this.nodes).map(function(l){return a.nodes[l]}).forEach(function(l){return a._removeIfDangle(l)})},o.prototype._removeIfDangle=function(a){var l=this;if(a.innerEdges.length<=1){var d=a.getOuterEdges().map(function(v){return v.to});this.removeNode(a),d.forEach(function(v){return l._removeIfDangle(v)})}},o.prototype.deleteCutEdges=function(){var a=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(l){l.label===l.symetric.label&&(a.removeEdge(l.symetric),a.removeEdge(l))})},o.prototype._computeNextCWEdges=function(a){var l=this;typeof a>"u"?Object.keys(this.nodes).forEach(function(d){return l._computeNextCWEdges(l.nodes[d])}):a.getOuterEdges().forEach(function(d,v){a.getOuterEdge((0===v?a.getOuterEdges().length:v)-1).symetric.next=d})},o.prototype._computeNextCCWEdges=function(a,l){for(var v,w,d=a.getOuterEdges(),C=d.length-1;C>=0;--C){var A=d[C],D=A.symetric,P=void 0,z=void 0;A.label===l&&(P=A),D.label===l&&(z=D),P&&z&&(z&&(w=z),P&&(w&&(w.next=P,w=void 0),v||(v=P)))}w&&(w.next=v)},o.prototype._findLabeledEdgeRings=function(){var a=[],l=0;return this.edges.forEach(function(d){if(!(d.label>=0)){a.push(d);var v=d;do{v.label=l,v=v.next}while(!d.isEqual(v));l++}}),a},o.prototype.getEdgeRings=function(){var a=this;this._computeNextCWEdges(),this.edges.forEach(function(d){d.label=void 0}),this._findLabeledEdgeRings().forEach(function(d){a._findIntersectionNodes(d).forEach(function(v){a._computeNextCCWEdges(v,d.label)})});var l=[];return this.edges.forEach(function(d){d.ring||l.push(a._findEdgeRing(d))}),l},o.prototype._findIntersectionNodes=function(a){var l=[],d=a,v=function(){var w=0;d.from.getOuterEdges().forEach(function(C){C.label===a.label&&++w}),w>1&&l.push(d.from),d=d.next};do{v()}while(!a.isEqual(d));return l},o.prototype._findEdgeRing=function(a){var l=a,d=new ec;do{d.push(l),l.ring=d,l=l.next}while(!a.isEqual(l));return d},o.prototype.removeNode=function(a){var l=this;a.getOuterEdges().forEach(function(d){return l.removeEdge(d)}),a.innerEdges.forEach(function(d){return l.removeEdge(d)}),delete this.nodes[a.id]},o.prototype.removeEdge=function(a){this.edges=this.edges.filter(function(l){return!l.isEqual(a)}),a.deleteEdge()}}(),ue(5013),ue(7470),ue(9475);var Wp={search:function(o,a,l,d){o.cleanDirty();var v=(d=d||{}).heuristic||Wp.heuristics.manhattan,w=d.closest||!1,C=function Kh(){return new hg(function(o){return o.f})}(),A=a;for(a.h=v(a,l),C.push(a);C.size()>0;){var D=C.pop();if(D===l)return xc(D);D.closed=!0;for(var P=o.neighbors(D),z=0,U=P.length;z<U;++z){var j=P[z];if(!j.closed&&!j.isWall()){var Y=D.g+j.getCost(D),rt=j.visited;(!rt||Y<j.g)&&(j.visited=!0,j.parent=D,j.h=j.h||v(j,l),j.g=Y,j.f=j.g+j.h,o.markDirty(j),w&&(j.h<A.h||j.h===A.h&&j.g<A.g)&&(A=j),rt?C.rescoreElement(j):C.push(j))}}}return w?xc(A):[]},heuristics:{manhattan:function(o,a){return Math.abs(a.x-o.x)+Math.abs(a.y-o.y)},diagonal:function(o,a){var d=Math.sqrt(2),v=Math.abs(a.x-o.x),w=Math.abs(a.y-o.y);return 1*(v+w)+(d-2)*Math.min(v,w)}},cleanNode:function(o){o.f=0,o.g=0,o.h=0,o.visited=!1,o.closed=!1,o.parent=null}};function mh(o,a){a=a||{},this.nodes=[],this.diagonal=!!a.diagonal,this.grid=[];for(var l=0;l<o.length;l++){this.grid[l]=[];for(var d=0,v=o[l];d<v.length;d++){var w=new Hp(l,d,v[d]);this.grid[l][d]=w,this.nodes.push(w)}}this.init()}function Hp(o,a,l){this.x=o,this.y=a,this.weight=l}function hg(o){this.content=[],this.scoreFunction=o}function Qh(){this._=null}function Jp(o){o.U=o.C=o.L=o.R=o.P=o.N=null}function Gu(o,a){var l=a,d=a.R,v=l.U;v?v.L===l?v.L=d:v.R=d:o._=d,d.U=v,l.U=d,l.R=d.L,l.R&&(l.R.U=l),d.L=l}function ep(o,a){var l=a,d=a.L,v=l.U;v?v.L===l?v.L=d:v.R=d:o._=d,d.U=v,l.U=d,l.L=d.R,l.L&&(l.L.U=l),d.R=l}function qs(o){for(;o.L;)o=o.L;return o}mh.prototype.init=function(){this.dirtyNodes=[];for(var o=0;o<this.nodes.length;o++)Wp.cleanNode(this.nodes[o])},mh.prototype.cleanDirty=function(){for(var o=0;o<this.dirtyNodes.length;o++)Wp.cleanNode(this.dirtyNodes[o]);this.dirtyNodes=[]},mh.prototype.markDirty=function(o){this.dirtyNodes.push(o)},mh.prototype.neighbors=function(o){var a=[],l=o.x,d=o.y,v=this.grid;return v[l-1]&&v[l-1][d]&&a.push(v[l-1][d]),v[l+1]&&v[l+1][d]&&a.push(v[l+1][d]),v[l]&&v[l][d-1]&&a.push(v[l][d-1]),v[l]&&v[l][d+1]&&a.push(v[l][d+1]),this.diagonal&&(v[l-1]&&v[l-1][d-1]&&a.push(v[l-1][d-1]),v[l+1]&&v[l+1][d-1]&&a.push(v[l+1][d-1]),v[l-1]&&v[l-1][d+1]&&a.push(v[l-1][d+1]),v[l+1]&&v[l+1][d+1]&&a.push(v[l+1][d+1])),a},mh.prototype.toString=function(){for(var l,d,v,w,o=[],a=this.grid,C=0,A=a.length;C<A;C++){for(l=[],v=0,w=(d=a[C]).length;v<w;v++)l.push(d[v].weight);o.push(l.join(" "))}return o.join("\n")},Hp.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},Hp.prototype.getCost=function(o){return o&&o.x!==this.x&&o.y!==this.y?1.41421*this.weight:this.weight},Hp.prototype.isWall=function(){return 0===this.weight},hg.prototype={push:function(o){this.content.push(o),this.sinkDown(this.content.length-1)},pop:function(){var o=this.content[0],a=this.content.pop();return this.content.length>0&&(this.content[0]=a,this.bubbleUp(0)),o},remove:function(o){var a=this.content.indexOf(o),l=this.content.pop();a!==this.content.length-1&&(this.content[a]=l,this.scoreFunction(l)<this.scoreFunction(o)?this.sinkDown(a):this.bubbleUp(a))},size:function(){return this.content.length},rescoreElement:function(o){this.sinkDown(this.content.indexOf(o))},sinkDown:function(o){for(var a=this.content[o];o>0;){var l=(o+1>>1)-1,d=this.content[l];if(!(this.scoreFunction(a)<this.scoreFunction(d)))break;this.content[l]=a,this.content[o]=d,o=l}},bubbleUp:function(o){for(var a=this.content.length,l=this.content[o],d=this.scoreFunction(l);;){var A,v=o+1<<1,w=v-1,C=null;if(w<a&&(A=this.scoreFunction(this.content[w]))<d&&(C=w),v<a&&this.scoreFunction(this.content[v])<(null===C?d:A)&&(C=v),null===C)break;this.content[o]=this.content[C],this.content[C]=l,o=C}}},Qh.prototype={constructor:Qh,insert:function(o,a){var l,d,v;if(o){if(a.P=o,a.N=o.N,o.N&&(o.N.P=a),o.N=a,o.R){for(o=o.R;o.L;)o=o.L;o.L=a}else o.R=a;l=o}else this._?(o=qs(this._),a.P=null,a.N=o,o.P=o.L=a,l=o):(a.P=a.N=null,this._=a,l=null);for(a.L=a.R=null,a.U=l,a.C=!0,o=a;l&&l.C;)l===(d=l.U).L?(v=d.R)&&v.C?(l.C=v.C=!1,d.C=!0,o=d):(o===l.R&&(Gu(this,l),l=(o=l).U),l.C=!1,d.C=!0,ep(this,d)):(v=d.L)&&v.C?(l.C=v.C=!1,d.C=!0,o=d):(o===l.L&&(ep(this,l),l=(o=l).U),l.C=!1,d.C=!0,Gu(this,d)),l=o.U;this._.C=!1},remove:function(o){o.N&&(o.N.P=o.P),o.P&&(o.P.N=o.N),o.N=o.P=null;var l,w,C,a=o.U,d=o.L,v=o.R;if(w=d?v?qs(v):d:v,a?a.L===o?a.L=w:a.R=w:this._=w,d&&v?(C=w.C,w.C=o.C,w.L=d,d.U=w,w!==v?(a=w.U,w.U=o.U,a.L=o=w.R,w.R=v,v.U=w):(w.U=a,a=w,o=w.R)):(C=o.C,o=w),o&&(o.U=a),!C){if(o&&o.C)return void(o.C=!1);do{if(o===this._)break;if(o===a.L){if((l=a.R).C&&(l.C=!1,a.C=!0,Gu(this,a),l=a.R),l.L&&l.L.C||l.R&&l.R.C){(!l.R||!l.R.C)&&(l.L.C=!1,l.C=!0,ep(this,l),l=a.R),l.C=a.C,a.C=l.R.C=!1,Gu(this,a),o=this._;break}}else if((l=a.L).C&&(l.C=!1,a.C=!0,ep(this,a),l=a.L),l.L&&l.L.C||l.R&&l.R.C){(!l.L||!l.L.C)&&(l.R.C=!1,l.C=!0,Gu(this,l),l=a.L),l.C=a.C,a.C=l.L.C=!1,ep(this,a),o=this._;break}l.C=!0,o=a,a=a.U}while(!o.C);o&&(o.C=!1)}}};const tp=Qh;function yh(o,a,l,d){var v=[null,null],w=Tl.push(v)-1;return v.left=o,v.right=a,l&&Xc(v,o,a,l),d&&Xc(v,a,o,d),Ql[o.index].halfedges.push(w),Ql[a.index].halfedges.push(w),v}function bc(o,a,l){var d=[a,l];return d.left=o,d}function Xc(o,a,l,d){o[0]||o[1]?o.left===l?o[1]=d:o[0]=d:(o[0]=d,o.left=a,o.right=l)}function rp(o,a,l,d,v){var Fe,w=o[0],C=o[1],A=w[0],D=w[1],U=0,j=1,Y=C[0]-A,rt=C[1]-D;if(Fe=a-A,Y||!(Fe>0)){if(Fe/=Y,Y<0){if(Fe<U)return;Fe<j&&(j=Fe)}else if(Y>0){if(Fe>j)return;Fe>U&&(U=Fe)}if(Fe=d-A,Y||!(Fe<0)){if(Fe/=Y,Y<0){if(Fe>j)return;Fe>U&&(U=Fe)}else if(Y>0){if(Fe<U)return;Fe<j&&(j=Fe)}if(Fe=l-D,rt||!(Fe>0)){if(Fe/=rt,rt<0){if(Fe<U)return;Fe<j&&(j=Fe)}else if(rt>0){if(Fe>j)return;Fe>U&&(U=Fe)}if(Fe=v-D,rt||!(Fe<0)){if(Fe/=rt,rt<0){if(Fe>j)return;Fe>U&&(U=Fe)}else if(rt>0){if(Fe<U)return;Fe<j&&(j=Fe)}return!(U>0)&&!(j<1)||(U>0&&(o[0]=[A+U*Y,D+U*rt]),j<1&&(o[1]=[A+j*Y,D+j*rt])),!0}}}}}function pg(o,a,l,d,v){var w=o[1];if(w)return!0;var Fe,Tt,C=o[0],A=o.left,D=o.right,P=A[0],z=A[1],U=D[0],j=D[1],Y=(P+U)/2;if(j===z){if(Y<a||Y>=d)return;if(P>U){if(C){if(C[1]>=v)return}else C=[Y,l];w=[Y,v]}else{if(C){if(C[1]<l)return}else C=[Y,v];w=[Y,l]}}else if(Tt=(z+j)/2-(Fe=(P-U)/(j-z))*Y,Fe<-1||Fe>1)if(P>U){if(C){if(C[1]>=v)return}else C=[(l-Tt)/Fe,l];w=[(v-Tt)/Fe,v]}else{if(C){if(C[1]<l)return}else C=[(v-Tt)/Fe,v];w=[(l-Tt)/Fe,l]}else if(z<j){if(C){if(C[0]>=d)return}else C=[a,Fe*a+Tt];w=[d,Fe*d+Tt]}else{if(C){if(C[0]<a)return}else C=[d,Fe*d+Tt];w=[a,Fe*a+Tt]}return o[0]=C,o[1]=w,!0}function td(o,a){var l=o.site,d=a.left,v=a.right;return l===v&&(v=d,d=l),v?Math.atan2(v[1]-d[1],v[0]-d[0]):(l===d?(d=a[1],v=a[0]):(d=a[0],v=a[1]),Math.atan2(d[0]-v[0],v[1]-d[1]))}function Kp(o,a){return a[+(a.left!==o.site)]}function Xm(o,a){return a[+(a.left===o.site)]}var op,gg=[];function $m(){Jp(this),this.x=this.y=this.arc=this.site=this.cy=null}function wc(o){var a=o.P,l=o.N;if(a&&l){var d=a.site,v=o.site,w=l.site;if(d!==w){var C=v[0],A=v[1],D=d[0]-C,P=d[1]-A,z=w[0]-C,U=w[1]-A,j=2*(D*U-P*z);if(!(j>=-_g)){var Y=D*D+P*P,rt=z*z+U*U,Fe=(U*Y-P*rt)/j,Tt=(D*rt-z*Y)/j,it=gg.pop()||new $m;it.arc=o,it.site=v,it.x=Fe+C,it.y=(it.cy=Tt+A)+Math.sqrt(Fe*Fe+Tt*Tt),o.circle=it;for(var Ne=null,Qe=ap._;Qe;)if(it.y<Qe.y||it.y===Qe.y&&it.x<=Qe.x){if(!Qe.L){Ne=Qe.P;break}Qe=Qe.L}else{if(!Qe.R){Ne=Qe;break}Qe=Qe.R}ap.insert(Ne,it),Ne||(op=it)}}}}function Ec(o){var a=o.circle;a&&(a.P||(op=a.N),ap.remove(a),gg.push(a),Jp(a),o.circle=null)}var sp=[];function Ym(){Jp(this),this.edge=this.site=this.circle=null}function mg(o){var a=sp.pop()||new Ym;return a.site=o,a}function rd(o){Ec(o),Mu.remove(o),sp.push(o),Jp(o)}function Wm(o){var a=o.circle,l=a.x,d=a.cy,v=[l,d],w=o.P,C=o.N,A=[o];rd(o);for(var D=w;D.circle&&Math.abs(l-D.circle.x)<Vs&&Math.abs(d-D.circle.cy)<Vs;)w=D.P,A.unshift(D),rd(D),D=w;A.unshift(D),Ec(D);for(var P=C;P.circle&&Math.abs(l-P.circle.x)<Vs&&Math.abs(d-P.circle.cy)<Vs;)C=P.N,A.push(P),rd(P),P=C;A.push(P),Ec(P);var U,z=A.length;for(U=1;U<z;++U)Xc((P=A[U]).edge,(D=A[U-1]).site,P.site,v);(P=A[z-1]).edge=yh((D=A[0]).site,P.site,null,v),wc(D),wc(P)}function Hm(o){for(var d,v,w,C,a=o[0],l=o[1],A=Mu._;A;)if((w=yg(A,l)-a)>Vs)A=A.L;else{if(!((C=a-Qp(A,l))>Vs)){w>-Vs?(d=A.P,v=A):C>-Vs?(d=A,v=A.N):d=v=A;break}if(!A.R){d=A;break}A=A.R}!function np(o){Ql[o.index]={site:o,halfedges:[]}}(o);var D=mg(o);if(Mu.insert(d,D),d||v){if(d===v)return Ec(d),v=mg(d.site),Mu.insert(D,v),D.edge=v.edge=yh(d.site,D.site),wc(d),void wc(v);if(!v)return void(D.edge=yh(d.site,D.site));Ec(d),Ec(v);var P=d.site,z=P[0],U=P[1],j=o[0]-z,Y=o[1]-U,rt=v.site,Fe=rt[0]-z,Tt=rt[1]-U,it=2*(j*Tt-Y*Fe),Ne=j*j+Y*Y,Qe=Fe*Fe+Tt*Tt,At=[(Tt*Ne-Y*Qe)/it+z,(j*Qe-Fe*Ne)/it+U];Xc(v.edge,P,rt,At),D.edge=yh(P,o,null,At),v.edge=yh(o,rt,null,At),wc(d),wc(v)}}function yg(o,a){var l=o.site,d=l[0],v=l[1],w=v-a;if(!w)return d;var C=o.P;if(!C)return-1/0;var A=(l=C.site)[0],D=l[1],P=D-a;if(!P)return A;var z=A-d,U=1/w-1/P,j=z/P;return U?(-j+Math.sqrt(j*j-2*U*(z*z/(-2*P)-D+P/2+v-w/2)))/U+d:(d+A)/2}function Qp(o,a){var l=o.N;if(l)return yg(l,a);var d=o.site;return d[1]===a?d[0]:1/0}var Mu,Ql,ap,Tl,Vs=1e-6,_g=1e-12;function vg(o,a,l){return(o[0]-l[0])*(a[1]-o[1])-(o[0]-a[0])*(l[1]-o[1])}function xg(o,a){return a[1]-o[1]||a[0]-o[0]}function bg(o,a){var d,v,w,l=o.sort(xg).pop();for(Tl=[],Ql=new Array(o.length),Mu=new tp,ap=new tp;;)if(w=op,l&&(!w||l[1]<w.y||l[1]===w.y&&l[0]<w.x))(l[0]!==d||l[1]!==v)&&(Hm(l),d=l[0],v=l[1]),l=o.pop();else{if(!w)break;Wm(w.arc)}if(function dg(){for(var l,d,v,w,o=0,a=Ql.length;o<a;++o)if((l=Ql[o])&&(w=(d=l.halfedges).length)){var C=new Array(w),A=new Array(w);for(v=0;v<w;++v)C[v]=v,A[v]=td(l,Tl[d[v]]);for(C.sort(function(D,P){return A[P]-A[D]}),v=0;v<w;++v)A[v]=d[C[v]];for(v=0;v<w;++v)d[v]=A[v]}}(),a){var C=+a[0][0],A=+a[0][1],D=+a[1][0],P=+a[1][1];(function fg(o,a,l,d){for(var w,v=Tl.length;v--;)pg(w=Tl[v],o,a,l,d)&&rp(w,o,a,l,d)&&(Math.abs(w[0][0]-w[1][0])>Vs||Math.abs(w[0][1]-w[1][1])>Vs)||delete Tl[v]})(C,A,D,P),function ip(o,a,l,d){var w,C,A,D,P,z,U,j,Y,rt,Fe,Tt,v=Ql.length,it=!0;for(w=0;w<v;++w)if(C=Ql[w]){for(A=C.site,D=(P=C.halfedges).length;D--;)Tl[P[D]]||P.splice(D,1);for(D=0,z=P.length;D<z;)Fe=(rt=Xm(C,Tl[P[D]]))[0],Tt=rt[1],j=(U=Kp(C,Tl[P[++D%z]]))[0],Y=U[1],(Math.abs(Fe-j)>Vs||Math.abs(Tt-Y)>Vs)&&(P.splice(D,0,Tl.push(bc(A,rt,Math.abs(Fe-o)<Vs&&d-Tt>Vs?[o,Math.abs(j-o)<Vs?Y:d]:Math.abs(Tt-d)<Vs&&l-Fe>Vs?[Math.abs(Y-d)<Vs?j:l,d]:Math.abs(Fe-l)<Vs&&Tt-a>Vs?[l,Math.abs(j-l)<Vs?Y:a]:Math.abs(Tt-a)<Vs&&Fe-o>Vs?[Math.abs(Y-a)<Vs?j:o,a]:null))-1),++z);z&&(it=!1)}if(it){var Ne,Qe,At,Pt=1/0;for(w=0,it=null;w<v;++w)(C=Ql[w])&&(At=(Ne=(A=C.site)[0]-o)*Ne+(Qe=A[1]-a)*Qe)<Pt&&(Pt=At,it=C);if(it){var Yt=[o,a],qt=[o,d],or=[l,d],ct=[l,a];it.halfedges.push(Tl.push(bc(A=it.site,Yt,qt))-1,Tl.push(bc(A,qt,or))-1,Tl.push(bc(A,or,ct))-1,Tl.push(bc(A,ct,Yt))-1)}}for(w=0;w<v;++w)(C=Ql[w])&&(C.halfedges.length||delete Ql[w])}(C,A,D,P)}this.edges=Tl,this.cells=Ql,Mu=ap=Tl=Ql=null}function Sc(){return new nf}function nf(){this.reset()}bg.prototype={constructor:bg,polygons:function(){var o=this.edges;return this.cells.map(function(a){var l=a.halfedges.map(function(d){return Kp(a,o[d])});return l.data=a.site.data,l})},triangles:function(){var o=[],a=this.edges;return this.cells.forEach(function(l,d){if(A=(w=l.halfedges).length)for(var w,A,D,v=l.site,C=-1,P=a[w[A-1]],z=P.left===v?P.right:P.left;++C<A;)D=z,z=(P=a[w[C]]).left===v?P.right:P.left,D&&z&&d<D.index&&d<z.index&&vg(v,D,z)<0&&o.push([v.data,D.data,z.data])}),o},links:function(){return this.edges.filter(function(o){return o.right}).map(function(o){return{source:o.left.data,target:o.right.data}})},find:function(o,a,l){for(var v,A,d=this,w=d._found||0,C=d.cells.length;!(A=d.cells[w]);)if(++w>=C)return null;var D=o-A.site[0],P=a-A.site[1],z=D*D+P*P;do{A=d.cells[v=w],w=null,A.halfedges.forEach(function(U){var j=d.edges[U],Y=j.left;if(Y!==A.site&&Y||(Y=j.right)){var rt=o-Y[0],Fe=a-Y[1],Tt=rt*rt+Fe*Fe;Tt<z&&(z=Tt,w=Y.index)}})}while(null!==w);return d._found=v,null==l||z<=l*l?A.site:null}},ue(9855),ue(770),nf.prototype={constructor:nf,reset:function(){this.s=this.t=0},add:function(o){Lg(Cc,o,this.t),Lg(this,Cc.s,this.s),this.s?this.t+=Cc.t:this.s=Cc.t},valueOf:function(){return this.s}};var Cc=new nf;function Lg(o,a,l){var d=o.s=a+l,v=d-a;o.t=a-(d-v)+(l-v)}var Zs=Math.PI,Fl=Zs/2,Tc=2*Zs,bs=Zs/180,ju=(Math,Math.atan),$c=Math.atan2,ko=Math.cos,co=(Math,Math,Math,Math,Math,Math.sin),rc=(Math,Math.sqrt);Math;function Yc(o){return o>1?Fl:o<-1?-Fl:Math.asin(o)}function Ac(o,a){return[o>Zs?o-Tc:o<-Zs?o+Tc:o,a]}function Kg(o,a){return o<a?-1:o>a?1:o>=a?0:NaN}Sc(),Sc(),Sc(),Ac.invert=Ac,function Qg(o){1===o.length&&(o=function Qc(o){return function(a,l){return Kg(o(a),l)}}(o))}(Kg),Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);Sc();function dr(){}function Mo(o){return function(a,l){var d=ko(a),v=ko(l),w=o(d*v);return[w*v*co(a),w*co(l)]}}function Io(o){return function(a,l){var d=rc(a*a+l*l),v=o(d),w=co(v),C=ko(v);return[$c(a*w,d*C),Yc(d&&l*w/d)]}}function sa(o,a){return[o,a]}Sc(),Sc(),Sc(),Sc(),function me(o){return"m0,"+o+"a"+o+","+o+" 0 1,1 0,"+-2*o+"a"+o+","+o+" 0 1,1 0,"+2*o+"z"}(4.5),dr.prototype={constructor:dr,point:function(o,a){this.stream.point(o,a)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},ko(30*bs),function Qt(o){return function(a){var l=new dr;for(var d in o)l[d]=o[d];return l.stream=a,l}}({point:function(o,a){this.stream.point(o*bs,a*bs)}}),Mo(function(o){return rc(2/(1+o))}).invert=Io(function(o){return 2*Yc(o/2)}),Mo(function(o){return(o=function vh(o){return o>1?0:o<-1?Zs:Math.acos(o)}(o))&&o/co(o)}).invert=Io(function(o){return o}),sa.invert=sa,Io(ju),Io(Yc),Io(function(o){return 2*ju(o)});const Fh=Object.assign({},ji);Fh.onSetup=function(){const o=this.newFeature({type:"Feature",properties:{},geometry:{type:"LineString",coordinates:[[]]}});return this.addFeature(o),this.clearSelectedFeatures(),setTimeout(()=>{!this.map||!this.map.dragPan||this.map.dragPan.disable()},0),this.updateUIClasses({mouse:"add"}),this.activateUIButton("line_string"),this.setActionableState({trash:!0}),{line:o,currentVertexPosition:0,dragMoving:!1}};var Bd=0;Fh.onDrag=Fh.onTouchMove=function(o,a){o.dragMoving=!0,this.updateUIClasses({mouse:"add"}),Bd||(Bd=+new Date,console.log(Bd));let l=new Date;l-Bd>=150&&(o.line.updateCoordinate(o.currentVertexPosition,a.lngLat.lng,a.lngLat.lat),"forward"===o.direction?(o.currentVertexPosition++,o.line.updateCoordinate(o.currentVertexPosition,a.lngLat.lng,a.lngLat.lat)):o.line.addCoordinate(0,a.lngLat.lng,a.lngLat.lat),Bd=l)},Fh.onMouseUp=function(o,a){o.dragMoving&&(console.log(o),this.bezierSpline(o.line),this.fireUpdate(),this.changeMode("simple_select",{featureIds:[o.line.id]}))},Fh.onTouchEnd=function(o,a){this.onMouseUp(o,a)},Fh.fireUpdate=function(){this.map.fire("draw.update",{action:"move",features:this.getSelected().map(o=>o.toGeoJSON())})},Fh.bezierSpline=function(o){!function Da(o,a){void 0===a&&(a={});for(var l=a.resolution||1e4,d=a.sharpness||.85,v=[],w=Ts(o).coordinates.map(function(P){return{x:P[0],y:P[1]}}),C=new Sa({duration:l,points:w,sharpness:d}),A=function(P){var z=C.pos(P);Math.floor(P/100)%2==0&&v.push([z.x,z.y])},D=0;D<C.duration;D+=10)A(D);A(C.duration),Sn(v,a.properties)}(o)};const v_=Fh;var x_=ue(9990),b_=ue.n(x_),c_=ue(3990),h_=ue(2340),w_=ue(8545);let _m=(()=>{class o{constructor(){this.getCircleFeature=new b.vpe,this.style={version:8,sources:{osm:{type:"raster",tiles:["https://a.tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,attribution:"&copy; OpenStreetMap Contributors",maxzoom:19}},glyphs:"https://fonts.openmaptiles.org/{fontstack}/{range}.pbf",layers:[{id:"osm",type:"raster",source:"osm"}]}}setDrawCircleMode(){const d=w=>function Ka(o,a,l){void 0===l&&(l={});for(var d=l.steps||64,v=l.properties?l.properties:!Array.isArray(o)&&"Feature"===o.type&&o.properties?o.properties:{},w=[],C=0;C<d;C++)w.push(Pi(o,a,-360*C/d,l).geometry.coordinates);return w.push(w[0]),Wo([w],v)}(w.geometry.coordinates[0],Pa(w));return{...bt.modes.draw_line_string,clickAnywhere:function(w,C){return 1===w.currentVertexPosition?(w.line.addCoordinate(0,C.lngLat.lng,C.lngLat.lat),this.changeMode("simple_select",{featureIds:[w.line.id]})):(w.line.updateCoordinate(w.currentVertexPosition,C.lngLat.lng,C.lngLat.lat),"forward"===w.direction?(w.currentVertexPosition+=1,w.line.updateCoordinate(w.currentVertexPosition,C.lngLat.lng,C.lngLat.lat)):w.line.addCoordinate(0,C.lngLat.lng,C.lngLat.lat),null)},onStop:w=>{if(w.line.removeCoordinate("0"),w.line.isValid()){const C=w.line.toGeoJSON(),A=d(C);this.getCircleFeature.emit(JSON.parse(JSON.stringify({...A}))),this.map.fire("draw.create",{features:[A]}),this.draw.deleteAll()}else this.draw.deleteAll()},toDisplayFeatures:function(w,C,A){if(C.geometry.coordinates.length<2)return null;A({type:"Feature",properties:{active:"true"},geometry:{type:"Point",coordinates:C.geometry.coordinates[0]}}),C.properties.active="true",A(C);const D=(w=>{const C=1e3*Pa(w);let P,j,A="m",D="0,0",z="ft",U="0,0";return P=C,C>=1e3&&(P=C/1e3,A="km",D="0.00"),j=3.28084*C,j>=5280&&(j/=5280,z="mi",U="0.00"),{metric:`${c_(P).format(D)} ${A}`,standard:`${c_(j).format(U)} ${z}`}})(C);A({type:"Feature",properties:{meta:"currentPosition",radius:`${D.metric} ${D.standard}`,parent:w.line.id},geometry:{type:"Point",coordinates:C.geometry.coordinates[1]}});const z=d(C);return z.properties={active:"true"},A(z),null}}}initializeDraw(){this.DrawCircle=this.setDrawCircleMode(),this.draw=new bt({displayControlsDefault:!1,modes:Object.assign(bt.modes,{draw_radius:this.DrawCircle,draw_freehand:zo,draw_rectangle:Rs.Z,draw_freehand_line:v_,rotate_mode:b_()})})}initializeMap(l){ge.accessToken=h_.N.at,this.map=new ge.Map({container:l,style:"mapbox://styles/mapbox/streets-v12",center:[78,23],zoom:0,projection:"globe"})}initializeGeolocator(){return new ge.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0})}initializeGeocoder(){const l=new w_({accessToken:h_.N.at,localGeocoder:this.coordinatesGeocoder,zoom:4,placeholder:"Try: -40, 170",mapboxgl:ge,reverseGeocode:!0});this.geocoder=l}coordinatesGeocoder(l){const d=l.match(/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i);if(!d)return null;function v(D,P){return{center:[D,P],geometry:{type:"Point",coordinates:[D,P]},place_name:"Lat: "+P+" Lng: "+D,place_type:["coordinate"],properties:{},type:"Feature"}}const w=Number(d[1]),C=Number(d[2]),A=[];return(w<-90||w>90)&&A.push(v(w,C)),(C<-90||C>90)&&A.push(v(C,w)),0===A.length&&(A.push(v(w,C)),A.push(v(C,w))),A}addControlsOnMap(){this.map?.addControl(new ge.FullscreenControl,"bottom-left"),this.map?.addControl(new ge.NavigationControl,"bottom-left"),this.map?.addControl(this.initializeGeolocator(),"bottom-left"),this.map?.addControl(this.draw,"bottom-left"),this.initializeGeocoder(),this.map?.addControl(this.geocoder,"top-left")}addControlGeocoder(){this.map?.addControl(this.geocoder,"top-left")}removeControlGeocoder(){this.map?.removeControl(this.geocoder)}getMapData(){return null==this.map||null==this.draw?void console.log("Error -------------- >>   Map and Draw is undefined"):{map:this.map,draw:this.draw}}removeLayerFn(){this.map.removeLayer("YourMapSourceIdLineString"),this.map.removeLayer("YourMapSourceIdPolygon"),this.map.removeLayer("YourMapSourceIdPoint"),this.map.removeLayer("YourMapSourceIdPolygonLineString")}removeSourceFn(){this.map.removeSource("YourMapSource")}addSourceFn(l={type:"FeatureCollection",features:[]}){this.map.addSource("YourMapSource",{type:"geojson",data:l}),this.addLayerFn()}addLayerFn(){this.map.addLayer({id:"YourMapSourceIdLineString",type:"line",source:"YourMapSource",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#572d06","line-width":2},filter:["==","$type","LineString"]}),this.map.addLayer({id:"YourMapSourceIdPolygon",type:"fill",source:"YourMapSource",paint:{"fill-color":"#10CAF0","fill-opacity":.4},filter:["==","$type","Polygon"]}),this.map.addLayer({id:"YourMapSourceIdPoint",type:"circle",source:"YourMapSource",paint:{"circle-radius":6,"circle-color":"#B42222"},filter:["==","$type","Point"]}),this.map.addLayer({id:"YourMapSourceIdPolygonLineString",type:"line",source:"YourMapSource",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#3b1513","line-width":2},filter:["==","$type","Polygon"]})}addLabelFn(l){this.map.addSource("YourMapLabelSource",{type:"geojson",data:l}),this.map.addLayer({id:"YourMapSourceLabels",type:"symbol",source:"YourMapLabelSource",layout:{"text-font":["Open Sans Bold"],"text-field":["get","featureid"],"text-variable-anchor":["top","bottom","left","right"],"text-radial-offset":.5,"text-justify":"center","icon-image":["concat",["get","icon"],"-15"],"text-size":15,"text-optional":!1},paint:{"text-color":"red","text-halo-color":"lightpink","text-halo-width":1}})}removeLabelFn(){this.map.removeLayer("YourMapSourceLabels"),this.map.removeSource("YourMapLabelSource")}}return o.\u0275fac=function(l){return new(l||o)},o.\u0275prov=b.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var p_=ue(1572);function po(o,a,l){return"<"+o+((d=l)&&d.length?" "+d.map(function(v){return v[0]+'="'+v[1]+'"'}).join(" "):"")+">"+a+"</"+o+">";var d}function Ud(o){return(null===o?"":o.toString()).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function My(o,a){return function(l){if(!l.properties||!$u.valid(l.geometry))return"";var d=$u.any(l.geometry);if(!d)return"";var A,D,v="",w="";if(o.simplestyle){var C=(D="",(A=l.properties)["marker-symbol"]&&(D=D+"ms"+A["marker-symbol"]),A["marker-color"]&&(D=D+"mc"+A["marker-color"].replace("#","")),A["marker-size"]&&(D=D+"ms"+A["marker-size"]),A.stroke&&(D=D+"s"+A.stroke.replace("#","")),A["stroke-width"]&&(D=D+"sw"+A["stroke-width"].toString().replace(".","")),A["stroke-opacity"]&&(D=D+"mo"+A["stroke-opacity"].toString().replace(".","")),A.fill&&(D=D+"f"+A.fill.replace("#","")),A["fill-opacity"]&&(D=D+"fo"+A["fill-opacity"].toString().replace(".","")),D);C&&($u.isPoint(l.geometry)&&function(A){return!!(A["marker-size"]||A["marker-symbol"]||A["marker-color"])}(l.properties)?(-1===a.indexOf(C)&&(v=function(A,D){return po("Style",po("IconStyle",po("Icon",po("href",(z=(P=A)["marker-size"]||"medium",U=P["marker-symbol"]?"-"+P["marker-symbol"]:"",j=(P["marker-color"]||"7e7e7e").replace("#",""),"https://api.tiles.mapbox.com/v3/marker/pin-"+z.charAt(0)+U+"+"+j+".png"))))+po("hotSpot","",[["xunits","fraction"],["yunits","fraction"],["x",.5],["y",.5]]),[["id",D]]);var P,z,U,j}(l.properties,C),a.push(C)),w=po("styleUrl","#"+C)):($u.isPolygon(l.geometry)||$u.isLine(l.geometry))&&function(A){for(var D in A)if({stroke:!0,"stroke-opacity":!0,"stroke-width":!0,fill:!0,"fill-opacity":!0}[D])return!0}(l.properties)&&(-1===a.indexOf(C)&&(v=function(A,D){var P=po("LineStyle",[po("color",f_(A.stroke,A["stroke-opacity"])||"ff555555")+po("width",void 0===A["stroke-width"]?2:A["stroke-width"])]),z="";return(A.fill||A["fill-opacity"])&&(z=po("PolyStyle",[po("color",f_(A.fill,A["fill-opacity"])||"88555555")])),po("Style",P+z,[["id",D]])}(l.properties,C),a.push(C)),w=po("styleUrl","#"+C)))}return v+po("Placemark",function(A,D){return A[D.name]?po("name",Ud(A[D.name])):""}(l.properties,o)+function(A,D){return A[D.description]?po("description",Ud(A[D.description])):""}(l.properties,o)+function(A){return po("ExtendedData",function(D){var P=[];for(var z in D)P.push([z,D[z]]);return P}(A).map(E_).join(""))}(l.properties)+function(A,D){return A[D.timestamp]?po("TimeStamp",po("when",Ud(A[D.timestamp]))):""}(l.properties,o)+d+w)}}var $u={Point:function(o){return po("Point",po("coordinates",o.coordinates.join(",")))},LineString:function(o){return po("LineString",po("coordinates",Iy(o.coordinates)))},Polygon:function(o){if(!o.coordinates.length)return"";var a=o.coordinates[0],l=o.coordinates.slice(1),d=po("outerBoundaryIs",po("LinearRing",po("coordinates",Iy(a)))),v=l.map(function(w){return po("innerBoundaryIs",po("LinearRing",po("coordinates",Iy(w))))}).join("");return po("Polygon",d+v)},MultiPoint:function(o){return o.coordinates.length?po("MultiGeometry",o.coordinates.map(function(a){return $u.Point({coordinates:a})}).join("")):""},MultiPolygon:function(o){return o.coordinates.length?po("MultiGeometry",o.coordinates.map(function(a){return $u.Polygon({coordinates:a})}).join("")):""},MultiLineString:function(o){return o.coordinates.length?po("MultiGeometry",o.coordinates.map(function(a){return $u.LineString({coordinates:a})}).join("")):""},GeometryCollection:function(o){return po("MultiGeometry",o.geometries.map($u.any).join(""))},valid:function(o){return o&&o.type&&(o.coordinates||"GeometryCollection"===o.type&&o.geometries&&o.geometries.every($u.valid))},any:function(o){return $u[o.type]?$u[o.type](o):""},isPoint:function(o){return"Point"===o.type||"MultiPoint"===o.type},isPolygon:function(o){return"Polygon"===o.type||"MultiPolygon"===o.type},isLine:function(o){return"LineString"===o.type||"MultiLineString"===o.type}};function Iy(o){return o.map(function(a){return a.join(",")}).join(" ")}function E_(o){return po("Data",po("value",Ud(o[1])),[["name",Ud(o[0])]])}function f_(o,a){if("string"!=typeof o)return"";if(3===(o=o.replace("#","").toLowerCase()).length)o=o[0]+o[0]+o[1]+o[1]+o[2]+o[2];else if(6!==o.length)return"";var l=o[0]+o[1],d=o[2]+o[3],v=o[4]+o[5],w="ff";return"number"==typeof a&&a>=0&&a<=1&&((w=(255*a).toString(16)).indexOf(".")>-1&&(w=w.substr(0,w.indexOf("."))),w.length<2&&(w="0"+w)),w+v+d+l}function Py(o,a){return'<?xml version="1.0" encoding="UTF-8"?>'+po("kml",po("Document",(void 0!==(l=a=a||{documentName:void 0,documentDescription:void 0,name:"name",description:"description",simplestyle:!1,timestamp:"timestamp"}).documentName?po("name",l.documentName):"")+function(l){return void 0!==l.documentDescription?po("description",l.documentDescription):""}(a)+function(l,d){if(!l.type)return"";var v=[];switch(l.type){case"FeatureCollection":return l.features?l.features.map(My(d,v)).join(""):"";case"Feature":return My(d,v)(l);default:return My(d,v)({type:"Feature",geometry:l,properties:{}})}}(o,a)),[["xmlns","http://www.opengis.net/kml/2.2"]]);var l}let Ay=(()=>{class o{constructor(){this.downloadDone=new b.vpe}downloadData(l,d){const v=JSON.parse(JSON.stringify(d));switch(l){case"geojson":this.downloadObjectAsJson(v,"map_geojson");break;case"kml":this.downloadObjectAsKml(v,"map_kml")}}downloadObjectAsKml(l,d){Py(l),Py(l,{name:d,description:"description"});const C=Py(l,{documentName:"My List Of Markers",documentDescription:"One of the many places you are not I am"});var A="data:application/json;charset=utf-8,"+encodeURIComponent(C),D=document.createElement("a");D.setAttribute("href",A),D.setAttribute("download",d+".kml"),D.innerText=d,document.body.appendChild(D),D.click(),D.remove(),this.downloadDone.emit()}downloadObjectAsJson(l,d){var v="data:application/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(l)),w=document.createElement("a");w.setAttribute("href",v),w.setAttribute("download",d+".geojson"),w.innerText=d,document.body.appendChild(w),w.click(),w.remove(),this.downloadDone.emit()}changeTypeMarkerToPoint(l){return l.features.forEach((d,v)=>{"marker"==d.geometry.type&&(l.features[v].geometry.type="Point")}),l}}return o.\u0275fac=function(l){return new(l||o)},o.\u0275prov=b.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})(),S_=(()=>{class o{transform(l,d){try{return this.applyColors("object"==typeof l?l:JSON.parse(l),d[0],d[1])}catch{return this.applyColors({error:"Invalid JSON"},d[0],d[1])}}applyColors(l,d=!1,v=4){return"string"!=typeof l&&(l=JSON.stringify(l,void 0,3)),(l=l.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,C=>{let A="number";return/^"/.test(C)?A=/:$/.test(C)?"key":"string":/true|false/.test(C)?A="boolean":/null/.test(C)&&(A="null"),'<span class="'+A+'">'+C+"</span>"})}}return o.\u0275fac=function(l){return new(l||o)},o.\u0275pipe=b.Yjl({name:"prettyjson",type:o,pure:!0}),o})();function C_(o,a){1&o&&b._UZ(0,"mat-spinner",22)}const T_=function(){return[!0,3]};function M_(o,a){if(1&o&&(b._UZ(0,"pre",23),b.ALo(1,"prettyjson")),2&o){const l=b.oxw();b.Q6J("innerHTML",b.xi3(1,1,l.dataSource,b.DdM(4,T_)),b.oJD)}}let I_=(()=>{class o{constructor(l,d,v){this.downloadDataService=l,this.dataShareService=d,this.snackbarService=v,this.dataSource={type:"FeatureCollection",features:[]},this.tableLoaded=!0,this.downloadType="geojson"}ngOnInit(){this.dataShareService.getSourceData.subscribe(l=>{this.tableLoaded=!1,this.dataSource=l,setTimeout(()=>{this.tableLoaded=!0},0)}),this.getShowDataTableStatus()}copyToClipboard(){if(null==this.dataSource)this.snackbarService.openSnackbar("Please draw atleast one geometry","snackbar-err");else if(this.dataSource.features.length>0){let l=this.downloadDataService.changeTypeMarkerToPoint(JSON.parse(JSON.stringify({...this.dataSource})));navigator.clipboard.writeText(JSON.stringify(l)),this.snackbarService.openSnackbar("Copied to clipboard","snackbar-success")}else this.snackbarService.openSnackbar("Please draw atleast one geometry","snackbar-err")}getShowDataTableStatus(){this.dataShareService.getDataTableStatus.subscribe(l=>{this.showDataTable=l})}downloadTypeSelect(l){this.downloadType=l.target.value}downloadData(){if(this.dataSource)if(this.dataSource.features.length>0){let l=this.downloadDataService.changeTypeMarkerToPoint(JSON.parse(JSON.stringify({...this.dataSource})));this.downloadDataService.downloadData(this.downloadType,{...l})}else this.snackbarService.openSnackbar("Please draw atleast one geometry","snackbar-err");else this.snackbarService.openSnackbar("Please draw atleast one geometry","snackbar-err")}}return o.\u0275fac=function(l){return new(l||o)(b.Y36(Ay),b.Y36(Oe),b.Y36(K))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-data-table"]],decls:26,vars:4,consts:[[1,"data-table",3,"ngClass"],[1,"table-wrapper"],[1,"table-div"],[1,"download-div","d-flex","justify-content-between","pt-1"],["title","Select download type","aria-label","Default select example",1,"form-select",3,"change"],["selected","","value","geojson"],["value","kml"],["role","group",1,"btn-group"],["title","Download File Data",1,"btn","btn-outline",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-download"],["d","M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"],["d","M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"],["title","Copy to clipboard",1,"btn","btn-outline",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-clipboard"],["d","M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"],["d","M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"],[1,"p-flex","mt-2"],["class","p-flex","diameter","25","color","primary",4,"ngIf"],[3,"innerHTML",4,"ngIf"],[1,"toggler-btn"],["role","button",3,"click"],[1,"bg-primary","text-light",3,"ngClass"],["diameter","25","color","primary",1,"p-flex"],[3,"innerHTML"]],template:function(l,d){1&l&&(b.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"select",4),b.NdJ("change",function(w){return d.downloadTypeSelect(w)}),b.TgZ(5,"option",5),b._uU(6,"Geojson"),b.qZA(),b.TgZ(7,"option",6),b._uU(8,"Kml"),b.qZA()(),b.TgZ(9,"div",7)(10,"button",8),b.NdJ("click",function(){return d.downloadData()}),b.O4$(),b.TgZ(11,"svg",9),b._UZ(12,"path",10)(13,"path",11),b.qZA()(),b.kcU(),b.TgZ(14,"button",12),b.NdJ("click",function(){return d.copyToClipboard()}),b.O4$(),b.TgZ(15,"svg",13),b._UZ(16,"path",14)(17,"path",15),b.qZA()()()(),b.kcU(),b.TgZ(18,"div")(19,"div",16),b.YNc(20,C_,1,0,"mat-spinner",17),b.qZA(),b.YNc(21,M_,2,5,"pre",18),b.qZA()(),b.TgZ(22,"div",19)(23,"span",20),b.NdJ("click",function(){return d.showDataTable=!d.showDataTable}),b.TgZ(24,"mat-icon",21),b._uU(25,"keyboard_backspace"),b.qZA()()()()()),2&l&&(b.Q6J("ngClass",d.showDataTable?"data-table-show":"data-table-hide"),b.xp6(20),b.Q6J("ngIf",!d.tableLoaded),b.xp6(1),b.Q6J("ngIf",d.tableLoaded),b.xp6(3),b.Q6J("ngClass",d.showDataTable?"show-reverse-arrow":""))},dependencies:[ae.mk,ae.O5,ee.Hw,p_.Ou,c.YN,c.Kr,S_],styles:[".data-table[_ngcontent-%COMP%]{position:absolute;z-index:3;right:0;top:0;height:100%;background-color:#e2f2f0;transition:transform .5s}[_ngcontent-%COMP%]::-webkit-scrollbar{width:10px;height:10px}[_ngcontent-%COMP%]::-webkit-scrollbar-track{background-color:#eff8ff}[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#10CAF0;border-radius:10px}.data-table-hide[_ngcontent-%COMP%]{transform:translate(100%)}.data-table-show[_ngcontent-%COMP%]{transform:translate(0)}.download-div[_ngcontent-%COMP%]{position:sticky;top:0}.table-wrapper[_ngcontent-%COMP%]{position:relative;height:100%}.toggler-btn[_ngcontent-%COMP%]{position:absolute;top:50%;left:-50px}.toggler-btn[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{height:35px;width:50px;display:flex;align-items:center;justify-content:center;border-radius:50px 0 0 50px}.table-div[_ngcontent-%COMP%]{height:100%;width:100%;overflow-x:hidden;overflow-y:auto;scrollbar-color:#10CAF0 #EFF8FF}.show-reverse-arrow[_ngcontent-%COMP%]{transform:scaleX(-1)}@media only screen and (max-width: 992px){.data-table[_ngcontent-%COMP%]{width:300px}}@media only screen and (min-width: 993px){.data-table[_ngcontent-%COMP%]{width:500px}}"]}),o})();var P_=ue(529);let A_=(()=>{class o{constructor(l){this.http=l,this.BASE_NOMINATIM_URL="https://nominatim.openstreetmap.org"}getGeocoderData(l){return this.http.get(`${this.BASE_NOMINATIM_URL}/search?q=${l}&format=geojson`)}reverseGeocodeData(l){return this.http.get(`${this.BASE_NOMINATIM_URL}/reverse?format=geojson&lat=${l.lat}&lon=${l.lng}`)}}return o.\u0275fac=function(l){return new(l||o)(b.LFG(P_.eN))},o.\u0275prov=b.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"}),o})();var L_=ue(266);function D_(o,a){if(1&o){const l=b.EpF();b.TgZ(0,"div",5)(1,"div",6)(2,"input",7,8),b.NdJ("keydown.enter",function(){b.CHM(l);const v=b.MAs(3),w=b.MAs(8);return b.oxw().getGeocode(v.value),b.KtG(w.reset)}),b.qZA(),b.TgZ(4,"button",9),b.NdJ("click",function(){b.CHM(l);const v=b.MAs(3);return b.oxw().clearGeocode(),b.KtG(v.value="")}),b._uU(5,"X"),b.qZA()(),b.TgZ(6,"div",6)(7,"form",10,11),b.NdJ("keydown.enter",function(){b.CHM(l);const v=b.MAs(8),w=b.MAs(3);return b.oxw().getLngLat(v),b.KtG(w.value="")}),b._UZ(9,"input",12)(10,"input",13),b.qZA()()()}}function O_(o,a){if(1&o){const l=b.EpF();b.TgZ(0,"button",16),b.NdJ("click",function(){const w=b.CHM(l).$implicit,C=b.oxw(2);return b.KtG(C.showDataInMap(w))}),b.O4$(),b.TgZ(1,"svg",17),b._UZ(2,"path",18),b.qZA(),b.kcU(),b.TgZ(3,"span",19),b._uU(4),b.qZA()()}if(2&o){const l=a.$implicit;b.Q6J("matTooltip",l.properties.display_name),b.xp6(4),b.Oqu(l.properties.display_name)}}function k_(o,a){if(1&o&&(b.TgZ(0,"div",14),b.YNc(1,O_,5,2,"button",15),b.qZA()),2&o){const l=b.oxw();b.xp6(1),b.Q6J("ngForOf",l.geocodeData)}}function R_(o,a){if(1&o&&(b.TgZ(0,"div",20)(1,"div")(2,"span"),b._uU(3,"Display Name : "),b.qZA(),b.TgZ(4,"span"),b._uU(5),b.qZA()(),b.TgZ(6,"div")(7,"span"),b._uU(8,"Country : "),b.qZA(),b.TgZ(9,"span"),b._uU(10),b.qZA()(),b.TgZ(11,"div")(12,"span"),b._uU(13,"Country Code : "),b.qZA(),b.TgZ(14,"span"),b._uU(15),b.qZA()(),b.TgZ(16,"div")(17,"span"),b._uU(18,"County : "),b.qZA(),b.TgZ(19,"span"),b._uU(20),b.qZA()(),b.TgZ(21,"div")(22,"span"),b._uU(23,"Region : "),b.qZA(),b.TgZ(24,"span"),b._uU(25),b.qZA()(),b.TgZ(26,"div")(27,"span"),b._uU(28,"State : "),b.qZA(),b.TgZ(29,"span"),b._uU(30),b.qZA()(),b.TgZ(31,"div")(32,"span"),b._uU(33,"District : "),b.qZA(),b.TgZ(34,"span"),b._uU(35),b.qZA()(),b.TgZ(36,"div")(37,"span"),b._uU(38,"Village : "),b.qZA(),b.TgZ(39,"span"),b._uU(40),b.qZA()(),b.TgZ(41,"div")(42,"span"),b._uU(43,"City : "),b.qZA(),b.TgZ(44,"span"),b._uU(45),b.qZA()(),b.TgZ(46,"div")(47,"span"),b._uU(48,"House Number : "),b.qZA(),b.TgZ(49,"span"),b._uU(50),b.qZA()(),b.TgZ(51,"div")(52,"span"),b._uU(53,"Postcode : "),b.qZA(),b.TgZ(54,"span"),b._uU(55),b.qZA()(),b.TgZ(56,"div")(57,"span"),b._uU(58,"Road : "),b.qZA(),b.TgZ(59,"span"),b._uU(60),b.qZA()()()),2&o){const l=b.oxw();b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.display_name),b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.address.country),b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.address.country_code),b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.address.county),b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.address.region),b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.address.state),b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.address.state_district),b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.address.village),b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.address.city),b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.address.house_number),b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.address.postcode),b.xp6(5),b.Oqu(l.reverseGeocodeData.properties.address.road)}}function N_(o,a){if(1&o){const l=b.EpF();b.TgZ(0,"div",21),b.NdJ("click",function(){b.CHM(l);const v=b.oxw();return b.KtG(v.showSearchDiv=!v.showSearchDiv)}),b.O4$(),b.TgZ(1,"svg",22),b._UZ(2,"path",23),b.qZA()()}}const F_=function(){return{width:"400px"}},z_=function(){return{width:"30px"}};let B_=(()=>{class o{constructor(l,d,v){this.geocoderService=l,this.mapService=d,this.snackbarService=v,this.showSearchDiv=!1}ngOnInit(){this.map=this.mapService.getMapData()?.map,this.marker=new ge.Marker({color:"#9508c4",draggable:!1})}getGeocode(l){this.reverseGeocodeData=void 0,this.lngLatForm&&this.lngLatForm.resetForm(),this.geocoderService.getGeocoderData(l).subscribe(d=>{d&&(0==d.features.length?this.snackbarService.openSnackbar("Error In Fetching Data","snackbar-err"):this.geocodeData=d.features)},d=>{console.log(d)})}clearGeocode(){this.geocodeData=void 0,this.reverseGeocodeData=void 0,this.showSearchDiv=!1,this.marker.remove()}showDataInMap(l){this.map?.fitBounds(l.bbox),this.marker.setLngLat(l.geometry.coordinates).addTo(this.map)}showCoordinateOnMap(l){this.map.flyTo({center:l.geometry.coordinates,essential:!0,zoom:21}),this.marker.setLngLat(l.geometry.coordinates).addTo(this.map)}getLngLat(l){this.lngLatForm=l,this.reverseGeocode(l.value)}reverseGeocode(l){this.geocodeData=void 0,this.geocoderService.reverseGeocodeData(l).subscribe(d=>{d&&(d.error?this.snackbarService.openSnackbar("Error In Fetching Data","snackbar-err"):(this.reverseGeocodeData=d.features[0],console.log(d),this.showCoordinateOnMap(this.reverseGeocodeData)))},d=>{console.log(d)})}}return o.\u0275fac=function(l){return new(l||o)(b.Y36(A_),b.Y36(_m),b.Y36(K))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-geocoder"]],decls:5,vars:7,consts:[["id","geocoder",3,"ngStyle"],["class","row m-0",4,"ngIf"],["class","row","class","list-group",4,"ngIf"],["class","row","class","reverse-geocode-data",4,"ngIf"],["matTooltip","Search Address","class","search-icon p-flex rounded shadow","role","button",3,"click",4,"ngIf"],[1,"row","m-0"],[1,"row","m-0","p-0"],["autocomplete","off","type","text","id","search-input","placeholder","Search Address",1,"col-11",3,"keydown.enter"],["searchValue",""],[1,"close-btn","col-1",3,"click"],["id","lngLatForm",1,"m-0","p-0",3,"keydown.enter"],["lngLatForm","ngForm"],["type","number","autocomplete","off","name","lng","ngModel","","placeholder","Longitude",1,"w-50"],["type","number","autocomplete","off","name","lat","ngModel","","placeholder","Latitude",1,"w-50"],[1,"list-group"],["type","button","class","list-group-item list-group-item-action search-list-item",3,"matTooltip","click",4,"ngFor","ngForOf"],["type","button",1,"list-group-item","list-group-item-action","search-list-item",3,"matTooltip","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-geo-alt-fill"],["d","M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"],[1,"ms-2"],[1,"reverse-geocode-data"],["matTooltip","Search Address","role","button",1,"search-icon","p-flex","rounded","shadow",3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-search"],["d","M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"]],template:function(l,d){1&l&&(b.TgZ(0,"div",0),b.YNc(1,D_,11,0,"div",1),b.YNc(2,k_,2,1,"div",2),b.YNc(3,R_,61,12,"div",3),b.YNc(4,N_,3,0,"div",4),b.qZA()),2&l&&(b.Q6J("ngStyle",d.showSearchDiv?b.DdM(5,F_):b.DdM(6,z_)),b.xp6(1),b.Q6J("ngIf",d.showSearchDiv),b.xp6(1),b.Q6J("ngIf",d.geocodeData),b.xp6(1),b.Q6J("ngIf",d.reverseGeocodeData),b.xp6(1),b.Q6J("ngIf",!d.showSearchDiv))},dependencies:[ae.sg,ae.O5,ae.PC,L_.gM,c._Y,c.Fj,c.wV,c.JJ,c.JL,c.On,c.F],styles:["#search-input[_ngcontent-%COMP%]::placeholder{font-size:15px}#lngLatForm[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]::placeholder{font-size:15px}#lngLatForm[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]{height:10px;font-size:15px;padding:12px 15px}#lngLatForm[_ngcontent-%COMP%] > input[_ngcontent-%COMP%]:focus{outline:none}button[_ngcontent-%COMP%]{font-size:15px}.close-btn[_ngcontent-%COMP%]{background:transparent;border:.1px solid rebeccapurple}.close-btn[_ngcontent-%COMP%]:hover{background:transparent;border:.1px solid red;color:red}#geocoder[_ngcontent-%COMP%]{position:absolute;z-index:2;left:5px;top:5px}#search-input[_ngcontent-%COMP%]{height:10px;font-size:15px;padding:15px}#search-input[_ngcontent-%COMP%]:focus{outline:none}.search-icon[_ngcontent-%COMP%]{height:30px;background-color:#fff;border:1px solid black}.search-list-item[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.reverse-geocode-data[_ngcontent-%COMP%]{background-color:#fff;padding:10px}.reverse-geocode-data[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]:nth-child(1){font-weight:bolder}"]}),o})();function U_(o,a){1&o&&(b.TgZ(0,"div"),b._UZ(1,"app-geocoder"),b.qZA())}function G_(o,a){1&o&&b._UZ(0,"mat-progress-spinner",4)}let d_=(()=>{class o{constructor(l){this.mapService=l,this.showGeocoder=!1,this.mapDataEmit=new b.vpe,this.showSpinner=!0}set content(l){l&&(this.identityFeatureSideNavCompontent=l)}ngOnInit(){this.mapService.initializeDraw(),this.mapService.initializeMap("map"),this.mapService.addControlsOnMap(),this.map=this.mapService.getMapData().map,this.draw=this.mapService.getMapData().draw,this.mapDataEmit.emit({map:this.map,draw:this.draw}),this.handleSpinner()}handleSpinner(){this.map.on("load",()=>{this.mapService.addSourceFn()}),this.map.on("idle",()=>{this.showSpinner=!1}),this.map.on("zoom",()=>{this.showSpinner=!0}),this.map.on("dragpen",()=>{this.showSpinner=!0}),this.map.on("style.load",()=>{this.map.setFog({color:"rgb(186, 210, 235)","high-color":"rgb(36, 92, 223)","horizon-blend":.02,"space-color":"rgb(11, 11, 25)","star-intensity":.1})})}sendIdentityFeatureData(l){this.identityFeatureSideNavCompontent.showIdentity(l)}}return o.\u0275fac=function(l){return new(l||o)(b.Y36(_m))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-map-common"]],viewQuery:function(l,d){if(1&l&&b.Gf(pt,5),2&l){let v;b.iGM(v=b.CRH())&&(d.content=v.first)}},inputs:{showGeocoder:"showGeocoder"},outputs:{mapDataEmit:"mapDataEmit"},decls:5,vars:3,consts:[["id","map"],[3,"map"],[4,"ngIf"],["class","spinner","color","warn","mode","indeterminate","diameter","50",4,"ngIf"],["color","warn","mode","indeterminate","diameter","50",1,"spinner"]],template:function(l,d){1&l&&(b.TgZ(0,"div",0),b._UZ(1,"app-identity-feature-side-nav",1),b.YNc(2,U_,2,0,"div",2),b.YNc(3,G_,1,0,"mat-progress-spinner",3),b._UZ(4,"app-data-table"),b.qZA()),2&l&&(b.xp6(1),b.Q6J("map",d.map),b.xp6(1),b.Q6J("ngIf",d.showGeocoder),b.xp6(1),b.Q6J("ngIf",d.showSpinner))},dependencies:[ae.O5,p_.Ou,I_,pt,B_],styles:["#map[_ngcontent-%COMP%]{height:100vh;width:100%;position:relative;top:0;left:0}.spinner[_ngcontent-%COMP%]{z-index:2;position:absolute;left:0;right:0;top:5%;margin:auto}"]}),o})();function j_(o,a){if(1&o){const l=b.EpF();b.TgZ(0,"span",22),b.NdJ("click",function(){b.CHM(l);const v=b.oxw();return b.KtG(v.showAboutUs=!1)}),b.O4$(),b.TgZ(1,"svg",23),b._UZ(2,"path",24)(3,"path",25),b.qZA()()}}let q_=(()=>{class o{constructor(l,d,v){this.mapService=l,this.dataShareService=d,this.styleService=v,this.currentMapStyle="streets"}getRasterTile(l){return{version:8,sources:{"raster-tiles":{type:"raster",tiles:[l],tileSize:256,attribution:'Map tiles by <a target="_top" rel="noopener" href="http://stamen.com">Stamen Design</a>, under <a target="_top" rel="noopener" href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a target="_top" rel="noopener" href="http://openstreetmap.org">OpenStreetMap</a>, under <a target="_top" rel="noopener" href="http://creativecommons.org/licenses/by-sa/3.0">CC BY SA</a>'}},layers:[{id:"simple-tiles",type:"raster",source:"raster-tiles",minzoom:0,maxzoom:22}]}}ngOnInit(){this.dataShareService.getSourceData.subscribe(l=>{this.geo_json_main=l})}setMapStyle(l){switch(this.removeSourceAndLayer(),this.currentMapStyle=l,l){case"maplibre-default":this.map.setStyle("https://demotiles.maplibre.org/style.json");break;case"open-streets-map":this.map.setStyle(this.mapService.style);break;case"raster-tile":this.map.setStyle(this.getRasterTile("https://stamen-tiles.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.jpg"));break;case"wikimedia":this.map.setStyle(this.getRasterTile("https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}.png"));break;case"satellite":this.map.setStyle("mapbox://styles/mapbox/satellite-streets-v12");break;case"streets":this.map.setStyle("mapbox://styles/mapbox/streets-v12")}setTimeout(()=>{this.addExistingSource()},1e3)}removeSourceAndLayer(){this.mapService.removeLayerFn(),this.mapService.removeSourceFn()}addExistingSource(){let l=0,d={...this.geo_json_main},v=JSON.parse(JSON.stringify(d));this.geo_json_main?(this.geo_json_main.features.forEach((w,C)=>{"marker"==w.geometry.type&&(v.features.splice(C-l,1),l++)}),this.mapService.addSourceFn(v),this.styleService.setDataOnMap(this.map,this.geo_json_main,!0,!1)):this.mapService.addSourceFn()}}return o.\u0275fac=function(l){return new(l||o)(b.Y36(_m),b.Y36(Oe),b.Y36(X))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-map-styles"]],inputs:{map:"map",draw:"draw"},decls:37,vars:5,consts:[["id","map-style"],[1,"d-flex","border","map-type"],["role","button",1,"px-2",3,"ngClass","click"],["id","about",1,"text-center","text-light","bg-dark",3,"ngClass"],[1,"border-bottom","border-3","border-primary","pointer"],[1,"mb-0",3,"click"],[3,"click",4,"ngIf"],["id","author-image",1,"mt-4"],[1,"mb-0"],[1,"px-3"],[1,"pt-2","pb-4"],["target","_blank","href","https://in.linkedin.com/in/pushpendra-sapkale-744125121?original_referer=https%3A%2F%2Fwww.google.com%2F"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-linkedin"],["d","M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"],["href","mailto: dev.psapkale@gmail.com",1,"ms-3"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-google"],["d","M15.545 6.558a9.42 9.42 0 0 1 .139 1.626c0 2.434-.87 4.492-2.384 5.885h.002C11.978 15.292 10.158 16 8 16A8 8 0 1 1 8 0a7.689 7.689 0 0 1 5.352 2.082l-2.284 2.284A4.347 4.347 0 0 0 8 3.166c-2.087 0-3.86 1.408-4.492 3.304a4.792 4.792 0 0 0 0 3.063h.003c.635 1.893 2.405 3.301 4.492 3.301 1.078 0 2.004-.276 2.722-.764h-.003a3.702 3.702 0 0 0 1.599-2.431H8v-3.08h7.545z"],["target","_blank","href","https://www.instagram.com/pushpendr_a/",1,"ms-3"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-instagram"],["d","M8 0C5.829 0 5.556.01 4.703.048 3.85.088 3.269.222 2.76.42a3.917 3.917 0 0 0-1.417.923A3.927 3.927 0 0 0 .42 2.76C.222 3.268.087 3.85.048 4.7.01 5.555 0 5.827 0 8.001c0 2.172.01 2.444.048 3.297.04.852.174 1.433.372 1.942.205.526.478.972.923 1.417.444.445.89.719 1.416.923.51.198 1.09.333 1.942.372C5.555 15.99 5.827 16 8 16s2.444-.01 3.298-.048c.851-.04 1.434-.174 1.943-.372a3.916 3.916 0 0 0 1.416-.923c.445-.445.718-.891.923-1.417.197-.509.332-1.09.372-1.942C15.99 10.445 16 10.173 16 8s-.01-2.445-.048-3.299c-.04-.851-.175-1.433-.372-1.941a3.926 3.926 0 0 0-.923-1.417A3.911 3.911 0 0 0 13.24.42c-.51-.198-1.092-.333-1.943-.372C10.443.01 10.172 0 7.998 0h.003zm-.717 1.442h.718c2.136 0 2.389.007 3.232.046.78.035 1.204.166 1.486.275.373.145.64.319.92.599.28.28.453.546.598.92.11.281.24.705.275 1.485.039.843.047 1.096.047 3.231s-.008 2.389-.047 3.232c-.035.78-.166 1.203-.275 1.485a2.47 2.47 0 0 1-.599.919c-.28.28-.546.453-.92.598-.28.11-.704.24-1.485.276-.843.038-1.096.047-3.232.047s-2.39-.009-3.233-.047c-.78-.036-1.203-.166-1.485-.276a2.478 2.478 0 0 1-.92-.598 2.48 2.48 0 0 1-.6-.92c-.109-.281-.24-.705-.275-1.485-.038-.843-.046-1.096-.046-3.233 0-2.136.008-2.388.046-3.231.036-.78.166-1.204.276-1.486.145-.373.319-.64.599-.92.28-.28.546-.453.92-.598.282-.11.705-.24 1.485-.276.738-.034 1.024-.044 2.515-.045v.002zm4.988 1.328a.96.96 0 1 0 0 1.92.96.96 0 0 0 0-1.92zm-4.27 1.122a4.109 4.109 0 1 0 0 8.217 4.109 4.109 0 0 0 0-8.217zm0 1.441a2.667 2.667 0 1 1 0 5.334 2.667 2.667 0 0 1 0-5.334z"],["href","mailto: dev.psapkale@gmail.com",1,"text-info"],[1,"mb-2"],[3,"click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-x-circle","close-btn"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["d","M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"]],template:function(l,d){1&l&&(b.TgZ(0,"div",0)(1,"div",1)(2,"div",2),b.NdJ("click",function(){return d.setMapStyle("streets")}),b._uU(3,"Streets"),b.qZA(),b.TgZ(4,"div",2),b.NdJ("click",function(){return d.setMapStyle("open-streets-map")}),b._uU(5,"OSM"),b.qZA(),b.TgZ(6,"div",2),b.NdJ("click",function(){return d.setMapStyle("satellite")}),b._uU(7,"Satelite"),b.qZA()(),b.TgZ(8,"div",3)(9,"header",4)(10,"h3",5),b.NdJ("click",function(){return d.showAboutUs=!d.showAboutUs}),b._uU(11," About Us "),b.qZA(),b.YNc(12,j_,4,0,"span",6),b.qZA(),b.TgZ(13,"div"),b._UZ(14,"div",7),b.TgZ(15,"h2",8),b._uU(16,"Pushpendra Sapkale"),b.qZA(),b.TgZ(17,"h4"),b._uU(18,"Full Stack Developer"),b.qZA(),b.TgZ(19,"p",9),b._uU(20," Creative and technical web developer, Post graduated in Master of computer application "),b.qZA(),b.TgZ(21,"div",10)(22,"a",11),b.O4$(),b.TgZ(23,"svg",12),b._UZ(24,"path",13),b.qZA()(),b.kcU(),b.TgZ(25,"a",14),b.O4$(),b.TgZ(26,"svg",15),b._UZ(27,"path",16),b.qZA()(),b.kcU(),b.TgZ(28,"a",17),b.O4$(),b.TgZ(29,"svg",18),b._UZ(30,"path",19),b.qZA()()(),b.kcU(),b.TgZ(31,"div"),b._uU(32," Email: "),b.TgZ(33,"a",20),b._uU(34,"dev.psapkale@gmail.com"),b.qZA()(),b.TgZ(35,"div",21),b._uU(36," Developer of this tool "),b.qZA()()()()),2&l&&(b.xp6(2),b.Q6J("ngClass","streets"==d.currentMapStyle?"active-map-style":""),b.xp6(2),b.Q6J("ngClass","open-streets-map"==d.currentMapStyle?"active-map-style":""),b.xp6(2),b.Q6J("ngClass","satellite"==d.currentMapStyle?"active-map-style":""),b.xp6(2),b.Q6J("ngClass",d.showAboutUs?"show-about-us":"hide-about-us"),b.xp6(4),b.Q6J("ngIf",d.showAboutUs))},dependencies:[ae.mk,ae.O5],styles:["#map-style[_ngcontent-%COMP%]{position:absolute;bottom:0;width:100%}.active-map-style[_ngcontent-%COMP%]{background-color:#8b0000;color:#fff}.map-type[_ngcontent-%COMP%]{position:absolute;bottom:31px}#about[_ngcontent-%COMP%]{position:absolute;background-color:red;width:100%;z-index:1;transition:transform 1s linear}.hide-about-us[_ngcontent-%COMP%]{transform:translatey(-28px)}.show-about-us[_ngcontent-%COMP%]{transform:translatey(-100%)}header[_ngcontent-%COMP%]{position:relative}.close-btn[_ngcontent-%COMP%]{position:absolute;right:10px;top:7px}#author-image[_ngcontent-%COMP%]{background-image:url(Author.f3824a30f28c559e.jpeg);height:150px;width:100%;background-position:top;background-size:cover;clip-path:circle(28% at 50% 37%)}#about[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:wheat}"]}),o})(),V_=(()=>{class o{constructor(){}ngOnInit(){}}return o.\u0275fac=function(l){return new(l||o)},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-header"]],decls:6,vars:0,consts:[[1,"bg-info","header","p-2","fs-5","shadow-sm","p-flex"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-globe-americas","me-2"],["d","M8 0a8 8 0 1 0 0 16A8 8 0 0 0 8 0ZM2.04 4.326c.325 1.329 2.532 2.54 3.717 3.19.48.263.793.434.743.484-.08.08-.162.158-.242.234-.416.396-.787.749-.758 1.266.035.634.618.824 1.214 1.017.577.188 1.168.38 1.286.983.082.417-.075.988-.22 1.52-.215.782-.406 1.48.22 1.48 1.5-.5 3.798-3.186 4-5 .138-1.243-2-2-3.5-2.5-.478-.16-.755.081-.99.284-.172.15-.322.279-.51.216-.445-.148-2.5-2-1.5-2.5.78-.39.952-.171 1.227.182.078.099.163.208.273.318.609.304.662-.132.723-.633.039-.322.081-.671.277-.867.434-.434 1.265-.791 2.028-1.12.712-.306 1.365-.587 1.579-.88A7 7 0 1 1 2.04 4.327Z"],[1,"sub-name"]],template:function(l,d){1&l&&(b.TgZ(0,"h2",0),b.O4$(),b.TgZ(1,"svg",1),b._UZ(2,"path",2),b.qZA(),b._uU(3," GeoJSON Creator "),b.kcU(),b.TgZ(4,"sub",3),b._uU(5,"Tool"),b.qZA()())},styles:[".header[_ngcontent-%COMP%]{font-family:emoji}.sub-name[_ngcontent-%COMP%]{color:#8b0000;font-family:cursive}"]}),o})(),Z_=(()=>{class o{constructor(l,d,v,w,C){this.dialogRef=l,this.data=d,this.styleService=v,this.dataShareService=w,this.snackbarService=C}ngOnInit(){this.data&&(this.map=this.data.map)}uploadFile(l){this.uploadedFile=l.target.files[0];const d=new FileReader;d.readAsText(this.uploadedFile,"UTF-8"),d.onload=()=>{let v=this.setStyleOnUploadedFile(d.result.toString());this.uploadedJsonObj=this.setGeoJsonForOurTool(v),this.dataShareService.sendSourceData(this.uploadedJsonObj),this.styleService.setDataOnMap(this.map,this.uploadedJsonObj),this.snackbarService.openSnackbar("File uploaded successfully","snackbar-success"),this.dialogRef.close()},d.onerror=v=>{console.log(v),this.snackbarService.openSnackbar("Failed in uploading your flile please try again","snackbar-err")}}setGeoJsonForOurTool(l){return l.features.length>0&&l.features.forEach((d,v)=>{"Point"==d.geometry.type&&(l.features[v].geometry.type=void 0!==d.styledetails.styledata.markername||void 0!==d.styledetails.styledata.textname?"marker":"Point")}),l}setStyleOnUploadedFile(l){let d=0,v=JSON.parse(l),w=JSON.parse(JSON.stringify({...v})),C=JSON.parse(JSON.stringify({...w}));return w.features.forEach((A,D)=>{null==A.styledetails&&(null==A.id?(C.features[D].id="new_feature"+Number(Math.random()+d),C.features[D].properties={featureid:C.features[D].id},C.features[D].styledetails={id:C.features[D].id},C.features[D]=this.setStyleDetailsInFeature(C,D),d++):(C.features[D].properties={featureid:C.features[D].id},C.features[D].styledetails={id:C.features[D].id},C.features[D]=this.setStyleDetailsInFeature(C,D)))}),C}setStyleDetailsInFeature(l,d){let v=JSON.parse(JSON.stringify({...l}));switch(v.features[d].geometry.type){case"Polygon":v.features[d].styledetails={id:v.features[d].id,styledata:{fillcolor:"#10CAF0",fillopacity:.4,fillborderwidth:2,fillbordercolor:"#3b1513"}},v.features[d].measurement={squaremeters:Math.round(100*fl(v))/100};break;case"Point":v.features[d].styledetails={id:v.features[d].id,styledata:{circleradius:6,circlecolor:"#B42222"}};break;case"LineString":v.features[d].styledetails={id:v.features[d].id,styledata:{linecolor:"#572d06",linewidth:2}},v.features[d].measurement={kilometers:Pa(v)}}return v.features[d]}closeDialog(){this.dialogRef.close()}}return o.\u0275fac=function(l){return new(l||o)(b.Y36(Z.so),b.Y36(Z.WI),b.Y36(X),b.Y36(Oe),b.Y36(K))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-upload-data"]],decls:9,vars:0,consts:[[1,"p-flex","mb-3","upload-header"],["role","button",3,"click"],["type","file","name","","id","file","accept",".json, .geojson","multiple","false","width","30px",3,"change"],[1,"p-flex","mt-1","mb-3","text-primary"]],template:function(l,d){1&l&&(b.TgZ(0,"div")(1,"div",0)(2,"h2"),b._uU(3,"UPLOAD FILE"),b.qZA(),b.TgZ(4,"mat-icon",1),b.NdJ("click",function(){return d.closeDialog()}),b._uU(5,"close"),b.qZA()(),b.TgZ(6,"input",2),b.NdJ("change",function(w){return d.uploadFile(w)}),b.qZA(),b.TgZ(7,"div",3),b._uU(8," size - 4 MB (MAX) "),b.qZA()())},dependencies:[ee.Hw],styles:["input[_ngcontent-%COMP%]{width:100%}.upload-header[_ngcontent-%COMP%]{position:relative}.upload-header[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{position:absolute;right:0;top:3px}"]}),o})();const X_=["mouseTip"];function $_(o,a){1&o&&(b.TgZ(0,"div")(1,"h3",52),b._uU(2,"* Please use mouse right click for open feature form for marker and text"),b.qZA()())}function Y_(o,a){1&o&&(b.TgZ(0,"div")(1,"h3",52),b._uU(2,"* Please do not drag or edit points while you are using rotate mode "),b.qZA()())}let W_=(()=>{class o{constructor(l,d,v,w,C,A,D){this.styleService=l,this.dataShareService=d,this.identityFeatureService=v,this.snackbarService=w,this.mapService=C,this.matDialog=A,this.downloadDataService=D,this.editModeGeoJsonCheck=0,this.canDeleteGeom=!1,this.layerEditMode=!1,this.geo_json_main={type:"FeatureCollection",features:[]},this.activeTool="simple-select",this.canDrawMarker=!1,this.drawContinuously=!1,this.showMapCursorTip=!1,this.mousePopUpMessage="Welcome to Your Map<br><sub>Please select any drawing type and enjoy !!</sub>",this.sendIdentityFeatureData=new b.vpe,this.getShowGeocoderStatus=new b.vpe,this.isRotateModeActive=!1}ngOnInit(){}ngAfterViewInit(){this.drawDefinations(),this.dataShareService.initializeMapPopUp(),this.dataShareService.getSourceData.subscribe(l=>{this.geo_json_main=l}),this.mapService.getCircleFeature.subscribe(l=>{this.circlePolygonFeature=l}),this.map.on("click",l=>{this.canDrawMarker&&this.getCoordinates(l)})}drawDefinations(){this.map.on("draw.create",()=>this.getDrawSource("create")),this.map.on("draw.delete",()=>this.getDrawSource("delete")),this.map.on("draw.update",()=>this.getDrawSource("update")),this.setIdentityFeature()}setIdentityFeature(){this.map.on("click","YourMapSourceIdLineString",l=>{this.geomClickHandler(l)}),this.map.on("click","YourMapSourceIdPolygon",l=>{this.geomClickHandler(l)}),this.map.on("click","YourMapSourceIdPoint",l=>{this.geomClickHandler(l)}),this.setMouseEffectOnMap()}geomClickHandler(l){this.canDeleteGeom?this.deleteFeatureOnClick(l):"simple-select"==this.activeTool&&this.sendIdentityFeatureStatus(l)}deleteFeatureOnClick(l){let d={...this.geo_json_main};const v=l.features[0].properties.featureid;let w=d.features.findIndex(C=>C.id==v);d.features.splice(w,1),this.styleService.setDataOnMap(this.map,d),this.dataShareService.sendSourceData(d)}setMouseEffectOnMap(){this.map.on("mouseenter","YourMapSourceIdLineString",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseenter","YourMapSourceIdPolygon",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseenter","YourMapSourceIdPoint",()=>{this.map.getCanvas().style.cursor="pointer"}),this.map.on("mouseleave","YourMapSourceIdLineString",()=>{this.map.getCanvas().style.cursor=""}),this.map.on("mouseleave","YourMapSourceIdPolygon",()=>{this.map.getCanvas().style.cursor=""}),this.map.on("mouseleave","YourMapSourceIdPoint",()=>{this.map.getCanvas().style.cursor=""})}identityFeatureData(l){let d=Object.keys(l),v=[];return d.forEach(w=>{let C={name:"",value:""};C.name=w,C.value=l[w],v.push(C)}),v}sendIdentityFeatureStatus(l){this.showIdentityFeature(this.identityFeatureData(l.features[0].properties)),this.activeFeatureId=l.features[0].properties.featureid}showIdentityFeature(l){setTimeout(()=>{this.identityFeatureService.sendShowIdentityFeatureStatus(!1),setTimeout(()=>{this.identityFeatureService.sendShowIdentityFeatureStatus(!0),this.sendIdentityFeatureData.emit(l)},200)},0)}getDrawSource(l){if("create"==l&&(this.setGeoJsonMain(),this.styleService.setDataOnMap(this.map,this.geo_json_main),this.drawContinuously||(this.mousePopUpMessage="Welcome to Your Map<br><sub>Please select any drawing type and enjoy !!</sub>")),"update"==l&&this.layerEditMode&&this.editModeGeoJsonCheck++,this.sendDrawSourceData(),this.drawContinuously||this.canDeleteGeom){if("create"!==l)return;setTimeout(()=>{this.draw.changeMode(this.activeDrawMode)},0)}else setTimeout(()=>{this.afterDrawCreated()},0);this.showMapCursorTip&&this.mousePopupTurnOn()}setGeoJsonMain(){let d,l=this.draw.getAll();"draw_radius"==this.activeDrawMode?(d=this.circlePolygonFeature,d.id=this.draw.getAll().features[0].id,this.circlePolygonFeature=void 0):d=l.features[0],d&&(d.properties.featureid=l.features[0].id,d=this.setStyleDetails(d),this.geo_json_main.features.push(d),this.geo_json_main.features=this.getUniqueValue(),this.draw.deleteAll())}setStyleDetails(l){let d=l,v={fillcolor:"#10CAF0",fillopacity:.4,fillborderwidth:2,fillbordercolor:"#3b1513"},w={linecolor:"#572d06",linewidth:2};if("Polygon"==l.geometry.type){const P=fl(l);d.styledetails={id:l.id,styledata:v},d.measurement={squaremeters:Math.round(100*P)/100}}if("Point"==l.geometry.type&&(this.drawCustomMarker?(d.styledetails=this.drawText?{id:l.id,styledata:{height:"20",width:"fit-content",color:"blue",textfontsize:"15",textname:"Edit Text"}}:{id:l.id,styledata:{height:"20",width:"20",markername:"marker"}},d.geometry.type="marker"):d.styledetails={id:l.id,styledata:{circleradius:6,circlecolor:"#B42222"}}),"LineString"==l.geometry.type){const P=Pa(this.draw.getAll());d.styledetails={id:l.id,styledata:w},d.measurement={kilometers:P}}return d}getUniqueValue(){return this.geo_json_main.features.reduce(function(d,v){return d.filter(function(C){return C.id===v.id}).length>0||d.push(v),d},[])}afterDrawCreated(){this.activeTool=this.layerEditMode?"edit-mode":"simple-select"}getCoordinates(l){let d=l.lngLat.wrap();this.drawMarker([d.lng,d.lat])}drawMarker(l){this.marker=new ge.Marker({draggable:!0}).setLngLat(l).addTo(this.map),this.drawContinuously||(this.handleMarker("deactive"),this.activeTool="simple-select")}startDraw(l){if(this.identityFeatureService.sendShowIdentityFeatureStatus(!1),this.layerEditMode)this.snackbarService.openSnackbar(this.isRotateModeActive?"Please turn off layer rotate mode to use this feature":"Please turn of edit layer to use this feature","snackbar-err");else{switch(this.activeTool=l,"marker"!==this.activeTool&&this.handleMarker("deactive"),this.drawCustomMarker=!1,"delete-tool"!==l&&(this.canDeleteGeom=!1,this.styleService.canDeleteMarker=!1),l){case"polygon":this.activeDrawMode="draw_polygon",this.draw.changeMode(this.activeDrawMode),this.mousePopUpMessage="Use mouse left click to drop polygon vertices on map and for stop use mouse double click";break;case"circle":this.activeDrawMode="draw_radius",this.draw.changeMode(this.activeDrawMode),this.mousePopUpMessage="Use mouse left click one time then drag mouse for set radius and use mouse left click to stop";break;case"line":this.activeDrawMode="draw_line_string",this.draw.changeMode(this.activeDrawMode),this.mousePopUpMessage="Use mouse left click to drop line vertices and for stop use mouse double click";break;case"freehand":this.activeDrawMode="draw_freehand",this.draw.changeMode(this.activeDrawMode),this.mousePopUpMessage="Hold mouse left click and drag mouse to draw freehand polygon like pencil sketch";break;case"points":this.activeDrawMode="draw_point",this.draw.changeMode(this.activeDrawMode),this.mousePopUpMessage="Use mouse left click to ploat point";break;case"marker":this.activeDrawMode="active",this.handleMarker(this.activeDrawMode),this.mousePopUpMessage="Use mouse left click and draw marker";break;case"square":this.activeDrawMode="draw_rectangle",this.draw.changeMode(this.activeDrawMode),this.mousePopUpMessage="Press mouse left click one time to start drawing freehand Square and for stop only use mouse left click once";break;case"freehand-line":this.activeDrawMode="draw_freehand_line",this.draw.changeMode(this.activeDrawMode),this.mousePopUpMessage="Hold mouse left click and draw on map like pencil skectch";break;case"custom-marker":this.drawCustomMarker=!0,this.drawText=!1,this.activeDrawMode="draw_point",this.draw.changeMode(this.activeDrawMode),this.mousePopUpMessage="Press mouse left click and add marker on map";break;case"add-text":this.drawCustomMarker=!0,this.drawText=!0,this.activeDrawMode="draw_point",this.draw.changeMode(this.activeDrawMode),this.mousePopUpMessage="Press mouse left click to add text on map";break;case"simple-select":this.activeDrawMode="simple_select",this.draw.changeMode(this.activeDrawMode),this.mousePopUpMessage="Welcome to Your Map<br><sub>Please select any drawing type and enjoy !!</sub>";break;case"delete-tool":this.draw.changeMode("simple_select"),this.canDeleteGeom=!0,this.styleService.canDeleteMarker=!0,this.mousePopUpMessage="Click on feature which you want to delte"}this.showMapCursorTip&&this.dataShareService.useMapPopUp(this.map,this.mousePopUpMessage,"color: gray; font-family: fantasy;")}}rotateModeHandler(){this.editModeHandler(),setTimeout(()=>{this.draw.changeMode("rotate_mode")},0),this.isRotateModeActive=!this.isRotateModeActive}editModeHandler(){if(this.layerEditMode=!this.layerEditMode,this.layerEditMode){this.activeTool="edit-mode",this.mousePopUpMessage="Click on feature to edit or drag it on map",this.showMapCursorTip&&this.dataShareService.useMapPopUp(this.map,this.mousePopUpMessage,"color: gray; font-family: fantasy;"),this.draw.changeMode("simple_select");let l=this.downloadDataService.changeTypeMarkerToPoint(JSON.parse(JSON.stringify({...this.geo_json_main})));this.styleService.deleteAllMarkers(),this.draw.add(l),this.map.getSource("YourMapSource").setData({type:"FeatureCollection",features:[]})}else this.activeTool="simple-select",this.geo_json_main=this.setGeoJsonForStopEditMode(),this.editModeGeoJsonCheck>0||this.isRotateModeActive?this.styleService.setDataOnMap(this.map,this.geo_json_main,!1):this.styleService.setDataOnMap(this.map,this.geo_json_main,!1,!1),this.dataShareService.sendSourceData(this.geo_json_main),this.draw.deleteAll(),this.stopDraw(),this.editModeGeoJsonCheck=0}changeTypeMarkerToPoint(l){return l.features.forEach((d,v)=>{"marker"==d.geometry.type&&(l.features[v].geometry.type="Point")}),l}setGeoJsonForStopEditMode(){let l=this.draw.getAll();return this.geo_json_main.features.forEach((d,v)=>{l.features.forEach((w,C)=>{w.id==d.id&&(this.geo_json_main.features[v].geometry.coordinates=l.features[C].geometry.coordinates)})}),this.geo_json_main}stopDraw(){this.activeTool="simple-select",this.showMapCursorTip&&(this.mousePopUpMessage="Welcome to Your Map<br><sub>Please select any drawing type and enjoy !!</sub>",this.dataShareService.useMapPopUp(this.map,this.mousePopUpMessage,"color: gray; font-family: fantasy;")),this.draw.changeMode("simple_select"),this.handleMarker("deactive"),this.canDeleteGeom=!1,this.styleService.canDeleteMarker=!1}handleMarker(l){"active"==l?(this.draw.trash(),this.canDrawMarker=!0):this.canDrawMarker=!1}getDrawContinousStatus(l){this.drawContinuously=l.checked,0==this.drawContinuously&&this.stopDraw()}getShowTipOnMouseStatus(l){l.checked?this.mousePopupTurnOn():this.mousePopupTurnOff()}getShowMapProjectionStatus(l){l.checked?(this.map.getZoom()<2&&this.map.flyTo({center:[78,23],zoom:1,essential:!0}),this.map.setProjection("mercator")):this.map.setProjection("globe")}sendShowGeocoderStatus(l){this.getShowGeocoderStatus.emit(l.checked),l.checked?this.mapService.removeControlGeocoder():this.mapService.addControlGeocoder()}mousePopupTurnOn(){this.showMapCursorTip=!0,this.dataShareService.useMapPopUp(this.map,this.mousePopUpMessage,"color: gray; font-family: fantasy;")}mousePopupTurnOff(){this.showMapCursorTip=!1,this.dataShareService.removeMapPopUp()}sendDrawSourceData(){this.dataShareService.sendSourceData(this.geo_json_main)}showDataTable(){this.dataShareService.sendShowDataTableStatus(!0),this.stopDraw()}addLabelHandler(l){if(1==l.checked){let d=this.downloadDataService.changeTypeMarkerToPoint(JSON.parse(JSON.stringify({...this.geo_json_main}))),v=this.changeTypePolygonToPoint(JSON.parse(JSON.stringify({...d})));this.mapService.addLabelFn(v),console.log(this.geo_json_main)}else this.mapService.removeLabelFn()}changeTypePolygonToPoint(l){let d={...l};return d.features.forEach((v,w)=>{if("Polygon"==v.geometry.type){let C=function So(o,a){void 0===a&&(a={});var l=0,d=0,v=0;return Ws(o,function(w){l+=w[0],d+=w[1],v++},!0),Bn([l/v,d/v],a.properties)}(v);d.features[w].geometry=C.geometry}}),d}undo(){this.layerEditMode?this.snackbarService.openSnackbar("Please turn of edit layer to use undo","snackbar-err"):this.styleService.handleUndo()}redo(){this.layerEditMode?this.snackbarService.openSnackbar("Please turn of edit layer to use redo","snackbar-err"):this.styleService.handleRedo()}showUploadDialog(){this.matDialog.open(Z_,{width:"250px",data:{map:this.map},enterAnimationDuration:"200ms",exitAnimationDuration:"200ms"})}downloadData(){let l=JSON.parse(JSON.stringify({...this.geo_json_main}));this.downloadDataFinal(l,"geojson")}downloadDataFinal(l,d){l&&l.features.length>0?(l=this.downloadDataService.changeTypeMarkerToPoint(JSON.parse(JSON.stringify({...l}))),this.downloadDataService.downloadData(d,{...l})):this.snackbarService.openSnackbar("Please draw atleast one geometry","snackbar-err")}resetData(){this.draw.deleteAll(),this.stopDraw(),this.geo_json_main={type:"FeatureCollection",features:[]},this.dataShareService.sendSourceData(this.geo_json_main),this.mapService.removeLayerFn(),this.mapService.removeSourceFn(),this.styleService.deleteAllMarkers(),this.mapService.addSourceFn(),this.layerEditMode=!1,this.isRotateModeActive=!1}}return o.\u0275fac=function(l){return new(l||o)(b.Y36(X),b.Y36(Oe),b.Y36(xe),b.Y36(K),b.Y36(_m),b.Y36(Z.uw),b.Y36(Ay))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-draw-common"]],viewQuery:function(l,d){if(1&l&&b.Gf(X_,5),2&l){let v;b.iGM(v=b.CRH())&&(d.mouseTip=v.first)}},inputs:{draw:"draw",map:"map"},outputs:{sendIdentityFeatureData:"sendIdentityFeatureData",getShowGeocoderStatus:"getShowGeocoderStatus"},decls:78,vars:32,consts:[[1,"draw-main","px-3","pb-3"],["title","Hold mouse left click and drag mouse to draw freehand polygon like pencil sketch",1,"border","p-2","draw-tool","p-flex",3,"disabled","ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pen"],["d","m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001zm-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708l-1.585-1.585z"],["title","Use mouse left click to drop polygon vertices on map and for stop use mouse double click",1,"border","p-2","draw-tool","p-flex",3,"disabled","ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pentagon"],["d","M7.685 1.545a.5.5 0 0 1 .63 0l6.263 5.088a.5.5 0 0 1 .161.539l-2.362 7.479a.5.5 0 0 1-.476.349H4.099a.5.5 0 0 1-.476-.35L1.26 7.173a.5.5 0 0 1 .161-.54l6.263-5.087Zm8.213 5.28a.5.5 0 0 0-.162-.54L8.316.257a.5.5 0 0 0-.631 0L.264 6.286a.5.5 0 0 0-.162.538l2.788 8.827a.5.5 0 0 0 .476.349h9.268a.5.5 0 0 0 .476-.35l2.788-8.826Z"],["title","Press mouse left click once to start drawing freehand Square and for stop only use mouse left click once",1,"border","p-2","draw-tool","p-flex",3,"disabled","ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-square"],["d","M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"],["title","Use mouse left click once then drag mouse for set radius then use mouse left click to stop",1,"border","p-2","draw-tool","p-flex",3,"disabled","ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-circle"],["d","M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"],["title","Use mouse left click to drop line vertices and for stop use mouse double click",1,"border","p-2","draw-tool","p-flex",3,"disabled","ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-dash-lg"],["fill-rule","evenodd","d","M2 8a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11A.5.5 0 0 1 2 8Z"],["title","Hold mouse left click and draw freehand line like pencil sketch",1,"border","p-2","draw-tool","p-flex",3,"disabled","ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pencil"],["d","M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708l-10 10a.5.5 0 0 1-.168.11l-5 2a.5.5 0 0 1-.65-.65l2-5a.5.5 0 0 1 .11-.168l10-10zM11.207 2.5 13.5 4.793 14.793 3.5 12.5 1.207 11.207 2.5zm1.586 3L10.5 3.207 4 9.707V10h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.293l6.5-6.5zm-9.761 5.175-.106.106-1.528 3.821 3.821-1.528.106-.106A.5.5 0 0 1 5 12.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.468-.325z"],["title","Press mouse left click and add marker on map",1,"border","p-2","draw-tool","p-flex",3,"disabled","ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-geo-alt"],["d","M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A31.493 31.493 0 0 1 8 14.58a31.481 31.481 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94zM8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10z"],["d","M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"],["title","Draw points",1,"border","p-2","draw-tool","p-flex",3,"disabled","ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-circle-fill"],["cx","8","cy","8","r","8"],["title","Press mouse left click to add text on map then use click to customize it",1,"border","p-2","draw-tool","p-flex",3,"disabled","ngClass","click"],[1,"draw-main","px-3","mb-3"],["title","Simple select mode",1,"border","p-2","draw-tool","p-flex",3,"disabled","ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-hand-index-thumb-fill"],["d","M8.5 1.75v2.716l.047-.002c.312-.012.742-.016 1.051.046.28.056.543.18.738.288.273.152.456.385.56.642l.132-.012c.312-.024.794-.038 1.158.108.37.148.689.487.88.716.075.09.141.175.195.248h.582a2 2 0 0 1 1.99 2.199l-.272 2.715a3.5 3.5 0 0 1-.444 1.389l-1.395 2.441A1.5 1.5 0 0 1 12.42 16H6.118a1.5 1.5 0 0 1-1.342-.83l-1.215-2.43L1.07 8.589a1.517 1.517 0 0 1 2.373-1.852L5 8.293V1.75a1.75 1.75 0 0 1 3.5 0z"],["title","Undo changes",1,"border","p-2","draw-tool","p-flex",3,"disabled","click"],["title","Redo changes",1,"border","p-2","draw-tool","p-flex",3,"disabled","click"],["title","Delete features",1,"border","p-2","draw-tool","p-flex",3,"disabled","ngClass","click"],["title","Click on feature to edit or drag it on map",1,"border","py-2","draw-tool","p-flex",3,"disabled","ngClass","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-pencil-square"],["d","M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"],["fill-rule","evenodd","d","M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"],["title","Rotate features on map holding mouse left click",1,"border","py-2","draw-tool","p-flex",3,"disabled","ngClass","click"],[1,"px-3","toggle-div"],["color","primary",1,"d-block",3,"change"],["mouseTip",""],[4,"ngIf"],[1,"d-flex","justify-content-center"],[1,"mt-3","btn","btn-sm","btn-danger","me-1",3,"click"],[1,"mt-3","btn","btn-sm","btn-secondary",3,"click"],[1,"mt-3","btn","btn-sm","btn-warning","me-1",3,"disabled","click"],[1,"mt-3","btn","btn-sm","btn-success","d-flex","align-items-center",3,"disabled","click"],["xmlns","http://www.w3.org/2000/svg","width","16","height","16","fill","currentColor","viewBox","0 0 16 16",1,"bi","bi-download"],["d","M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"],["d","M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"],[1,"ms-1"],[1,"alert","alert-danger","text-dark","mt-3","p-2","text-center","border","border-danger","shadow-sm",2,"font-size","15px","line-height","15px"]],template:function(l,d){1&l&&(b.TgZ(0,"div",0)(1,"button",1),b.NdJ("click",function(){return d.startDraw("freehand")}),b.O4$(),b.TgZ(2,"svg",2),b._UZ(3,"path",3),b.qZA()(),b.kcU(),b.TgZ(4,"button",4),b.NdJ("click",function(){return d.startDraw("polygon")}),b.O4$(),b.TgZ(5,"svg",5),b._UZ(6,"path",6),b.qZA()(),b.kcU(),b.TgZ(7,"button",7),b.NdJ("click",function(){return d.startDraw("square")}),b.O4$(),b.TgZ(8,"svg",8),b._UZ(9,"path",9),b.qZA()(),b.kcU(),b.TgZ(10,"button",10),b.NdJ("click",function(){return d.startDraw("circle")}),b.O4$(),b.TgZ(11,"svg",11),b._UZ(12,"path",12),b.qZA()(),b.kcU(),b.TgZ(13,"button",13),b.NdJ("click",function(){return d.startDraw("line")}),b.O4$(),b.TgZ(14,"svg",14),b._UZ(15,"path",15),b.qZA()(),b.kcU(),b.TgZ(16,"button",16),b.NdJ("click",function(){return d.startDraw("freehand-line")}),b.O4$(),b.TgZ(17,"svg",17),b._UZ(18,"path",18),b.qZA()(),b.kcU(),b.TgZ(19,"button",19),b.NdJ("click",function(){return d.startDraw("custom-marker")}),b.O4$(),b.TgZ(20,"svg",20),b._UZ(21,"path",21)(22,"path",22),b.qZA()(),b.kcU(),b.TgZ(23,"button",23),b.NdJ("click",function(){return d.startDraw("points")}),b.O4$(),b.TgZ(24,"svg",24),b._UZ(25,"circle",25),b.qZA()(),b.kcU(),b.TgZ(26,"button",26),b.NdJ("click",function(){return d.startDraw("add-text")}),b.TgZ(27,"mat-icon"),b._uU(28," text_fields"),b.qZA()()(),b._UZ(29,"br"),b.TgZ(30,"div",27)(31,"button",28),b.NdJ("click",function(){return d.startDraw("simple-select")}),b.O4$(),b.TgZ(32,"svg",29),b._UZ(33,"path",30),b.qZA()(),b.kcU(),b.TgZ(34,"button",31),b.NdJ("click",function(){return d.undo()}),b.TgZ(35,"mat-icon"),b._uU(36,"undo"),b.qZA()(),b.TgZ(37,"button",32),b.NdJ("click",function(){return d.redo()}),b.TgZ(38,"mat-icon"),b._uU(39,"redo"),b.qZA()(),b.TgZ(40,"button",33),b.NdJ("click",function(){return d.startDraw("delete-tool")}),b.TgZ(41,"mat-icon"),b._uU(42,"delete_sweep"),b.qZA()(),b.TgZ(43,"button",34),b.NdJ("click",function(){return d.editModeHandler()}),b.O4$(),b.TgZ(44,"svg",35),b._UZ(45,"path",36)(46,"path",37),b.qZA()(),b.kcU(),b.TgZ(47,"button",38),b.NdJ("click",function(){return d.rotateModeHandler()}),b.TgZ(48,"mat-icon"),b._uU(49,"rotate_left"),b.qZA()()(),b.TgZ(50,"div",39)(51,"mat-slide-toggle",40),b.NdJ("change",function(w){return d.getDrawContinousStatus(w)}),b._uU(52,"Draw Continuously "),b.qZA(),b.TgZ(53,"mat-slide-toggle",40,41),b.NdJ("change",function(w){return d.getShowTipOnMouseStatus(w)}),b._uU(55,"Show Tip On Cursor"),b.qZA(),b.TgZ(56,"mat-slide-toggle",40,41),b.NdJ("change",function(w){return d.getShowMapProjectionStatus(w)}),b._uU(58,"Mercator"),b.qZA(),b.TgZ(59,"mat-slide-toggle",40,41),b.NdJ("change",function(w){return d.sendShowGeocoderStatus(w)}),b._uU(61,"Advance Search"),b.qZA()(),b.YNc(62,$_,3,0,"div",42),b.YNc(63,Y_,3,0,"div",42),b.TgZ(64,"div",43)(65,"button",44),b.NdJ("click",function(){return d.resetData()}),b._uU(66,"Reset"),b.qZA(),b.TgZ(67,"button",45),b.NdJ("click",function(){return d.showDataTable()}),b._uU(68,"Show Table"),b.qZA()(),b.TgZ(69,"div",43)(70,"button",46),b.NdJ("click",function(){return d.showUploadDialog()}),b._uU(71,"Upload"),b.qZA(),b.TgZ(72,"button",47),b.NdJ("click",function(){return d.downloadData()}),b.O4$(),b.TgZ(73,"svg",48),b._UZ(74,"path",49)(75,"path",50),b.qZA(),b.kcU(),b.TgZ(76,"span",51),b._uU(77,"Download"),b.qZA()()()),2&l&&(b.xp6(1),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive)("ngClass","freehand"==d.activeTool?"active-tool":""),b.xp6(3),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive)("ngClass","polygon"==d.activeTool?"active-tool":""),b.xp6(3),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive)("ngClass","square"==d.activeTool?"active-tool":""),b.xp6(3),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive)("ngClass","circle"==d.activeTool?"active-tool":""),b.xp6(3),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive)("ngClass","line"==d.activeTool?"active-tool":""),b.xp6(3),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive)("ngClass","freehand-line"==d.activeTool?"active-tool":""),b.xp6(3),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive)("ngClass","custom-marker"==d.activeTool?"active-tool":""),b.xp6(4),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive)("ngClass","points"==d.activeTool?"active-tool":""),b.xp6(3),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive)("ngClass","add-text"==d.activeTool?"active-tool":""),b.xp6(5),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive)("ngClass","simple-select"==d.activeTool?"active-tool":""),b.xp6(3),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive),b.xp6(3),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive),b.xp6(3),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive)("ngClass","delete-tool"==d.activeTool?"active-tool":""),b.xp6(3),b.Q6J("disabled",d.isRotateModeActive||0==d.geo_json_main.features.length)("ngClass","edit-mode"!=d.activeTool||d.isRotateModeActive?"":"active-tool"),b.xp6(4),b.Q6J("disabled",d.layerEditMode&&!d.isRotateModeActive||0==d.geo_json_main.features.length)("ngClass",d.isRotateModeActive?"active-tool":""),b.xp6(15),b.Q6J("ngIf","custom-marker"==d.activeTool||"add-text"==d.activeTool),b.xp6(1),b.Q6J("ngIf",d.isRotateModeActive),b.xp6(7),b.Q6J("disabled",d.layerEditMode||d.isRotateModeActive),b.xp6(2),b.Q6J("disabled",0==d.geo_json_main.features.length||d.layerEditMode||d.isRotateModeActive))},dependencies:[ae.mk,ae.O5,ee.Hw,ie.Rr],styles:[".draw-tool[_ngcontent-%COMP%]{cursor:pointer}.active-tool[_ngcontent-%COMP%]{background:#0DCAF0!important;color:#fff}.draw-main[_ngcontent-%COMP%]{display:grid;grid-template-columns:auto auto auto;text-align:center;column-gap:10px;row-gap:10px}.draw-main[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{background:#FFFFFF;height:50px}"]}),o})(),H_=(()=>{class o{constructor(){this.sendIdentityFeatureData=new b.vpe,this.getShowGeocoderStatus=new b.vpe}ngOnInit(){}sendIdentityFeatureDataFn(l){this.sendIdentityFeatureData.emit(l)}sendShowGeocoderStatus(l){this.getShowGeocoderStatus.emit(l)}}return o.\u0275fac=function(l){return new(l||o)},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-create-data"]],inputs:{map:"map",draw:"draw"},outputs:{sendIdentityFeatureData:"sendIdentityFeatureData",getShowGeocoderStatus:"getShowGeocoderStatus"},decls:1,vars:2,consts:[[3,"map","draw","sendIdentityFeatureData","getShowGeocoderStatus"]],template:function(l,d){1&l&&(b.TgZ(0,"app-draw-common",0),b.NdJ("sendIdentityFeatureData",function(w){return d.sendIdentityFeatureDataFn(w)})("getShowGeocoderStatus",function(w){return d.sendShowGeocoderStatus(w)}),b.qZA()),2&l&&b.Q6J("map",d.map)("draw",d.draw)},dependencies:[W_]}),o})();const J_=[{path:"",component:(()=>{class o{constructor(l,d){this.dataShareService=l,this.downloadDataService=d,this.showGeocoder=!1,this.temp_geo_json_main={type:"FeatureCollection",features:[]}}showMessage(l){0!==this.temp_geo_json_main.features.length&&(l.returnValue="Your data will be lost!")}set content(l){l&&(this.mapCommonComponent=l)}ngOnInit(){this.dataShareService.getSourceData.subscribe(l=>{this.temp_geo_json_main=l}),this.downloadDataService.downloadDone.subscribe(l=>{this.temp_geo_json_main={type:"FeatureCollection",features:[]}})}getMapData(l){this.map=l.map,this.draw=l.draw}sendIdentityFeatureDataFn(l){this.mapCommonComponent.sendIdentityFeatureData(l)}getShowGeocoderStatus(l){this.showGeocoder=l}}return o.\u0275fac=function(l){return new(l||o)(b.Y36(Oe),b.Y36(Ay))},o.\u0275cmp=b.Xpm({type:o,selectors:[["app-home"]],viewQuery:function(l,d){if(1&l&&b.Gf(d_,5),2&l){let v;b.iGM(v=b.CRH())&&(d.content=v.first)}},hostBindings:function(l,d){1&l&&b.NdJ("beforeunload",function(w){return d.showMessage(w)},!1,b.Jf7)},decls:7,vars:5,consts:[[1,"main-div"],[1,"map-wrapper"],[3,"showGeocoder","mapDataEmit"],[1,"border-end","border-dark","side-nav-wrapper"],[3,"map","draw","sendIdentityFeatureData","getShowGeocoderStatus"],[3,"map","draw"]],template:function(l,d){1&l&&(b.TgZ(0,"div",0)(1,"div",1)(2,"app-map-common",2),b.NdJ("mapDataEmit",function(w){return d.getMapData(w)}),b.qZA()(),b.TgZ(3,"div",3),b._UZ(4,"app-header"),b.TgZ(5,"app-create-data",4),b.NdJ("sendIdentityFeatureData",function(w){return d.sendIdentityFeatureDataFn(w)})("getShowGeocoderStatus",function(w){return d.getShowGeocoderStatus(w)}),b.qZA(),b._UZ(6,"app-map-styles",5),b.qZA()()),2&l&&(b.xp6(2),b.Q6J("showGeocoder",d.showGeocoder),b.xp6(3),b.Q6J("map",d.map)("draw",d.draw),b.xp6(1),b.Q6J("map",d.map)("draw",d.draw))},dependencies:[d_,q_,V_,H_],styles:[".main-div[_ngcontent-%COMP%]{width:100%;height:100vh;display:flex;flex-direction:row-reverse}.map-wrapper[_ngcontent-%COMP%]{height:100vh;width:100%}.side-nav-wrapper[_ngcontent-%COMP%]{position:relative;width:300px;overflow:hidden;background-color:#e2f2f0}"]}),o})()}];let K_=(()=>{class o{}return o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=b.oAB({type:o}),o.\u0275inj=b.cJS({imports:[pe.Bz.forChild(J_),pe.Bz]}),o})();const Q_=[];let e0=(()=>{class o{}return o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=b.oAB({type:o}),o.\u0275inj=b.cJS({imports:[pe.Bz.forChild(Q_),pe.Bz]}),o})();var Ly=ue(8147);const t0=[];let r0=(()=>{class o{}return o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=b.oAB({type:o}),o.\u0275inj=b.cJS({imports:[pe.Bz.forChild(t0),pe.Bz]}),o})(),g_=(()=>{class o{}return o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=b.oAB({type:o}),o.\u0275inj=b.cJS({imports:[ae.ez,r0,Ly.i,c.UX,c.u5,We.e4]}),o})(),n0=(()=>{class o{}return o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=b.oAB({type:o}),o.\u0275inj=b.cJS({imports:[ae.ez,e0,Ly.i,c.u5,g_]}),o})(),i0=(()=>{class o{}return o.\u0275fac=function(l){return new(l||o)},o.\u0275mod=b.oAB({type:o}),o.\u0275inj=b.cJS({imports:[ae.ez,K_,n0,Ly.i,g_]}),o})()},1503:(Mt,Ye,ue)=>{"use strict";var pe=ue(9626);function b(c){var Z=[1/0,1/0,-1/0,-1/0];return pe.coordEach(c,function(ce){Z[0]>ce[0]&&(Z[0]=ce[0]),Z[1]>ce[1]&&(Z[1]=ce[1]),Z[2]<ce[0]&&(Z[2]=ce[0]),Z[3]<ce[1]&&(Z[3]=ce[1])}),Z}b.default=b,Ye.Z=b},5427:(Mt,Ye,ue)=>{"use strict";var pe=ue(9626),b=ue(8275);Ye.Z=function c(Z,ce){void 0===ce&&(ce={});var be=0,ye=0,Te=0;return pe.coordEach(Z,function($e){be+=$e[0],ye+=$e[1],Te++},!0),b.point([be/Te,ye/Te],ce.properties)}},9814:(Mt,Ye,ue)=>{"use strict";var pe=ue(8275),b=ue(8418);Ye.Z=function c(Z,ce,be,ye){void 0===ye&&(ye={});var Te=b.getCoord(Z),$e=pe.degreesToRadians(Te[0]),xe=pe.degreesToRadians(Te[1]),ge=pe.degreesToRadians(be),Oe=pe.lengthToRadians(ce,ye.units),We=Math.asin(Math.sin(xe)*Math.cos(Oe)+Math.cos(xe)*Math.sin(Oe)*Math.cos(ge)),H=$e+Math.atan2(Math.sin(ge)*Math.sin(Oe)*Math.cos(xe),Math.cos(Oe)-Math.sin(xe)*Math.sin(We)),q=pe.radiansToDegrees(H),K=pe.radiansToDegrees(We);return pe.point([q,K],ye.properties)}},2777:(Mt,Ye,ue)=>{"use strict";var pe=ue(8418),b=ue(8275);Ye.Z=function c(Z,ce,be){void 0===be&&(be={});var ye=pe.getCoord(Z),Te=pe.getCoord(ce),$e=b.degreesToRadians(Te[1]-ye[1]),xe=b.degreesToRadians(Te[0]-ye[0]),ge=b.degreesToRadians(ye[1]),Oe=b.degreesToRadians(Te[1]),We=Math.pow(Math.sin($e/2),2)+Math.pow(Math.sin(xe/2),2)*Math.cos(ge)*Math.cos(Oe);return b.radiansToLength(2*Math.atan2(Math.sqrt(We),Math.sqrt(1-We)),be.units)}},8275:(Mt,Ye)=>{"use strict";function ue(ze,Ze,Ee){void 0===Ee&&(Ee={});var Jt={type:"Feature"};return(0===Ee.id||Ee.id)&&(Jt.id=Ee.id),Ee.bbox&&(Jt.bbox=Ee.bbox),Jt.properties=Ze||{},Jt.geometry=ze,Jt}function pe(ze,Ze,Ee){if(void 0===Ee&&(Ee={}),!ze)throw new Error("coordinates is required");if(!Array.isArray(ze))throw new Error("coordinates must be an Array");if(ze.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!se(ze[0])||!se(ze[1]))throw new Error("coordinates must contain numbers");return ue({type:"Point",coordinates:ze},Ze,Ee)}function c(ze,Ze,Ee){void 0===Ee&&(Ee={});for(var Jt=0,Nt=ze;Jt<Nt.length;Jt++){var ke=Nt[Jt];if(ke.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var xt=0;xt<ke[ke.length-1].length;xt++)if(ke[ke.length-1][xt]!==ke[0][xt])throw new Error("First and last Position are not equivalent.")}return ue({type:"Polygon",coordinates:ze},Ze,Ee)}function ce(ze,Ze,Ee){if(void 0===Ee&&(Ee={}),ze.length<2)throw new Error("coordinates must be an array of two or more positions");return ue({type:"LineString",coordinates:ze},Ze,Ee)}function ye(ze,Ze){void 0===Ze&&(Ze={});var Ee={type:"FeatureCollection"};return Ze.id&&(Ee.id=Ze.id),Ze.bbox&&(Ee.bbox=Ze.bbox),Ee.features=ze,Ee}function Te(ze,Ze,Ee){return void 0===Ee&&(Ee={}),ue({type:"MultiLineString",coordinates:ze},Ze,Ee)}function $e(ze,Ze,Ee){return void 0===Ee&&(Ee={}),ue({type:"MultiPoint",coordinates:ze},Ze,Ee)}function xe(ze,Ze,Ee){return void 0===Ee&&(Ee={}),ue({type:"MultiPolygon",coordinates:ze},Ze,Ee)}function We(ze,Ze){void 0===Ze&&(Ze="kilometers");var Ee=Ye.factors[Ze];if(!Ee)throw new Error(Ze+" units is invalid");return ze*Ee}function H(ze,Ze){void 0===Ze&&(Ze="kilometers");var Ee=Ye.factors[Ze];if(!Ee)throw new Error(Ze+" units is invalid");return ze/Ee}function X(ze){return ze%(2*Math.PI)*180/Math.PI}function se(ze){return!isNaN(ze)&&null!==ze&&!Array.isArray(ze)}Object.defineProperty(Ye,"__esModule",{value:!0}),Ye.earthRadius=6371008.8,Ye.factors={centimeters:100*Ye.earthRadius,centimetres:100*Ye.earthRadius,degrees:Ye.earthRadius/111325,feet:3.28084*Ye.earthRadius,inches:39.37*Ye.earthRadius,kilometers:Ye.earthRadius/1e3,kilometres:Ye.earthRadius/1e3,meters:Ye.earthRadius,metres:Ye.earthRadius,miles:Ye.earthRadius/1609.344,millimeters:1e3*Ye.earthRadius,millimetres:1e3*Ye.earthRadius,nauticalmiles:Ye.earthRadius/1852,radians:1,yards:1.0936*Ye.earthRadius},Ye.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Ye.earthRadius,yards:1.0936133},Ye.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},Ye.feature=ue,Ye.geometry=function ae(ze,Ze,Ee){switch(void 0===Ee&&(Ee={}),ze){case"Point":return pe(Ze).geometry;case"LineString":return ce(Ze).geometry;case"Polygon":return c(Ze).geometry;case"MultiPoint":return $e(Ze).geometry;case"MultiLineString":return Te(Ze).geometry;case"MultiPolygon":return xe(Ze).geometry;default:throw new Error(ze+" is invalid")}},Ye.point=pe,Ye.points=function b(ze,Ze,Ee){return void 0===Ee&&(Ee={}),ye(ze.map(function(Jt){return pe(Jt,Ze)}),Ee)},Ye.polygon=c,Ye.polygons=function Z(ze,Ze,Ee){return void 0===Ee&&(Ee={}),ye(ze.map(function(Jt){return c(Jt,Ze)}),Ee)},Ye.lineString=ce,Ye.lineStrings=function be(ze,Ze,Ee){return void 0===Ee&&(Ee={}),ye(ze.map(function(Jt){return ce(Jt,Ze)}),Ee)},Ye.featureCollection=ye,Ye.multiLineString=Te,Ye.multiPoint=$e,Ye.multiPolygon=xe,Ye.geometryCollection=function ge(ze,Ze,Ee){return void 0===Ee&&(Ee={}),ue({type:"GeometryCollection",geometries:ze},Ze,Ee)},Ye.round=function Oe(ze,Ze){if(void 0===Ze&&(Ze=0),Ze&&!(Ze>=0))throw new Error("precision must be a positive number");var Ee=Math.pow(10,Ze||0);return Math.round(ze*Ee)/Ee},Ye.radiansToLength=We,Ye.lengthToRadians=H,Ye.lengthToDegrees=function q(ze,Ze){return X(H(ze,Ze))},Ye.bearingToAzimuth=function K(ze){var Ze=ze%360;return Ze<0&&(Ze+=360),Ze},Ye.radiansToDegrees=X,Ye.degreesToRadians=function ee(ze){return ze%360*Math.PI/180},Ye.convertLength=function ie(ze,Ze,Ee){if(void 0===Ze&&(Ze="kilometers"),void 0===Ee&&(Ee="kilometers"),!(ze>=0))throw new Error("length must be a positive number");return We(H(ze,Ze),Ee)},Ye.convertArea=function ne(ze,Ze,Ee){if(void 0===Ze&&(Ze="meters"),void 0===Ee&&(Ee="kilometers"),!(ze>=0))throw new Error("area must be a positive number");var Jt=Ye.areaFactors[Ze];if(!Jt)throw new Error("invalid original units");var Nt=Ye.areaFactors[Ee];if(!Nt)throw new Error("invalid final units");return ze/Jt*Nt},Ye.isNumber=se,Ye.isObject=function he(ze){return!!ze&&ze.constructor===Object},Ye.validateBBox=function re(ze){if(!ze)throw new Error("bbox is required");if(!Array.isArray(ze))throw new Error("bbox must be an Array");if(4!==ze.length&&6!==ze.length)throw new Error("bbox must be an Array of 4 or 6 numbers");ze.forEach(function(Ze){if(!se(Ze))throw new Error("bbox must only contain numbers")})},Ye.validateId=function nt(ze){if(!ze)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof ze))throw new Error("id must be a number or a string")}},8418:(Mt,Ye,ue)=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});var ae=ue(8275);Ye.getCoord=function pe($e){if(!$e)throw new Error("coord is required");if(!Array.isArray($e)){if("Feature"===$e.type&&null!==$e.geometry&&"Point"===$e.geometry.type)return $e.geometry.coordinates;if("Point"===$e.type)return $e.coordinates}if(Array.isArray($e)&&$e.length>=2&&!Array.isArray($e[0])&&!Array.isArray($e[1]))return $e;throw new Error("coord must be GeoJSON Point or an Array of numbers")},Ye.getCoords=function b($e){if(Array.isArray($e))return $e;if("Feature"===$e.type){if(null!==$e.geometry)return $e.geometry.coordinates}else if($e.coordinates)return $e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")},Ye.containsNumber=function c($e){if($e.length>1&&ae.isNumber($e[0])&&ae.isNumber($e[1]))return!0;if(Array.isArray($e[0])&&$e[0].length)return c($e[0]);throw new Error("coordinates must only contain numbers")},Ye.geojsonType=function Z($e,xe,ge){if(!xe||!ge)throw new Error("type and name required");if(!$e||$e.type!==xe)throw new Error("Invalid input to "+ge+": must be a "+xe+", given "+$e.type)},Ye.featureOf=function ce($e,xe,ge){if(!$e)throw new Error("No feature passed");if(!ge)throw new Error(".featureOf() requires a name");if(!$e||"Feature"!==$e.type||!$e.geometry)throw new Error("Invalid input to "+ge+", Feature with geometry required");if(!$e.geometry||$e.geometry.type!==xe)throw new Error("Invalid input to "+ge+": must be a "+xe+", given "+$e.geometry.type)},Ye.collectionOf=function be($e,xe,ge){if(!$e)throw new Error("No featureCollection passed");if(!ge)throw new Error(".collectionOf() requires a name");if(!$e||"FeatureCollection"!==$e.type)throw new Error("Invalid input to "+ge+", FeatureCollection required");for(var Oe=0,We=$e.features;Oe<We.length;Oe++){var H=We[Oe];if(!H||"Feature"!==H.type||!H.geometry)throw new Error("Invalid input to "+ge+", Feature with geometry required");if(!H.geometry||H.geometry.type!==xe)throw new Error("Invalid input to "+ge+": must be a "+xe+", given "+H.geometry.type)}},Ye.getGeom=function ye($e){return"Feature"===$e.type?$e.geometry:$e},Ye.getType=function Te($e,xe){return"FeatureCollection"===$e.type?"FeatureCollection":"GeometryCollection"===$e.type?"GeometryCollection":"Feature"===$e.type&&null!==$e.geometry?$e.geometry.type:$e.type}},9626:(Mt,Ye,ue)=>{"use strict";Object.defineProperty(Ye,"__esModule",{value:!0});var ae=ue(8275);function pe(ee,ie,ne){if(null!==ee)for(var se,he,re,nt,ze,Ze,Ee,ke,Jt=0,Nt=0,xt=ee.type,Ae="FeatureCollection"===xt,pt="Feature"===xt,bt=Ae?ee.features.length:1,Ue=0;Ue<bt;Ue++){ze=(ke=!!(Ee=Ae?ee.features[Ue].geometry:pt?ee.geometry:ee)&&"GeometryCollection"===Ee.type)?Ee.geometries.length:1;for(var Wt=0;Wt<ze;Wt++){var Vt=0,Cr=0;if(null!==(nt=ke?Ee.geometries[Wt]:Ee)){Ze=nt.coordinates;var Ft=nt.type;switch(Jt=!ne||"Polygon"!==Ft&&"MultiPolygon"!==Ft?0:1,Ft){case null:break;case"Point":if(!1===ie(Ze,Nt,Ue,Vt,Cr))return!1;Nt++,Vt++;break;case"LineString":case"MultiPoint":for(se=0;se<Ze.length;se++){if(!1===ie(Ze[se],Nt,Ue,Vt,Cr))return!1;Nt++,"MultiPoint"===Ft&&Vt++}"LineString"===Ft&&Vt++;break;case"Polygon":case"MultiLineString":for(se=0;se<Ze.length;se++){for(he=0;he<Ze[se].length-Jt;he++){if(!1===ie(Ze[se][he],Nt,Ue,Vt,Cr))return!1;Nt++}"MultiLineString"===Ft&&Vt++,"Polygon"===Ft&&Cr++}"Polygon"===Ft&&Vt++;break;case"MultiPolygon":for(se=0;se<Ze.length;se++){for(Cr=0,he=0;he<Ze[se].length;he++){for(re=0;re<Ze[se][he].length-Jt;re++){if(!1===ie(Ze[se][he][re],Nt,Ue,Vt,Cr))return!1;Nt++}Cr++}Vt++}break;case"GeometryCollection":for(se=0;se<nt.geometries.length;se++)if(!1===pe(nt.geometries[se],ie,ne))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function c(ee,ie){var ne;switch(ee.type){case"FeatureCollection":for(ne=0;ne<ee.features.length&&!1!==ie(ee.features[ne].properties,ne);ne++);break;case"Feature":ie(ee.properties,0)}}function ce(ee,ie){if("Feature"===ee.type)ie(ee,0);else if("FeatureCollection"===ee.type)for(var ne=0;ne<ee.features.length&&!1!==ie(ee.features[ne],ne);ne++);}function Te(ee,ie){var ne,se,he,re,nt,ze,Ze,Ee,Jt,Nt,ke=0,xt="FeatureCollection"===ee.type,Ae="Feature"===ee.type,pt=xt?ee.features.length:1;for(ne=0;ne<pt;ne++){for(Ee=xt?ee.features[ne].properties:Ae?ee.properties:{},Jt=xt?ee.features[ne].bbox:Ae?ee.bbox:void 0,Nt=xt?ee.features[ne].id:Ae?ee.id:void 0,nt=(Ze=!!(ze=xt?ee.features[ne].geometry:Ae?ee.geometry:ee)&&"GeometryCollection"===ze.type)?ze.geometries.length:1,he=0;he<nt;he++)if(null!==(re=Ze?ze.geometries[he]:ze))switch(re.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===ie(re,ke,Ee,Jt,Nt))return!1;break;case"GeometryCollection":for(se=0;se<re.geometries.length;se++)if(!1===ie(re.geometries[se],ke,Ee,Jt,Nt))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===ie(null,ke,Ee,Jt,Nt))return!1;ke++}}function xe(ee,ie){Te(ee,function(ne,se,he,re,nt){var Ze,ze=null===ne?null:ne.type;switch(ze){case null:case"Point":case"LineString":case"Polygon":return!1!==ie(ae.feature(ne,he,{bbox:re,id:nt}),se,0)&&void 0}switch(ze){case"MultiPoint":Ze="Point";break;case"MultiLineString":Ze="LineString";break;case"MultiPolygon":Ze="Polygon"}for(var Ee=0;Ee<ne.coordinates.length;Ee++)if(!1===ie(ae.feature({type:Ze,coordinates:ne.coordinates[Ee]},he),se,Ee))return!1})}function Oe(ee,ie){xe(ee,function(ne,se,he){var re=0;if(ne.geometry){var nt=ne.geometry.type;if("Point"!==nt&&"MultiPoint"!==nt){var ze,Ze=0,Ee=0,Jt=0;if(!1===pe(ne,function(Nt,ke,xt,Ae,pt){if(void 0===ze||se>Ze||Ae>Ee||pt>Jt)return ze=Nt,Ze=se,Ee=Ae,Jt=pt,void(re=0);var bt=ae.lineString([ze,Nt],ne.properties);if(!1===ie(bt,se,he,pt,re))return!1;re++,ze=Nt}))return!1}}})}function H(ee,ie){if(!ee)throw new Error("geojson is required");xe(ee,function(ne,se,he){if(null!==ne.geometry){var nt=ne.geometry.coordinates;switch(ne.geometry.type){case"LineString":if(!1===ie(ne,se,he,0,0))return!1;break;case"Polygon":for(var ze=0;ze<nt.length;ze++)if(!1===ie(ae.lineString(nt[ze],ne.properties),se,he,ze))return!1}}})}Ye.coordAll=function ye(ee){var ie=[];return pe(ee,function(ne){ie.push(ne)}),ie},Ye.coordEach=pe,Ye.coordReduce=function b(ee,ie,ne,se){var he=ne;return pe(ee,function(re,nt,ze,Ze,Ee){he=0===nt&&void 0===ne?re:ie(he,re,nt,ze,Ze,Ee)},se),he},Ye.featureEach=ce,Ye.featureReduce=function be(ee,ie,ne){var se=ne;return ce(ee,function(he,re){se=0===re&&void 0===ne?he:ie(se,he,re)}),se},Ye.findPoint=function X(ee,ie){if(!ae.isObject(ie=ie||{}))throw new Error("options is invalid");var ze,ne=ie.featureIndex||0,se=ie.multiFeatureIndex||0,he=ie.geometryIndex||0,re=ie.coordIndex||0,nt=ie.properties;switch(ee.type){case"FeatureCollection":ne<0&&(ne=ee.features.length+ne),nt=nt||ee.features[ne].properties,ze=ee.features[ne].geometry;break;case"Feature":nt=nt||ee.properties,ze=ee.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":ze=ee;break;default:throw new Error("geojson is invalid")}if(null===ze)return null;var Ze=ze.coordinates;switch(ze.type){case"Point":return ae.point(Ze,nt,ie);case"MultiPoint":return se<0&&(se=Ze.length+se),ae.point(Ze[se],nt,ie);case"LineString":return re<0&&(re=Ze.length+re),ae.point(Ze[re],nt,ie);case"Polygon":return he<0&&(he=Ze.length+he),re<0&&(re=Ze[he].length+re),ae.point(Ze[he][re],nt,ie);case"MultiLineString":return se<0&&(se=Ze.length+se),re<0&&(re=Ze[se].length+re),ae.point(Ze[se][re],nt,ie);case"MultiPolygon":return se<0&&(se=Ze.length+se),he<0&&(he=Ze[se].length+he),re<0&&(re=Ze[se][he].length-re),ae.point(Ze[se][he][re],nt,ie)}throw new Error("geojson is invalid")},Ye.findSegment=function K(ee,ie){if(!ae.isObject(ie=ie||{}))throw new Error("options is invalid");var ze,ne=ie.featureIndex||0,se=ie.multiFeatureIndex||0,he=ie.geometryIndex||0,re=ie.segmentIndex||0,nt=ie.properties;switch(ee.type){case"FeatureCollection":ne<0&&(ne=ee.features.length+ne),nt=nt||ee.features[ne].properties,ze=ee.features[ne].geometry;break;case"Feature":nt=nt||ee.properties,ze=ee.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":ze=ee;break;default:throw new Error("geojson is invalid")}if(null===ze)return null;var Ze=ze.coordinates;switch(ze.type){case"Point":case"MultiPoint":return null;case"LineString":return re<0&&(re=Ze.length+re-1),ae.lineString([Ze[re],Ze[re+1]],nt,ie);case"Polygon":return he<0&&(he=Ze.length+he),re<0&&(re=Ze[he].length+re-1),ae.lineString([Ze[he][re],Ze[he][re+1]],nt,ie);case"MultiLineString":return se<0&&(se=Ze.length+se),re<0&&(re=Ze[se].length+re-1),ae.lineString([Ze[se][re],Ze[se][re+1]],nt,ie);case"MultiPolygon":return se<0&&(se=Ze.length+se),he<0&&(he=Ze[se].length+he),re<0&&(re=Ze[se][he].length-re-1),ae.lineString([Ze[se][he][re],Ze[se][he][re+1]],nt,ie)}throw new Error("geojson is invalid")},Ye.flattenEach=xe,Ye.flattenReduce=function ge(ee,ie,ne){var se=ne;return xe(ee,function(he,re,nt){se=0===re&&0===nt&&void 0===ne?he:ie(se,he,re,nt)}),se},Ye.geomEach=Te,Ye.geomReduce=function $e(ee,ie,ne){var se=ne;return Te(ee,function(he,re,nt,ze,Ze){se=0===re&&void 0===ne?he:ie(se,he,re,nt,ze,Ze)}),se},Ye.lineEach=H,Ye.lineReduce=function q(ee,ie,ne){var se=ne;return H(ee,function(he,re,nt,ze){se=0===re&&void 0===ne?he:ie(se,he,re,nt,ze)}),se},Ye.propEach=c,Ye.propReduce=function Z(ee,ie,ne){var se=ne;return c(ee,function(he,re){se=0===re&&void 0===ne?he:ie(se,he,re)}),se},Ye.segmentEach=Oe,Ye.segmentReduce=function We(ee,ie,ne){var se=ne,he=!1;return Oe(ee,function(re,nt,ze,Ze,Ee){se=!1===he&&void 0===ne?re:ie(se,re,nt,ze,Ze,Ee),he=!0}),se}},2049:function(Mt,Ye,ue){var ae;Mt=ue.nmd(Mt),function(pe){"object"==typeof global&&global;var ce=function(We){this.message=We};(ce.prototype=new Error).name="InvalidCharacterError";var be=function(We){throw new ce(We)},ye="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Te=/[\t\n\f\r ]/g,ge={encode:function(We){We=String(We),/[^\0-\xFF]/.test(We)&&be("The string to be encoded contains characters outside of the Latin1 range.");for(var X,ee,ie,se,H=We.length%3,q="",K=-1,he=We.length-H;++K<he;)X=We.charCodeAt(K)<<16,ee=We.charCodeAt(++K)<<8,ie=We.charCodeAt(++K),q+=ye.charAt((se=X+ee+ie)>>18&63)+ye.charAt(se>>12&63)+ye.charAt(se>>6&63)+ye.charAt(63&se);return 2==H?(X=We.charCodeAt(K)<<8,ee=We.charCodeAt(++K),q+=ye.charAt((se=X+ee)>>10)+ye.charAt(se>>4&63)+ye.charAt(se<<2&63)+"="):1==H&&(se=We.charCodeAt(K),q+=ye.charAt(se>>2)+ye.charAt(se<<4&63)+"=="),q},decode:function(We){var H=(We=String(We).replace(Te,"")).length;H%4==0&&(H=(We=We.replace(/==?$/,"")).length),(H%4==1||/[^+a-zA-Z0-9/]/.test(We))&&be("Invalid character: the string to be decoded is not correctly encoded.");for(var K,X,q=0,ee="",ie=-1;++ie<H;)X=ye.indexOf(We.charAt(ie)),K=q%4?64*K+X:X,q++%4&&(ee+=String.fromCharCode(255&K>>(-2*q&6)));return ee},version:"0.1.0"};void 0!==(ae=function(){return ge}.call(Ye,ue,Ye,Mt))&&(Mt.exports=ae)}()},5834:(Mt,Ye,ue)=>{"use strict";var ae=ue(5203),pe=ue(5685),b=pe(ae("String.prototype.indexOf"));Mt.exports=function(Z,ce){var be=ae(Z,!!ce);return"function"==typeof be&&b(Z,".prototype.")>-1?pe(be):be}},5685:(Mt,Ye,ue)=>{"use strict";var ae=ue(4444),pe=ue(5203),b=pe("%Function.prototype.apply%"),c=pe("%Function.prototype.call%"),Z=pe("%Reflect.apply%",!0)||ae.call(c,b),ce=pe("%Object.getOwnPropertyDescriptor%",!0),be=pe("%Object.defineProperty%",!0),ye=pe("%Math.max%");if(be)try{be({},"a",{value:1})}catch{be=null}Mt.exports=function(xe){var ge=Z(ae,c,arguments);if(ce&&be){var Oe=ce(ge,"length");Oe.configurable&&be(ge,"length",{value:1+ye(0,xe.length-(arguments.length-1))})}return ge};var Te=function(){return Z(ae,b,arguments)};be?be(Mt.exports,"apply",{value:Te}):Mt.exports.apply=Te},1335:(Mt,Ye,ue)=>{"use strict";var ae=ue(3156),pe=ue(7253),b=ue(3870),c=ue(7563).orient2d;function Z(ne,se,he){se=Math.max(0,void 0===se?2:se),he=he||0;var re=function We(ne){for(var se=ne[0],he=ne[0],re=ne[0],nt=ne[0],ze=0;ze<ne.length;ze++){var Ze=ne[ze];Ze[0]<se[0]&&(se=Ze),Ze[0]>re[0]&&(re=Ze),Ze[1]<he[1]&&(he=Ze),Ze[1]>nt[1]&&(nt=Ze)}var Ee=[se,he,re,nt],Jt=Ee.slice();for(ze=0;ze<ne.length;ze++)b(ne[ze],Ee)||Jt.push(ne[ze]);return function ie(ne){ne.sort(ee);for(var se=[],he=0;he<ne.length;he++){for(;se.length>=2&&xe(se[se.length-2],se[se.length-1],ne[he])<=0;)se.pop();se.push(ne[he])}for(var re=[],nt=ne.length-1;nt>=0;nt--){for(;re.length>=2&&xe(re[re.length-2],re[re.length-1],ne[nt])<=0;)re.pop();re.push(ne[nt])}return re.pop(),se.pop(),se.concat(re)}(Jt)}(ne),nt=new ae(16);nt.toBBox=function(Cr){return{minX:Cr[0],minY:Cr[1],maxX:Cr[0],maxY:Cr[1]}},nt.compareMinX=function(Cr,Ft){return Cr[0]-Ft[0]},nt.compareMinY=function(Cr,Ft){return Cr[1]-Ft[1]},nt.load(ne);for(var Ee,ze=[],Ze=0;Ze<re.length;Ze++){var Jt=re[Ze];nt.remove(Jt),Ee=H(Jt,Ee),ze.push(Ee)}var Nt=new ae(16);for(Ze=0;Ze<ze.length;Ze++)Nt.insert(Oe(ze[Ze]));for(var ke=se*se,xt=he*he;ze.length;){var Ae=ze.shift(),pt=Ae.p,bt=Ae.next.p,Ue=q(pt,bt);if(!(Ue<xt)){var Wt=Ue/ke;(Jt=ce(nt,Ae.prev.p,pt,bt,Ae.next.next.p,Wt,Nt))&&Math.min(q(Jt,pt),q(Jt,bt))<=Wt&&(ze.push(Ae),ze.push(H(Jt,Ae)),nt.remove(Jt),Nt.remove(Ae),Nt.insert(Oe(Ae)),Nt.insert(Oe(Ae.next)))}}Ae=Ee;var Vt=[];do{Vt.push(Ae.p),Ae=Ae.next}while(Ae!==Ee);return Vt.push(Ae.p),Vt}function ce(ne,se,he,re,nt,ze,Ze){for(var Ee=new pe([],be),Jt=ne.data;Jt;){for(var Nt=0;Nt<Jt.children.length;Nt++){var ke=Jt.children[Nt],xt=Jt.leaf?K(ke,he,re):ye(he,re,ke);xt>ze||Ee.push({node:ke,dist:xt})}for(;Ee.length&&!Ee.peek().node.children;){var Ae=Ee.pop(),pt=Ae.node,bt=K(pt,se,he),Ue=K(pt,re,nt);if(Ae.dist<bt&&Ae.dist<Ue&&$e(he,pt,Ze)&&$e(re,pt,Ze))return pt}(Jt=Ee.pop())&&(Jt=Jt.node)}return null}function be(ne,se){return ne.dist-se.dist}function ye(ne,se,he){if(Te(ne,he)||Te(se,he))return 0;var re=X(ne[0],ne[1],se[0],se[1],he.minX,he.minY,he.maxX,he.minY);if(0===re)return 0;var nt=X(ne[0],ne[1],se[0],se[1],he.minX,he.minY,he.minX,he.maxY);if(0===nt)return 0;var ze=X(ne[0],ne[1],se[0],se[1],he.maxX,he.minY,he.maxX,he.maxY);if(0===ze)return 0;var Ze=X(ne[0],ne[1],se[0],se[1],he.minX,he.maxY,he.maxX,he.maxY);return 0===Ze?0:Math.min(re,nt,ze,Ze)}function Te(ne,se){return ne[0]>=se.minX&&ne[0]<=se.maxX&&ne[1]>=se.minY&&ne[1]<=se.maxY}function $e(ne,se,he){for(var re=Math.min(ne[0],se[0]),nt=Math.min(ne[1],se[1]),ze=Math.max(ne[0],se[0]),Ze=Math.max(ne[1],se[1]),Ee=he.search({minX:re,minY:nt,maxX:ze,maxY:Ze}),Jt=0;Jt<Ee.length;Jt++)if(ge(Ee[Jt].p,Ee[Jt].next.p,ne,se))return!1;return!0}function xe(ne,se,he){return c(ne[0],ne[1],se[0],se[1],he[0],he[1])}function ge(ne,se,he,re){return ne!==re&&se!==he&&xe(ne,se,he)>0!=xe(ne,se,re)>0&&xe(he,re,ne)>0!=xe(he,re,se)>0}function Oe(ne){var se=ne.p,he=ne.next.p;return ne.minX=Math.min(se[0],he[0]),ne.minY=Math.min(se[1],he[1]),ne.maxX=Math.max(se[0],he[0]),ne.maxY=Math.max(se[1],he[1]),ne}function H(ne,se){var he={p:ne,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return se?(he.next=se.next,he.prev=se,se.next.prev=he,se.next=he):(he.prev=he,he.next=he),he}function q(ne,se){var he=ne[0]-se[0],re=ne[1]-se[1];return he*he+re*re}function K(ne,se,he){var re=se[0],nt=se[1],ze=he[0]-re,Ze=he[1]-nt;if(0!==ze||0!==Ze){var Ee=((ne[0]-re)*ze+(ne[1]-nt)*Ze)/(ze*ze+Ze*Ze);Ee>1?(re=he[0],nt=he[1]):Ee>0&&(re+=ze*Ee,nt+=Ze*Ee)}return(ze=ne[0]-re)*ze+(Ze=ne[1]-nt)*Ze}function X(ne,se,he,re,nt,ze,Ze,Ee){var Ur,Fr,zr,rn,Jt=he-ne,Nt=re-se,ke=Ze-nt,xt=Ee-ze,Ae=ne-nt,pt=se-ze,bt=Jt*Jt+Nt*Nt,Ue=Jt*ke+Nt*xt,Wt=ke*ke+xt*xt,Vt=Jt*Ae+Nt*pt,Cr=ke*Ae+xt*pt,Ft=bt*Wt-Ue*Ue,Ar=Ft,xr=Ft;0===Ft?(Fr=0,Ar=1,rn=Cr,xr=Wt):(rn=bt*Cr-Ue*Vt,(Fr=Ue*Cr-Wt*Vt)<0?(Fr=0,rn=Cr,xr=Wt):Fr>Ar&&(Fr=Ar,rn=Cr+Ue,xr=Wt)),rn<0?(rn=0,-Vt<0?Fr=0:-Vt>bt?Fr=Ar:(Fr=-Vt,Ar=bt)):rn>xr&&(rn=xr,-Vt+Ue<0?Fr=0:-Vt+Ue>bt?Fr=Ar:(Fr=-Vt+Ue,Ar=bt));var lr=(1-(zr=0===rn?0:rn/xr))*nt+zr*Ze-((1-(Ur=0===Fr?0:Fr/Ar))*ne+Ur*he),st=(1-zr)*ze+zr*Ee-((1-Ur)*se+Ur*re);return lr*lr+st*st}function ee(ne,se){return ne[0]===se[0]?ne[1]-se[1]:ne[0]-se[0]}pe.default&&(pe=pe.default),Mt.exports=Z,Mt.exports.default=Z},3156:function(Mt){Mt.exports=function(){"use strict";function Ye(H,q,K,X,ee){!function ie(ne,se,he,re,nt){for(;re>he;){if(re-he>600){var ze=re-he+1,Ze=se-he+1,Ee=Math.log(ze),Jt=.5*Math.exp(2*Ee/3),Nt=.5*Math.sqrt(Ee*Jt*(ze-Jt)/ze)*(Ze-ze/2<0?-1:1);ie(ne,se,Math.max(he,Math.floor(se-Ze*Jt/ze+Nt)),Math.min(re,Math.floor(se+(ze-Ze)*Jt/ze+Nt)),nt)}var Ae=ne[se],pt=he,bt=re;for(ue(ne,he,se),nt(ne[re],Ae)>0&&ue(ne,he,re);pt<bt;){for(ue(ne,pt,bt),pt++,bt--;nt(ne[pt],Ae)<0;)pt++;for(;nt(ne[bt],Ae)>0;)bt--}0===nt(ne[he],Ae)?ue(ne,he,bt):ue(ne,++bt,re),bt<=se&&(he=bt+1),se<=bt&&(re=bt-1)}}(H,q,K||0,X||H.length-1,ee||ae)}function ue(H,q,K){var X=H[q];H[q]=H[K],H[K]=X}function ae(H,q){return H<q?-1:H>q?1:0}var pe=function(H){void 0===H&&(H=9),this._maxEntries=Math.max(4,H),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function b(H,q,K){if(!K)return q.indexOf(H);for(var X=0;X<q.length;X++)if(K(H,q[X]))return X;return-1}function c(H,q){Z(H,0,H.children.length,q,H)}function Z(H,q,K,X,ee){ee||(ee=Oe(null)),ee.minX=1/0,ee.minY=1/0,ee.maxX=-1/0,ee.maxY=-1/0;for(var ie=q;ie<K;ie++){var ne=H.children[ie];ce(ee,H.leaf?X(ne):ne)}return ee}function ce(H,q){return H.minX=Math.min(H.minX,q.minX),H.minY=Math.min(H.minY,q.minY),H.maxX=Math.max(H.maxX,q.maxX),H.maxY=Math.max(H.maxY,q.maxY),H}function be(H,q){return H.minX-q.minX}function ye(H,q){return H.minY-q.minY}function Te(H){return(H.maxX-H.minX)*(H.maxY-H.minY)}function $e(H){return H.maxX-H.minX+(H.maxY-H.minY)}function xe(H,q){return H.minX<=q.minX&&H.minY<=q.minY&&q.maxX<=H.maxX&&q.maxY<=H.maxY}function ge(H,q){return q.minX<=H.maxX&&q.minY<=H.maxY&&q.maxX>=H.minX&&q.maxY>=H.minY}function Oe(H){return{children:H,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function We(H,q,K,X,ee){for(var ie=[q,K];ie.length;)if(!((K=ie.pop())-(q=ie.pop())<=X)){var ne=q+Math.ceil((K-q)/X/2)*X;Ye(H,ne,q,K,ee),ie.push(q,ne,ne,K)}}return pe.prototype.all=function(){return this._all(this.data,[])},pe.prototype.search=function(H){var q=this.data,K=[];if(!ge(H,q))return K;for(var X=this.toBBox,ee=[];q;){for(var ie=0;ie<q.children.length;ie++){var ne=q.children[ie],se=q.leaf?X(ne):ne;ge(H,se)&&(q.leaf?K.push(ne):xe(H,se)?this._all(ne,K):ee.push(ne))}q=ee.pop()}return K},pe.prototype.collides=function(H){var q=this.data;if(!ge(H,q))return!1;for(var K=[];q;){for(var X=0;X<q.children.length;X++){var ee=q.children[X],ie=q.leaf?this.toBBox(ee):ee;if(ge(H,ie)){if(q.leaf||xe(H,ie))return!0;K.push(ee)}}q=K.pop()}return!1},pe.prototype.load=function(H){if(!H||!H.length)return this;if(H.length<this._minEntries){for(var q=0;q<H.length;q++)this.insert(H[q]);return this}var K=this._build(H.slice(),0,H.length-1,0);if(this.data.children.length)if(this.data.height===K.height)this._splitRoot(this.data,K);else{if(this.data.height<K.height){var X=this.data;this.data=K,K=X}this._insert(K,this.data.height-K.height-1,!0)}else this.data=K;return this},pe.prototype.insert=function(H){return H&&this._insert(H,this.data.height-1),this},pe.prototype.clear=function(){return this.data=Oe([]),this},pe.prototype.remove=function(H,q){if(!H)return this;for(var K,X,ee,ie=this.data,ne=this.toBBox(H),se=[],he=[];ie||se.length;){if(ie||(ie=se.pop(),X=se[se.length-1],K=he.pop(),ee=!0),ie.leaf){var re=b(H,ie.children,q);if(-1!==re)return ie.children.splice(re,1),se.push(ie),this._condense(se),this}ee||ie.leaf||!xe(ie,ne)?X?(K++,ie=X.children[K],ee=!1):ie=null:(se.push(ie),he.push(K),K=0,X=ie,ie=ie.children[0])}return this},pe.prototype.toBBox=function(H){return H},pe.prototype.compareMinX=function(H,q){return H.minX-q.minX},pe.prototype.compareMinY=function(H,q){return H.minY-q.minY},pe.prototype.toJSON=function(){return this.data},pe.prototype.fromJSON=function(H){return this.data=H,this},pe.prototype._all=function(H,q){for(var K=[];H;)H.leaf?q.push.apply(q,H.children):K.push.apply(K,H.children),H=K.pop();return q},pe.prototype._build=function(H,q,K,X){var ee,ie=K-q+1,ne=this._maxEntries;if(ie<=ne)return c(ee=Oe(H.slice(q,K+1)),this.toBBox),ee;X||(X=Math.ceil(Math.log(ie)/Math.log(ne)),ne=Math.ceil(ie/Math.pow(ne,X-1))),(ee=Oe([])).leaf=!1,ee.height=X;var se=Math.ceil(ie/ne),he=se*Math.ceil(Math.sqrt(ne));We(H,q,K,he,this.compareMinX);for(var re=q;re<=K;re+=he){var nt=Math.min(re+he-1,K);We(H,re,nt,se,this.compareMinY);for(var ze=re;ze<=nt;ze+=se){var Ze=Math.min(ze+se-1,nt);ee.children.push(this._build(H,ze,Ze,X-1))}}return c(ee,this.toBBox),ee},pe.prototype._chooseSubtree=function(H,q,K,X){for(;X.push(q),!q.leaf&&X.length-1!==K;){for(var ee=1/0,ie=1/0,ne=void 0,se=0;se<q.children.length;se++){var he=q.children[se],re=Te(he),nt=(ze=H,Ze=he,(Math.max(Ze.maxX,ze.maxX)-Math.min(Ze.minX,ze.minX))*(Math.max(Ze.maxY,ze.maxY)-Math.min(Ze.minY,ze.minY))-re);nt<ie?(ie=nt,ee=re<ee?re:ee,ne=he):nt===ie&&re<ee&&(ee=re,ne=he)}q=ne||q.children[0]}var ze,Ze;return q},pe.prototype._insert=function(H,q,K){var X=K?H:this.toBBox(H),ee=[],ie=this._chooseSubtree(X,this.data,q,ee);for(ie.children.push(H),ce(ie,X);q>=0&&ee[q].children.length>this._maxEntries;)this._split(ee,q),q--;this._adjustParentBBoxes(X,ee,q)},pe.prototype._split=function(H,q){var K=H[q],X=K.children.length,ee=this._minEntries;this._chooseSplitAxis(K,ee,X);var ie=this._chooseSplitIndex(K,ee,X),ne=Oe(K.children.splice(ie,K.children.length-ie));ne.height=K.height,ne.leaf=K.leaf,c(K,this.toBBox),c(ne,this.toBBox),q?H[q-1].children.push(ne):this._splitRoot(K,ne)},pe.prototype._splitRoot=function(H,q){this.data=Oe([H,q]),this.data.height=H.height+1,this.data.leaf=!1,c(this.data,this.toBBox)},pe.prototype._chooseSplitIndex=function(H,q,K){for(var X,ee,ie,ne,se,he,re,nt=1/0,ze=1/0,Ze=q;Ze<=K-q;Ze++){var Ee=Z(H,0,Ze,this.toBBox),Jt=Z(H,Ze,K,this.toBBox),Nt=(ee=Ee,ie=Jt,void 0,void 0,void 0,void 0,ne=Math.max(ee.minX,ie.minX),se=Math.max(ee.minY,ie.minY),he=Math.min(ee.maxX,ie.maxX),re=Math.min(ee.maxY,ie.maxY),Math.max(0,he-ne)*Math.max(0,re-se)),ke=Te(Ee)+Te(Jt);Nt<nt?(nt=Nt,X=Ze,ze=ke<ze?ke:ze):Nt===nt&&ke<ze&&(ze=ke,X=Ze)}return X||K-q},pe.prototype._chooseSplitAxis=function(H,q,K){var X=H.leaf?this.compareMinX:be,ee=H.leaf?this.compareMinY:ye;this._allDistMargin(H,q,K,X)<this._allDistMargin(H,q,K,ee)&&H.children.sort(X)},pe.prototype._allDistMargin=function(H,q,K,X){H.children.sort(X);for(var ee=this.toBBox,ie=Z(H,0,q,ee),ne=Z(H,K-q,K,ee),se=$e(ie)+$e(ne),he=q;he<K-q;he++){var re=H.children[he];ce(ie,H.leaf?ee(re):re),se+=$e(ie)}for(var nt=K-q-1;nt>=q;nt--){var ze=H.children[nt];ce(ne,H.leaf?ee(ze):ze),se+=$e(ne)}return se},pe.prototype._adjustParentBBoxes=function(H,q,K){for(var X=K;X>=0;X--)ce(q[X],H)},pe.prototype._condense=function(H){for(var q=H.length-1,K=void 0;q>=0;q--)0===H[q].children.length?q>0?(K=H[q-1].children).splice(K.indexOf(H[q]),1):this.clear():c(H[q],this.toBBox)},pe}()},6952:(Mt,Ye,ue)=>{var ae=ue(1356),pe=ue(3407),b=ue(2e3),c=ue(2342),Z=ue(9235),ce=ue(2374),be=Date.prototype.getTime;function Te(ge){return null==ge}function $e(ge){return!(!ge||"object"!=typeof ge||"number"!=typeof ge.length||"function"!=typeof ge.copy||"function"!=typeof ge.slice||ge.length>0&&"number"!=typeof ge[0])}Mt.exports=function ye(ge,Oe,We){var H=We||{};return!!(H.strict?b(ge,Oe):ge===Oe)||(!ge||!Oe||"object"!=typeof ge&&"object"!=typeof Oe?H.strict?b(ge,Oe):ge==Oe:function xe(ge,Oe,We){var H,q;if(typeof ge!=typeof Oe||Te(ge)||Te(Oe)||ge.prototype!==Oe.prototype||pe(ge)!==pe(Oe))return!1;var K=c(ge),X=c(Oe);if(K!==X)return!1;if(K||X)return ge.source===Oe.source&&Z(ge)===Z(Oe);if(ce(ge)&&ce(Oe))return be.call(ge)===be.call(Oe);var ee=$e(ge),ie=$e(Oe);if(ee!==ie)return!1;if(ee||ie){if(ge.length!==Oe.length)return!1;for(H=0;H<ge.length;H++)if(ge[H]!==Oe[H])return!1;return!0}if(typeof ge!=typeof Oe)return!1;try{var ne=ae(ge),se=ae(Oe)}catch{return!1}if(ne.length!==se.length)return!1;for(ne.sort(),se.sort(),H=ne.length-1;H>=0;H--)if(ne[H]!=se[H])return!1;for(H=ne.length-1;H>=0;H--)if(!ye(ge[q=ne[H]],Oe[q],We))return!1;return!0}(ge,Oe,H))}},2358:(Mt,Ye,ue)=>{"use strict";var ae=ue(1356),pe="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),b=Object.prototype.toString,c=Array.prototype.concat,Z=Object.defineProperty,be=ue(7027)(),ye=Z&&be,Te=function(xe,ge,Oe,We){ge in xe&&(!function(xe){return"function"==typeof xe&&"[object Function]"===b.call(xe)}(We)||!We())||(ye?Z(xe,ge,{configurable:!0,enumerable:!1,value:Oe,writable:!0}):xe[ge]=Oe)},$e=function(xe,ge){var Oe=arguments.length>2?arguments[2]:{},We=ae(ge);pe&&(We=c.call(We,Object.getOwnPropertySymbols(ge)));for(var H=0;H<We.length;H+=1)Te(xe,We[H],ge[We[H]],Oe[We[H]])};$e.supportsDescriptors=!!ye,Mt.exports=$e},1817:Mt=>{function Ye(ue,ae,pe,b){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(ue,ae,pe,b)}Ye.prototype.run=function(ue,ae,pe,b){this._init(ue,ae,pe,b);for(var c=0;c<this._datasetLength;c++)if(1!==this._visited[c]){this._visited[c]=1;var Z=this._regionQuery(c);if(Z.length<this.minPts)this.noise.push(c);else{var ce=this.clusters.length;this.clusters.push([]),this._addToCluster(c,ce),this._expandCluster(ce,Z)}}return this.clusters},Ye.prototype._init=function(ue,ae,pe,b){if(ue){if(!(ue instanceof Array))throw Error("Dataset must be of type array, "+typeof ue+" given");this.dataset=ue,this.clusters=[],this.noise=[],this._datasetLength=ue.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}ae&&(this.epsilon=ae),pe&&(this.minPts=pe),b&&(this.distance=b)},Ye.prototype._expandCluster=function(ue,ae){for(var pe=0;pe<ae.length;pe++){var b=ae[pe];if(1!==this._visited[b]){this._visited[b]=1;var c=this._regionQuery(b);c.length>=this.minPts&&(ae=this._mergeArrays(ae,c))}1!==this._assigned[b]&&this._addToCluster(b,ue)}},Ye.prototype._addToCluster=function(ue,ae){this.clusters[ae].push(ue),this._assigned[ue]=1},Ye.prototype._regionQuery=function(ue){for(var ae=[],pe=0;pe<this._datasetLength;pe++)this.distance(this.dataset[ue],this.dataset[pe])<this.epsilon&&ae.push(pe);return ae},Ye.prototype._mergeArrays=function(ue,ae){for(var pe=ae.length,b=0;b<pe;b++){var c=ae[b];ue.indexOf(c)<0&&ue.push(c)}return ue},Ye.prototype._euclideanDistance=function(ue,ae){for(var pe=0,b=Math.min(ue.length,ae.length);b--;)pe+=(ue[b]-ae[b])*(ue[b]-ae[b]);return Math.sqrt(pe)},Mt.exports&&(Mt.exports=Ye)},4273:Mt=>{function Ye(ue,ae,pe){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(ue,ae,pe)}Ye.prototype.init=function(ue,ae,pe){this.assignments=[],this.centroids=[],typeof ue<"u"&&(this.dataset=ue),typeof ae<"u"&&(this.k=ae),typeof pe<"u"&&(this.distance=pe)},Ye.prototype.run=function(ue,ae){this.init(ue,ae);for(var pe=this.dataset.length,b=0;b<this.k;b++)this.centroids[b]=this.randomCentroid();for(var c=!0;c;){c=this.assign();for(var Z=0;Z<this.k;Z++){for(var ce=new Array($e),be=0,ye=0;ye<$e;ye++)ce[ye]=0;for(var Te=0;Te<pe;Te++){var $e=this.dataset[Te].length;if(Z===this.assignments[Te]){for(ye=0;ye<$e;ye++)ce[ye]+=this.dataset[Te][ye];be++}}if(be>0){for(ye=0;ye<$e;ye++)ce[ye]/=be;this.centroids[Z]=ce}else this.centroids[Z]=this.randomCentroid(),c=!0}}return this.getClusters()},Ye.prototype.randomCentroid=function(){var ae,pe,ue=this.dataset.length-1;do{pe=Math.round(Math.random()*ue),ae=this.dataset[pe]}while(this.centroids.indexOf(ae)>=0);return ae},Ye.prototype.assign=function(){for(var pe,ue=!1,ae=this.dataset.length,b=0;b<ae;b++)(pe=this.argmin(this.dataset[b],this.centroids,this.distance))!=this.assignments[b]&&(this.assignments[b]=pe,ue=!0);return ue},Ye.prototype.getClusters=function(){for(var ae,ue=new Array(this.k),pe=0;pe<this.assignments.length;pe++)typeof ue[ae=this.assignments[pe]]>"u"&&(ue[ae]=[]),ue[ae].push(pe);return ue},Ye.prototype.argmin=function(ue,ae,pe){for(var ce,b=Number.MAX_VALUE,c=0,Z=ae.length,be=0;be<Z;be++)(ce=pe(ue,ae[be]))<b&&(b=ce,c=be);return c},Ye.prototype.distance=function(ue,ae){for(var pe=0,b=Math.min(ue.length,ae.length);b--;){var c=ue[b]-ae[b];pe+=c*c}return Math.sqrt(pe)},Mt.exports&&(Mt.exports=Ye)},8680:(Mt,Ye,ue)=>{if(Mt.exports)var ae=ue(8759);function pe(b,c,Z,ce){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(b,c,Z,ce)}pe.prototype.run=function(b,c,Z,ce){this._init(b,c,Z,ce);for(var be=0,ye=this.dataset.length;be<ye;be++)if(1!==this._processed[be]){this._processed[be]=1,this.clusters.push([be]);var Te=this.clusters.length-1;this._orderedList.push(be);var $e=new ae(null,null,"asc"),xe=this._regionQuery(be);void 0!==this._distanceToCore(be)&&(this._updateQueue(be,xe,$e),this._expandCluster(Te,$e))}return this.clusters},pe.prototype.getReachabilityPlot=function(){for(var b=[],c=0,Z=this._orderedList.length;c<Z;c++){var ce=this._orderedList[c];b.push([ce,this._reachability[ce]])}return b},pe.prototype._init=function(b,c,Z,ce){if(b){if(!(b instanceof Array))throw Error("Dataset must be of type array, "+typeof b+" given");this.dataset=b,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}c&&(this.epsilon=c),Z&&(this.minPts=Z),ce&&(this.distance=ce)},pe.prototype._updateQueue=function(b,c,Z){var ce=this;this._coreDistance=this._distanceToCore(b),c.forEach(function(be){if(void 0===ce._processed[be]){var ye=ce.distance(ce.dataset[b],ce.dataset[be]),Te=Math.max(ce._coreDistance,ye);void 0===ce._reachability[be]?(ce._reachability[be]=Te,Z.insert(be,Te)):Te<ce._reachability[be]&&(ce._reachability[be]=Te,Z.remove(be),Z.insert(be,Te))}})},pe.prototype._expandCluster=function(b,c){for(var Z=c.getElements(),ce=0,be=Z.length;ce<be;ce++){var ye=Z[ce];if(void 0===this._processed[ye]){var Te=this._regionQuery(ye);this._processed[ye]=1,this.clusters[b].push(ye),this._orderedList.push(ye),void 0!==this._distanceToCore(ye)&&(this._updateQueue(ye,Te,c),this._expandCluster(b,c))}}},pe.prototype._distanceToCore=function(b){for(var c=this.epsilon,Z=0;Z<c;Z++)if(this._regionQuery(b,Z).length>=this.minPts)return Z},pe.prototype._regionQuery=function(b,c){c=c||this.epsilon;for(var Z=[],ce=0,be=this.dataset.length;ce<be;ce++)this.distance(this.dataset[b],this.dataset[ce])<c&&Z.push(ce);return Z},pe.prototype._euclideanDistance=function(b,c){for(var Z=0,ce=Math.min(b.length,c.length);ce--;)Z+=(b[ce]-c[ce])*(b[ce]-c[ce]);return Math.sqrt(Z)},Mt.exports&&(Mt.exports=pe)},8759:Mt=>{function Ye(ue,ae,pe){this._queue=[],this._priorities=[],this._sorting="desc",this._init(ue,ae,pe)}Ye.prototype.insert=function(ue,ae){for(var pe=this._queue.length,b=pe;b--;){var c=this._priorities[b];"desc"===this._sorting?ae>c&&(pe=b):ae<c&&(pe=b)}this._insertAt(ue,ae,pe)},Ye.prototype.remove=function(ue){for(var ae=this._queue.length;ae--;)if(ue===this._queue[ae]){this._queue.splice(ae,1),this._priorities.splice(ae,1);break}},Ye.prototype.forEach=function(ue){this._queue.forEach(ue)},Ye.prototype.getElements=function(){return this._queue},Ye.prototype.getElementPriority=function(ue){return this._priorities[ue]},Ye.prototype.getPriorities=function(){return this._priorities},Ye.prototype.getElementsWithPriorities=function(){for(var ue=[],ae=0,pe=this._queue.length;ae<pe;ae++)ue.push([this._queue[ae],this._priorities[ae]]);return ue},Ye.prototype._init=function(ue,ae,pe){if(ue&&ae){if(this._queue=[],this._priorities=[],ue.length!==ae.length)throw new Error("Arrays must have the same length");for(var b=0;b<ue.length;b++)this.insert(ue[b],ae[b])}pe&&(this._sorting=pe)},Ye.prototype._insertAt=function(ue,ae,pe){this._queue.length===pe?(this._queue.push(ue),this._priorities.push(ae)):(this._queue.splice(pe,0,ue),this._priorities.splice(pe,0,ae))},Mt.exports&&(Mt.exports=Ye)},7470:(Mt,Ye,ue)=>{Mt.exports&&(Mt.exports={DBSCAN:ue(1817),KMEANS:ue(4273),OPTICS:ue(8680),PriorityQueue:ue(8759)})},5469:Mt=>{"use strict";function Ye(ke,xt,Ae){Ae=Ae||2;var Vt,Cr,Ft,Ur,Fr,zr,rn,pt=xt&&xt.length,bt=pt?xt[0]*Ae:ke.length,Ue=ue(ke,0,bt,Ae,!0),Wt=[];if(!Ue||Ue.next===Ue.prev)return Wt;if(pt&&(Ue=function be(ke,xt,Ae,pt){var Ue,Wt,Ft,bt=[];for(Ue=0,Wt=xt.length;Ue<Wt;Ue++)(Ft=ue(ke,xt[Ue]*pt,Ue<Wt-1?xt[Ue+1]*pt:ke.length,pt,!1))===Ft.next&&(Ft.steiner=!0),bt.push(H(Ft));for(bt.sort(ye),Ue=0;Ue<bt.length;Ue++)Ae=Te(bt[Ue],Ae);return Ae}(ke,xt,Ue,Ae)),ke.length>80*Ae){Vt=Ft=ke[0],Cr=Ur=ke[1];for(var Ar=Ae;Ar<bt;Ar+=Ae)(Fr=ke[Ar])<Vt&&(Vt=Fr),(zr=ke[Ar+1])<Cr&&(Cr=zr),Fr>Ft&&(Ft=Fr),zr>Ur&&(Ur=zr);rn=0!==(rn=Math.max(Ft-Vt,Ur-Cr))?32767/rn:0}return pe(Ue,Wt,Ae,Vt,Cr,rn,0),Wt}function ue(ke,xt,Ae,pt,bt){var Ue,Wt;if(bt===Nt(ke,xt,Ae,pt)>0)for(Ue=xt;Ue<Ae;Ue+=pt)Wt=Ze(Ue,ke[Ue],ke[Ue+1],Wt);else for(Ue=Ae-pt;Ue>=xt;Ue-=pt)Wt=Ze(Ue,ke[Ue],ke[Ue+1],Wt);return Wt&&ee(Wt,Wt.next)&&(Ee(Wt),Wt=Wt.next),Wt}function ae(ke,xt){if(!ke)return ke;xt||(xt=ke);var pt,Ae=ke;do{if(pt=!1,Ae.steiner||!ee(Ae,Ae.next)&&0!==X(Ae.prev,Ae,Ae.next))Ae=Ae.next;else{if(Ee(Ae),(Ae=xt=Ae.prev)===Ae.next)break;pt=!0}}while(pt||Ae!==xt);return xt}function pe(ke,xt,Ae,pt,bt,Ue,Wt){if(ke){!Wt&&Ue&&function ge(ke,xt,Ae,pt){var bt=ke;do{0===bt.z&&(bt.z=We(bt.x,bt.y,xt,Ae,pt)),bt.prevZ=bt.prev,bt.nextZ=bt.next,bt=bt.next}while(bt!==ke);bt.prevZ.nextZ=null,bt.prevZ=null,function Oe(ke){var xt,Ae,pt,bt,Ue,Wt,Vt,Cr,Ft=1;do{for(Ae=ke,ke=null,Ue=null,Wt=0;Ae;){for(Wt++,pt=Ae,Vt=0,xt=0;xt<Ft&&(Vt++,pt=pt.nextZ);xt++);for(Cr=Ft;Vt>0||Cr>0&&pt;)0!==Vt&&(0===Cr||!pt||Ae.z<=pt.z)?(bt=Ae,Ae=Ae.nextZ,Vt--):(bt=pt,pt=pt.nextZ,Cr--),Ue?Ue.nextZ=bt:ke=bt,bt.prevZ=Ue,Ue=bt;Ae=pt}Ue.nextZ=null,Ft*=2}while(Wt>1)}(bt)}(ke,pt,bt,Ue);for(var Cr,Ft,Vt=ke;ke.prev!==ke.next;)if(Cr=ke.prev,Ft=ke.next,Ue?c(ke,pt,bt,Ue):b(ke))xt.push(Cr.i/Ae|0),xt.push(ke.i/Ae|0),xt.push(Ft.i/Ae|0),Ee(ke),ke=Ft.next,Vt=Ft.next;else if((ke=Ft)===Vt){Wt?1===Wt?pe(ke=Z(ae(ke),xt,Ae),xt,Ae,pt,bt,Ue,2):2===Wt&&ce(ke,xt,Ae,pt,bt,Ue):pe(ae(ke),xt,Ae,pt,bt,Ue,1);break}}}function b(ke){var xt=ke.prev,Ae=ke,pt=ke.next;if(X(xt,Ae,pt)>=0)return!1;for(var bt=xt.x,Ue=Ae.x,Wt=pt.x,Vt=xt.y,Cr=Ae.y,Ft=pt.y,Ur=bt<Ue?bt<Wt?bt:Wt:Ue<Wt?Ue:Wt,Fr=Vt<Cr?Vt<Ft?Vt:Ft:Cr<Ft?Cr:Ft,zr=bt>Ue?bt>Wt?bt:Wt:Ue>Wt?Ue:Wt,rn=Vt>Cr?Vt>Ft?Vt:Ft:Cr>Ft?Cr:Ft,Ar=pt.next;Ar!==xt;){if(Ar.x>=Ur&&Ar.x<=zr&&Ar.y>=Fr&&Ar.y<=rn&&q(bt,Vt,Ue,Cr,Wt,Ft,Ar.x,Ar.y)&&X(Ar.prev,Ar,Ar.next)>=0)return!1;Ar=Ar.next}return!0}function c(ke,xt,Ae,pt){var bt=ke.prev,Ue=ke,Wt=ke.next;if(X(bt,Ue,Wt)>=0)return!1;for(var Vt=bt.x,Cr=Ue.x,Ft=Wt.x,Ur=bt.y,Fr=Ue.y,zr=Wt.y,rn=Vt<Cr?Vt<Ft?Vt:Ft:Cr<Ft?Cr:Ft,Ar=Ur<Fr?Ur<zr?Ur:zr:Fr<zr?Fr:zr,xr=Vt>Cr?Vt>Ft?Vt:Ft:Cr>Ft?Cr:Ft,cn=Ur>Fr?Ur>zr?Ur:zr:Fr>zr?Fr:zr,qn=We(rn,Ar,xt,Ae,pt),yi=We(xr,cn,xt,Ae,pt),ft=ke.prevZ,lr=ke.nextZ;ft&&ft.z>=qn&&lr&&lr.z<=yi;){if(ft.x>=rn&&ft.x<=xr&&ft.y>=Ar&&ft.y<=cn&&ft!==bt&&ft!==Wt&&q(Vt,Ur,Cr,Fr,Ft,zr,ft.x,ft.y)&&X(ft.prev,ft,ft.next)>=0||(ft=ft.prevZ,lr.x>=rn&&lr.x<=xr&&lr.y>=Ar&&lr.y<=cn&&lr!==bt&&lr!==Wt&&q(Vt,Ur,Cr,Fr,Ft,zr,lr.x,lr.y)&&X(lr.prev,lr,lr.next)>=0))return!1;lr=lr.nextZ}for(;ft&&ft.z>=qn;){if(ft.x>=rn&&ft.x<=xr&&ft.y>=Ar&&ft.y<=cn&&ft!==bt&&ft!==Wt&&q(Vt,Ur,Cr,Fr,Ft,zr,ft.x,ft.y)&&X(ft.prev,ft,ft.next)>=0)return!1;ft=ft.prevZ}for(;lr&&lr.z<=yi;){if(lr.x>=rn&&lr.x<=xr&&lr.y>=Ar&&lr.y<=cn&&lr!==bt&&lr!==Wt&&q(Vt,Ur,Cr,Fr,Ft,zr,lr.x,lr.y)&&X(lr.prev,lr,lr.next)>=0)return!1;lr=lr.nextZ}return!0}function Z(ke,xt,Ae){var pt=ke;do{var bt=pt.prev,Ue=pt.next.next;!ee(bt,Ue)&&ie(bt,pt,pt.next,Ue)&&re(bt,Ue)&&re(Ue,bt)&&(xt.push(bt.i/Ae|0),xt.push(pt.i/Ae|0),xt.push(Ue.i/Ae|0),Ee(pt),Ee(pt.next),pt=ke=Ue),pt=pt.next}while(pt!==ke);return ae(pt)}function ce(ke,xt,Ae,pt,bt,Ue){var Wt=ke;do{for(var Vt=Wt.next.next;Vt!==Wt.prev;){if(Wt.i!==Vt.i&&K(Wt,Vt)){var Cr=ze(Wt,Vt);return Wt=ae(Wt,Wt.next),Cr=ae(Cr,Cr.next),pe(Wt,xt,Ae,pt,bt,Ue,0),void pe(Cr,xt,Ae,pt,bt,Ue,0)}Vt=Vt.next}Wt=Wt.next}while(Wt!==ke)}function ye(ke,xt){return ke.x-xt.x}function Te(ke,xt){var Ae=function $e(ke,xt){var Wt,Ae=xt,pt=ke.x,bt=ke.y,Ue=-1/0;do{if(bt<=Ae.y&&bt>=Ae.next.y&&Ae.next.y!==Ae.y){var Vt=Ae.x+(bt-Ae.y)*(Ae.next.x-Ae.x)/(Ae.next.y-Ae.y);if(Vt<=pt&&Vt>Ue&&(Ue=Vt,Wt=Ae.x<Ae.next.x?Ae:Ae.next,Vt===pt))return Wt}Ae=Ae.next}while(Ae!==xt);if(!Wt)return null;var zr,Cr=Wt,Ft=Wt.x,Ur=Wt.y,Fr=1/0;Ae=Wt;do{pt>=Ae.x&&Ae.x>=Ft&&pt!==Ae.x&&q(bt<Ur?pt:Ue,bt,Ft,Ur,bt<Ur?Ue:pt,bt,Ae.x,Ae.y)&&(zr=Math.abs(bt-Ae.y)/(pt-Ae.x),re(Ae,ke)&&(zr<Fr||zr===Fr&&(Ae.x>Wt.x||Ae.x===Wt.x&&xe(Wt,Ae)))&&(Wt=Ae,Fr=zr)),Ae=Ae.next}while(Ae!==Cr);return Wt}(ke,xt);if(!Ae)return xt;var pt=ze(Ae,ke);return ae(pt,pt.next),ae(Ae,Ae.next)}function xe(ke,xt){return X(ke.prev,ke,xt.prev)<0&&X(xt.next,ke,ke.next)<0}function We(ke,xt,Ae,pt,bt){return(ke=1431655765&((ke=858993459&((ke=252645135&((ke=16711935&((ke=(ke-Ae)*bt|0)|ke<<8))|ke<<4))|ke<<2))|ke<<1))|(xt=1431655765&((xt=858993459&((xt=252645135&((xt=16711935&((xt=(xt-pt)*bt|0)|xt<<8))|xt<<4))|xt<<2))|xt<<1))<<1}function H(ke){var xt=ke,Ae=ke;do{(xt.x<Ae.x||xt.x===Ae.x&&xt.y<Ae.y)&&(Ae=xt),xt=xt.next}while(xt!==ke);return Ae}function q(ke,xt,Ae,pt,bt,Ue,Wt,Vt){return(bt-Wt)*(xt-Vt)>=(ke-Wt)*(Ue-Vt)&&(ke-Wt)*(pt-Vt)>=(Ae-Wt)*(xt-Vt)&&(Ae-Wt)*(Ue-Vt)>=(bt-Wt)*(pt-Vt)}function K(ke,xt){return ke.next.i!==xt.i&&ke.prev.i!==xt.i&&!function he(ke,xt){var Ae=ke;do{if(Ae.i!==ke.i&&Ae.next.i!==ke.i&&Ae.i!==xt.i&&Ae.next.i!==xt.i&&ie(Ae,Ae.next,ke,xt))return!0;Ae=Ae.next}while(Ae!==ke);return!1}(ke,xt)&&(re(ke,xt)&&re(xt,ke)&&function nt(ke,xt){var Ae=ke,pt=!1,bt=(ke.x+xt.x)/2,Ue=(ke.y+xt.y)/2;do{Ae.y>Ue!=Ae.next.y>Ue&&Ae.next.y!==Ae.y&&bt<(Ae.next.x-Ae.x)*(Ue-Ae.y)/(Ae.next.y-Ae.y)+Ae.x&&(pt=!pt),Ae=Ae.next}while(Ae!==ke);return pt}(ke,xt)&&(X(ke.prev,ke,xt.prev)||X(ke,xt.prev,xt))||ee(ke,xt)&&X(ke.prev,ke,ke.next)>0&&X(xt.prev,xt,xt.next)>0)}function X(ke,xt,Ae){return(xt.y-ke.y)*(Ae.x-xt.x)-(xt.x-ke.x)*(Ae.y-xt.y)}function ee(ke,xt){return ke.x===xt.x&&ke.y===xt.y}function ie(ke,xt,Ae,pt){var bt=se(X(ke,xt,Ae)),Ue=se(X(ke,xt,pt)),Wt=se(X(Ae,pt,ke)),Vt=se(X(Ae,pt,xt));return!!(bt!==Ue&&Wt!==Vt||0===bt&&ne(ke,Ae,xt)||0===Ue&&ne(ke,pt,xt)||0===Wt&&ne(Ae,ke,pt)||0===Vt&&ne(Ae,xt,pt))}function ne(ke,xt,Ae){return xt.x<=Math.max(ke.x,Ae.x)&&xt.x>=Math.min(ke.x,Ae.x)&&xt.y<=Math.max(ke.y,Ae.y)&&xt.y>=Math.min(ke.y,Ae.y)}function se(ke){return ke>0?1:ke<0?-1:0}function re(ke,xt){return X(ke.prev,ke,ke.next)<0?X(ke,xt,ke.next)>=0&&X(ke,ke.prev,xt)>=0:X(ke,xt,ke.prev)<0||X(ke,ke.next,xt)<0}function ze(ke,xt){var Ae=new Jt(ke.i,ke.x,ke.y),pt=new Jt(xt.i,xt.x,xt.y),bt=ke.next,Ue=xt.prev;return ke.next=xt,xt.prev=ke,Ae.next=bt,bt.prev=Ae,pt.next=Ae,Ae.prev=pt,Ue.next=pt,pt.prev=Ue,pt}function Ze(ke,xt,Ae,pt){var bt=new Jt(ke,xt,Ae);return pt?(bt.next=pt.next,bt.prev=pt,pt.next.prev=bt,pt.next=bt):(bt.prev=bt,bt.next=bt),bt}function Ee(ke){ke.next.prev=ke.prev,ke.prev.next=ke.next,ke.prevZ&&(ke.prevZ.nextZ=ke.nextZ),ke.nextZ&&(ke.nextZ.prevZ=ke.prevZ)}function Jt(ke,xt,Ae){this.i=ke,this.x=xt,this.y=Ae,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Nt(ke,xt,Ae,pt){for(var bt=0,Ue=xt,Wt=Ae-pt;Ue<Ae;Ue+=pt)bt+=(ke[Wt]-ke[Ue])*(ke[Ue+1]+ke[Wt+1]),Wt=Ue;return bt}Mt.exports=Ye,Mt.exports.default=Ye,Ye.deviation=function(ke,xt,Ae,pt){var bt=xt&&xt.length,Wt=Math.abs(Nt(ke,0,bt?xt[0]*Ae:ke.length,Ae));if(bt)for(var Vt=0,Cr=xt.length;Vt<Cr;Vt++)Wt-=Math.abs(Nt(ke,xt[Vt]*Ae,Vt<Cr-1?xt[Vt+1]*Ae:ke.length,Ae));var Fr=0;for(Vt=0;Vt<pt.length;Vt+=3){var zr=pt[Vt]*Ae,rn=pt[Vt+1]*Ae,Ar=pt[Vt+2]*Ae;Fr+=Math.abs((ke[zr]-ke[Ar])*(ke[rn+1]-ke[zr+1])-(ke[zr]-ke[rn])*(ke[Ar+1]-ke[zr+1]))}return 0===Wt&&0===Fr?0:Math.abs((Fr-Wt)/Wt)},Ye.flatten=function(ke){for(var xt=ke[0][0].length,Ae={vertices:[],holes:[],dimensions:xt},pt=0,bt=0;bt<ke.length;bt++){for(var Ue=0;Ue<ke[bt].length;Ue++)for(var Wt=0;Wt<xt;Wt++)Ae.vertices.push(ke[bt][Ue][Wt]);bt>0&&Ae.holes.push(pt+=ke[bt-1].length)}return Ae}},9069:Mt=>{"use strict";var ae,Ye="object"==typeof Reflect?Reflect:null,ue=Ye&&"function"==typeof Ye.apply?Ye.apply:function(ie,ne,se){return Function.prototype.apply.call(ie,ne,se)};ae=Ye&&"function"==typeof Ye.ownKeys?Ye.ownKeys:Object.getOwnPropertySymbols?function(ie){return Object.getOwnPropertyNames(ie).concat(Object.getOwnPropertySymbols(ie))}:function(ie){return Object.getOwnPropertyNames(ie)};var b=Number.isNaN||function(ie){return ie!=ie};function c(){c.init.call(this)}Mt.exports=c,Mt.exports.once=function q(ee,ie){return new Promise(function(ne,se){function he(nt){ee.removeListener(ie,re),se(nt)}function re(){"function"==typeof ee.removeListener&&ee.removeListener("error",he),ne([].slice.call(arguments))}X(ee,ie,re,{once:!0}),"error"!==ie&&function K(ee,ie,ne){"function"==typeof ee.on&&X(ee,"error",ie,ne)}(ee,he,{once:!0})})},c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var Z=10;function ce(ee){if("function"!=typeof ee)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof ee)}function be(ee){return void 0===ee._maxListeners?c.defaultMaxListeners:ee._maxListeners}function ye(ee,ie,ne,se){var he,re,nt;if(ce(ne),void 0===(re=ee._events)?(re=ee._events=Object.create(null),ee._eventsCount=0):(void 0!==re.newListener&&(ee.emit("newListener",ie,ne.listener?ne.listener:ne),re=ee._events),nt=re[ie]),void 0===nt)nt=re[ie]=ne,++ee._eventsCount;else if("function"==typeof nt?nt=re[ie]=se?[ne,nt]:[nt,ne]:se?nt.unshift(ne):nt.push(ne),(he=be(ee))>0&&nt.length>he&&!nt.warned){nt.warned=!0;var ze=new Error("Possible EventEmitter memory leak detected. "+nt.length+" "+String(ie)+" listeners added. Use emitter.setMaxListeners() to increase limit");ze.name="MaxListenersExceededWarning",ze.emitter=ee,ze.type=ie,ze.count=nt.length,function pe(ee){console&&console.warn&&console.warn(ee)}(ze)}return ee}function Te(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function $e(ee,ie,ne){var se={fired:!1,wrapFn:void 0,target:ee,type:ie,listener:ne},he=Te.bind(se);return he.listener=ne,se.wrapFn=he,he}function xe(ee,ie,ne){var se=ee._events;if(void 0===se)return[];var he=se[ie];return void 0===he?[]:"function"==typeof he?ne?[he.listener||he]:[he]:ne?function H(ee){for(var ie=new Array(ee.length),ne=0;ne<ie.length;++ne)ie[ne]=ee[ne].listener||ee[ne];return ie}(he):Oe(he,he.length)}function ge(ee){var ie=this._events;if(void 0!==ie){var ne=ie[ee];if("function"==typeof ne)return 1;if(void 0!==ne)return ne.length}return 0}function Oe(ee,ie){for(var ne=new Array(ie),se=0;se<ie;++se)ne[se]=ee[se];return ne}function X(ee,ie,ne,se){if("function"==typeof ee.on)se.once?ee.once(ie,ne):ee.on(ie,ne);else{if("function"!=typeof ee.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof ee);ee.addEventListener(ie,function he(re){se.once&&ee.removeEventListener(ie,he),ne(re)})}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return Z},set:function(ee){if("number"!=typeof ee||ee<0||b(ee))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+ee+".");Z=ee}}),c.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(ie){if("number"!=typeof ie||ie<0||b(ie))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+ie+".");return this._maxListeners=ie,this},c.prototype.getMaxListeners=function(){return be(this)},c.prototype.emit=function(ie){for(var ne=[],se=1;se<arguments.length;se++)ne.push(arguments[se]);var he="error"===ie,re=this._events;if(void 0!==re)he=he&&void 0===re.error;else if(!he)return!1;if(he){var nt;if(ne.length>0&&(nt=ne[0]),nt instanceof Error)throw nt;var ze=new Error("Unhandled error."+(nt?" ("+nt.message+")":""));throw ze.context=nt,ze}var Ze=re[ie];if(void 0===Ze)return!1;if("function"==typeof Ze)ue(Ze,this,ne);else{var Ee=Ze.length,Jt=Oe(Ze,Ee);for(se=0;se<Ee;++se)ue(Jt[se],this,ne)}return!0},c.prototype.on=c.prototype.addListener=function(ie,ne){return ye(this,ie,ne,!1)},c.prototype.prependListener=function(ie,ne){return ye(this,ie,ne,!0)},c.prototype.once=function(ie,ne){return ce(ne),this.on(ie,$e(this,ie,ne)),this},c.prototype.prependOnceListener=function(ie,ne){return ce(ne),this.prependListener(ie,$e(this,ie,ne)),this},c.prototype.off=c.prototype.removeListener=function(ie,ne){var se,he,re,nt,ze;if(ce(ne),void 0===(he=this._events))return this;if(void 0===(se=he[ie]))return this;if(se===ne||se.listener===ne)0==--this._eventsCount?this._events=Object.create(null):(delete he[ie],he.removeListener&&this.emit("removeListener",ie,se.listener||ne));else if("function"!=typeof se){for(re=-1,nt=se.length-1;nt>=0;nt--)if(se[nt]===ne||se[nt].listener===ne){ze=se[nt].listener,re=nt;break}if(re<0)return this;0===re?se.shift():function We(ee,ie){for(;ie+1<ee.length;ie++)ee[ie]=ee[ie+1];ee.pop()}(se,re),1===se.length&&(he[ie]=se[0]),void 0!==he.removeListener&&this.emit("removeListener",ie,ze||ne)}return this},c.prototype.removeAllListeners=function(ie){var ne,se,he;if(void 0===(se=this._events))return this;if(void 0===se.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==se[ie]&&(0==--this._eventsCount?this._events=Object.create(null):delete se[ie]),this;if(0===arguments.length){var nt,re=Object.keys(se);for(he=0;he<re.length;++he)"removeListener"!==(nt=re[he])&&this.removeAllListeners(nt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(ne=se[ie]))this.removeListener(ie,ne);else if(void 0!==ne)for(he=ne.length-1;he>=0;he--)this.removeListener(ie,ne[he]);return this},c.prototype.listeners=function(ie){return xe(this,ie,!0)},c.prototype.rawListeners=function(ie){return xe(this,ie,!1)},c.listenerCount=function(ee,ie){return"function"==typeof ee.listenerCount?ee.listenerCount(ie):ge.call(ee,ie)},c.prototype.listenerCount=ge,c.prototype.eventNames=function(){return this._eventsCount>0?ae(this._events):[]}},3457:Mt=>{"use strict";var Ye="Function.prototype.bind called on incompatible ",ue=Array.prototype.slice,ae=Object.prototype.toString,pe="[object Function]";Mt.exports=function(c){var Z=this;if("function"!=typeof Z||ae.call(Z)!==pe)throw new TypeError(Ye+Z);for(var be,ce=ue.call(arguments,1),ye=function(){if(this instanceof be){var Oe=Z.apply(this,ce.concat(ue.call(arguments)));return Object(Oe)===Oe?Oe:this}return Z.apply(c,ce.concat(ue.call(arguments)))},Te=Math.max(0,Z.length-ce.length),$e=[],xe=0;xe<Te;xe++)$e.push("$"+xe);if(be=Function("binder","return function ("+$e.join(",")+"){ return binder.apply(this,arguments); }")(ye),Z.prototype){var ge=function(){};ge.prototype=Z.prototype,be.prototype=new ge,ge.prototype=null}return be}},4444:(Mt,Ye,ue)=>{"use strict";var ae=ue(3457);Mt.exports=Function.prototype.bind||ae},9582:Mt=>{"use strict";var Ye=function(){return"string"==typeof function(){}.name},ue=Object.getOwnPropertyDescriptor;if(ue)try{ue([],"length")}catch{ue=null}Ye.functionsHaveConfigurableNames=function(){if(!Ye()||!ue)return!1;var b=ue(function(){},"name");return!!b&&!!b.configurable};var ae=Function.prototype.bind;Ye.boundFunctionsHaveNames=function(){return Ye()&&"function"==typeof ae&&""!==function(){}.bind().name},Mt.exports=Ye},5780:Mt=>{var ue;Mt.exports=ue={},ue.simpleFilter=function(ae,pe){return pe.filter(function(b){return ue.test(ae,b)})},ue.test=function(ae,pe){return null!==ue.match(ae,pe)},ue.match=function(ae,pe,b){var ge,c=0,Z=[],ce=pe.length,be=0,ye=0,Te=(b=b||{}).pre||"",$e=b.post||"",xe=b.caseSensitive&&pe||pe.toLowerCase();ae=b.caseSensitive&&ae||ae.toLowerCase();for(var Oe=0;Oe<ce;Oe++)ge=pe[Oe],xe[Oe]===ae[c]?(ge=Te+ge+$e,c+=1,ye+=1+ye):ye=0,be+=ye,Z[Z.length]=ge;return c===ae.length?(be=xe===ae?1/0:be,{rendered:Z.join(""),score:be}):null},ue.filter=function(ae,pe,b){return pe&&0!==pe.length?"string"!=typeof ae?pe:(b=b||{},pe.reduce(function(c,Z,ce,be){var ye=Z;b.extract&&(ye=b.extract(Z));var Te=ue.match(ae,ye,b);return null!=Te&&(c[c.length]={string:Te.rendered,score:Te.score,index:ce,original:Z}),c},[]).sort(function(c,Z){return Z.score-c.score||c.index-Z.index})):[]}},5013:(Mt,Ye,ue)=>{var ae=ue(6952),pe=function(ce){this.precision=ce&&ce.precision?ce.precision:17,this.direction=!(!ce||!ce.direction)&&ce.direction,this.pseudoNode=!(!ce||!ce.pseudoNode)&&ce.pseudoNode,this.objectComparator=ce&&ce.objectComparator?ce.objectComparator:Z};function b(ce){return ce.coordinates.map(function(be){return{type:ce.type.replace("Multi",""),coordinates:be}})}function c(ce,be){return ce.hasOwnProperty("coordinates")?ce.coordinates.length===be.coordinates.length:ce.length===be.length}function Z(ce,be){return ae(ce,be,{strict:!0})}pe.prototype.compare=function(ce,be){if(ce.type!==be.type||!c(ce,be))return!1;switch(ce.type){case"Point":return this.compareCoord(ce.coordinates,be.coordinates);case"LineString":return this.compareLine(ce.coordinates,be.coordinates,0,!1);case"Polygon":return this.comparePolygon(ce,be);case"Feature":return this.compareFeature(ce,be);default:if(0===ce.type.indexOf("Multi")){var ye=this,Te=b(ce),$e=b(be);return Te.every(function(xe){return this.some(function(ge){return ye.compare(xe,ge)})},$e)}}return!1},pe.prototype.compareCoord=function(ce,be){if(ce.length!==be.length)return!1;for(var ye=0;ye<ce.length;ye++)if(ce[ye].toFixed(this.precision)!==be[ye].toFixed(this.precision))return!1;return!0},pe.prototype.compareLine=function(ce,be,ye,Te){if(!c(ce,be))return!1;var $e=this.pseudoNode?ce:this.removePseudo(ce),xe=this.pseudoNode?be:this.removePseudo(be);if(!Te||this.compareCoord($e[0],xe[0])||(xe=this.fixStartIndex(xe,$e))){var ge=this.compareCoord($e[ye],xe[ye]);return this.direction||ge?this.comparePath($e,xe):!!this.compareCoord($e[ye],xe[xe.length-(1+ye)])&&this.comparePath($e.slice().reverse(),xe)}},pe.prototype.fixStartIndex=function(ce,be){for(var ye,Te=-1,$e=0;$e<ce.length;$e++)if(this.compareCoord(ce[$e],be[0])){Te=$e;break}return Te>=0&&(ye=[].concat(ce.slice(Te,ce.length),ce.slice(1,Te+1))),ye},pe.prototype.comparePath=function(ce,be){var ye=this;return ce.every(function(Te,$e){return ye.compareCoord(Te,this[$e])},be)},pe.prototype.comparePolygon=function(ce,be){if(this.compareLine(ce.coordinates[0],be.coordinates[0],1,!0)){var ye=ce.coordinates.slice(1,ce.coordinates.length),Te=be.coordinates.slice(1,be.coordinates.length),$e=this;return ye.every(function(xe){return this.some(function(ge){return $e.compareLine(xe,ge,1,!0)})},Te)}return!1},pe.prototype.compareFeature=function(ce,be){return!(ce.id!==be.id||!this.objectComparator(ce.properties,be.properties)||!this.compareBBox(ce,be))&&this.compare(ce.geometry,be.geometry)},pe.prototype.compareBBox=function(ce,be){return!!(!ce.bbox&&!be.bbox||ce.bbox&&be.bbox&&this.compareCoord(ce.bbox,be.bbox))},pe.prototype.removePseudo=function(ce){return ce},Mt.exports=pe},5406:(Mt,Ye,ue)=>{var ae=ue(7192),pe=ue(8275),b=ue(9626),c=ue(1503).Z,Z=b.featureEach,ye=pe.featureCollection;function Te($e){var xe=new ae($e);return xe.insert=function(ge){if("Feature"!==ge.type)throw new Error("invalid feature");return ge.bbox=ge.bbox?ge.bbox:c(ge),ae.prototype.insert.call(this,ge)},xe.load=function(ge){var Oe=[];return Array.isArray(ge)?ge.forEach(function(We){if("Feature"!==We.type)throw new Error("invalid features");We.bbox=We.bbox?We.bbox:c(We),Oe.push(We)}):Z(ge,function(We){if("Feature"!==We.type)throw new Error("invalid features");We.bbox=We.bbox?We.bbox:c(We),Oe.push(We)}),ae.prototype.load.call(this,Oe)},xe.remove=function(ge,Oe){if("Feature"!==ge.type)throw new Error("invalid feature");return ge.bbox=ge.bbox?ge.bbox:c(ge),ae.prototype.remove.call(this,ge,Oe)},xe.clear=function(){return ae.prototype.clear.call(this)},xe.search=function(ge){var Oe=ae.prototype.search.call(this,this.toBBox(ge));return ye(Oe)},xe.collides=function(ge){return ae.prototype.collides.call(this,this.toBBox(ge))},xe.all=function(){var ge=ae.prototype.all.call(this);return ye(ge)},xe.toJSON=function(){return ae.prototype.toJSON.call(this)},xe.fromJSON=function(ge){return ae.prototype.fromJSON.call(this,ge)},xe.toBBox=function(ge){var Oe;if(ge.bbox)Oe=ge.bbox;else if(Array.isArray(ge)&&4===ge.length)Oe=ge;else if(Array.isArray(ge)&&6===ge.length)Oe=[ge[0],ge[1],ge[3],ge[4]];else if("Feature"===ge.type)Oe=c(ge);else{if("FeatureCollection"!==ge.type)throw new Error("invalid geojson");Oe=c(ge)}return{minX:Oe[0],minY:Oe[1],maxX:Oe[2],maxY:Oe[3]}},xe}Mt.exports=Te,Mt.exports.default=Te},7192:function(Mt){Mt.exports=function(){"use strict";function Ye(H,q,K,X,ee){!function ie(ne,se,he,re,nt){for(;re>he;){if(re-he>600){var ze=re-he+1,Ze=se-he+1,Ee=Math.log(ze),Jt=.5*Math.exp(2*Ee/3),Nt=.5*Math.sqrt(Ee*Jt*(ze-Jt)/ze)*(Ze-ze/2<0?-1:1);ie(ne,se,Math.max(he,Math.floor(se-Ze*Jt/ze+Nt)),Math.min(re,Math.floor(se+(ze-Ze)*Jt/ze+Nt)),nt)}var Ae=ne[se],pt=he,bt=re;for(ue(ne,he,se),nt(ne[re],Ae)>0&&ue(ne,he,re);pt<bt;){for(ue(ne,pt,bt),pt++,bt--;nt(ne[pt],Ae)<0;)pt++;for(;nt(ne[bt],Ae)>0;)bt--}0===nt(ne[he],Ae)?ue(ne,he,bt):ue(ne,++bt,re),bt<=se&&(he=bt+1),se<=bt&&(re=bt-1)}}(H,q,K||0,X||H.length-1,ee||ae)}function ue(H,q,K){var X=H[q];H[q]=H[K],H[K]=X}function ae(H,q){return H<q?-1:H>q?1:0}var pe=function(H){void 0===H&&(H=9),this._maxEntries=Math.max(4,H),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function b(H,q,K){if(!K)return q.indexOf(H);for(var X=0;X<q.length;X++)if(K(H,q[X]))return X;return-1}function c(H,q){Z(H,0,H.children.length,q,H)}function Z(H,q,K,X,ee){ee||(ee=Oe(null)),ee.minX=1/0,ee.minY=1/0,ee.maxX=-1/0,ee.maxY=-1/0;for(var ie=q;ie<K;ie++){var ne=H.children[ie];ce(ee,H.leaf?X(ne):ne)}return ee}function ce(H,q){return H.minX=Math.min(H.minX,q.minX),H.minY=Math.min(H.minY,q.minY),H.maxX=Math.max(H.maxX,q.maxX),H.maxY=Math.max(H.maxY,q.maxY),H}function be(H,q){return H.minX-q.minX}function ye(H,q){return H.minY-q.minY}function Te(H){return(H.maxX-H.minX)*(H.maxY-H.minY)}function $e(H){return H.maxX-H.minX+(H.maxY-H.minY)}function xe(H,q){return H.minX<=q.minX&&H.minY<=q.minY&&q.maxX<=H.maxX&&q.maxY<=H.maxY}function ge(H,q){return q.minX<=H.maxX&&q.minY<=H.maxY&&q.maxX>=H.minX&&q.maxY>=H.minY}function Oe(H){return{children:H,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function We(H,q,K,X,ee){for(var ie=[q,K];ie.length;)if(!((K=ie.pop())-(q=ie.pop())<=X)){var ne=q+Math.ceil((K-q)/X/2)*X;Ye(H,ne,q,K,ee),ie.push(q,ne,ne,K)}}return pe.prototype.all=function(){return this._all(this.data,[])},pe.prototype.search=function(H){var q=this.data,K=[];if(!ge(H,q))return K;for(var X=this.toBBox,ee=[];q;){for(var ie=0;ie<q.children.length;ie++){var ne=q.children[ie],se=q.leaf?X(ne):ne;ge(H,se)&&(q.leaf?K.push(ne):xe(H,se)?this._all(ne,K):ee.push(ne))}q=ee.pop()}return K},pe.prototype.collides=function(H){var q=this.data;if(!ge(H,q))return!1;for(var K=[];q;){for(var X=0;X<q.children.length;X++){var ee=q.children[X],ie=q.leaf?this.toBBox(ee):ee;if(ge(H,ie)){if(q.leaf||xe(H,ie))return!0;K.push(ee)}}q=K.pop()}return!1},pe.prototype.load=function(H){if(!H||!H.length)return this;if(H.length<this._minEntries){for(var q=0;q<H.length;q++)this.insert(H[q]);return this}var K=this._build(H.slice(),0,H.length-1,0);if(this.data.children.length)if(this.data.height===K.height)this._splitRoot(this.data,K);else{if(this.data.height<K.height){var X=this.data;this.data=K,K=X}this._insert(K,this.data.height-K.height-1,!0)}else this.data=K;return this},pe.prototype.insert=function(H){return H&&this._insert(H,this.data.height-1),this},pe.prototype.clear=function(){return this.data=Oe([]),this},pe.prototype.remove=function(H,q){if(!H)return this;for(var K,X,ee,ie=this.data,ne=this.toBBox(H),se=[],he=[];ie||se.length;){if(ie||(ie=se.pop(),X=se[se.length-1],K=he.pop(),ee=!0),ie.leaf){var re=b(H,ie.children,q);if(-1!==re)return ie.children.splice(re,1),se.push(ie),this._condense(se),this}ee||ie.leaf||!xe(ie,ne)?X?(K++,ie=X.children[K],ee=!1):ie=null:(se.push(ie),he.push(K),K=0,X=ie,ie=ie.children[0])}return this},pe.prototype.toBBox=function(H){return H},pe.prototype.compareMinX=function(H,q){return H.minX-q.minX},pe.prototype.compareMinY=function(H,q){return H.minY-q.minY},pe.prototype.toJSON=function(){return this.data},pe.prototype.fromJSON=function(H){return this.data=H,this},pe.prototype._all=function(H,q){for(var K=[];H;)H.leaf?q.push.apply(q,H.children):K.push.apply(K,H.children),H=K.pop();return q},pe.prototype._build=function(H,q,K,X){var ee,ie=K-q+1,ne=this._maxEntries;if(ie<=ne)return c(ee=Oe(H.slice(q,K+1)),this.toBBox),ee;X||(X=Math.ceil(Math.log(ie)/Math.log(ne)),ne=Math.ceil(ie/Math.pow(ne,X-1))),(ee=Oe([])).leaf=!1,ee.height=X;var se=Math.ceil(ie/ne),he=se*Math.ceil(Math.sqrt(ne));We(H,q,K,he,this.compareMinX);for(var re=q;re<=K;re+=he){var nt=Math.min(re+he-1,K);We(H,re,nt,se,this.compareMinY);for(var ze=re;ze<=nt;ze+=se){var Ze=Math.min(ze+se-1,nt);ee.children.push(this._build(H,ze,Ze,X-1))}}return c(ee,this.toBBox),ee},pe.prototype._chooseSubtree=function(H,q,K,X){for(;X.push(q),!q.leaf&&X.length-1!==K;){for(var ee=1/0,ie=1/0,ne=void 0,se=0;se<q.children.length;se++){var he=q.children[se],re=Te(he),nt=(ze=H,Ze=he,(Math.max(Ze.maxX,ze.maxX)-Math.min(Ze.minX,ze.minX))*(Math.max(Ze.maxY,ze.maxY)-Math.min(Ze.minY,ze.minY))-re);nt<ie?(ie=nt,ee=re<ee?re:ee,ne=he):nt===ie&&re<ee&&(ee=re,ne=he)}q=ne||q.children[0]}var ze,Ze;return q},pe.prototype._insert=function(H,q,K){var X=K?H:this.toBBox(H),ee=[],ie=this._chooseSubtree(X,this.data,q,ee);for(ie.children.push(H),ce(ie,X);q>=0&&ee[q].children.length>this._maxEntries;)this._split(ee,q),q--;this._adjustParentBBoxes(X,ee,q)},pe.prototype._split=function(H,q){var K=H[q],X=K.children.length,ee=this._minEntries;this._chooseSplitAxis(K,ee,X);var ie=this._chooseSplitIndex(K,ee,X),ne=Oe(K.children.splice(ie,K.children.length-ie));ne.height=K.height,ne.leaf=K.leaf,c(K,this.toBBox),c(ne,this.toBBox),q?H[q-1].children.push(ne):this._splitRoot(K,ne)},pe.prototype._splitRoot=function(H,q){this.data=Oe([H,q]),this.data.height=H.height+1,this.data.leaf=!1,c(this.data,this.toBBox)},pe.prototype._chooseSplitIndex=function(H,q,K){for(var X,ee,ie,ne,se,he,re,nt=1/0,ze=1/0,Ze=q;Ze<=K-q;Ze++){var Ee=Z(H,0,Ze,this.toBBox),Jt=Z(H,Ze,K,this.toBBox),Nt=(ee=Ee,ie=Jt,void 0,void 0,void 0,void 0,ne=Math.max(ee.minX,ie.minX),se=Math.max(ee.minY,ie.minY),he=Math.min(ee.maxX,ie.maxX),re=Math.min(ee.maxY,ie.maxY),Math.max(0,he-ne)*Math.max(0,re-se)),ke=Te(Ee)+Te(Jt);Nt<nt?(nt=Nt,X=Ze,ze=ke<ze?ke:ze):Nt===nt&&ke<ze&&(ze=ke,X=Ze)}return X||K-q},pe.prototype._chooseSplitAxis=function(H,q,K){var X=H.leaf?this.compareMinX:be,ee=H.leaf?this.compareMinY:ye;this._allDistMargin(H,q,K,X)<this._allDistMargin(H,q,K,ee)&&H.children.sort(X)},pe.prototype._allDistMargin=function(H,q,K,X){H.children.sort(X);for(var ee=this.toBBox,ie=Z(H,0,q,ee),ne=Z(H,K-q,K,ee),se=$e(ie)+$e(ne),he=q;he<K-q;he++){var re=H.children[he];ce(ie,H.leaf?ee(re):re),se+=$e(ie)}for(var nt=K-q-1;nt>=q;nt--){var ze=H.children[nt];ce(ne,H.leaf?ee(ze):ze),se+=$e(ne)}return se},pe.prototype._adjustParentBBoxes=function(H,q,K){for(var X=K;X>=0;X--)ce(q[X],H)},pe.prototype._condense=function(H){for(var q=H.length-1,K=void 0;q>=0;q--)0===H[q].children.length?q>0?(K=H[q-1].children).splice(K.indexOf(H[q]),1):this.clear():c(H[q],this.toBBox)},pe}()},5203:(Mt,Ye,ue)=>{"use strict";var ae,pe=SyntaxError,b=Function,c=TypeError,Z=function(Ee){try{return b('"use strict"; return ('+Ee+").constructor;")()}catch{}},ce=Object.getOwnPropertyDescriptor;if(ce)try{ce({},"")}catch{ce=null}var be=function(){throw new c},ye=ce?function(){try{return be}catch{try{return ce(arguments,"callee").get}catch{return be}}}():be,Te=ue(2969)(),$e=Object.getPrototypeOf||function(Ee){return Ee.__proto__},xe={},ge=typeof Uint8Array>"u"?ae:$e(Uint8Array),Oe={"%AggregateError%":typeof AggregateError>"u"?ae:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?ae:ArrayBuffer,"%ArrayIteratorPrototype%":Te?$e([][Symbol.iterator]()):ae,"%AsyncFromSyncIteratorPrototype%":ae,"%AsyncFunction%":xe,"%AsyncGenerator%":xe,"%AsyncGeneratorFunction%":xe,"%AsyncIteratorPrototype%":xe,"%Atomics%":typeof Atomics>"u"?ae:Atomics,"%BigInt%":typeof BigInt>"u"?ae:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?ae:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?ae:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?ae:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?ae:Float32Array,"%Float64Array%":typeof Float64Array>"u"?ae:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?ae:FinalizationRegistry,"%Function%":b,"%GeneratorFunction%":xe,"%Int8Array%":typeof Int8Array>"u"?ae:Int8Array,"%Int16Array%":typeof Int16Array>"u"?ae:Int16Array,"%Int32Array%":typeof Int32Array>"u"?ae:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Te?$e($e([][Symbol.iterator]())):ae,"%JSON%":"object"==typeof JSON?JSON:ae,"%Map%":typeof Map>"u"?ae:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Te?ae:$e((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?ae:Promise,"%Proxy%":typeof Proxy>"u"?ae:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?ae:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?ae:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Te?ae:$e((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?ae:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Te?$e(""[Symbol.iterator]()):ae,"%Symbol%":Te?Symbol:ae,"%SyntaxError%":pe,"%ThrowTypeError%":ye,"%TypedArray%":ge,"%TypeError%":c,"%Uint8Array%":typeof Uint8Array>"u"?ae:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?ae:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?ae:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?ae:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?ae:WeakMap,"%WeakRef%":typeof WeakRef>"u"?ae:WeakRef,"%WeakSet%":typeof WeakSet>"u"?ae:WeakSet};try{null.error}catch(Ee){var We=$e($e(Ee));Oe["%Error.prototype%"]=We}var H=function Ee(Jt){var Nt;if("%AsyncFunction%"===Jt)Nt=Z("async function () {}");else if("%GeneratorFunction%"===Jt)Nt=Z("function* () {}");else if("%AsyncGeneratorFunction%"===Jt)Nt=Z("async function* () {}");else if("%AsyncGenerator%"===Jt){var ke=Ee("%AsyncGeneratorFunction%");ke&&(Nt=ke.prototype)}else if("%AsyncIteratorPrototype%"===Jt){var xt=Ee("%AsyncGenerator%");xt&&(Nt=$e(xt.prototype))}return Oe[Jt]=Nt,Nt},q={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},K=ue(4444),X=ue(3164),ee=K.call(Function.call,Array.prototype.concat),ie=K.call(Function.apply,Array.prototype.splice),ne=K.call(Function.call,String.prototype.replace),se=K.call(Function.call,String.prototype.slice),he=K.call(Function.call,RegExp.prototype.exec),re=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,nt=/\\(\\)?/g,ze=function(Jt){var Nt=se(Jt,0,1),ke=se(Jt,-1);if("%"===Nt&&"%"!==ke)throw new pe("invalid intrinsic syntax, expected closing `%`");if("%"===ke&&"%"!==Nt)throw new pe("invalid intrinsic syntax, expected opening `%`");var xt=[];return ne(Jt,re,function(Ae,pt,bt,Ue){xt[xt.length]=bt?ne(Ue,nt,"$1"):pt||Ae}),xt},Ze=function(Jt,Nt){var xt,ke=Jt;if(X(q,ke)&&(ke="%"+(xt=q[ke])[0]+"%"),X(Oe,ke)){var Ae=Oe[ke];if(Ae===xe&&(Ae=H(ke)),typeof Ae>"u"&&!Nt)throw new c("intrinsic "+Jt+" exists, but is not available. Please file an issue!");return{alias:xt,name:ke,value:Ae}}throw new pe("intrinsic "+Jt+" does not exist!")};Mt.exports=function(Jt,Nt){if("string"!=typeof Jt||0===Jt.length)throw new c("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof Nt)throw new c('"allowMissing" argument must be a boolean');if(null===he(/^%?[^%]*%?$/,Jt))throw new pe("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var ke=ze(Jt),xt=ke.length>0?ke[0]:"",Ae=Ze("%"+xt+"%",Nt),pt=Ae.name,bt=Ae.value,Ue=!1,Wt=Ae.alias;Wt&&(xt=Wt[0],ie(ke,ee([0,1],Wt)));for(var Vt=1,Cr=!0;Vt<ke.length;Vt+=1){var Ft=ke[Vt],Ur=se(Ft,0,1),Fr=se(Ft,-1);if(('"'===Ur||"'"===Ur||"`"===Ur||'"'===Fr||"'"===Fr||"`"===Fr)&&Ur!==Fr)throw new pe("property names with quotes must have matching quotes");if(("constructor"===Ft||!Cr)&&(Ue=!0),X(Oe,pt="%"+(xt+="."+Ft)+"%"))bt=Oe[pt];else if(null!=bt){if(!(Ft in bt)){if(!Nt)throw new c("base intrinsic for "+Jt+" exists, but the property is not available.");return}if(ce&&Vt+1>=ke.length){var zr=ce(bt,Ft);bt=(Cr=!!zr)&&"get"in zr&&!("originalValue"in zr.get)?zr.get:bt[Ft]}else Cr=X(bt,Ft),bt=bt[Ft];Cr&&!Ue&&(Oe[pt]=bt)}}return bt}},7027:(Mt,Ye,ue)=>{"use strict";var pe=ue(5203)("%Object.defineProperty%",!0),b=function(){if(pe)try{return pe({},"a",{value:1}),!0}catch{return!1}return!1};b.hasArrayLengthDefineBug=function(){if(!b())return null;try{return 1!==pe([],"length",{value:1}).length}catch{return!0}},Mt.exports=b},2969:(Mt,Ye,ue)=>{"use strict";var ae=typeof Symbol<"u"&&Symbol,pe=ue(1983);Mt.exports=function(){return"function"==typeof ae&&"function"==typeof Symbol&&"symbol"==typeof ae("foo")&&"symbol"==typeof Symbol("bar")&&pe()}},1983:Mt=>{"use strict";Mt.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var ue={},ae=Symbol("test"),pe=Object(ae);if("string"==typeof ae||"[object Symbol]"!==Object.prototype.toString.call(ae)||"[object Symbol]"!==Object.prototype.toString.call(pe))return!1;for(ae in ue[ae]=42,ue)return!1;if("function"==typeof Object.keys&&0!==Object.keys(ue).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(ue).length)return!1;var c=Object.getOwnPropertySymbols(ue);if(1!==c.length||c[0]!==ae||!Object.prototype.propertyIsEnumerable.call(ue,ae))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var Z=Object.getOwnPropertyDescriptor(ue,ae);if(42!==Z.value||!0!==Z.enumerable)return!1}return!0}},6259:(Mt,Ye,ue)=>{"use strict";var ae=ue(1983);Mt.exports=function(){return ae()&&!!Symbol.toStringTag}},3164:(Mt,Ye,ue)=>{"use strict";var ae=ue(4444);Mt.exports=ae.call(Function.call,Object.prototype.hasOwnProperty)},3407:(Mt,Ye,ue)=>{"use strict";var ae=ue(6259)(),b=ue(5834)("Object.prototype.toString"),c=function(ye){return!(ae&&ye&&"object"==typeof ye&&Symbol.toStringTag in ye)&&"[object Arguments]"===b(ye)},Z=function(ye){return!!c(ye)||null!==ye&&"object"==typeof ye&&"number"==typeof ye.length&&ye.length>=0&&"[object Array]"!==b(ye)&&"[object Function]"===b(ye.callee)},ce=function(){return c(arguments)}();c.isLegacyArguments=Z,Mt.exports=ce?c:Z},2374:(Mt,Ye,ue)=>{"use strict";var ae=Date.prototype.getDay,b=Object.prototype.toString,Z=ue(6259)();Mt.exports=function(be){return"object"==typeof be&&null!==be&&(Z?function(be){try{return ae.call(be),!0}catch{return!1}}(be):"[object Date]"===b.call(be))}},2342:(Mt,Ye,ue)=>{"use strict";var b,c,Z,ce,ae=ue(5834),pe=ue(6259)();if(pe){b=ae("Object.prototype.hasOwnProperty"),c=ae("RegExp.prototype.exec"),Z={};var be=function(){throw Z};ce={toString:be,valueOf:be},"symbol"==typeof Symbol.toPrimitive&&(ce[Symbol.toPrimitive]=be)}var ye=ae("Object.prototype.toString"),Te=Object.getOwnPropertyDescriptor;Mt.exports=pe?function(ge){if(!ge||"object"!=typeof ge)return!1;var Oe=Te(ge,"lastIndex");if(!Oe||!b(Oe,"value"))return!1;try{c(ge,ce)}catch(H){return H===Z}}:function(ge){return!(!ge||"object"!=typeof ge&&"function"!=typeof ge)&&"[object RegExp]"===ye(ge)}},3082:Mt=>{var pe=/^\s+|\s+$/g,b=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,Z=/^0o[0-7]+$/i,ce=parseInt,be="object"==typeof global&&global&&global.Object===Object&&global,ye="object"==typeof self&&self&&self.Object===Object&&self,Te=be||ye||Function("return this")(),xe=Object.prototype.toString,ge=Math.max,Oe=Math.min,We=function(){return Te.Date.now()};function q(ie){var ne=typeof ie;return!!ie&&("object"==ne||"function"==ne)}function ee(ie){if("number"==typeof ie)return ie;if(function X(ie){return"symbol"==typeof ie||function K(ie){return!!ie&&"object"==typeof ie}(ie)&&"[object Symbol]"==xe.call(ie)}(ie))return NaN;if(q(ie)){var ne="function"==typeof ie.valueOf?ie.valueOf():ie;ie=q(ne)?ne+"":ne}if("string"!=typeof ie)return 0===ie?ie:+ie;ie=ie.replace(pe,"");var se=c.test(ie);return se||Z.test(ie)?ce(ie.slice(2),se?2:8):b.test(ie)?NaN:+ie}Mt.exports=function H(ie,ne,se){var he,re,nt,ze,Ze,Ee,Jt=0,Nt=!1,ke=!1,xt=!0;if("function"!=typeof ie)throw new TypeError("Expected a function");function Ae(Fr){var zr=he,rn=re;return he=re=void 0,Jt=Fr,ze=ie.apply(rn,zr)}function pt(Fr){return Jt=Fr,Ze=setTimeout(Wt,ne),Nt?Ae(Fr):ze}function Ue(Fr){var zr=Fr-Ee;return void 0===Ee||zr>=ne||zr<0||ke&&Fr-Jt>=nt}function Wt(){var Fr=We();if(Ue(Fr))return Vt(Fr);Ze=setTimeout(Wt,function bt(Fr){var Ar=ne-(Fr-Ee);return ke?Oe(Ar,nt-(Fr-Jt)):Ar}(Fr))}function Vt(Fr){return Ze=void 0,xt&&he?Ae(Fr):(he=re=void 0,ze)}function Ur(){var Fr=We(),zr=Ue(Fr);if(he=arguments,re=this,Ee=Fr,zr){if(void 0===Ze)return pt(Ee);if(ke)return Ze=setTimeout(Wt,ne),Ae(Ee)}return void 0===Ze&&(Ze=setTimeout(Wt,ne)),ze}return ne=ee(ne)||0,q(se)&&(Nt=!!se.leading,nt=(ke="maxWait"in se)?ge(ee(se.maxWait)||0,ne):nt,xt="trailing"in se?!!se.trailing:xt),Ur.cancel=function Cr(){void 0!==Ze&&clearTimeout(Ze),Jt=0,he=Ee=re=Ze=void 0},Ur.flush=function Ft(){return void 0===Ze?ze:Vt(We())},Ur}},6151:(Mt,Ye)=>{"use strict";Ye.Z={onSetup:function(c){var Z=this.newFeature({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[]]}});return this.addFeature(Z),this.clearSelectedFeatures(),function(c){setTimeout(function(){!c.map||!c.map.doubleClickZoom||c.map.doubleClickZoom.disable()},0)}(this),this.updateUIClasses({mouse:"add"}),this.setActionableState({trash:!0}),{rectangle:Z}},onTap:function(c,Z){c.startPoint&&this.onMouseMove(c,Z),this.onClick(c,Z)},onClick:function(c,Z){c.startPoint&&c.startPoint[0]!==Z.lngLat.lng&&c.startPoint[1]!==Z.lngLat.lat&&(this.updateUIClasses({mouse:"pointer"}),c.endPoint=[Z.lngLat.lng,Z.lngLat.lat],this.changeMode("simple_select",{featuresId:c.rectangle.id})),c.startPoint=[Z.lngLat.lng,Z.lngLat.lat]},onMouseMove:function(c,Z){c.startPoint&&(c.rectangle.updateCoordinate("0.0",c.startPoint[0],c.startPoint[1]),c.rectangle.updateCoordinate("0.1",Z.lngLat.lng,c.startPoint[1]),c.rectangle.updateCoordinate("0.2",Z.lngLat.lng,Z.lngLat.lat),c.rectangle.updateCoordinate("0.3",c.startPoint[0],Z.lngLat.lat),c.rectangle.updateCoordinate("0.4",c.startPoint[0],c.startPoint[1]))},onKeyUp:function(c,Z){if(27===Z.keyCode)return this.changeMode("simple_select")},onStop:function(c){(function(c){setTimeout(function(){!c.map||!c.map.doubleClickZoom||!c._ctx||!c._ctx.store||!c._ctx.store.getInitialConfigValue||!c._ctx.store.getInitialConfigValue("doubleClickZoom")||c.map.doubleClickZoom.enable()},0)})(this),this.updateUIClasses({mouse:"none"}),this.activateUIButton(),void 0!==this.getFeature(c.rectangle.id)&&(c.rectangle.removeCoordinate("0.4"),c.rectangle.isValid()?this.map.fire("draw.create",{features:[c.rectangle.toGeoJSON()]}):(this.deleteFeature([c.rectangle.id],{silent:!0}),this.changeMode("simple_select",{},{silent:!0})))},toDisplayFeatures:function(c,Z,ce){var be=Z.properties.id===c.rectangle.id;return Z.properties.active=be?"true":"false",be?c.startPoint?ce(Z):void 0:ce(Z)},onTrash:function(c){this.deleteFeature([c.rectangle.id],{silent:!0}),this.changeMode("simple_select")}}},9990:(Mt,Ye,ue)=>{const ae=ue(2777).Z,pe=ue(5427).Z,b=ue(2586).Z,c=ue(9814).Z,ce=new(ue(9069));Mt.exports={rotatestart:function(ye,Te){},rotating:function(ye,Te,$e){},rotateend:function(ye){},onSetup:function(ye){var Te={};return ce.addListener("rotatestart",function(){this.rotatestart(Te.selectedFeature,Te.originalCenter)}.bind(this)),ce.addListener("rotating",function(){this.rotating(Te.selectedFeature,Te.originalCenter,Te.lastMouseDownLngLat)}.bind(this)),ce.addListener("rotateend",function(){this.rotateend(Te.selectedFeature,Te.lastMouseDownLngLat)}.bind(this)),Te.selectedFeature=ye.selectedFeature||!1,Te.lastMouseDownLngLat=!1,Te.originalCenter=!1,Te.mode="rotate",Te},onMouseDown:function(ye,Te){return Te.featureTarget&&this._ctx.api.get(Te.featureTarget.properties.id)&&(Te.target.dragPan.disable(),ye.selectedFeature=this._ctx.api.get(Te.featureTarget.properties.id),ye.originalCenter=pe(Te.featureTarget),ye.originalFeature=Te.featureTarget,ce.emit("rotatestart")),ye},toDisplayFeatures:function(ye,Te,$e){$e(Te)},onDrag:function(ye,Te){if(ye.selectedFeature&&ye.mode&&"rotate"===ye.mode){ye.lastMouseDownLngLat={lng:Te.lngLat.lng,lat:Te.lngLat.lat};var $e=b(ye.originalCenter,[Te.lngLat.lng,Te.lngLat.lat]),xe=[];switch(ye.originalFeature.properties["meta:type"]){case"Point":break;case"LineString":ye.originalFeature.geometry.coordinates.forEach(function(q,K){var X=ae(ye.originalCenter,q),ee=b(ye.originalCenter,q),ie=c(ye.originalCenter,X,ee+$e);xe.push(ie.geometry.coordinates)});break;case"Polygon":var ge=[];ye.originalFeature.geometry.coordinates[0].forEach(function(q,K){var X=ae(ye.originalCenter,q),ee=b(ye.originalCenter,q),ie=c(ye.originalCenter,X,ee+$e);ge.push(ie.geometry.coordinates)}),xe.push(ge);break;case"MultiLineString":var Oe=[];ye.originalFeature.geometry.coordinates.forEach(function(q,K){var X=[];q.forEach(function(ee,ie){var ne=ae(ye.originalCenter,ee),se=b(ye.originalCenter,ee),he=c(ye.originalCenter,ne,se+$e);X.push(he.geometry.coordinates)}),Oe.push(X)}),xe=Oe;break;case"MultiPolygon":Oe=[],ye.originalFeature.geometry.coordinates.forEach(function(q,K){var X=[];q.forEach(function(ee,ie){var ne=[];ee.forEach(function(se,he){var re=ae(ye.originalCenter,se),nt=b(ye.originalCenter,se),ze=c(ye.originalCenter,re,nt+$e);ne.push(ze.geometry.coordinates)}),X.push(ne)}),Oe.push(X)}),xe=Oe;break;default:return}ce.emit("rotating");var We=ye.selectedFeature;We.geometry.coordinates=xe,this._ctx.api.add(We)}},onMouseUp:function(ye,Te){return Te.target.dragPan.enable(),ce.emit("rotateend"),ye.selectedFeature=!1,ye.lastMouseDownLngLat=!1,ye.originalCenter=!1,ye}}},2586:(Mt,Ye,ue)=>{"use strict";function re(ft){if(null==ft)throw new Error("degrees is required");return ft%360*Math.PI/180}function Vt(ft){if(!ft)throw new Error("coord is required");if("Feature"===ft.type&&null!==ft.geometry&&"Point"===ft.geometry.type)return ft.geometry.coordinates;if("Point"===ft.type)return ft.coordinates;if(Array.isArray(ft)&&ft.length>=2&&void 0===ft[0].length&&void 0===ft[1].length)return ft;throw new Error("coord must be GeoJSON Point or an Array of numbers")}ue.d(Ye,{Z:()=>yi});const yi=function cn(ft,lr,st){if(!function Ee(ft){return!!ft&&ft.constructor===Object}(st=st||{}))throw new Error("options is invalid");if(!0===st.final)return function qn(ft,lr){return(cn(lr,ft)+180)%360}(ft,lr);var _e=Vt(ft),ve=Vt(lr),Je=re(_e[0]),St=re(ve[0]),Xt=re(_e[1]),gr=re(ve[1]),_r=Math.sin(St-Je)*Math.cos(gr),rr=Math.cos(Xt)*Math.sin(gr)-Math.sin(Xt)*Math.cos(gr)*Math.cos(St-Je);return function he(ft){if(null==ft)throw new Error("radians is required");return ft%(2*Math.PI)*180/Math.PI}(Math.atan2(_r,rr))}},9898:function(Mt){Mt.exports=function(){"use strict";var Ye,ue,ae;function pe(c,Z){if(Ye)if(ue){var ce="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ye+")(sharedChunk); ("+ue+")(sharedChunk); self.onerror = null;",be={};Ye(be),ae=Z(be),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(ae.workerUrl=window.URL.createObjectURL(new Blob([ce],{type:"text/javascript"})))}else ue=Z;else Ye=Z}return pe(0,function(c){var Z=typeof self<"u"?self:{},ce="2.12.0";let be;const ye={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==be){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{be=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{be=t}}return be},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Te={supported:!1,testSupport:function(t){!ge&&xe&&(Oe?We(t):$e=t)}};let $e,xe,ge=!1,Oe=!1;function We(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,xe),t.isContextLost())return;Te.supported=!0}catch{}t.deleteTexture(e),ge=!0}Z.document&&(xe=Z.document.createElement("img"),xe.onload=function(){$e&&We($e),$e=null,Oe=!0},xe.onerror=function(){ge=!0,$e=null},xe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const H="01";var q=K;function K(t,e,n,u){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(u-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=u}K.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,u=0;u<8;u++){var p=this.sampleCurveX(n)-t;if(Math.abs(p)<e)return n;var y=this.sampleCurveDerivativeX(n);if(Math.abs(y)<1e-6)break;n-=p/y}var x=0,T=1;for(n=t,u=0;u<20&&(p=this.sampleCurveX(n),!(Math.abs(p-t)<e));u++)t>p?x=n:T=n,n=.5*(T-x)+x;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var X=ee;function ee(t,e){this.x=t,this.y=e}ee.prototype={clone:function(){return new ee(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),u=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=u,this},_rotateAround:function(t,e){var n=Math.cos(t),u=Math.sin(t),p=e.y+u*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-u*(this.y-e.y),this.y=p,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ee.convert=function(t){return t instanceof ee?t:Array.isArray(t)?new ee(t[0],t[1]):t};const ie=Math.PI/180,ne=180/Math.PI;function se(t){return t*ie}function he(t){return t*ne}const re=[[0,0],[1,0],[1,1],[0,1]];function nt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function ze(t,e,n,u){const p=new q(t,e,n,u);return function(y){return p.solve(y)}}const Ze=ze(.25,.1,.25,1);function Ee(t,e,n){return Math.min(n,Math.max(e,t))}function Jt(t,e,n){return(n=Ee((n-t)/(e-t),0,1))*n*(3-2*n)}function Nt(t,e,n){const u=n-e,p=((t-e)%u+u)%u+e;return p===e?n:p}function ke(t,e,n){if(!t.length)return n(null,[]);let u=t.length;const p=new Array(t.length);let y=null;t.forEach((x,T)=>{e(x,(I,L)=>{I&&(y=I),p[T]=L,0==--u&&n(y,p)})})}function xt(t){const e=[];for(const n in t)e.push(t[n]);return e}function Ae(t,...e){for(const n of e)for(const u in n)t[u]=n[u];return t}let pt=1;function bt(){return pt++}function Ue(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Wt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Vt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Cr(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Ft(t,e){return-1!==t.indexOf(e,t.length-e.length)}function Ur(t,e,n){const u={};for(const p in t)u[p]=e.call(n||this,t[p],p,t);return u}function Fr(t,e,n){const u={};for(const p in t)e.call(n||this,t[p],p,t)&&(u[p]=t[p]);return u}function zr(t){return Array.isArray(t)?t.map(zr):"object"==typeof t&&t?Ur(t,zr):t}const rn={};function Ar(t){rn[t]||(typeof console<"u"&&console.warn(t),rn[t]=!0)}function xr(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function cn(t){let e=0;for(let n,u,p=0,y=t.length,x=y-1;p<y;x=p++)n=t[p],u=t[x],e+=(u.x-n.x)*(n.y+u.y);return e}function qn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function yi(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,u,p,y)=>{const x=p||y;return e[u]=!x||x.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let ft=null;function lr(t){if(null==ft){const e=t.navigator?t.navigator.userAgent:null;ft=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return ft}function st(t){try{const e=Z[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Se(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const _e="mapbox-tiles";let ve,Je,St=500,Xt=50;function gr(){try{return Z.caches}catch{}}function _r(){gr()&&!ve&&(ve=Z.caches.open(_e))}function rr(t){const e=t.indexOf("?");if(e<0)return t;const u=function(p){const y=p.indexOf("?");return y>0?p.slice(y+1).split("&"):[]}(t).filter(p=>{const y=p.split("=");return"language"===y[0]||"worldview"===y[0]});return u.length?`${t.slice(0,e)}?${u.join("&")}`:t.slice(0,e)}let En=1/0;const un={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(un);class Lr extends Error{constructor(e,n,u){401===n&&Os(u)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Cn=qn()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Z.location.protocol?Z.parent:Z).location.href,ti=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Cn())&&!/^\w+:/.test(n))){if(Z.fetch&&Z.Request&&Z.AbortController&&Z.Request.prototype.hasOwnProperty("signal"))return function(u,p){const y=new Z.AbortController,x=new Z.Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Cn(),signal:y.signal});let T=!1,I=!1;const L=(F=x.url).indexOf("sku=")>0&&Os(F);var F;"json"===u.type&&x.headers.set("Accept","application/json");const G=(te,oe,me)=>{if(I)return;if(te&&"SecurityError"!==te.message&&Ar(te),oe&&me)return $(oe);const Pe=Date.now();Z.fetch(x).then(tt=>{if(tt.ok){const ut=L?tt.clone():null;return $(tt,ut,Pe)}return p(new Lr(tt.statusText,tt.status,u.url))}).catch(tt=>{20!==tt.code&&p(new Error(tt.message))})},$=(te,oe,me)=>{("arrayBuffer"===u.type?te.arrayBuffer():"json"===u.type?te.json():te.text()).then(Pe=>{I||(oe&&me&&function(tt,ut,Ke){if(_r(),!ve)return;const lt={status:ut.status,statusText:ut.statusText,headers:new Z.Headers};ut.headers.forEach(($t,Zt)=>lt.headers.set(Zt,$t));const vt=yi(ut.headers.get("Cache-Control")||"");if(vt["no-store"])return;vt["max-age"]&&lt.headers.set("Expires",new Date(Ke+1e3*vt["max-age"]).toUTCString());const ht=lt.headers.get("Expires");ht&&(new Date(ht).getTime()-Ke<42e4||function($t,Zt){if(void 0===Je)try{new Response(new ReadableStream),Je=!0}catch{Je=!1}Je?Zt($t.body):$t.blob().then(Zt)}(ut,$t=>{const Zt=new Z.Response($t,lt);_r(),ve&&ve.then(cr=>cr.put(rr(tt.url),Zt)).catch(cr=>Ar(cr.message))}))}(x,oe,me),T=!0,p(null,Pe,te.headers.get("Cache-Control"),te.headers.get("Expires")))}).catch(Pe=>{I||p(new Error(Pe.message))})};return L?function(te,oe){if(_r(),!ve)return oe(null);const me=rr(te.url);ve.then(Pe=>{Pe.match(me).then(tt=>{const ut=function(Ke){if(!Ke)return!1;const lt=new Date(Ke.headers.get("Expires")||0),vt=yi(Ke.headers.get("Cache-Control")||"");return lt>Date.now()&&!vt["no-cache"]}(tt);Pe.delete(me),ut&&Pe.put(me,tt.clone()),oe(null,tt,ut)}).catch(oe)}).catch(oe)}(x,G):G(null,null),{cancel:()=>{I=!0,T||y.abort()}}}(t,e);if(qn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(u,p){const y=new Z.XMLHttpRequest;y.open(u.method||"GET",u.url,!0),"arrayBuffer"===u.type&&(y.responseType="arraybuffer");for(const x in u.headers)y.setRequestHeader(x,u.headers[x]);return"json"===u.type&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials="include"===u.credentials,y.onerror=()=>{p(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||0===y.status)&&null!==y.response){let x=y.response;if("json"===u.type)try{x=JSON.parse(y.response)}catch(T){return p(T)}p(null,x,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else p(new Lr(y.statusText,y.status,u.url))},y.send(u.body),{cancel:()=>y.abort()}}(t,e)},Jn=function(t,e){return ti(Ae(t,{type:"arrayBuffer"}),e)};function zn(t){const e=Z.document.createElement("a");return e.href=t,e.protocol===Z.document.location.protocol&&e.host===Z.document.location.host}const di="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Qr,wo;Qr=[],wo=0;const Po=function(t,e){if(Te.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),wo>=ye.MAX_PARALLEL_IMAGE_REQUESTS){const y={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Qr.push(y),y}wo++;let n=!1;const u=()=>{if(!n)for(n=!0,wo--;Qr.length&&wo<ye.MAX_PARALLEL_IMAGE_REQUESTS;){const y=Qr.shift(),{requestParameters:x,callback:T,cancelled:I}=y;I||(y.cancel=Po(x,T).cancel)}},p=Jn(t,(y,x,T,I)=>{u(),y?e(y):x&&(Z.createImageBitmap?function(L,F){const G=new Z.Blob([new Uint8Array(L)],{type:"image/png"});Z.createImageBitmap(G).then($=>{F(null,$)}).catch($=>{F(new Error(`Could not load image because of ${$.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(L,F)=>e(L,F,T,I)):function(L,F){const G=new Z.Image,$=Z.URL;G.onload=()=>{F(null,G),$.revokeObjectURL(G.src),G.onload=null,Z.requestAnimationFrame(()=>{G.src=di})},G.onerror=()=>F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const te=new Z.Blob([new Uint8Array(L)],{type:"image/png"});G.src=L.byteLength?$.createObjectURL(te):di}(x,(L,F)=>e(L,F,T,I)))});return{cancel:()=>{p.cancel(),u()}}},is="NO_ACCESS_TOKEN";function Xn(t){return 0===t.indexOf("mapbox:")}function Os(t){return ye.API_URL_REGEX.test(t)}function Bn(t){return ye.API_CDN_URL_REGEX.test(t)}function Mr(t){return ye.API_STYLE_REGEX.test(t)&&!Wo(t)}function Wo(t){return ye.API_SPRITE_REGEX.test(t)}const Ys=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Sn(t){const e=t.match(Ys);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function aa(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function Cs(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Z.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ge{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Cs(ye.ACCESS_TOKEN);let u="";return u=n&&n.u?Z.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(p,y)=>String.fromCharCode(Number("0x"+y)))):ye.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${u}`:`mapbox.eventData:${u}`}fetchEventData(){const e=st("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid");if(e)try{const p=Z.localStorage.getItem(n);p&&(this.eventData=JSON.parse(p));const y=Z.localStorage.getItem(u);y&&(this.anonId=y)}catch{Ar("Unable to read from LocalStorage")}}saveEventData(){const e=st("localStorage"),n=this.getStorageKey(),u=this.getStorageKey("uuid");if(e)try{Z.localStorage.setItem(u,this.anonId),Object.keys(this.eventData).length>=1&&Z.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{Ar("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,u,p){if(!ye.EVENTS_URL)return;const y=Sn(ye.EVENTS_URL);y.params.push(`access_token=${p||ye.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(e).toISOString()},T=n?Ae(x,n):x,I={url:aa(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};var F;this.pendingRequest=(F=L=>{this.pendingRequest=null,u(L),this.saveEventData(),this.processRequests(p)},ti(Ae(I,{method:"POST"}),F))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const le=new class extends Ge{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){ye.EVENTS_URL&&ye.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Xn(n)||Os(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Cs(ye.ACCESS_TOKEN),n=e?e.u:ye.ACCESS_TOKEN;let u=n!==this.eventData.tokenU;Vt(this.anonId)||(this.anonId=Ue(),u=!0);const p=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),x=new Date(p),T=(p-this.eventData.lastSuccess)/864e5;u=u||T>=1||T<-1||y.getDate()!==x.getDate()}else u=!0;u?this.postEvent(p,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ce,skuId:H,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=p,this.eventData.tokenU=n)},t):this.processRequests()}},we=le.postTurnstileEvent.bind(le),qe=new class extends Ge{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,u){this.skuToken=e,this.errorCb=u,ye.EVENTS_URL&&(n||ye.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(is)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Vt(this.anonId)||(this.anonId=Ue()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:ce,skuId:H,skuToken:this.skuToken,userId:this.anonId},u=>{u?this.errorCb(u):e&&(this.success[e]=!0)},t))}},ot=qe.postMapLoadEvent.bind(qe),dt=new class extends Ge{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){ye.EVENTS_URL&&(t||ye.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),u=function(p){const y=Z.performance.getEntriesByType("resource"),x=Z.performance.getEntriesByType("mark"),T=function($){const te={};if($)for(const oe in $)if("other"!==oe)for(const me of $[oe]){const Pe=`${oe}ResolveRangeMin`,tt=`${oe}ResolveRangeMax`,ut=`${oe}RequestCount`,Ke=`${oe}RequestCachedCount`;te[Pe]=Math.min(te[Pe]||1/0,me.startTime),te[tt]=Math.max(te[tt]||-1/0,me.responseEnd);const lt=vt=>{void 0===te[vt]&&(te[vt]=0),++te[vt]};void 0!==me.transferSize&&0===me.transferSize&&lt(Ke),lt(ut)}return te}(function($,te){const oe={};if($)for(const me of $){const Pe=te(me);void 0===oe[Pe]&&(oe[Pe]=[]),oe[Pe].push(me)}return oe}(y,mr)),I=Z.devicePixelRatio,L=Z.navigator.connection||Z.navigator.mozConnection||Z.navigator.webkitConnection,F={counters:[],metadata:[],attributes:[]},G=($,te,oe)=>{null!=oe&&$.push({name:te,value:oe.toString()})};for(const $ in T)G(F.counters,$,T[$]);if(p.interactionRange[0]!==1/0&&p.interactionRange[1]!==-1/0&&(G(F.counters,"interactionRangeMin",p.interactionRange[0]),G(F.counters,"interactionRangeMax",p.interactionRange[1])),x)for(const $ of Object.keys(sr)){const te=sr[$],oe=x.find(me=>me.name===te);oe&&G(F.counters,te,oe.startTime)}return G(F.counters,"visibilityHidden",p.visibilityHidden),G(F.attributes,"style",function($){if($)for(const te of $){const oe=te.name.split("?")[0];if(Mr(oe)){const me=oe.split("/").slice(-2);if(2===me.length)return`mapbox://styles/${me[0]}/${me[1]}`}}}(y)),G(F.attributes,"terrainEnabled",p.terrainEnabled?"true":"false"),G(F.attributes,"fogEnabled",p.fogEnabled?"true":"false"),G(F.attributes,"projection",p.projection),G(F.attributes,"zoom",p.zoom),G(F.metadata,"devicePixelRatio",I),G(F.metadata,"connectionEffectiveType",L?L.effectiveType:void 0),G(F.metadata,"navigatorUserAgent",Z.navigator.userAgent),G(F.metadata,"screenWidth",Z.screen.width),G(F.metadata,"screenHeight",Z.screen.height),G(F.metadata,"windowWidth",Z.innerWidth),G(F.metadata,"windowHeight",Z.innerHeight),G(F.metadata,"mapWidth",p.width/I),G(F.metadata,"mapHeight",p.height/I),G(F.metadata,"webglRenderer",p.renderer),G(F.metadata,"webglVendor",p.vendor),G(F.metadata,"sdkVersion",ce),G(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(n);for(const p of u.metadata);for(const p of u.counters);for(const p of u.attributes);this.postEvent(e,u,()=>{},t)}},Dt=dt.postPerformanceEvent.bind(dt),Ot=new class extends Ge{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,u){if(!ye.API_URL||!ye.SESSION_PATH)return;const p=Sn(ye.API_URL+ye.SESSION_PATH);p.params.push(`sku=${e||""}`),p.params.push(`access_token=${u||ye.ACCESS_TOKEN||""}`);const y={url:aa(p),headers:{"Content-Type":"text/plain"}};var T;this.pendingRequest=(T=x=>{this.pendingRequest=null,n(x),this.saveEventData(),this.processRequests(u)},ti(Ae(y,{method:"GET"}),T))}getSessionAPI(t,e,n,u){this.skuToken=e,this.errorCb=u,ye.SESSION_PATH&&ye.API_URL&&(n||ye.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(is)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,u=>{u?this.errorCb(u):e&&(this.success[e]=!0)},t)}},wt=Ot.getSessionAPI.bind(Ot),Ct=new Set,sr={create:"create",load:"load",fullLoad:"fullLoad"},Rr={mark(t){Z.performance.mark(t)},measure(t,e,n){Z.performance.measure(t,e,n)}};function mr(t){const e=t.name.split("?")[0];return Bn(e)&&e.includes("mapbox-gl.js")?"javascript":Bn(e)&&e.includes("mapbox-gl.css")?"css":ye.API_FONTS_REGEX.test(e)?"fontRange":Wo(e)?"sprite":Mr(e)?"style":ye.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const Yr=Z.performance;function hn(t){const e=t?t.url.toString():void 0;return Yr.getEntriesByName(e)}let en,Tn,Dn,xi;const jr={now:()=>void 0!==Dn?Dn:Z.performance.now(),setNow(t){Dn=t},restoreNow(){Dn=void 0},frame(t){const e=Z.requestAnimationFrame(t);return{cancel:()=>Z.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:u}=t;xi||(xi=Z.document.createElement("canvas"));const p=xi.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return(n>xi.width||u>xi.height)&&(xi.width=n,xi.height=u),p.clearRect(-e,-e,n+2*e,u+2*e),p.drawImage(t,0,0,n,u),p.getImageData(-e,-e,n+2*e,u+2*e)},resolveURL:t=>(en||(en=Z.document.createElement("a")),en.href=t,en.href),get devicePixelRatio(){return Z.devicePixelRatio},get prefersReducedMotion(){return!!Z.matchMedia&&(null==Tn&&(Tn=Z.matchMedia("(prefers-reduced-motion: reduce)")),Tn.matches)}};function mn(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function ro(t,e,n){if(n&&n[t]){const u=n[t].indexOf(e);-1!==u&&n[t].splice(u,1)}}class Ho{constructor(e,n={}){Ae(this,n),this.type=e}}class Ts extends Ho{constructor(e,n={}){super("error",Ae({error:e},n))}}class ki{on(e,n){return this._listeners=this._listeners||{},mn(e,n,this._listeners),this}off(e,n){return ro(e,n,this._listeners),ro(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},mn(e,n,this._oneTimeListeners),this):new Promise(u=>this.once(e,u))}fire(e,n){"string"==typeof e&&(e=new Ho(e,n||{}));const u=e.type;if(this.listens(u)){e.target=this;const p=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const T of p)T.call(this,e);const y=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const T of y)ro(u,T,this._oneTimeListeners),T.call(this,e);const x=this._eventedParent;x&&(Ae(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),x.fire(e))}else e instanceof Ts&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ur=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function hs(t,...e){for(const n of e)for(const u in n)t[u]=n[u];return t}function Kn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Jo(t){if(Array.isArray(t))return t.map(Jo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=Jo(t[n]);return e}return Kn(t)}class Ou extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Ko=Ou;class ks{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[u,p]of n)this.bindings[u]=p}concat(e){return new ks(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Pl=ks;const oi={kind:"null"},Nr={kind:"number"},Vn={kind:"string"},ai={kind:"boolean"},Ws={kind:"color"},hi={kind:"object"},ri={kind:"value"},va={kind:"collator"},zl={kind:"formatted"},$n={kind:"resolvedImage"};function Hs(t,e){return{kind:"array",itemType:t,N:e}}function Eo(t){if("array"===t.kind){const e=Eo(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const R=[oi,Nr,Vn,ai,Ws,zl,hi,Hs(ri),$n];function W(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!W(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of R)if(!W(n,e))return null}return`Expected ${Eo(t)} but found ${Eo(e)} instead.`}function Ce(t,e){return e.some(n=>n.kind===t.kind)}function Et(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var Gt,et={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Bt(t){return(t=Math.round(t))<0?0:t>255?255:t}function br(t){return Bt("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function wr(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Wr(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{Gt={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in et)return et[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=n.indexOf("("),p=n.indexOf(")");if(-1!==u&&p+1===n.length){var y=n.substr(0,u),x=n.substr(u+1,p-(u+1)).split(","),T=1;switch(y){case"rgba":if(4!==x.length)return null;T=wr(x.pop());case"rgb":return 3!==x.length?null:[br(x[0]),br(x[1]),br(x[2]),T];case"hsla":if(4!==x.length)return null;T=wr(x.pop());case"hsl":if(3!==x.length)return null;var I=(parseFloat(x[0])%360+360)%360/360,L=wr(x[1]),F=wr(x[2]),G=F<=.5?F*(L+1):F+L-F*L,$=2*F-G;return[Bt(255*Wr($,G,I+1/3)),Bt(255*Wr($,G,I)),Bt(255*Wr($,G,I-1/3)),T];default:return null}}return null}}catch{}class kt{constructor(e,n,u,p=1){this.r=e,this.g=n,this.b=u,this.a=p}static parse(e){if(!e)return;if(e instanceof kt)return e;if("string"!=typeof e)return;const n=Gt(e);return n?new kt(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,u,p]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(u)},${p})`}toArray(){const{r:e,g:n,b:u,a:p}=this;return 0===p?[0,0,0,0]:[255*e/p,255*n/p,255*u/p,p]}toArray01(){const{r:e,g:n,b:u,a:p}=this;return 0===p?[0,0,0,0]:[e/p,n/p,u/p,p]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:u,a:p}=this;return[e,n,u,p]}}kt.black=new kt(0,0,0,1),kt.white=new kt(1,1,1,1),kt.transparent=new kt(0,0,0,0),kt.red=new kt(1,0,0,1),kt.blue=new kt(0,0,1,1);var hr=kt;class Er{constructor(e,n,u){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Jr{constructor(e,n,u,p,y){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=u,this.fontStack=p,this.textColor=y}}class yn{constructor(e){this.sections=e}static fromString(e){return new yn([new Jr(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof yn?e:yn.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const u={};n.fontStack&&(u["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(u["font-scale"]=n.scale),n.textColor&&(u["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(u)}return e}}class ao{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new ao({name:e,available:!1}):null}serialize(){return["image",this.name]}}function fr(t,e,n,u){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===u||"number"==typeof u&&u>=0&&u<=1?null:`Invalid rgba value [${[t,e,n,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof u?[t,e,n,u]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function nn(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof hr||t instanceof Er||t instanceof yn||t instanceof ao)return!0;if(Array.isArray(t)){for(const e of t)if(!nn(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!nn(t[e]))return!1;return!0}return!1}function In(t){if(null===t)return oi;if("string"==typeof t)return Vn;if("boolean"==typeof t)return ai;if("number"==typeof t)return Nr;if(t instanceof hr)return Ws;if(t instanceof Er)return va;if(t instanceof yn)return zl;if(t instanceof ao)return $n;if(Array.isArray(t)){const e=t.length;let n;for(const u of t){const p=In(u);if(n){if(n===p)continue;n=ri;break}n=p}return Hs(n||ri,e)}return hi}function xn(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof hr||t instanceof yn||t instanceof ao?t.toString():JSON.stringify(t)}class _o{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!nn(e[1]))return n.error("invalid value");const u=e[1];let p=In(u);const y=n.expectedType;return"array"!==p.kind||0!==p.N||!y||"array"!==y.kind||"number"==typeof y.N&&0!==y.N||(p=y),new _o(p,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof hr?["rgba"].concat(this.value.toArray()):this.value instanceof yn?this.value.serialize():this.value}}var Zr=_o,zo=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Rs={string:Vn,number:Nr,boolean:ai,object:hi};class pn{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let u,p=1;const y=e[0];if("array"===y){let T,I;if(e.length>2){const L=e[1];if("string"!=typeof L||!(L in Rs)||"object"===L)return n.error('The item type argument of "array" must be one of string, number, boolean',1);T=Rs[L],p++}else T=ri;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);I=e[2],p++}u=Hs(T,I)}else u=Rs[y];const x=[];for(;p<e.length;p++){const T=n.parse(e[p],p,ri);if(!T)return null;x.push(T)}return new pn(u,x)}evaluate(e){for(let n=0;n<this.args.length;n++){const u=this.args[n].evaluate(e);if(!W(this.type,In(u)))return u;if(n===this.args.length-1)throw new zo(`Expected value to be of type ${Eo(this.type)}, but found ${Eo(In(u))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const u=e.itemType;if("string"===u.kind||"number"===u.kind||"boolean"===u.kind){n.push(u.kind);const p=e.N;("number"==typeof p||this.args.length>1)&&n.push(p)}}return n.concat(this.args.map(u=>u.serialize()))}}var ji=pn;class Xo{constructor(e){this.type=zl,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const u=e[1];if(!Array.isArray(u)&&"object"==typeof u)return n.error("First argument must be an image or text section.");const p=[];let y=!1;for(let x=1;x<=e.length-1;++x){const T=e[x];if(y&&"object"==typeof T&&!Array.isArray(T)){y=!1;let I=null;if(T["font-scale"]&&(I=n.parse(T["font-scale"],1,Nr),!I))return null;let L=null;if(T["text-font"]&&(L=n.parse(T["text-font"],1,Hs(Vn)),!L))return null;let F=null;if(T["text-color"]&&(F=n.parse(T["text-color"],1,Ws),!F))return null;const G=p[p.length-1];G.scale=I,G.font=L,G.textColor=F}else{const I=n.parse(e[x],1,ri);if(!I)return null;const L=I.type.kind;if("string"!==L&&"value"!==L&&"null"!==L&&"resolvedImage"!==L)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,p.push({content:I,scale:null,font:null,textColor:null})}}return new Xo(p)}evaluate(e){return new yn(this.sections.map(n=>{const u=n.content.evaluate(e);return In(u)===$n?new Jr("",u,null,null,null):new Jr(xn(u),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const u={};n.scale&&(u["font-scale"]=n.scale.serialize()),n.font&&(u["text-font"]=n.font.serialize()),n.textColor&&(u["text-color"]=n.textColor.serialize()),e.push(u)}return e}}class Ns{constructor(e){this.type=$n,this.input=e}static parse(e,n){if(2!==e.length)return n.error("Expected two arguments.");const u=n.parse(e[1],1,Vn);return u?new Ns(u):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),u=ao.fromString(n);return u&&e.availableImages&&(u.available=e.availableImages.indexOf(n)>-1),u}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const _l={"to-boolean":ai,"to-color":Ws,"to-number":Nr,"to-string":Vn};class gs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const u=e[0];if(("to-boolean"===u||"to-string"===u)&&2!==e.length)return n.error("Expected one argument.");const p=_l[u],y=[];for(let x=1;x<e.length;x++){const T=n.parse(e[x],x,ri);if(!T)return null;y.push(T)}return new gs(p,y)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let n,u;for(const p of this.args){if(n=p.evaluate(e),u=null,n instanceof hr)return n;if("string"==typeof n){const y=e.parseColor(n);if(y)return y}else if(Array.isArray(n)&&(u=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:fr(n[0],n[1],n[2],n[3]),!u))return new hr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new zo(u||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const u of this.args){if(n=u.evaluate(e),null===n)return 0;const p=Number(n);if(!isNaN(p))return p}throw new zo(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?yn.fromString(xn(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?ao.fromString(xn(this.args[0].evaluate(e))):xn(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Xo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ns(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Js=gs;const Ao=["Unknown","Point","LineString","Polygon"];var qi=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ao[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(u*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=hr.parse(t)),e}};class Ms{constructor(e,n,u,p){this.name=e,this.type=n,this._evaluate=u,this.args=p}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const u=e[0],p=Ms.definitions[u];if(!p)return n.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(p)?p[0]:p.type,x=Array.isArray(p)?[[p[1],p[2]]]:p.overloads,T=x.filter(([L])=>!Array.isArray(L)||L.length===e.length-1);let I=null;for(const[L,F]of T){I=new vl(n.registry,n.path,null,n.scope);const G=[];let $=!1;for(let te=1;te<e.length;te++){const oe=e[te],me=Array.isArray(L)?L[te-1]:L.type,Pe=I.parse(oe,1+G.length,me);if(!Pe){$=!0;break}G.push(Pe)}if(!$)if(Array.isArray(L)&&L.length!==G.length)I.error(`Expected ${L.length} arguments, but found ${G.length} instead.`);else{for(let te=0;te<G.length;te++){const oe=Array.isArray(L)?L[te]:L.type,me=G[te];I.concat(te+1).checkSubtype(oe,me.type)}if(0===I.errors.length)return new Ms(u,y,F,G)}}if(1===T.length)n.errors.push(...I.errors);else{const L=(T.length?T:x).map(([G])=>{return $=G,Array.isArray($)?`(${$.map(Eo).join(", ")})`:`(${Eo($.type)}...)`;var $}).join(" | "),F=[];for(let G=1;G<e.length;G++){const $=n.parse(e[G],1+F.length);if(!$)return null;F.push(Eo($.type))}n.error(`Expected arguments of type ${L}, but found (${F.join(", ")}) instead.`)}return null}static register(e,n){Ms.definitions=n;for(const u in n)e[u]=Ms}}var Vi=Ms;class Bo{constructor(e,n,u){this.type=va,this.locale=u,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const u=e[1];if("object"!=typeof u||Array.isArray(u))return n.error("Collator options argument must be an object.");const p=n.parse(void 0!==u["case-sensitive"]&&u["case-sensitive"],1,ai);if(!p)return null;const y=n.parse(void 0!==u["diacritic-sensitive"]&&u["diacritic-sensitive"],1,ai);if(!y)return null;let x=null;return u.locale&&(x=n.parse(u.locale,1,Vn),!x)?null:new Bo(p,y,x)}evaluate(e){return new Er(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const ps=8192;function lu(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function la(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ku(t,e){const n=(180+t[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,p=Math.pow(2,e.z);return[Math.round(n*p*ps),Math.round(u*p*ps)]}function Yu(t,e,n){const u=t[0]-e[0],p=t[1]-e[1],y=t[0]-n[0],x=t[1]-n[1];return u*x-y*p==0&&u*y<=0&&p*x<=0}function ys(t,e){let n=!1;for(let x=0,T=e.length;x<T;x++){const I=e[x];for(let L=0,F=I.length;L<F-1;L++){if(Yu(t,I[L],I[L+1]))return!1;(p=I[L])[1]>(u=t)[1]!=(y=I[L+1])[1]>u[1]&&u[0]<(y[0]-p[0])*(u[1]-p[1])/(y[1]-p[1])+p[0]&&(n=!n)}}var u,p,y;return n}function sl(t,e){for(let n=0;n<e.length;n++)if(ys(t,e[n]))return!0;return!1}function $o(t,e,n,u){const p=u[0]-n[0],y=u[1]-n[1],x=(t[0]-n[0])*y-p*(t[1]-n[1]),T=(e[0]-n[0])*y-p*(e[1]-n[1]);return x>0&&T<0||x<0&&T>0}function Fa(t,e,n){for(const L of n)for(let F=0;F<L.length-1;++F)if((T=[(x=L[F+1])[0]-(y=L[F])[0],x[1]-y[1]])[0]*(I=[(p=e)[0]-(u=t)[0],p[1]-u[1]])[1]-T[1]*I[0]!=0&&$o(u,p,y,x)&&$o(y,x,u,p))return!0;var u,p,y,x,T,I;return!1}function La(t,e){for(let n=0;n<t.length;++n)if(!ys(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Fa(t[n],t[n+1],e))return!1;return!0}function Wl(t,e){for(let n=0;n<e.length;n++)if(La(t,e[n]))return!0;return!1}function lo(t,e,n){const u=[];for(let p=0;p<t.length;p++){const y=[];for(let x=0;x<t[p].length;x++){const T=ku(t[p][x],n);lu(e,T),y.push(T)}u.push(y)}return u}function _n(t,e,n){const u=[];for(let p=0;p<t.length;p++){const y=lo(t[p],e,n);u.push(y)}return u}function Al(t,e,n,u){if(t[0]<n[0]||t[0]>n[2]){const p=.5*u;let y=t[0]-n[0]>p?-u:n[0]-t[0]>p?u:0;0===y&&(y=t[0]-n[2]>p?-u:n[2]-t[0]>p?u:0),t[0]+=y}lu(e,t)}function wi(t,e,n,u){const p=Math.pow(2,u.z)*ps,y=[u.x*ps,u.y*ps],x=[];if(!t)return x;for(const T of t)for(const I of T){const L=[I.x+y[0],I.y+y[1]];Al(L,e,n,p),x.push(L)}return x}function ua(t,e,n,u){const p=Math.pow(2,u.z)*ps,y=[u.x*ps,u.y*ps],x=[];if(!t)return x;for(const I of t){const L=[];for(const F of I){const G=[F.x+y[0],F.y+y[1]];lu(e,G),L.push(G)}x.push(L)}if(e[2]-e[0]<=p/2){(T=e)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const I of x)for(const L of I)Al(L,e,n,p)}var T;return x}class xa{constructor(e,n){this.type=ai,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(nn(e[1])){const u=e[1];if("FeatureCollection"===u.type)for(let p=0;p<u.features.length;++p){const y=u.features[p].geometry.type;if("Polygon"===y||"MultiPolygon"===y)return new xa(u,u.features[p].geometry)}else if("Feature"===u.type){const p=u.geometry.type;if("Polygon"===p||"MultiPolygon"===p)return new xa(u,u.geometry)}else if("Polygon"===u.type||"MultiPolygon"===u.type)return new xa(u,u)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,u){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=n.canonicalID();if(!x)return!1;if("Polygon"===u.type){const T=lo(u.coordinates,y,x),I=wi(n.geometry(),p,y,x);if(!la(p,y))return!1;for(const L of I)if(!ys(L,T))return!1}if("MultiPolygon"===u.type){const T=_n(u.coordinates,y,x),I=wi(n.geometry(),p,y,x);if(!la(p,y))return!1;for(const L of I)if(!sl(L,T))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,u){const p=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],x=n.canonicalID();if(!x)return!1;if("Polygon"===u.type){const T=lo(u.coordinates,y,x),I=ua(n.geometry(),p,y,x);if(!la(p,y))return!1;for(const L of I)if(!La(L,T))return!1}if("MultiPolygon"===u.type){const T=_n(u.coordinates,y,x),I=ua(n.geometry(),p,y,x);if(!la(p,y))return!1;for(const L of I)if(!Wl(L,T))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var al=xa;function Ya(t){if(t instanceof Vi&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof al)return!1;let e=!0;return t.eachChild(n=>{e&&!Ya(n)&&(e=!1)}),e}function ll(t){if(t instanceof Vi&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!ll(n)&&(e=!1)}),e}function ba(t,e){if(t instanceof Vi&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(u=>{n&&!ba(u,e)&&(n=!1)}),n}class ni{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const u=e[1];return n.scope.has(u)?new ni(u,n.scope.get(u)):n.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var wa=ni;class Ri{constructor(e,n=[],u,p=new Pl,y=[]){this.registry=e,this.path=n,this.key=n.map(x=>`[${x}]`).join(""),this.scope=p,this.errors=y,this.expectedType=u}parse(e,n,u,p,y={}){return n?this.concat(n,u,p)._parse(e,y):this._parse(e,y)}_parse(e,n){function u(p,y,x){return"assert"===x?new ji(y,[p]):"coerce"===x?new Js(y,[p]):p}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const p=e[0];if("string"!=typeof p)return this.error(`Expression name must be a string, but found ${typeof p} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[p];if(y){let x=y.parse(e,this);if(!x)return null;if(this.expectedType){const T=this.expectedType,I=x.type;if("string"!==T.kind&&"number"!==T.kind&&"boolean"!==T.kind&&"object"!==T.kind&&"array"!==T.kind||"value"!==I.kind)if("color"!==T.kind&&"formatted"!==T.kind&&"resolvedImage"!==T.kind||"value"!==I.kind&&"string"!==I.kind){if(this.checkSubtype(T,I))return null}else x=u(x,T,n.typeAnnotation||"coerce");else x=u(x,T,n.typeAnnotation||"assert")}if(!(x instanceof Zr)&&"resolvedImage"!==x.type.kind&&Uo(x)){const T=new qi;try{x=new Zr(x.type,x.evaluate(T))}catch(I){return this.error(I.message),null}}return x}return this.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,u){const p="number"==typeof e?this.path.concat(e):this.path,y=u?this.scope.concat(u):this.scope;return new Ri(this.registry,p,n||null,y,this.errors)}error(e,...n){const u=`${this.key}${n.map(p=>`[${p}]`).join("")}`;this.errors.push(new Ko(u,e))}checkSubtype(e,n){const u=W(e,n);return u&&this.error(u),u}}var vl=Ri;function Uo(t){if(t instanceof wa)return Uo(t.boundExpression);if(t instanceof Vi&&"error"===t.name||t instanceof Bo||t instanceof al)return!1;const e=t instanceof Js||t instanceof ji;let n=!0;return t.eachChild(u=>{n=e?n&&Uo(u):n&&u instanceof Zr}),!!n&&Ya(t)&&ba(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ll(t,e){const n=t.length-1;let u,p,y=0,x=n,T=0;for(;y<=x;)if(T=Math.floor((y+x)/2),u=t[T],p=t[T+1],u<=e){if(T===n||e<p)return T;y=T+1}else{if(!(u>e))throw new zo("Input is not a number.");x=T-1}return 0}class si{constructor(e,n,u){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[p,y]of u)this.labels.push(p),this.outputs.push(y)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const u=n.parse(e[1],1,Nr);if(!u)return null;const p=[];let y=null;n.expectedType&&"value"!==n.expectedType.kind&&(y=n.expectedType);for(let x=1;x<e.length;x+=2){const T=1===x?-1/0:e[x],I=e[x+1],L=x,F=x+1;if("number"!=typeof T)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(p.length&&p[p.length-1][0]>=T)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const G=n.parse(I,F,y);if(!G)return null;y=y||G.type,p.push([T,G])}return new si(y,u,p)}evaluate(e){const n=this.labels,u=this.outputs;if(1===n.length)return u[0].evaluate(e);const p=this.input.evaluate(e);if(p<=n[0])return u[0].evaluate(e);const y=n.length;return p>=n[y-1]?u[y-1].evaluate(e):u[Ll(n,p)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var xl=si;function wn(t,e,n){return t*(1-n)+e*n}var Dl=Object.freeze({__proto__:null,number:wn,color:function(t,e,n){return new hr(wn(t.r,e.r,n),wn(t.g,e.g,n),wn(t.b,e.b,n),wn(t.a,e.a,n))},array:function(t,e,n){return t.map((u,p)=>wn(u,e[p],n))}});const uu=4/29,Ea=6/29,Ii=3*Ea*Ea,fs=Math.PI/180,Bl=180/Math.PI;function Is(t){return t>.008856451679035631?Math.pow(t,1/3):t/Ii+uu}function Fs(t){return t>Ea?t*t*t:Ii*(t-uu)}function _s(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function wu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Eu(t){const e=wu(t.r),n=wu(t.g),u=wu(t.b),p=Is((.4124564*e+.3575761*n+.1804375*u)/.95047),y=Is((.2126729*e+.7151522*n+.072175*u)/1);return{l:116*y-16,a:500*(p-y),b:200*(y-Is((.0193339*e+.119192*n+.9503041*u)/1.08883)),alpha:t.a}}function ul(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,u=isNaN(t.b)?e:e-t.b/200;return e=1*Fs(e),n=.95047*Fs(n),u=1.08883*Fs(u),new hr(_s(3.2404542*n-1.5371385*e-.4985314*u),_s(-.969266*n+1.8760108*e+.041556*u),_s(.0556434*n-.2040259*e+1.0572252*u),t.alpha)}function za(t,e,n){const u=e-t;return t+n*(u>180||u<-180?u-360*Math.round(u/360):u)}const Ha={forward:Eu,reverse:ul,interpolate:function(t,e,n){return{l:wn(t.l,e.l,n),a:wn(t.a,e.a,n),b:wn(t.b,e.b,n),alpha:wn(t.alpha,e.alpha,n)}}},Qo={forward:function(t){const{l:e,a:n,b:u}=Eu(t),p=Math.atan2(u,n)*Bl;return{h:p<0?p+360:p,c:Math.sqrt(n*n+u*u),l:e,alpha:t.a}},reverse:function(t){const e=t.h*fs,n=t.c;return ul({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:za(t.h,e.h,n),c:wn(t.c,e.c,n),l:wn(t.l,e.l,n),alpha:wn(t.alpha,e.alpha,n)}}};var Ba=Object.freeze({__proto__:null,lab:Ha,hcl:Qo});class Ua{constructor(e,n,u,p,y){this.type=e,this.operator=n,this.interpolation=u,this.input=p,this.labels=[],this.outputs=[];for(const[x,T]of y)this.labels.push(x),this.outputs.push(T)}static interpolationFactor(e,n,u,p){let y=0;if("exponential"===e.name)y=Lt(n,e.base,u,p);else if("linear"===e.name)y=Lt(n,1,u,p);else if("cubic-bezier"===e.name){const x=e.controlPoints;y=new q(x[0],x[1],x[2],x[3]).solve(Lt(n,1,u,p))}return y}static parse(e,n){let[u,p,y,...x]=e;if(!Array.isArray(p)||0===p.length)return n.error("Expected an interpolation type expression.",1);if("linear"===p[0])p={name:"linear"};else if("exponential"===p[0]){const L=p[1];if("number"!=typeof L)return n.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:L}}else{if("cubic-bezier"!==p[0])return n.error(`Unknown interpolation type ${String(p[0])}`,1,0);{const L=p.slice(1);if(4!==L.length||L.some(F=>"number"!=typeof F||F<0||F>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:L}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(y=n.parse(y,2,Nr),!y)return null;const T=[];let I=null;"interpolate-hcl"===u||"interpolate-lab"===u?I=Ws:n.expectedType&&"value"!==n.expectedType.kind&&(I=n.expectedType);for(let L=0;L<x.length;L+=2){const F=x[L],G=x[L+1],$=L+3,te=L+4;if("number"!=typeof F)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',$);if(T.length&&T[T.length-1][0]>=F)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',$);const oe=n.parse(G,te,I);if(!oe)return null;I=I||oe.type,T.push([F,oe])}return"number"===I.kind||"color"===I.kind||"array"===I.kind&&"number"===I.itemType.kind&&"number"==typeof I.N?new Ua(I,u,p,y,T):n.error(`Type ${Eo(I)} is not interpolatable.`)}evaluate(e){const n=this.labels,u=this.outputs;if(1===n.length)return u[0].evaluate(e);const p=this.input.evaluate(e);if(p<=n[0])return u[0].evaluate(e);const y=n.length;if(p>=n[y-1])return u[y-1].evaluate(e);const x=Ll(n,p),T=Ua.interpolationFactor(this.interpolation,p,n[x],n[x+1]),I=u[x].evaluate(e),L=u[x+1].evaluate(e);return"interpolate"===this.operator?Dl[this.type.kind.toLowerCase()](I,L,T):"interpolate-hcl"===this.operator?Qo.reverse(Qo.interpolate(Qo.forward(I),Qo.forward(L),T)):Ha.reverse(Ha.interpolate(Ha.forward(I),Ha.forward(L),T))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let u=0;u<this.labels.length;u++)n.push(this.labels[u],this.outputs[u].serialize());return n}}function Lt(t,e,n,u){const p=u-n,y=t-n;return 0===p?0:1===e?y/p:(Math.pow(e,y)-1)/(Math.pow(e,p)-1)}var tr=Ua;class kr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let u=null;const p=n.expectedType;p&&"value"!==p.kind&&(u=p);const y=[];for(const T of e.slice(1)){const I=n.parse(T,1+y.length,u,void 0,{typeAnnotation:"omit"});if(!I)return null;u=u||I.type,y.push(I)}const x=p&&y.some(T=>W(p,T.type));return new kr(x?ri:u,y)}evaluate(e){let n,u=null,p=0;for(const y of this.args){if(p++,u=y.evaluate(e),u&&u instanceof ao&&!u.available&&(n||(n=u),u=null,p===this.args.length))return n;if(null!==u)break}return u}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var An=kr;class go{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const u=[];for(let y=1;y<e.length-1;y+=2){const x=e[y];if("string"!=typeof x)return n.error(`Expected string, but found ${typeof x} instead.`,y);if(/[^a-zA-Z0-9_]/.test(x))return n.error("Variable names must contain only alphanumeric characters or '_'.",y);const T=n.parse(e[y+1],y+1);if(!T)return null;u.push([x,T])}const p=n.parse(e[e.length-1],e.length-1,n.expectedType,u);return p?new go(u,p):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,u]of this.bindings)e.push(n,u.serialize());return e.push(this.result.serialize()),e}}var Un=go;class fo{constructor(e,n,u){this.type=e,this.index=n,this.input=u}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=n.parse(e[1],1,Nr),p=n.parse(e[2],2,Hs(n.expectedType||ri));return u&&p?new fo(p.type.itemType,u,p):null}evaluate(e){const n=this.index.evaluate(e),u=this.input.evaluate(e);if(n<0)throw new zo(`Array index out of bounds: ${n} < 0.`);if(n>=u.length)throw new zo(`Array index out of bounds: ${n} > ${u.length-1}.`);if(n!==Math.floor(n))throw new zo(`Array index must be an integer, but found ${n} instead.`);return u[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var uo=fo;class Sa{constructor(e,n){this.type=ai,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const u=n.parse(e[1],1,ri),p=n.parse(e[2],2,ri);return u&&p?Ce(u.type,[ai,Vn,Nr,oi,ri])?new Sa(u,p):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Eo(u.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(null==u)return!1;if(!Et(n,["boolean","string","number","null"]))throw new zo(`Expected first argument to be of type boolean, string, number or null, but found ${Eo(In(n))} instead.`);if(!Et(u,["string","array"]))throw new zo(`Expected second argument to be of type array or string, but found ${Eo(In(u))} instead.`);return u.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ni=Sa;class os{constructor(e,n,u){this.type=Nr,this.needle=e,this.haystack=n,this.fromIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=n.parse(e[1],1,ri),p=n.parse(e[2],2,ri);if(!u||!p)return null;if(!Ce(u.type,[ai,Vn,Nr,oi,ri]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Eo(u.type)} instead`);if(4===e.length){const y=n.parse(e[3],3,Nr);return y?new os(u,p,y):null}return new os(u,p)}evaluate(e){const n=this.needle.evaluate(e),u=this.haystack.evaluate(e);if(!Et(n,["boolean","string","number","null"]))throw new zo(`Expected first argument to be of type boolean, string, number or null, but found ${Eo(In(n))} instead.`);if(!Et(u,["string","array"]))throw new zo(`Expected second argument to be of type array or string, but found ${Eo(In(u))} instead.`);if(this.fromIndex){const p=this.fromIndex.evaluate(e);return u.indexOf(n,p)}return u.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Da=os;class ca{constructor(e,n,u,p,y,x){this.inputType=e,this.type=n,this.input=u,this.cases=p,this.outputs=y,this.otherwise=x}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let u,p;n.expectedType&&"value"!==n.expectedType.kind&&(p=n.expectedType);const y={},x=[];for(let L=2;L<e.length-1;L+=2){let F=e[L];const G=e[L+1];Array.isArray(F)||(F=[F]);const $=n.concat(L);if(0===F.length)return $.error("Expected at least one branch label.");for(const oe of F){if("number"!=typeof oe&&"string"!=typeof oe)return $.error("Branch labels must be numbers or strings.");if("number"==typeof oe&&Math.abs(oe)>Number.MAX_SAFE_INTEGER)return $.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof oe&&Math.floor(oe)!==oe)return $.error("Numeric branch labels must be integer values.");if(u){if($.checkSubtype(u,In(oe)))return null}else u=In(oe);if(void 0!==y[String(oe)])return $.error("Branch labels must be unique.");y[String(oe)]=x.length}const te=n.parse(G,L,p);if(!te)return null;p=p||te.type,x.push(te)}const T=n.parse(e[1],1,ri);if(!T)return null;const I=n.parse(e[e.length-1],e.length-1,p);return I?"value"!==T.type.kind&&n.concat(1).checkSubtype(u,T.type)?null:new ca(u,p,T,y,x,I):null}evaluate(e){const n=this.input.evaluate(e);return(In(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),u=[],p={};for(const x of n){const T=p[this.cases[x]];void 0===T?(p[this.cases[x]]=u.length,u.push([this.cases[x],[x]])):u[T][1].push(x)}const y=x=>"number"===this.inputType.kind?Number(x):x;for(const[x,T]of u)e.push(1===T.length?y(T[0]):T.map(y)),e.push(this.outputs[x].serialize());return e.push(this.otherwise.serialize()),e}}var Ca=ca;class Oa{constructor(e,n,u){this.type=e,this.branches=n,this.otherwise=u}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let u;n.expectedType&&"value"!==n.expectedType.kind&&(u=n.expectedType);const p=[];for(let x=1;x<e.length-1;x+=2){const T=n.parse(e[x],x,ai);if(!T)return null;const I=n.parse(e[x+1],x+1,u);if(!I)return null;p.push([T,I]),u=u||I.type}const y=n.parse(e[e.length-1],e.length-1,u);return y?new Oa(u,p,y):null}evaluate(e){for(const[n,u]of this.branches)if(n.evaluate(e))return u.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,u]of this.branches)e(n),e(u);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Ja=Oa;class zs{constructor(e,n,u,p){this.type=e,this.input=n,this.beginIndex=u,this.endIndex=p}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const u=n.parse(e[1],1,ri),p=n.parse(e[2],2,Nr);if(!u||!p)return null;if(!Ce(u.type,[Hs(ri),Vn,ri]))return n.error(`Expected first argument to be of type array or string, but found ${Eo(u.type)} instead`);if(4===e.length){const y=n.parse(e[3],3,Nr);return y?new zs(u.type,u,p,y):null}return new zs(u.type,u,p)}evaluate(e){const n=this.input.evaluate(e),u=this.beginIndex.evaluate(e);if(!Et(n,["string","array"]))throw new zo(`Expected first argument to be of type array or string, but found ${Eo(In(n))} instead.`);if(this.endIndex){const p=this.endIndex.evaluate(e);return n.slice(u,p)}return n.slice(u)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var es=zs;function cl(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function vs(t,e,n,u){return 0===u.compare(e,n)}function Ks(t,e,n){const u="=="!==t&&"!="!==t;return class m_{constructor(y,x,T){this.type=ai,this.lhs=y,this.rhs=x,this.collator=T,this.hasUntypedArgument="value"===y.type.kind||"value"===x.type.kind}static parse(y,x){if(3!==y.length&&4!==y.length)return x.error("Expected two or three arguments.");const T=y[0];let I=x.parse(y[1],1,ri);if(!I)return null;if(!cl(T,I.type))return x.concat(1).error(`"${T}" comparisons are not supported for type '${Eo(I.type)}'.`);let L=x.parse(y[2],2,ri);if(!L)return null;if(!cl(T,L.type))return x.concat(2).error(`"${T}" comparisons are not supported for type '${Eo(L.type)}'.`);if(I.type.kind!==L.type.kind&&"value"!==I.type.kind&&"value"!==L.type.kind)return x.error(`Cannot compare types '${Eo(I.type)}' and '${Eo(L.type)}'.`);u&&("value"===I.type.kind&&"value"!==L.type.kind?I=new ji(L.type,[I]):"value"!==I.type.kind&&"value"===L.type.kind&&(L=new ji(I.type,[L])));let F=null;if(4===y.length){if("string"!==I.type.kind&&"string"!==L.type.kind&&"value"!==I.type.kind&&"value"!==L.type.kind)return x.error("Cannot use collator to compare non-string types.");if(F=x.parse(y[3],3,va),!F)return null}return new m_(I,L,F)}evaluate(y){const x=this.lhs.evaluate(y),T=this.rhs.evaluate(y);if(u&&this.hasUntypedArgument){const I=In(x),L=In(T);if(I.kind!==L.kind||"string"!==I.kind&&"number"!==I.kind)throw new zo(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${I.kind}, ${L.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const I=In(x),L=In(T);if("string"!==I.kind||"string"!==L.kind)return e(y,x,T)}return this.collator?n(y,x,T,this.collator.evaluate(y)):e(y,x,T)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}serialize(){const y=[t];return this.eachChild(x=>{y.push(x.serialize())}),y}}}const Ul=Ks("==",function(t,e,n){return e===n},vs),vo=Ks("!=",function(t,e,n){return e!==n},function(t,e,n,u){return!vs(0,e,n,u)}),Pi=Ks("<",function(t,e,n){return e<n},function(t,e,n,u){return u.compare(e,n)<0}),Ka=Ks(">",function(t,e,n){return e>n},function(t,e,n,u){return u.compare(e,n)>0}),Qs=Ks("<=",function(t,e,n){return e<=n},function(t,e,n,u){return u.compare(e,n)<=0}),ds=Ks(">=",function(t,e,n){return e>=n},function(t,e,n,u){return u.compare(e,n)>=0});class Go{constructor(e,n,u,p,y,x){this.type=Vn,this.number=e,this.locale=n,this.currency=u,this.unit=p,this.minFractionDigits=y,this.maxFractionDigits=x}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const u=n.parse(e[1],1,Nr);if(!u)return null;const p=e[2];if("object"!=typeof p||Array.isArray(p))return n.error("NumberFormat options argument must be an object.");let y=null;if(p.locale&&(y=n.parse(p.locale,1,Vn),!y))return null;let x=null;if(p.currency&&(x=n.parse(p.currency,1,Vn),!x))return null;let T=null;if(p.unit&&(T=n.parse(p.unit,1,Vn),!T))return null;let I=null;if(p["min-fraction-digits"]&&(I=n.parse(p["min-fraction-digits"],1,Nr),!I))return null;let L=null;return p["max-fraction-digits"]&&(L=n.parse(p["max-fraction-digits"],1,Nr),!L)?null:new Go(u,y,x,T,I,L)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Lo{constructor(e){this.type=Nr,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const u=n.parse(e[1],1);return u?"array"!==u.type.kind&&"string"!==u.type.kind&&"value"!==u.type.kind?n.error(`Expected argument of type string or array, but found ${Eo(u.type)} instead.`):new Lo(u):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new zo(`Expected value to be of type string or array, but found ${Eo(In(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Ol={"==":Ul,"!=":vo,">":Ka,"<":Pi,">=":ds,"<=":Qs,array:ji,at:uo,boolean:ji,case:Ja,coalesce:An,collator:Bo,format:Xo,image:Ns,in:Ni,"index-of":Da,interpolate:tr,"interpolate-hcl":tr,"interpolate-lab":tr,length:Lo,let:Un,literal:Zr,match:Ca,number:ji,"number-format":Go,object:ji,slice:es,step:xl,string:ji,"to-boolean":Js,"to-color":Js,"to-number":Js,"to-string":Js,var:wa,within:al};function Ga(t,[e,n,u,p]){e=e.evaluate(t),n=n.evaluate(t),u=u.evaluate(t);const y=p?p.evaluate(t):1,x=fr(e,n,u,y);if(x)throw new zo(x);return new hr(e/255*y,n/255*y,u/255*y,y)}function hl(t,e){return t in e}function So(t,e){const n=e[t];return void 0===n?null:n}function Bi(t){return{type:t}}Vi.register(Ol,{error:[{kind:"error"},[Vn],(t,[e])=>{throw new zo(e.evaluate(t))}],typeof:[Vn,[ri],(t,[e])=>Eo(In(e.evaluate(t)))],"to-rgba":[Hs(Nr,4),[Ws],(t,[e])=>e.evaluate(t).toArray()],rgb:[Ws,[Nr,Nr,Nr],Ga],rgba:[Ws,[Nr,Nr,Nr,Nr],Ga],has:{type:ai,overloads:[[[Vn],(t,[e])=>hl(e.evaluate(t),t.properties())],[[Vn,hi],(t,[e,n])=>hl(e.evaluate(t),n.evaluate(t))]]},get:{type:ri,overloads:[[[Vn],(t,[e])=>So(e.evaluate(t),t.properties())],[[Vn,hi],(t,[e,n])=>So(e.evaluate(t),n.evaluate(t))]]},"feature-state":[ri,[Vn],(t,[e])=>So(e.evaluate(t),t.featureState||{})],properties:[hi,[],t=>t.properties()],"geometry-type":[Vn,[],t=>t.geometryType()],id:[ri,[],t=>t.id()],zoom:[Nr,[],t=>t.globals.zoom],pitch:[Nr,[],t=>t.globals.pitch||0],"distance-from-center":[Nr,[],t=>t.distanceFromCenter()],"heatmap-density":[Nr,[],t=>t.globals.heatmapDensity||0],"line-progress":[Nr,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Nr,[],t=>t.globals.skyRadialProgress||0],accumulated:[ri,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Nr,Bi(Nr),(t,e)=>{let n=0;for(const u of e)n+=u.evaluate(t);return n}],"*":[Nr,Bi(Nr),(t,e)=>{let n=1;for(const u of e)n*=u.evaluate(t);return n}],"-":{type:Nr,overloads:[[[Nr,Nr],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Nr],(t,[e])=>-e.evaluate(t)]]},"/":[Nr,[Nr,Nr],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Nr,[Nr,Nr],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Nr,[],()=>Math.LN2],pi:[Nr,[],()=>Math.PI],e:[Nr,[],()=>Math.E],"^":[Nr,[Nr,Nr],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Nr,[Nr],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Nr,[Nr],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Nr,[Nr],(t,[e])=>Math.log(e.evaluate(t))],log2:[Nr,[Nr],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Nr,[Nr],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Nr,[Nr],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Nr,[Nr],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Nr,[Nr],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Nr,[Nr],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Nr,[Nr],(t,[e])=>Math.atan(e.evaluate(t))],min:[Nr,Bi(Nr),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Nr,Bi(Nr),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Nr,[Nr],(t,[e])=>Math.abs(e.evaluate(t))],round:[Nr,[Nr],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Nr,[Nr],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Nr,[Nr],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[ai,[Vn,ri],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[ai,[ri],(t,[e])=>t.id()===e.value],"filter-type-==":[ai,[Vn],(t,[e])=>t.geometryType()===e.value],"filter-<":[ai,[Vn,ri],(t,[e,n])=>{const u=t.properties()[e.value],p=n.value;return typeof u==typeof p&&u<p}],"filter-id-<":[ai,[ri],(t,[e])=>{const n=t.id(),u=e.value;return typeof n==typeof u&&n<u}],"filter->":[ai,[Vn,ri],(t,[e,n])=>{const u=t.properties()[e.value],p=n.value;return typeof u==typeof p&&u>p}],"filter-id->":[ai,[ri],(t,[e])=>{const n=t.id(),u=e.value;return typeof n==typeof u&&n>u}],"filter-<=":[ai,[Vn,ri],(t,[e,n])=>{const u=t.properties()[e.value],p=n.value;return typeof u==typeof p&&u<=p}],"filter-id-<=":[ai,[ri],(t,[e])=>{const n=t.id(),u=e.value;return typeof n==typeof u&&n<=u}],"filter->=":[ai,[Vn,ri],(t,[e,n])=>{const u=t.properties()[e.value],p=n.value;return typeof u==typeof p&&u>=p}],"filter-id->=":[ai,[ri],(t,[e])=>{const n=t.id(),u=e.value;return typeof n==typeof u&&n>=u}],"filter-has":[ai,[ri],(t,[e])=>e.value in t.properties()],"filter-has-id":[ai,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[ai,[Hs(Vn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[ai,[Hs(ri)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[ai,[Vn,Hs(ri)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[ai,[Vn,Hs(ri)],(t,[e,n])=>function(u,p,y,x){for(;y<=x;){const T=y+x>>1;if(p[T]===u)return!0;p[T]>u?x=T-1:y=T+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:ai,overloads:[[[ai,ai],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Bi(ai),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:ai,overloads:[[[ai,ai],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Bi(ai),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[ai,[ai],(t,[e])=>!e.evaluate(t)],"is-supported-script":[ai,[Vn],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Vn,[Vn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Vn,[Vn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Vn,Bi(ri),(t,e)=>e.map(n=>xn(n.evaluate(t))).join("")],"resolved-locale":[Vn,[va],(t,[e])=>e.evaluate(t).resolvedLocale()]});var ea=Ol;function ta(t){return{result:"success",value:t}}function ha(t){return{result:"error",value:t}}function Ta(t){return"data-driven"===t["property-type"]}function ra(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Bs(t){return!!t.expression&&t.expression.interpolated}function Ei(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function jo(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function uc(t){return t}function ja(t,e){const n="color"===e.type,u=t.stops&&"object"==typeof t.stops[0][0],p=u||!(u||void 0!==t.property),y=t.type||(Bs(e)?"exponential":"interval");if(n&&((t=hs({},t)).stops&&(t.stops=t.stops.map(L=>[L[0],hr.parse(L[1])])),t.default=hr.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Ba[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let x,T,I;if("exponential"===y)x=hu;else if("interval"===y)x=cu;else if("categorical"===y){x=Qa,T=Object.create(null);for(const L of t.stops)T[L[0]]=L[1];I=typeof t.stops[0][0]}else{if("identity"!==y)throw new Error(`Unknown function type "${y}"`);x=el}if(u){const L={},F=[];for(let te=0;te<t.stops.length;te++){const oe=t.stops[te],me=oe[0].zoom;void 0===L[me]&&(L[me]={zoom:me,type:t.type,property:t.property,default:t.default,stops:[]},F.push(me)),L[me].stops.push([oe[0].value,oe[1]])}const G=[];for(const te of F)G.push([L[te].zoom,ja(L[te],e)]);const $={name:"linear"};return{kind:"composite",interpolationType:$,interpolationFactor:tr.interpolationFactor.bind(void 0,$),zoomStops:G.map(te=>te[0]),evaluate:({zoom:te},oe)=>hu({stops:G,base:t.base},e,te).evaluate(te,oe)}}if(p){const L="exponential"===y?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:tr.interpolationFactor.bind(void 0,L),zoomStops:t.stops.map(F=>F[0]),evaluate:({zoom:F})=>x(t,e,F,T,I)}}return{kind:"source",evaluate(L,F){const G=F&&F.properties?F.properties[t.property]:void 0;return void 0===G?ss(t.default,e.default):x(t,e,G,T,I)}}}function ss(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Qa(t,e,n,u,p){return ss(typeof n===p?u[n]:void 0,t.default,e.default)}function cu(t,e,n){if("number"!==Ei(n))return ss(t.default,e.default);const u=t.stops.length;if(1===u||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[u-1][0])return t.stops[u-1][1];const p=Ll(t.stops.map(y=>y[0]),n);return t.stops[p][1]}function hu(t,e,n){const u=void 0!==t.base?t.base:1;if("number"!==Ei(n))return ss(t.default,e.default);const p=t.stops.length;if(1===p||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[p-1][0])return t.stops[p-1][1];const y=Ll(t.stops.map(F=>F[0]),n),x=function(F,G,$,te){const oe=te-$,me=F-$;return 0===oe?0:1===G?me/oe:(Math.pow(G,me)-1)/(Math.pow(G,oe)-1)}(n,u,t.stops[y][0],t.stops[y+1][0]),T=t.stops[y][1],I=t.stops[y+1][1];let L=Dl[e.type]||uc;if(t.colorSpace&&"rgb"!==t.colorSpace){const F=Ba[t.colorSpace];L=(G,$)=>F.reverse(F.interpolate(F.forward(G),F.forward($),x))}return"function"==typeof T.evaluate?{evaluate(...F){const G=T.evaluate.apply(void 0,F),$=I.evaluate.apply(void 0,F);if(void 0!==G&&void 0!==$)return L(G,$,x)}}:L(T,I,x)}function el(t,e,n){return"color"===e.type?n=hr.parse(n):"formatted"===e.type?n=yn.fromString(n.toString()):"resolvedImage"===e.type?n=ao.fromString(n.toString()):Ei(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),ss(n,t.default,e.default)}class Gl{constructor(e,n){var u;this.expression=e,this._warningHistory={},this._evaluator=new qi,this._defaultValue=n?"color"===(u=n).type&&(jo(u.default)||Array.isArray(u.default))?new hr(0,0,0,0):"color"===u.type?hr.parse(u.default)||null:void 0===u.default?null:u.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,u,p,y,x,T,I){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=u,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=I||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,u,p,y,x,T,I){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=u||null,this._evaluator.canonical=p||null,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=T||null,this._evaluator.featureDistanceData=I||null;try{const L=this.expression.evaluate(this._evaluator);if(null==L||"number"==typeof L&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new zo(`Expected value to be one of ${Object.keys(this._enumValues).map(F=>JSON.stringify(F)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function Ps(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in ea}function Ma(t,e){const n=new vl(ea,[],e?function(p){const y={color:Ws,string:Vn,number:Nr,enum:Vn,boolean:ai,formatted:zl,resolvedImage:$n};return"array"===p.type?Hs(y[p.value]||ri,p.length):y[p.type]}(e):void 0),u=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return u?ta(new Gl(u,e)):ha(n.errors)}class xo{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent="constant"!==e&&!ll(n.expression)}evaluateWithoutErrorHandling(e,n,u,p,y,x){return this._styleExpression.evaluateWithoutErrorHandling(e,n,u,p,y,x)}evaluate(e,n,u,p,y,x){return this._styleExpression.evaluate(e,n,u,p,y,x)}}class cc{constructor(e,n,u,p){this.kind=e,this.zoomStops=u,this._styleExpression=n,this.isStateDependent="camera"!==e&&!ll(n.expression),this.interpolationType=p}evaluateWithoutErrorHandling(e,n,u,p,y,x){return this._styleExpression.evaluateWithoutErrorHandling(e,n,u,p,y,x)}evaluate(e,n,u,p,y,x){return this._styleExpression.evaluate(e,n,u,p,y,x)}interpolationFactor(e,n,u){return this.interpolationType?tr.interpolationFactor(this.interpolationType,e,n,u):0}}function Wu(t,e){if("error"===(t=Ma(t,e)).result)return t;const n=t.value.expression,u=Ya(n);if(!u&&!Ta(e))return ha([new Ko("","data expressions not supported")]);const p=ba(n,["zoom","pitch","distance-from-center"]);if(!p&&!ra(e))return ha([new Ko("","zoom expressions not supported")]);const y=bl(n);return y||p?y instanceof Ko?ha([y]):y instanceof tr&&!Bs(e)?ha([new Ko("",'"interpolate" expressions cannot be used with this property')]):ta(y?new cc(u?"camera":"composite",t.value,y.labels,y instanceof tr?y.interpolation:void 0):new xo(u?"constant":"source",t.value)):ha([new Ko("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class xs{constructor(e,n){this._parameters=e,this._specification=n,hs(this,ja(this._parameters,this._specification))}static deserialize(e){return new xs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function bl(t){let e=null;if(t instanceof Un)e=bl(t.result);else if(t instanceof An){for(const n of t.args)if(e=bl(n),e)break}else(t instanceof xl||t instanceof tr)&&t.input instanceof Vi&&"zoom"===t.input.name&&(e=t);return e instanceof Ko||t.eachChild(n=>{const u=bl(n);u instanceof Ko?e=u:!e&&u?e=new Ko("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&u&&e!==u&&(e=new Ko("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Hr{constructor(e,n,u,p){this.message=(e?`${e}: `:"")+u,p&&(this.identifier=p),null!=n&&n.__line__&&(this.line=n.__line__)}}function Ia(t){const e=t.key,n=t.value,u=t.valueSpec||{},p=t.objectElementValidators||{},y=t.style,x=t.styleSpec;let T=[];const I=Ei(n);if("object"!==I)return[new Hr(e,n,`object expected, ${I} found`)];for(const L in n){const F=L.split(".")[0],G=u[F]||u["*"];let $;p[F]?$=p[F]:u[F]?$=r:p["*"]?$=p["*"]:u["*"]&&($=r),$?T=T.concat($({key:(e&&`${e}.`)+L,value:n[L],valueSpec:G,style:y,styleSpec:x,object:n,objectKey:L},n)):T.push(new Hr(e,n[L],`unknown property "${L}"`))}for(const L in u)p[L]||u[L].required&&void 0===u[L].default&&void 0===n[L]&&T.push(new Hr(e,n,`missing required property "${L}"`));return T}function pl(t){const e=t.value,n=t.valueSpec,u=t.style,p=t.styleSpec,y=t.key,x=t.arrayElementValidator||r;if("array"!==Ei(e))return[new Hr(y,e,`array expected, ${Ei(e)} found`)];if(n.length&&e.length!==n.length)return[new Hr(y,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Hr(y,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let T={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};p.$version<7&&(T.function=n.function),"object"===Ei(n.value)&&(T=n.value);let I=[];for(let L=0;L<e.length;L++)I=I.concat(x({array:e,arrayIndex:L,value:e[L],valueSpec:T,style:u,styleSpec:p,key:`${y}[${L}]`}));return I}function As(t){const e=t.key,n=t.value,u=t.valueSpec;let p=Ei(n);if("number"===p&&n!=n&&(p="NaN"),"number"!==p)return[new Hr(e,n,`number expected, ${p} found`)];if("minimum"in u){let y=u.minimum;if("array"===Ei(u.minimum)&&(y=u.minimum[t.arrayIndex]),n<y)return[new Hr(e,n,`${n} is less than the minimum value ${y}`)]}if("maximum"in u){let y=u.maximum;if("array"===Ei(u.maximum)&&(y=u.maximum[t.arrayIndex]),n>y)return[new Hr(e,n,`${n} is greater than the maximum value ${y}`)]}return[]}function pa(t){const e=t.valueSpec,n=Kn(t.value.type);let u,p,y,x={};const T="categorical"!==n&&void 0===t.value.property,I=!T,L="array"===Ei(t.value.stops)&&"array"===Ei(t.value.stops[0])&&"object"===Ei(t.value.stops[0][0]),F=Ia({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(te){if("identity"===n)return[new Hr(te.key,te.value,'identity function may not have a "stops" property')];let oe=[];const me=te.value;return oe=oe.concat(pl({key:te.key,value:me,valueSpec:te.valueSpec,style:te.style,styleSpec:te.styleSpec,arrayElementValidator:G})),"array"===Ei(me)&&0===me.length&&oe.push(new Hr(te.key,me,"array must have at least one stop")),oe},default:function(te){return r({key:te.key,value:te.value,valueSpec:e,style:te.style,styleSpec:te.styleSpec})}}});return"identity"===n&&T&&F.push(new Hr(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||F.push(new Hr(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!Bs(t.valueSpec)&&F.push(new Hr(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(I&&!Ta(t.valueSpec)?F.push(new Hr(t.key,t.value,"property functions not supported")):T&&!ra(t.valueSpec)&&F.push(new Hr(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!L||void 0!==t.value.property||F.push(new Hr(t.key,t.value,'"property" property is required')),F;function G(te){let oe=[];const me=te.value,Pe=te.key;if("array"!==Ei(me))return[new Hr(Pe,me,`array expected, ${Ei(me)} found`)];if(2!==me.length)return[new Hr(Pe,me,`array length 2 expected, length ${me.length} found`)];if(L){if("object"!==Ei(me[0]))return[new Hr(Pe,me,`object expected, ${Ei(me[0])} found`)];if(void 0===me[0].zoom)return[new Hr(Pe,me,"object stop key must have zoom")];if(void 0===me[0].value)return[new Hr(Pe,me,"object stop key must have value")];const tt=Kn(me[0].zoom);if("number"!=typeof tt)return[new Hr(Pe,me[0].zoom,"stop zoom values must be numbers")];if(y&&y>tt)return[new Hr(Pe,me[0].zoom,"stop zoom values must appear in ascending order")];tt!==y&&(y=tt,p=void 0,x={}),oe=oe.concat(Ia({key:`${Pe}[0]`,value:me[0],valueSpec:{zoom:{}},style:te.style,styleSpec:te.styleSpec,objectElementValidators:{zoom:As,value:$}}))}else oe=oe.concat($({key:`${Pe}[0]`,value:me[0],valueSpec:{},style:te.style,styleSpec:te.styleSpec},me));return Ps(Jo(me[1]))?oe.concat([new Hr(`${Pe}[1]`,me[1],"expressions are not allowed in function stops.")]):oe.concat(r({key:`${Pe}[1]`,value:me[1],valueSpec:e,style:te.style,styleSpec:te.styleSpec}))}function $(te,oe){const me=Ei(te.value),Pe=Kn(te.value),tt=null!==te.value?te.value:oe;if(u){if(me!==u)return[new Hr(te.key,tt,`${me} stop domain type must match previous stop domain type ${u}`)]}else u=me;if("number"!==me&&"string"!==me&&"boolean"!==me&&"number"!=typeof Pe&&"string"!=typeof Pe&&"boolean"!=typeof Pe)return[new Hr(te.key,tt,"stop domain value must be a number, string, or boolean")];if("number"!==me&&"categorical"!==n){let ut=`number expected, ${me} found`;return Ta(e)&&void 0===n&&(ut+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Hr(te.key,tt,ut)]}return"categorical"!==n||"number"!==me||"number"==typeof Pe&&isFinite(Pe)&&Math.floor(Pe)===Pe?"categorical"!==n&&"number"===me&&"number"==typeof Pe&&"number"==typeof p&&void 0!==p&&Pe<p?[new Hr(te.key,tt,"stop domain values must appear in ascending order")]:(p=Pe,"categorical"===n&&Pe in x?[new Hr(te.key,tt,"stop domain values must be unique")]:(x[Pe]=!0,[])):[new Hr(te.key,tt,`integer expected, found ${String(Pe)}`)]}}function jl(t){const e=("property"===t.expressionContext?Wu:Ma)(Jo(t.value),t.valueSpec);if("error"===e.result)return e.value.map(u=>new Hr(`${t.key}${u.key}`,t.value,u.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new Hr(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!ll(n))return[new Hr(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return fa(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!ba(n,["zoom","feature-state"]))return[new Hr(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Ya(n))return[new Hr(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function fa(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const p of e.valueSpec.expression.parameters)n.delete(p);if(0===n.size)return[];const u=[];return t instanceof Vi&&n.has(t.name)?[new Hr(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(p=>{u.push(...fa(p,e))}),u)}function pu(t){const e=t.key,n=t.value,u=t.valueSpec,p=[];return Array.isArray(u.values)?-1===u.values.indexOf(Kn(n))&&p.push(new Hr(e,n,`expected one of [${u.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(u.values).indexOf(Kn(n))&&p.push(new Hr(e,n,`expected one of [${Object.keys(u.values).join(", ")}], ${JSON.stringify(n)} found`)),p}function fu(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!fu(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function as(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};fu(t)||(t=qa(t));const n=t;let u=!0;try{u=function(L){if(!Ru(L))return L;let F=Jo(L);return rl(F),F=tl(F),F}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const p=ur[`filter_${e}`],y=Ma(u,p);let x=null;if("error"===y.result)throw new Error(y.value.map(L=>`${L.key}: ${L.message}`).join(", "));x=(L,F,G)=>y.value.evaluate(L,F,{},G);let T=null,I=null;if(u!==n){const L=Ma(n,p);if("error"===L.result)throw new Error(L.value.map(F=>`${F.key}: ${F.message}`).join(", "));T=(F,G,$,te,oe)=>L.value.evaluate(F,G,{},$,void 0,void 0,te,oe),I=!Ya(L.value.expression)}return{filter:x,dynamicFilter:T||void 0,needGeometry:uh(u),needFeature:!!I}}function tl(t){if(!Array.isArray(t))return t;const e=function(n){if(hc.has(n[0]))for(let u=1;u<n.length;u++)if(Ru(n[u]))return!0;return n}(t);return!0===e?e:e.map(n=>tl(n))}function rl(t){let e=!1;const n=[];if("case"===t[0]){for(let u=1;u<t.length-1;u+=2)e=e||Ru(t[u]),n.push(t[u+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||Ru(t[1]);for(let u=2;u<t.length-1;u+=2)n.push(t[u+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||Ru(t[1]);for(let u=1;u<t.length-1;u+=2)n.push(t[u+1])}e&&(t.length=0,t.push("any",...n));for(let u=1;u<t.length;u++)rl(t[u])}function Ru(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(Ru(t[n]))return!0;return!1}const hc=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Mp(t,e){return t<e?-1:t>e?1:0}function uh(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(uh(t[e]))return!0;return!1}function qa(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?du(t[1],t[2],"=="):"!="===e?Vl(du(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?du(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(qa))):"all"===e?["all"].concat(t.slice(1).map(qa)):"none"===e?["all"].concat(t.slice(1).map(qa).map(Vl)):"in"===e?ql(t[1],t.slice(2)):"!in"===e?Vl(ql(t[1],t.slice(2))):"has"===e?Fc(t[1]):"!has"===e?Vl(Fc(t[1])):"within"!==e||t;var n}function du(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function ql(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Mp)]]:["filter-in-small",t,["literal",e]]}}function Fc(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Vl(t){return["!",t]}function fl(t){return fu(Jo(t.value))?jl(hs({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Nu(t)}function Nu(t){const e=t.value,n=t.key;if("array"!==Ei(e))return[new Hr(n,e,`array expected, ${Ei(e)} found`)];const u=t.styleSpec;let p,y=[];if(e.length<1)return[new Hr(n,e,"filter array must have at least 1 element")];switch(y=y.concat(pu({key:`${n}[0]`,value:e[0],valueSpec:u.filter_operator,style:t.style,styleSpec:t.styleSpec})),Kn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Kn(e[1])&&y.push(new Hr(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&y.push(new Hr(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(p=Ei(e[1]),"string"!==p&&y.push(new Hr(`${n}[1]`,e[1],`string expected, ${p} found`)));for(let x=2;x<e.length;x++)p=Ei(e[x]),"$type"===Kn(e[1])?y=y.concat(pu({key:`${n}[${x}]`,value:e[x],valueSpec:u.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==p&&"number"!==p&&"boolean"!==p&&y.push(new Hr(`${n}[${x}]`,e[x],`string, number, or boolean expected, ${p} found`));break;case"any":case"all":case"none":for(let x=1;x<e.length;x++)y=y.concat(Nu({key:`${n}[${x}]`,value:e[x],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":p=Ei(e[1]),2!==e.length?y.push(new Hr(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==p&&y.push(new Hr(`${n}[1]`,e[1],`string expected, ${p} found`));break;case"within":p=Ei(e[1]),2!==e.length?y.push(new Hr(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==p&&y.push(new Hr(`${n}[1]`,e[1],`object expected, ${p} found`))}return y}function Hl(t,e){const n=t.key,u=t.style,p=t.styleSpec,y=t.value,x=t.objectKey,T=p[`${e}_${t.layerType}`];if(!T)return[];const I=x.match(/^(.*)-transition$/);if("paint"===e&&I&&T[I[1]]&&T[I[1]].transition)return r({key:n,value:y,valueSpec:p.transition,style:u,styleSpec:p});const L=t.valueSpec||T[x];if(!L)return[new Hr(n,y,`unknown property "${x}"`)];let F;if("string"===Ei(y)&&Ta(L)&&!L.tokens&&(F=/^{([^}]+)}$/.exec(y)))return[new Hr(n,y,`"${x}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const G=[];return"symbol"===t.layerType&&("text-field"===x&&u&&!u.glyphs&&G.push(new Hr(n,y,'use of "text-field" requires a style "glyphs" property')),"text-font"===x&&jo(Jo(y))&&"identity"===Kn(y.type)&&G.push(new Hr(n,y,'"text-font" does not support identity functions'))),G.concat(r({key:t.key,value:y,valueSpec:L,style:u,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:x}))}function kl(t){return Hl(t,"paint")}function Zn(t){return Hl(t,"layout")}function Rl(t){let e=[];const n=t.value,u=t.key,p=t.style,y=t.styleSpec;n.type||n.ref||e.push(new Hr(u,n,'either "type" or "ref" is required'));let x=Kn(n.type);const T=Kn(n.ref);if(n.id){const I=Kn(n.id);for(let L=0;L<t.arrayIndex;L++){const F=p.layers[L];Kn(F.id)===I&&e.push(new Hr(u,n.id,`duplicate layer id "${n.id}", previously used at line ${F.id.__line__}`))}}if("ref"in n){let I;["type","source","source-layer","filter","layout"].forEach(L=>{L in n&&e.push(new Hr(u,n[L],`"${L}" is prohibited for ref layers`))}),p.layers.forEach(L=>{Kn(L.id)===T&&(I=L)}),I?I.ref?e.push(new Hr(u,n.ref,"ref cannot reference another ref layer")):x=Kn(I.type):"string"==typeof T&&e.push(new Hr(u,n.ref,`ref layer "${T}" not found`))}else if("background"!==x&&"sky"!==x)if(n.source){const I=p.sources&&p.sources[n.source],L=I&&Kn(I.type);I?"vector"===L&&"raster"===x?e.push(new Hr(u,n.source,`layer "${n.id}" requires a raster source`)):"raster"===L&&"raster"!==x?e.push(new Hr(u,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==L||n["source-layer"]?"raster-dem"===L&&"hillshade"!==x?e.push(new Hr(u,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==x||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===L&&I.lineMetrics||e.push(new Hr(u,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Hr(u,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Hr(u,n.source,`source "${n.source}" not found`))}else e.push(new Hr(u,n,'missing required property "source"'));return e=e.concat(Ia({key:u,value:n,valueSpec:y.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>r({key:`${u}.type`,value:n.type,valueSpec:y.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:I=>fl(hs({layerType:x},I)),layout:I=>Ia({layer:n,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":L=>Zn(hs({layerType:x},L))}}),paint:I=>Ia({layer:n,key:I.key,value:I.value,valueSpec:{},style:I.style,styleSpec:I.styleSpec,objectElementValidators:{"*":L=>kl(hs({layerType:x},L))}})}})),e}function Pa(t){const e=t.value,n=t.key,u=Ei(e);return"string"!==u?[new Hr(n,e,`string expected, ${u} found`)]:[]}const Jl={promoteId:function({key:t,value:e}){if("string"===Ei(e))return Pa({key:t,value:e});{const n=[];for(const u in e)n.push(...Pa({key:`${t}.${u}`,value:e[u]}));return n}}};function Va(t){const e=t.value,n=t.key,u=t.styleSpec,p=t.style;if(!e.type)return[new Hr(n,e,'"type" is required')];const y=Kn(e.type);let x;switch(y){case"vector":case"raster":case"raster-dem":return x=Ia({key:n,value:e,valueSpec:u[`source_${y.replace("-","_")}`],style:t.style,styleSpec:u,objectElementValidators:Jl}),x;case"geojson":if(x=Ia({key:n,value:e,valueSpec:u.source_geojson,style:p,styleSpec:u,objectElementValidators:Jl}),e.cluster)for(const T in e.clusterProperties){const[I,L]=e.clusterProperties[T],F="string"==typeof I?[I,["accumulated"],["get",T]]:I;x.push(...jl({key:`${n}.${T}.map`,value:L,expressionContext:"cluster-map"})),x.push(...jl({key:`${n}.${T}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return x;case"video":return Ia({key:n,value:e,valueSpec:u.source_video,style:p,styleSpec:u});case"image":return Ia({key:n,value:e,valueSpec:u.source_image,style:p,styleSpec:u});case"canvas":return[new Hr(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return pu({key:`${n}.type`,value:e.type,valueSpec:{values:ch(u)},style:p,styleSpec:u})}}function ch(t){return t.source.reduce((e,n)=>{const u=t[n];return"enum"===u.type.type&&(e=e.concat(Object.keys(u.type.values))),e},[])}function Za(t){const e=t.value,n=t.styleSpec,u=n.light,p=t.style;let y=[];const x=Ei(e);if(void 0===e)return y;if("object"!==x)return y=y.concat([new Hr("light",e,`object expected, ${x} found`)]),y;for(const T in e){const I=T.match(/^(.*)-transition$/);y=y.concat(I&&u[I[1]]&&u[I[1]].transition?r({key:T,value:e[T],valueSpec:n.transition,style:p,styleSpec:n}):u[T]?r({key:T,value:e[T],valueSpec:u[T],style:p,styleSpec:n}):[new Hr(T,e[T],`unknown property "${T}"`)])}return y}function ts(t){const e=t.value,n=t.key,u=t.style,p=t.styleSpec,y=p.terrain;let x=[];const T=Ei(e);if(void 0===e)return x;if("object"!==T)return x=x.concat([new Hr("terrain",e,`object expected, ${T} found`)]),x;for(const I in e){const L=I.match(/^(.*)-transition$/);x=x.concat(L&&y[L[1]]&&y[L[1]].transition?r({key:I,value:e[I],valueSpec:p.transition,style:u,styleSpec:p}):y[I]?r({key:I,value:e[I],valueSpec:y[I],style:u,styleSpec:p}):[new Hr(I,e[I],`unknown property "${I}"`)])}if(e.source){const I=u.sources&&u.sources[e.source],L=I&&Kn(I.type);I?"raster-dem"!==L&&x.push(new Hr(n,e.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):x.push(new Hr(n,e.source,`source "${e.source}" not found`))}else x.push(new Hr(n,e,'terrain is missing required property "source"'));return x}function zc(t){const e=t.value,n=t.style,u=t.styleSpec,p=u.fog;let y=[];const x=Ei(e);if(void 0===e)return y;if("object"!==x)return y=y.concat([new Hr("fog",e,`object expected, ${x} found`)]),y;for(const T in e){const I=T.match(/^(.*)-transition$/);y=y.concat(I&&p[I[1]]&&p[I[1]].transition?r({key:T,value:e[T],valueSpec:u.transition,style:n,styleSpec:u}):p[T]?r({key:T,value:e[T],valueSpec:p[T],style:n,styleSpec:u}):[new Hr(T,e[T],`unknown property "${T}"`)])}return y}const Hu={"*":()=>[],array:pl,boolean:function(t){const e=t.value,n=t.key,u=Ei(e);return"boolean"!==u?[new Hr(n,e,`boolean expected, ${u} found`)]:[]},number:As,color:function(t){const e=t.key,n=t.value,u=Ei(n);return"string"!==u?[new Hr(e,n,`color expected, ${u} found`)]:null===Gt(n)?[new Hr(e,n,`color expected, "${n}" found`)]:[]},enum:pu,filter:fl,function:pa,layer:Rl,object:Ia,source:Va,light:Za,terrain:ts,fog:zc,string:Pa,formatted:function(t){return 0===Pa(t).length?[]:jl(t)},resolvedImage:function(t){return 0===Pa(t).length?[]:jl(t)},projection:function(t){const e=t.value,n=t.styleSpec,u=n.projection,p=t.style;let y=[];const x=Ei(e);if("object"===x)for(const T in e)y=y.concat(r({key:T,value:e[T],valueSpec:u[T],style:p,styleSpec:n}));else"string"!==x&&(y=y.concat([new Hr("projection",e,`object or string expected, ${x} found`)]));return y}};function r(t){const e=t.value,n=t.valueSpec,u=t.styleSpec;return n.expression&&jo(Kn(e))?pa(t):n.expression&&Ps(Jo(e))?jl(t):n.type&&Hu[n.type]?Hu[n.type](t):Ia(hs({},t,{valueSpec:n.type?u[n.type]:n}))}function s(t){const e=t.value,n=t.key,u=Pa(t);return u.length||(-1===e.indexOf("{fontstack}")&&u.push(new Hr(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&u.push(new Hr(n,e,'"glyphs" url must include a "{range}" token'))),u}function f(t,e=ur){return k(r({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:s,"*":()=>[]}}))}const m=t=>k(kl(t)),S=t=>k(Zn(t));function k(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function V(t,e){let n=!1;if(e&&e.length)for(const u of e)t.fire(new Ts(new Error(u.message))),n=!0;return n}var de=Re;function Re(t,e,n){var u=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var p=new Int32Array(this.arrayBuffer);t=p[0],this.d=(e=p[1])+2*(n=p[2]);for(var y=0;y<this.d*this.d;y++){var x=p[3+y],T=p[3+y+1];u.push(x===T?null:p.subarray(x,T))}var I=p[3+u.length+1];this.keys=p.subarray(p[3+u.length],I),this.bboxes=p.subarray(I),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var L=0;L<this.d*this.d;L++)u.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var F=n/e*t;this.min=-F,this.max=t+F}Re.prototype.insert=function(t,e,n,u,p){this._forEachCell(e,n,u,p,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(u),this.bboxes.push(p)},Re.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Re.prototype._insertCell=function(t,e,n,u,p,y){this.cells[p].push(y)},Re.prototype.query=function(t,e,n,u,p){var y=this.min,x=this.max;if(t<=y&&e<=y&&x<=n&&x<=u&&!p)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(t,e,n,u,this._queryCell,T,{},p),T},Re.prototype._queryCell=function(t,e,n,u,p,y,x,T){var I=this.cells[p];if(null!==I)for(var L=this.keys,F=this.bboxes,G=0;G<I.length;G++){var $=I[G];if(void 0===x[$]){var te=4*$;(T?T(F[te+0],F[te+1],F[te+2],F[te+3]):t<=F[te+2]&&e<=F[te+3]&&n>=F[te+0]&&u>=F[te+1])?(x[$]=!0,y.push(L[$])):x[$]=!1}}},Re.prototype._forEachCell=function(t,e,n,u,p,y,x,T){for(var I=this._convertToCellCoord(t),L=this._convertToCellCoord(e),F=this._convertToCellCoord(n),G=this._convertToCellCoord(u),$=I;$<=F;$++)for(var te=L;te<=G;te++){var oe=this.d*te+$;if((!T||T(this._convertFromCellCoord($),this._convertFromCellCoord(te),this._convertFromCellCoord($+1),this._convertFromCellCoord(te+1)))&&p.call(this,t,e,n,u,oe,y,x,T))return}},Re.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Re.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Re.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,u=0;u<this.cells.length;u++)n+=this.cells[u].length;var p=new Int32Array(e+n+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var y=e,x=0;x<t.length;x++){var T=t[x];p[3+x]=y,p.set(T,y),y+=T.length}return p[3+t.length]=y,p.set(this.keys,y),p[3+t.length+1]=y+=this.keys.length,p.set(this.bboxes,y),y+=this.bboxes.length,p.buffer};const yt={};function gt(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),yt[e]={klass:t,omit:n.omit||[]}}gt(Object,"Object"),de.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},de.deserialize=function(t){return new de(t.buffer)},Object.defineProperty(de,"name",{value:"Grid"}),gt(de,"Grid"),gt(hr,"Color"),gt(Error,"Error"),gt(Lr,"AJAXError"),gt(ao,"ResolvedImage"),gt(xs,"StylePropertyFunction"),gt(Gl,"StyleExpression",{omit:["_evaluator"]}),gt(cc,"ZoomDependentExpression"),gt(xo,"ZoomConstantExpression"),gt(Vi,"CompoundExpression",{omit:["_evaluate"]});for(const t in ea)yt[ea[t]._classRegistryKey]||gt(ea[t],`Expression${t}`);function ar(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Gr(t){return Z.ImageBitmap&&t instanceof Z.ImageBitmap}function Br(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ar(t)||Gr(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof Z.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const u of t)n.push(Br(u,e));return n}if("object"==typeof t){const n=t.constructor,u=n._classRegistryKey;if(!u)throw new Error(`can't serialize object of unregistered class ${u}`);const p=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const y in t)t.hasOwnProperty(y)&&(yt[u].omit.indexOf(y)>=0||(p[y]=Br(t[y],e)));t instanceof Error&&(p.message=t.message)}if(p.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(p.$name=u),p}throw new Error("can't serialize object of type "+typeof t)}function sn(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ar(t)||Gr(t)||ArrayBuffer.isView(t)||t instanceof Z.ImageData)return t;if(Array.isArray(t))return t.map(sn);if("object"==typeof t){const e=t.$name||"Object",{klass:n}=yt[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const u=Object.create(n.prototype);for(const p of Object.keys(t))"$name"!==p&&(u[p]=sn(t[p]));return u}throw new Error("can't deserialize object of type "+typeof t)}const Mn=t=>t>=1536&&t<=1791,no=t=>t>=1872&&t<=1919,ls=t=>t>=2208&&t<=2303,na=t=>t>=11904&&t<=12031,wl=t=>t>=12032&&t<=12255,Nl=t=>t>=12272&&t<=12287,Su=t=>t>=12288&&t<=12351,Bc=t=>t>=12352&&t<=12447,hh=t=>t>=12448&&t<=12543,pc=t=>t>=12544&&t<=12591,zh=t=>t>=12704&&t<=12735,Bh=t=>t>=12736&&t<=12783,Uh=t=>t>=12784&&t<=12799,Uc=t=>t>=12800&&t<=13055,Ip=t=>t>=13056&&t<=13311,fc=t=>t>=13312&&t<=19903,Fu=t=>t>=19968&&t<=40959,Pp=t=>t>=40960&&t<=42127,Bf=t=>t>=42128&&t<=42191,Ap=t=>t>=44032&&t<=55215,dc=t=>t>=63744&&t<=64255,g=t=>t>=64336&&t<=65023,i=t=>t>=65040&&t<=65055,h=t=>t>=65072&&t<=65103,_=t=>t>=65104&&t<=65135,E=t=>t>=65136&&t<=65279,M=t=>t>=65280&&t<=65519;function O(t){for(const e of t)if(Q(e.charCodeAt(0)))return!0;return!1}function N(t){for(const e of t)if(!B(e.charCodeAt(0)))return!1;return!0}function B(t){return!(Mn(t)||no(t)||ls(t)||g(t)||E(t))}function Q(t){return!(746!==t&&747!==t&&(t<4352||!(zh(t)||pc(t)||h(t)&&!(t>=65097&&t<=65103)||dc(t)||Ip(t)||na(t)||Bh(t)||!(!Su(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||fc(t)||Fu(t)||Uc(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||Ap(t)||Bc(t)||Nl(t)||(e=>e>=12688&&e<=12703)(t)||wl(t)||Uh(t)||hh(t)&&12540!==t||!(!M(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!_(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||i(t)||(e=>e>=19904&&e<=19967)(t)||Pp(t)||Bf(t))));var e}function J(t){return!(Q(t)||(e=t,(n=e)>=128&&n<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(n=>n>=8192&&n<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&9251!==e||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Su(e)||hh(e)||(n=>n>=57344&&n<=63743)(e)||h(e)||_(e)||M(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,n}function fe(t){return t>=1424&&t<=2303||g(t)||E(t)}function Ie(t,e){return!(!e&&fe(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(n=t,n>=6016&&n<=6143));var n}function je(t){for(const e of t)if(fe(e.charCodeAt(0)))return!0;return!1}const Be="deferred",Ve="loading",Le="loaded";let De=null,He="unavailable",Xe=null;const at=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(He="error"),De&&De(t)};function _t(){mt.fire(new Ho("pluginStateChange",{pluginStatus:He,pluginURL:Xe}))}const mt=new ki,It=function(){return He},Ht=function(){if(He!==Be||!Xe)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");He=Ve,_t(),Xe&&Jn({url:Xe},t=>{t?at(t):(He=Le,_t())})},jt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>He===Le||null!=jt.applyArabicShaping,isLoading:()=>He===Ve,setState(t){He=t.pluginStatus,Xe=t.pluginURL},isParsed:()=>null!=jt.applyArabicShaping&&null!=jt.processBidirectionalText&&null!=jt.processStyledBidirectionalText,getPluginURL:()=>Xe};class Rt{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,u){for(const p of n)if(!Ie(p.charCodeAt(0),u))return!1;return!0}(e,jt.isLoaded())}}class Dr{constructor(e,n){this.property=e,this.value=n,this.expression=function(u,p){if(jo(u))return new xs(u,p);if(Ps(u)){const y=Wu(u,p);if("error"===y.result)throw new Error(y.value.map(x=>`${x.key}: ${x.message}`).join(", "));return y.value}{let y=u;return"string"==typeof u&&"color"===p.type&&(y=hr.parse(u)),{kind:"constant",evaluate:()=>y}}}(void 0===n?e.specification.default:n,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,u){return this.property.possiblyEvaluate(this,e,n,u)}}class Ut{constructor(e){this.property=e,this.value=new Dr(e,void 0)}transitioned(e,n){return new er(this.property,this.value,n,Ae({},e.transition,this.transition),e.now)}untransitioned(){return new er(this.property,this.value,null,{},0)}}class pr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return zr(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Ut(this._values[e].property)),this._values[e].value=new Dr(this._values[e].property,null===n?void 0:zr(n))}getTransition(e){return zr(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Ut(this._values[e].property)),this._values[e].transition=zr(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const u=this.getValue(n);void 0!==u&&(e[n]=u);const p=this.getTransition(n);void 0!==p&&(e[`${n}-transition`]=p)}return e}transitioned(e,n){const u=new Tr(this._properties);for(const p of Object.keys(this._values))u._values[p]=this._values[p].transitioned(e,n._values[p]);return u}untransitioned(){const e=new Tr(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class er{constructor(e,n,u,p,y){const x=p.delay||0,T=p.duration||0;y=y||0,this.property=e,this.value=n,this.begin=y+x,this.end=this.begin+T,e.specification.transition&&(p.delay||p.duration)&&(this.prior=u)}possiblyEvaluate(e,n,u){const p=e.now||0,y=this.value.possiblyEvaluate(e,n,u),x=this.prior;if(x){if(p>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(p<this.begin)return x.possiblyEvaluate(e,n,u);{const T=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(e,n,u),y,nt(T))}}return y}}class Tr{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,u){const p=new Or(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(e,n,u);return p}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ir{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return zr(this._values[e].value)}setValue(e,n){this._values[e]=new Dr(this._values[e].property,null===n?void 0:zr(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const u=this.getValue(n);void 0!==u&&(e[n]=u)}return e}possiblyEvaluate(e,n,u){const p=new Or(this._properties);for(const y of Object.keys(this._values))p._values[y]=this._values[y].possiblyEvaluate(e,n,u);return p}}class vr{constructor(e,n,u){this.property=e,this.value=n,this.parameters=u}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,u,p){return this.property.evaluate(this.value,this.parameters,e,n,u,p)}}class Or{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class zt{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,u){const p=Dl[this.specification.type];return p?p(e,n,u):e}}class Kt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,u,p){return new vr(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},u,p)}:e.expression,n)}interpolate(e,n,u){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new vr(this,{kind:"constant",value:void 0},e.parameters);const p=Dl[this.specification.type];return p?new vr(this,{kind:"constant",value:p(e.value.value,n.value.value,u)},e.parameters):e}evaluate(e,n,u,p,y,x){return"constant"===e.kind?e.value:e.evaluate(n,u,p,y,x)}}class fn{constructor(e){this.specification=e}possiblyEvaluate(e,n,u,p){return!!e.expression.evaluate(n,null,{},u,p)}interpolate(){return!1}}class Ln{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new Rt(0,{});for(const u in e){const p=e[u];p.specification.overridable&&this.overridableProperties.push(u);const y=this.defaultPropertyValues[u]=new Dr(p,void 0),x=this.defaultTransitionablePropertyValues[u]=new Ut(p);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate(n)}}}function gn(t,e){return 256*(t=Ee(Math.floor(t),0,255))+Ee(Math.floor(e),0,255)}gt(Kt,"DataDrivenProperty"),gt(zt,"DataConstantProperty"),gt(fn,"ColorRampProperty");const Nn={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class gi{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Pn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Kr(t,e=1){let n=0,u=0;return{members:t.map(p=>{const y=Nn[p.type].BYTES_PER_ELEMENT,x=n=Do(n,Math.max(e,y)),T=p.components||1;return u=Math.max(u,y),n+=y*T,{name:p.name,type:p.type,components:T,offset:x}}),size:Do(n,Math.max(u,e)),alignment:e}}function Do(t,e){return Math.ceil(t/e)*e}class mo extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const u=this.length;return this.resize(u+1),this.emplace(u,e,n)}emplace(e,n,u){const p=2*e;return this.int16[p+0]=n,this.int16[p+1]=u,e}}mo.prototype.bytesPerElement=4,gt(mo,"StructArrayLayout2i4");class Yo extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,u)}emplace(e,n,u,p){const y=3*e;return this.int16[y+0]=n,this.int16[y+1]=u,this.int16[y+2]=p,e}}Yo.prototype.bytesPerElement=6,gt(Yo,"StructArrayLayout3i6");class yo extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,u,p)}emplace(e,n,u,p,y){const x=4*e;return this.int16[x+0]=n,this.int16[x+1]=u,this.int16[x+2]=p,this.int16[x+3]=y,e}}yo.prototype.bytesPerElement=8,gt(yo,"StructArrayLayout4i8");class dl extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,p,y,x,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,u,p,y,x,T)}emplace(e,n,u,p,y,x,T,I){const L=6*e,F=12*e,G=3*e;return this.int16[L+0]=n,this.int16[L+1]=u,this.uint8[F+4]=p,this.uint8[F+5]=y,this.uint8[F+6]=x,this.uint8[F+7]=T,this.float32[G+2]=I,e}}dl.prototype.bytesPerElement=12,gt(dl,"StructArrayLayout2i4ub1f12");class El extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,u,p)}emplace(e,n,u,p,y){const x=4*e;return this.float32[x+0]=n,this.float32[x+1]=u,this.float32[x+2]=p,this.float32[x+3]=y,e}}El.prototype.bytesPerElement=16,gt(El,"StructArrayLayout4f16");class Sl extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,p,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,u,p,y)}emplace(e,n,u,p,y,x){const T=6*e,I=3*e;return this.uint16[T+0]=n,this.uint16[T+1]=u,this.uint16[T+2]=p,this.uint16[T+3]=y,this.float32[I+2]=x,e}}Sl.prototype.bytesPerElement=12,gt(Sl,"StructArrayLayout4ui1f12");class gu extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,u,p)}emplace(e,n,u,p,y){const x=4*e;return this.uint16[x+0]=n,this.uint16[x+1]=u,this.uint16[x+2]=p,this.uint16[x+3]=y,e}}gu.prototype.bytesPerElement=8,gt(gu,"StructArrayLayout4ui8");class rs extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,u,p,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,u,p,y,x)}emplace(e,n,u,p,y,x,T){const I=6*e;return this.int16[I+0]=n,this.int16[I+1]=u,this.int16[I+2]=p,this.int16[I+3]=y,this.int16[I+4]=x,this.int16[I+5]=T,e}}rs.prototype.bytesPerElement=12,gt(rs,"StructArrayLayout6i12");class Oo extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,u,p,y,x,T,I,L,F,G,$){const te=this.length;return this.resize(te+1),this.emplace(te,e,n,u,p,y,x,T,I,L,F,G,$)}emplace(e,n,u,p,y,x,T,I,L,F,G,$,te){const oe=12*e;return this.int16[oe+0]=n,this.int16[oe+1]=u,this.int16[oe+2]=p,this.int16[oe+3]=y,this.uint16[oe+4]=x,this.uint16[oe+5]=T,this.uint16[oe+6]=I,this.uint16[oe+7]=L,this.int16[oe+8]=F,this.int16[oe+9]=G,this.int16[oe+10]=$,this.int16[oe+11]=te,e}}Oo.prototype.bytesPerElement=24,gt(Oo,"StructArrayLayout4i4ui4i24");class Si extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,p,y,x){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,u,p,y,x)}emplace(e,n,u,p,y,x,T){const I=10*e,L=5*e;return this.int16[I+0]=n,this.int16[I+1]=u,this.int16[I+2]=p,this.float32[L+2]=y,this.float32[L+3]=x,this.float32[L+4]=T,e}}Si.prototype.bytesPerElement=20,gt(Si,"StructArrayLayout3i3f20");class Us extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Us.prototype.bytesPerElement=4,gt(Us,"StructArrayLayout1ul4");class Co extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,u,p,y,x,T,I,L,F,G,$,te){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,n,u,p,y,x,T,I,L,F,G,$,te)}emplace(e,n,u,p,y,x,T,I,L,F,G,$,te,oe){const me=20*e,Pe=10*e;return this.int16[me+0]=n,this.int16[me+1]=u,this.int16[me+2]=p,this.int16[me+3]=y,this.int16[me+4]=x,this.float32[Pe+3]=T,this.float32[Pe+4]=I,this.float32[Pe+5]=L,this.float32[Pe+6]=F,this.int16[me+14]=G,this.uint32[Pe+8]=$,this.uint16[me+18]=te,this.uint16[me+19]=oe,e}}Co.prototype.bytesPerElement=40,gt(Co,"StructArrayLayout5i4f1i1ul2ui40");class Fi extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,u,p,y,x,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,n,u,p,y,x,T)}emplace(e,n,u,p,y,x,T,I){const L=8*e;return this.int16[L+0]=n,this.int16[L+1]=u,this.int16[L+2]=p,this.int16[L+4]=y,this.int16[L+5]=x,this.int16[L+6]=T,this.int16[L+7]=I,e}}Fi.prototype.bytesPerElement=16,gt(Fi,"StructArrayLayout3i2i2i16");class bo extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,u,p,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,u,p,y)}emplace(e,n,u,p,y,x){const T=4*e,I=8*e;return this.float32[T+0]=n,this.float32[T+1]=u,this.float32[T+2]=p,this.int16[I+6]=y,this.int16[I+7]=x,e}}bo.prototype.bytesPerElement=16,gt(bo,"StructArrayLayout2f1f2i16");class Gs extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,u,p)}emplace(e,n,u,p,y){const x=12*e,T=3*e;return this.uint8[x+0]=n,this.uint8[x+1]=u,this.float32[T+1]=p,this.float32[T+2]=y,e}}Gs.prototype.bytesPerElement=12,gt(Gs,"StructArrayLayout2ub2f12");class fi extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,u)}emplace(e,n,u,p){const y=3*e;return this.float32[y+0]=n,this.float32[y+1]=u,this.float32[y+2]=p,e}}fi.prototype.bytesPerElement=12,gt(fi,"StructArrayLayout3f12");class Yn extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,u){const p=this.length;return this.resize(p+1),this.emplace(p,e,n,u)}emplace(e,n,u,p){const y=3*e;return this.uint16[y+0]=n,this.uint16[y+1]=u,this.uint16[y+2]=p,e}}Yn.prototype.bytesPerElement=6,gt(Yn,"StructArrayLayout3ui6");class ii extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,u,p,y,x,T,I,L,F,G,$,te,oe,me,Pe,tt,ut,Ke,lt,vt){const ht=this.length;return this.resize(ht+1),this.emplace(ht,e,n,u,p,y,x,T,I,L,F,G,$,te,oe,me,Pe,tt,ut,Ke,lt,vt)}emplace(e,n,u,p,y,x,T,I,L,F,G,$,te,oe,me,Pe,tt,ut,Ke,lt,vt,ht){const $t=30*e,Zt=15*e,cr=60*e;return this.int16[$t+0]=n,this.int16[$t+1]=u,this.int16[$t+2]=p,this.float32[Zt+2]=y,this.float32[Zt+3]=x,this.uint16[$t+8]=T,this.uint16[$t+9]=I,this.uint32[Zt+5]=L,this.uint32[Zt+6]=F,this.uint32[Zt+7]=G,this.uint16[$t+16]=$,this.uint16[$t+17]=te,this.uint16[$t+18]=oe,this.float32[Zt+10]=me,this.float32[Zt+11]=Pe,this.uint8[cr+48]=tt,this.uint8[cr+49]=ut,this.uint8[cr+50]=Ke,this.uint32[Zt+13]=lt,this.int16[$t+28]=vt,this.uint8[cr+58]=ht,e}}ii.prototype.bytesPerElement=60,gt(ii,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class li extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,u,p,y,x,T,I,L,F,G,$,te,oe,me,Pe,tt,ut,Ke,lt,vt,ht,$t,Zt,cr,Pr,Qt,dr,yr,Sr){const Ir=this.length;return this.resize(Ir+1),this.emplace(Ir,e,n,u,p,y,x,T,I,L,F,G,$,te,oe,me,Pe,tt,ut,Ke,lt,vt,ht,$t,Zt,cr,Pr,Qt,dr,yr,Sr)}emplace(e,n,u,p,y,x,T,I,L,F,G,$,te,oe,me,Pe,tt,ut,Ke,lt,vt,ht,$t,Zt,cr,Pr,Qt,dr,yr,Sr,Ir){const nr=38*e,qr=19*e;return this.int16[nr+0]=n,this.int16[nr+1]=u,this.int16[nr+2]=p,this.float32[qr+2]=y,this.float32[qr+3]=x,this.int16[nr+8]=T,this.int16[nr+9]=I,this.int16[nr+10]=L,this.int16[nr+11]=F,this.int16[nr+12]=G,this.int16[nr+13]=$,this.uint16[nr+14]=te,this.uint16[nr+15]=oe,this.uint16[nr+16]=me,this.uint16[nr+17]=Pe,this.uint16[nr+18]=tt,this.uint16[nr+19]=ut,this.uint16[nr+20]=Ke,this.uint16[nr+21]=lt,this.uint16[nr+22]=vt,this.uint16[nr+23]=ht,this.uint16[nr+24]=$t,this.uint16[nr+25]=Zt,this.uint16[nr+26]=cr,this.uint16[nr+27]=Pr,this.uint16[nr+28]=Qt,this.uint32[qr+15]=dr,this.float32[qr+16]=yr,this.float32[qr+17]=Sr,this.float32[qr+18]=Ir,e}}li.prototype.bytesPerElement=76,gt(li,"StructArrayLayout3i2f6i15ui1ul3f76");class ui extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}ui.prototype.bytesPerElement=4,gt(ui,"StructArrayLayout1f4");class bi extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,u,p,y){const x=this.length;return this.resize(x+1),this.emplace(x,e,n,u,p,y)}emplace(e,n,u,p,y,x){const T=5*e;return this.float32[T+0]=n,this.float32[T+1]=u,this.float32[T+2]=p,this.float32[T+3]=y,this.float32[T+4]=x,e}}bi.prototype.bytesPerElement=20,gt(bi,"StructArrayLayout5f20");class _i extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,u,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,u,p)}emplace(e,n,u,p,y){const x=6*e;return this.uint32[3*e+0]=n,this.uint16[x+2]=u,this.uint16[x+3]=p,this.uint16[x+4]=y,e}}_i.prototype.bytesPerElement=12,gt(_i,"StructArrayLayout1ul3ui12");class ci extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const u=this.length;return this.resize(u+1),this.emplace(u,e,n)}emplace(e,n,u){const p=2*e;return this.uint16[p+0]=n,this.uint16[p+1]=u,e}}ci.prototype.bytesPerElement=4,gt(ci,"StructArrayLayout2ui4");class Ai extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Ai.prototype.bytesPerElement=2,gt(Ai,"StructArrayLayout1ui2");class zi extends Pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const u=this.length;return this.resize(u+1),this.emplace(u,e,n)}emplace(e,n,u){const p=2*e;return this.float32[p+0]=n,this.float32[p+1]=u,e}}zi.prototype.bytesPerElement=8,gt(zi,"StructArrayLayout2f8");class Zi extends gi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Zi.prototype.size=40;class Ui extends Co{get(e){return new Zi(this,e)}}gt(Ui,"CollisionBoxArray");class Xi extends gi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Xi.prototype.size=60;class $i extends ii{get(e){return new Xi(this,e)}}gt($i,"PlacedSymbolArray");class Yi extends gi{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Yi.prototype.size=76;class Wi extends li{get(e){return new Yi(this,e)}}gt(Wi,"SymbolInstanceArray");class Hi extends ui{getoffsetX(e){return this.float32[1*e+0]}}gt(Hi,"GlyphOffsetArray");class Ji extends mo{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}gt(Ji,"SymbolLineVertexArray");class Ki extends gi{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Ki.prototype.size=12;class Qi extends _i{get(e){return new Ki(this,e)}}gt(Qi,"FeatureIndexArray");class eo extends ci{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}gt(eo,"FillExtrusionCentroidArray");const io=Kr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),oo=Kr([{name:"a_dash",components:4,type:"Uint16"}]);var Ci={exports:{}},Op=function(t,e){var n,u,p,y,x,T,I,L;for(u=t.length-(n=3&t.length),p=e,x=3432918353,T=461845907,L=0;L<u;)I=255&t.charCodeAt(L)|(255&t.charCodeAt(++L))<<8|(255&t.charCodeAt(++L))<<16|(255&t.charCodeAt(++L))<<24,++L,p=27492+(65535&(y=5*(65535&(p=(p^=I=(65535&(I=(I=(65535&I)*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(I=0,n){case 3:I^=(255&t.charCodeAt(L+2))<<16;case 2:I^=(255&t.charCodeAt(L+1))<<8;case 1:p^=I=(65535&(I=(I=(65535&(I^=255&t.charCodeAt(L)))*x+(((I>>>16)*x&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return p^=t.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0},Uf=function(t,e){for(var n,u=t.length,p=e^u,y=0;u>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(y)|(255&t.charCodeAt(++y))<<8|(255&t.charCodeAt(++y))<<16|(255&t.charCodeAt(++y))<<24))+((1540483477*(n>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),u-=4,++y;switch(u){case 3:p^=(255&t.charCodeAt(y+2))<<16;case 2:p^=(255&t.charCodeAt(y+1))<<8;case 1:p=1540483477*(65535&(p^=255&t.charCodeAt(y)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0};Ci.exports=Op,Ci.exports.murmur3=Op,Ci.exports.murmur2=Uf;class ph{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,u,p){this.ids.push(kp(e)),this.positions.push(n,u,p)}getPositions(e){const n=kp(e);let u=0,p=this.ids.length-1;for(;u<p;){const x=u+p>>1;this.ids[x]>=n?p=x:u=x+1}const y=[];for(;this.ids[u]===n;)y.push({index:this.positions[3*u],start:this.positions[3*u+1],end:this.positions[3*u+2]}),u++;return y}static serialize(e,n){const u=new Float64Array(e.ids),p=new Uint32Array(e.positions);return Gh(u,p,0,u.length-1),n&&n.push(u.buffer,p.buffer),{ids:u,positions:p}}static deserialize(e){const n=new ph;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function kp(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Ci.exports(String(t))}function Gh(t,e,n,u){for(;n<u;){const p=t[n+u>>1];let y=n-1,x=u+1;for(;;){do{y++}while(t[y]<p);do{x--}while(t[x]>p);if(y>=x)break;fh(t,y,x),fh(e,3*y,3*x),fh(e,3*y+1,3*x+1),fh(e,3*y+2,3*x+2)}x-n<u-x?(Gh(t,e,n,x),n=x+1):(Gh(t,e,x+1,u),u=x)}}function fh(t,e,n){const u=t[e];t[e]=t[n],t[n]=u}gt(ph,"FeaturePositionMap");class Ju{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Rp extends Ju{constructor(e){super(e),this.current=0}set(e,n,u){this.fetchUniformLocation(e,n)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class jd extends Ju{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,u){this.fetchUniformLocation(e,n)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class qd extends Ju{constructor(e){super(e),this.current=hr.transparent}set(e,n,u){this.fetchUniformLocation(e,n)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const bm=new Float32Array(16),wm=new Float32Array(9),Em=new Float32Array(4);function Gf(t){return[gn(255*t.r,255*t.g),gn(255*t.b,255*t.a)]}class jh{constructor(e,n,u){this.value=e,this.uniformNames=n.map(p=>`u_${p}`),this.type=u}setUniform(e,n,u,p,y){n.set(e,y,p.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new qd(e):new Rp(e)}}class dh{constructor(e,n){this.uniformNames=n.map(u=>`u_${u}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,u,p,y){const x="u_pattern"===y||"u_dash"===y?this.pattern:"u_pixel_ratio"===y?this.pixelRatio:null;x&&n.set(e,y,x)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new jd(e):new Rp(e)}}class Ku{constructor(e,n,u,p){this.expression=e,this.type=u,this.maxValue=0,this.paintVertexAttributes=n.map(y=>({name:`a_${y}`,type:"Float32",components:"color"===u?2:1,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,n,u,p,y,x){const T=this.paintVertexArray.length,I=this.expression.evaluate(new Rt(0),n,{},y,p,x);this.paintVertexArray.resize(e),this._setPaintValue(T,e,I)}updatePaintArray(e,n,u,p,y){const x=this.expression.evaluate({zoom:0},u,p,void 0,y);this._setPaintValue(e,n,x)}_setPaintValue(e,n,u){if("color"===this.type){const p=Gf(u);for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,p[0],p[1])}else{for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Cu{constructor(e,n,u,p,y,x){this.expression=e,this.uniformNames=n.map(T=>`u_${T}_t`),this.type=u,this.useIntegerZoom=p,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=n.map(T=>({name:`a_${T}`,type:"Float32",components:"color"===u?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(e,n,u,p,y,x){const T=this.expression.evaluate(new Rt(this.zoom),n,{},y,p,x),I=this.expression.evaluate(new Rt(this.zoom+1),n,{},y,p,x),L=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(L,e,T,I)}updatePaintArray(e,n,u,p,y){const x=this.expression.evaluate({zoom:this.zoom},u,p,void 0,y),T=this.expression.evaluate({zoom:this.zoom+1},u,p,void 0,y);this._setPaintValue(e,n,x,T)}_setPaintValue(e,n,u,p){if("color"===this.type){const y=Gf(u),x=Gf(p);for(let T=e;T<n;T++)this.paintVertexArray.emplace(T,y[0],y[1],x[0],x[1])}else{for(let y=e;y<n;y++)this.paintVertexArray.emplace(y,u,p);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(p))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,u,p,y){const x=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,T=Ee(this.expression.interpolationFactor(x,this.zoom,this.zoom+1),0,1);n.set(e,y,T)}getBinding(e,n){return new Rp(e)}}class gc{constructor(e,n,u,p,y){this.expression=e,this.layerId=y,this.paintVertexAttributes=("array"===u?oo:io).members;for(let x=0;x<n.length;++x);this.paintVertexArray=new p}populatePaintArray(e,n,u){const p=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(p,e,n.patterns&&n.patterns[this.layerId],u)}updatePaintArray(e,n,u,p,y,x){this._setPaintValues(e,n,u.patterns&&u.patterns[this.layerId],x)}_setPaintValues(e,n,u,p){if(!p||!u)return;const y=p[u];if(!y)return;const{tl:x,br:T,pixelRatio:I}=y;for(let L=e;L<n;L++)this.paintVertexArray.emplace(L,x[0],x[1],T[0],T[1],I)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class mc{constructor(e,n,u=(()=>!0)){this.binders={},this._buffers=[];const p=[];for(const y in e.paint._values){if(!u(y))continue;const x=e.paint.get(y);if(!(x instanceof vr&&Ta(x.property.specification)))continue;const T=Cm(y,e.type),I=x.value,L=x.property.specification.type,F=x.property.useIntegerZoom,G="line-dasharray"===y||y.endsWith("pattern"),$="line-dasharray"===y&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==I.kind||$)if("source"===I.kind||$||G){const te=Vd(y,L,"source");this.binders[y]=G?new gc(I,T,L,te,e.id):new Ku(I,T,L,te),p.push(`/a_${y}`)}else{const te=Vd(y,L,"composite");this.binders[y]=new Cu(I,T,L,F,n,te),p.push(`/z_${y}`)}else this.binders[y]=G?new dh(I.value,T):new jh(I.value,T,L),p.push(`/u_${y}`)}this.cacheKey=p.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Ku||n instanceof Cu?n.maxValue:0}populatePaintArrays(e,n,u,p,y,x){for(const T in this.binders){const I=this.binders[T];(I instanceof Ku||I instanceof Cu||I instanceof gc)&&I.populatePaintArray(e,n,u,p,y,x)}}setConstantPatternPositions(e){for(const n in this.binders){const u=this.binders[n];u instanceof dh&&u.setConstantPatternPositions(e)}}updatePaintArrays(e,n,u,p,y,x){let T=!1;for(const I in e){const L=n.getPositions(I);for(const F of L){const G=u.feature(F.index);for(const $ in this.binders){const te=this.binders[$];if((te instanceof Ku||te instanceof Cu||te instanceof gc)&&!0===te.expression.isStateDependent){const oe=p.paint.get($);te.expression=oe.value,te.updatePaintArray(F.start,F.end,G,e[I],y,x),T=!0}}}}return T}defines(){const e=[];for(const n in this.binders){const u=this.binders[n];(u instanceof jh||u instanceof dh)&&e.push(...u.uniformNames.map(p=>`#define HAS_UNIFORM_${p}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const u=this.binders[n];if(u instanceof Ku||u instanceof Cu||u instanceof gc)for(let p=0;p<u.paintVertexAttributes.length;p++)e.push(u.paintVertexAttributes[p].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const u=this.binders[n];if(u instanceof jh||u instanceof dh||u instanceof Cu)for(const p of u.uniformNames)e.push(p)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const u in this.binders){const p=this.binders[u];if(p instanceof jh||p instanceof dh||p instanceof Cu)for(const y of p.uniformNames)n.push({name:y,property:u,binding:p.getBinding(e,y)})}return n}setUniforms(e,n,u,p,y){for(const{name:x,property:T,binding:I}of u)this.binders[T].setUniform(e,I,y,p.get(T),x)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Ku||n instanceof Cu||n instanceof gc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const u=this.binders[n];(u instanceof Ku||u instanceof Cu||u instanceof gc)&&u.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Ku||n instanceof Cu||n instanceof gc)&&n.destroy()}}}class Gc{constructor(e,n,u=(()=>!0)){this.programConfigurations={};for(const p of e)this.programConfigurations[p.id]=new mc(p,n,u);this.needsUpload=!1,this._featureMap=new ph,this._bufferOffset=0}populatePaintArrays(e,n,u,p,y,x,T){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,n,p,y,x,T);void 0!==n.id&&this._featureMap.add(n.id,u,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,u,p,y){for(const x of u)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,n,x,p,y)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Sm={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Cm(t,e){return Sm[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Tm={"line-pattern":{source:Sl,composite:Sl},"fill-pattern":{source:Sl,composite:Sl},"fill-extrusion-pattern":{source:Sl,composite:Sl},"line-dasharray":{source:gu,composite:gu}},Mm={color:{source:zi,composite:El},number:{source:ui,composite:zi}};function Vd(t,e,n){const u=Tm[t];return u&&u[n]||Mm[e][n]}gt(jh,"ConstantBinder"),gt(dh,"PatternConstantBinder"),gt(Ku,"SourceExpressionBinder"),gt(gc,"PatternCompositeBinder"),gt(Cu,"CompositeExpressionBinder"),gt(mc,"ProgramConfiguration",{omit:["_buffers"]}),gt(Gc,"ProgramConfigurationSet");const Np="-transition";class Tu extends ki{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new ir(n.layout)),n.paint)){this._transitionablePaint=new pr(n.paint);for(const u in e.paint)this.setPaintProperty(u,e.paint[u],{validate:!1});for(const u in e.layout)this.setLayoutProperty(u,e.layout[u],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Or(n.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,u={}){null!=n&&this._validate(S,`layers.${this.id}.layout.${e}`,e,n,u)||("visibility"!==e?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return Ft(e,Np)?this._transitionablePaint.getTransition(e.slice(0,-Np.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,u={}){if(null!=n&&this._validate(m,`layers.${this.id}.paint.${e}`,e,n,u))return!1;if(Ft(e,Np))return this._transitionablePaint.setTransition(e.slice(0,-Np.length),n||void 0),!1;{const p=this._transitionablePaint._values[e],y=p.value.isDataDriven(),x=p.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const T=this._transitionablePaint._values[e].value,I=T.isDataDriven(),L=Ft(e,"pattern")||"line-dasharray"===e;return I||y||L||this._handleOverridablePaintPropertyUpdate(e,x,T)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,u){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Fr(e,(n,u)=>!(void 0===n||"layout"===u&&!Object.keys(n).length||"paint"===u&&!Object.keys(n).length))}_validate(e,n,u,p,y={}){return(!y||!1!==y.validate)&&V(this,e.call(f,{key:n,layerType:this.type,objectKey:u,value:p,styleSpec:ur,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof vr&&Ta(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=as(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Im=Kr([{name:"a_pos",components:2,type:"Int16"}],4),Pm=Kr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class da{constructor(e=[]){this.segments=e}prepareSegment(e,n,u,p){let y=this.segments[this.segments.length-1];return e>da.MAX_VERTEX_ARRAY_LENGTH&&Ar(`Max vertices per segment is ${da.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!y||y.vertexLength+e>da.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==p)&&(y={vertexOffset:n.length,primitiveOffset:u.length,vertexLength:0,primitiveLength:0},void 0!==p&&(y.sortKey=p),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,u,p){return new da([{vertexOffset:e,primitiveOffset:n,vertexLength:u,primitiveLength:p,vaos:{},sortKey:0}])}}da.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,gt(da,"SegmentVector");var Gn=8192;class yc{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof so?new so(e.lng,e.lat):so.convert(e),this}setSouthWest(e){return this._sw=e instanceof so?new so(e.lng,e.lat):so.convert(e),this}extend(e){const n=this._sw,u=this._ne;let p,y;if(e instanceof so)p=e,y=e;else{if(!(e instanceof yc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(yc.convert(e)):this.extend(so.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(so.convert(e)):this;if(p=e._sw,y=e._ne,!p||!y)return this}return n||u?(n.lng=Math.min(p.lng,n.lng),n.lat=Math.min(p.lat,n.lat),u.lng=Math.max(y.lng,u.lng),u.lat=Math.max(y.lat,u.lat)):(this._sw=new so(p.lng,p.lat),this._ne=new so(y.lng,y.lat)),this}getCenter(){return new so((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new so(this.getWest(),this.getNorth())}getSouthEast(){return new so(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:u}=so.convert(e);let p=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(p=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&p}static convert(e){return!e||e instanceof yc?e:new yc(e)}}const Fp=6371008.8;class so{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new so(Nt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,u=this.lat*n,p=e.lat*n,y=Math.sin(u)*Math.sin(p)+Math.cos(u)*Math.cos(p)*Math.cos((e.lng-this.lng)*n);return Fp*Math.acos(Math.min(y,1))}toBounds(e=0){const n=360*e/40075017,u=n/Math.cos(Math.PI/180*this.lat);return new yc(new so(this.lng-u,this.lat-n),new so(this.lng+u,this.lat+n))}static convert(e){if(e instanceof so)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new so(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new so(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Zd=2*Math.PI*Fp;function jf(t){return Zd*Math.cos(t*Math.PI/180)}function zu(t){return(180+t)/360}function an(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function tn(t,e){return t/jf(e)}function bn(t){return 360*t-180}function ln(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Qn(t,e){return t*jf(ln(e))}const kn=85.051129;function to(t){return 1/Math.cos(t*Math.PI/180)}class Li{constructor(e,n,u=0){this.x=+e,this.y=+n,this.z=+u}static fromLngLat(e,n=0){const u=so.convert(e);return new Li(zu(u.lng),an(u.lat),tn(n,u.lat))}toLngLat(){return new so(bn(this.x),ln(this.y))}toAltitude(){return Qn(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Zd*to(ln(this.y))}}function on(t,e,n,u,p,y,x,T,I){const L=(e+u)/2,F=(n+p)/2,G=new X(L,F);T(G),function($,te,oe,me,Pe,tt){const ut=oe-Pe,Ke=me-tt;return Math.abs((me-te)*ut-(oe-$)*Ke)/Math.hypot(ut,Ke)}(G.x,G.y,y.x,y.y,x.x,x.y)>=I?(on(t,e,n,L,F,y,G,T,I),on(t,L,F,u,p,G,x,T,I)):t.push(x)}function Me(t,e,n){let u=t[0],p=u.x,y=u.y;e(u);const x=[u];for(let T=1;T<t.length;T++){const I=t[T],{x:L,y:F}=I;e(I),on(x,p,y,L,F,u,I,e,n),p=L,y=F,u=I}return x}function qh(t,e,n,u){if(u(e,n)){const p=e.add(n)._mult(.5);qh(t,e,p,u),qh(t,p,n,u)}else t.push(n)}function Am(t,e){let n=t[0];const u=[n];for(let p=1;p<t.length;p++){const y=t[p];qh(u,n,y,e),n=y}return u}const qf=Math.pow(2,14)-1,Xd=-qf-1;function Lm(t,e){const n=Math.round(t.x*e),u=Math.round(t.y*e);return t.x=Ee(n,Xd,qf),t.y=Ee(u,Xd,qf),(n<t.x||n>t.x+1||u<t.y||u>t.y+1)&&Ar("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Qu(t,e,n){const u=t.loadGeometry(),p=t.extent,y=Gn/p;if(e&&n&&n.projection.isReprojectedInTileSpace){const x=1<<e.z,{scale:T,x:I,y:L,projection:F}=n,G=$=>{const te=bn((e.x+$.x/p)/x),oe=ln((e.y+$.y/p)/x),me=F.project(te,oe);$.x=(me.x*T-I)*p,$.y=(me.y*T-L)*p};for(let $=0;$<u.length;$++)if(1!==t.type)u[$]=Me(u[$],G,1);else{const te=[];for(const oe of u[$])oe.x<0||oe.x>=p||oe.y<0||oe.y>=p||(G(oe),te.push(oe));u[$]=te}}for(const x of u)for(const T of x)Lm(T,y);return u}function jc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Qu(t):[]}}function zp(t,e,n,u,p){t.emplaceBack(2*e+(u+1)/2,2*n+(p+1)/2)}function Vf(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class Zf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new mo,this.indexArray=new Yn,this.segments=new da,this.programConfigurations=new Gc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,u,p){const y=this.layers[0],x=[];let T=null;"circle"===y.type&&(T=y.layout.get("circle-sort-key"));for(const{feature:L,id:F,index:G,sourceLayerIndex:$}of e){const te=this.layers[0]._featureFilter.needGeometry,oe=jc(L,te);if(!this.layers[0]._featureFilter.filter(new Rt(this.zoom),oe,u))continue;const me=T?T.evaluate(oe,{},u):void 0,Pe={id:F,properties:L.properties,type:L.type,sourceLayerIndex:$,index:G,geometry:te?oe.geometry:Qu(L,u,p),patterns:{},sortKey:me};x.push(Pe)}T&&x.sort((L,F)=>L.sortKey-F.sortKey);let I=null;"globe"===p.projection.name&&(this.globeExtVertexArray=new rs,I=p.projection);for(const L of x){const{geometry:F,index:G,sourceLayerIndex:$}=L,te=e[G].feature;this.addFeature(L,F,G,n.availableImages,u,I),n.featureIndex.insert(te,F,G,$,this.index)}}update(e,n,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Im.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Pm.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,u,p,y,x){for(const T of n)for(const I of T){const L=I.x,F=I.y;if(L<0||L>=Gn||F<0||F>=Gn)continue;if(x){const te=x.projectTilePoint(L,F,y),oe=x.upVector(y,L,F),me=this.globeExtVertexArray;Vf(me,te,oe),Vf(me,te,oe),Vf(me,te,oe),Vf(me,te,oe)}const G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),$=G.vertexLength;zp(this.layoutVertexArray,L,F,-1,-1),zp(this.layoutVertexArray,L,F,1,-1),zp(this.layoutVertexArray,L,F,1,1),zp(this.layoutVertexArray,L,F,-1,1),this.indexArray.emplaceBack($,$+1,$+2),this.indexArray.emplaceBack($,$+2,$+3),G.vertexLength+=4,G.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,{},p,y)}}function $d(t,e){for(let n=0;n<t.length;n++)if(_c(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(_c(t,e[n]))return!0;return!!Xf(t,e)}function Dm(t,e,n){return!!_c(t,e)||!!Wd(e,t,n)}function Yd(t,e){if(1===t.length)return Rm(e,t[0]);for(let n=0;n<e.length;n++){const u=e[n];for(let p=0;p<u.length;p++)if(_c(t,u[p]))return!0}for(let n=0;n<t.length;n++)if(Rm(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Xf(t,e[n]))return!0;return!1}function Om(t,e,n){if(t.length>1){if(Xf(t,e))return!0;for(let u=0;u<e.length;u++)if(Wd(e[u],t,n))return!0}for(let u=0;u<t.length;u++)if(Wd(t[u],e,n))return!0;return!1}function Xf(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const u=t[n],p=t[n+1];for(let y=0;y<e.length-1;y++)if(Oy(u,p,e[y],e[y+1]))return!0}return!1}function Oy(t,e,n,u){return xr(t,n,u)!==xr(e,n,u)&&xr(t,e,n)!==xr(t,e,u)}function Wd(t,e,n){const u=n*n;if(1===e.length)return t.distSqr(e[0])<u;for(let p=1;p<e.length;p++)if(km(t,e[p-1],e[p])<u)return!0;return!1}function km(t,e,n){const u=e.distSqr(n);if(0===u)return t.distSqr(e);const p=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/u;return t.distSqr(p<0?e:p>1?n:n.sub(e)._mult(p)._add(e))}function Rm(t,e){let n,u,p,y=!1;for(let x=0;x<t.length;x++){n=t[x];for(let T=0,I=n.length-1;T<n.length;I=T++)u=n[T],p=n[I],u.y>e.y!=p.y>e.y&&e.x<(p.x-u.x)*(e.y-u.y)/(p.y-u.y)+u.x&&(y=!y)}return y}function _c(t,e){let n=!1;for(let u=0,p=t.length-1;u<t.length;p=u++){const y=t[u],x=t[p];y.y>e.y!=x.y>e.y&&e.x<(x.x-y.x)*(e.y-y.y)/(x.y-y.y)+y.x&&(n=!n)}return n}function Hd(t,e,n,u,p){for(const x of t)if(e<=x.x&&n<=x.y&&u>=x.x&&p>=x.y)return!0;const y=[new X(e,n),new X(e,p),new X(u,p),new X(u,n)];if(t.length>2)for(const x of y)if(_c(t,x))return!0;for(let x=0;x<t.length-1;x++)if(ky(t[x],t[x+1],y))return!0;return!1}function ky(t,e,n){const u=n[0],p=n[2];if(t.x<u.x&&e.x<u.x||t.x>p.x&&e.x>p.x||t.y<u.y&&e.y<u.y||t.y>p.y&&e.y>p.y)return!1;const y=xr(t,e,n[0]);return y!==xr(t,e,n[1])||y!==xr(t,e,n[2])||y!==xr(t,e,n[3])}function Vh(t,e,n){const u=e.paint.get(t).value;return"constant"===u.kind?u.value:n.programConfigurations.get(e.id).getMaxValue(t)}function $f(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Zh(t,e,n,u,p){if(!e[0]&&!e[1])return t;const y=X.convert(e)._mult(p);"viewport"===n&&y._rotate(-u);const x=[];for(let T=0;T<t.length;T++)x.push(t[T].sub(y));return x}function Bp(t,e,n,u){const p=X.convert(t)._mult(u);return"viewport"===e&&p._rotate(-n),p}gt(Zf,"CircleBucket",{omit:["layers"]});const Nm=new Ln({"circle-sort-key":new Kt(ur.layout_circle["circle-sort-key"])});var Fm={paint:new Ln({"circle-radius":new Kt(ur.paint_circle["circle-radius"]),"circle-color":new Kt(ur.paint_circle["circle-color"]),"circle-blur":new Kt(ur.paint_circle["circle-blur"]),"circle-opacity":new Kt(ur.paint_circle["circle-opacity"]),"circle-translate":new zt(ur.paint_circle["circle-translate"]),"circle-translate-anchor":new zt(ur.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new zt(ur.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new zt(ur.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Kt(ur.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Kt(ur.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Kt(ur.paint_circle["circle-stroke-opacity"])}),layout:Nm},Up=1e-6,Zl=typeof Float32Array<"u"?Float32Array:Array;function Jd(){var t=new Zl(9);return Zl!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Kd(t,e,n){var u=e[0],p=e[1],y=e[2],x=e[3],T=e[4],I=e[5],L=e[6],F=e[7],G=e[8],$=n[0],te=n[1],oe=n[2],me=n[3],Pe=n[4],tt=n[5],ut=n[6],Ke=n[7],lt=n[8];return t[0]=$*u+te*x+oe*L,t[1]=$*p+te*T+oe*F,t[2]=$*y+te*I+oe*G,t[3]=me*u+Pe*x+tt*L,t[4]=me*p+Pe*T+tt*F,t[5]=me*y+Pe*I+tt*G,t[6]=ut*u+Ke*x+lt*L,t[7]=ut*p+Ke*T+lt*F,t[8]=ut*y+Ke*I+lt*G,t}function Bu(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Gp(t,e){var n=e[0],u=e[1],p=e[2],y=e[3],x=e[4],T=e[5],I=e[6],L=e[7],F=e[8],G=e[9],$=e[10],te=e[11],oe=e[12],me=e[13],Pe=e[14],tt=e[15],ut=n*T-u*x,Ke=n*I-p*x,lt=n*L-y*x,vt=u*I-p*T,ht=u*L-y*T,$t=p*L-y*I,Zt=F*me-G*oe,cr=F*Pe-$*oe,Pr=F*tt-te*oe,Qt=G*Pe-$*me,dr=G*tt-te*me,yr=$*tt-te*Pe,Sr=ut*yr-Ke*dr+lt*Qt+vt*Pr-ht*cr+$t*Zt;return Sr?(t[0]=(T*yr-I*dr+L*Qt)*(Sr=1/Sr),t[1]=(p*dr-u*yr-y*Qt)*Sr,t[2]=(me*$t-Pe*ht+tt*vt)*Sr,t[3]=($*ht-G*$t-te*vt)*Sr,t[4]=(I*Pr-x*yr-L*cr)*Sr,t[5]=(n*yr-p*Pr+y*cr)*Sr,t[6]=(Pe*lt-oe*$t-tt*Ke)*Sr,t[7]=(F*$t-$*lt+te*Ke)*Sr,t[8]=(x*dr-T*Pr+L*Zt)*Sr,t[9]=(u*Pr-n*dr-y*Zt)*Sr,t[10]=(oe*ht-me*lt+tt*ut)*Sr,t[11]=(G*lt-F*ht-te*ut)*Sr,t[12]=(T*cr-x*Qt-I*Zt)*Sr,t[13]=(n*Qt-u*cr+p*Zt)*Sr,t[14]=(me*Ke-oe*vt-Pe*ut)*Sr,t[15]=(F*vt-G*Ke+$*ut)*Sr,t):null}function qc(t,e,n){var u=e[0],p=e[1],y=e[2],x=e[3],T=e[4],I=e[5],L=e[6],F=e[7],G=e[8],$=e[9],te=e[10],oe=e[11],me=e[12],Pe=e[13],tt=e[14],ut=e[15],Ke=n[0],lt=n[1],vt=n[2],ht=n[3];return t[0]=Ke*u+lt*T+vt*G+ht*me,t[1]=Ke*p+lt*I+vt*$+ht*Pe,t[2]=Ke*y+lt*L+vt*te+ht*tt,t[3]=Ke*x+lt*F+vt*oe+ht*ut,t[4]=(Ke=n[4])*u+(lt=n[5])*T+(vt=n[6])*G+(ht=n[7])*me,t[5]=Ke*p+lt*I+vt*$+ht*Pe,t[6]=Ke*y+lt*L+vt*te+ht*tt,t[7]=Ke*x+lt*F+vt*oe+ht*ut,t[8]=(Ke=n[8])*u+(lt=n[9])*T+(vt=n[10])*G+(ht=n[11])*me,t[9]=Ke*p+lt*I+vt*$+ht*Pe,t[10]=Ke*y+lt*L+vt*te+ht*tt,t[11]=Ke*x+lt*F+vt*oe+ht*ut,t[12]=(Ke=n[12])*u+(lt=n[13])*T+(vt=n[14])*G+(ht=n[15])*me,t[13]=Ke*p+lt*I+vt*$+ht*Pe,t[14]=Ke*y+lt*L+vt*te+ht*tt,t[15]=Ke*x+lt*F+vt*oe+ht*ut,t}function jp(t,e,n){var u,p,y,x,T,I,L,F,G,$,te,oe,me=n[0],Pe=n[1],tt=n[2];return e===t?(t[12]=e[0]*me+e[4]*Pe+e[8]*tt+e[12],t[13]=e[1]*me+e[5]*Pe+e[9]*tt+e[13],t[14]=e[2]*me+e[6]*Pe+e[10]*tt+e[14],t[15]=e[3]*me+e[7]*Pe+e[11]*tt+e[15]):(p=e[1],y=e[2],x=e[3],T=e[4],I=e[5],L=e[6],F=e[7],G=e[8],$=e[9],te=e[10],oe=e[11],t[0]=u=e[0],t[1]=p,t[2]=y,t[3]=x,t[4]=T,t[5]=I,t[6]=L,t[7]=F,t[8]=G,t[9]=$,t[10]=te,t[11]=oe,t[12]=u*me+T*Pe+G*tt+e[12],t[13]=p*me+I*Pe+$*tt+e[13],t[14]=y*me+L*Pe+te*tt+e[14],t[15]=x*me+F*Pe+oe*tt+e[15]),t}function Vc(t,e,n){var u=n[0],p=n[1],y=n[2];return t[0]=e[0]*u,t[1]=e[1]*u,t[2]=e[2]*u,t[3]=e[3]*u,t[4]=e[4]*p,t[5]=e[5]*p,t[6]=e[6]*p,t[7]=e[7]*p,t[8]=e[8]*y,t[9]=e[9]*y,t[10]=e[10]*y,t[11]=e[11]*y,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Xh(t,e,n){var u=Math.sin(n),p=Math.cos(n),y=e[4],x=e[5],T=e[6],I=e[7],L=e[8],F=e[9],G=e[10],$=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=y*p+L*u,t[5]=x*p+F*u,t[6]=T*p+G*u,t[7]=I*p+$*u,t[8]=L*p-y*u,t[9]=F*p-x*u,t[10]=G*p-T*u,t[11]=$*p-I*u,t}function qp(t,e,n){var u=Math.sin(n),p=Math.cos(n),y=e[0],x=e[1],T=e[2],I=e[3],L=e[8],F=e[9],G=e[10],$=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=y*p-L*u,t[1]=x*p-F*u,t[2]=T*p-G*u,t[3]=I*p-$*u,t[8]=y*u+L*p,t[9]=x*u+F*p,t[10]=T*u+G*p,t[11]=I*u+$*p,t}function Yf(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Qd(t,e,n){var u,p,y,x=n[0],T=n[1],I=n[2],L=Math.hypot(x,T,I);return L<Up?null:(x*=L=1/L,T*=L,I*=L,u=Math.sin(e),p=Math.cos(e),t[0]=x*x*(y=1-p)+p,t[1]=T*x*y+I*u,t[2]=I*x*y-T*u,t[3]=0,t[4]=x*T*y-I*u,t[5]=T*T*y+p,t[6]=I*T*y+x*u,t[7]=0,t[8]=x*I*y+T*u,t[9]=T*I*y-x*u,t[10]=I*I*y+p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var zm=qc;function Vp(){var t=new Zl(3);return Zl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function eg(t){var e=new Zl(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function $h(t){return Math.hypot(t[0],t[1],t[2])}function gh(t,e,n){var u=new Zl(3);return u[0]=t,u[1]=e,u[2]=n,u}function ec(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Wf(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Bm(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function Zp(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function Xp(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function mu(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Yh(t,e,n,u){return t[0]=e[0]+n[0]*u,t[1]=e[1]+n[1]*u,t[2]=e[2]+n[2]*u,t}function gl(t,e){var n=e[0],u=e[1],p=e[2],y=n*n+u*u+p*p;return y>0&&(y=1/Math.sqrt(y)),t[0]=e[0]*y,t[1]=e[1]*y,t[2]=e[2]*y,t}function yu(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function $p(t,e,n){var u=e[0],p=e[1],y=e[2],x=n[0],T=n[1],I=n[2];return t[0]=p*I-y*T,t[1]=y*x-u*I,t[2]=u*T-p*x,t}function js(t,e,n){var u=e[0],p=e[1],y=e[2],x=n[3]*u+n[7]*p+n[11]*y+n[15];return t[0]=(n[0]*u+n[4]*p+n[8]*y+n[12])/(x=x||1),t[1]=(n[1]*u+n[5]*p+n[9]*y+n[13])/x,t[2]=(n[2]*u+n[6]*p+n[10]*y+n[14])/x,t}function tg(t,e,n){var u=n[0],p=n[1],y=n[2],x=e[0],T=e[1],I=e[2],L=p*I-y*T,F=y*x-u*I,G=u*T-p*x,$=p*G-y*F,te=y*L-u*G,oe=u*F-p*L,me=2*n[3];return F*=me,G*=me,te*=2,oe*=2,t[0]=x+(L*=me)+($*=2),t[1]=T+F+te,t[2]=I+G+oe,t}var Wh,Uu=Wf,Ry=Bm,Um=$h;function rg(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function ng(t,e){var n=e[0],u=e[1],p=e[2],y=e[3],x=n*n+u*u+p*p+y*y;return x>0&&(x=1/Math.sqrt(x)),t[0]=n*x,t[1]=u*x,t[2]=p*x,t[3]=y*x,t}function Zc(t,e,n){var u=e[0],p=e[1],y=e[2],x=e[3];return t[0]=n[0]*u+n[4]*p+n[8]*y+n[12]*x,t[1]=n[1]*u+n[5]*p+n[9]*y+n[13]*x,t[2]=n[2]*u+n[6]*p+n[10]*y+n[14]*x,t[3]=n[3]*u+n[7]*p+n[11]*y+n[15]*x,t}function ig(){var t=new Zl(4);return Zl!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function og(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function sg(t,e,n){n*=.5;var u=e[0],p=e[1],y=e[2],x=e[3],T=Math.sin(n),I=Math.cos(n);return t[0]=u*I+x*T,t[1]=p*I+y*T,t[2]=y*I-p*T,t[3]=x*I-u*T,t}function Hf(t,e,n){n*=.5;var u=e[0],p=e[1],y=e[2],x=e[3],T=Math.sin(n),I=Math.cos(n);return t[0]=u*I-y*T,t[1]=p*I+x*T,t[2]=y*I+u*T,t[3]=x*I-p*T,t}Vp(),Wh=new Zl(4),Zl!=Float32Array&&(Wh[0]=0,Wh[1]=0,Wh[2]=0,Wh[3]=0);var Jf=ng;Vp(),gh(1,0,0),gh(0,1,0),ig(),ig(),Jd();class Kf{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,u){const p=yu(n,this.dir);if(Math.abs(p)<1e-6)return!1;const y=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/p;return u[0]=this.pos[0]+this.dir[0]*y,u[1]=this.pos[1]+this.dir[1]*y,u[2]=this.pos[2]+this.dir[2]*y,!0}closestPointOnSphere(e,n,u){if(me=(te=this.pos)[0],Pe=te[1],tt=te[2],ut=(oe=e)[0],Ke=oe[1],lt=oe[2],Math.abs(me-ut)<=Up*Math.max(1,Math.abs(me),Math.abs(ut))&&Math.abs(Pe-Ke)<=Up*Math.max(1,Math.abs(Pe),Math.abs(Ke))&&Math.abs(tt-lt)<=Up*Math.max(1,Math.abs(tt),Math.abs(lt))||0===n)return u[0]=u[1]=u[2]=0,!1;var te,oe,me,Pe,tt,ut,Ke,lt;const[p,y,x]=this.dir,T=this.pos[0]-e[0],I=this.pos[1]-e[1],L=this.pos[2]-e[2],F=p*p+y*y+x*x,G=2*(T*p+I*y+L*x),$=G*G-4*F*(T*T+I*I+L*L-n*n);if($<0){const te=Math.max(-G/2,0),oe=T+p*te,me=I+y*te,Pe=L+x*te,tt=Math.hypot(oe,me,Pe);return u[0]=oe*n/tt,u[1]=me*n/tt,u[2]=Pe*n/tt,!1}{const te=(-G-Math.sqrt($))/(2*F);if(te<0){const oe=Math.hypot(T,I,L);return u[0]=T*n/oe,u[1]=I*n/oe,u[2]=L*n/oe,!1}return u[0]=T+p*te,u[1]=I+y*te,u[2]=L+x*te,!0}}}class ag{constructor(e,n,u,p,y){this.TL=e,this.TR=n,this.BR=u,this.BL=p,this.horizon=y}static fromInvProjectionMatrix(e,n,u){const p=[-1,1,1],y=[1,1,1],x=[1,-1,1],T=[-1,-1,1],I=js(p,p,e),L=js(y,y,e),F=js(x,x,e),G=js(T,T,e);return new ag(I,L,F,G,n/u)}}class Yp{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,u,p){const y=Math.pow(2,u),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const L=Zc([],I,e),F=1/L[3]/n*y;return(G=L)[0]=($=L)[0]*(te=[F,F,p?1/L[3]:F,F])[0],G[1]=$[1]*te[1],G[2]=$[2]*te[2],G[3]=$[3]*te[3],G;var G,$,te}),T=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const L=gl([],$p([],Uu([],x[I[0]],x[I[1]]),Uu([],x[I[2]],x[I[1]]))),F=-yu(L,x[I[1]]);return L.concat(F)});return new Yp(x,T)}}class Cl{static fromPoints(e){const n=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const p of e)Zp(n,n,p),Xp(u,u,p);return new Cl(n,u)}static applyTransform(e,n){const u=e.getCorners();for(let p=0;p<u.length;++p)js(u[p],u[p],n);return Cl.fromPoints(u)}constructor(e,n){this.min=e,this.max=n,this.center=mu([],ec([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],u=eg(this.min),p=eg(this.max);for(let y=0;y<n.length;y++)u[y]=n[y]?this.min[y]:this.center[y],p[y]=n[y]?this.center[y]:this.max[y];return p[2]=this.max[2],new Cl(u,p)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let u=!0;for(let p=0;p<e.planes.length;p++){const y=e.planes[p];let x=0;for(let T=0;T<n.length;T++)x+=yu(y,n[T])+y[3]>=0;if(0===x)return 0;x!==n.length&&(u=!1)}if(u)return 2;for(let p=0;p<3;p++){let y=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let T=0;T<e.points.length;T++){const I=e.points[T][p]-this.min[p];y=Math.min(y,I),x=Math.max(x,I)}if(x<0||y>this.max[p]-this.min[p])return 0}return 1}}function Qf(t,e,n,u,p,y,x,T,I){if(y&&t.queryGeometry.isAboveHorizon)return!1;y&&(I*=t.pixelToTileUnitsFactor);const L=t.tileID.canonical,F=n.projection.upVectorScale(L,n.center.lat,n.worldSize).metersToTile;for(const G of e)for(const $ of G){const te=$.add(T),oe=p&&n.elevation?n.elevation.exaggeration()*p.getElevationAt(te.x,te.y,!0):0,me=n.projection.projectTilePoint(te.x,te.y,L);if(oe>0){const Ke=n.projection.upVector(L,te.x,te.y);me.x+=Ke[0]*F*oe,me.y+=Ke[1]*F*oe,me.z+=Ke[2]*F*oe}const Pe=y?te:lg(me.x,me.y,me.z,u),tt=y?t.tilespaceRays.map(Ke=>Fy(Ke,oe)):t.queryGeometry.screenGeometry,ut=Zc([],[me.x,me.y,me.z,1],u);if(!x&&y?I*=ut[3]/n.cameraToCenterDistance:x&&!y&&(I*=n.cameraToCenterDistance/ut[3]),y){const Ke=ln(($.y/Gn+L.y)/(1<<L.z));I/=n.projection.pixelsPerMeter(Ke,1)/tn(1,Ke)}if(Dm(tt,Pe,I))return!0}return!1}function lg(t,e,n,u){const p=Zc([],[t,e,n,1],u);return new X(p[0]/p[3],p[1]/p[3])}const ed=gh(0,0,0),Ny=gh(0,0,1);function Fy(t,e){const n=Vp();return ed[2]=e,t.intersectsPlane(ed,Ny,n),new X(n[0],n[1])}class Gm extends Zf{}function jm(t,{width:e,height:n},u,p){if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==e*n*u)throw new RangeError("mismatched image size")}else p=new Uint8Array(e*n*u);return t.width=e,t.height=n,t.data=p,t}function qm(t,e,n){const{width:u,height:p}=e;u===t.width&&p===t.height||(ug(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,u),height:Math.min(t.height,p)},n),t.width=u,t.height=p,t.data=e.data)}function ug(t,e,n,u,p,y){if(0===p.width||0===p.height)return e;if(p.width>t.width||p.height>t.height||n.x>t.width-p.width||n.y>t.height-p.height)throw new RangeError("out of range source coordinates for image copy");if(p.width>e.width||p.height>e.height||u.x>e.width-p.width||u.y>e.height-p.height)throw new RangeError("out of range destination coordinates for image copy");const x=t.data,T=e.data;for(let I=0;I<p.height;I++){const L=((n.y+I)*t.width+n.x)*y,F=((u.y+I)*e.width+u.x)*y;for(let G=0;G<p.width*y;G++)T[F+G]=x[L+G]}return e}gt(Gm,"HeatmapBucket",{omit:["layers"]});class vc{constructor(e,n){jm(this,e,1,n)}resize(e){qm(this,new vc(e),1)}clone(){return new vc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,u,p,y){ug(e,n,u,p,y,1)}}class Kl{constructor(e,n){jm(this,e,4,n)}resize(e){qm(this,new Kl(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Kl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,u,p,y){ug(e,n,u,p,y,4)}}gt(vc,"AlphaImage"),gt(Kl,"RGBAImage");var zy={paint:new Ln({"heatmap-radius":new Kt(ur.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Kt(ur.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new zt(ur.paint_heatmap["heatmap-intensity"]),"heatmap-color":new fn(ur.paint_heatmap["heatmap-color"]),"heatmap-opacity":new zt(ur.paint_heatmap["heatmap-opacity"])})};function cg(t){const e={},n=t.resolution||256,u=t.clips?t.clips.length:1,p=t.image||new Kl({width:n,height:u}),y=(x,T,I)=>{e[t.evaluationKey]=I;const L=t.expression.evaluate(e);p.data[x+T+0]=Math.floor(255*L.r/L.a),p.data[x+T+1]=Math.floor(255*L.g/L.a),p.data[x+T+2]=Math.floor(255*L.b/L.a),p.data[x+T+3]=Math.floor(255*L.a)};if(t.clips)for(let x=0,T=0;x<u;++x,T+=4*n)for(let I=0,L=0;I<n;I++,L+=4){const F=I/(n-1),{start:G,end:$}=t.clips[x];y(T,L,G*(1-F)+$*F)}else for(let x=0,T=0;x<n;x++,T+=4)y(0,T,x/(n-1));return p}var By={paint:new Ln({"hillshade-illumination-direction":new zt(ur.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new zt(ur.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new zt(ur.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new zt(ur.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new zt(ur.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new zt(ur.paint_hillshade["hillshade-accent-color"])})};const Uy=Kr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Gy}=Uy;var Hh={exports:{}};function Jh(t,e,n){n=n||2;var u,p,y,x,T,I,L,F=e&&e.length,G=F?e[0]*n:t.length,$=Vm(t,0,G,n,!0),te=[];if(!$||$.next===$.prev)return te;if(F&&($=function(me,Pe,tt,ut){var Ke,lt,vt,ht=[];for(Ke=0,lt=Pe.length;Ke<lt;Ke++)(vt=Vm(me,Pe[Ke]*ut,Ke<lt-1?Pe[Ke+1]*ut:me.length,ut,!1))===vt.next&&(vt.steiner=!0),ht.push(Jp(vt));for(ht.sort(jy),Ke=0;Ke<ht.length;Ke++)tt=Zm(ht[Ke],tt);return tt}(t,e,$,n)),t.length>80*n){u=y=t[0],p=x=t[1];for(var oe=n;oe<G;oe+=n)(T=t[oe])<u&&(u=T),(I=t[oe+1])<p&&(p=I),T>y&&(y=T),I>x&&(x=I);L=0!==(L=Math.max(y-u,x-p))?32767/L:0}return Kh($,te,n,u,p,L,0),te}function Vm(t,e,n,u,p){var y,x;if(p===Kp(t,e,n,u)>0)for(y=e;y<n;y+=u)x=fg(y,t[y],t[y+1],x);else for(y=n-u;y>=e;y-=u)x=fg(y,t[y],t[y+1],x);return x&&tp(x,x.next)&&(np(x),x=x.next),x}function xc(t,e){if(!t)return t;e||(e=t);var n,u=t;do{if(n=!1,u.steiner||!tp(u,u.next)&&0!==qs(u.prev,u,u.next))u=u.next;else{if(np(u),(u=e=u.prev)===u.next)break;n=!0}}while(n||u!==e);return e}function Kh(t,e,n,u,p,y,x){if(t){!x&&y&&function(F,G,$,te){var oe=F;do{0===oe.z&&(oe.z=Qh(oe.x,oe.y,G,$,te)),oe.prevZ=oe.prev,oe.nextZ=oe.next,oe=oe.next}while(oe!==F);oe.prevZ.nextZ=null,oe.prevZ=null,function(me){var Pe,tt,ut,Ke,lt,vt,ht,$t,Zt=1;do{for(tt=me,me=null,lt=null,vt=0;tt;){for(vt++,ut=tt,ht=0,Pe=0;Pe<Zt&&(ht++,ut=ut.nextZ);Pe++);for($t=Zt;ht>0||$t>0&&ut;)0!==ht&&(0===$t||!ut||tt.z<=ut.z)?(Ke=tt,tt=tt.nextZ,ht--):(Ke=ut,ut=ut.nextZ,$t--),lt?lt.nextZ=Ke:me=Ke,Ke.prevZ=lt,lt=Ke;tt=ut}lt.nextZ=null,Zt*=2}while(vt>1)}(oe)}(t,u,p,y);for(var T,I,L=t;t.prev!==t.next;)if(T=t.prev,I=t.next,y?mh(t,u,p,y):Wp(t))e.push(T.i/n|0),e.push(t.i/n|0),e.push(I.i/n|0),np(t),t=I.next,L=I.next;else if((t=I)===L){x?1===x?Kh(t=Hp(xc(t),e,n),e,n,u,p,y,2):2===x&&hg(t,e,n,u,p,y):Kh(xc(t),e,n,u,p,y,1);break}}}function Wp(t){var e=t.prev,n=t,u=t.next;if(qs(e,n,u)>=0)return!1;for(var p=e.x,y=n.x,x=u.x,T=e.y,I=n.y,L=u.y,F=p<y?p<x?p:x:y<x?y:x,G=T<I?T<L?T:L:I<L?I:L,$=p>y?p>x?p:x:y>x?y:x,te=T>I?T>L?T:L:I>L?I:L,oe=u.next;oe!==e;){if(oe.x>=F&&oe.x<=$&&oe.y>=G&&oe.y<=te&&Gu(p,T,y,I,x,L,oe.x,oe.y)&&qs(oe.prev,oe,oe.next)>=0)return!1;oe=oe.next}return!0}function mh(t,e,n,u){var p=t.prev,y=t,x=t.next;if(qs(p,y,x)>=0)return!1;for(var T=p.x,I=y.x,L=x.x,F=p.y,G=y.y,$=x.y,te=T<I?T<L?T:L:I<L?I:L,oe=F<G?F<$?F:$:G<$?G:$,me=T>I?T>L?T:L:I>L?I:L,Pe=F>G?F>$?F:$:G>$?G:$,tt=Qh(te,oe,e,n,u),ut=Qh(me,Pe,e,n,u),Ke=t.prevZ,lt=t.nextZ;Ke&&Ke.z>=tt&&lt&&lt.z<=ut;){if(Ke.x>=te&&Ke.x<=me&&Ke.y>=oe&&Ke.y<=Pe&&Ke!==p&&Ke!==x&&Gu(T,F,I,G,L,$,Ke.x,Ke.y)&&qs(Ke.prev,Ke,Ke.next)>=0||(Ke=Ke.prevZ,lt.x>=te&&lt.x<=me&&lt.y>=oe&&lt.y<=Pe&&lt!==p&&lt!==x&&Gu(T,F,I,G,L,$,lt.x,lt.y)&&qs(lt.prev,lt,lt.next)>=0))return!1;lt=lt.nextZ}for(;Ke&&Ke.z>=tt;){if(Ke.x>=te&&Ke.x<=me&&Ke.y>=oe&&Ke.y<=Pe&&Ke!==p&&Ke!==x&&Gu(T,F,I,G,L,$,Ke.x,Ke.y)&&qs(Ke.prev,Ke,Ke.next)>=0)return!1;Ke=Ke.prevZ}for(;lt&&lt.z<=ut;){if(lt.x>=te&&lt.x<=me&&lt.y>=oe&&lt.y<=Pe&&lt!==p&&lt!==x&&Gu(T,F,I,G,L,$,lt.x,lt.y)&&qs(lt.prev,lt,lt.next)>=0)return!1;lt=lt.nextZ}return!0}function Hp(t,e,n){var u=t;do{var p=u.prev,y=u.next.next;!tp(p,y)&&yh(p,u,u.next,y)&&rp(p,y)&&rp(y,p)&&(e.push(p.i/n|0),e.push(u.i/n|0),e.push(y.i/n|0),np(u),np(u.next),u=t=y),u=u.next}while(u!==t);return xc(u)}function hg(t,e,n,u,p,y){var x=t;do{for(var T=x.next.next;T!==x.prev;){if(x.i!==T.i&&ep(x,T)){var I=pg(x,T);return x=xc(x,x.next),I=xc(I,I.next),Kh(x,e,n,u,p,y,0),void Kh(I,e,n,u,p,y,0)}T=T.next}x=x.next}while(x!==t)}function jy(t,e){return t.x-e.x}function Zm(t,e){var n=function(p,y){var x,T=y,I=p.x,L=p.y,F=-1/0;do{if(L<=T.y&&L>=T.next.y&&T.next.y!==T.y){var G=T.x+(L-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(G<=I&&G>F&&(F=G,x=T.x<T.next.x?T:T.next,G===I))return x}T=T.next}while(T!==y);if(!x)return null;var $,te=x,oe=x.x,me=x.y,Pe=1/0;T=x;do{I>=T.x&&T.x>=oe&&I!==T.x&&Gu(L<me?I:F,L,oe,me,L<me?F:I,L,T.x,T.y)&&($=Math.abs(L-T.y)/(I-T.x),rp(T,p)&&($<Pe||$===Pe&&(T.x>x.x||T.x===x.x&&qy(x,T)))&&(x=T,Pe=$)),T=T.next}while(T!==te);return x}(t,e);if(!n)return e;var u=pg(n,t);return xc(u,u.next),xc(n,n.next)}function qy(t,e){return qs(t.prev,t,e.prev)<0&&qs(e.next,t,t.next)<0}function Qh(t,e,n,u,p){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*p|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-u)*p|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Jp(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Gu(t,e,n,u,p,y,x,T){return(p-x)*(e-T)>=(t-x)*(y-T)&&(t-x)*(u-T)>=(n-x)*(e-T)&&(n-x)*(y-T)>=(p-x)*(u-T)}function ep(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,u){var p=n;do{if(p.i!==n.i&&p.next.i!==n.i&&p.i!==u.i&&p.next.i!==u.i&&yh(p,p.next,n,u))return!0;p=p.next}while(p!==n);return!1}(t,e)&&(rp(t,e)&&rp(e,t)&&function(n,u){var p=n,y=!1,x=(n.x+u.x)/2,T=(n.y+u.y)/2;do{p.y>T!=p.next.y>T&&p.next.y!==p.y&&x<(p.next.x-p.x)*(T-p.y)/(p.next.y-p.y)+p.x&&(y=!y),p=p.next}while(p!==n);return y}(t,e)&&(qs(t.prev,t,e.prev)||qs(t,e.prev,e))||tp(t,e)&&qs(t.prev,t,t.next)>0&&qs(e.prev,e,e.next)>0)}function qs(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function tp(t,e){return t.x===e.x&&t.y===e.y}function yh(t,e,n,u){var p=Xc(qs(t,e,n)),y=Xc(qs(t,e,u)),x=Xc(qs(n,u,t)),T=Xc(qs(n,u,e));return p!==y&&x!==T||!(0!==p||!bc(t,n,e))||!(0!==y||!bc(t,u,e))||!(0!==x||!bc(n,t,u))||!(0!==T||!bc(n,e,u))}function bc(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Xc(t){return t>0?1:t<0?-1:0}function rp(t,e){return qs(t.prev,t,t.next)<0?qs(t,e,t.next)>=0&&qs(t,t.prev,e)>=0:qs(t,e,t.prev)<0||qs(t,t.next,e)<0}function pg(t,e){var n=new td(t.i,t.x,t.y),u=new td(e.i,e.x,e.y),p=t.next,y=e.prev;return t.next=e,e.prev=t,n.next=p,p.prev=n,u.next=n,n.prev=u,y.next=u,u.prev=y,u}function fg(t,e,n,u){var p=new td(t,e,n);return u?(p.next=u.next,p.prev=u,u.next.prev=p,u.next=p):(p.prev=p,p.next=p),p}function np(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function td(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Kp(t,e,n,u){for(var p=0,y=e,x=n-u;y<n;y+=u)p+=(t[x]-t[y])*(t[y+1]+t[x+1]),x=y;return p}function Xm(t,e,n,u,p){dg(t,e,n||0,u||t.length-1,p||gg)}function dg(t,e,n,u,p){for(;u>n;){if(u-n>600){var y=u-n+1,x=e-n+1,T=Math.log(y),I=.5*Math.exp(2*T/3),L=.5*Math.sqrt(T*I*(y-I)/y)*(x-y/2<0?-1:1);dg(t,e,Math.max(n,Math.floor(e-x*I/y+L)),Math.min(u,Math.floor(e+(y-x)*I/y+L)),p)}var F=t[e],G=n,$=u;for(ip(t,n,e),p(t[u],F)>0&&ip(t,n,u);G<$;){for(ip(t,G,$),G++,$--;p(t[G],F)<0;)G++;for(;p(t[$],F)>0;)$--}0===p(t[n],F)?ip(t,n,$):ip(t,++$,u),$<=e&&(n=$+1),e<=$&&(u=$-1)}}function ip(t,e,n){var u=t[e];t[e]=t[n],t[n]=u}function gg(t,e){return t<e?-1:t>e?1:0}function op(t,e){const n=t.length;if(n<=1)return[t];const u=[];let p,y;for(let x=0;x<n;x++){const T=cn(t[x]);0!==T&&(t[x].area=Math.abs(T),void 0===y&&(y=T<0),y===T<0?(p&&u.push(p),p=[t[x]]):p.push(t[x]))}if(p&&u.push(p),e>1)for(let x=0;x<u.length;x++)u[x].length<=e||(Xm(u[x],e,1,u[x].length-1,$m),u[x]=u[x].slice(0,e));return u}function $m(t,e){return e.area-t.area}function wc(t,e,n){const u=n.patternDependencies;let p=!1;for(const y of e){const x=y.paint.get(`${t}-pattern`);x.isConstant()||(p=!0);const T=x.constantOr(null);T&&(p=!0,u[T]=!0)}return p}function Ec(t,e,n,u,p){const y=p.patternDependencies;for(const x of e){const T=x.paint.get(`${t}-pattern`).value;if("constant"!==T.kind){let I=T.evaluate({zoom:u},n,{},p.availableImages);I=I&&I.name?I.name:I,y[I]=!0,n.patterns[x.id]=I}}return n}Hh.exports=Jh,Hh.exports.default=Jh,Jh.deviation=function(t,e,n,u){var p=e&&e.length,y=Math.abs(Kp(t,0,p?e[0]*n:t.length,n));if(p)for(var x=0,T=e.length;x<T;x++)y-=Math.abs(Kp(t,e[x]*n,x<T-1?e[x+1]*n:t.length,n));var I=0;for(x=0;x<u.length;x+=3){var L=u[x]*n,F=u[x+1]*n,G=u[x+2]*n;I+=Math.abs((t[L]-t[G])*(t[F+1]-t[L+1])-(t[L]-t[F])*(t[G+1]-t[L+1]))}return 0===y&&0===I?0:Math.abs((I-y)/y)},Jh.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},u=0,p=0;p<t.length;p++){for(var y=0;y<t[p].length;y++)for(var x=0;x<e;x++)n.vertices.push(t[p][y][x]);p>0&&n.holes.push(u+=t[p-1].length)}return n};class sp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new mo,this.indexArray=new Yn,this.indexArray2=new ci,this.programConfigurations=new Gc(e.layers,e.zoom),this.segments=new da,this.segments2=new da,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,u,p){this.hasPattern=wc("fill",this.layers,n);const y=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:T,id:I,index:L,sourceLayerIndex:F}of e){const G=this.layers[0]._featureFilter.needGeometry,$=jc(T,G);if(!this.layers[0]._featureFilter.filter(new Rt(this.zoom),$,u))continue;const te=y?y.evaluate($,{},u,n.availableImages):void 0,oe={id:I,properties:T.properties,type:T.type,sourceLayerIndex:F,index:L,geometry:G?$.geometry:Qu(T,u,p),patterns:{},sortKey:te};x.push(oe)}y&&x.sort((T,I)=>T.sortKey-I.sortKey);for(const T of x){const{geometry:I,index:L,sourceLayerIndex:F}=T;if(this.hasPattern){const G=Ec("fill",this.layers,T,this.zoom,n);this.patternFeatures.push(G)}else this.addFeature(T,I,L,u,{},n.availableImages);n.featureIndex.insert(e[L].feature,I,L,F,this.index)}}update(e,n,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,u,p)}addFeatures(e,n,u,p,y){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,n,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Gy),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,u,p,y,x=[]){for(const T of op(n,500)){let I=0;for(const oe of T)I+=oe.length;const L=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),F=L.vertexLength,G=[],$=[];for(const oe of T){if(0===oe.length)continue;oe!==T[0]&&$.push(G.length/2);const me=this.segments2.prepareSegment(oe.length,this.layoutVertexArray,this.indexArray2),Pe=me.vertexLength;this.layoutVertexArray.emplaceBack(oe[0].x,oe[0].y),this.indexArray2.emplaceBack(Pe+oe.length-1,Pe),G.push(oe[0].x),G.push(oe[0].y);for(let tt=1;tt<oe.length;tt++)this.layoutVertexArray.emplaceBack(oe[tt].x,oe[tt].y),this.indexArray2.emplaceBack(Pe+tt-1,Pe+tt),G.push(oe[tt].x),G.push(oe[tt].y);me.vertexLength+=oe.length,me.primitiveLength+=oe.length}const te=Hh.exports(G,$);for(let oe=0;oe<te.length;oe+=3)this.indexArray.emplaceBack(F+te[oe],F+te[oe+1],F+te[oe+2]);L.vertexLength+=I,L.primitiveLength+=te.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,x,p)}}gt(sp,"FillBucket",{omit:["layers","patternFeatures"]});const Ym=new Ln({"fill-sort-key":new Kt(ur.layout_fill["fill-sort-key"])});var mg={paint:new Ln({"fill-antialias":new zt(ur.paint_fill["fill-antialias"]),"fill-opacity":new Kt(ur.paint_fill["fill-opacity"]),"fill-color":new Kt(ur.paint_fill["fill-color"]),"fill-outline-color":new Kt(ur.paint_fill["fill-outline-color"]),"fill-translate":new zt(ur.paint_fill["fill-translate"]),"fill-translate-anchor":new zt(ur.paint_fill["fill-translate-anchor"]),"fill-pattern":new Kt(ur.paint_fill["fill-pattern"])}),layout:Ym};const rd=Kr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Wm=Kr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Hm=Kr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:yg}=rd;var Qp={},Vs=X,_g=Mu;function Mu(t,e,n,u,p){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=u,this._values=p,t.readFields(Ql,this,e)}function Ql(t,e,n){1==t?e.id=n.readVarint():2==t?function(u,p){for(var y=u.readVarint()+u.pos;u.pos<y;){var x=p._keys[u.readVarint()],T=p._values[u.readVarint()];p.properties[x]=T}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function ap(t){for(var e,n,u=0,p=0,y=t.length,x=y-1;p<y;x=p++)u+=((n=t[x]).x-(e=t[p]).x)*(e.y+n.y);return u}Mu.types=["Unknown","Point","LineString","Polygon"],Mu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,u=1,p=0,y=0,x=0,T=[];t.pos<n;){if(p<=0){var I=t.readVarint();u=7&I,p=I>>3}if(p--,1===u||2===u)y+=t.readSVarint(),x+=t.readSVarint(),1===u&&(e&&T.push(e),e=[]),e.push(new Vs(y,x));else{if(7!==u)throw new Error("unknown command "+u);e&&e.push(e[0].clone())}}return e&&T.push(e),T},Mu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,u=0,p=0,y=0,x=1/0,T=-1/0,I=1/0,L=-1/0;t.pos<e;){if(u<=0){var F=t.readVarint();n=7&F,u=F>>3}if(u--,1===n||2===n)(p+=t.readSVarint())<x&&(x=p),p>T&&(T=p),(y+=t.readSVarint())<I&&(I=y),y>L&&(L=y);else if(7!==n)throw new Error("unknown command "+n)}return[x,I,T,L]},Mu.prototype.toGeoJSON=function(t,e,n){var u,p,y=this.extent*Math.pow(2,n),x=this.extent*t,T=this.extent*e,I=this.loadGeometry(),L=Mu.types[this.type];function F(te){for(var oe=0;oe<te.length;oe++){var me=te[oe];te[oe]=[360*(me.x+x)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(me.y+T)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var G=[];for(u=0;u<I.length;u++)G[u]=I[u][0];F(I=G);break;case 2:for(u=0;u<I.length;u++)F(I[u]);break;case 3:for(I=function(te){var oe=te.length;if(oe<=1)return[te];for(var me,Pe,tt=[],ut=0;ut<oe;ut++){var Ke=ap(te[ut]);0!==Ke&&(void 0===Pe&&(Pe=Ke<0),Pe===Ke<0?(me&&tt.push(me),me=[te[ut]]):me.push(te[ut]))}return me&&tt.push(me),tt}(I),u=0;u<I.length;u++)for(p=0;p<I[u].length;p++)F(I[u][p])}1===I.length?I=I[0]:L="Multi"+L;var $={type:"Feature",geometry:{type:L,coordinates:I},properties:this.properties};return"id"in this&&($.id=this.id),$};var Tl=_g,vg=xg;function xg(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(bg,this,e),this.length=this._features.length}function bg(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(u){for(var p=null,y=u.readVarint()+u.pos;u.pos<y;){var x=u.readVarint()>>3;p=1===x?u.readString():2===x?u.readFloat():3===x?u.readDouble():4===x?u.readVarint64():5===x?u.readVarint():6===x?u.readSVarint():7===x?u.readBoolean():null}return p}(n))}xg.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new Tl(this._pbf,e,this.extent,this._keys,this._values)};var Vy=vg;function Jm(t,e,n){if(3===t){var u=new Vy(n,n.readVarint()+n.pos);u.length&&(e[u.name]=u)}}var wg=Qp.VectorTile=function(t,e){this.layers=t.readFields(Jm,{},e)},nd=Qp.VectorTileFeature=_g;function id(t,e,n,u){const p=[],y=0===u?(x,T,I,L,F,G)=>{x.push(new X(G,I+(G-T)/(L-T)*(F-I)))}:(x,T,I,L,F,G)=>{x.push(new X(T+(G-I)/(F-I)*(L-T),G))};for(const x of t){const T=[];for(const I of x){if(I.length<=2)continue;const L=[];for(let $=0;$<I.length-1;$++){const te=I[$].x,oe=I[$].y,me=I[$+1].x,Pe=I[$+1].y,tt=0===u?te:oe,ut=0===u?me:Pe;tt<e?ut>e&&y(L,te,oe,me,Pe,e):tt>n?ut<n&&y(L,te,oe,me,Pe,n):L.push(I[$]),ut<e&&tt>=e&&y(L,te,oe,me,Pe,e),ut>n&&tt<=n&&y(L,te,oe,me,Pe,n)}let F=I[I.length-1];const G=0===u?F.x:F.y;G>=e&&G<=n&&L.push(F),L.length&&(F=L[L.length-1],L[0].x===F.x&&L[0].y===F.y||L.push(L[0]),T.push(L))}T.length&&p.push(T)}return p}Qp.VectorTileLayer=vg;const Eg=nd.types,Zy=Math.pow(2,13);function ef(t,e,n,u,p,y,x,T){t.emplaceBack((e<<1)+x,(n<<1)+y,(Math.floor(u*Zy)<<1)+p,Math.round(T))}function tf(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class Km{constructor(){this.acc=new X(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new X(e.x,e.y),this.max=new X(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const u=this.min,p=this.max;e.x<u.x?u.x=e.x:e.x>p.x&&(p.x=e.x),e.y<u.y?u.y=e.y:e.y>p.y&&(p.y=e.y),((0===e.x||e.x===Gn)&&e.x===n.x)!=((0===e.y||e.y===Gn)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,wn(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Gn!=e.x>Gn&&this.addBorderIntersection(1,wn(n.y,e.y,(Gn-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,wn(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Gn!=e.y>Gn&&this.addBorderIntersection(3,wn(n.x,e.x,(Gn-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[e];n<u[0]&&(u[0]=n),n>u[1]&&(u[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const u=0===e.x?0:1;this.addBorderIntersection(u,n.y),this.addBorderIntersection(u,e.y)}else{const u=0===e.y?2:3;this.addBorderIntersection(u,n.x),this.addBorderIntersection(u,e.x)}}centroid(){const e=this.polyCount.reduce((n,u)=>n+u.edges,0);return 0!==e?this.acc.div(e)._round():new X(0,0)}span(){return new X(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class _h{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new yo,this.centroidVertexArray=new eo,this.indexArray=new Yn,this.programConfigurations=new Gc(e.layers,e.zoom),this.segments=new da,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,u,p){this.features=[],this.hasPattern=wc("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(y){const x=Math.exp(Math.PI*(1-y.y/(1<<y.z)*2));return 80150034*x/(x*x+1)/Gn/(1<<y.z)}(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:y,id:x,index:T,sourceLayerIndex:I}of e){const L=this.layers[0]._featureFilter.needGeometry,F=jc(y,L);if(!this.layers[0]._featureFilter.filter(new Rt(this.zoom),F,u))continue;const G={id:x,sourceLayerIndex:I,index:T,geometry:L?F.geometry:Qu(y,u,p),properties:y.properties,type:y.type,patterns:{}},$=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ec("fill-extrusion",this.layers,G,this.zoom,n)):this.addFeature(G,G.geometry,T,u,{},n.availableImages,p),n.featureIndex.insert(y,G.geometry,T,I,this.index,$)}this.sortBorders()}addFeatures(e,n,u,p,y){for(const x of this.features){const{geometry:T}=x;this.addFeature(x,T,x.index,n,u,p,y)}this.sortBorders()}update(e,n,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yg),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Hm.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Wm.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,u,p,y,x,T){const I=[new X(0,0),new X(Gn,Gn)],L=T.projection,F="globe"===L.name,G=this.enableTerrain&&!F?new Km:null,$="Polygon"===Eg[e.type];F&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new rs);const te=op(n,500);for(let tt=te.length-1;tt>=0;tt--){const ut=te[tt];(0===ut.length||(oe=ut[0]).every(Ke=>Ke.x<=0)||oe.every(Ke=>Ke.x>=Gn)||oe.every(Ke=>Ke.y<=0)||oe.every(Ke=>Ke.y>=Gn))&&te.splice(tt,1)}var oe;let me;if(F)me=Sg(te,I,p);else{me=[];for(const tt of te)me.push({polygon:tt,bounds:I})}const Pe=$?this.edgeRadius:0;for(const{polygon:tt,bounds:ut}of me){let Ke=0,lt=0;for(const ht of tt)$&&!ht[0].equals(ht[ht.length-1])&&ht.push(ht[0]),lt+=$?ht.length-1:ht.length;const vt=this.segments.prepareSegment(($?5:4)*lt,this.layoutVertexArray,this.indexArray);if($){const ht=[],$t=[];Ke=vt.vertexLength;for(const cr of tt){let Pr,Qt;cr.length&&cr!==tt[0]&&$t.push(ht.length/2),Pr=cr[1].sub(cr[0])._perp()._unit();for(let dr=1;dr<cr.length;dr++){const yr=cr[dr],Sr=cr[dr===cr.length-1?1:dr+1];let{x:Ir,y:nr}=yr;if(Pe){Qt=Sr.sub(yr)._perp()._unit();const qr=Pr.add(Qt)._unit(),Rn=Pe*Math.min(4,1/(Pr.x*qr.x+Pr.y*qr.y));Ir+=Rn*qr.x,nr+=Rn*qr.y,Pr=Qt}ef(this.layoutVertexArray,Ir,nr,0,0,1,1,0),vt.vertexLength++,ht.push(yr.x,yr.y),F&&tf(this.layoutVertexExtArray,L.projectTilePoint(Ir,nr,p),L.upVector(p,Ir,nr))}}const Zt=Hh.exports(ht,$t);for(let cr=0;cr<Zt.length;cr+=3)this.indexArray.emplaceBack(Ke+Zt[cr],Ke+Zt[cr+2],Ke+Zt[cr+1]),vt.primitiveLength++}for(const ht of tt){G&&ht.length&&G.startRing(ht[0]);let $t,Zt,cr,Pr=ht.length>4&&ty(ht[ht.length-2],ht[0],ht[1]),Qt=Pe?Xy(ht[ht.length-2],ht[0],ht[1],Pe):0;Zt=ht[1].sub(ht[0])._perp()._unit();let dr=!0;for(let yr=1,Sr=0;yr<ht.length;yr++){let Ir=ht[yr-1],nr=ht[yr];const qr=ht[yr===ht.length-1?1:yr+1];if(G&&$&&G.currentPolyCount.top++,ey(nr,Ir,ut)){Pe&&(Zt=qr.sub(nr)._perp()._unit(),dr=!dr);continue}G&&G.append(nr,Ir);const Rn=nr.sub(Ir)._perp(),Xr=Rn.x/(Math.abs(Rn.x)+Math.abs(Rn.y)),dn=Rn.y>0?1:0,Vr=Ir.dist(nr);if(Sr+Vr>32768&&(Sr=0),Pe){cr=qr.sub(nr)._perp()._unit();let vi=od(Ir,nr,qr,Qm(Zt,cr),Pe);isNaN(vi)&&(vi=0);const jn=nr.sub(Ir)._unit();Ir=Ir.add(jn.mult(Qt))._round(),nr=nr.add(jn.mult(-vi))._round(),Qt=vi,Zt=cr}const Fn=vt.vertexLength,Di=ht.length>4&&ty(Ir,nr,qr);let Ti=ry(Sr,Pr,dr);if(ef(this.layoutVertexArray,Ir.x,Ir.y,Xr,dn,0,0,Ti),ef(this.layoutVertexArray,Ir.x,Ir.y,Xr,dn,0,1,Ti),Sr+=Vr,Ti=ry(Sr,Di,!dr),Pr=Di,ef(this.layoutVertexArray,nr.x,nr.y,Xr,dn,0,0,Ti),ef(this.layoutVertexArray,nr.x,nr.y,Xr,dn,0,1,Ti),vt.vertexLength+=4,this.indexArray.emplaceBack(Fn+0,Fn+1,Fn+2),this.indexArray.emplaceBack(Fn+1,Fn+3,Fn+2),vt.primitiveLength+=2,Pe){const vi=Ke+(1===yr?ht.length-2:yr-2),jn=1===yr?Ke:vi+1;if(this.indexArray.emplaceBack(Fn+1,vi,Fn+3),this.indexArray.emplaceBack(vi,jn,Fn+3),vt.primitiveLength+=2,void 0===$t&&($t=Fn),!ey(qr,ht[yr],ut)){const Ro=yr===ht.length-1?$t:vt.vertexLength;this.indexArray.emplaceBack(Fn+2,Fn+3,Ro),this.indexArray.emplaceBack(Fn+3,Ro+1,Ro),this.indexArray.emplaceBack(Fn+3,jn,Ro+1),vt.primitiveLength+=3}dr=!dr}if(F){const vi=this.layoutVertexExtArray,jn=L.projectTilePoint(Ir.x,Ir.y,p),Ro=L.projectTilePoint(nr.x,nr.y,p),ei=L.upVector(p,Ir.x,Ir.y),Oi=L.upVector(p,nr.x,nr.y);tf(vi,jn,ei),tf(vi,jn,ei),tf(vi,Ro,Oi),tf(vi,Ro,Oi)}}$&&(Ke+=ht.length-1)}}if(G&&G.polyCount.length>0){if(G.borders){G.vertexArrayOffset=this.centroidVertexArray.length;const tt=G.borders,ut=this.featuresOnBorder.push(G)-1;for(let Ke=0;Ke<4;Ke++)tt[Ke][0]!==Number.MAX_VALUE&&this.borders[Ke].push(ut)}this.encodeCentroid(G.borders?void 0:G.centroid(),G)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,x,p)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,u)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[u].borders[e][0])}encodeCentroid(e,n,u=!0){let p,y;if(e)if(0!==e.y){const T=n.span()._mult(this.tileToMeter);p=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(T.x/10)),y=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(T.y/10))}else p=Math.ceil(7*(e.x+450)),y=0;else p=0,y=+u;let x=u?this.centroidVertexArray.length:n.vertexArrayOffset;for(const T of n.polyCount){u&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*T.edges+T.top);for(let I=0;I<T.top;I++)this.centroidVertexArray.emplace(x++,p,y);for(let I=0;I<2*T.edges;I++)this.centroidVertexArray.emplace(x++,0,y),this.centroidVertexArray.emplace(x++,p,y)}}}function Qm(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function Xy(t,e,n,u){const p=e.sub(t)._perp()._unit(),y=n.sub(e)._perp()._unit();return od(t,e,n,Qm(p,y),u)}function od(t,e,n,u,p){const y=Math.sqrt(1-u*u);return Math.min(t.dist(e)/3,e.dist(n)/3,p*y/u)}function ey(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function ty(t,e,n){if(t.x<0||t.x>=Gn||e.x<0||e.x>=Gn||n.x<0||n.x>=Gn)return!1;const u=n.sub(e),p=u.perp(),y=t.sub(e);return(u.x*y.x+u.y*y.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(y.x*y.x+y.y*y.y))>-.866&&p.x*y.x+p.y*y.y<0}function ry(t,e,n){const u=e?2|t:-3&t;return n?1|u:-2&u}function ny(){const t=Math.PI/32,e=Math.tan(t),n=Fp;return n*Math.sqrt(1+2*e*e)-n}function Sg(t,e,n){const u=1<<n.z,p=bn(n.x/u),y=bn((n.x+1)/u),x=ln(n.y/u),T=ln((n.y+1)/u);return function(I,L,F,G,$=0,te){const oe=[];if(!I.length||!F||!G)return oe;const me=(ht,$t)=>{for(const Zt of ht)oe.push({polygon:Zt,bounds:$t})},Pe=Math.ceil(Math.log2(F)),tt=Math.ceil(Math.log2(G)),ut=Pe-tt,Ke=[];for(let ht=0;ht<Math.abs(ut);ht++)Ke.push(ut>0?0:1);for(let ht=0;ht<Math.min(Pe,tt);ht++)Ke.push(0),Ke.push(1);let lt=I;if(lt=id(lt,L[0].y-$,L[1].y+$,1),lt=id(lt,L[0].x-$,L[1].x+$,0),!lt.length)return oe;const vt=[];for(Ke.length?vt.push({polygons:lt,bounds:L,depth:0}):me(lt,L);vt.length;){const ht=vt.pop(),$t=ht.depth,Zt=Ke[$t],cr=ht.bounds[0],Pr=ht.bounds[1],Qt=0===Zt?cr.x:cr.y,dr=0===Zt?Pr.x:Pr.y,yr=te?te(Zt,Qt,dr):.5*(Qt+dr),Sr=id(ht.polygons,Qt-$,yr+$,Zt),Ir=id(ht.polygons,yr-$,dr+$,Zt);if(Sr.length){const nr=[cr,new X(0===Zt?yr:Pr.x,1===Zt?yr:Pr.y)];Ke.length>$t+1?vt.push({polygons:Sr,bounds:nr,depth:$t+1}):me(Sr,nr)}if(Ir.length){const nr=[new X(0===Zt?yr:cr.x,1===Zt?yr:cr.y),Pr];Ke.length>$t+1?vt.push({polygons:Ir,bounds:nr,depth:$t+1}):me(Ir,nr)}}return oe}(t,e,Math.ceil((y-p)/11.25),Math.ceil((x-T)/11.25),1,(I,L,F)=>{if(0===I)return.5*(L+F);{const G=ln((n.y+L/Gn)/u);return(an(.5*(ln((n.y+F/Gn)/u)+G))*u-n.y)*Gn}})}gt(_h,"FillExtrusionBucket",{omit:["layers","features"]}),gt(Km,"PartMetadata");const iy=new Ln({"fill-extrusion-edge-radius":new zt(ur["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var $y={paint:new Ln({"fill-extrusion-opacity":new zt(ur["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Kt(ur["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new zt(ur["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new zt(ur["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Kt(ur["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Kt(ur["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Kt(ur["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new zt(ur["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new zt(ur["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new zt(ur["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:iy};function Cg(t,e,n){var u=2*Math.PI*6378137/256/Math.pow(2,n);return[t*u-2*Math.PI*6378137/2,e*u-2*Math.PI*6378137/2]}class sd{constructor(e,n,u){this.z=e,this.x=n,this.y=u,this.key=lp(0,e,e,n,u)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const u=(x=this.y,T=this.z,I=Cg(256*(y=this.x),256*(x=Math.pow(2,T)-x-1),T),L=Cg(256*(y+1),256*(x+1),T),I[0]+","+I[1]+","+L[0]+","+L[1]),p=function(y,x,T){let I,L="";for(let F=y;F>0;F--)I=1<<F-1,L+=(x&I?1:0)+(T&I?2:0);return L}(this.z,this.x,this.y);var y,x,T,I,L;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",p).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class oy{constructor(e,n){this.wrap=e,this.canonical=n,this.key=lp(e,n.z,n.z,n.x,n.y)}}class ml{constructor(e,n,u,p,y){this.overscaledZ=e,this.wrap=n,this.canonical=new sd(u,+p,+y),this.key=0===n&&e===u?this.canonical.key:lp(n,e,u,p,y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new ml(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ml(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return lp(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-e;return lp(this.wrap*+n,e,e,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ml(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,u=2*this.canonical.x,p=2*this.canonical.y;return[new ml(n,this.wrap,n,u,p),new ml(n,this.wrap,n,u+1,p),new ml(n,this.wrap,n,u,p+1),new ml(n,this.wrap,n,u+1,p+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ml(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ml(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new oy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function lp(t,e,n,u,p){const y=1<<Math.min(n,22);let x=y*(p%y)+u%y;return t&&n<22&&(x+=y*y*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*x+n)+(e-n)}gt(sd,"CanonicalTileID"),gt(ml,"OverscaledTileID",{omit:["projMatrix"]});class up extends X{constructor(e,n,u){super(e,n),this.z=u}}function rf(t,e){return t.x*e.x+t.y*e.y}function ad(t,e){if(1===t.length){let n=0;const u=e[n++];let p;for(;!p||u.equals(p);)if(p=e[n++],!p)return 1/0;for(;n<e.length;n++){const y=e[n],x=t[0],T=p.sub(u),I=y.sub(u),L=x.sub(u),F=rf(T,T),G=rf(T,I),$=rf(I,I),te=rf(L,T),oe=rf(L,I),me=F*$-G*G,Pe=($*te-G*oe)/me,tt=(F*oe-G*te)/me,ut=u.z*(1-Pe-tt)+p.z*Pe+y.z*tt;if(isFinite(ut))return ut}return 1/0}{let n=1/0;for(const u of e)n=Math.min(n,u.z);return n}}function ld(t,e,n,u,p,y,x,T){const I=x*p.getElevationAt(t,e,!0,!0),L=0!==y[0],F=L?0===y[1]?x*(y[0]/7-450):x*function(G,$,te){const oe=Math.floor($[0]/8),me=Math.floor($[1]/8),Pe=10*($[0]-8*oe),tt=10*($[1]-8*me),ut=G.getElevationAt(oe,me,!0,!0),Ke=G.getMeterToDEM(te),lt=Math.floor(.5*(Pe*Ke-1)),vt=Math.floor(.5*(tt*Ke-1)),ht=G.tileCoordToPixel(oe,me),$t=2*lt+1,Zt=2*vt+1,cr=(Rn=$t,Xr=Zt,[(Ir=G).getElevationAtPixel(nr=ht.x-lt,qr=ht.y-vt,!0),Ir.getElevationAtPixel(nr+Xr,qr,!0),Ir.getElevationAtPixel(nr,qr+Xr,!0),Ir.getElevationAtPixel(nr+Rn,qr+Xr,!0)]),Pr=Math.abs(cr[0]-cr[1]),Qt=Math.abs(cr[2]-cr[3]),dr=Math.abs(cr[0]-cr[2])+Math.abs(cr[1]-cr[3]),yr=Math.min(.25,.5*Ke*(Pr+Qt)/$t),Sr=Math.min(.25,.5*Ke*dr/Zt);var Ir,nr,qr,Rn,Xr;return ut+Math.max(yr*Pe,Sr*tt)}(p,y,T):I;return{base:I+(0===n)?-1:n,top:L?Math.max(F+u,I+n+2):I+u}}const Tg=Kr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:sy}=Tg,ay=Kr([{name:"a_packed",components:4,type:"Float32"}]),{members:ud}=ay,Yy=nd.types,Wy=Math.cos(Math.PI/180*37.5);class cd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new dl,this.layoutVertexArray2=new El,this.indexArray=new Yn,this.programConfigurations=new Gc(e.layers,e.zoom),this.segments=new da,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,u,p){this.hasPattern=wc("line",this.layers,n);const y=this.layers[0].layout.get("line-sort-key"),x=[];for(const{feature:F,id:G,index:$,sourceLayerIndex:te}of e){const oe=this.layers[0]._featureFilter.needGeometry,me=jc(F,oe);if(!this.layers[0]._featureFilter.filter(new Rt(this.zoom),me,u))continue;const Pe=y?y.evaluate(me,{},u):void 0,tt={id:G,properties:F.properties,type:F.type,sourceLayerIndex:te,index:$,geometry:oe?me.geometry:Qu(F,u,p),patterns:{},sortKey:Pe};x.push(tt)}y&&x.sort((F,G)=>F.sortKey-G.sortKey);const{lineAtlas:T,featureIndex:I}=n,L=this.addConstantDashes(T);for(const F of x){const{geometry:G,index:$,sourceLayerIndex:te}=F;if(L&&this.addFeatureDashes(F,T),this.hasPattern){const oe=Ec("line",this.layers,F,this.zoom,n);this.patternFeatures.push(oe)}else this.addFeature(F,G,$,u,T.positions,n.availableImages);I.insert(e[$].feature,G,$,te,this.index)}}addConstantDashes(e){let n=!1;for(const u of this.layers){const p=u.paint.get("line-dasharray").value,y=u.layout.get("line-cap").value;if("constant"!==p.kind||"constant"!==y.kind)n=!0;else{const x=y.value,T=p.value;if(!T)continue;e.addDash(T,x)}}return n}addFeatureDashes(e,n){const u=this.zoom;for(const p of this.layers){const y=p.paint.get("line-dasharray").value,x=p.layout.get("line-cap").value;if("constant"===y.kind&&"constant"===x.kind)continue;let T,I;if("constant"===y.kind){if(T=y.value,!T)continue}else T=y.evaluate({zoom:u},e);I="constant"===x.kind?x.value:x.evaluate({zoom:u},e),n.addDash(T,I),e.patterns[p.id]=n.getKey(T,I)}}update(e,n,u,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,u,p)}addFeatures(e,n,u,p,y){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,n,u,p)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ud)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sy),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,u,p,y,x){const T=this.layers[0].layout,I=T.get("line-join").evaluate(e,{}),L=T.get("line-cap").evaluate(e,{}),F=T.get("line-miter-limit"),G=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const $ of n)this.addLine($,e,I,L,F,G);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,u,y,x,p)}addLine(e,n,u,p,y,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let tt=0;tt<e.length-1;tt++)this.totalDistance+=e[tt].dist(e[tt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T="Polygon"===Yy[n.type];let I=e.length;for(;I>=2&&e[I-1].equals(e[I-2]);)I--;let L=0;for(;L<I-1&&e[L].equals(e[L+1]);)L++;if(I<(T?3:2))return;"bevel"===u&&(y=1.05);const F=this.overscaling<=16?122880/(512*this.overscaling):0,G=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let $,te,oe,me,Pe;this.e1=this.e2=-1,T&&($=e[I-2],Pe=e[L].sub($)._unit()._perp());for(let tt=L;tt<I;tt++){if(oe=tt===I-1?T?e[L+1]:void 0:e[tt+1],oe&&e[tt].equals(oe))continue;Pe&&(me=Pe),$&&(te=$),$=e[tt],Pe=oe?oe.sub($)._unit()._perp():me,me=me||Pe;let ut=me.add(Pe);0===ut.x&&0===ut.y||ut._unit();const Ke=me.x*Pe.x+me.y*Pe.y,lt=ut.x*Pe.x+ut.y*Pe.y,vt=0!==lt?1/lt:1/0,ht=2*Math.sqrt(2-2*lt),$t=lt<Wy&&te&&oe,Zt=me.x*Pe.y-me.y*Pe.x>0;if($t&&tt>L){const Qt=$.dist(te);if(Qt>2*F){const dr=$.sub($.sub(te)._mult(F/Qt)._round());this.updateDistance(te,dr),this.addCurrentVertex(dr,me,0,0,G),te=dr}}const cr=te&&oe;let Pr=cr?u:T?"butt":p;if(cr&&"round"===Pr&&(vt<x?Pr="miter":vt<=2&&(Pr="fakeround")),"miter"===Pr&&vt>y&&(Pr="bevel"),"bevel"===Pr&&(vt>2&&(Pr="flipbevel"),vt<y&&(Pr="miter")),te&&this.updateDistance(te,$),"miter"===Pr)ut._mult(vt),this.addCurrentVertex($,ut,0,0,G);else if("flipbevel"===Pr){if(vt>100)ut=Pe.mult(-1);else{const Qt=vt*me.add(Pe).mag()/me.sub(Pe).mag();ut._perp()._mult(Qt*(Zt?-1:1))}this.addCurrentVertex($,ut,0,0,G),this.addCurrentVertex($,ut.mult(-1),0,0,G)}else if("bevel"===Pr||"fakeround"===Pr){const Qt=-Math.sqrt(vt*vt-1),dr=Zt?Qt:0,yr=Zt?0:Qt;if(te&&this.addCurrentVertex($,me,dr,yr,G),"fakeround"===Pr){const Sr=Math.round(180*ht/Math.PI/20);for(let Ir=1;Ir<Sr;Ir++){let nr=Ir/Sr;if(.5!==nr){const Rn=nr-.5;nr+=nr*Rn*(nr-1)*((1.0904+Ke*(Ke*(3.55645-1.43519*Ke)-3.2452))*Rn*Rn+(.848013+Ke*(.215638*Ke-1.06021)))}const qr=Pe.sub(me)._mult(nr)._add(me)._unit()._mult(Zt?-1:1);this.addHalfVertex($,qr.x,qr.y,!1,Zt,0,G)}}oe&&this.addCurrentVertex($,Pe,-dr,-yr,G)}else if("butt"===Pr)this.addCurrentVertex($,ut,0,0,G);else if("square"===Pr){const Qt=te?1:-1;te||this.addCurrentVertex($,ut,Qt,Qt,G),this.addCurrentVertex($,ut,0,0,G),te&&this.addCurrentVertex($,ut,Qt,Qt,G)}else"round"===Pr&&(te&&(this.addCurrentVertex($,me,0,0,G),this.addCurrentVertex($,me,1,1,G,!0)),oe&&(this.addCurrentVertex($,Pe,-1,-1,G,!0),this.addCurrentVertex($,Pe,0,0,G)));if($t&&tt<I-1){const Qt=$.dist(oe);if(Qt>2*F){const dr=$.add(oe.sub($)._mult(F/Qt)._round());this.updateDistance($,dr),this.addCurrentVertex(dr,Pe,0,0,G),$=dr}}}}addCurrentVertex(e,n,u,p,y,x=!1){const T=n.y*p-n.x,I=-n.y-n.x*p;this.addHalfVertex(e,n.x+n.y*u,n.y-n.x*u,x,!1,u,y),this.addHalfVertex(e,T,I,x,!0,-p,y)}addHalfVertex({x:e,y:n},u,p,y,x,T,I){this.layoutVertexArray.emplaceBack((e<<1)+(y?1:0),(n<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*p)+128,1+(0===T?0:T<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const L=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),I.primitiveLength++),x?this.e2=L:this.e1=L}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}gt(cd,"LineBucket",{omit:["layers","patternFeatures"]});const ly=new Ln({"line-cap":new Kt(ur.layout_line["line-cap"]),"line-join":new Kt(ur.layout_line["line-join"]),"line-miter-limit":new zt(ur.layout_line["line-miter-limit"]),"line-round-limit":new zt(ur.layout_line["line-round-limit"]),"line-sort-key":new Kt(ur.layout_line["line-sort-key"])});var hd={paint:new Ln({"line-opacity":new Kt(ur.paint_line["line-opacity"]),"line-color":new Kt(ur.paint_line["line-color"]),"line-translate":new zt(ur.paint_line["line-translate"]),"line-translate-anchor":new zt(ur.paint_line["line-translate-anchor"]),"line-width":new Kt(ur.paint_line["line-width"]),"line-gap-width":new Kt(ur.paint_line["line-gap-width"]),"line-offset":new Kt(ur.paint_line["line-offset"]),"line-blur":new Kt(ur.paint_line["line-blur"]),"line-dasharray":new Kt(ur.paint_line["line-dasharray"]),"line-pattern":new Kt(ur.paint_line["line-pattern"]),"line-gradient":new fn(ur.paint_line["line-gradient"]),"line-trim-offset":new zt(ur.paint_line["line-trim-offset"])}),layout:ly};const Mg=new class extends Kt{possiblyEvaluate(t,e){return e=new Rt(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,u){return e=Ae({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,u)}}(hd.paint.properties["line-width"].specification);function Ig(t,e){return e>0?e+2*t:t}Mg.useIntegerZoom=!0;const Pg=Kr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hy=Kr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),uy=Kr([{name:"a_projected_pos",components:4,type:"Float32"}],4);Kr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Jy=Kr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),cy=Kr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Kr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const pd=Kr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),hy=Kr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Kr([{name:"triangle",components:3,type:"Uint16"}]),Kr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Kr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Kr([{type:"Float32",name:"offsetX"}]),Kr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);const tc=128;function Ag(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Rt(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:u,interpolationType:p}=n;let y=0;for(;y<u.length&&u[y]<=t;)y++;y=Math.max(0,y-1);let x=y;for(;x<u.length&&u[x]<t+1;)x++;x=Math.min(u.length-1,x);const T=u[y],I=u[x];return"composite"===n.kind?{kind:"composite",minZoom:T,maxZoom:I,interpolationType:p}:{kind:"camera",minZoom:T,maxZoom:I,minSize:n.evaluate(new Rt(T)),maxSize:n.evaluate(new Rt(I)),interpolationType:p}}}function fd(t,{uSize:e,uSizeT:n},{lowerSize:u,upperSize:p}){return"source"===t.kind?u/tc:"composite"===t.kind?wn(u/tc,p/tc,n):e}function cp(t,e){let n=0,u=0;if("constant"===t.kind)u=t.layoutSize;else if("source"!==t.kind){const{interpolationType:p,minZoom:y,maxZoom:x}=t,T=p?Ee(tr.interpolationFactor(p,e,y,x),0,1):0;"camera"===t.kind?u=wn(t.minSize,t.maxSize,T):n=T}return{uSizeT:n,uSize:u}}var Sc=Object.freeze({__proto__:null,getSizeData:Ag,evaluateSizeForFeature:fd,evaluateSizeForZoom:cp,SIZE_PACK_FACTOR:tc});function nf(t,e,n){return t.sections.forEach(u=>{u.text=function(p,y,x){const T=y.layout.get("text-transform").evaluate(x,{});return"uppercase"===T?p=p.toLocaleUpperCase():"lowercase"===T&&(p=p.toLocaleLowerCase()),jt.applyArabicShaping&&(p=jt.applyArabicShaping(p)),p}(u.text,e,n)}),t}const Cc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Lg(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function Xa(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var of=To,Zs=function(t,e,n,u,p){var y,x,T=8*p-u-1,I=(1<<T)-1,L=I>>1,F=-7,G=n?p-1:0,$=n?-1:1,te=t[e+G];for(G+=$,y=te&(1<<-F)-1,te>>=-F,F+=T;F>0;y=256*y+t[e+G],G+=$,F-=8);for(x=y&(1<<-F)-1,y>>=-F,F+=u;F>0;x=256*x+t[e+G],G+=$,F-=8);if(0===y)y=1-L;else{if(y===I)return x?NaN:1/0*(te?-1:1);x+=Math.pow(2,u),y-=L}return(te?-1:1)*x*Math.pow(2,y-u)},Fl=function(t,e,n,u,p,y){var x,T,I,L=8*y-p-1,F=(1<<L)-1,G=F>>1,$=23===p?Math.pow(2,-24)-Math.pow(2,-77):0,te=u?0:y-1,oe=u?1:-1,me=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(T=isNaN(e)?1:0,x=F):(x=Math.floor(Math.log(e)/Math.LN2),e*(I=Math.pow(2,-x))<1&&(x--,I*=2),(e+=x+G>=1?$/I:$*Math.pow(2,1-G))*I>=2&&(x++,I/=2),x+G>=F?(T=0,x=F):x+G>=1?(T=(e*I-1)*Math.pow(2,p),x+=G):(T=e*Math.pow(2,G-1)*Math.pow(2,p),x=0));p>=8;t[n+te]=255&T,te+=oe,T/=256,p-=8);for(x=x<<p|T,L+=p;L>0;t[n+te]=255&x,te+=oe,x/=256,L-=8);t[n+te-oe]|=128*me};function To(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}To.Varint=0,To.Fixed64=1,To.Bytes=2,To.Fixed32=5;var Tc=4294967296,sf=1/Tc,bs=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ga(t){return t.type===To.Bytes?t.readVarint()+t.pos:t.pos+1}function $c(t,e,n){var u=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(u);for(var p=n.pos-1;p>=t;p--)n.buf[p+u]=n.buf[p]}function ko(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Ky(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Dg(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function Qy(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Og(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function e_(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function co(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function t_(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function rc(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function hp(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function vh(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Yc(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function r_(t,e,n){e.glyphs=[],1===t&&n.readMessage(ia,e)}function ia(t,e,n){if(3===t){const{id:u,bitmap:p,width:y,height:x,left:T,top:I,advance:L}=n.readMessage(af,{});e.glyphs.push({id:u,bitmap:new vc({width:y+6,height:x+6},p),metrics:{width:y,height:x,left:T,top:I,advance:L}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function af(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function lf(t){let e=0,n=0;for(const x of t)e+=x.w*x.h,n=Math.max(n,x.w);t.sort((x,T)=>T.h-x.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let p=0,y=0;for(const x of t)for(let T=u.length-1;T>=0;T--){const I=u[T];if(!(x.w>I.w||x.h>I.h)){if(x.x=I.x,x.y=I.y,y=Math.max(y,x.y+x.h),p=Math.max(p,x.x+x.w),x.w===I.w&&x.h===I.h){const L=u.pop();T<u.length&&(u[T]=L)}else x.h===I.h?(I.x+=x.w,I.w-=x.w):x.w===I.w?(I.y+=x.h,I.h-=x.h):(u.push({x:I.x+x.w,y:I.y,w:I.w-x.w,h:x.h}),I.y+=x.h,I.h-=x.h);break}}return{w:p,h:y,fill:e/(p*y)||0}}To.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var u=this.readVarint(),p=u>>3,y=this.pos;this.type=7&u,t(p,e,this),this.pos===y&&this.skip(u)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=hp(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Yc(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=hp(this.buf,this.pos)+hp(this.buf,this.pos+4)*Tc;return this.pos+=8,t},readSFixed64:function(){var t=hp(this.buf,this.pos)+Yc(this.buf,this.pos+4)*Tc;return this.pos+=8,t},readFloat:function(){var t=Zs(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Zs(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,u=this.buf;return e=127&(n=u[this.pos++]),n<128?e:(e|=(127&(n=u[this.pos++]))<<7,n<128?e:(e|=(127&(n=u[this.pos++]))<<14,n<128?e:(e|=(127&(n=u[this.pos++]))<<21,n<128?e:function(p,y,x){var T,I,L=x.buf;if(T=(112&(I=L[x.pos++]))>>4,I<128||(T|=(127&(I=L[x.pos++]))<<3,I<128)||(T|=(127&(I=L[x.pos++]))<<10,I<128)||(T|=(127&(I=L[x.pos++]))<<17,I<128)||(T|=(127&(I=L[x.pos++]))<<24,I<128)||(T|=(1&(I=L[x.pos++]))<<31,I<128))return function ju(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(p,T,y);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=u[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&bs?bs.decode(this.buf.subarray(e,t)):function(n,u,p){for(var y="",x=u;x<p;){var T,I,L,F=n[x],G=null,$=F>239?4:F>223?3:F>191?2:1;if(x+$>p)break;1===$?F<128&&(G=F):2===$?128==(192&(T=n[x+1]))&&(G=(31&F)<<6|63&T)<=127&&(G=null):3===$?(I=n[x+2],128==(192&(T=n[x+1]))&&128==(192&I)&&((G=(15&F)<<12|(63&T)<<6|63&I)<=2047||G>=55296&&G<=57343)&&(G=null)):4===$&&(I=n[x+2],L=n[x+3],128==(192&(T=n[x+1]))&&128==(192&I)&&128==(192&L)&&((G=(15&F)<<18|(63&T)<<12|(63&I)<<6|63&L)<=65535||G>=1114112)&&(G=null)),null===G?(G=65533,$=1):G>65535&&(G-=65536,y+=String.fromCharCode(G>>>10&1023|55296),G=56320|1023&G),y+=String.fromCharCode(G),x+=$}return y}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==To.Bytes)return t.push(this.readVarint(e));var n=ga(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==To.Bytes)return t.push(this.readSVarint());var e=ga(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==To.Bytes)return t.push(this.readBoolean());var e=ga(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==To.Bytes)return t.push(this.readFloat());var e=ga(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==To.Bytes)return t.push(this.readDouble());var e=ga(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==To.Bytes)return t.push(this.readFixed32());var e=ga(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==To.Bytes)return t.push(this.readSFixed32());var e=ga(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==To.Bytes)return t.push(this.readFixed64());var e=ga(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==To.Bytes)return t.push(this.readSFixed64());var e=ga(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===To.Varint)for(;this.buf[this.pos++]>127;);else if(e===To.Bytes)this.pos=this.readVarint()+this.pos;else if(e===To.Fixed32)this.pos+=4;else{if(e!==To.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),vh(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),vh(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),vh(this.buf,-1&t,this.pos),vh(this.buf,Math.floor(t*sf),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),vh(this.buf,-1&t,this.pos),vh(this.buf,Math.floor(t*sf),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var u,p,y,T;if(e>=0?(u=e%4294967296|0,p=e/4294967296|0):(p=~(-e/4294967296),4294967295^(u=~(-e%4294967296))?u=u+1|0:(u=0,p=p+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),y=u,(T=n).buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,y>>>=7,T.buf[T.pos++]=127&y|128,T.buf[T.pos]=127&(y>>>=7),function(y,x){var T=(7&y)<<4;x.buf[x.pos++]|=T|((y>>>=3)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y|((y>>>=7)?128:0),y&&(x.buf[x.pos++]=127&y)))))}(p,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(u,p,y){for(var x,T,I=0;I<p.length;I++){if((x=p.charCodeAt(I))>55295&&x<57344){if(!T){x>56319||I+1===p.length?(u[y++]=239,u[y++]=191,u[y++]=189):T=x;continue}if(x<56320){u[y++]=239,u[y++]=191,u[y++]=189,T=x;continue}x=T-55296<<10|x-56320|65536,T=null}else T&&(u[y++]=239,u[y++]=191,u[y++]=189,T=null);x<128?u[y++]=x:(x<2048?u[y++]=x>>6|192:(x<65536?u[y++]=x>>12|224:(u[y++]=x>>18|240,u[y++]=x>>12&63|128),u[y++]=x>>6&63|128),u[y++]=63&x|128)}return y}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&$c(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Fl(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Fl(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var u=this.pos-n;u>=128&&$c(n,u,this),this.pos=n-1,this.writeVarint(u),this.pos+=u},writeMessage:function(t,e,n){this.writeTag(t,To.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,ko,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Ky,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Og,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Dg,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Qy,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,e_,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,co,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,t_,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,rc,e)},writeBytesField:function(t,e){this.writeTag(t,To.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,To.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,To.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,To.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,To.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,To.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,To.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,To.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,To.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,To.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class uf{constructor(e,{pixelRatio:n,version:u,stretchX:p,stretchY:y,content:x}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=p,this.stretchY=y,this.content=x,this.version=u}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class cf{constructor(e,n){const u={},p={};this.haveRenderCallbacks=[];const y=[];this.addImages(e,u,y),this.addImages(n,p,y);const{w:x,h:T}=lf(y),I=new Kl({width:x||1,height:T||1});for(const L in e){const F=e[L],G=u[L].paddedRect;Kl.copy(F.data,I,{x:0,y:0},{x:G.x+1,y:G.y+1},F.data)}for(const L in n){const F=n[L],G=p[L].paddedRect,$=G.x+1,te=G.y+1,oe=F.data.width,me=F.data.height;Kl.copy(F.data,I,{x:0,y:0},{x:$,y:te},F.data),Kl.copy(F.data,I,{x:0,y:me-1},{x:$,y:te-1},{width:oe,height:1}),Kl.copy(F.data,I,{x:0,y:0},{x:$,y:te+me},{width:oe,height:1}),Kl.copy(F.data,I,{x:oe-1,y:0},{x:$-1,y:te},{width:1,height:me}),Kl.copy(F.data,I,{x:0,y:0},{x:$+oe,y:te},{width:1,height:me})}this.image=I,this.iconPositions=u,this.patternPositions=p}addImages(e,n,u){for(const p in e){const y=e[p],x={x:0,y:0,w:y.data.width+2,h:y.data.height+2};u.push(x),n[p]=new uf(x,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(p)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(u=>e.hasImage(u)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const u in e.updatedImages)this.patchUpdatedImage(this.iconPositions[u],e.getImage(u),n),this.patchUpdatedImage(this.patternPositions[u],e.getImage(u),n)}patchUpdatedImage(e,n,u){if(!e||!n||e.version===n.version)return;e.version=n.version;const[p,y]=e.tl;u.update(n.data,void 0,{x:p,y})}}gt(uf,"ImagePosition"),gt(cf,"ImageAtlas");const Xl={horizontal:1,vertical:2,horizontalOnly:3};class pp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const u=new pp;return u.scale=e||1,u.fontStack=n,u}static forImage(e){const n=new pp;return n.imageName=e,n}}class nc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const u=new nc;for(let p=0;p<e.sections.length;p++){const y=e.sections[p];y.image?u.addImageSection(y):u.addTextSection(y,n)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,u){let p="";for(let y=0;y<n.length;y++){const x=n.charCodeAt(y+1)||null,T=n.charCodeAt(y-1)||null;p+=!u&&(x&&J(x)&&!Cc[n[y+1]]||T&&J(T)&&!Cc[n[y-1]])||!Cc[n[y]]?n[y]:Cc[n[y]]}return p}(this.text,e)}trim(){let e=0;for(let u=0;u<this.text.length&&fp[this.text.charCodeAt(u)];u++)e++;let n=this.text.length;for(let u=this.text.length-1;u>=0&&u>=e&&fp[this.text.charCodeAt(u)];u--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const u=new nc;return u.text=this.text.substring(e,n),u.sectionIndex=this.sectionIndex.slice(e,n),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(pp.forText(e.scale,e.fontStack||n));const u=this.sections.length-1;for(let p=0;p<e.text.length;++p)this.sectionIndex.push(u)}addImageSection(e){const n=e.image?e.image.name:"";if(0===n.length)return void Ar("Can't add FormattedSection with an empty image.");const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCharCode(u),this.sections.push(pp.forImage(n)),this.sectionIndex.push(this.sections.length-1)):Ar("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function xh(t,e,n,u,p,y,x,T,I,L,F,G,$,te,oe){const me=nc.fromFeature(t,p);G===Xl.vertical&&me.verticalizePunctuation($);let Pe=[];const tt=function(ht,$t,Zt,cr,Pr,Qt){if(!ht)return[];const dr=[],yr=function(qr,Rn,Xr,dn,Vr,Fn){let Di=0;for(let Ti=0;Ti<qr.length();Ti++){const vi=qr.getSection(Ti);Di+=hf(qr.getCharCode(Ti),vi,dn,Vr,Rn,Fn)}return Di/Math.max(1,Math.ceil(Di/Xr))}(ht,$t,Zt,cr,Pr,Qt),Sr=ht.text.indexOf("\u200b")>=0;let Ir=0;for(let qr=0;qr<ht.length();qr++){const Rn=ht.getSection(qr),Xr=ht.getCharCode(qr);if(fp[Xr]||(Ir+=hf(Xr,Rn,cr,Pr,$t,Qt)),qr<ht.length()-1){const dn=!((nr=Xr)<11904||!(zh(nr)||pc(nr)||h(nr)||dc(nr)||Ip(nr)||na(nr)||Bh(nr)||Su(nr)||fc(nr)||Fu(nr)||Uc(nr)||M(nr)||Bc(nr)||Nl(nr)||wl(nr)||Uh(nr)||hh(nr)||i(nr)||Bf(nr)||Pp(nr)));(kg[Xr]||dn||Rn.imageName)&&dr.push(Iu(qr+1,Ir,yr,dr,dd(Xr,ht.getCharCode(qr+1),dn&&Sr),!1))}}var nr;return Rg(Iu(ht.length(),Ir,yr,dr,0,!0))}(me,L,y,e,u,te),{processBidirectionalText:ut,processStyledBidirectionalText:Ke}=jt;if(ut&&1===me.sections.length){const ht=ut(me.toString(),tt);for(const $t of ht){const Zt=new nc;Zt.text=$t,Zt.sections=me.sections;for(let cr=0;cr<$t.length;cr++)Zt.sectionIndex.push(0);Pe.push(Zt)}}else if(Ke){const ht=Ke(me.text,me.sectionIndex,tt);for(const $t of ht){const Zt=new nc;Zt.text=$t[0],Zt.sectionIndex=$t[1],Zt.sections=me.sections,Pe.push(Zt)}}else Pe=function(ht,$t){const Zt=[],cr=ht.text;let Pr=0;for(const Qt of $t)Zt.push(ht.substring(Pr,Qt)),Pr=Qt;return Pr<cr.length&&Zt.push(ht.substring(Pr,cr.length)),Zt}(me,tt);const lt=[],vt={positionedLines:lt,text:me.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:G,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ht,$t,Zt,cr,Pr,Qt,dr,yr,Sr,Ir,nr,qr){let Rn=0,Xr=0,dn=0;const Vr="right"===yr?1:"left"===yr?0:.5;let Fn=!1;for(const ei of Pr){const Oi=ei.getSections();for(const Mo of Oi){if(Mo.imageName)continue;const Io=$t[Mo.fontStack];if(Io&&(Fn=void 0!==Io.ascender&&void 0!==Io.descender,!Fn))break}if(!Fn)break}let Di=0;for(const ei of Pr){ei.trim();const Oi=ei.getMaxScale(),Mo=24*(Oi-1),Io={positionedGlyphs:[],lineOffset:0};ht.positionedLines[Di]=Io;const qo=Io.positionedGlyphs;let us=0;if(!ei.length()){Xr+=Qt,++Di;continue}let ns=0,Xs=0;for(let No=0;No<ei.length();No++){const ya=ei.getSection(No),Es=ei.getSectionIndex(No),ho=ei.getCharCode(No);let Ss=ya.scale,sa=null,Vo=null,$s=null,Ml=24,Na=0;const nl=!(Sr===Xl.horizontal||!nr&&!Q(ho)||nr&&(fp[ho]||(Ti=ho,Mn(Ti)||no(Ti)||ls(Ti)||g(Ti)||E(Ti))));if(ya.imageName){const $a=cr[ya.imageName];if(!$a)continue;$s=ya.imageName,ht.iconsInText=ht.iconsInText||!0,Vo=$a.paddedRect;const il=$a.displaySize;Ss=24*Ss/qr,sa={width:il[0],height:il[1],left:1,top:-3,advance:nl?il[1]:il[0],localGlyph:!1},Na=Fn?-sa.height*Ss:24*Oi-17-il[1]*Ss,Ml=sa.advance;const Xu=(nl?il[0]:il[1])*Ss-24*Oi;Xu>0&&Xu>us&&(us=Xu)}else{const $a=Zt[ya.fontStack];if(!$a)continue;$a[ho]&&(Vo=$a[ho]);const il=$t[ya.fontStack];if(!il)continue;const Xu=il.glyphs[ho];if(!Xu)continue;if(sa=Xu.metrics,Ml=8203!==ho?24:0,Fn){const Tp=void 0!==il.ascender?Math.abs(il.ascender):0,Nh=void 0!==il.descender?Math.abs(il.descender):0,Nf=(Tp+Nh)*Ss;ns<Nf&&(ns=Nf,Xs=(Tp-Nh)/2*Ss),Na=-Tp*Ss}else Na=24*(Oi-Ss)-17}nl?(ht.verticalizable=!0,qo.push({glyph:ho,imageName:$s,x:Rn,y:Xr+Na,vertical:nl,scale:Ss,localGlyph:sa.localGlyph,fontStack:ya.fontStack,sectionIndex:Es,metrics:sa,rect:Vo}),Rn+=Ml*Ss+Ir):(qo.push({glyph:ho,imageName:$s,x:Rn,y:Xr+Na,vertical:nl,scale:Ss,localGlyph:sa.localGlyph,fontStack:ya.fontStack,sectionIndex:Es,metrics:sa,rect:Vo}),Rn+=sa.advance*Ss+Ir)}0!==qo.length&&(dn=Math.max(Rn-Ir,dn),Fn?Ng(qo,Vr,us,Xs,Qt*Oi/2):Ng(qo,Vr,us,0,Qt/2)),Rn=0;const Aa=Qt*Oi+us;Io.lineOffset=Math.max(us,Mo),Xr+=Aa,++Di}var Ti;const vi=Xr,{horizontalAlign:jn,verticalAlign:Ro}=gd(dr);(function(ei,Oi,Mo,Io,qo,us){const ns=(Oi-Mo)*qo,Xs=-us*Io;for(const Aa of ei)for(const No of Aa.positionedGlyphs)No.x+=ns,No.y+=Xs})(ht.positionedLines,Vr,jn,Ro,dn,vi),ht.top+=-Ro*vi,ht.bottom=ht.top+vi,ht.left+=-jn*dn,ht.right=ht.left+dn,ht.hasBaseline=Fn}(vt,e,n,u,Pe,x,T,I,G,L,$,oe),!function(ht){for(const $t of ht)if(0!==$t.positionedGlyphs.length)return!1;return!0}(lt)&&vt}const fp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},kg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function hf(t,e,n,u,p,y){if(e.imageName){const x=u[e.imageName];return x?x.displaySize[0]*e.scale*24/y+p:0}{const x=n[e.fontStack],T=x&&x.glyphs[t];return T?T.metrics.advance*e.scale+p:0}}function pf(t,e,n,u){const p=Math.pow(t-e,2);return u?t<e?p/2:2*p:p+Math.abs(n)*n}function dd(t,e,n){let u=0;return 10===t&&(u-=1e4),n&&(u+=150),40!==t&&65288!==t||(u+=50),41!==e&&65289!==e||(u+=50),u}function Iu(t,e,n,u,p,y){let x=null,T=pf(e,n,p,y);for(const I of u){const L=pf(e-I.x,n,p,y)+I.badness;L<=T&&(x=I,T=L)}return{index:t,x:e,priorBreak:x,badness:T}}function Rg(t){return t?Rg(t.priorBreak).concat(t.index):[]}function gd(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Ng(t,e,n,u,p){if(!(e||n||u||p))return;const y=t.length-1,x=t[y],T=(x.x+x.metrics.advance*x.scale)*e;for(let I=0;I<=y;I++)t[I].x-=T,t[I].y+=n+u+p}function Fg(t,e,n){const{horizontalAlign:u,verticalAlign:p}=gd(n),y=e[0]-t.displaySize[0]*u,x=e[1]-t.displaySize[1]*p;return{image:t,top:x,bottom:x+t.displaySize[1],left:y,right:y+t.displaySize[0]}}function py(t,e,n,u,p,y){const x=t.image;let T;if(x.content){const Pe=x.content,tt=x.pixelRatio||1;T=[Pe[0]/tt,Pe[1]/tt,x.displaySize[0]-Pe[2]/tt,x.displaySize[1]-Pe[3]/tt]}const I=e.left*y,L=e.right*y;let F,G,$,te;"width"===n||"both"===n?(te=p[0]+I-u[3],G=p[0]+L+u[1]):(te=p[0]+(I+L-x.displaySize[0])/2,G=te+x.displaySize[0]);const oe=e.top*y,me=e.bottom*y;return"height"===n||"both"===n?(F=p[1]+oe-u[0],$=p[1]+me+u[2]):(F=p[1]+(oe+me-x.displaySize[1])/2,$=F+x.displaySize[1]),{image:x,top:F,right:G,bottom:$,left:te,collisionPadding:T}}class ic extends X{constructor(e,n,u,p,y){super(e,n),this.angle=p,this.z=u,void 0!==y&&(this.segment=y)}clone(){return new ic(this.x,this.y,this.z,this.angle,this.segment)}}function ff(t,e,n,u,p){if(void 0===e.segment)return!0;let y=e,x=e.segment+1,T=0;for(;T>-n/2;){if(x--,x<0)return!1;T-=t[x].dist(y),y=t[x]}T+=t[x].dist(t[x+1]),x++;const I=[];let L=0;for(;T<n/2;){const F=t[x],G=t[x+1];if(!G)return!1;let $=t[x-1].angleTo(F)-F.angleTo(G);for($=Math.abs(($+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:T,angleDelta:$}),L+=$;T-I[0].distance>u;)L-=I.shift().angleDelta;if(L>p)return!1;x++,T+=F.dist(G)}return!0}function fy(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function dp(t,e,n){return t?.6*e*n:0}function dy(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function n_(t,e,n,u,p,y){const x=dp(n,p,y),T=dy(n,u)*y;let I=0;const L=fy(t)/2;for(let F=0;F<t.length-1;F++){const G=t[F],$=t[F+1],te=G.dist($);if(I+te>L){const oe=(L-I)/te,me=wn(G.x,$.x,oe),Pe=wn(G.y,$.y,oe),tt=new ic(me,Pe,0,$.angleTo(G),F);return!x||ff(t,tt,T,x,e)?tt:void 0}I+=te}}function md(t,e,n,u,p,y,x,T,I){const L=dp(u,y,x),F=dy(u,p),G=F*x,$=0===t[0].x||t[0].x===I||0===t[0].y||t[0].y===I;return e-G<e/4&&(e=G+e/4),oa(t,$?e/2*T%e:(F/2+2*y)*x*T%e,e,L,n,G,$,!1,I)}function oa(t,e,n,u,p,y,x,T,I){const L=y/2,F=fy(t);let G=0,$=e-n,te=[];for(let oe=0;oe<t.length-1;oe++){const me=t[oe],Pe=t[oe+1],tt=me.dist(Pe),ut=Pe.angleTo(me);for(;$+n<G+tt;){$+=n;const Ke=($-G)/tt,lt=wn(me.x,Pe.x,Ke),vt=wn(me.y,Pe.y,Ke);if(lt>=0&&lt<I&&vt>=0&&vt<I&&$-L>=0&&$+L<=F){const ht=new ic(lt,vt,0,ut,oe);ht._round(),u&&!ff(t,ht,y,u,p)||te.push(ht)}}G+=tt}return T||te.length||x||(te=oa(t,G/2,n,u,p,y,x,!0,I)),te}function $l(t,e,n,u,p){const y=[];for(let x=0;x<t.length;x++){const T=t[x];let I;for(let L=0;L<T.length-1;L++){let F=T[L],G=T[L+1];F.x<e&&G.x<e||(F.x<e?F=new X(e,F.y+(e-F.x)/(G.x-F.x)*(G.y-F.y))._round():G.x<e&&(G=new X(e,F.y+(e-F.x)/(G.x-F.x)*(G.y-F.y))._round()),F.y<n&&G.y<n||(F.y<n?F=new X(F.x+(n-F.y)/(G.y-F.y)*(G.x-F.x),n)._round():G.y<n&&(G=new X(F.x+(n-F.y)/(G.y-F.y)*(G.x-F.x),n)._round()),F.x>=u&&G.x>=u||(F.x>=u?F=new X(u,F.y+(u-F.x)/(G.x-F.x)*(G.y-F.y))._round():G.x>=u&&(G=new X(u,F.y+(u-F.x)/(G.x-F.x)*(G.y-F.y))._round()),F.y>=p&&G.y>=p||(F.y>=p?F=new X(F.x+(p-F.y)/(G.y-F.y)*(G.x-F.x),p)._round():G.y>=p&&(G=new X(F.x+(p-F.y)/(G.y-F.y)*(G.x-F.x),p)._round()),I&&F.equals(I[I.length-1])||(I=[F],y.push(I)),I.push(G)))))}}return y}gt(ic,"Anchor");const Ls=1e20;function eu(t,e,n,u,p,y,x,T,I){for(let L=e;L<e+u;L++)Mc(t,n*y+L,y,p,x,T,I);for(let L=n;L<n+p;L++)Mc(t,L*y+e,1,u,x,T,I)}function Mc(t,e,n,u,p,y,x){y[0]=0,x[0]=-Ls,x[1]=Ls,p[0]=t[e];for(let T=1,I=0,L=0;T<u;T++){p[T]=t[e+T*n];const F=T*T;do{const G=y[I];L=(p[T]-p[G]+F-G*G)/(T-G)/2}while(L<=x[I]&&--I>-1);I++,y[I]=T,x[I]=L,x[I+1]=Ls}for(let T=0,I=0;T<u;T++){for(;x[I+1]<T;)I++;const L=y[I],F=T-L;t[e+T*n]=p[L]+F*F}}const df={none:0,ideographs:1,all:2};class Wc{constructor(e,n,u){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=u,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const u=[];for(const p in e)for(const y of e[p])u.push({stack:p,id:y});ke(u,({stack:p,id:y},x)=>{let T=this.entries[p];T||(T=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=T.glyphs[y];if(void 0!==I)return void x(null,{stack:p,id:y,glyph:I});if(I=this._tinySDF(T,p,y),I)return T.glyphs[y]=I,void x(null,{stack:p,id:y,glyph:I});const L=Math.floor(y/256);if(256*L>65535)return void x(new Error("glyphs > 65535 not supported"));if(T.ranges[L])return void x(null,{stack:p,id:y,glyph:I});let F=T.requests[L];F||(F=T.requests[L]=[],Wc.loadGlyphRange(p,L,this.url,this.requestManager,(G,$)=>{if($){T.ascender=$.ascender,T.descender=$.descender;for(const te in $.glyphs)this._doesCharSupportLocalGlyph(+te)||(T.glyphs[+te]=$.glyphs[+te]);T.ranges[L]=!0}for(const te of F)te(G,$);delete T.requests[L]})),F.push((G,$)=>{G?x(G):$&&x(null,{stack:p,id:y,glyph:$.glyphs[y]||null})})},(p,y)=>{if(p)n(p);else if(y){const x={};for(const{stack:T,id:I,glyph:L}of y)void 0===x[T]&&(x[T]={}),void 0===x[T].glyphs&&(x[T].glyphs={}),x[T].glyphs[I]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics},x[T].ascender=this.entries[T].ascender,x[T].descender=this.entries[T].descender;n(null,x)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==df.none&&(this.localGlyphMode===df.all?!!this.localFontFamily:!!this.localFontFamily&&(Fu(e)||Ap(e)||Bc(e)||hh(e)||Su(e)))}_tinySDF(e,n,u){const p=this.localFontFamily;if(!p||!this._doesCharSupportLocalGlyph(u))return;let y=e.tinySDF;if(!y){let me="400";/bold/i.test(n)?me="900":/medium/i.test(n)?me="500":/light/i.test(n)&&(me="200"),y=e.tinySDF=new Wc.TinySDF({fontFamily:p,fontWeight:me,fontSize:48,buffer:6,radius:16}),y.fontWeight=me}if(this.localGlyphs[y.fontWeight][u])return this.localGlyphs[y.fontWeight][u];const x=String.fromCharCode(u),{data:T,width:I,height:L,glyphWidth:F,glyphHeight:G,glyphLeft:$,glyphTop:te,glyphAdvance:oe}=y.draw(x);return this.localGlyphs[y.fontWeight][u]={id:u,bitmap:new vc({width:I,height:L},T),metrics:{width:F/2,height:G/2,left:$/2,top:te/2-27,advance:oe/2,localGlyph:!0}}}}function Hc(t,e,n,u){const p=[],y=t.image,x=y.pixelRatio,T=y.paddedRect.w-2,I=y.paddedRect.h-2,L=t.right-t.left,F=t.bottom-t.top,G=y.stretchX||[[0,T]],$=y.stretchY||[[0,I]],te=(Qt,dr)=>Qt+dr[1]-dr[0],oe=G.reduce(te,0),me=$.reduce(te,0),Pe=T-oe,tt=I-me;let ut=0,Ke=oe,lt=0,vt=me,ht=0,$t=Pe,Zt=0,cr=tt;if(y.content&&u){const Qt=y.content;ut=Ic(G,0,Qt[0]),lt=Ic($,0,Qt[1]),Ke=Ic(G,Qt[0],Qt[2]),vt=Ic($,Qt[1],Qt[3]),ht=Qt[0]-ut,Zt=Qt[1]-lt,$t=Qt[2]-Qt[0]-Ke,cr=Qt[3]-Qt[1]-vt}const Pr=(Qt,dr,yr,Sr)=>{const Ir=_u(Qt.stretch-ut,Ke,L,t.left),nr=vu(Qt.fixed-ht,$t,Qt.stretch,oe),qr=_u(dr.stretch-lt,vt,F,t.top),Rn=vu(dr.fixed-Zt,cr,dr.stretch,me),Xr=_u(yr.stretch-ut,Ke,L,t.left),dn=vu(yr.fixed-ht,$t,yr.stretch,oe),Vr=_u(Sr.stretch-lt,vt,F,t.top),Fn=vu(Sr.fixed-Zt,cr,Sr.stretch,me),Di=new X(Ir,qr),Ti=new X(Xr,qr),vi=new X(Xr,Vr),jn=new X(Ir,Vr),Ro=new X(nr/x,Rn/x),ei=new X(dn/x,Fn/x),Oi=e*Math.PI/180;if(Oi){const qo=Math.sin(Oi),us=Math.cos(Oi),ns=[us,-qo,qo,us];Di._matMult(ns),Ti._matMult(ns),jn._matMult(ns),vi._matMult(ns)}const Mo=Qt.stretch+Qt.fixed,Io=dr.stretch+dr.fixed;return{tl:Di,tr:Ti,bl:jn,br:vi,tex:{x:y.paddedRect.x+1+Mo,y:y.paddedRect.y+1+Io,w:yr.stretch+yr.fixed-Mo,h:Sr.stretch+Sr.fixed-Io},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ro,pixelOffsetBR:ei,minFontScaleX:$t/x/L,minFontScaleY:cr/x/F,isSDF:n}};if(u&&(y.stretchX||y.stretchY)){const Qt=oc(G,Pe,oe),dr=oc($,tt,me);for(let yr=0;yr<Qt.length-1;yr++){const Sr=Qt[yr],Ir=Qt[yr+1];for(let nr=0;nr<dr.length-1;nr++)p.push(Pr(Sr,dr[nr],Ir,dr[nr+1]))}}else p.push(Pr({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:I+1}));return p}function Ic(t,e,n){let u=0;for(const p of t)u+=Math.max(e,Math.min(n,p[1]))-Math.max(e,Math.min(n,p[0]));return u}function oc(t,e,n){const u=[{fixed:-1,stretch:0}];for(const[p,y]of t){const x=u[u.length-1];u.push({fixed:p-x.stretch,stretch:x.stretch}),u.push({fixed:p-x.stretch,stretch:x.stretch+(y-p)})}return u.push({fixed:e+1,stretch:n}),u}function _u(t,e,n,u){return t/e*n+u}function vu(t,e,n,u){return t-e*n/u}function yd(t,e,n,u){const p=e+t.positionedLines[u].lineOffset;return 0===u?n+p/2:n+(p+(e+t.positionedLines[u-1].lineOffset))/2}Wc.loadGlyphRange=function(t,e,n,u,p){const y=256*e,x=y+255,T=u.transformRequest(u.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${y}-${x}`),un.Glyphs);Jn(T,(I,L)=>{if(I)p(I);else if(L){const F={},G=new of(L).readFields(r_,{});for(const $ of G.glyphs)F[$.id]=$;p(null,{glyphs:F,ascender:G.ascender,descender:G.descender})}})},Wc.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:u=.25,fontFamily:p="sans-serif",fontWeight:y="normal",fontStyle:x="normal"}={}){this.buffer=e,this.cutoff=u,this.radius=n;const T=this.size=t+4*e,I=this._createCanvas(T),L=this.ctx=I.getContext("2d",{willReadFrequently:!0});L.font=`${x} ${y} ${t}px ${p}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Uint16Array(T)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:u,actualBoundingBoxLeft:p,actualBoundingBoxRight:y}=this.ctx.measureText(t),x=Math.ceil(n),T=Math.min(this.size-this.buffer,Math.ceil(y-p)),I=Math.min(this.size-this.buffer,x+Math.ceil(u)),L=T+2*this.buffer,F=I+2*this.buffer,G=Math.max(L*F,0),$=new Uint8ClampedArray(G),te={data:$,width:L,height:F,glyphWidth:T,glyphHeight:I,glyphTop:x,glyphLeft:0,glyphAdvance:e};if(0===T||0===I)return te;const{ctx:oe,buffer:me,gridInner:Pe,gridOuter:tt}=this;oe.clearRect(me,me,T,I),oe.fillText(t,me,me+x);const ut=oe.getImageData(me,me,T,I);tt.fill(Ls,0,G),Pe.fill(0,0,G);for(let Ke=0;Ke<I;Ke++)for(let lt=0;lt<T;lt++){const vt=ut.data[4*(Ke*T+lt)+3]/255;if(0===vt)continue;const ht=(Ke+me)*L+lt+me;if(1===vt)tt[ht]=0,Pe[ht]=Ls;else{const $t=.5-vt;tt[ht]=$t>0?$t*$t:0,Pe[ht]=$t<0?$t*$t:0}}eu(tt,0,0,L,F,L,this.f,this.v,this.z),eu(Pe,me,me,T,I,L,this.f,this.v,this.z);for(let Ke=0;Ke<G;Ke++){const lt=Math.sqrt(tt[Ke])-Math.sqrt(Pe[Ke]);$[Ke]=Math.round(255-255*(lt/this.radius+this.cutoff))}return te}};class zg{constructor(e=[],n=Bg){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:u}=this,p=n[e];for(;e>0;){const y=e-1>>1,x=n[y];if(u(p,x)>=0)break;n[e]=x,e=y}n[e]=p}_down(e){const{data:n,compare:u}=this,p=this.length>>1,y=n[e];for(;e<p;){let x=1+(e<<1),T=n[x];const I=x+1;if(I<this.length&&u(n[I],T)<0&&(x=I,T=n[I]),u(T,y)>=0)break;n[e]=T,e=x}n[e]=y}}function Bg(t,e){return t<e?-1:t>e?1:0}function Ug(t,e=1,n=!1){let u=1/0,p=1/0,y=-1/0,x=-1/0;const T=t[0];for(let te=0;te<T.length;te++){const oe=T[te];(!te||oe.x<u)&&(u=oe.x),(!te||oe.y<p)&&(p=oe.y),(!te||oe.x>y)&&(y=oe.x),(!te||oe.y>x)&&(x=oe.y)}const I=Math.min(y-u,x-p);let L=I/2;const F=new zg([],Gg);if(0===I)return new X(u,p);for(let te=u;te<y;te+=I)for(let oe=p;oe<x;oe+=I)F.push(new bh(te+L,oe+L,L,t));let G=function(te){let oe=0,me=0,Pe=0;const tt=te[0];for(let ut=0,Ke=tt.length,lt=Ke-1;ut<Ke;lt=ut++){const vt=tt[ut],ht=tt[lt],$t=vt.x*ht.y-ht.x*vt.y;me+=(vt.x+ht.x)*$t,Pe+=(vt.y+ht.y)*$t,oe+=3*$t}return new bh(me/oe,Pe/oe,0,te)}(t),$=F.length;for(;F.length;){const te=F.pop();(te.d>G.d||!G.d)&&(G=te,n&&console.log("found best %d after %d probes",Math.round(1e4*te.d)/1e4,$)),te.max-G.d<=e||(L=te.h/2,F.push(new bh(te.p.x-L,te.p.y-L,L,t)),F.push(new bh(te.p.x+L,te.p.y-L,L,t)),F.push(new bh(te.p.x-L,te.p.y+L,L,t)),F.push(new bh(te.p.x+L,te.p.y+L,L,t)),$+=4)}return n&&(console.log(`num probes: ${$}`),console.log(`best distance: ${G.d}`)),G.p}function Gg(t,e){return e.max-t.max}function bh(t,e,n,u){this.p=new X(t,e),this.h=n,this.d=function(p,y){let x=!1,T=1/0;for(let I=0;I<y.length;I++){const L=y[I];for(let F=0,G=L.length,$=G-1;F<G;$=F++){const te=L[F],oe=L[$];te.y>p.y!=oe.y>p.y&&p.x<(oe.x-te.x)*(p.y-te.y)/(oe.y-te.y)+te.x&&(x=!x),T=Math.min(T,km(p,te,oe))}}return(x?1:-1)*Math.sqrt(T)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}const _d=Number.POSITIVE_INFINITY,tu=Math.sqrt(2);function jg(t,[e,n]){let u=0,p=0;if(n===_d){e<0&&(e=0);const y=e/tu;switch(t){case"top-right":case"top-left":p=y-7;break;case"bottom-right":case"bottom-left":p=7-y;break;case"bottom":p=7-e;break;case"top":p=e-7}switch(t){case"top-right":case"bottom-right":u=-y;break;case"top-left":case"bottom-left":u=y;break;case"left":u=e;break;case"right":u=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":p=n-7;break;case"bottom-right":case"bottom-left":case"bottom":p=7-n}switch(t){case"top-right":case"bottom-right":case"right":u=-e;break;case"top-left":case"bottom-left":case"left":u=e}}return[u,p]}function qg(t,e,n,u,p,y,x,T,I,L){t.createArrays(),t.tilePixelRatio=Gn/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const F=t.layers[0].layout,G=t.layers[0]._unevaluatedLayout._values,$={};if("composite"===t.textSizeData.kind){const{minZoom:me,maxZoom:Pe}=t.textSizeData;$.compositeTextSizes=[G["text-size"].possiblyEvaluate(new Rt(me),T),G["text-size"].possiblyEvaluate(new Rt(Pe),T)]}if("composite"===t.iconSizeData.kind){const{minZoom:me,maxZoom:Pe}=t.iconSizeData;$.compositeIconSizes=[G["icon-size"].possiblyEvaluate(new Rt(me),T),G["icon-size"].possiblyEvaluate(new Rt(Pe),T)]}$.layoutTextSize=G["text-size"].possiblyEvaluate(new Rt(I+1),T),$.layoutIconSize=G["icon-size"].possiblyEvaluate(new Rt(I+1),T),$.textMaxSize=G["text-size"].possiblyEvaluate(new Rt(18),T);const te="map"===F.get("text-rotation-alignment")&&"point"!==F.get("symbol-placement"),oe=F.get("text-size");for(const me of t.features){const Pe=F.get("text-font").evaluate(me,{},T).join(","),tt=oe.evaluate(me,{},T),ut=$.layoutTextSize.evaluate(me,{},T),Ke=($.layoutIconSize.evaluate(me,{},T),{horizontal:{},vertical:void 0}),lt=me.text;let vt,ht=[0,0];if(lt){const cr=lt.toString(),Pr=24*F.get("text-letter-spacing").evaluate(me,{},T),Qt=24*F.get("text-line-height").evaluate(me,{},T),dr=N(cr)?Pr:0,yr=F.get("text-anchor").evaluate(me,{},T),Sr=F.get("text-variable-anchor");if(!Sr){const Xr=F.get("text-radial-offset").evaluate(me,{},T);ht=Xr?jg(yr,[24*Xr,_d]):F.get("text-offset").evaluate(me,{},T).map(dn=>24*dn)}let Ir=te?"center":F.get("text-justify").evaluate(me,{},T);const nr="point"===F.get("symbol-placement"),qr=nr?24*F.get("text-max-width").evaluate(me,{},T):1/0,Rn=Xr=>{t.allowVerticalPlacement&&O(cr)&&(Ke.vertical=xh(lt,e,n,p,Pe,qr,Qt,yr,Xr,dr,ht,Xl.vertical,!0,ut,tt))};if(!te&&Sr){const Xr="auto"===Ir?Sr.map(Vr=>Vg(Vr)):[Ir];let dn=!1;for(let Vr=0;Vr<Xr.length;Vr++){const Fn=Xr[Vr];if(!Ke.horizontal[Fn])if(dn)Ke.horizontal[Fn]=Ke.horizontal[0];else{const Di=xh(lt,e,n,p,Pe,qr,Qt,"center",Fn,dr,ht,Xl.horizontal,!1,ut,tt);Di&&(Ke.horizontal[Fn]=Di,dn=1===Di.positionedLines.length)}}Rn("left")}else{if("auto"===Ir&&(Ir=Vg(yr)),nr||F.get("text-writing-mode").indexOf("horizontal")>=0||!O(cr)){const Xr=xh(lt,e,n,p,Pe,qr,Qt,yr,Ir,dr,ht,Xl.horizontal,!1,ut,tt);Xr&&(Ke.horizontal[Ir]=Xr)}Rn(nr?"left":Ir)}}let $t=!1;if(me.icon&&me.icon.name){const cr=u[me.icon.name];cr&&(vt=Fg(p[me.icon.name],F.get("icon-offset").evaluate(me,{},T),F.get("icon-anchor").evaluate(me,{},T)),$t=cr.sdf,void 0===t.sdfIcons?t.sdfIcons=cr.sdf:t.sdfIcons!==cr.sdf&&Ar("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(cr.pixelRatio!==t.pixelRatio||0!==F.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const Zt=yp(Ke.horizontal)||Ke.vertical;t.iconsInText||(t.iconsInText=!!Zt&&Zt.iconsInText),(Zt||vt)&&gp(t,me,Ke,vt,u,$,ut,0,ht,$t,x,T,L)}y&&t.generateCollisionDebugBuffers(I,t.collisionBoxArray)}function Vg(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function gp(t,e,n,u,p,y,x,T,I,L,F,G,$){let te=y.textMaxSize.evaluate(e,{},G);void 0===te&&(te=x);const oe=t.layers[0].layout,me=oe.get("icon-offset").evaluate(e,{},G),Pe=yp(n.horizontal)||n.vertical,tt="globe"===$.name,ut=x/24,Ke=t.tilePixelRatio*te/24,lt=(dr=t.overscaling,t.zoom>18&&dr>2&&(dr>>=1),Math.max(Gn/(512*dr),1)*oe.get("symbol-spacing")),vt=oe.get("text-padding")*t.tilePixelRatio,ht=oe.get("icon-padding")*t.tilePixelRatio,$t=se(oe.get("text-max-angle")),Zt="map"===oe.get("text-rotation-alignment")&&"point"!==oe.get("symbol-placement"),cr="map"===oe.get("icon-rotation-alignment")&&"point"!==oe.get("symbol-placement"),Pr=oe.get("symbol-placement"),Qt=lt/2;var dr;const yr=oe.get("icon-text-fit");let Sr;u&&"none"!==yr&&(t.allowVerticalPlacement&&n.vertical&&(Sr=py(u,n.vertical,yr,oe.get("icon-text-fit-padding"),me,ut)),Pe&&(u=py(u,Pe,yr,oe.get("icon-text-fit-padding"),me,ut)));const Ir=(nr,qr,Rn)=>{if(qr.x<0||qr.x>=Gn||qr.y<0||qr.y>=Gn)return;let Xr=null;if(tt){const{x:dn,y:Vr,z:Fn}=$.projectTilePoint(qr.x,qr.y,Rn);Xr={anchor:new ic(dn,Vr,Fn,0,void 0),up:$.upVector(Rn,qr.x,qr.y)}}!function(dn,Vr,Fn,Di,Ti,vi,jn,Ro,ei,Oi,Mo,Io,qo,us,ns,Xs,Aa,No,ya,Es,ho,Ss,sa,Vo,$s){const Ml=dn.addToLineVertexArray(Vr,Di);let Na,nl,$a,il,Xu,Tp,Nh,Nf=0,Rd=0,Ty=0,Nd=0,fm=-1,dm=-1;const ou={};let Fd=Ci.exports("");const kc=Fn?Fn.anchor:Vr;let Ff=0,zd=0;if(void 0===ei._unevaluatedLayout.getValue("text-radial-offset")?[Ff,zd]=ei.layout.get("text-offset").evaluate(ho,{},$s).map(su=>24*su):(Ff=24*ei.layout.get("text-radial-offset").evaluate(ho,{},$s),zd=_d),dn.allowVerticalPlacement&&Ti.vertical){const su=Ti.vertical;if(ns)Tp=wh(su),Ro&&(Nh=wh(Ro));else{const au=ei.layout.get("text-rotate").evaluate(ho,{},$s)+90;$a=Jc(Oi,kc,Vr,Mo,Io,qo,su,us,au,Xs),Ro&&(il=Jc(Oi,kc,Vr,Mo,Io,qo,Ro,No,au))}}if(vi){const su=ei.layout.get("icon-rotate").evaluate(ho,{},$s),au="none"!==ei.layout.get("icon-text-fit"),zf=Hc(vi,su,sa,au),mm=Ro?Hc(Ro,su,sa,au):void 0;nl=Jc(Oi,kc,Vr,Mo,Io,qo,vi,No,su),Nf=4*zf.length;const ym=dn.iconSizeData;let lh=null;"source"===ym.kind?(lh=[tc*ei.layout.get("icon-size").evaluate(ho,{},$s)],lh[0]>Pu&&Ar(`${dn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===ym.kind&&(lh=[tc*Ss.compositeIconSizes[0].evaluate(ho,{},$s),tc*Ss.compositeIconSizes[1].evaluate(ho,{},$s)],(lh[0]>Pu||lh[1]>Pu)&&Ar(`${dn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),dn.addSymbols(dn.icon,zf,lh,Es,ya,ho,!1,Fn,Vr,Ml.lineStartIndex,Ml.lineLength,-1,Vo,$s),fm=dn.icon.placedSymbolArray.length-1,mm&&(Rd=4*mm.length,dn.addSymbols(dn.icon,mm,lh,Es,ya,ho,Xl.vertical,Fn,Vr,Ml.lineStartIndex,Ml.lineLength,-1,Vo,$s),dm=dn.icon.placedSymbolArray.length-1)}for(const su in Ti.horizontal){const au=Ti.horizontal[su];Na||(Fd=Ci.exports(au.text),ns?Xu=wh(au):Na=Jc(Oi,kc,Vr,Mo,Io,qo,au,us,ei.layout.get("text-rotate").evaluate(ho,{},$s),Xs));const zf=1===au.positionedLines.length;if(Ty+=mp(dn,Fn,Vr,au,jn,ei,ns,ho,Xs,Ml,Ti.vertical?Xl.horizontal:Xl.horizontalOnly,zf?Object.keys(Ti.horizontal):[su],ou,fm,Ss,Vo,$s),zf)break}Ti.vertical&&(Nd+=mp(dn,Fn,Vr,Ti.vertical,jn,ei,ns,ho,Xs,Ml,Xl.vertical,["vertical"],ou,dm,Ss,Vo,$s));let ah=-1;const gm=(su,au)=>su?Math.max(su,au):au;ah=gm(Xu,ah),ah=gm(Tp,ah),ah=gm(Nh,ah);const l_=ah>-1?1:0;dn.glyphOffsetArray.length>=Lc.MAX_GLYPHS&&Ar("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ho.sortKey&&dn.addToSortKeyRanges(dn.symbolInstances.length,ho.sortKey),dn.symbolInstances.emplaceBack(kc.x,kc.y,kc.z,Vr.x,Vr.y,ou.right>=0?ou.right:-1,ou.center>=0?ou.center:-1,ou.left>=0?ou.left:-1,ou.vertical>=0?ou.vertical:-1,fm,dm,Fd,void 0!==Na?Na:dn.collisionBoxArray.length,void 0!==Na?Na+1:dn.collisionBoxArray.length,void 0!==$a?$a:dn.collisionBoxArray.length,void 0!==$a?$a+1:dn.collisionBoxArray.length,void 0!==nl?nl:dn.collisionBoxArray.length,void 0!==nl?nl+1:dn.collisionBoxArray.length,il||dn.collisionBoxArray.length,il?il+1:dn.collisionBoxArray.length,Mo,Ty,Nd,Nf,Rd,l_,0,Ff,zd,ah)}(t,qr,Xr,nr,n,u,p,Sr,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,vt,Zt,I,0,ht,cr,me,e,y,L,F,G)};if("line"===Pr)for(const nr of $l(e.geometry,0,0,Gn,Gn)){const qr=md(nr,lt,$t,n.vertical||Pe,u,24,Ke,t.overscaling,Gn);for(const Rn of qr){const Xr=Pe;Xr&&gf(t,Xr.text,Qt,Rn)||Ir(nr,Rn,G)}}else if("line-center"===Pr){for(const nr of e.geometry)if(nr.length>1){const qr=n_(nr,$t,n.vertical||Pe,u,24,Ke);qr&&Ir(nr,qr,G)}}else if("Polygon"===e.type)for(const nr of op(e.geometry,0)){const qr=Ug(nr,16);Ir(nr[0],new ic(qr.x,qr.y,0,0,void 0),G)}else if("LineString"===e.type)for(const nr of e.geometry)Ir(nr,new ic(nr[0].x,nr[0].y,0,0,void 0),G);else if("Point"===e.type)for(const nr of e.geometry)for(const qr of nr)Ir([qr],new ic(qr.x,qr.y,0,0,void 0),G)}const Pu=32640;function mp(t,e,n,u,p,y,x,T,I,L,F,G,$,te,oe,me,Pe){const tt=function(lt,vt,ht,$t,Zt,cr,Pr,Qt){const dr=[];if(0===vt.positionedLines.length)return dr;const yr=$t.layout.get("text-rotate").evaluate(cr,{})*Math.PI/180,Sr=function(Xr){const dn=Xr[0],Vr=Xr[1],Fn=dn*Vr;return Fn>0?[dn,-Vr]:Fn<0?[-dn,Vr]:0===dn?[Vr,dn]:[Vr,-dn]}(ht);let Ir=Math.abs(vt.top-vt.bottom);for(const Xr of vt.positionedLines)Ir-=Xr.lineOffset;const nr=vt.positionedLines.length,qr=Ir/nr;let Rn=vt.top-ht[1];for(let Xr=0;Xr<nr;++Xr){const dn=vt.positionedLines[Xr];Rn=yd(vt,qr,Rn,Xr);for(const Vr of dn.positionedGlyphs){if(!Vr.rect)continue;const Fn=Vr.rect||{};let Di=4,Ti=!0,vi=1,jn=0;if(Vr.imageName){const Vo=Pr[Vr.imageName];if(!Vo)continue;if(Vo.sdf){Ar("SDF images are not supported in formatted text and will be ignored.");continue}Ti=!1,vi=Vo.pixelRatio,Di=1/vi}const Ro=(Zt||Qt)&&Vr.vertical,ei=Vr.metrics.advance*Vr.scale/2,Oi=Vr.metrics,Mo=Vr.rect;if(null===Mo)continue;Qt&&vt.verticalizable&&(jn=Vr.imageName?ei-Vr.metrics.width*Vr.scale/2:0);const Io=Zt?[Vr.x+ei,Vr.y]:[0,0];let qo=[0,0],us=[0,0],ns=!1;Zt||(Ro?(us=[Vr.x+ei+Sr[0],Vr.y+Sr[1]-jn],ns=!0):qo=[Vr.x+ei+ht[0],Vr.y+ht[1]-jn]);const Xs=Mo.w*Vr.scale/(vi*(Vr.localGlyph?2:1)),Aa=Mo.h*Vr.scale/(vi*(Vr.localGlyph?2:1));let No,ya,Es,ho;if(Ro){const Vo=Vr.y-Rn,$s=new X(-ei,ei-Vo),Ml=-Math.PI/2,Na=new X(...us);No=new X(-ei+qo[0],qo[1]),No._rotateAround(Ml,$s)._add(Na),No.x+=-Vo+ei,No.y-=(Oi.left-Di)*Vr.scale;const nl=Vr.imageName?Oi.advance*Vr.scale:24*Vr.scale,$a=String.fromCharCode(Vr.glyph);Lg($a)?No.x+=(1-Di)*Vr.scale:Xa($a)?No.x+=nl-Oi.height*Vr.scale+(-Di-1)*Vr.scale:No.x+=Vr.imageName||Oi.width+2*Di===Mo.w&&Oi.height+2*Di===Mo.h?(nl-Aa)/2:(nl-(Oi.height+2*Di)*Vr.scale)/2,ya=new X(No.x,No.y-Xs),Es=new X(No.x+Aa,No.y),ho=new X(No.x+Aa,No.y-Xs)}else{const Vo=(Oi.left-Di)*Vr.scale-ei+qo[0],$s=(-Oi.top-Di)*Vr.scale+qo[1],Ml=Vo+Xs,Na=$s+Aa;No=new X(Vo,$s),ya=new X(Ml,$s),Es=new X(Vo,Na),ho=new X(Ml,Na)}if(yr){let Vo;Vo=Zt?new X(0,0):ns?new X(Sr[0],Sr[1]):new X(ht[0],ht[1]),No._rotateAround(yr,Vo),ya._rotateAround(yr,Vo),Es._rotateAround(yr,Vo),ho._rotateAround(yr,Vo)}const Ss=new X(0,0),sa=new X(0,0);dr.push({tl:No,tr:ya,bl:Es,br:ho,tex:Fn,writingMode:vt.writingMode,glyphOffset:Io,sectionIndex:Vr.sectionIndex,isSDF:Ti,pixelOffsetTL:Ss,pixelOffsetBR:sa,minFontScaleX:0,minFontScaleY:0})}}return dr}(0,u,I,y,x,T,p,t.allowVerticalPlacement),ut=t.textSizeData;let Ke=null;"source"===ut.kind?(Ke=[tc*y.layout.get("text-size").evaluate(T,{},Pe)],Ke[0]>Pu&&Ar(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ut.kind&&(Ke=[tc*oe.compositeTextSizes[0].evaluate(T,{},Pe),tc*oe.compositeTextSizes[1].evaluate(T,{},Pe)],(Ke[0]>Pu||Ke[1]>Pu)&&Ar(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,tt,Ke,I,x,T,F,e,n,L.lineStartIndex,L.lineLength,te,me,Pe);for(const lt of G)$[lt]=t.text.placedSymbolArray.length-1;return 4*tt.length}function yp(t){for(const e in t)return t[e];return null}function Jc(t,e,n,u,p,y,x,T,I,L){let F=x.top,G=x.bottom,$=x.left,te=x.right;const oe=x.collisionPadding;if(oe&&($-=oe[0],F-=oe[1],te+=oe[2],G+=oe[3]),I){const me=new X($,F),Pe=new X(te,F),tt=new X($,G),ut=new X(te,G),Ke=se(I);let lt=new X(0,0);L&&(lt=new X(L[0],L[1])),me._rotateAround(Ke,lt),Pe._rotateAround(Ke,lt),tt._rotateAround(Ke,lt),ut._rotateAround(Ke,lt),$=Math.min(me.x,Pe.x,tt.x,ut.x),te=Math.max(me.x,Pe.x,tt.x,ut.x),F=Math.min(me.y,Pe.y,tt.y,ut.y),G=Math.max(me.y,Pe.y,tt.y,ut.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,$,F,te,G,T,u,p,y),t.length-1}function wh(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function gf(t,e,n,u){const p=t.compareText;if(e in p){const y=p[e];for(let x=y.length-1;x>=0;x--)if(u.dist(y[x])<n)return!0}else p[e]=[];return p[e].push(u),!1}const mf=Kr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:yf}=mf,_f=Kr([{name:"a_pos_3",components:3,type:"Int16"}]);var Kc=Kr([{name:"a_pos",type:"Int16",components:2}]);const qu=Gn/Math.PI/2,vf=2*tn(1,0)*qu*Math.PI,Ra=[64,32,16],ws=-qu,ma=qu,vd=[new Cl([ws,ws,ws],[ma,ma,ma]),new Cl([ws,ws,ws],[0,0,ma]),new Cl([0,ws,ws],[ma,0,ma]),new Cl([ws,0,ws],[0,ma,ma]),new Cl([0,0,ws],[ma,ma,ma])];function Eh(t,e,n,u=!0){const p=mu([],t._camera.position,t.worldSize),y=[e,n,1,1];Zc(y,y,t.pixelMatrixInverse),rg(y,y,1/y[3]);const x=gl([],Uu([],y,p)),T=t.globeMatrix,I=[T[12],T[13],T[14]],L=Uu([],I,p),F=$h(L),G=gl([],L),$=t.worldSize/(2*Math.PI),te=yu(G,x),oe=Math.asin($/F);if(oe<Math.acos(te)){if(!u)return null;const Pr=[],Qt=[];mu(Pr,x,F/te),gl(Qt,Uu(Qt,Pr,L)),gl(x,ec(x,L,mu(x,Qt,Math.tan(oe)*F)))}const me=[];new Kf(p,x).closestPointOnSphere(I,$,me);const Pe=gl([],Se(T,0)),tt=gl([],Se(T,1)),ut=gl([],Se(T,2)),Ke=yu(Pe,me),lt=yu(tt,me),vt=yu(ut,me),ht=he(Math.asin(-lt/$));let $t=he(Math.atan2(Ke,vt));$t=t.center.lng+function(Pr,Qt){const dr=(Qt-Pr+180)%360-180;return dr<-180?dr+360:dr}(t.center.lng,$t);const Zt=zu($t),cr=Ee(an(ht),0,1);return new Li(Zt,cr)}class Zg{constructor(e,n,u){this.a=Uu([],e,u),this.b=Uu([],n,u),this.center=u;const p=gl([],this.a),y=gl([],this.b);this.angle=Math.acos(yu(p,y))}}function xd(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(u,p,y,x){const T=Math.sin(y);return u*(Math.sin((1-x)*y)/T)+p*(Math.sin(x*y)/T)}(t.a[e],t.b[e],t.angle,Ee(n,0,1))+t.center[e]}function Vu(t){if(t.z<=1)return vd[t.z+2*t.y+t.x];const e=Yg(_p(t));return Cl.fromPoints(e)}function Pc(t,e,n){return mu(t,t,1-n),Yh(t,t,e,n)}function Xg(t,e){const n=bp(e.zoom);if(0===n)return Vu(t);const u=_p(t),p=Yg(u),y=zu(u.getWest())*e.worldSize,x=zu(u.getEast())*e.worldSize,T=an(u.getNorth())*e.worldSize,I=an(u.getSouth())*e.worldSize,L=[y,T,0],F=[x,T,0],G=[y,I,0],$=[x,I,0],te=Gp([],e.globeMatrix);return js(L,L,te),js(F,F,te),js(G,G,te),js($,$,te),p[0]=Pc(p[0],G,n),p[1]=Pc(p[1],$,n),p[2]=Pc(p[2],F,n),p[3]=Pc(p[3],L,n),Cl.fromPoints(p)}function $g(t,e,n){for(const u of t)js(u,u,e),mu(u,u,n)}function _p({x:t,y:e,z:n}){const u=1/(1<<n),p=new so(bn(t*u),ln((e+1)*u)),y=new so(bn((t+1)*u),ln(e*u));return new yc(p,y)}function Yg(t){const e=se(t.getNorth()),n=se(t.getSouth()),u=Math.cos(e),p=Math.cos(n),y=Math.sin(e),x=Math.sin(n),T=t.getWest(),I=t.getEast();return[Ac(p,x,T),Ac(p,x,I),Ac(u,y,I),Ac(u,y,T)]}function Ac(t,e,n,u=qu){return n=se(n),[t*Math.sin(n)*u,-e*u,t*Math.cos(n)*u]}function vp(t,e,n){return Ac(Math.cos(se(t)),Math.sin(se(t)),e,n)}function Sh(t,e,n,u){const p=1<<n.z,y=(t/Gn+n.x)/p;return vp(ln((e/Gn+n.y)/p),bn(y),u)}function xp({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const bd=new Float64Array(16);function xf(t){const e=xp(t),n=Yf(bd,[e,e,e]);return jp(n,n,((u=[])[0]=-(p=t.min)[0],u[1]=-p[1],u[2]=-p[2],u));var u,p}function wd(t){const e=(u=t.min,(n=bd)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=u[0],n[13]=u[1],n[14]=u[2],n[15]=1,n);var n,u;const p=1/xp(t);return Vc(e,e,[p,p,p])}function Ed(t,e,n,u,p){const y=function(I){const L=Gn/(2*Math.PI);return I/(2*Math.PI)/L}(n),x=[t,e,-n/(2*Math.PI)],T=Bu(new Float64Array(16));return jp(T,T,x),Vc(T,T,[y,y,y]),Xh(T,T,se(-p)),qp(T,T,se(-u)),T}function bp(t){return Jt(5,6,t)}function Wg(t,e){const n=vp(e.lat,e.lng);return x=(p=Wf([],function(oe){const me=vp(oe._center.lat,oe._center.lng);let Pe=$p([],gh(0,1,0),me);const tt=Qd([],-oe.angle,me);Pe=js(Pe,Pe,tt),Qd(tt,-oe._pitch,Pe);const ut=gl([],me);return mu(ut,ut,oe.cameraToCenterDistance/oe.pixelsPerMeter*vf),js(ut,ut,tt),ec([],me,ut)}(t),n))[0],T=p[1],I=p[2],L=(y=n)[0],F=y[1],G=y[2],te=($=Math.sqrt(x*x+T*T+I*I)*Math.sqrt(L*L+F*F+G*G))&&yu(p,y)/$,Math.acos(Math.min(Math.max(te,-1),1));var p,y,x,T,I,L,F,G,$,te}function Ch(t,e){return Wg(t,e)>Math.PI/2*1.01}const Hg=se(85),Jg=Math.cos(Hg),Kg=Math.sin(Hg);function Qg(t,e){const n=t.fovAboveCenter,u=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,p=(t._camera.position[2]*t.worldSize-u)/Math.cos(t._pitch),y=Math.sin(n)*p/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),x=Math.sin(t._pitch)*y+p;return Math.min(1.01*x,p*(1/t._horizonShift))}function Qc(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),u=t.x*n,p=(t.x+1)*n,y=t.y*n,x=(t.y+1)*n,T=bn(u),I=bn(p),L=ln(y),F=ln(x),G=e.project(T,L),$=e.project(I,L),te=e.project(I,F),oe=e.project(T,F);let me=Math.min(G.x,$.x,te.x,oe.x),Pe=Math.min(G.y,$.y,te.y,oe.y),tt=Math.max(G.x,$.x,te.x,oe.x),ut=Math.max(G.y,$.y,te.y,oe.y);const Ke=n/16;function lt(ht,$t,Zt,cr,Pr,Qt){const dr=(Zt+Pr)/2,yr=(cr+Qt)/2,Sr=e.project(bn(dr),ln(yr)),Ir=Math.max(0,me-Sr.x,Pe-Sr.y,Sr.x-tt,Sr.y-ut);me=Math.min(me,Sr.x),tt=Math.max(tt,Sr.x),Pe=Math.min(Pe,Sr.y),ut=Math.max(ut,Sr.y),Ir>Ke&&(lt(ht,Sr,Zt,cr,dr,yr),lt(Sr,$t,dr,yr,Pr,Qt))}lt(G,$,u,y,p,y),lt($,te,p,y,p,x),lt(te,oe,p,x,u,x),lt(oe,G,u,x,u,y),me-=Ke,Pe-=Ke,tt+=Ke,ut+=Ke;const vt=1/Math.max(tt-me,ut-Pe);return{scale:vt,x:me*vt,y:Pe*vt,x2:tt*vt,y2:ut*vt,projection:e}}const em=Bu(new Float32Array(16));class eh{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new so(0,0)}projectTilePoint(e,n,u){return{x:e,y:n,z:0}}locationPoint(e,n,u=!0){return e._coordinatePoint(e.locationCoordinate(n),u)}pixelsPerMeter(e,n){return tn(1,e)*n}pixelSpaceConversion(e,n,u){return 1}farthestPixelDistance(e){return Qg(e,e.pixelsPerMeter)}pointCoordinate(e,n,u,p){const y=e.horizonLineFromTop(!1),x=new X(n,Math.max(y,u));return e.rayIntersectionCoordinate(e.pointRayIntersection(x,p))}pointCoordinate3D(e,n,u){const p=new X(n,u);if(e.elevation)return e.elevation.pointCoordinate(p);{const y=this.pointCoordinate(e,p.x,p.y,0);return[y.x,y.y,y.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const u=e.horizonLineFromTop();return n.y<u}createInversionMatrix(e,n){return em}createTileMatrix(e,n,u){let p,y,x;const T=u.canonical,I=Bu(new Float64Array(16));if(this.isReprojectedInTileSpace){const L=Qc(T,this);p=1,y=L.x+u.wrap*L.scale,x=L.y,Vc(I,I,[p/L.scale,p/L.scale,e.pixelsPerMeter/n])}else p=n/e.zoomScale(T.z),y=(T.x+Math.pow(2,T.z)*u.wrap)*p,x=T.y*p;return jp(I,I,[y,x,0]),Vc(I,I,[p/Gn,p/Gn,1]),I}upVector(e,n,u){return[0,0,1]}upVectorScale(e,n,u){return{metersToTile:1}}}class i_ extends eh{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,u]=this.parallels=e.parallels||[29.5,45.5],p=Math.sin(se(n));this.n=(p+Math.sin(se(u)))/2,this.c=1+p*(2*this.n-p),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:u,c:p,r0:y}=this,x=se(e-this.center[0]),T=se(n),I=Math.sqrt(p-2*u*Math.sin(T))/u;return{x:I*Math.sin(x*u),y:I*Math.cos(x*u)-y,z:0}}unproject(e,n){const{n:u,c:p,r0:y}=this,x=y+n;let T=Math.atan2(e,Math.abs(x))*Math.sign(x);x*u<0&&(T-=Math.PI*Math.sign(e)*Math.sign(x));const I=se(this.center[0])*u;T=Nt(T,-Math.PI-I,Math.PI-I);const L=Ee(he(T/u)+this.center[0],-180,180),F=Math.asin(Ee((p-(e*e+x*x)*u*u)/(2*u),-1,1)),G=Ee(he(F),-85.051129,kn);return new so(L,G)}}const bf=1.340264,Th=-.081106,wf=893e-6,Ef=.003796,Mh=Math.sqrt(3)/2;class Sd extends eh{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const u=Math.asin(Mh*Math.sin(n)),p=u*u,y=p*p*p;return{x:.5*(e*Math.cos(u)/(Mh*(bf+3*Th*p+y*(7*wf+9*Ef*p)))/Math.PI+.5),y:1-.5*(u*(bf+Th*p+y*(wf+Ef*p))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let u=n=(2*(1-n)-1)*Math.PI,p=u*u,y=p*p*p;for(let F,G,$,te=0;te<12&&(G=u*(bf+Th*p+y*(wf+Ef*p))-n,$=bf+3*Th*p+y*(7*wf+9*Ef*p),F=G/$,u=Ee(u-F,-Math.PI/3,Math.PI/3),p=u*u,y=p*p*p,!(Math.abs(F)<1e-12));++te);const x=Mh*e*(bf+3*Th*p+y*(7*wf+9*Ef*p))/Math.cos(u),T=Math.asin(Math.sin(u)/Mh),I=Ee(180*x/Math.PI,-180,180),L=Ee(180*T/Math.PI,-85.051129,kn);return new so(I,L)}}class Cd extends eh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const u=360*(e-.5),p=Ee(360*(.5-n),-85.051129,kn);return new so(u,p)}}const wp=Math.PI/2;function Sf(t){return Math.tan((wp+t)/2)}class o_ extends eh{constructor(e){super(e),this.center=e.center||[0,30];const[n,u]=this.parallels=e.parallels||[30,30];let p=se(n),y=se(u);this.southernCenter=p+y<0,this.southernCenter&&(p=-p,y=-y);const x=Math.cos(p),T=Sf(p);this.n=p===y?Math.sin(p):Math.log(x/Math.cos(y))/Math.log(Sf(y)/T),this.f=x*Math.pow(Sf(p),this.n)/this.n}project(e,n){n=se(n),this.southernCenter&&(n=-n),e=se(e-this.center[0]);const u=1e-6,{n:p,f:y}=this;y>0?n<-wp+u&&(n=-wp+u):n>wp-u&&(n=wp-u);const x=y/Math.pow(Sf(n),p);let T=x*Math.sin(p*e),I=y-x*Math.cos(p*e);return T=.5*(T/Math.PI+.5),I=.5*(I/Math.PI+.5),{x:T,y:this.southernCenter?I:1-I,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:u,f:p}=this,y=p-n,x=Math.sign(y),T=Math.sign(u)*Math.sqrt(e*e+y*y);let I=Math.atan2(e,Math.abs(y))*x;y*u<0&&(I-=Math.PI*Math.sign(e)*x);const L=Ee(he(I/u)+this.center[0],-180,180),F=Ee(he(2*Math.atan(Math.pow(p/T,1/u))-wp),-85.051129,kn);return new so(L,this.southernCenter?-F:F)}}class my extends eh{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:zu(e),y:an(n),z:0}}unproject(e,n){const u=bn(e),p=ln(n);return new so(u,p)}}const yy=se(kn);class _y extends eh{project(e,n){const u=(n=se(n))*n,p=u*u;return{x:.5*((e=se(e))*(.8707-.131979*u+p*(p*(.003971*u-.001529*p)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+u*(.015085+p*(.028874*u-.044475-.005916*p)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let u=n=(2*(1-n)-1)*Math.PI,p=25,y=0,x=u*u;do{x=u*u;const L=x*x;y=(u*(1.007226+x*(.015085+L*(.028874*x-.044475-.005916*L)))-n)/(1.007226+x*(.045255+L*(.259866*x-.311325-.005916*11*L))),u=Ee(u-y,-yy,yy)}while(Math.abs(y)>1e-6&&--p>0);x=u*u;const T=Ee(he(e/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),I=he(u);return new so(T,I)}}const Ih=se(kn);class Cf extends eh{project(e,n){n=se(n),e=se(e);const u=Math.cos(n),p=2/Math.PI,y=Math.acos(u*Math.cos(e/2)),x=Math.sin(y)/y,T=.5*(e*p+2*u*Math.sin(e/2)/x)||0,I=.5*(n+Math.sin(n)/x)||0;return{x:.5*(T/Math.PI+.5),y:1-.5*(I/Math.PI+1),z:0}}unproject(e,n){let u=e=(2*e-.5)*Math.PI,p=n=(2*(1-n)-1)*Math.PI,y=25;const x=1e-6;let T=0,I=0;do{const L=Math.cos(p),F=Math.sin(p),G=2*F*L,$=F*F,te=L*L,oe=Math.cos(u/2),me=Math.sin(u/2),Pe=2*oe*me,tt=me*me,ut=1-te*oe*oe,Ke=ut?1/ut:0,lt=ut?Math.acos(L*oe)*Math.sqrt(1/ut):0,vt=.5*(2*lt*L*me+2*u/Math.PI)-e,ht=.5*(lt*F+p)-n,$t=.5*Ke*(te*tt+lt*L*oe*$)+1/Math.PI,Zt=Ke*(Pe*G/4-lt*F*me),cr=.125*Ke*(G*me-lt*F*te*Pe),Pr=.5*Ke*($*oe+lt*tt*L)+.5,Qt=Zt*cr-Pr*$t;T=(ht*Zt-vt*Pr)/Qt,I=(vt*cr-ht*$t)/Qt,u=Ee(u-T,-Math.PI,Math.PI),p=Ee(p-I,-Ih,Ih)}while((Math.abs(T)>x||Math.abs(I)>x)&&--y>0);return new so(he(u),he(p))}}class tm extends eh{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(se(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:u,cosPhi:p}=this;return{x:se(e)*p*u+.5,y:-Math.sin(se(n))/p*u+.5,z:0}}unproject(e,n){const{scale:u,cosPhi:p}=this,y=-(n-.5)/u,x=Ee(he((e-.5)/u)/p,-180,180),T=Math.asin(Ee(y*p,-1,1)),I=Ee(he(T),-85.051129,kn);return new so(x,I)}}class s_ extends my{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(e,n,u){const p=Sh(e,n,u);return js(p,p,xf(Vu(u))),{x:p[0],y:p[1],z:p[2]}}locationPoint(e,n){const u=vp(n.lat,n.lng),p=gl([],u),y=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;Yh(u,u,p,tn(1,0)*Gn*y);const x=Bu(new Float64Array(16));return qc(x,e.pixelMatrix,e.globeMatrix),js(u,u,x),new X(u[0],u[1])}pixelsPerMeter(e,n){return tn(1,0)*n}pixelSpaceConversion(e,n,u){const p=tn(1,e)*n,y=wn(tn(1,45)*n,p,u);return this.pixelsPerMeter(e,n)/y}createTileMatrix(e,n,u){const p=wd(Vu(u.canonical));return qc(new Float64Array(16),e.globeMatrix,p)}createInversionMatrix(e,n){const{center:u}=e,p=xf(Vu(n));return qp(p,p,se(u.lng)),Xh(p,p,se(u.lat)),Vc(p,p,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(p)}pointCoordinate(e,n,u,p){return Eh(e,n,u,!0)||new Li(0,0)}pointCoordinate3D(e,n,u){const p=this.pointCoordinate(e,n,u,0);return[p.x,p.y,p.z]}isPointAboveHorizon(e,n){return!Eh(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(p,y){const x=p.cameraToCenterDistance,T=p._centerAltitude*y,I=p._camera,L=p._camera.forward(),F=ec([],mu([],L,-x),[0,0,T]),G=p.worldSize/(2*Math.PI),$=[0,0,-G],te=p.width/p.height,oe=Math.tan(p.fovAboveCenter),me=mu([],I.up(),oe),Pe=mu([],I.right(),oe*te),tt=gl([],ec([],ec([],L,me),Pe)),ut=[];let Ke;if(new Kf(F,tt).closestPointOnSphere($,G,ut)){const lt=ec([],ut,$),vt=Uu([],lt,F);Ke=Math.cos(p.fovAboveCenter)*$h(vt)}else{const lt=Uu([],F,$),vt=Uu([],$,F);gl(vt,vt);const ht=$h(lt)-G;Ke=Math.sqrt(ht*(ht+2*G));const $t=Math.acos(Ke/(G+ht))-Math.acos(yu(L,vt));Ke*=Math.cos($t)}return 1.01*Ke}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),u=bp(e.zoom);if(u>0){const p=Qg(e,tn(1,e.center.lat)*e.worldSize),y=e.worldSize/(2*Math.PI),x=Math.max(e.width,e.height)/e.worldSize*Math.PI;return wn(n,p+y*(1-Math.cos(x)),Math.pow(u,10))}return n}upVector(e,n,u){return Sh(n,u,e,1)}upVectorScale(e){return{metersToTile:vf*xp(Vu(e))}}}function Tf(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new my(t);case"equirectangular":return new Cd(t);case"naturalEarth":return new _y(t);case"equalEarth":return new Sd(t);case"winkelTripel":return new Cf(t);case"albers":return n?new tm(t):new i_(t);case"lambertConformalConic":return n?new tm(t):new o_(t);case"globe":return new s_(t)}throw new Error(`Invalid projection name: ${t.name}`)}const rm=nd.types,Td=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ph(t,e,n,u,p,y,x,T,I,L,F,G,$){const te=T?Math.min(Pu,Math.round(T[0])):0,oe=T?Math.min(Pu,Math.round(T[1])):0;t.emplaceBack(e,n,Math.round(32*u),Math.round(32*p),y,x,(te<<1)+(I?1:0),oe,16*L,16*F,256*G,256*$)}function th(t,e,n,u,p,y,x){t.emplaceBack(e,n,u,p,y,x)}function rh(t,e,n,u,p){t.emplaceBack(e,n,u,p),t.emplaceBack(e,n,u,p),t.emplaceBack(e,n,u,p),t.emplaceBack(e,n,u,p)}function Ah(t){for(const e of t.sections)if(je(e.text))return!0;return!1}class Md{constructor(e){this.layoutVertexArray=new Oo,this.indexArray=new Yn,this.programConfigurations=e,this.segments=new da,this.dynamicLayoutVertexArray=new El,this.opacityVertexArray=new Us,this.placedSymbolArray=new $i,this.globeExtVertexArray=new Si}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,n,u,p){this.isEmpty()||(u&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,uy.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Td,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Hy.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||p)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}gt(Md,"SymbolBuffers");class Id{constructor(e,n,u){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new u,this.segments=new da,this.collisionVertexArray=new Gs,this.collisionVertexArrayExt=new fi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Jy.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,cy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}gt(Id,"CollisionBuffers");class Lc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(x=>x.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Bu([]),this.placementViewportMatrix=Bu([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Ag(this.zoom,n["text-size"]),this.iconSizeData=Ag(this.zoom,n["icon-size"]);const u=this.layers[0].layout,p=u.get("symbol-sort-key"),y=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==y&&void 0!==p.constantOr(1),this.sortFeaturesByY=("viewport-y"===y||"auto"===y&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(x=>Xl[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Md(new Gc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Md(new Gc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Hi,this.lineVertexArray=new Ji,this.symbolInstances=new Wi}calculateGlyphDependencies(e,n,u,p,y){for(let x=0;x<e.length;x++)if(n[e.charCodeAt(x)]=!0,p&&y){const T=Cc[e.charAt(x)];T&&(n[T.charCodeAt(0)]=!0)}}populate(e,n,u,p){const y=this.layers[0],x=y.layout,T="globe"===this.projection.name,I=x.get("text-font"),L=x.get("text-field"),F=x.get("icon-image"),G=("constant"!==L.value.kind||L.value.value instanceof yn&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&("constant"!==I.value.kind||I.value.value.length>0),$="constant"!==F.value.kind||!!F.value.value||Object.keys(F.parameters).length>0,te=x.get("symbol-sort-key");if(this.features=[],!G&&!$)return;const oe=n.iconDependencies,me=n.glyphDependencies,Pe=n.availableImages,tt=new Rt(this.zoom);for(const{feature:ut,id:Ke,index:lt,sourceLayerIndex:vt}of e){const ht=y._featureFilter.needGeometry,$t=jc(ut,ht);if(!y._featureFilter.filter(tt,$t,u))continue;if(ht||($t.geometry=Qu(ut,u,p)),T&&1!==ut.type&&u.z<=5){const Qt=$t.geometry,dr=.98078528056,yr=(Sr,Ir)=>yu(Sh(Sr.x,Sr.y,u,1),Sh(Ir.x,Ir.y,u,1))<dr;for(let Sr=0;Sr<Qt.length;Sr++)Qt[Sr]=Am(Qt[Sr],yr)}let Zt,cr;if(G){const Qt=y.getValueAndResolveTokens("text-field",$t,u,Pe),dr=yn.factory(Qt);Ah(dr)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===It()||this.hasRTLText&&jt.isParsed())&&(Zt=nf(dr,y,$t))}if($){const Qt=y.getValueAndResolveTokens("icon-image",$t,u,Pe);cr=Qt instanceof ao?Qt:ao.fromString(Qt)}if(!Zt&&!cr)continue;const Pr=this.sortFeaturesByKey?te.evaluate($t,{},u):void 0;if(this.features.push({id:Ke,text:Zt,icon:cr,index:lt,sourceLayerIndex:vt,geometry:$t.geometry,properties:ut.properties,type:rm[ut.type],sortKey:Pr}),cr&&(oe[cr.name]=!0),Zt){const Qt=I.evaluate($t,{},u).join(","),dr="map"===x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Xl.vertical)>=0;for(const yr of Zt.sections)if(yr.image)oe[yr.image.name]=!0;else{const Sr=O(Zt.toString()),Ir=yr.fontStack||Qt,nr=me[Ir]=me[Ir]||{};this.calculateGlyphDependencies(yr.text,nr,dr,this.allowVerticalPlacement,Sr)}}}"line"===x.get("symbol-placement")&&(this.features=function(ut){const Ke={},lt={},vt=[];let ht=0;function $t(Qt){vt.push(ut[Qt]),ht++}function Zt(Qt,dr,yr){const Sr=lt[Qt];return delete lt[Qt],lt[dr]=Sr,vt[Sr].geometry[0].pop(),vt[Sr].geometry[0]=vt[Sr].geometry[0].concat(yr[0]),Sr}function cr(Qt,dr,yr){const Sr=Ke[dr];return delete Ke[dr],Ke[Qt]=Sr,vt[Sr].geometry[0].shift(),vt[Sr].geometry[0]=yr[0].concat(vt[Sr].geometry[0]),Sr}function Pr(Qt,dr,yr){const Sr=yr?dr[0][dr[0].length-1]:dr[0][0];return`${Qt}:${Sr.x}:${Sr.y}`}for(let Qt=0;Qt<ut.length;Qt++){const dr=ut[Qt],yr=dr.geometry,Sr=dr.text?dr.text.toString():null;if(!Sr){$t(Qt);continue}const Ir=Pr(Sr,yr),nr=Pr(Sr,yr,!0);if(Ir in lt&&nr in Ke&&lt[Ir]!==Ke[nr]){const qr=cr(Ir,nr,yr),Rn=Zt(Ir,nr,vt[qr].geometry);delete Ke[Ir],delete lt[nr],lt[Pr(Sr,vt[Rn].geometry,!0)]=Rn,vt[qr].geometry=null}else Ir in lt?Zt(Ir,nr,yr):nr in Ke?cr(Ir,nr,yr):($t(Qt),Ke[Ir]=ht-1,lt[nr]=ht-1)}return vt.filter(Qt=>Qt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ut,Ke)=>ut.sortKey-Ke.sortKey)}update(e,n,u,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,u,p),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,u,p))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Tf(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const u=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:p,y}of n)this.lineVertexArray.emplaceBack(p,y);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(e,n,u,p,y,x,T,I,L,F,G,$,te,oe){const me=e.indexArray,Pe=e.layoutVertexArray,tt=e.globeExtVertexArray,ut=e.segments.prepareSegment(4*n.length,Pe,me,this.canOverlap?x.sortKey:void 0),Ke=this.glyphOffsetArray.length,lt=ut.vertexLength,vt=this.allowVerticalPlacement&&T===Xl.vertical?Math.PI/2:0,ht=x.text&&x.text.sections;for(let Zt=0;Zt<n.length;Zt++){const{tl:cr,tr:Pr,bl:Qt,br:dr,tex:yr,pixelOffsetTL:Sr,pixelOffsetBR:Ir,minFontScaleX:nr,minFontScaleY:qr,glyphOffset:Rn,isSDF:Xr,sectionIndex:dn}=n[Zt],Vr=ut.vertexLength,Fn=Rn[1];if(Ph(Pe,L.x,L.y,cr.x,Fn+cr.y,yr.x,yr.y,u,Xr,Sr.x,Sr.y,nr,qr),Ph(Pe,L.x,L.y,Pr.x,Fn+Pr.y,yr.x+yr.w,yr.y,u,Xr,Ir.x,Sr.y,nr,qr),Ph(Pe,L.x,L.y,Qt.x,Fn+Qt.y,yr.x,yr.y+yr.h,u,Xr,Sr.x,Ir.y,nr,qr),Ph(Pe,L.x,L.y,dr.x,Fn+dr.y,yr.x+yr.w,yr.y+yr.h,u,Xr,Ir.x,Ir.y,nr,qr),I){const{x:Di,y:Ti,z:vi}=I.anchor,[jn,Ro,ei]=I.up;th(tt,Di,Ti,vi,jn,Ro,ei),th(tt,Di,Ti,vi,jn,Ro,ei),th(tt,Di,Ti,vi,jn,Ro,ei),th(tt,Di,Ti,vi,jn,Ro,ei),rh(e.dynamicLayoutVertexArray,Di,Ti,vi,vt)}else rh(e.dynamicLayoutVertexArray,L.x,L.y,L.z,vt);me.emplaceBack(Vr,Vr+1,Vr+2),me.emplaceBack(Vr+1,Vr+2,Vr+3),ut.vertexLength+=4,ut.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Rn[0]),Zt!==n.length-1&&dn===n[Zt+1].sectionIndex||e.programConfigurations.populatePaintArrays(Pe.length,x,x.index,{},te,oe,ht&&ht[dn])}const $t=I?I.anchor:L;e.placedSymbolArray.emplaceBack($t.x,$t.y,$t.z,L.x,L.y,Ke,this.glyphOffsetArray.length-Ke,lt,F,G,L.segment,u?u[0]:0,u?u[1]:0,p[0],p[1],T,0,!1,0,$,0)}_commitLayoutVertex(e,n,u,p,y,x,T){e.emplaceBack(n,u,p,y,x,Math.round(T.x),Math.round(T.y))}_addCollisionDebugVertices(e,n,u,p,y,x,T){const I=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),L=I.vertexLength,F=T.tileAnchorX,G=T.tileAnchorY;for(let te=0;te<4;te++)u.collisionVertexArray.emplaceBack(0,0,0,0);u.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),u.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),u.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),u.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(u.layoutVertexArray,p,y,x,F,G,new X(e.x1,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,y,x,F,G,new X(e.x2,e.y1)),this._commitLayoutVertex(u.layoutVertexArray,p,y,x,F,G,new X(e.x2,e.y2)),this._commitLayoutVertex(u.layoutVertexArray,p,y,x,F,G,new X(e.x1,e.y2)),I.vertexLength+=4;const $=u.indexArray;$.emplaceBack(L,L+1),$.emplaceBack(L+1,L+2),$.emplaceBack(L+2,L+3),$.emplaceBack(L+3,L),I.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,u,p,y,x){for(let T=p;T<y;T++){const I=u.get(T),L=this.getSymbolInstanceTextSize(e,x,n,T);this._addCollisionDebugVertices(I,L,this.textCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(e,n,u,p,y,x){for(let T=p;T<y;T++){const I=u.get(T),L=this.getSymbolInstanceIconSize(e,n,x.placedIconSymbolIndex);this._addCollisionDebugVertices(I,L,this.iconCollisionBox,I.projectedAnchorX,I.projectedAnchorY,I.projectedAnchorZ,x)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Id(Fi,pd.members,ci),this.iconCollisionBox=new Id(Fi,pd.members,ci);const u=cp(this.iconSizeData,e),p=cp(this.textSizeData,e);for(let y=0;y<this.symbolInstances.length;y++){const x=this.symbolInstances.get(y);this._addTextDebugCollisionBoxes(p,e,n,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(p,e,n,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(u,e,n,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(u,e,n,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,n,u,p){const y=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:p),x=fd(this.textSizeData,e,y)/24;return this.tilePixelRatio*x}getSymbolInstanceIconSize(e,n,u){const p=this.icon.placedSymbolArray.get(u),y=fd(this.iconSizeData,e,p);return this.tilePixelRatio*y}_commitDebugCollisionVertexUpdate(e,n,u){e.emplaceBack(n,-u,-u),e.emplaceBack(n,u,-u),e.emplaceBack(n,u,u),e.emplaceBack(n,-u,u)}_updateTextDebugCollisionBoxes(e,n,u,p,y,x){for(let T=p;T<y;T++){const I=u.get(T),L=this.getSymbolInstanceTextSize(e,x,n,T);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,L,I.padding)}}_updateIconDebugCollisionBoxes(e,n,u,p,y,x){for(let T=p;T<y;T++){const I=u.get(T),L=this.getSymbolInstanceIconSize(e,n,x);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,L,I.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=cp(this.iconSizeData,e),p=cp(this.textSizeData,e);for(let y=0;y<this.symbolInstances.length;y++){const x=this.symbolInstances.get(y);this._updateTextDebugCollisionBoxes(p,e,n,x.textBoxStartIndex,x.textBoxEndIndex,x),this._updateTextDebugCollisionBoxes(p,e,n,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._updateIconDebugCollisionBoxes(u,e,n,x.iconBoxStartIndex,x.iconBoxEndIndex,x.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(u,e,n,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,u,p,y,x,T,I,L){const F={};if(n<u){const{x1:G,y1:$,x2:te,y2:oe,padding:me,projectedAnchorX:Pe,projectedAnchorY:tt,projectedAnchorZ:ut,tileAnchorX:Ke,tileAnchorY:lt,featureIndex:vt}=e.get(n);F.textBox={x1:G,y1:$,x2:te,y2:oe,padding:me,projectedAnchorX:Pe,projectedAnchorY:tt,projectedAnchorZ:ut,tileAnchorX:Ke,tileAnchorY:lt},F.textFeatureIndex=vt}if(p<y){const{x1:G,y1:$,x2:te,y2:oe,padding:me,projectedAnchorX:Pe,projectedAnchorY:tt,projectedAnchorZ:ut,tileAnchorX:Ke,tileAnchorY:lt,featureIndex:vt}=e.get(p);F.verticalTextBox={x1:G,y1:$,x2:te,y2:oe,padding:me,projectedAnchorX:Pe,projectedAnchorY:tt,projectedAnchorZ:ut,tileAnchorX:Ke,tileAnchorY:lt},F.verticalTextFeatureIndex=vt}if(x<T){const{x1:G,y1:$,x2:te,y2:oe,padding:me,projectedAnchorX:Pe,projectedAnchorY:tt,projectedAnchorZ:ut,tileAnchorX:Ke,tileAnchorY:lt,featureIndex:vt}=e.get(x);F.iconBox={x1:G,y1:$,x2:te,y2:oe,padding:me,projectedAnchorX:Pe,projectedAnchorY:tt,projectedAnchorZ:ut,tileAnchorX:Ke,tileAnchorY:lt},F.iconFeatureIndex=vt}if(I<L){const{x1:G,y1:$,x2:te,y2:oe,padding:me,projectedAnchorX:Pe,projectedAnchorY:tt,projectedAnchorZ:ut,tileAnchorX:Ke,tileAnchorY:lt,featureIndex:vt}=e.get(I);F.verticalIconBox={x1:G,y1:$,x2:te,y2:oe,padding:me,projectedAnchorX:Pe,projectedAnchorY:tt,projectedAnchorZ:ut,tileAnchorX:Ke,tileAnchorY:lt},F.verticalIconFeatureIndex=vt}return F}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const u=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const u=e.placedSymbolArray.get(n),p=u.vertexStartIndex+4*u.numGlyphs;for(let y=u.vertexStartIndex;y<p;y+=4)e.indexArray.emplaceBack(y,y+1,y+2),e.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),u=Math.cos(e),p=[],y=[],x=[];for(let T=0;T<this.symbolInstances.length;++T){x.push(T);const I=this.symbolInstances.get(T);p.push(0|Math.round(n*I.tileAnchorX+u*I.tileAnchorY)),y.push(I.featureIndex)}return x.sort((T,I)=>p[T]-p[I]||y[I]-y[T]),x}addToSortKeyRanges(e,n){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===n?u.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const u=this.symbolInstances.get(n);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:p,centerJustifiedTextSymbolIndex:y,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:T,placedIconSymbolIndex:I,verticalPlacedIconSymbolIndex:L}=u;p>=0&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&y!==p&&this.addIndicesForPlacedSymbol(this.text,y),x>=0&&x!==y&&x!==p&&this.addIndicesForPlacedSymbol(this.text,x),T>=0&&this.addIndicesForPlacedSymbol(this.text,T),I>=0&&this.addIndicesForPlacedSymbol(this.icon,I),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}gt(Lc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Lc.MAX_GLYPHS=65535,Lc.addDynamicAttributes=rh;const vy=new Ln({"symbol-placement":new zt(ur.layout_symbol["symbol-placement"]),"symbol-spacing":new zt(ur.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new zt(ur.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Kt(ur.layout_symbol["symbol-sort-key"]),"symbol-z-order":new zt(ur.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new zt(ur.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new zt(ur.layout_symbol["icon-ignore-placement"]),"icon-optional":new zt(ur.layout_symbol["icon-optional"]),"icon-rotation-alignment":new zt(ur.layout_symbol["icon-rotation-alignment"]),"icon-size":new Kt(ur.layout_symbol["icon-size"]),"icon-text-fit":new zt(ur.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new zt(ur.layout_symbol["icon-text-fit-padding"]),"icon-image":new Kt(ur.layout_symbol["icon-image"]),"icon-rotate":new Kt(ur.layout_symbol["icon-rotate"]),"icon-padding":new zt(ur.layout_symbol["icon-padding"]),"icon-keep-upright":new zt(ur.layout_symbol["icon-keep-upright"]),"icon-offset":new Kt(ur.layout_symbol["icon-offset"]),"icon-anchor":new Kt(ur.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new zt(ur.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new zt(ur.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new zt(ur.layout_symbol["text-rotation-alignment"]),"text-field":new Kt(ur.layout_symbol["text-field"]),"text-font":new Kt(ur.layout_symbol["text-font"]),"text-size":new Kt(ur.layout_symbol["text-size"]),"text-max-width":new Kt(ur.layout_symbol["text-max-width"]),"text-line-height":new Kt(ur.layout_symbol["text-line-height"]),"text-letter-spacing":new Kt(ur.layout_symbol["text-letter-spacing"]),"text-justify":new Kt(ur.layout_symbol["text-justify"]),"text-radial-offset":new Kt(ur.layout_symbol["text-radial-offset"]),"text-variable-anchor":new zt(ur.layout_symbol["text-variable-anchor"]),"text-anchor":new Kt(ur.layout_symbol["text-anchor"]),"text-max-angle":new zt(ur.layout_symbol["text-max-angle"]),"text-writing-mode":new zt(ur.layout_symbol["text-writing-mode"]),"text-rotate":new Kt(ur.layout_symbol["text-rotate"]),"text-padding":new zt(ur.layout_symbol["text-padding"]),"text-keep-upright":new zt(ur.layout_symbol["text-keep-upright"]),"text-transform":new Kt(ur.layout_symbol["text-transform"]),"text-offset":new Kt(ur.layout_symbol["text-offset"]),"text-allow-overlap":new zt(ur.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new zt(ur.layout_symbol["text-ignore-placement"]),"text-optional":new zt(ur.layout_symbol["text-optional"])});var Pd={paint:new Ln({"icon-opacity":new Kt(ur.paint_symbol["icon-opacity"]),"icon-color":new Kt(ur.paint_symbol["icon-color"]),"icon-halo-color":new Kt(ur.paint_symbol["icon-halo-color"]),"icon-halo-width":new Kt(ur.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Kt(ur.paint_symbol["icon-halo-blur"]),"icon-translate":new zt(ur.paint_symbol["icon-translate"]),"icon-translate-anchor":new zt(ur.paint_symbol["icon-translate-anchor"]),"text-opacity":new Kt(ur.paint_symbol["text-opacity"]),"text-color":new Kt(ur.paint_symbol["text-color"],{runtimeType:Ws,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new Kt(ur.paint_symbol["text-halo-color"]),"text-halo-width":new Kt(ur.paint_symbol["text-halo-width"]),"text-halo-blur":new Kt(ur.paint_symbol["text-halo-blur"]),"text-translate":new zt(ur.paint_symbol["text-translate"]),"text-translate-anchor":new zt(ur.paint_symbol["text-translate-anchor"])}),layout:vy};class Mf{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:oi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}gt(Mf,"FormatSectionOverride",{omit:["defaultValue"]});class If extends Tu{constructor(e){super(e,Pd)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const p=[];for(const y of u)p.indexOf(y)<0&&p.push(y);this.layout._values["text-writing-mode"]=p}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,u,p){const y=this.layout.get(e).evaluate(n,{},u,p),x=this._unevaluatedLayout._values[e];return x.isDataDriven()||Ps(x.value)||!y?y:(T=n.properties,y.replace(/{([^{}]+)}/g,(L,F)=>F in T?String(T[F]):""));var T}createBucket(e){return new Lc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Pd.paint.overridableProperties){if(!If.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),u=new Mf(n),p=new Gl(u,n.property.specification);let y=null;y="constant"===n.value.kind||"source"===n.value.kind?new xo("source",p):new cc("composite",p,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new vr(n.property,y,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,u){return!(!this.layout||n.isDataDriven()||u.isDataDriven())&&If.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const u=e.get("text-field"),p=Pd.paint.properties[n];let y=!1;const x=T=>{for(const I of T)if(p.overrides&&p.overrides.hasOverride(I))return void(y=!0)};if("constant"===u.value.kind&&u.value.value instanceof yn)x(u.value.value.sections);else if("source"===u.value.kind){const T=L=>{y||(L instanceof Zr&&In(L.value)===zl?x(L.value.sections):L instanceof Xo?x(L.sections):L.eachChild(T))},I=u.value;I._styleExpression&&T(I._styleExpression.expression)}return y}getProgramConfiguration(e){return new mc(this,e)}}var Pf={paint:new Ln({"background-color":new zt(ur.paint_background["background-color"]),"background-pattern":new zt(ur.paint_background["background-pattern"]),"background-opacity":new zt(ur.paint_background["background-opacity"])})},nm={paint:new Ln({"raster-opacity":new zt(ur.paint_raster["raster-opacity"]),"raster-hue-rotate":new zt(ur.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new zt(ur.paint_raster["raster-brightness-min"]),"raster-brightness-max":new zt(ur.paint_raster["raster-brightness-max"]),"raster-saturation":new zt(ur.paint_raster["raster-saturation"]),"raster-contrast":new zt(ur.paint_raster["raster-contrast"]),"raster-resampling":new zt(ur.paint_raster["raster-resampling"]),"raster-fade-duration":new zt(ur.paint_raster["raster-fade-duration"])})};class im extends Tu{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Af={paint:new Ln({"sky-type":new zt(ur.paint_sky["sky-type"]),"sky-atmosphere-sun":new zt(ur.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new zt(ur.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new zt(ur.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new zt(ur.paint_sky["sky-gradient-radius"]),"sky-gradient":new fn(ur.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new zt(ur.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new zt(ur.paint_sky["sky-atmosphere-color"]),"sky-opacity":new zt(ur.paint_sky["sky-opacity"])})};function Lf(t,e,n){const u=[0,0,1],p=og([]);return Hf(p,p,n?-se(t)+Math.PI:se(t)),sg(p,p,-se(e)),tg(u,u,p),gl(u,u)}const om={circle:class extends Tu{constructor(t){super(t,Fm)}createBucket(t){return new Zf(t)}queryRadius(t){const e=t;return Vh("circle-radius",this,e)+Vh("circle-stroke-width",this,e)+$f(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,u,p,y,x,T){const I=Bp(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,t.pixelToTileUnitsFactor),L=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Qf(t,u,y,x,T,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),I,L)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new mc(this,t)}},heatmap:class extends Tu{createBucket(t){return new Gm(t)}constructor(t){super(t,zy),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=cg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Vh("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,u,p,y,x,T){const I=this.paint.get("heatmap-radius").evaluate(e,n);return Qf(t,u,y,x,T,!0,!0,new X(0,0),I)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new mc(this,t)}},hillshade:class extends Tu{constructor(t){super(t,By)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Tu{constructor(t){super(t,mg)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new mc(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new sp(t)}queryRadius(){return $f(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,u,p,y){return!t.queryGeometry.isAboveHorizon&&Yd(Zh(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,t.pixelToTileUnitsFactor),u)}isTileClipped(){return!0}},"fill-extrusion":class extends Tu{constructor(t){super(t,$y)}createBucket(t){return new _h(t)}queryRadius(){return $f(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new mc(this,t)}queryIntersectsFeature(t,e,n,u,p,y,x,T,I){const L=Bp(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,t.pixelToTileUnitsFactor),F=this.paint.get("fill-extrusion-height").evaluate(e,n),G=this.paint.get("fill-extrusion-base").evaluate(e,n),$=[0,0],te=T&&y.elevation,oe=y.elevation?y.elevation.exaggeration():1,me=t.tile.getBucket(this);if(te&&me instanceof _h){const lt=me.centroidVertexArray,vt=I+1;vt<lt.length&&($[0]=lt.geta_centroid_pos0(vt),$[1]=lt.geta_centroid_pos1(vt))}if(0===$[0]&&1===$[1])return!1;"globe"===y.projection.name&&(u=Sg([u],[new X(0,0),new X(Gn,Gn)],t.tileID.canonical).map(lt=>lt.polygon).flat());const Pe=te?T:null,[tt,ut]=(vt=u,ht=G,$t=F,Zt=L,cr=x,Pr=Pe,Qt=$,dr=oe,yr=y.center.lat,"globe"===(lt=y).projection.name?function(Ir,nr,qr,Rn,Xr,dn,Vr,Fn,Di,Ti,vi){const jn=[],Ro=[],ei=Ir.projection.upVectorScale(vi,Ir.center.lat,Ir.worldSize).metersToTile,Oi=[0,0,0,1],Mo=[0,0,0,1],Io=(us,ns,Xs,Aa)=>{us[0]=ns,us[1]=Xs,us[2]=Aa,us[3]=1},qo=ny();qr>0&&(qr+=qo),Rn+=qo;for(const us of nr){const ns=[],Xs=[];for(const Aa of us){const No=Aa.x+Xr.x,ya=Aa.y+Xr.y,Es=Ir.projection.projectTilePoint(No,ya,vi),ho=Ir.projection.upVector(vi,Aa.x,Aa.y);let Ss=qr,sa=Rn;if(Vr){const Vo=ld(No,ya,qr,Rn,Vr,Fn,Di,Ti);Ss+=Vo.base,sa+=Vo.top}0!==qr?Io(Oi,Es.x+ho[0]*ei*Ss,Es.y+ho[1]*ei*Ss,Es.z+ho[2]*ei*Ss):Io(Oi,Es.x,Es.y,Es.z),Io(Mo,Es.x+ho[0]*ei*sa,Es.y+ho[1]*ei*sa,Es.z+ho[2]*ei*sa),js(Oi,Oi,dn),js(Mo,Mo,dn),ns.push(new up(Oi[0],Oi[1],Oi[2])),Xs.push(new up(Mo[0],Mo[1],Mo[2]))}jn.push(ns),Ro.push(Xs)}return[jn,Ro]}(lt,vt,ht,$t,Zt,cr,Pr,Qt,dr,yr,t.tileID.canonical):Pr?function(Ir,nr,qr,Rn,Xr,dn,Vr,Fn,Di){const Ti=[],vi=[],jn=[0,0,0,1];for(const Ro of Ir){const ei=[],Oi=[];for(const Mo of Ro){const Io=Mo.x+Rn.x,qo=Mo.y+Rn.y,us=ld(Io,qo,nr,qr,dn,Vr,Fn,Di);jn[0]=Io,jn[1]=qo,jn[2]=us.base,jn[3]=1,Zc(jn,jn,Xr),jn[3]=Math.max(jn[3],1e-5);const ns=new up(jn[0]/jn[3],jn[1]/jn[3],jn[2]/jn[3]);jn[0]=Io,jn[1]=qo,jn[2]=us.top,jn[3]=1,Zc(jn,jn,Xr),jn[3]=Math.max(jn[3],1e-5);const Xs=new up(jn[0]/jn[3],jn[1]/jn[3],jn[2]/jn[3]);ei.push(ns),Oi.push(Xs)}Ti.push(ei),vi.push(Oi)}return[Ti,vi]}(vt,ht,$t,Zt,cr,Pr,Qt,dr,yr):function(Ir,nr,qr,Rn,Xr){const dn=[],Vr=[],Fn=Xr[8]*nr,Di=Xr[9]*nr,Ti=Xr[10]*nr,vi=Xr[11]*nr,jn=Xr[8]*qr,Ro=Xr[9]*qr,ei=Xr[10]*qr,Oi=Xr[11]*qr;for(const Mo of Ir){const Io=[],qo=[];for(const us of Mo){const ns=us.x+Rn.x,Xs=us.y+Rn.y,Aa=Xr[0]*ns+Xr[4]*Xs+Xr[12],No=Xr[1]*ns+Xr[5]*Xs+Xr[13],ya=Xr[2]*ns+Xr[6]*Xs+Xr[14],Es=Xr[3]*ns+Xr[7]*Xs+Xr[15],ho=Aa+Fn,Ss=No+Di,sa=ya+Ti,Vo=Math.max(Es+vi,1e-5),$s=Aa+jn,Ml=No+Ro,Na=ya+ei,nl=Math.max(Es+Oi,1e-5);Io.push(new up(ho/Vo,Ss/Vo,sa/Vo)),qo.push(new up($s/nl,Ml/nl,Na/nl))}dn.push(Io),Vr.push(qo)}return[dn,Vr]}(vt,ht,$t,Zt,cr)),Ke=t.queryGeometry;var lt,vt,ht,$t,Zt,cr,Pr,Qt,dr,yr;return function(lt,vt,ht){let $t=1/0;Yd(ht,vt)&&($t=ad(ht,vt[0]));for(let Zt=0;Zt<vt.length;Zt++){const cr=vt[Zt],Pr=lt[Zt];for(let Qt=0;Qt<cr.length-1;Qt++){const dr=cr[Qt],yr=[dr,cr[Qt+1],Pr[Qt+1],Pr[Qt],dr];$d(ht,yr)&&($t=Math.min($t,ad(ht,yr)))}}return $t!==1/0&&$t}(tt,ut,Ke.isPointQuery()?Ke.screenBounds:Ke.screenGeometry)}},line:class extends Tu{constructor(t){super(t,hd),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof xl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Mg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new cd(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new mc(this,t)}queryRadius(t){const e=t,n=Ig(Vh("line-width",this,e),Vh("line-gap-width",this,e)),u=Vh("line-offset",this,e);return n/2+Math.abs(u)+$f(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,u,p,y){if(t.queryGeometry.isAboveHorizon)return!1;const x=Zh(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,t.pixelToTileUnitsFactor),T=t.pixelToTileUnitsFactor/2*Ig(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),I=this.paint.get("line-offset").evaluate(e,n);return I&&(u=function(L,F){const G=[],$=new X(0,0);for(let te=0;te<L.length;te++){const oe=L[te],me=[];for(let Pe=0;Pe<oe.length;Pe++){const tt=oe[Pe-1],ut=oe[Pe],Ke=oe[Pe+1],lt=0===Pe?$:ut.sub(tt)._unit()._perp(),vt=Pe===oe.length-1?$:Ke.sub(ut)._unit()._perp(),ht=lt._add(vt)._unit();ht._mult(1/(ht.x*vt.x+ht.y*vt.y)),me.push(ht._mult(F)._add(ut))}G.push(me)}return G}(u,I*t.pixelToTileUnitsFactor)),function(L,F,G){for(let $=0;$<F.length;$++){const te=F[$];if(L.length>=3)for(let oe=0;oe<te.length;oe++)if(_c(L,te[oe]))return!0;if(Om(L,te,G))return!0}return!1}(x,u,T)}isTileClipped(){return!0}},symbol:If,background:class extends Tu{constructor(t){super(t,Pf)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Tu{constructor(t){super(t,nm)}getProgramIds(){return["raster"]}},sky:class extends Tu{constructor(t){super(t,Af),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=cg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const u=this.paint.get("sky-atmosphere-sun"),p=!u,y=t.style.light,x=y.properties.get("position");return p&&"viewport"===y.properties.get("anchor")&&Ar("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),p?Lf(x.azimuthal,90-x.polar,e):Lf(u[0],90-u[1],e)}const n=this.paint.get("sky-gradient-center");return Lf(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class Lh{constructor(e,n,u,p){this.context=e,this.format=u,this.texture=e.gl.createTexture(),this.update(n,p)}update(e,n,u){const{width:p,height:y}=e,{context:x}=this,{gl:T}=x,{HTMLImageElement:I,HTMLCanvasElement:L,HTMLVideoElement:F,ImageData:G,ImageBitmap:$}=Z;if(T.bindTexture(T.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!n||!1!==n.premultiply)),u||this.size&&this.size[0]===p&&this.size[1]===y){const{x:te,y:oe}=u||{x:0,y:0};e instanceof I||e instanceof L||e instanceof F||e instanceof G||$&&e instanceof $?T.texSubImage2D(T.TEXTURE_2D,0,te,oe,T.RGBA,T.UNSIGNED_BYTE,e):T.texSubImage2D(T.TEXTURE_2D,0,te,oe,p,y,T.RGBA,T.UNSIGNED_BYTE,e.data)}else this.size=[p,y],e instanceof I||e instanceof L||e instanceof F||e instanceof G||$&&e instanceof $?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,e):T.texImage2D(T.TEXTURE_2D,0,this.format,p,y,0,this.format,T.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&T.generateMipmap(T.TEXTURE_2D)}bind(e,n){const{context:u}=this,{gl:p}=u;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,n),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class xy{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class sm{constructor(){this.tasks={},this.taskQueue=[],Cr(["process"],this),this.invoker=new xy(this.process),this.nextId=0}add(e,n){const u=this.nextId++,p=function({type:y,isSymbolTile:x,zoom:T}){return T=T||0,"message"===y?0:"maybePrepare"!==y||x?"parseTile"!==y||x?"parseTile"===y&&x?300-T:"maybePrepare"===y&&x?400-T:500:200-T:100-T}(n);if(0===p){qn();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[u]={fn:e,metadata:n,priority:p,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){qn();try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let p=0;p<this.taskQueue.length;p++){const y=this.tasks[this.taskQueue[p]];y.priority<n&&(n=y.priority,e=p)}if(null===e)return null;const u=this.taskQueue[e];return this.taskQueue.splice(e,1),u}remove(){this.invoker.remove()}}class by{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const u=e[n];this._stringToNumber[u]=n,this._numberToString[n]=u}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const am=["tile","layer","source","sourceLayer","state"];class Ad{constructor(e,n,u,p,y){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=u,this._y=p,this.properties=e.properties,this.id=y}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of am)void 0!==this[n]&&(e[n]=this[n]);return e}}const nh=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,u=0,p=0,y=0,x=0,T=0;for(1&e?p=y=x=32:n=u=T=32;(e>>=1)>1;){const L=n+p>>1,F=u+y>>1;1&e?(p=n,y=u,n=x,u=T):(n=p,u=y,p=x,y=T),x=L,T=F}const I=4*t;nh[I+0]=n,nh[I+1]=u,nh[I+2]=p,nh[I+3]=y}const bu=new Uint16Array(2178),Zu=new Uint8Array(1089),Ep=new Uint16Array(1089);function Ld(t){return 0===t?-.03125:32===t?.03125:0}var Df=Kr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Of={type:2,extent:Gn,loadGeometry:()=>[[new X(0,0),new X(8193,0),new X(8193,8193),new X(0,8193),new X(0,0)]]};class ac{constructor(e,n,u,p,y){this.tileID=e,this.uid=bt(),this.uses=0,this.tileSize=n,this.tileZoom=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,this.expiredRequestCount=0,this.state="loading",p&&p.transform&&(this.projection=p.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<jr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Qc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,u){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(p,y){const x={};if(!y)return x;for(const T of p){const I=T.layerIds.map(L=>y.getLayer(L)).filter(Boolean);if(0!==I.length){T.layers=I,T.stateDependentLayerIds&&(T.stateDependentLayers=T.stateDependentLayerIds.map(L=>I.filter(F=>F.id===L)[0]));for(const L of I)x[L.id]=T}}return x}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const y=this.buckets[p];if(y instanceof Lc){if(this.hasSymbolBuckets=!0,!u)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const y=this.buckets[p];if(y instanceof Lc&&y.hasRTLText){this.hasRTLText=!0,jt.isLoading()||jt.isLoaded()||"deferred"!==It()||Ht();break}}this.queryPadding=0;for(const p in this.buckets){const y=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(p).queryRadius(y))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Ui}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const u in this.buckets){const p=this.buckets[u];p.uploadPending()&&p.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Lh(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Lh(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Lh(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,u,p,y,x,T,I){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:p,pixelPosMatrix:T,transform:x,params:y,tileTransform:this.tileTransform},e,n,u):{}}querySourceFeatures(e,n){const u=this.latestFeatureIndex;if(!u||!u.rawTileData)return;const p=u.loadVTLayers(),y=n?n.sourceLayer:"",x=p._geojsonTileLayer||p[y];if(!x)return;const T=as(n&&n.filter),{z:I,x:L,y:F}=this.tileID.canonical,G={z:I,x:L,y:F};for(let $=0;$<x.length;$++){const te=x.feature($);if(T.needGeometry){const Pe=jc(te,!0);if(!T.filter(new Rt(this.tileID.overscaledZ),Pe,this.tileID.canonical))continue}else if(!T.filter(new Rt(this.tileID.overscaledZ),te))continue;const oe=u.getId(te,y),me=new Ad(te,I,L,F,oe);me.tile=G,e.push(me)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const u=yi(e.cacheControl);u["max-age"]&&(this.expirationTime=Date.now()+1e3*u["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const u=Date.now();let p=!1;if(this.expirationTime>u)p=!1;else if(n)if(this.expirationTime<n)p=!0;else{const y=this.expirationTime-n;y?this.expirationTime=u+Math.max(y,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!n)return;const u=this.latestFeatureIndex.loadVTLayers(),p=n.style.listImages();for(const y in this.buckets){if(!n.style.hasLayer(y))continue;const x=this.buckets[y],T=x.layers[0].sourceLayer||"_geojsonTileLayer",I=u[T],L=e[T];if(!I||!L||0===Object.keys(L).length)continue;if(x.update(L,I,p,this.imageAtlas&&this.imageAtlas.patternPositions||{}),x instanceof cd||x instanceof sp){const G=n.style._getSourceCache(x.layers[0].source);n._terrain&&n._terrain.enabled&&G&&x.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(G.id,this.tileID)}const F=n&&n.style&&n.style.getLayer(y);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(x)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<jr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=jr.now()+e}setTexture(e,n){const u=n.context,p=u.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Lh(u,e,p.RGBA,{useMipmap:!0}),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),u.extTextureFilterAnisotropic&&p.texParameterf(p.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax))}setDependencies(e,n){const u={};for(const p of n)u[p]=!0;this.dependencies[e]=u}hasDependency(e,n){for(const u of e){const p=this.dependencies[u];if(p)for(const y of n)if(p[y])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const u=Qu(Of,this.tileID.canonical,this.tileTransform)[0],p=new mo,y=new Ai;for(let x=0;x<u.length;x++){const{x:T,y:I}=u[x];p.emplaceBack(T,I),y.emplaceBack(x)}y.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(y),this._tileDebugBuffer=e.createVertexBuffer(p,Kc.members),this._tileDebugSegments=da.simpleSegment(0,0,p.length,y.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const u=Qu(Of,this.tileID.canonical,this.tileTransform)[0];let p,y;if(this.isRaster){const x=function(T,I){const L=Qc(T,I),F=Math.pow(2,T.z);for(let Pe=0;Pe<33;Pe++)for(let tt=0;tt<33;tt++){const ut=bn((T.x+(tt+Ld(tt))/32)/F),Ke=ln((T.y+(Pe+Ld(Pe))/32)/F),lt=I.project(ut,Ke),vt=33*Pe+tt;bu[2*vt+0]=Math.round((lt.x*L.scale-L.x)*Gn),bu[2*vt+1]=Math.round((lt.y*L.scale-L.y)*Gn)}Zu.fill(0),Ep.fill(0);for(let Pe=2045;Pe>=0;Pe--){const tt=4*Pe,ut=nh[tt+0],Ke=nh[tt+1],lt=nh[tt+2],vt=nh[tt+3],ht=ut+lt>>1,$t=Ke+vt>>1,Zt=ht+$t-Ke,cr=$t+ut-ht,Pr=33*Ke+ut,Qt=33*vt+lt,dr=33*$t+ht,yr=Math.hypot((bu[2*Pr+0]+bu[2*Qt+0])/2-bu[2*dr+0],(bu[2*Pr+1]+bu[2*Qt+1])/2-bu[2*dr+1])>=16;if(Zu[dr]=Zu[dr]||(yr?1:0),Pe<1022){const Sr=33*(Ke+cr>>1)+(ut+Zt>>1),Ir=33*(vt+cr>>1)+(lt+Zt>>1);Zu[dr]=Zu[dr]||Zu[Sr]||Zu[Ir]}}const G=new yo,$=new Yn;let te=0;function oe(Pe,tt){const ut=33*tt+Pe;return 0===Ep[ut]&&(G.emplaceBack(bu[2*ut+0],bu[2*ut+1],Pe*Gn/32,tt*Gn/32),Ep[ut]=++te),Ep[ut]-1}function me(Pe,tt,ut,Ke,lt,vt){const ht=Pe+ut>>1,$t=tt+Ke>>1;if(Math.abs(Pe-lt)+Math.abs(tt-vt)>1&&Zu[33*$t+ht])me(lt,vt,Pe,tt,ht,$t),me(ut,Ke,lt,vt,ht,$t);else{const Zt=oe(Pe,tt),cr=oe(ut,Ke),Pr=oe(lt,vt);$.emplaceBack(Zt,cr,Pr)}}return me(0,0,32,32,32,0),me(32,32,0,0,0,32),{vertices:G,indices:$}}(this.tileID.canonical,n);p=x.vertices,y=x.indices}else{p=new yo,y=new Yn;for(const{x:T,y:I}of u)p.emplaceBack(T,I,0,0);const x=Hh.exports(p.int16,void 0,4);for(let T=0;T<x.length;T+=3)y.emplaceBack(x[T],x[T+1],x[T+2])}this._tileBoundsBuffer=e.createVertexBuffer(p,Df.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(y),this._tileBoundsSegments=da.simpleSegment(0,0,p.length,y.length)}_makeGlobeTileDebugBuffers(e,n){const u=n.projection;if(!u||"globe"!==u.name||n.freezeTileCoverage)return;const p=this.tileID.canonical,y=xf(Xg(p,n)),x=bp(n.zoom);let T;x>0&&(T=Gp(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,p,n,y,T,x),this._makeGlobeTileDebugTextBuffer(e,p,n,y,T,x)}_globePoint(e,n,u,p,y,x,T){let I=Sh(e,n,u);if(x){const L=1<<u.z,F=zu(p.center.lng),G=an(p.center.lat),$=(u.x+.5)/L-F;let te=0;$>.5?te=-1:$<-.5&&(te=1);let oe=(e/Gn+u.x)/L+te,me=(n/Gn+u.y)/L;oe=(oe-F)*p._pixelsPerMercatorPixel+F,me=(me-G)*p._pixelsPerMercatorPixel+G;const Pe=[oe*p.worldSize,me*p.worldSize,0];js(Pe,Pe,x),I=Pc(I,Pe,T)}return js(I,I,y)}_makeGlobeTileDebugBorderBuffer(e,n,u,p,y,x){const T=new mo,I=new Ai,L=new Yo,F=($,te,oe,me,Pe)=>{const tt=(oe-$)/(Pe-1),ut=(me-te)/(Pe-1),Ke=T.length;for(let lt=0;lt<Pe;lt++){const vt=$+lt*tt,ht=te+lt*ut;T.emplaceBack(vt,ht);const $t=this._globePoint(vt,ht,n,u,p,y,x);L.emplaceBack($t[0],$t[1],$t[2]),I.emplaceBack(Ke+lt)}},G=Gn;F(0,0,G,0,16),F(G,0,G,G,16),F(G,G,0,G,16),F(0,G,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(I),this._tileDebugBuffer=e.createVertexBuffer(T,Kc.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(L,_f.members),this._tileDebugSegments=da.simpleSegment(0,0,T.length,I.length)}_makeGlobeTileDebugTextBuffer(e,n,u,p,y,x){const T=new mo,I=new Yn,L=new Yo,F=25;I.reserve(32),T.reserve(F),L.reserve(F);const G=($,te)=>F*$+te;for(let $=0;$<F;$++){const te=2048*$;for(let oe=0;oe<F;oe++){const me=2048*oe;T.emplaceBack(me,te);const Pe=this._globePoint(me,te,n,u,p,y,x);L.emplaceBack(Pe[0],Pe[1],Pe[2])}}for(let $=0;$<4;$++)for(let te=0;te<4;te++){const oe=G($,te),me=G($,te+1),Pe=G($+1,te),tt=G($+1,te+1);I.emplaceBack(oe,me,Pe),I.emplaceBack(Pe,me,tt)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(I),this._tileDebugTextBuffer=e.createVertexBuffer(T,Kc.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(L,_f.members),this._tileDebugTextSegments=da.simpleSegment(0,0,F,32)}}class wy{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,u){const p=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][p]=this.stateChanges[e][p]||{},Ae(this.stateChanges[e][p],u),null===this.deletedStates[e]){this.deletedStates[e]={};for(const y in this.state[e])y!==p&&(this.deletedStates[e][y]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][p]){this.deletedStates[e][p]={};for(const y in this.state[e][p])u[y]||(this.deletedStates[e][p][y]=null)}else for(const y in u)this.deletedStates[e]&&this.deletedStates[e][p]&&null===this.deletedStates[e][p][y]&&delete this.deletedStates[e][p][y]}removeFeatureState(e,n,u){if(null===this.deletedStates[e])return;const p=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},u&&void 0!==n)null!==this.deletedStates[e][p]&&(this.deletedStates[e][p]=this.deletedStates[e][p]||{},this.deletedStates[e][p][u]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][p])for(u in this.deletedStates[e][p]={},this.stateChanges[e][p])this.deletedStates[e][p][u]=null;else this.deletedStates[e][p]=null;else this.deletedStates[e]=null}getState(e,n){const u=String(n),p=Ae({},(this.state[e]||{})[u],(this.stateChanges[e]||{})[u]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const y=this.deletedStates[e][n];if(null===y)return{};for(const x in y)delete p[x]}return p}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const u={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const y={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),Ae(this.state[p][x],this.stateChanges[p][x]),y[x]=this.state[p][x];u[p]=y}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const y={};if(null===this.deletedStates[p])for(const x in this.state[p])y[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(null===this.deletedStates[p][x])this.state[p][x]={};else for(const T of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][T];y[x]=this.state[p][x]}u[p]=u[p]||{},Ae(u[p],y)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(u).length)for(const p in e)e[p].setFeatureState(u,n)}}class lm{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const u=this.toIdx(e,n);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Dd(t,e,n,u){let p=0,y=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(u[x])<1e-15){if(n[x]<t[x]||n[x]>e[x])return null}else{const T=1/u[x];let I=(t[x]-n[x])*T,L=(e[x]-n[x])*T;if(I>L){const F=I;I=L,L=F}if(I>p&&(p=I),L<y&&(y=L),p>y)return null}return p}function um(t,e,n,u,p,y,x,T,I,L,F){const G=u-t,$=p-e,te=y-n,oe=x-t,me=T-e,Pe=I-n,tt=F[1]*Pe-F[2]*me,ut=F[2]*oe-F[0]*Pe,Ke=F[0]*me-F[1]*oe,lt=G*tt+$*ut+te*Ke;if(Math.abs(lt)<1e-15)return null;const vt=1/lt,ht=L[0]-t,$t=L[1]-e,Zt=L[2]-n,cr=(ht*tt+$t*ut+Zt*Ke)*vt;if(cr<0||cr>1)return null;const Pr=$t*te-Zt*$,Qt=Zt*G-ht*te,dr=ht*$-$t*G,yr=(F[0]*Pr+F[1]*Qt+F[2]*dr)*vt;return yr<0||cr+yr>1?null:(oe*Pr+me*Qt+Pe*dr)*vt}function Ey(t,e,n){return(t-e)/(n-e)}function ih(t,e,n,u,p,y,x,T,I){const L=1<<n,F=y-u,G=x-p,$=(t+1)/L*F+u,te=(e+0)/L*G+p,oe=(e+1)/L*G+p;T[0]=(t+0)/L*F+u,T[1]=te,I[0]=$,I[1]=oe}class Sp{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(y){const x=Math.ceil(Math.log2(y.dim/8)),T=[];let I=Math.ceil(Math.pow(2,x));const L=1/I,F=(te,oe,me,Pe,tt)=>{const ut=Pe?1:0,Ke=(te+1)*me-ut,lt=oe*me,vt=(oe+1)*me-ut;tt[0]=te*me,tt[1]=lt,tt[2]=Ke,tt[3]=vt};let G=new lm(I);const $=[];for(let te=0;te<I*I;te++){F(te%I,Math.floor(te/I),L,!1,$);const oe=Au($[0],$[1],y),me=Au($[2],$[1],y),Pe=Au($[2],$[3],y),tt=Au($[0],$[3],y);G.minimums.push(Math.min(oe,me,Pe,tt)),G.maximums.push(Math.max(oe,me,Pe,tt)),G.leaves.push(1)}for(T.push(G),I/=2;I>=1;I/=2){const te=T[T.length-1];G=new lm(I);for(let oe=0;oe<I*I;oe++){F(oe%I,Math.floor(oe/I),2,!0,$);const me=te.getElevation($[0],$[1]),Pe=te.getElevation($[2],$[1]),tt=te.getElevation($[2],$[3]),ut=te.getElevation($[0],$[3]),Ke=te.isLeaf($[0],$[1]),lt=te.isLeaf($[2],$[1]),vt=te.isLeaf($[2],$[3]),ht=te.isLeaf($[0],$[3]),$t=Math.min(me.min,Pe.min,tt.min,ut.min),Zt=Math.max(me.max,Pe.max,tt.max,ut.max),cr=Ke&&lt&&vt&&ht;G.maximums.push(Zt),G.minimums.push($t),G.leaves.push(Zt-$t<=5&&cr?1:0)}T.push(G)}return T}(this.dem),u=n.length-1,p=n[u];this._addNode(p.minimums[0],p.maximums[0],p.leaves[0]),this._construct(n,0,0,u,0)}raycastRoot(e,n,u,p,y,x,T=1){return Dd([e,n,-100],[u,p,this.maximums[0]*T],y,x)}raycast(e,n,u,p,y,x,T=1){if(!this.nodeCount)return null;const I=this.raycastRoot(e,n,u,p,y,x,T);if(null==I)return null;const L=[],F=[],G=[],$=[],te=[{idx:0,t:I,nodex:0,nodey:0,depth:0}];for(;te.length>0;){const{idx:oe,t:me,nodex:Pe,nodey:tt,depth:ut}=te.pop();if(this.leaves[oe]){ih(Pe,tt,ut,e,n,u,p,G,$);const lt=1<<ut,vt=(Pe+0)/lt,ht=(Pe+1)/lt,$t=(tt+0)/lt,Zt=(tt+1)/lt,cr=Au(vt,$t,this.dem)*T,Pr=Au(ht,$t,this.dem)*T,Qt=Au(ht,Zt,this.dem)*T,dr=Au(vt,Zt,this.dem)*T,yr=um(G[0],G[1],cr,$[0],G[1],Pr,$[0],$[1],Qt,y,x),Sr=um($[0],$[1],Qt,G[0],$[1],dr,G[0],G[1],cr,y,x),Ir=Math.min(null!==yr?yr:Number.MAX_VALUE,null!==Sr?Sr:Number.MAX_VALUE);if(Ir!==Number.MAX_VALUE)return Ir;{const nr=Yh([],y,x,me);if(Dh(cr,Pr,dr,Qt,Ey(nr[0],G[0],$[0]),Ey(nr[1],G[1],$[1]))>=nr[2])return me}continue}let Ke=0;for(let lt=0;lt<this._siblingOffset.length;lt++){ih((Pe<<1)+this._siblingOffset[lt][0],(tt<<1)+this._siblingOffset[lt][1],ut+1,e,n,u,p,G,$),G[2]=-100,$[2]=this.maximums[this.childOffsets[oe]+lt]*T;const vt=Dd(G,$,y,x);if(null!=vt){const ht=vt;L[lt]=ht;let $t=!1;for(let Zt=0;Zt<Ke&&!$t;Zt++)ht>=L[F[Zt]]&&(F.splice(Zt,0,lt),$t=!0);$t||(F[Ke]=lt),Ke++}}for(let lt=0;lt<Ke;lt++){const vt=F[lt];te.push({idx:this.childOffsets[oe]+vt,t:L[vt],nodex:(Pe<<1)+this._siblingOffset[vt][0],nodey:(tt<<1)+this._siblingOffset[vt][1],depth:ut+1})}}return null}_addNode(e,n,u){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,u,p,y){if(1===e[p].isLeaf(n,u))return;this.childOffsets[y]||(this.childOffsets[y]=this.nodeCount);const x=p-1,T=e[x];let I=0,L=0;for(let F=0;F<this._siblingOffset.length;F++){const G=2*n+this._siblingOffset[F][0],$=2*u+this._siblingOffset[F][1],te=T.getElevation(G,$),oe=T.isLeaf(G,$),me=this._addNode(te.min,te.max,oe);oe&&(I|=1<<F),L||(L=me)}for(let F=0;F<this._siblingOffset.length;F++)I&1<<F||this._construct(e,2*n+this._siblingOffset[F][0],2*u+this._siblingOffset[F][1],x,L+F)}}function Dh(t,e,n,u,p,y){return wn(wn(t,n,y),wn(e,u,y),p)}function Au(t,e,n){const u=n.dim,p=Ee(t*u-.5,0,u-1),y=Ee(e*u-.5,0,u-1),x=Math.floor(p),T=Math.floor(y),I=Math.min(x+1,u-1),L=Math.min(T+1,u-1);return Dh(n.get(x,T),n.get(I,T),n.get(x,L),n.get(I,L),p-x,y-T)}const Sy={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class kf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,u,p=!1,y=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(u&&"mapbox"!==u&&"terrarium"!==u)return Ar(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const x=this.dim=n.height-2,T=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=u||"mapbox",this.borderReady=p,!p){for(let I=0;I<x;I++)T[this._idx(-1,I)]=T[this._idx(0,I)],T[this._idx(x,I)]=T[this._idx(x-1,I)],T[this._idx(I,-1)]=T[this._idx(I,0)],T[this._idx(I,x)]=T[this._idx(I,x-1)];T[this._idx(-1,-1)]=T[this._idx(0,0)],T[this._idx(x,-1)]=T[this._idx(x-1,0)],T[this._idx(-1,x)]=T[this._idx(0,x-1)],T[this._idx(x,x)]=T[this._idx(x-1,x-1)],y&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new Sp(this)}get(e,n,u=!1){u&&(e=Ee(e,-1,this.dim),n=Ee(n,-1,this.dim));const p=4*this._idx(e,n);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}static getUnpackVector(e){return Sy[e]}get unpackVector(){return Sy[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,u){return(256*e*256+256*n+u)/10-1e4}_unpackTerrarium(e,n,u){return 256*e+n+u/256-32768}static pack(e,n){const u=[0,0,0,0],p=kf.getUnpackVector(n);let y=Math.floor((e+p[3])/p[2]);return u[2]=y%256,y=Math.floor(y/256),u[1]=y%256,y=Math.floor(y/256),u[0]=y,u}getPixels(){return new Kl({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,u){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let p=n*this.dim,y=n*this.dim+this.dim,x=u*this.dim,T=u*this.dim+this.dim;switch(n){case-1:p=y-1;break;case 1:y=p+1}switch(u){case-1:x=T-1;break;case 1:T=x+1}const I=-n*this.dim,L=-u*this.dim;for(let F=x;F<T;F++)for(let G=p;G<y;G++){const $=4*this._idx(G,F),te=4*this._idx(G+I,F+L);this.pixels[$+0]=e.pixels[te+0],this.pixels[$+1]=e.pixels[te+1],this.pixels[$+2]=e.pixels[te+2],this.pixels[$+3]=e.pixels[te+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}gt(kf,"DEMData"),gt(Sp,"DemMinMaxQuadTree",{omit:["dem"]});class a_{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,u){const p=e.wrapped().key;void 0===this.data[p]&&(this.data[p]=[]);const y={value:n,timeout:void 0};if(void 0!==u&&(y.timeout=setTimeout(()=>{this.remove(e,y)},u)),this.data[p].push(y),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const u=e.wrapped().key,p=void 0===n?0:this.data[u].indexOf(n),y=this.data[u][p];return this.data[u].splice(p,1),y.timeout&&clearTimeout(y.timeout),0===this.data[u].length&&delete this.data[u],this.onRemove(y.value),this.order.splice(this.order.indexOf(u),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const u in this.data)for(const p of this.data[u])e(p.value)||n.push(p);for(const u of n)this.remove(u.value.tileID,u)}}class Dc{constructor(e,n,u){this.func=e,this.mask=n,this.range=u}}Dc.ReadOnly=!1,Dc.ReadWrite=!0,Dc.disabled=new Dc(519,Dc.ReadOnly,[0,1]);class oh{constructor(e,n,u,p,y,x){this.test=e,this.ref=n,this.mask=u,this.fail=p,this.depthFail=y,this.pass=x}}oh.disabled=new oh({func:519,mask:0},0,0,7680,7680,7680);class ru{constructor(e,n,u){this.blendFunction=e,this.blendColor=n,this.mask=u}}ru.Replace=[1,0],ru.disabled=new ru(ru.Replace,hr.transparent,[!1,!1,!1,!1]),ru.unblended=new ru(ru.Replace,hr.transparent,[!0,!0,!0,!0]),ru.alphaBlended=new ru([1,771],hr.transparent,[!0,!0,!0,!0]);class nu{constructor(e,n,u){this.enable=e,this.mode=n,this.frontFace=u}}nu.disabled=new nu(!1,1029,2305),nu.backCCW=new nu(!0,1029,2305),nu.backCW=new nu(!0,1029,2304),nu.frontCW=new nu(!0,1028,2304),nu.frontCCW=new nu(!0,1028,2305);class lc extends ki{constructor(e,n,u){super(),this.id=e,this._onlySymbols=u,n.on("data",p=>{"source"===p.dataType&&"metadata"===p.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===p.dataType&&"content"===p.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new a_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new wy,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const u=this._tiles[n];u.upload(e),u.prepare(this.map.style.imageManager)}}getIds(){return xt(this._tiles).map(e=>e.tileID).sort(kh).map(e=>e.key)}getRenderableIds(e){const n=[];for(const u in this._tiles)this._isIdRenderable(+u,e)&&n.push(this._tiles[u]);return e?n.sort((u,p)=>{const y=u.tileID,x=p.tileID,T=new X(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),I=new X(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-x.overscaledZ||I.y-T.y||I.x-T.x}).map(u=>u.tileID.key):n.map(u=>u.tileID).sort(kh).map(u=>u.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const u=this._tiles[e];u&&("loading"!==u.state&&(u.state=n),this._loadTile(u,this._tileLoaded.bind(this,u,e,n)))}_tileLoaded(e,n,u,p){if(p)if(e.state="errored",404!==p.status)this._source.fire(new Ts(p,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=jr.now(),"expired"===u&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ho("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let p=0;p<n.length;p++){const y=n[p];if(e.neighboringTiles&&e.neighboringTiles[y]){const x=this.getTileByID(y);u(e,x),u(x,e)}}function u(p,y){if(!p.dem||p.dem.borderReady)return;p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0;let x=y.tileID.canonical.x-p.tileID.canonical.x;const T=y.tileID.canonical.y-p.tileID.canonical.y,I=Math.pow(2,p.tileID.canonical.z),L=y.tileID.key;0===x&&0===T||Math.abs(T)>1||(Math.abs(x)>1&&(1===Math.abs(x+I)?x+=I:1===Math.abs(x-I)&&(x-=I)),y.dem&&p.dem&&(p.dem.backfillBorder(y.dem,x,T),p.neighboringTiles&&p.neighboringTiles[L]&&(p.neighboringTiles[L].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,u,p){for(const y in this._tiles){let x=this._tiles[y];if(p[y]||!x.hasData()||x.tileID.overscaledZ<=n||x.tileID.overscaledZ>u)continue;let T=x.tileID;for(;x&&x.tileID.overscaledZ>n+1;){const L=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[L.key],x&&x.hasData()&&(T=L)}let I=T;for(;I.overscaledZ>n;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]){p[T.key]=T;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const u=this._loadedParentTiles[e.key];return u&&u.tileID.overscaledZ>=n?u:null}for(let u=e.overscaledZ-1;u>=n;u--){const p=e.scaledTo(u),y=this._getLoadedTile(p);if(y)return y}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const u=Math.ceil(e.width/n)+1,p=Math.ceil(e.height/n)+1,y=Math.floor(u*p*5),x="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,y):y,T="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(T)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const u={};for(const p in this._tiles){const y=this._tiles[p];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+n),u[y.tileID.key]=y}this._tiles=u;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(+p,this._tiles[p])}}update(e,n,u){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!u)return;let p;this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(T=>new ml(T.canonical.z,T.wrap,T.canonical.z,T.canonical.x,T.canonical.y)):(p=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!u,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(T=>this._source.hasTile(T)))):p=[];const y=this._updateRetainedTiles(p);if(Od(this._source.type)&&0!==p.length){const T={},I={},L=Object.keys(y);for(const G of L){const $=y[G],te=this._tiles[G];if(!te||te.fadeEndTime&&te.fadeEndTime<=jr.now())continue;const oe=this.findLoadedParent($,Math.max($.overscaledZ-lc.maxOverzooming,this._source.minzoom));oe&&(this._addTile(oe.tileID),T[oe.tileID.key]=oe.tileID),I[G]=$}const F=p[p.length-1].overscaledZ;for(const G in this._tiles){const $=this._tiles[G];if(y[G]||!$.hasData())continue;let te=$.tileID;for(;te.overscaledZ>F;){te=te.scaledTo(te.overscaledZ-1);const oe=this._tiles[te.key];if(oe&&oe.hasData()&&I[te.key]){y[G]=$.tileID;break}}}for(const G in T)y[G]||(this._coveredTiles[G]=!0,y[G]=T[G])}for(const T in y)this._tiles[T].clearFadeHold();const x=function(T,I){const L=[];for(const F in T)F in I||L.push(F);return L}(this._tiles,y);for(const T of x){const I=this._tiles[T];I.hasSymbolBuckets&&!I.holdingForFade()?I.setHoldDuration(this.map._fadeDuration):I.hasSymbolBuckets&&!I.symbolFadeFinished()||this._removeTile(+T)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const u={},p=e.reduce((L,F)=>Math.min(L,F.overscaledZ),1/0),y=e[0].overscaledZ,x=Math.max(y-lc.maxOverzooming,this._source.minzoom),T=Math.max(y+lc.maxUnderzooming,this._source.minzoom),I={};for(const L of e){const F=this._addTile(L);n[L.key]=L,F.hasData()||p<this._source.maxzoom&&(I[L.key]=L)}this._retainLoadedChildren(I,p,T,n);for(const L of e){let F=this._tiles[L.key];if(F.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const $=L.children(this._source.maxzoom)[0],te=this.getTile($);if(te&&te.hasData()){n[$.key]=$;continue}}else{const $=L.children(this._source.maxzoom);if(n[$[0].key]&&n[$[1].key]&&n[$[2].key]&&n[$[3].key])continue}let G=F.wasRequested();for(let $=L.overscaledZ-1;$>=x;--$){const te=L.scaledTo($);if(u[te.key]||(u[te.key]=!0,F=this.getTile(te),!F&&G&&(F=this._addTile(te)),F&&(n[te.key]=te,G=F.wasRequested(),F.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let u,p=this._tiles[e].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){u=this._loadedParentTiles[p.key];break}n.push(p.key);const y=p.scaledTo(p.overscaledZ-1);if(u=this._getLoadedTile(y),u)break;p=y}for(const y of n)this._loadedParentTiles[y]=u}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const u=Boolean(n);if(!u){const p=this.map?this.map.painter:null;n=new ac(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,p,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,u||this._source.fire(new Ho("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const u=n.getExpiryTimeout();u&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},u))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,u){const p=[],y=this.transform;if(!y)return p;const x="globe"===y.projection.name,T=zu(y.center.lng);for(const I in this._tiles){const L=this._tiles[I];if(u&&L.clearQueryDebugViz(),L.holdingForFade())continue;let F;if(x){const G=L.tileID.canonical;if(0===G.z){const $=[Math.abs(Ee(T,...Rh(G,-1))-T),Math.abs(Ee(T,...Rh(G,1))-T)];F=[0,2*$.indexOf(Math.min(...$))-1]}else{const $=[Math.abs(Ee(T,...Rh(G,-1))-T),Math.abs(Ee(T,...Rh(G,0))-T),Math.abs(Ee(T,...Rh(G,1))-T)];F=[$.indexOf(Math.min(...$))-1]}}else F=[0];for(const G of F){const $=e.containsTile(L,y,n,G);$&&p.push($)}}return p}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(u=>this._tiles[u].tileID);for(const u of n)u.projMatrix=this.transform.calculateProjMatrix(u.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Od(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=jr.now())return!0}return!1}setFeatureState(e,n,u){this._state.updateState(e=e||"_geojsonTileLayer",n,u)}removeFeatureState(e,n,u){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,u)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,u){const p=this._tiles[e];p&&p.setDependencies(n,u)}reloadTilesForDependencies(e,n){for(const u in this._tiles)this._tiles[u].hasDependency(e,n)&&this._reloadTile(+u,"reloading");this._cache.filter(u=>!u.hasDependency(e,n))}_preloadTiles(e,n){const u=new Map,p=Array.isArray(e)?e:[e],y=this.map.painter.terrain,x=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const T of p){const I=T.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of I)u.set(L.key,L);this.usedForTerrain&&T.updateElevation(!1)}ke(Array.from(u.values()),(T,I)=>{const L=new ac(T,this._source.tileSize*T.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,F=>{"raster-dem"===this._source.type&&L.dem&&this._backfillDEM(L),I(F,L)})},n)}}function kh(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),u=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||u-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Od(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function Rh(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}lc.maxOverzooming=10,lc.maxUnderzooming=3;class iu{constructor(e,n,u){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=u}static create(e,n,u){const p=u||e.findDEMTileFor(n);if(!p||!p.dem)return;const y=p.dem,x=p.tileID,T=1<<n.canonical.z-x.canonical.z;return new iu(p,p.tileSize/Gn/T,[(n.canonical.x/T-x.canonical.x)*y.dim,(n.canonical.y/T-x.canonical.y)*y.dim])}tileCoordToPixel(e,n){const u=n*this._scale+this._offset[1],p=Math.floor(e*this._scale+this._offset[0]),y=Math.floor(u);return new X(p,y)}getElevationAt(e,n,u,p){const y=e*this._scale+this._offset[0],x=n*this._scale+this._offset[1],T=Math.floor(y),I=Math.floor(x),L=this._dem;return p=!!p,u?wn(wn(L.get(T,I,p),L.get(T,I+1,p),x-I),wn(L.get(T+1,I,p),L.get(T+1,I+1,p),x-I),y-T):L.get(T,I,p)}getElevationAtPixel(e,n,u){return this._dem.get(e,n,!!u)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*tn(1,e)*this._dem.stride}}class Lu{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new de(Gn,16,0),this.featureIndexArray=new Qi,this.promoteId=n}insert(e,n,u,p,y,x=0){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,p,y,x);const I=this.grid;for(let L=0;L<n.length;L++){const F=n[L],G=[1/0,1/0,-1/0,-1/0];for(let $=0;$<F.length;$++){const te=F[$];G[0]=Math.min(G[0],te.x),G[1]=Math.min(G[1],te.y),G[2]=Math.max(G[2],te.x),G[3]=Math.max(G[3],te.y)}G[0]<Gn&&G[1]<Gn&&G[2]>=0&&G[3]>=0&&I.insert(T,G[0],G[1],G[2],G[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new wg(new of(this.rawTileData)).layers,this.sourceLayerCoder=new by(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,u,p){this.loadVTLayers();const y=e.params||{},x=as(y.filter),T=e.tileResult,I=e.transform,L=T.bufferedTilespaceBounds,F=this.grid.query(L.min.x,L.min.y,L.max.x,L.max.y,(oe,me,Pe,tt)=>Hd(T.bufferedTilespaceGeometry,oe,me,Pe,tt));F.sort(sh);let G=null;I.elevation&&F.length>0&&(G=iu.create(I.elevation,this.tileID));const $={};let te;for(let oe=0;oe<F.length;oe++){const me=F[oe];if(me===te)continue;te=me;const Pe=this.featureIndexArray.get(me);let tt=null;this.loadMatchingFeature($,Pe,x,y.layers,y.availableImages,n,u,p,(ut,Ke,lt,vt=0)=>(tt||(tt=Qu(ut,this.tileID.canonical,e.tileTransform)),Ke.queryIntersectsFeature(T,ut,lt,tt,this.z,e.transform,e.pixelPosMatrix,G,vt)))}return $}loadMatchingFeature(e,n,u,p,y,x,T,I,L){const{featureIndex:F,bucketIndex:G,sourceLayerIndex:$,layoutVertexArrayOffset:te}=n,oe=this.bucketLayerIDs[G];if(p&&!function(ut,Ke){for(let lt=0;lt<ut.length;lt++)if(Ke.indexOf(ut[lt])>=0)return!0;return!1}(p,oe))return;const me=this.sourceLayerCoder.decode($),Pe=this.vtLayers[me].feature(F);if(u.needGeometry){const ut=jc(Pe,!0);if(!u.filter(new Rt(this.tileID.overscaledZ),ut,this.tileID.canonical))return}else if(!u.filter(new Rt(this.tileID.overscaledZ),Pe))return;const tt=this.getId(Pe,me);for(let ut=0;ut<oe.length;ut++){const Ke=oe[ut];if(p&&p.indexOf(Ke)<0)continue;const lt=x[Ke];if(!lt)continue;let vt={};void 0!==tt&&I&&(vt=I.getState(lt.sourceLayer||"_geojsonTileLayer",tt));const ht=Ae({},T[Ke]);ht.paint=Du(ht.paint,lt.paint,Pe,vt,y),ht.layout=Du(ht.layout,lt.layout,Pe,vt,y);const $t=!L||L(Pe,lt,vt,te);if(!$t)continue;const Zt=new Ad(Pe,this.z,this.x,this.y,tt);Zt.layer=ht;let cr=e[Ke];void 0===cr&&(cr=e[Ke]=[]),cr.push({featureIndex:F,feature:Zt,intersectionZ:$t})}}lookupSymbolFeatures(e,n,u,p,y,x,T,I){const L={};this.loadVTLayers();const F=as(y);for(const G of e)this.loadMatchingFeature(L,{bucketIndex:u,sourceLayerIndex:p,featureIndex:G,layoutVertexArrayOffset:0},F,x,T,I,n);return L}loadFeature(e){const{featureIndex:n,sourceLayerIndex:u}=e;this.loadVTLayers();const p=this.sourceLayerCoder.decode(u),y=this.vtFeatures[p];if(y[n])return y[n];const x=this.vtLayers[p].feature(n);return y[n]=x,x}hasLayer(e){for(const n of this.bucketLayerIDs)for(const u of n)if(e===u)return!0;return!1}getId(e,n){let u=e.id;if(this.promoteId){const p="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=p&&(u=e.properties[p]),"boolean"==typeof u&&(u=Number(u))}return u}}function Du(t,e,n,u,p){return Ur(t,(y,x)=>{const T=e instanceof Or?e.get(x):null;return T&&T.evaluate?T.evaluate(n,u,p):T})}function sh(t,e){return e-t}gt(Lu,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class kd{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new vc({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const u=this.getKey(e,n);return this.positions[u]}trim(){const e=this.width,n=this.height=Wt(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,u){const p=[];let y=e.length%2==1?-e[e.length-1]*u:0,x=e[0]*u,T=!0;p.push({left:y,right:x,isDash:T,zeroLength:0===e[0]});let I=e[0];for(let L=1;L<e.length;L++){T=!T;const F=e[L];y=I*u,I+=F,x=I*u,p.push({left:y,right:x,isDash:T,zeroLength:0===F})}return p}addRoundDash(e,n,u){const p=n/2;for(let y=-u;y<=u;y++){const x=this.width*(this.nextRow+u+y);let T=0,I=e[T];for(let L=0;L<this.width;L++){L/I.right>1&&(I=e[++T]);const F=Math.abs(L-I.left),G=Math.abs(L-I.right),$=Math.min(F,G);let te;const oe=y/u*(p+1);if(I.isDash){const me=p-Math.abs(oe);te=Math.sqrt($*$+me*me)}else te=p-Math.sqrt($*$+oe*oe);this.image.data[x+L]=Math.max(0,Math.min(255,te+128))}}}addRegularDash(e,n){for(let I=e.length-1;I>=0;--I){const L=e[I],F=e[I+1];L.zeroLength?e.splice(I,1):F&&F.isDash===L.isDash&&(F.left=L.left,e.splice(I,1))}const u=e[0],p=e[e.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const y=this.width*this.nextRow;let x=0,T=e[x];for(let I=0;I<this.width;I++){I/T.right>1&&(T=e[++x]);const L=Math.abs(I-T.left),F=Math.abs(I-T.right),G=Math.min(L,F);this.image.data[y+I]=Math.max(0,Math.min(255,(T.isDash?G:-G)+n+128))}}addDash(e,n){const u=this.getKey(e,n);if(this.positions[u])return this.positions[u];const p="round"===n,y=p?7:0,x=2*y+1;if(this.nextRow+x>this.height)return Ar("LineAtlas out of space"),null;0===e.length&&e.push(1);let T=0;for(let F=0;F<e.length;F++)e[F]<0&&(Ar("Negative value is found in line dasharray, replacing values with 0"),e[F]=0),T+=e[F];if(0!==T){const F=this.width/T,G=this.getDashRanges(e,this.width,F);p?this.addRoundDash(G,F,y):this.addRegularDash(G,"square"===n?.5*F:0)}const I=this.nextRow+y;this.nextRow+=x;const L={tl:[I,y],br:[T,0]};return this.positions[u]=L,L}}gt(kd,"LineAtlas");class cm{constructor(e){const n={},u=[];for(const T in e){const I=e[T],L=n[T]={};for(const F in I.glyphs){const G=I.glyphs[+F];if(!G||0===G.bitmap.width||0===G.bitmap.height)continue;const $=G.metrics.localGlyph?2:1,te={x:0,y:0,w:G.bitmap.width+2*$,h:G.bitmap.height+2*$};u.push(te),L[F]=te}}const{w:p,h:y}=lf(u),x=new vc({width:p||1,height:y||1});for(const T in e){const I=e[T];for(const L in I.glyphs){const F=I.glyphs[+L];if(!F||0===F.bitmap.width||0===F.bitmap.height)continue;const G=n[T][L],$=F.metrics.localGlyph?2:1;vc.copy(F.bitmap,x,{x:0,y:0},{x:G.x+$,y:G.y+$},F.bitmap)}}this.image=x,this.positions=n}}gt(cm,"GlyphAtlas");class Cy{constructor(e){this.tileID=new ml(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Qc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,u,p,y){this.status="parsing",this.data=e,this.collisionBoxArray=new Ui;const x=new by(Object.keys(e.layers).sort()),T=new Lu(this.tileID,this.promoteId);T.bucketLayerIDs=[];const I={},L=new kd(256,256),F={featureIndex:T,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:L,availableImages:u},G=n.familiesBySource[this.source];for(const vt in G){const ht=e.layers[vt];if(!ht)continue;let $t=!1,Zt=!1;for(const Qt of G[vt])"symbol"===Qt[0].type?$t=!0:Zt=!0;if(!0===this.isSymbolTile&&!$t||!1===this.isSymbolTile&&!Zt)continue;1===ht.version&&Ar(`Vector tile source "${this.source}" layer "${vt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const cr=x.encode(vt),Pr=[];for(let Qt=0;Qt<ht.length;Qt++){const dr=ht.feature(Qt),yr=T.getId(dr,vt);Pr.push({feature:dr,id:yr,index:Qt,sourceLayerIndex:cr})}for(const Qt of G[vt]){const dr=Qt[0];void 0!==this.isSymbolTile&&"symbol"===dr.type!==this.isSymbolTile||dr.minzoom&&this.zoom<Math.floor(dr.minzoom)||dr.maxzoom&&this.zoom>=dr.maxzoom||"none"!==dr.visibility&&(Rf(Qt,this.zoom,u),(I[dr.id]=dr.createBucket({index:T.bucketLayerIDs.length,layers:Qt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:cr,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:u})).populate(Pr,F,this.tileID.canonical,this.tileTransform),T.bucketLayerIDs.push(Qt.map(yr=>yr.id)))}}let $,te,oe,me;L.trim();const Pe={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},tt=Ur(F.glyphDependencies,vt=>Object.keys(vt).map(Number));Object.keys(tt).length?p.send("getGlyphs",{uid:this.uid,stacks:tt},(vt,ht)=>{$||($=vt,te=ht,lt.call(this))},void 0,!1,Pe):te={};const ut=Object.keys(F.iconDependencies);ut.length?p.send("getImages",{icons:ut,source:this.source,tileID:this.tileID,type:"icons"},(vt,ht)=>{$||($=vt,oe=ht,lt.call(this))},void 0,!1,Pe):oe={};const Ke=Object.keys(F.patternDependencies);function lt(){if($)return y($);if(te&&oe&&me){const vt=new cm(te),ht=new cf(oe,me);for(const $t in I){const Zt=I[$t];Zt instanceof Lc?(Rf(Zt.layers,this.zoom,u),qg(Zt,te,vt.positions,oe,ht.iconPositions,this.showCollisionBoxes,u,this.tileID.canonical,this.tileZoom,this.projection)):Zt.hasPattern&&(Zt instanceof cd||Zt instanceof sp||Zt instanceof _h)&&(Rf(Zt.layers,this.zoom,u),Zt.addFeatures(F,this.tileID.canonical,ht.patternPositions,u,this.tileTransform))}this.status="done",y(null,{buckets:xt(I).filter($t=>!$t.isEmpty()),featureIndex:T,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:vt.image,lineAtlas:L,imageAtlas:ht,glyphMap:this.returnDependencies?te:null,iconMap:this.returnDependencies?oe:null,glyphPositions:this.returnDependencies?vt.positions:null})}}Ke.length?p.send("getImages",{icons:Ke,source:this.source,tileID:this.tileID,type:"patterns"},(vt,ht)=>{$||($=vt,me=ht,lt.call(this))},void 0,!1,Pe):me={},lt.call(this)}}function Rf(t,e,n){const u=new Rt(e);for(const p of t)p.recalculate(u,n)}class hm{constructor(e){this.entries={},this.scheduler=e}request(e,n,u,p){const y=this.entries[e]=this.entries[e]||{callbacks:[]};if(y.result){const[x,T]=y.result;return this.scheduler?this.scheduler.add(()=>{p(x,T)},n):p(x,T),()=>{}}return y.callbacks.push(p),y.cancel||(y.cancel=u((x,T)=>{y.result=[x,T];for(const I of y.callbacks)this.scheduler?this.scheduler.add(()=>{I(x,T)},n):I(x,T);setTimeout(()=>delete this.entries[e],3e3)})),()=>{y.result||(y.callbacks=y.callbacks.filter(x=>x!==p),y.callbacks.length||(y.cancel(),delete this.entries[e]))}}}function pm(t,e,n){const u=JSON.stringify(t.request);return t.data&&(this.deduped.entries[u]={result:[null,t.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},p=>{const y=Jn(t.request,(x,T,I,L)=>{x?p(x):T&&p(null,{vectorTile:n?void 0:new wg(new of(T)),rawData:T,cacheControl:I,expires:L})});return()=>{y.cancel(),p()}},e)}c.ARRAY_TYPE=Zl,c.AUTH_ERR_MSG=is,c.Aabb=Cl,c.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},Cr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=qn()?t:Z,this.scheduler=new sm}send(t,e,n,u,p=!1,y){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=y,this.callbacks[x]=n);const T=lr(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:t,hasCallback:!!n,targetMapId:u,mustQueue:p,sourceMapId:this.mapId,data:Br(e,T)},T),{cancel:()=>{n&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const u=this.cancelCallbacks[n];delete this.cancelCallbacks[n],u&&u.cancel()}else if(e.mustQueue||qn()){const u=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),u&&u.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(sn(e.error)):n(null,sn(e.data)))}else{const n=lr(this.globalScope)?void 0:[],u=e.hasCallback?(y,x)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:y?Br(y):null,data:Br(x,n)},n)}:y=>{},p=sn(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,p,u);else if(this.parent.getWorkerSource){const y=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,y[0],p.source)[y[1]](p,u)}else u(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.CanonicalTileID=sd,c.Color=hr,c.ColorMode=ru,c.CullFaceMode=nu,c.DEMData=kf,c.DataConstantProperty=zt,c.DedupedRequest=hm,c.DepthMode=Dc,c.EXTENT=Gn,c.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,u=1<<n,p=Math.floor(t.x),y=Math.floor((t.x-p)*u),x=Math.floor(t.y*u),T=this.findDEMTileFor(new ml(n,p,n,y,x));return!(!T||!T.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const u=this._source();if(!u||t.y<0||t.y>1)return e;const p=u.getSource().maxzoom,y=1<<p,x=Math.floor(t.x),T=t.x-x,I=new ml(p,x,p,Math.floor(T*y),Math.floor(t.y*y)),L=this.findDEMTileFor(I);if(!L||!L.dem)return e;const F=L.dem,G=1<<L.tileID.canonical.z,$=(T*G-L.tileID.canonical.x)*F.dim,te=(t.y*G-L.tileID.canonical.y)*F.dim,oe=Math.floor($),me=Math.floor(te);return(n?this.exaggeration():1)*wn(wn(F.get(oe,me),F.get(oe,me+1),te-me),wn(F.get(oe+1,me),F.get(oe+1,me+1),te-me),$-oe)}getAtTileOffset(t,e,n){const u=1<<t.canonical.z;return this.getAtPointOrZero(new Li(t.wrap+(t.canonical.x+e/Gn)/u,(t.canonical.y+n/Gn)/u))}getAtTileOffsetFunc(t,e,n,u){return p=>{const y=this.getAtTileOffset(t,p.x,p.y),x=u.upVector(t.canonical,p.x,p.y);return mu(x,x,y*u.upVectorScale(t.canonical,e,n).metersToTile),x}}getForTilePoints(t,e,n,u){if(this.isUsingMockSource())return!1;const p=iu.create(this,t,u);return!!p&&(e.forEach(y=>{y[2]=this.exaggeration()*p.getElevationAt(y[0],y[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,u=e.tileID,p=1<<t.canonical.z-u.canonical.z;let y=t.canonical.x/p-u.canonical.x,x=t.canonical.y/p-u.canonical.y,T=0;for(let I=0;I<t.canonical.z-u.canonical.z&&!n.leaves[T];I++){y*=2,x*=2;const L=2*Math.floor(x)+Math.floor(y);T=n.childOffsets[T]+L,y%=1,x%=1}return{min:this.exaggeration()*n.minimums[T],max:this.exaggeration()*n.maximums[T]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},c.ErrorEvent=Ts,c.EvaluationParameters=Rt,c.Event=Ho,c.Evented=ki,c.FillExtrusionBucket=_h,c.Frustum=Yp,c.FrustumCorners=ag,c.GLOBE_METERS_TO_ECEF=vf,c.GLOBE_RADIUS=qu,c.GLOBE_SCALE_MATCH_LATITUDE=45,c.GLOBE_ZOOM_THRESHOLD_MAX=6,c.GLOBE_ZOOM_THRESHOLD_MIN=5,c.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_createGrid(t){const e=new mo,n=new Yn,u=65;for(let p=0;p<u;p++)for(let y=0;y<u;y++)e.emplaceBack(y,p);this._gridSegments=[];for(let p=0,y=0;p<Ra.length;p++){const x=Ra[p];for(let I=0;I<x;I++)for(let L=0;L<64;L++){const F=I*u+L;n.emplaceBack(F+1,F,F+u),n.emplaceBack(F+u,F+u+1,F+1)}const T=64*x*2;this._gridSegments.push(da.simpleSegment(0,y,(x+1)*u,T)),y+=T}this._gridBuffer=t.createVertexBuffer(e,Kc.members),this._gridIndexBuffer=t.createIndexBuffer(n,!0)}_createPoles(t){const e=new Yn;for(let p=0;p<=64;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new bi,u=new bi;this._poleSegments=[];for(let p=0,y=0;p<5;p++){const x=360/(1<<p);n.emplaceBack(0,-qu,0,.5,0),u.emplaceBack(0,-qu,0,.5,1);for(let T=0;T<=64;T++){const I=T/64,L=wn(0,x,I),[F,G,$]=Ac(Jg,Kg,L,qu);n.emplaceBack(F,G,$,I,0),u.emplaceBack(F,G,$,I,1)}this._poleSegments.push(da.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,yf,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(u,yf,!1)}getGridBuffers(t){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[t]]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const n=new ci,u=64,p=u+1;this._wireframeSegments=[];for(let y=0,x=0;y<Ra.length;y++){const T=Ra[y];for(let L=0;L<T;L++)for(let F=0;F<u;F++){const G=L*p+F;n.emplaceBack(G,G+1),n.emplaceBack(G,G+p),n.emplaceBack(G,G+p+1)}const I=T*u*3;this._wireframeSegments.push(da.simpleSegment(0,x,(T+1)*p,I)),x+=I}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},c.GlyphManager=Wc,c.ImagePosition=uf,c.LivePerformanceUtils=Rr,c.LngLat=so,c.LngLatBounds=yc,c.LocalGlyphMode=df,c.MAX_MERCATOR_LATITUDE=kn,c.MercatorCoordinate=Li,c.ONE_EM=24,c.OverscaledTileID=ml,c.PerformanceMarkers=sr,c.Properties=Ln,c.RGBAImage=Kl,c.Ray=Kf,c.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",H,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Xn(t))return t;const n=Sn(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Xn(t))return t;const n=Sn(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,u){if(!Xn(t))return t;const p=Sn(t);return p.path=`/v4/${p.authority}.json`,p.params.push("secure"),n&&p.params.push(`language=${n}`),u&&p.params.push(`worldview=${u}`),this._makeAPIURL(p,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,u){const p=Sn(t);return Xn(t)?(p.path=`/styles/v1${p.path}/sprite${e}${n}`,this._makeAPIURL(p,this._customAccessToken||u)):(p.path+=`${e}${n}`,aa(p))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Xn(t))return t;const u=Sn(t);u.path=u.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==u.authority&&512===n?"@2x":""}${Te.supported?".webp":"$1"}`),"raster"===u.authority?u.path=`/${ye.RASTER_URL_PREFIX}${u.path}`:(u.path=u.path.replace(/^.+\/v4\//,"/"),u.path=`/${ye.TILE_URL_VERSION}${u.path}`);const p=this._customAccessToken||function(y){for(const x of y){const T=x.match(/^access_token=(.*)$/);if(T)return T[1]}return null}(u.params)||ye.ACCESS_TOKEN;return ye.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&u.params.push(`sku=${this._skuToken}`),this._makeAPIURL(u,p)}canonicalizeTileURL(t,e){const n=Sn(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let u="mapbox://";n.path.match(/^\/raster\/v1\//)?u+=`raster/${n.path.replace(`/${ye.RASTER_URL_PREFIX}/`,"")}`:u+=`tiles/${n.path.replace(`/${ye.TILE_URL_VERSION}/`,"")}`;let p=n.params;return e&&(p=p.filter(y=>!y.match(/^access_token=/))),p.length&&(u+=`?${p.join("&")}`),u}canonicalizeTileset(t,e){const n=!!e&&Xn(e),u=[];for(const p of t.tiles||[])Os(p)?u.push(this.canonicalizeTileURL(p,n)):u.push(p);return u}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",u=Sn(ye.API_URL);if(t.protocol=u.protocol,t.authority=u.authority,"http"===t.protocol){const p=t.params.indexOf("secure");p>=0&&t.params.splice(p,1)}if("/"!==u.path&&(t.path=`${u.path}${t.path}`),!ye.REQUIRE_ACCESS_TOKEN)return aa(t);if(e=e||ye.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(p=>-1===p.indexOf("access_token")),t.params.push(`access_token=${e||""}`),aa(t)}},c.ResourceType=un,c.SegmentVector=da,c.SourceCache=lc,c.StencilMode=oh,c.StructArrayLayout1ui2=Ai,c.StructArrayLayout2f1f2i16=bo,c.StructArrayLayout2i4=mo,c.StructArrayLayout2ui4=ci,c.StructArrayLayout3f12=fi,c.StructArrayLayout3ui6=Yn,c.StructArrayLayout4i8=yo,c.StructArrayLayout5f20=bi,c.Texture=Lh,c.Tile=ac,c.Transitionable=pr,c.Uniform1f=Rp,c.Uniform1i=class extends Ju{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},c.Uniform2f=class extends Ju{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},c.Uniform3f=class extends Ju{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},c.Uniform4f=jd,c.UniformColor=qd,c.UniformMatrix2f=class extends Ju{constructor(t){super(t),this.current=Em}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let u=0;u<4;u++)if(n[u]!==this.current[u]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},c.UniformMatrix3f=class extends Ju{constructor(t){super(t),this.current=wm}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let u=0;u<9;u++)if(n[u]!==this.current[u]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},c.UniformMatrix4f=class extends Ju{constructor(t){super(t),this.current=bm}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let u=1;u<16;u++)if(n[u]!==this.current[u]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},c.UnwrappedTileID=oy,c.ValidationError=Hr,c.VectorTileFeature=nd,c.VectorTileWorkerSource=class extends ki{constructor(t,e,n,u,p){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=p||pm,this.loading={},this.loaded={},this.deduped=new hm(t.scheduler),this.isSpriteLoaded=u,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,u=t&&t.request,p=u&&u.collectResourceTiming,y=this.loading[n]=new Cy(t);y.abort=this.loadVectorData(t,(x,T)=>{const I=!this.loading[n];if(delete this.loading[n],I||x||!T)return y.status="done",I||(this.loaded[n]=y),e(x);const L=T.rawData,F={};T.expires&&(F.expires=T.expires),T.cacheControl&&(F.cacheControl=T.cacheControl),y.vectorTile=T.vectorTile||new wg(new of(L));const G=()=>{y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,($,te)=>{if($||!te)return e($);const oe={};if(p){const me=hn(u);me.length>0&&(oe.resourceTiming=JSON.parse(JSON.stringify(me)))}e(null,Ae({rawTileData:L.slice(0)},te,F,oe))})};this.isSpriteLoaded?G():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(G,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):G()}),this.loaded=this.loaded||{},this.loaded[n]=y})}reloadTile(t,e){const n=this.loaded,u=t.uid,p=this;if(n&&n[u]){const y=n[u];y.showCollisionBoxes=t.showCollisionBoxes,y.enableTerrain=!!t.enableTerrain,y.projection=t.projection,y.tileTransform=Qc(t.tileID.canonical,t.projection);const x=(T,I)=>{const L=y.reloadCallback;L&&(delete y.reloadCallback,y.parse(y.vectorTile,p.layerIndex,this.availableImages,p.actor,L)),e(T,I)};"parsing"===y.status?y.reloadCallback=x:"done"===y.status&&(y.vectorTile?y.parse(y.vectorTile,this.layerIndex,this.availableImages,this.actor,x):x())}}abortTile(t,e){const n=t.uid,u=this.loading[n];u&&(u.abort&&u.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,u=t.uid;n&&n[u]&&delete n[u],e()}},c.WritingMode=Xl,c.add=ec,c.addDynamicAttributes=rh,c.adjoint=function(t,e){var n=e[0],u=e[1],p=e[2],y=e[3],x=e[4],T=e[5],I=e[6],L=e[7],F=e[8];return t[0]=x*F-T*L,t[1]=p*L-u*F,t[2]=u*T-p*x,t[3]=T*I-y*F,t[4]=n*F-p*I,t[5]=p*y-n*T,t[6]=y*L-x*I,t[7]=u*I-n*L,t[8]=n*x-u*y,t},c.asyncAll=ke,c.bezier=ze,c.bindAll=Cr,c.boundsAttributes=Df,c.bufferConvexPolygon=function(t,e){const n=[];for(let u=0;u<t.length;u++){const p=Nt(u-1,-1,t.length-1),y=Nt(u+1,-1,t.length-1),x=t[u],T=t[y],I=t[p].sub(x).unit(),L=T.sub(x).unit(),F=L.angleWithSep(I.x,I.y),G=I.add(L).unit().mult(-1*e/Math.sin(F/2));n.push(x.add(G))}return n},c.cacheEntryPossiblyAdded=function(t){En++,En>Xt&&(t.getActor().send("enforceCacheSizeLimit",St),En=0)},c.calculateGlobeLabelMatrix=function(t,e){const{x:n,y:u}=t.point,p=Ed(n,u,t.worldSize/t._pixelsPerMercatorPixel,0,0);return qc(p,p,wd(Vu(e)))},c.calculateGlobeMatrix=function(t){const{x:e,y:n}=t.point,{lng:u,lat:p}=t._center;return Ed(e,n,t.worldSize,u,p)},c.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,n=e/tn(1,t.center.lat),u=Bu(new Float64Array(16));return jp(u,u,[t.point.x,t.point.y,0]),Vc(u,u,[n,n,e]),Float32Array.from(u)},c.circumferenceAtLatitude=jf,c.clamp=Ee,c.clearTileCache=function(t){if(!gr())return;const e=Z.caches.delete(_e);t&&e.catch(t).then(()=>t())},c.clipLine=$l,c.clone=function(t){var e=new Zl(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.clone$1=zr,c.collisionCircleLayout=hy,c.config=ye,c.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},c.create=function(){var t=new Zl(16);return Zl!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},c.create$1=Jd,c.createExpression=Ma,c.createLayout=Kr,c.createStyleLayer=function(t){return"custom"===t.type?new im(t):new om[t.type](t)},c.cross=$p,c.degToRad=se,c.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},c.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},c.dot=yu,c.earthRadius=Fp,c.ease=Ze,c.easeCubicInOut=nt,c.ecefToLatLng=function([t,e,n]){const u=Math.hypot(t,e,n),p=Math.atan2(t,n),y=.5*Math.PI-Math.acos(-e/u);return new so(he(p),he(y))},c.emitValidationErrors=V,c.endsWith=Ft,c.enforceCacheSizeLimit=function(t){_r(),ve&&ve.then(e=>{e.keys().then(n=>{for(let u=0;u<n.length-t;u++)e.delete(n[u])})})},c.evaluateSizeForFeature=fd,c.evaluateSizeForZoom=cp,c.evaluateVariableOffset=jg,c.evented=mt,c.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},c.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},c.exported=jr,c.exported$1=Te,c.extend=Ae,c.extend$1=hs,c.fillExtrusionHeightLift=ny,c.filterObject=Fr,c.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},c.fromQuat=function(t,e){var n=e[0],u=e[1],p=e[2],y=e[3],x=n+n,T=u+u,I=p+p,L=n*x,F=u*x,G=u*T,$=p*x,te=p*T,oe=p*I,me=y*x,Pe=y*T,tt=y*I;return t[0]=1-G-oe,t[1]=F+tt,t[2]=$-Pe,t[3]=0,t[4]=F-tt,t[5]=1-L-oe,t[6]=te+me,t[7]=0,t[8]=$+Pe,t[9]=te-me,t[10]=1-L-G,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},c.fromRotation=function(t,e){var n=Math.sin(e),u=Math.cos(e);return t[0]=u,t[1]=n,t[2]=0,t[3]=-n,t[4]=u,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.fromScaling=Yf,c.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return re[e]},c.getAABBPointSquareDist=function(t,e,n){let u=0;for(let p=0;p<2;++p){const y=n?n[p]:0;t[p]>y&&(u+=(t[p]-y)*(t[p]-y)),e[p]<y&&(u+=(y-e[p])*(y-e[p]))}return u},c.getAnchorAlignment=gd,c.getAnchorJustification=Vg,c.getBounds=function(t){let e=1/0,n=1/0,u=-1/0,p=-1/0;for(const y of t)e=Math.min(e,y.x),n=Math.min(n,y.y),u=Math.max(u,y.x),p=Math.max(p,y.y);return{min:new X(e,n),max:new X(u,p)}},c.getColumn=Se,c.getGridMatrix=function(t,e,n,u){const p=e.getNorth(),y=e.getSouth(),x=e.getWest(),T=e.getEast(),I=1<<t.z,L=T-x,F=p-y,G=L/64,$=-F/Ra[n],te=[0,G,0,$,0,0,p,x,0];if(t.z>0){const oe=180/u;Kd(te,te,[oe/L+1,0,0,0,oe/F+1,0,-.5*oe/G,.5*oe/$,1])}return te[2]=I,te[5]=t.x,te[8]=t.y,te},c.getImage=Po,c.getJSON=function(t,e){return ti(Ae(t,{type:"json"}),e)},c.getLatitudinalLod=function(t){const e=80.051129;t=Ee(t,-80.051129,e)/e*90;const n=Math.pow(Math.abs(Math.sin(se(t))),3);return Math.round(n*(Ra.length-1))},c.getMapSessionAPI=wt,c.getPerformanceMeasurement=hn,c.getProjection=Tf,c.getRTLTextPluginStatus=It,c.getReferrer=Cn,c.getTilePoint=function(t,{x:e,y:n},u=0){return new X(((e-u)*t.scale-t.x)*Gn,(n*t.scale-t.y)*Gn)},c.getTileVec3=function(t,e,n=0){return gh(((e.x-n)*t.scale-t.x)*Gn,(e.y*t.scale-t.y)*Gn,Qn(e.z,e.y))},c.getVideo=function(t,e){const n=Z.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let u=0;u<t.length;u++){const p=Z.document.createElement("source");zn(t[u])||(n.crossOrigin="Anonymous"),p.src=t[u],n.appendChild(p)}return{cancel:()=>{}}},c.globeCenterToScreenPoint=function(t){const e=[0,0,0],n=Bu(new Float64Array(16));return qc(n,t.pixelMatrix,t.globeMatrix),js(e,e,n),new X(e[0],e[1])},c.globeDenormalizeECEF=wd,c.globeECEFOrigin=function(t,e){const n=[0,0,0];return js(n,n,xf(Vu(e.canonical))),js(n,n,t),n},c.globeNormalizeECEF=xf,c.globePixelsToTileUnits=function(t,e){return Gn/(512*Math.pow(2,t))*xp(Vu(e))},c.globePoleMatrixForTile=function(t,e,n){const u=Bu(new Float64Array(16)),p=(e/(1<<t)-.5)*Math.PI*2;return qp(u,n.globeMatrix,p),Float32Array.from(u)},c.globeTileBounds=Vu,c.globeTiltAtLngLat=Wg,c.globeToMercatorTransition=bp,c.globeUseCustomAntiAliasing=function(t,e,n){const u=bp(n.zoom),p=t.style.map._antialias,y=!!e.extStandardDerivatives,x=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===u&&!p&&!x&&y},c.identity=Bu,c.identity$1=og,c.invert=Gp,c.isFullscreen=function(){return!!Z.document.fullscreenElement||!!Z.document.webkitFullscreenElement},c.isLngLatBehindGlobe=Ch,c.isMapAuthenticated=function(t){return Ct.has(t)},c.isMapboxURL=Xn,c.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!lr(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},c.latFromMercatorY=ln,c.latLngToECEF=vp,c.len=Um,c.length=$h,c.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},c.lngFromMercatorX=bn,c.loadVectorTile=pm,c.makeRequest=ti,c.mapValue=function(t,e,n,u,p){return Ee((t-e)/(n-e)*(p-u)+u,u,p)},c.mercatorScale=to,c.mercatorXfromLng=zu,c.mercatorYfromLat=an,c.mercatorZfromAltitude=tn,c.mul=zm,c.mul$1=Ry,c.multiply=qc,c.multiply$1=Kd,c.multiply$2=Bm,c.nextPowerOfTwo=Wt,c.normalize=gl,c.normalize$1=Jf,c.normalize$2=ng,c.number=wn,c.ortho=function(t,e,n,u,p,y,x){var T=1/(e-n),I=1/(u-p),L=1/(y-x);return t[0]=-2*T,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*I,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*L,t[11]=0,t[12]=(e+n)*T,t[13]=(p+u)*I,t[14]=(x+y)*L,t[15]=1,t},c.pbf=of,c.perspective=function(t,e,n,u,p){var y,x=1/Math.tan(e/2);return t[0]=x/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=x,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=p&&p!==1/0?(t[10]=(p+u)*(y=1/(u-p)),t[14]=2*p*u*y):(t[10]=-1,t[14]=-2*u),t},c.pick=function(t,e){const n={};for(let u=0;u<e.length;u++){const p=e[u];p in t&&(n[p]=t[p])}return n},c.plugin=jt,c.pointGeometry=X,c.polesInViewport=function(t){const e=Bu(new Float64Array(16));qc(e,t.pixelMatrix,t.globeMatrix);const n=[0,ws,0],u=[0,ma,0];return js(n,n,e),js(u,u,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Ch(t,new so(t.center.lat,90)),u[0]>0&&u[0]<=t.width&&u[1]>0&&u[1]<=t.height&&!Ch(t,new so(t.center.lat,-90))]},c.polygonContainsPoint=_c,c.polygonIntersectsBox=Hd,c.polygonIntersectsPolygon=$d,c.polygonizeBounds=function(t,e,n=0,u=!0){const p=new X(n,n),y=t.sub(p),x=e.add(p),T=[y,new X(x.x,y.y),x,new X(y.x,x.y)];return u&&T.push(y.clone()),T},c.posAttributes=Kc,c.postMapLoadEvent=ot,c.postPerformanceEvent=Dt,c.postTurnstileEvent=we,c.potpack=lf,c.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},c.radToDeg=he,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.registerForPluginStateChange=function(t){return t({pluginStatus:He,pluginURL:Xe}),mt.on("pluginStateChange",t),t},c.removeAuthState=function(t){Ct.delete(t)},c.renderColorRamp=cg,c.resample=Me,c.rotateX=Xh,c.rotateX$1=sg,c.rotateY=qp,c.rotateY$1=Hf,c.rotateZ=function(t,e,n){var u=Math.sin(n),p=Math.cos(n),y=e[0],x=e[1],T=e[2],I=e[3],L=e[4],F=e[5],G=e[6],$=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=y*p+L*u,t[1]=x*p+F*u,t[2]=T*p+G*u,t[3]=I*p+$*u,t[4]=L*p-y*u,t[5]=F*p-x*u,t[6]=G*p-T*u,t[7]=$*p-I*u,t},c.rotateZ$1=function(t,e,n){n*=.5;var u=e[0],p=e[1],y=e[2],x=e[3],T=Math.sin(n),I=Math.cos(n);return t[0]=u*I+p*T,t[1]=p*I-u*T,t[2]=y*I+x*T,t[3]=x*I-y*T,t},c.scale=Vc,c.scale$1=rg,c.scale$2=mu,c.scaleAndAdd=Yh,c.set=function(t,e,n,u){return t[0]=e,t[1]=n,t[2]=u,t},c.setCacheLimits=function(t,e){St=t,Xt=e},c.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},c.setRTLTextPlugin=function(t,e,n=!1){if(He===Be||He===Ve||He===Le)throw new Error("setRTLTextPlugin cannot be called multiple times.");Xe=jr.resolveURL(t),He=Be,De=e,_t(),n||Ht()},c.smoothstep=Jt,c.spec=ur,c.squaredLength=function(t){var e=t[0],n=t[1],u=t[2];return e*e+n*n+u*u},c.storeAuthState=function(t,e){e?Ct.add(t):Ct.delete(t)},c.sub=Uu,c.subtract=Wf,c.symbolSize=Sc,c.tileAABB=function(t,e,n,u,p,y,x,T,I){if("globe"===I.name)return function gy(t,e,n){const u=e/t.worldSize,p=t.globeMatrix;if(n.z<=1){const Zt=Vu(n).getCorners();return $g(Zt,p,u),Cl.fromPoints(Zt)}const y=_p(n),x=Yg(y);$g(x,p,u);const T=Number.MAX_VALUE,I=[-T,-T,-T],L=[T,T,T];if(y.contains(t.center)){for(const Pr of x)Zp(L,L,Pr),Xp(I,I,Pr);I[2]=0;const Zt=t.point,cr=[Zt.x*u,Zt.y*u,0];return Zp(L,L,cr),Xp(I,I,cr),new Cl(L,I)}const F=[p[12]*u,p[13]*u,p[14]*u],G=y.getCenter(),$=Ee(t.center.lat,-85.051129,kn),te=Ee(G.lat,-85.051129,kn),oe=zu(t.center.lng),me=an($);let Pe=oe-zu(G.lng);const tt=me-an(te);Pe>.5?Pe-=1:Pe<-.5&&(Pe+=1);let ut=0;Math.abs(Pe)>Math.abs(tt)?ut=Pe>=0?1:3:(ut=tt>=0?0:2,Yh(F,F,[p[4]*u,p[5]*u,p[6]*u],-Math.sin(se(tt>=0?y.getSouth():y.getNorth()))*qu));const Ke=x[ut],lt=x[(ut+1)%4],vt=new Zg(Ke,lt,F),ht=[xd(vt,0)||Ke[0],xd(vt,1)||Ke[1],xd(vt,2)||Ke[2]],$t=bp(t.zoom);if($t>0){const Zt=function({x:Pr,y:Qt,z:dr},yr,Sr,Ir,nr){const qr=1/(1<<dr);let Rn=Pr*qr,Xr=Rn+qr,dn=Qt*qr,Vr=dn+qr,Fn=0;const Di=(Rn+Xr)/2-Ir;return Di>.5?Fn=-1:Di<-.5&&(Fn=1),Rn=((Rn+Fn)*yr-(Ir*=yr))*Sr+Ir,Xr=((Xr+Fn)*yr-Ir)*Sr+Ir,dn=(dn*yr-(nr*=yr))*Sr+nr,Vr=(Vr*yr-nr)*Sr+nr,[[Rn,Vr,0],[Xr,Vr,0],[Xr,dn,0],[Rn,dn,0]]}(n,e,t._pixelsPerMercatorPixel,oe,me);for(let Pr=0;Pr<x.length;Pr++)Pc(x[Pr],Zt[Pr],$t);const cr=ec([],Zt[ut],Zt[(ut+1)%4]);mu(cr,cr,.5),Pc(ht,cr,$t)}for(const Zt of x)Zp(L,L,Zt),Xp(I,I,Zt);return L[2]=Math.min(Ke[2],lt[2]),Zp(L,L,ht),Xp(I,I,ht),new Cl(L,I)}(t,e,new sd(n,u,p));const L=Qc({z:n,x:u,y:p},I);return new Cl([(y+L.x/L.scale)*e,e*(L.y/L.scale),x],[(y+L.x2/L.scale)*e,e*(L.y2/L.scale),T])},c.tileCornersToBounds=_p,c.tileTransform=Qc,c.transformMat3=function(t,e,n){var u=e[0],p=e[1],y=e[2];return t[0]=u*n[0]+p*n[3]+y*n[6],t[1]=u*n[1]+p*n[4]+y*n[7],t[2]=u*n[2]+p*n[5]+y*n[8],t},c.transformMat4=js,c.transformMat4$1=Zc,c.transformQuat=tg,c.transitionTileAABBinECEF=Xg,c.translate=jp,c.transpose=function(t,e){if(t===e){var n=e[1],u=e[2],p=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=u,t[7]=p}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},c.triggerPluginCompletionEvent=at,c.uniqueId=bt,c.updateGlobeVertexNormal=function(t,e,n,u,p){const y=5*e+2;t.float32[y+0]=n,t.float32[y+1]=u,t.float32[y+2]=p},c.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},c.validateFilter=t=>k(fl(t)),c.validateFog=t=>k(zc(t)),c.validateLayer=t=>k(Rl(t)),c.validateLight=t=>k(Za(t)),c.validateSource=t=>k(Va(t)),c.validateStyle=f,c.validateTerrain=t=>k(ts(t)),c.values=xt,c.vectorTile=Qp,c.version=ce,c.warnOnce=Ar,c.window=Z,c.wrap=Nt}),pe(0,function(c){function Z(Ge){if("number"==typeof Ge||"boolean"==typeof Ge||"string"==typeof Ge||null==Ge)return JSON.stringify(Ge);if(Array.isArray(Ge)){let we="[";for(const qe of Ge)we+=`${Z(qe)},`;return`${we}]`}let le="{";for(const we of Object.keys(Ge).sort())le+=`${we}:${Z(Ge[we])},`;return`${le}}`}function ce(Ge){let le="";for(const we of c.refProperties)le+=`/${Z(Ge[we])}`;return le}class be{constructor(le){this.keyCache={},le&&this.replace(le)}replace(le){this._layerConfigs={},this._layers={},this.update(le,[])}update(le,we){for(const ot of le)this._layerConfigs[ot.id]=ot,(this._layers[ot.id]=c.createStyleLayer(ot)).compileFilter(),this.keyCache[ot.id]&&delete this.keyCache[ot.id];for(const ot of we)delete this.keyCache[ot],delete this._layerConfigs[ot],delete this._layers[ot];this.familiesBySource={};const qe=function(ot,dt){const Dt={};for(let wt=0;wt<ot.length;wt++){const Ct=dt&&dt[ot[wt].id]||ce(ot[wt]);dt&&(dt[ot[wt].id]=Ct);let sr=Dt[Ct];sr||(sr=Dt[Ct]=[]),sr.push(ot[wt])}const Ot=[];for(const wt in Dt)Ot.push(Dt[wt]);return Ot}(c.values(this._layerConfigs),this.keyCache);for(const ot of qe){const dt=ot.map(Rr=>this._layers[Rr.id]),Dt=dt[0];if("none"===Dt.visibility)continue;const Ot=Dt.source||"";let wt=this.familiesBySource[Ot];wt||(wt=this.familiesBySource[Ot]={});const Ct=Dt.sourceLayer||"_geojsonTileLayer";let sr=wt[Ct];sr||(sr=wt[Ct]=[]),sr.push(dt)}}}class ye{loadTile(le,we){const{uid:qe,encoding:ot,rawImageData:dt,padding:Dt,buildQuadTree:Ot}=le,wt=c.window.ImageBitmap&&dt instanceof c.window.ImageBitmap?this.getImageData(dt,Dt):dt;we(null,new c.DEMData(qe,wt,ot,Dt<1,Ot))}getImageData(le,we){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(le.width,le.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=le.width,this.offscreenCanvas.height=le.height,this.offscreenCanvasContext.drawImage(le,0,0,le.width,le.height);const qe=this.offscreenCanvasContext.getImageData(-we,-we,le.width+2*we,le.height+2*we);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),qe}}var Te=function Ge(le,we){var qe,ot=le&&le.type;if("FeatureCollection"===ot)for(qe=0;qe<le.features.length;qe++)Ge(le.features[qe],we);else if("GeometryCollection"===ot)for(qe=0;qe<le.geometries.length;qe++)Ge(le.geometries[qe],we);else if("Feature"===ot)Ge(le.geometry,we);else if("Polygon"===ot)$e(le.coordinates,we);else if("MultiPolygon"===ot)for(qe=0;qe<le.coordinates.length;qe++)$e(le.coordinates[qe],we);return le};function $e(Ge,le){if(0!==Ge.length){xe(Ge[0],le);for(var we=1;we<Ge.length;we++)xe(Ge[we],!le)}}function xe(Ge,le){for(var we=0,qe=0,ot=0,dt=Ge.length,Dt=dt-1;ot<dt;Dt=ot++){var Ot=(Ge[ot][0]-Ge[Dt][0])*(Ge[Dt][1]+Ge[ot][1]),wt=we+Ot;qe+=Math.abs(we)>=Math.abs(Ot)?we-wt+Ot:Ot-wt+we,we=wt}we+qe>=0!=!!le&&Ge.reverse()}const ge=c.VectorTileFeature.prototype.toGeoJSON;class Oe{constructor(le){this._feature=le,this.extent=c.EXTENT,this.type=le.type,this.properties=le.tags,"id"in le&&!isNaN(le.id)&&(this.id=parseInt(le.id,10))}loadGeometry(){if(1===this._feature.type){const le=[];for(const we of this._feature.geometry)le.push([new c.pointGeometry(we[0],we[1])]);return le}{const le=[];for(const we of this._feature.geometry){const qe=[];for(const ot of we)qe.push(new c.pointGeometry(ot[0],ot[1]));le.push(qe)}return le}}toGeoJSON(le,we,qe){return ge.call(this,le,we,qe)}}class We{constructor(le){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=le.length,this._features=le}feature(le){return new Oe(this._features[le])}}var H={exports:{}},q=c.pointGeometry,K=c.vectorTile.VectorTileFeature,X=ee;function ee(Ge,le){this.options=le||{},this.features=Ge,this.length=Ge.length}function ie(Ge,le){this.id="number"==typeof Ge.id?Ge.id:void 0,this.type=Ge.type,this.rawGeometry=1===Ge.type?[Ge.geometry]:Ge.geometry,this.properties=Ge.tags,this.extent=le||4096}ee.prototype.feature=function(Ge){return new ie(this.features[Ge],this.options.extent)},ie.prototype.loadGeometry=function(){var Ge=this.rawGeometry;this.geometry=[];for(var le=0;le<Ge.length;le++){for(var we=Ge[le],qe=[],ot=0;ot<we.length;ot++)qe.push(new q(we[ot][0],we[ot][1]));this.geometry.push(qe)}return this.geometry},ie.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ge=this.geometry,le=1/0,we=-1/0,qe=1/0,ot=-1/0,dt=0;dt<Ge.length;dt++)for(var Dt=Ge[dt],Ot=0;Ot<Dt.length;Ot++){var wt=Dt[Ot];le=Math.min(le,wt.x),we=Math.max(we,wt.x),qe=Math.min(qe,wt.y),ot=Math.max(ot,wt.y)}return[le,qe,we,ot]},ie.prototype.toGeoJSON=K.prototype.toGeoJSON;var ne=c.pbf,se=X;function he(Ge){var le=new ne;return function(we,qe){for(var ot in we.layers)qe.writeMessage(3,re,we.layers[ot])}(Ge,le),le.finish()}function re(Ge,le){var we;le.writeVarintField(15,Ge.version||1),le.writeStringField(1,Ge.name||""),le.writeVarintField(5,Ge.extent||4096);var qe={keys:[],values:[],keycache:{},valuecache:{}};for(we=0;we<Ge.length;we++)qe.feature=Ge.feature(we),le.writeMessage(2,nt,qe);var ot=qe.keys;for(we=0;we<ot.length;we++)le.writeStringField(3,ot[we]);var dt=qe.values;for(we=0;we<dt.length;we++)le.writeMessage(4,Nt,dt[we])}function nt(Ge,le){var we=Ge.feature;void 0!==we.id&&le.writeVarintField(1,we.id),le.writeMessage(2,ze,Ge),le.writeVarintField(3,we.type),le.writeMessage(4,Jt,we)}function ze(Ge,le){var we=Ge.feature,qe=Ge.keys,ot=Ge.values,dt=Ge.keycache,Dt=Ge.valuecache;for(var Ot in we.properties){var wt=we.properties[Ot],Ct=dt[Ot];if(null!==wt){void 0===Ct&&(qe.push(Ot),dt[Ot]=Ct=qe.length-1),le.writeVarint(Ct);var sr=typeof wt;"string"!==sr&&"boolean"!==sr&&"number"!==sr&&(wt=JSON.stringify(wt));var Rr=sr+":"+wt,mr=Dt[Rr];void 0===mr&&(ot.push(wt),Dt[Rr]=mr=ot.length-1),le.writeVarint(mr)}}}function Ze(Ge,le){return(le<<3)+(7&Ge)}function Ee(Ge){return Ge<<1^Ge>>31}function Jt(Ge,le){for(var we=Ge.loadGeometry(),qe=Ge.type,ot=0,dt=0,Dt=we.length,Ot=0;Ot<Dt;Ot++){var wt=we[Ot],Ct=1;1===qe&&(Ct=wt.length),le.writeVarint(Ze(1,Ct));for(var sr=3===qe?wt.length-1:wt.length,Rr=0;Rr<sr;Rr++){1===Rr&&1!==qe&&le.writeVarint(Ze(2,sr-1));var mr=wt[Rr].x-ot,Yr=wt[Rr].y-dt;le.writeVarint(Ee(mr)),le.writeVarint(Ee(Yr)),ot+=mr,dt+=Yr}3===qe&&le.writeVarint(Ze(7,1))}}function Nt(Ge,le){var we=typeof Ge;"string"===we?le.writeStringField(1,Ge):"boolean"===we?le.writeBooleanField(7,Ge):"number"===we&&(Ge%1!=0?le.writeDoubleField(3,Ge):Ge<0?le.writeSVarintField(6,Ge):le.writeVarintField(5,Ge))}function ke(Ge,le,we,qe,ot,dt){if(ot-qe<=we)return;const Dt=qe+ot>>1;xt(Ge,le,Dt,qe,ot,dt%2),ke(Ge,le,we,qe,Dt-1,dt+1),ke(Ge,le,we,Dt+1,ot,dt+1)}function xt(Ge,le,we,qe,ot,dt){for(;ot>qe;){if(ot-qe>600){const Ct=ot-qe+1,sr=we-qe+1,Rr=Math.log(Ct),mr=.5*Math.exp(2*Rr/3),Yr=.5*Math.sqrt(Rr*mr*(Ct-mr)/Ct)*(sr-Ct/2<0?-1:1);xt(Ge,le,we,Math.max(qe,Math.floor(we-sr*mr/Ct+Yr)),Math.min(ot,Math.floor(we+(Ct-sr)*mr/Ct+Yr)),dt)}const Dt=le[2*we+dt];let Ot=qe,wt=ot;for(Ae(Ge,le,qe,we),le[2*ot+dt]>Dt&&Ae(Ge,le,qe,ot);Ot<wt;){for(Ae(Ge,le,Ot,wt),Ot++,wt--;le[2*Ot+dt]<Dt;)Ot++;for(;le[2*wt+dt]>Dt;)wt--}le[2*qe+dt]===Dt?Ae(Ge,le,qe,wt):(wt++,Ae(Ge,le,wt,ot)),wt<=we&&(qe=wt+1),we<=wt&&(ot=wt-1)}}function Ae(Ge,le,we,qe){pt(Ge,we,qe),pt(le,2*we,2*qe),pt(le,2*we+1,2*qe+1)}function pt(Ge,le,we){const qe=Ge[le];Ge[le]=Ge[we],Ge[we]=qe}function bt(Ge,le,we,qe){const ot=Ge-we,dt=le-qe;return ot*ot+dt*dt}H.exports=he,H.exports.fromVectorTileJs=he,H.exports.fromGeojsonVt=function(Ge,le){le=le||{};var we={};for(var qe in Ge)we[qe]=new se(Ge[qe].features,le),we[qe].name=qe,we[qe].version=le.version,we[qe].extent=le.extent;return he({layers:we})},H.exports.GeoJSONWrapper=se;const Ue=Ge=>Ge[0],Wt=Ge=>Ge[1];class Vt{constructor(le,we=Ue,qe=Wt,ot=64,dt=Float64Array){this.nodeSize=ot,this.points=le;const Dt=le.length<65536?Uint16Array:Uint32Array,Ot=this.ids=new Dt(le.length),wt=this.coords=new dt(2*le.length);for(let Ct=0;Ct<le.length;Ct++)Ot[Ct]=Ct,wt[2*Ct]=we(le[Ct]),wt[2*Ct+1]=qe(le[Ct]);ke(Ot,wt,ot,0,Ot.length-1,0)}range(le,we,qe,ot){return function(dt,Dt,Ot,wt,Ct,sr,Rr){const mr=[0,dt.length-1,0],Yr=[];let hn,en;for(;mr.length;){const Tn=mr.pop(),Dn=mr.pop(),xi=mr.pop();if(Dn-xi<=Rr){for(let ro=xi;ro<=Dn;ro++)hn=Dt[2*ro],en=Dt[2*ro+1],hn>=Ot&&hn<=Ct&&en>=wt&&en<=sr&&Yr.push(dt[ro]);continue}const jr=Math.floor((xi+Dn)/2);hn=Dt[2*jr],en=Dt[2*jr+1],hn>=Ot&&hn<=Ct&&en>=wt&&en<=sr&&Yr.push(dt[jr]);const mn=(Tn+1)%2;(0===Tn?Ot<=hn:wt<=en)&&(mr.push(xi),mr.push(jr-1),mr.push(mn)),(0===Tn?Ct>=hn:sr>=en)&&(mr.push(jr+1),mr.push(Dn),mr.push(mn))}return Yr}(this.ids,this.coords,le,we,qe,ot,this.nodeSize)}within(le,we,qe){return function(ot,dt,Dt,Ot,wt,Ct){const sr=[0,ot.length-1,0],Rr=[],mr=wt*wt;for(;sr.length;){const Yr=sr.pop(),hn=sr.pop(),en=sr.pop();if(hn-en<=Ct){for(let mn=en;mn<=hn;mn++)bt(dt[2*mn],dt[2*mn+1],Dt,Ot)<=mr&&Rr.push(ot[mn]);continue}const Tn=Math.floor((en+hn)/2),Dn=dt[2*Tn],xi=dt[2*Tn+1];bt(Dn,xi,Dt,Ot)<=mr&&Rr.push(ot[Tn]);const jr=(Yr+1)%2;(0===Yr?Dt-wt<=Dn:Ot-wt<=xi)&&(sr.push(en),sr.push(Tn-1),sr.push(jr)),(0===Yr?Dt+wt>=Dn:Ot+wt>=xi)&&(sr.push(Tn+1),sr.push(hn),sr.push(jr))}return Rr}(this.ids,this.coords,le,we,qe,this.nodeSize)}}const Cr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ge=>Ge},Ft=Math.fround||(Ur=new Float32Array(1),Ge=>(Ur[0]=+Ge,Ur[0]));var Ur;class Fr{constructor(le){this.options=ft(Object.create(Cr),le),this.trees=new Array(this.options.maxZoom+1)}load(le){const{log:we,minZoom:qe,maxZoom:ot,nodeSize:dt}=this.options;we&&console.time("total time");const Dt=`prepare ${le.length} points`;we&&console.time(Dt),this.points=le;let Ot=[];for(let wt=0;wt<le.length;wt++)le[wt].geometry&&Ot.push(rn(le[wt],wt));this.trees[ot+1]=new Vt(Ot,lr,st,dt,Float32Array),we&&console.timeEnd(Dt);for(let wt=ot;wt>=qe;wt--){const Ct=+Date.now();Ot=this._cluster(Ot,wt),this.trees[wt]=new Vt(Ot,lr,st,dt,Float32Array),we&&console.log("z%d: %d clusters in %dms",wt,Ot.length,+Date.now()-Ct)}return we&&console.timeEnd("total time"),this}getClusters(le,we){let qe=((le[0]+180)%360+360)%360-180;const ot=Math.max(-90,Math.min(90,le[1]));let dt=180===le[2]?180:((le[2]+180)%360+360)%360-180;const Dt=Math.max(-90,Math.min(90,le[3]));if(le[2]-le[0]>=360)qe=-180,dt=180;else if(qe>dt){const sr=this.getClusters([qe,ot,180,Dt],we),Rr=this.getClusters([-180,ot,dt,Dt],we);return sr.concat(Rr)}const Ot=this.trees[this._limitZoom(we)],wt=Ot.range(cn(qe),qn(Dt),cn(dt),qn(ot)),Ct=[];for(const sr of wt){const Rr=Ot.points[sr];Ct.push(Rr.numPoints?Ar(Rr):this.points[Rr.index])}return Ct}getChildren(le){const we=this._getOriginId(le),qe=this._getOriginZoom(le),ot="No cluster with the specified id.",dt=this.trees[qe];if(!dt)throw new Error(ot);const Dt=dt.points[we];if(!Dt)throw new Error(ot);const Ot=this.options.radius/(this.options.extent*Math.pow(2,qe-1)),wt=dt.within(Dt.x,Dt.y,Ot),Ct=[];for(const sr of wt){const Rr=dt.points[sr];Rr.parentId===le&&Ct.push(Rr.numPoints?Ar(Rr):this.points[Rr.index])}if(0===Ct.length)throw new Error(ot);return Ct}getLeaves(le,we,qe){const ot=[];return this._appendLeaves(ot,le,we=we||10,qe=qe||0,0),ot}getTile(le,we,qe){const ot=this.trees[this._limitZoom(le)],dt=Math.pow(2,le),{extent:Dt,radius:Ot}=this.options,wt=Ot/Dt,Ct=(qe-wt)/dt,sr=(qe+1+wt)/dt,Rr={features:[]};return this._addTileFeatures(ot.range((we-wt)/dt,Ct,(we+1+wt)/dt,sr),ot.points,we,qe,dt,Rr),0===we&&this._addTileFeatures(ot.range(1-wt/dt,Ct,1,sr),ot.points,dt,qe,dt,Rr),we===dt-1&&this._addTileFeatures(ot.range(0,Ct,wt/dt,sr),ot.points,-1,qe,dt,Rr),Rr.features.length?Rr:null}getClusterExpansionZoom(le){let we=this._getOriginZoom(le)-1;for(;we<=this.options.maxZoom;){const qe=this.getChildren(le);if(we++,1!==qe.length)break;le=qe[0].properties.cluster_id}return we}_appendLeaves(le,we,qe,ot,dt){const Dt=this.getChildren(we);for(const Ot of Dt){const wt=Ot.properties;if(wt&&wt.cluster?dt+wt.point_count<=ot?dt+=wt.point_count:dt=this._appendLeaves(le,wt.cluster_id,qe,ot,dt):dt<ot?dt++:le.push(Ot),le.length===qe)break}return dt}_addTileFeatures(le,we,qe,ot,dt,Dt){for(const Ot of le){const wt=we[Ot],Ct=wt.numPoints;let sr,Rr,mr;if(Ct)sr=xr(wt),Rr=wt.x,mr=wt.y;else{const en=this.points[wt.index];sr=en.properties,Rr=cn(en.geometry.coordinates[0]),mr=qn(en.geometry.coordinates[1])}const Yr={type:1,geometry:[[Math.round(this.options.extent*(Rr*dt-qe)),Math.round(this.options.extent*(mr*dt-ot))]],tags:sr};let hn;Ct?hn=wt.id:this.options.generateId?hn=wt.index:this.points[wt.index].id&&(hn=this.points[wt.index].id),void 0!==hn&&(Yr.id=hn),Dt.features.push(Yr)}}_limitZoom(le){return Math.max(this.options.minZoom,Math.min(Math.floor(+le),this.options.maxZoom+1))}_cluster(le,we){const qe=[],{radius:ot,extent:dt,reduce:Dt,minPoints:Ot}=this.options,wt=ot/(dt*Math.pow(2,we));for(let Ct=0;Ct<le.length;Ct++){const sr=le[Ct];if(sr.zoom<=we)continue;sr.zoom=we;const Rr=this.trees[we+1],mr=Rr.within(sr.x,sr.y,wt),Yr=sr.numPoints||1;let hn=Yr;for(const en of mr){const Tn=Rr.points[en];Tn.zoom>we&&(hn+=Tn.numPoints||1)}if(hn>Yr&&hn>=Ot){let en=sr.x*Yr,Tn=sr.y*Yr,Dn=Dt&&Yr>1?this._map(sr,!0):null;const xi=(Ct<<5)+(we+1)+this.points.length;for(const jr of mr){const mn=Rr.points[jr];if(mn.zoom<=we)continue;mn.zoom=we;const ro=mn.numPoints||1;en+=mn.x*ro,Tn+=mn.y*ro,mn.parentId=xi,Dt&&(Dn||(Dn=this._map(sr,!0)),Dt(Dn,this._map(mn)))}sr.parentId=xi,qe.push(zr(en/hn,Tn/hn,xi,hn,Dn))}else if(qe.push(sr),hn>1)for(const en of mr){const Tn=Rr.points[en];Tn.zoom<=we||(Tn.zoom=we,qe.push(Tn))}}return qe}_getOriginId(le){return le-this.points.length>>5}_getOriginZoom(le){return(le-this.points.length)%32}_map(le,we){if(le.numPoints)return we?ft({},le.properties):le.properties;const qe=this.points[le.index].properties,ot=this.options.map(qe);return we&&ot===qe?ft({},ot):ot}}function zr(Ge,le,we,qe,ot){return{x:Ft(Ge),y:Ft(le),zoom:1/0,id:we,parentId:-1,numPoints:qe,properties:ot}}function rn(Ge,le){const[we,qe]=Ge.geometry.coordinates;return{x:Ft(cn(we)),y:Ft(qn(qe)),zoom:1/0,index:le,parentId:-1}}function Ar(Ge){return{type:"Feature",id:Ge.id,properties:xr(Ge),geometry:{type:"Point",coordinates:[(le=Ge.x,360*(le-.5)),yi(Ge.y)]}};var le}function xr(Ge){const le=Ge.numPoints,we=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le;return ft(ft({},Ge.properties),{cluster:!0,cluster_id:Ge.id,point_count:le,point_count_abbreviated:we})}function cn(Ge){return Ge/360+.5}function qn(Ge){const le=Math.sin(Ge*Math.PI/180),we=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return we<0?0:we>1?1:we}function yi(Ge){const le=(180-360*Ge)*Math.PI/180;return 360*Math.atan(Math.exp(le))/Math.PI-90}function ft(Ge,le){for(const we in le)Ge[we]=le[we];return Ge}function lr(Ge){return Ge.x}function st(Ge){return Ge.y}function Se(Ge,le,we,qe){for(var ot,dt=qe,Dt=we-le>>1,Ot=we-le,wt=Ge[le],Ct=Ge[le+1],sr=Ge[we],Rr=Ge[we+1],mr=le+3;mr<we;mr+=3){var Yr=_e(Ge[mr],Ge[mr+1],wt,Ct,sr,Rr);if(Yr>dt)ot=mr,dt=Yr;else if(Yr===dt){var hn=Math.abs(mr-Dt);hn<Ot&&(ot=mr,Ot=hn)}}dt>qe&&(ot-le>3&&Se(Ge,le,ot,qe),Ge[ot+2]=dt,we-ot>3&&Se(Ge,ot,we,qe))}function _e(Ge,le,we,qe,ot,dt){var Dt=ot-we,Ot=dt-qe;if(0!==Dt||0!==Ot){var wt=((Ge-we)*Dt+(le-qe)*Ot)/(Dt*Dt+Ot*Ot);wt>1?(we=ot,qe=dt):wt>0&&(we+=Dt*wt,qe+=Ot*wt)}return(Dt=Ge-we)*Dt+(Ot=le-qe)*Ot}function ve(Ge,le,we,qe){var ot={id:void 0===Ge?null:Ge,type:le,geometry:we,tags:qe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(dt){var Dt=dt.geometry,Ot=dt.type;if("Point"===Ot||"MultiPoint"===Ot||"LineString"===Ot)Je(dt,Dt);else if("Polygon"===Ot||"MultiLineString"===Ot)for(var wt=0;wt<Dt.length;wt++)Je(dt,Dt[wt]);else if("MultiPolygon"===Ot)for(wt=0;wt<Dt.length;wt++)for(var Ct=0;Ct<Dt[wt].length;Ct++)Je(dt,Dt[wt][Ct])}(ot),ot}function Je(Ge,le){for(var we=0;we<le.length;we+=3)Ge.minX=Math.min(Ge.minX,le[we]),Ge.minY=Math.min(Ge.minY,le[we+1]),Ge.maxX=Math.max(Ge.maxX,le[we]),Ge.maxY=Math.max(Ge.maxY,le[we+1])}function St(Ge,le,we,qe){if(le.geometry){var ot=le.geometry.coordinates,dt=le.geometry.type,Dt=Math.pow(we.tolerance/((1<<we.maxZoom)*we.extent),2),Ot=[],wt=le.id;if(we.promoteId?wt=le.properties[we.promoteId]:we.generateId&&(wt=qe||0),"Point"===dt)Xt(ot,Ot);else if("MultiPoint"===dt)for(var Ct=0;Ct<ot.length;Ct++)Xt(ot[Ct],Ot);else if("LineString"===dt)gr(ot,Ot,Dt,!1);else if("MultiLineString"===dt){if(we.lineMetrics){for(Ct=0;Ct<ot.length;Ct++)gr(ot[Ct],Ot=[],Dt,!1),Ge.push(ve(wt,"LineString",Ot,le.properties));return}_r(ot,Ot,Dt,!1)}else if("Polygon"===dt)_r(ot,Ot,Dt,!0);else{if("MultiPolygon"!==dt){if("GeometryCollection"===dt){for(Ct=0;Ct<le.geometry.geometries.length;Ct++)St(Ge,{id:wt,geometry:le.geometry.geometries[Ct],properties:le.properties},we,qe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ct=0;Ct<ot.length;Ct++){var sr=[];_r(ot[Ct],sr,Dt,!0),Ot.push(sr)}}Ge.push(ve(wt,dt,Ot,le.properties))}}function Xt(Ge,le){le.push(rr(Ge[0])),le.push(En(Ge[1])),le.push(0)}function gr(Ge,le,we,qe){for(var ot,dt,Dt=0,Ot=0;Ot<Ge.length;Ot++){var wt=rr(Ge[Ot][0]),Ct=En(Ge[Ot][1]);le.push(wt),le.push(Ct),le.push(0),Ot>0&&(Dt+=qe?(ot*Ct-wt*dt)/2:Math.sqrt(Math.pow(wt-ot,2)+Math.pow(Ct-dt,2))),ot=wt,dt=Ct}var sr=le.length-3;le[2]=1,Se(le,0,sr,we),le[sr+2]=1,le.size=Math.abs(Dt),le.start=0,le.end=le.size}function _r(Ge,le,we,qe){for(var ot=0;ot<Ge.length;ot++){var dt=[];gr(Ge[ot],dt,we,qe),le.push(dt)}}function rr(Ge){return Ge/360+.5}function En(Ge){var le=Math.sin(Ge*Math.PI/180),we=.5-.25*Math.log((1+le)/(1-le))/Math.PI;return we<0?0:we>1?1:we}function un(Ge,le,we,qe,ot,dt,Dt,Ot){if(qe/=le,dt>=(we/=le)&&Dt<qe)return Ge;if(Dt<we||dt>=qe)return null;for(var wt=[],Ct=0;Ct<Ge.length;Ct++){var sr=Ge[Ct],Rr=sr.geometry,mr=sr.type,Yr=0===ot?sr.minX:sr.minY,hn=0===ot?sr.maxX:sr.maxY;if(Yr>=we&&hn<qe)wt.push(sr);else if(!(hn<we||Yr>=qe)){var en=[];if("Point"===mr||"MultiPoint"===mr)Lr(Rr,en,we,qe,ot);else if("LineString"===mr)Cn(Rr,en,we,qe,ot,!1,Ot.lineMetrics);else if("MultiLineString"===mr)Jn(Rr,en,we,qe,ot,!1);else if("Polygon"===mr)Jn(Rr,en,we,qe,ot,!0);else if("MultiPolygon"===mr)for(var Tn=0;Tn<Rr.length;Tn++){var Dn=[];Jn(Rr[Tn],Dn,we,qe,ot,!0),Dn.length&&en.push(Dn)}if(en.length){if(Ot.lineMetrics&&"LineString"===mr){for(Tn=0;Tn<en.length;Tn++)wt.push(ve(sr.id,mr,en[Tn],sr.tags));continue}"LineString"!==mr&&"MultiLineString"!==mr||(1===en.length?(mr="LineString",en=en[0]):mr="MultiLineString"),"Point"!==mr&&"MultiPoint"!==mr||(mr=3===en.length?"Point":"MultiPoint"),wt.push(ve(sr.id,mr,en,sr.tags))}}}return wt.length?wt:null}function Lr(Ge,le,we,qe,ot){for(var dt=0;dt<Ge.length;dt+=3){var Dt=Ge[dt+ot];Dt>=we&&Dt<=qe&&(le.push(Ge[dt]),le.push(Ge[dt+1]),le.push(Ge[dt+2]))}}function Cn(Ge,le,we,qe,ot,dt,Dt){for(var Ot,wt,Ct=ti(Ge),sr=0===ot?di:Qr,Rr=Ge.start,mr=0;mr<Ge.length-3;mr+=3){var Yr=Ge[mr],hn=Ge[mr+1],en=Ge[mr+2],Tn=Ge[mr+3],Dn=Ge[mr+4],xi=0===ot?Yr:hn,jr=0===ot?Tn:Dn,mn=!1;Dt&&(Ot=Math.sqrt(Math.pow(Yr-Tn,2)+Math.pow(hn-Dn,2))),xi<we?jr>we&&(wt=sr(Ct,Yr,hn,Tn,Dn,we),Dt&&(Ct.start=Rr+Ot*wt)):xi>qe?jr<qe&&(wt=sr(Ct,Yr,hn,Tn,Dn,qe),Dt&&(Ct.start=Rr+Ot*wt)):zn(Ct,Yr,hn,en),jr<we&&xi>=we&&(wt=sr(Ct,Yr,hn,Tn,Dn,we),mn=!0),jr>qe&&xi<=qe&&(wt=sr(Ct,Yr,hn,Tn,Dn,qe),mn=!0),!dt&&mn&&(Dt&&(Ct.end=Rr+Ot*wt),le.push(Ct),Ct=ti(Ge)),Dt&&(Rr+=Ot)}var ro=Ge.length-3;Yr=Ge[ro],hn=Ge[ro+1],en=Ge[ro+2],(xi=0===ot?Yr:hn)>=we&&xi<=qe&&zn(Ct,Yr,hn,en),ro=Ct.length-3,dt&&ro>=3&&(Ct[ro]!==Ct[0]||Ct[ro+1]!==Ct[1])&&zn(Ct,Ct[0],Ct[1],Ct[2]),Ct.length&&le.push(Ct)}function ti(Ge){var le=[];return le.size=Ge.size,le.start=Ge.start,le.end=Ge.end,le}function Jn(Ge,le,we,qe,ot,dt){for(var Dt=0;Dt<Ge.length;Dt++)Cn(Ge[Dt],le,we,qe,ot,dt,!1)}function zn(Ge,le,we,qe){Ge.push(le),Ge.push(we),Ge.push(qe)}function di(Ge,le,we,qe,ot,dt){var Dt=(dt-le)/(qe-le);return Ge.push(dt),Ge.push(we+(ot-we)*Dt),Ge.push(1),Dt}function Qr(Ge,le,we,qe,ot,dt){var Dt=(dt-we)/(ot-we);return Ge.push(le+(qe-le)*Dt),Ge.push(dt),Ge.push(1),Dt}function wo(Ge,le){for(var we=[],qe=0;qe<Ge.length;qe++){var ot,dt=Ge[qe],Dt=dt.type;if("Point"===Dt||"MultiPoint"===Dt||"LineString"===Dt)ot=Po(dt.geometry,le);else if("MultiLineString"===Dt||"Polygon"===Dt){ot=[];for(var Ot=0;Ot<dt.geometry.length;Ot++)ot.push(Po(dt.geometry[Ot],le))}else if("MultiPolygon"===Dt)for(ot=[],Ot=0;Ot<dt.geometry.length;Ot++){for(var wt=[],Ct=0;Ct<dt.geometry[Ot].length;Ct++)wt.push(Po(dt.geometry[Ot][Ct],le));ot.push(wt)}we.push(ve(dt.id,Dt,ot,dt.tags))}return we}function Po(Ge,le){var we=[];we.size=Ge.size,void 0!==Ge.start&&(we.start=Ge.start,we.end=Ge.end);for(var qe=0;qe<Ge.length;qe+=3)we.push(Ge[qe]+le,Ge[qe+1],Ge[qe+2]);return we}function is(Ge,le){if(Ge.transformed)return Ge;var we,qe,ot,dt=1<<Ge.z,Dt=Ge.x,Ot=Ge.y;for(we=0;we<Ge.features.length;we++){var wt=Ge.features[we],Ct=wt.geometry,sr=wt.type;if(wt.geometry=[],1===sr)for(qe=0;qe<Ct.length;qe+=2)wt.geometry.push(Xn(Ct[qe],Ct[qe+1],le,dt,Dt,Ot));else for(qe=0;qe<Ct.length;qe++){var Rr=[];for(ot=0;ot<Ct[qe].length;ot+=2)Rr.push(Xn(Ct[qe][ot],Ct[qe][ot+1],le,dt,Dt,Ot));wt.geometry.push(Rr)}}return Ge.transformed=!0,Ge}function Xn(Ge,le,we,qe,ot,dt){return[Math.round(we*(Ge*qe-ot)),Math.round(we*(le*qe-dt))]}function Os(Ge,le,we,qe,ot){for(var dt=le===ot.maxZoom?0:ot.tolerance/((1<<le)*ot.extent),Dt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:we,y:qe,z:le,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ot=0;Ot<Ge.length;Ot++){Dt.numFeatures++,Bn(Dt,Ge[Ot],dt,ot);var wt=Ge[Ot].minX,Ct=Ge[Ot].minY,sr=Ge[Ot].maxX,Rr=Ge[Ot].maxY;wt<Dt.minX&&(Dt.minX=wt),Ct<Dt.minY&&(Dt.minY=Ct),sr>Dt.maxX&&(Dt.maxX=sr),Rr>Dt.maxY&&(Dt.maxY=Rr)}return Dt}function Bn(Ge,le,we,qe){var ot=le.geometry,dt=le.type,Dt=[];if("Point"===dt||"MultiPoint"===dt)for(var Ot=0;Ot<ot.length;Ot+=3)Dt.push(ot[Ot]),Dt.push(ot[Ot+1]),Ge.numPoints++,Ge.numSimplified++;else if("LineString"===dt)Mr(Dt,ot,Ge,we,!1,!1);else if("MultiLineString"===dt||"Polygon"===dt)for(Ot=0;Ot<ot.length;Ot++)Mr(Dt,ot[Ot],Ge,we,"Polygon"===dt,0===Ot);else if("MultiPolygon"===dt)for(var wt=0;wt<ot.length;wt++){var Ct=ot[wt];for(Ot=0;Ot<Ct.length;Ot++)Mr(Dt,Ct[Ot],Ge,we,!0,0===Ot)}if(Dt.length){var sr=le.tags||null;if("LineString"===dt&&qe.lineMetrics){for(var Rr in sr={},le.tags)sr[Rr]=le.tags[Rr];sr.mapbox_clip_start=ot.start/ot.size,sr.mapbox_clip_end=ot.end/ot.size}var mr={geometry:Dt,type:"Polygon"===dt||"MultiPolygon"===dt?3:"LineString"===dt||"MultiLineString"===dt?2:1,tags:sr};null!==le.id&&(mr.id=le.id),Ge.features.push(mr)}}function Mr(Ge,le,we,qe,ot,dt){var Dt=qe*qe;if(qe>0&&le.size<(ot?Dt:qe))we.numPoints+=le.length/3;else{for(var Ot=[],wt=0;wt<le.length;wt+=3)(0===qe||le[wt+2]>Dt)&&(we.numSimplified++,Ot.push(le[wt]),Ot.push(le[wt+1])),we.numPoints++;ot&&function(Ct,sr){for(var Rr=0,mr=0,Yr=Ct.length,hn=Yr-2;mr<Yr;hn=mr,mr+=2)Rr+=(Ct[mr]-Ct[hn])*(Ct[mr+1]+Ct[hn+1]);if(Rr>0===sr)for(mr=0,Yr=Ct.length;mr<Yr/2;mr+=2){var en=Ct[mr],Tn=Ct[mr+1];Ct[mr]=Ct[Yr-2-mr],Ct[mr+1]=Ct[Yr-1-mr],Ct[Yr-2-mr]=en,Ct[Yr-1-mr]=Tn}}(Ot,dt),Ge.push(Ot)}}function Wo(Ge,le){var we=(le=this.options=function(ot,dt){for(var Dt in dt)ot[Dt]=dt[Dt];return ot}(Object.create(this.options),le)).debug;if(we&&console.time("preprocess data"),le.maxZoom<0||le.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(le.promoteId&&le.generateId)throw new Error("promoteId and generateId cannot be used together.");var ot,dt,Dt,Ot,wt,Ct,qe=function(ot,dt){var Dt=[];if("FeatureCollection"===ot.type)for(var Ot=0;Ot<ot.features.length;Ot++)St(Dt,ot.features[Ot],dt,Ot);else St(Dt,"Feature"===ot.type?ot:{geometry:ot},dt);return Dt}(Ge,le);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",le.indexMaxZoom,le.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ot=ot=qe,wt=un(ot,1,-1-(Dt=(dt=le).buffer/dt.extent),Dt,0,-1,2,dt),Ct=un(ot,1,1-Dt,2+Dt,0,-1,2,dt),(wt||Ct)&&(Ot=un(ot,1,-Dt,1+Dt,0,-1,2,dt)||[],wt&&(Ot=wo(wt,1).concat(Ot)),Ct&&(Ot=Ot.concat(wo(Ct,-1)))),(qe=Ot).length&&this.splitTile(qe,0,0,0),we&&(qe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ys(Ge,le,we){return 32*((1<<Ge)*we+le)+Ge}function Sn(Ge,le){const we=Ge.tileID.canonical;if(!this._geoJSONIndex)return le(null,null);const qe=this._geoJSONIndex.getTile(we.z,we.x,we.y);if(!qe)return le(null,null);const ot=new We(qe.features);let dt=H.exports(ot);0===dt.byteOffset&&dt.byteLength===dt.buffer.byteLength||(dt=new Uint8Array(dt)),le(null,{vectorTile:ot,rawData:dt.buffer})}Wo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Wo.prototype.splitTile=function(Ge,le,we,qe,ot,dt,Dt){for(var Ot=[Ge,le,we,qe],wt=this.options,Ct=wt.debug;Ot.length;){qe=Ot.pop(),we=Ot.pop(),le=Ot.pop(),Ge=Ot.pop();var sr=1<<le,Rr=Ys(le,we,qe),mr=this.tiles[Rr];if(!mr&&(Ct>1&&console.time("creation"),mr=this.tiles[Rr]=Os(Ge,le,we,qe,wt),this.tileCoords.push({z:le,x:we,y:qe}),Ct)){Ct>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",le,we,qe,mr.numFeatures,mr.numPoints,mr.numSimplified),console.timeEnd("creation"));var Yr="z"+le;this.stats[Yr]=(this.stats[Yr]||0)+1,this.total++}if(mr.source=Ge,ot){if(le===wt.maxZoom||le===ot)continue;var hn=1<<ot-le;if(we!==Math.floor(dt/hn)||qe!==Math.floor(Dt/hn))continue}else if(le===wt.indexMaxZoom||mr.numPoints<=wt.indexMaxPoints)continue;if(mr.source=null,0!==Ge.length){Ct>1&&console.time("clipping");var en,Tn,Dn,xi,jr,mn,ro=.5*wt.buffer/wt.extent,Ho=.5-ro,Ts=.5+ro,ki=1+ro;en=Tn=Dn=xi=null,jr=un(Ge,sr,we-ro,we+Ts,0,mr.minX,mr.maxX,wt),mn=un(Ge,sr,we+Ho,we+ki,0,mr.minX,mr.maxX,wt),Ge=null,jr&&(en=un(jr,sr,qe-ro,qe+Ts,1,mr.minY,mr.maxY,wt),Tn=un(jr,sr,qe+Ho,qe+ki,1,mr.minY,mr.maxY,wt),jr=null),mn&&(Dn=un(mn,sr,qe-ro,qe+Ts,1,mr.minY,mr.maxY,wt),xi=un(mn,sr,qe+Ho,qe+ki,1,mr.minY,mr.maxY,wt),mn=null),Ct>1&&console.timeEnd("clipping"),Ot.push(en||[],le+1,2*we,2*qe),Ot.push(Tn||[],le+1,2*we,2*qe+1),Ot.push(Dn||[],le+1,2*we+1,2*qe),Ot.push(xi||[],le+1,2*we+1,2*qe+1)}}},Wo.prototype.getTile=function(Ge,le,we){var qe=this.options,ot=qe.extent,dt=qe.debug;if(Ge<0||Ge>24)return null;var Dt=1<<Ge,Ot=Ys(Ge,le=(le%Dt+Dt)%Dt,we);if(this.tiles[Ot])return is(this.tiles[Ot],ot);dt>1&&console.log("drilling down to z%d-%d-%d",Ge,le,we);for(var wt,Ct=Ge,sr=le,Rr=we;!wt&&Ct>0;)Ct--,sr=Math.floor(sr/2),Rr=Math.floor(Rr/2),wt=this.tiles[Ys(Ct,sr,Rr)];return wt&&wt.source?(dt>1&&console.log("found parent tile z%d-%d-%d",Ct,sr,Rr),dt>1&&console.time("drilling down"),this.splitTile(wt.source,Ct,sr,Rr,Ge,le,we),dt>1&&console.timeEnd("drilling down"),this.tiles[Ot]?is(this.tiles[Ot],ot):null):null};class aa extends c.VectorTileWorkerSource{constructor(le,we,qe,ot,dt){super(le,we,qe,ot,Sn),dt&&(this.loadGeoJSON=dt)}loadData(le,we){const qe=le&&le.request,ot=qe&&qe.collectResourceTiming;this.loadGeoJSON(le,(dt,Dt)=>{if(dt||!Dt)return we(dt);if("object"!=typeof Dt)return we(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));{Te(Dt,!0);try{if(le.filter){const wt=c.createExpression(le.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===wt.result)throw new Error(wt.value.map(sr=>`${sr.key}: ${sr.message}`).join(", "));const Ct=Dt.features.filter(sr=>wt.value.evaluate({zoom:0},sr));Dt={type:"FeatureCollection",features:Ct}}this._geoJSONIndex=le.cluster?new Fr(function({superclusterOptions:wt,clusterProperties:Ct}){if(!Ct||!wt)return wt;const sr={},Rr={},mr={accumulated:null,zoom:0},Yr={properties:null},hn=Object.keys(Ct);for(const en of hn){const[Tn,Dn]=Ct[en],xi=c.createExpression(Dn),jr=c.createExpression("string"==typeof Tn?[Tn,["accumulated"],["get",en]]:Tn);sr[en]=xi.value,Rr[en]=jr.value}return wt.map=en=>{Yr.properties=en;const Tn={};for(const Dn of hn)Tn[Dn]=sr[Dn].evaluate(mr,Yr);return Tn},wt.reduce=(en,Tn)=>{Yr.properties=Tn;for(const Dn of hn)mr.accumulated=en[Dn],en[Dn]=Rr[Dn].evaluate(mr,Yr)},wt}(le)).load(Dt.features):new Wo(wt=Dt,le.geojsonVtOptions)}catch(wt){return we(wt)}this.loaded={};const Ot={};if(ot){const wt=c.getPerformanceMeasurement(qe);wt&&(Ot.resourceTiming={},Ot.resourceTiming[le.source]=JSON.parse(JSON.stringify(wt)))}we(null,Ot)}var wt})}reloadTile(le,we){const qe=this.loaded;return qe&&qe[le.uid]?super.reloadTile(le,we):this.loadTile(le,we)}loadGeoJSON(le,we){if(le.request)c.getJSON(le.request,we);else{if("string"!=typeof le.data)return we(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`));try{return we(null,JSON.parse(le.data))}catch{return we(new Error(`Input data given to '${le.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(le,we){try{we(null,this._geoJSONIndex.getClusterExpansionZoom(le.clusterId))}catch(qe){we(qe)}}getClusterChildren(le,we){try{we(null,this._geoJSONIndex.getChildren(le.clusterId))}catch(qe){we(qe)}}getClusterLeaves(le,we){try{we(null,this._geoJSONIndex.getLeaves(le.clusterId,le.limit,le.offset))}catch(qe){we(qe)}}}class Cs{constructor(le){this.self=le,this.actor=new c.Actor(le,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=c.getProjection({name:"mercator"}),this.workerSourceTypes={vector:c.VectorTileWorkerSource,geojson:aa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(we,qe)=>{if(this.workerSourceTypes[we])throw new Error(`Worker source with name "${we}" already registered.`);this.workerSourceTypes[we]=qe},this.self.registerRTLTextPlugin=we=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=we.applyArabicShaping,c.plugin.processBidirectionalText=we.processBidirectionalText,c.plugin.processStyledBidirectionalText=we.processStyledBidirectionalText}}clearCaches(le,we,qe){delete this.layerIndexes[le],delete this.availableImages[le],delete this.workerSources[le],delete this.demWorkerSources[le],qe()}checkIfReady(le,we,qe){qe()}setReferrer(le,we){this.referrer=we}spriteLoaded(le,we){this.isSpriteLoaded[le]=we;for(const qe in this.workerSources[le]){const ot=this.workerSources[le][qe];for(const dt in ot)ot[dt]instanceof c.VectorTileWorkerSource&&(ot[dt].isSpriteLoaded=we,ot[dt].fire(new c.Event("isSpriteLoaded")))}}setImages(le,we,qe){this.availableImages[le]=we;for(const ot in this.workerSources[le]){const dt=this.workerSources[le][ot];for(const Dt in dt)dt[Dt].availableImages=we}qe()}enableTerrain(le,we,qe){this.terrain=we,qe()}setProjection(le,we){this.projections[le]=c.getProjection(we)}setLayers(le,we,qe){this.getLayerIndex(le).replace(we),qe()}updateLayers(le,we,qe){this.getLayerIndex(le).update(we.layers,we.removedIds),qe()}loadTile(le,we,qe){const ot=this.enableTerrain?c.extend({enableTerrain:this.terrain},we):we;ot.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,we.type,we.source).loadTile(ot,qe)}loadDEMTile(le,we,qe){const ot=this.enableTerrain?c.extend({buildQuadTree:this.terrain},we):we;this.getDEMWorkerSource(le,we.source).loadTile(ot,qe)}reloadTile(le,we,qe){const ot=this.enableTerrain?c.extend({enableTerrain:this.terrain},we):we;ot.projection=this.projections[le]||this.defaultProjection,this.getWorkerSource(le,we.type,we.source).reloadTile(ot,qe)}abortTile(le,we,qe){this.getWorkerSource(le,we.type,we.source).abortTile(we,qe)}removeTile(le,we,qe){this.getWorkerSource(le,we.type,we.source).removeTile(we,qe)}removeSource(le,we,qe){if(!this.workerSources[le]||!this.workerSources[le][we.type]||!this.workerSources[le][we.type][we.source])return;const ot=this.workerSources[le][we.type][we.source];delete this.workerSources[le][we.type][we.source],void 0!==ot.removeSource?ot.removeSource(we,qe):qe()}loadWorkerSource(le,we,qe){try{this.self.importScripts(we.url),qe()}catch(ot){qe(ot.toString())}}syncRTLPluginState(le,we,qe){try{c.plugin.setState(we);const ot=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&null!=ot){this.self.importScripts(ot);const dt=c.plugin.isParsed();qe(dt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ot}`),dt)}}catch(ot){qe(ot.toString())}}getAvailableImages(le){let we=this.availableImages[le];return we||(we=[]),we}getLayerIndex(le){let we=this.layerIndexes[le];return we||(we=this.layerIndexes[le]=new be),we}getWorkerSource(le,we,qe){return this.workerSources[le]||(this.workerSources[le]={}),this.workerSources[le][we]||(this.workerSources[le][we]={}),this.workerSources[le][we][qe]||(this.workerSources[le][we][qe]=new this.workerSourceTypes[we]({send:(dt,Dt,Ot,wt,Ct,sr)=>{this.actor.send(dt,Dt,Ot,le,Ct,sr)},scheduler:this.actor.scheduler},this.getLayerIndex(le),this.getAvailableImages(le),this.isSpriteLoaded[le])),this.workerSources[le][we][qe]}getDEMWorkerSource(le,we){return this.demWorkerSources[le]||(this.demWorkerSources[le]={}),this.demWorkerSources[le][we]||(this.demWorkerSources[le][we]=new ye),this.demWorkerSources[le][we]}enforceCacheSizeLimit(le,we){c.enforceCacheSizeLimit(we)}getWorkerPerformanceMetrics(le,we,qe){qe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Cs(self)),Cs}),pe(0,function(c){function Z(g,i){if(Array.isArray(g)){if(!Array.isArray(i)||g.length!==i.length)return!1;for(let h=0;h<g.length;h++)if(!Z(g[h],i[h]))return!1;return!0}if("object"==typeof g&&null!==g&&null!==i){if("object"!=typeof i||Object.keys(g).length!==Object.keys(i).length)return!1;for(const h in g)if(!Z(g[h],i[h]))return!1;return!0}return g===i}var ce=be;function be(g){return i=g,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,E,M=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(M);try{E=new Worker(O),_=!0}catch{_=!1}return E&&E.terminate(),URL.revokeObjectURL(O),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var E=_.getContext("2d");if(!E)return!1;var M=E.getImageData(0,0,1,1);return M&&M.width===_.width}()||(void 0===ye[h=i&&i.failIfMajorPerformanceCaveat]&&(ye[h]=function(_){var E,O,N,B,M=(O=_,N=document.createElement("canvas"),(B=Object.create(be.webGLContextAttributes)).failIfMajorPerformanceCaveat=O,N.getContext("webgl",B)||N.getContext("experimental-webgl",B));if(!M)return!1;try{E=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!E||M.isContextLost())&&(M.shaderSource(E,"void main() {}"),M.compileShader(E),!0===M.getShaderParameter(E,M.COMPILE_STATUS))}(h)),!ye[h]||document.documentMode));var i,h}var ye={};function Te(g,i,h){const _=c.window.document.createElement(g);return void 0!==i&&(_.className=i),h&&h.appendChild(_),_}function $e(g,i,h){const _=c.window.document.createElementNS("http://www.w3.org/2000/svg",g);for(const E of Object.keys(i))_.setAttributeNS(null,E,i[E]);return h&&h.appendChild(_),_}be.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const xe=c.window.document&&c.window.document.documentElement.style,ge=xe&&void 0!==xe.userSelect?"userSelect":"WebkitUserSelect";let Oe;function We(){xe&&ge&&(Oe=xe[ge],xe[ge]="none")}function H(){xe&&ge&&(xe[ge]=Oe)}function q(g){g.preventDefault(),g.stopPropagation(),c.window.removeEventListener("click",q,!0)}function K(){c.window.addEventListener("click",q,!0),c.window.setTimeout(()=>{c.window.removeEventListener("click",q,!0)},0)}function X(g,i){const h=g.getBoundingClientRect();return ne(g,h,i)}function ee(g,i){const h=g.getBoundingClientRect(),_=[];for(let E=0;E<i.length;E++)_.push(ne(g,h,i[E]));return _}function ie(g){return void 0!==c.window.InstallTrigger&&2===g.button&&g.ctrlKey&&c.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:g.button}function ne(g,i,h){const _=g.offsetWidth===i.width?1:g.offsetWidth/i.width;return new c.pointGeometry((h.clientX-i.left)*_,(h.clientY-i.top)*_)}function se(g,i){var h=i[0],_=i[1],E=i[2],M=i[3],O=h*M-E*_;return O?(g[0]=M*(O=1/O),g[1]=-_*O,g[2]=-E*O,g[3]=h*O,g):null}function he(g){const{userImage:i}=g;return!!(i&&i.render&&i.render())&&(g.data.replace(new Uint8Array(i.data.buffer)),!0)}class re extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:h,callback:_}of this.requestors)this._notify(h,_);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,h){this._validate(i,h)&&(this.images[i]=h)}_validate(i,h){let _=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),_=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),_=!1),this._validateContent(h.content,h)||(this.fire(new c.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),_=!1),_}_validateStretch(i,h){if(!i)return!0;let _=0;for(const E of i){if(E[0]<_||E[1]<E[0]||h<E[1])return!1;_=E[1]}return!0}_validateContent(i,h){return!(i&&(4!==i.length||i[0]<0||h.data.width<i[0]||i[1]<0||h.data.height<i[1]||i[2]<0||h.data.width<i[2]||i[3]<0||h.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,h){h.version=this.images[i].version+1,this.images[i]=h,this.updatedImages[i]=!0}removeImage(i){const h=this.images[i];delete this.images[i],delete this.patterns[i],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,h){let _=!0;if(!this.isLoaded())for(const E of i)this.images[E]||(_=!1);this.isLoaded()||_?this._notify(i,h):this.requestors.push({ids:i,callback:h})}_notify(i,h){const _={};for(const E of i){this.images[E]||this.fire(new c.Event("styleimagemissing",{id:E}));const M=this.images[E];M?_[E]={data:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:Boolean(M.userImage&&M.userImage.render)}:c.warnOnce(`Image "${E}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}h(null,_)}getPixelSize(){const{width:i,height:h}=this.atlasImage;return{width:i,height:h}}getPattern(i){const h=this.patterns[i],_=this.getImage(i);if(!_)return null;if(h&&h.position.version===_.version)return h.position;if(h)h.position.version=_.version;else{const E={w:_.data.width+2,h:_.data.height+2,x:0,y:0},M=new c.ImagePosition(E,_);this.patterns[i]={bin:E,position:M}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const h=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.Texture(i,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const M in this.patterns)i.push(this.patterns[M].bin);const{w:h,h:_}=c.potpack(i),E=this.atlasImage;E.resize({width:h||1,height:_||1});for(const M in this.patterns){const{bin:O}=this.patterns[M],N=O.x+1,B=O.y+1,Q=this.images[M].data,J=Q.width,fe=Q.height;c.RGBAImage.copy(Q,E,{x:0,y:0},{x:N,y:B},{width:J,height:fe}),c.RGBAImage.copy(Q,E,{x:0,y:fe-1},{x:N,y:B-1},{width:J,height:1}),c.RGBAImage.copy(Q,E,{x:0,y:0},{x:N,y:B+fe},{width:J,height:1}),c.RGBAImage.copy(Q,E,{x:J-1,y:0},{x:N-1,y:B},{width:1,height:fe}),c.RGBAImage.copy(Q,E,{x:0,y:0},{x:N+J,y:B},{width:1,height:fe})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const h of i){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const _=this.images[h];he(_)&&this.updateImage(h,_)}}}const nt=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(g,i){return function([h,_,E]){const M=c.degToRad(_+90),O=c.degToRad(E);return{x:h*Math.cos(M)*Math.sin(O),y:h*Math.sin(M)*Math.sin(O),z:h*Math.cos(O),azimuthal:_,polar:E}}(g.expression.evaluate(i))}interpolate(g,i,h){return{x:c.number(g.x,i.x,h),y:c.number(g.y,i.y,h),z:c.number(g.z,i.z,h),azimuthal:c.number(g.azimuthal,i.azimuthal,h),polar:c.number(g.polar,i.polar,h)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)}),ze="-transition";class Ze extends c.Evented{constructor(i){super(),this._transitionable=new c.Transitionable(nt),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,h={}){if(!this._validate(c.validateLight,i,h))for(const _ in i){const E=i[_];c.endsWith(_,ze)?this._transitionable.setTransition(_.slice(0,-ze.length),E):this._transitionable.setValue(_,E)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,_){return(!_||!1!==_.validate)&&c.emitValidationErrors(this,i.call(c.validateStyle,c.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}const Ee=new c.Properties({source:new c.DataConstantProperty(c.spec.terrain.source),exaggeration:new c.DataConstantProperty(c.spec.terrain.exaggeration)}),Jt="-transition";class Nt extends c.Evented{constructor(i,h){super(),this._transitionable=new c.Transitionable(Ee),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=h}get(){return this._transitionable.serialize()}set(i){for(const h in i){const _=i[h];c.endsWith(h,Jt)?this._transitionable.setTransition(h.slice(0,-Jt.length),_):this._transitionable.setValue(h,_)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function ke(g,i,h,_){const E=c.smoothstep(45,65,h),[M,O]=xt(g,_),N=c.length(i);let B=1-Math.min(1,Math.exp((N-M)/(O-M)*-6));return B*=B*B,B=Math.min(1,1.00747*B),B*E*g.alpha}function xt(g,i){const h=.5/Math.tan(.5*i);return[g.range[0]+h,g.range[1]+h]}const Ae=new c.Properties({range:new c.DataConstantProperty(c.spec.fog.range),color:new c.DataConstantProperty(c.spec.fog.color),"high-color":new c.DataConstantProperty(c.spec.fog["high-color"]),"space-color":new c.DataConstantProperty(c.spec.fog["space-color"]),"horizon-blend":new c.DataConstantProperty(c.spec.fog["horizon-blend"]),"star-intensity":new c.DataConstantProperty(c.spec.fog["star-intensity"])}),pt="-transition";class bt extends c.Evented{constructor(i,h){super(),this._transitionable=new c.Transitionable(Ae),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=h}get state(){const i=this._transform,h="globe"===i.projection.name,_=c.globeToMercatorTransition(i.zoom),E=this.properties.get("range"),M=[.5,3];return{range:h?[c.number(M[0],E[0],_),c.number(M[1],E[1],_)]:E,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,h={}){if(!this._validate(c.validateFog,i,h)){for(const _ of Object.keys(c.spec.fog))i&&void 0===i[_]&&(i[_]=c.spec.fog[_].default);for(const _ in i){const E=i[_];c.endsWith(_,pt)?this._transitionable.setTransition(_.slice(0,-pt.length),E):this._transitionable.setValue(_,E)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const h=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:c.smoothstep(45,65,i))*h.a}getOpacityAtLatLng(i,h){return this._transform.projection.supportsFog?function(_,E,M){const O=c.MercatorCoordinate.fromLngLat(E),N=M.elevation?M.elevation.getAtPointOrZero(O):0,B=[O.x,O.y,N];return c.transformMat4(B,B,M.mercatorFogMatrix),ke(_,B,M.pitch,M._fov)}(this.state,i,h):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?xt(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,h,_){return(!_||!1!==_.validate)&&c.emitValidationErrors(this,i.call(c.validateStyle,c.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class Ue{constructor(i,h){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const _=this.workerPool.acquire(this.id);for(let E=0;E<_.length;E++){const M=new Ue.Actor(_[E],h,this.id);M.name=`Worker ${E}`,this.actors.push(M)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,h,_){c.asyncAll(this.actors,(E,M)=>{E.send(i,h,M)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Wt(g,i,h){return i*(c.EXTENT/(g.tileSize*Math.pow(2,h-g.tileID.overscaledZ)))}Ue.Actor=c.Actor;class Vt{constructor(i,h,_,E){this.screenBounds=i,this.cameraPoint=h,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,E)}static createFromScreenPoints(i,h){let _,E;if(i instanceof c.pointGeometry||"number"==typeof i[0]){const M=c.pointGeometry.convert(i);_=[M],E=h.isPointAboveHorizon(M)}else{const M=c.pointGeometry.convert(i[0]),O=c.pointGeometry.convert(i[1]);_=[M,O],E=c.polygonizeBounds(M,O).every(N=>h.isPointAboveHorizon(N))}return new Vt(_,h.getCameraPoint(),E,h)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return c.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],E=c.polygonizeBounds(h,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>h.x&&this.cameraPoint.x<_.x?E.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?E[2]=this.cameraPoint:this.cameraPoint.x<=h.x&&(E[3]=this.cameraPoint)),c.bufferConvexPolygon(E,i)}bufferedCameraGeometryGlobe(i){const h=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],E=c.polygonizeBounds(h,_,i),M=this.cameraPoint.clone();switch(3*((M.y>h.y)+(M.y>_.y))+((M.x>h.x)+(M.x>_.x))){case 0:E[0]=M,E[4]=M.clone();break;case 1:E.splice(1,0,M);break;case 2:E[1]=M;break;case 3:E.splice(4,0,M);break;case 5:E.splice(2,0,M);break;case 6:E[3]=M;break;case 7:E.splice(3,0,M);break;case 8:E[2]=M}return E}containsTile(i,h,_,E=0){const M=i.queryPadding/h._pixelsPerMercatorPixel+1,O=_?this._bufferedCameraMercator(M,h):this._bufferedScreenMercator(M,h);let N=i.tileID.wrap+(O.unwrapped?E:0);const B=O.polygon.map(Le=>c.getTilePoint(i.tileTransform,Le,N));if(!c.polygonIntersectsBox(B,0,0,c.EXTENT,c.EXTENT))return;N=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?E:0);const Q=this.screenGeometryMercator.polygon.map(Le=>c.getTileVec3(i.tileTransform,Le,N)),J=Q.map(Le=>new c.pointGeometry(Le[0],Le[1])),fe=h.getFreeCameraOptions().position||new c.MercatorCoordinate(0,0,0),Ie=c.getTileVec3(i.tileTransform,fe,N),je=Q.map(Le=>{const De=c.sub(Le,Le,Ie);return c.normalize(De,De),new c.Ray(Ie,De)}),Be=Wt(i,1,h.zoom)*h._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:J,tilespaceRays:je,bufferedTilespaceGeometry:B,bufferedTilespaceBounds:(Ve=c.getBounds(B),Ve.min.x=c.clamp(Ve.min.x,0,c.EXTENT),Ve.min.y=c.clamp(Ve.min.y,0,c.EXTENT),Ve.max.x=c.clamp(Ve.max.x,0,c.EXTENT),Ve.max.y=c.clamp(Ve.max.y,0,c.EXTENT),Ve),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:Be};var Ve}_bufferedScreenMercator(i,h){const _=Ur(i);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let E;return E="globe"===h.projection.name?this._projectAndResample(this.bufferedScreenGeometry(i),h):{polygon:this.bufferedScreenGeometry(i).map(M=>h.pointCoordinate3D(M)),unwrapped:!0},this._screenRaycastCache[_]=E,E}}_bufferedCameraMercator(i,h){const _=Ur(i);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let E;return E="globe"===h.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),h):{polygon:this.bufferedCameraGeometry(i).map(M=>h.pointCoordinate3D(M)),unwrapped:!0},this._cameraRaycastCache[_]=E,E}}_projectAndResample(i,h){const _=function(M,O){const N=c.multiply([],O.pixelMatrix,O.globeMatrix),B=[0,-c.GLOBE_RADIUS,0,1],Q=[0,c.GLOBE_RADIUS,0,1],J=[0,0,0,1];c.transformMat4$1(B,B,N),c.transformMat4$1(Q,Q,N),c.transformMat4$1(J,J,N);const fe=new c.pointGeometry(B[0]/B[3],B[1]/B[3]),Ie=new c.pointGeometry(Q[0]/Q[3],Q[1]/Q[3]),je=c.polygonContainsPoint(M,fe)&&B[3]<J[3],Be=c.polygonContainsPoint(M,Ie)&&Q[3]<J[3];if(!je&&!Be)return null;const Ve=function(It,Ht,jt){for(let Rt=1;Rt<It.length;Rt++){const Dr=Ft(Ht.pointCoordinate3D(It[Rt-1]).x),Ut=Ft(Ht.pointCoordinate3D(It[Rt]).x);if(jt<0){if(Dr<Ut)return{idx:Rt,t:-Dr/(Ut-1-Dr)}}else if(Ut<Dr)return{idx:Rt,t:(1-Dr)/(Ut+1-Dr)}}return null}(M,O,je?-1:1);if(!Ve)return null;const{idx:Le,t:De}=Ve;let He=Le>1?Cr(M.slice(0,Le),O):[],Xe=Le<M.length?Cr(M.slice(Le),O):[];He=He.map(It=>new c.pointGeometry(Ft(It.x),It.y)),Xe=Xe.map(It=>new c.pointGeometry(Ft(It.x),It.y));const at=[...He];0===at.length&&at.push(Xe[Xe.length-1]);const _t=c.number(at[at.length-1].y,(0===Xe.length?He[0]:Xe[0]).y,De);let mt;return mt=je?[new c.pointGeometry(0,_t),new c.pointGeometry(0,0),new c.pointGeometry(1,0),new c.pointGeometry(1,_t)]:[new c.pointGeometry(1,_t),new c.pointGeometry(1,1),new c.pointGeometry(0,1),new c.pointGeometry(0,_t)],at.push(...mt),0===Xe.length?at.push(He[0]):at.push(...Xe),{polygon:at.map(It=>new c.MercatorCoordinate(It.x,It.y)),unwrapped:!1}}(i,h);if(_)return _;const E=function(M,O){let N=!1,B=-1/0,Q=0;for(let fe=0;fe<M.length-1;fe++)M[fe].x>B&&(B=M[fe].x,Q=fe);for(let fe=0;fe<M.length-1;fe++){const Ie=(Q+fe)%(M.length-1),je=M[Ie],Be=M[Ie+1];Math.abs(je.x-Be.x)>.5&&(je.x<Be.x?(je.x+=1,0===Ie&&(M[M.length-1].x+=1)):(Be.x+=1,Ie+1===M.length-1&&(M[0].x+=1)),N=!0)}const J=c.mercatorXfromLng(O.center.lng);return N&&J<Math.abs(J-1)&&M.forEach(fe=>{fe.x-=1}),{polygon:M,unwrapped:N}}(Cr(i,h).map(M=>new c.pointGeometry(Ft(M.x),M.y)),h);return{polygon:E.polygon.map(M=>new c.MercatorCoordinate(M.x,M.y)),unwrapped:E.unwrapped}}}function Cr(g,i){return c.resample(g,h=>{const _=i.pointCoordinate3D(h);h.x=_.x,h.y=_.y},1/256)}function Ft(g){return g<0?1+g%1:g%1}function Ur(g){return 100*g|0}function Fr(g,i,h,_,E){const M=function(O,N){if(O)return E(O);if(N){g.url&&N.tiles&&g.tiles&&delete g.tiles;const B=c.pick(c.extend(N,g),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);N.vector_layers&&(B.vectorLayers=N.vector_layers,B.vectorLayerIds=B.vectorLayers.map(Q=>Q.id)),B.tiles=i.canonicalizeTileset(B,g.url),E(null,B)}};return g.url?c.getJSON(i.transformRequest(i.normalizeSourceURL(g.url,null,h,_),c.ResourceType.Source),M):c.exported.frame(()=>M(null,g))}class zr{constructor(i,h,_){this.bounds=c.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=h||0,this.maxzoom=_||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const h=Math.pow(2,i.z),_=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*h),E=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*h),M=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*h),O=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*h);return i.x>=_&&i.x<M&&i.y>=E&&i.y<O}}class rn{constructor(i,h,_){this.context=i;const E=i.gl;this.buffer=E.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),E.bufferData(E.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?E.DYNAMIC_DRAW:E.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const h=this.context.gl;this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ar={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class xr{constructor(i,h,_,E){this.length=h.length,this.attributes=_,this.itemSize=h.bytesPerElement,this.dynamicDraw=E,this.context=i;const M=i.gl;this.buffer=M.createBuffer(),i.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||h.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,h){for(let _=0;_<this.attributes.length;_++){const E=h.attributes[this.attributes[_].name];void 0!==E&&i.enableVertexAttribArray(E)}}setVertexAttribPointers(i,h,_){for(let E=0;E<this.attributes.length;E++){const M=this.attributes[E],O=h.attributes[M.name];void 0!==O&&i.vertexAttribPointer(O,M.components,i[Ar[M.type]],!1,this.itemSize,M.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class cn{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class qn extends cn{getDefault(){return c.Color.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class yi extends cn{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class ft extends cn{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class lr extends cn{getDefault(){return[!0,!0,!0,!0]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class st extends cn{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Se extends cn{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class _e extends cn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const h=this.current;(i.func!==h.func||i.ref!==h.ref||i.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class ve extends cn{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Je extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=i,this.dirty=!1}}class St extends cn{getDefault(){return[0,1]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Xt extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=i,this.dirty=!1}}class gr extends cn{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class _r extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.BLEND):h.disable(h.BLEND),this.current=i,this.dirty=!1}}class rr extends cn{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class En extends cn{getDefault(){return c.Color.transparent}set(i){const h=this.current;(i.r!==h.r||i.g!==h.g||i.b!==h.b||i.a!==h.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class un extends cn{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Lr extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;i?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=i,this.dirty=!1}}class Cn extends cn{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class ti extends cn{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Jn extends cn{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class zn extends cn{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class di extends cn{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const h=this.current;(i[0]!==h[0]||i[1]!==h[1]||i[2]!==h[2]||i[3]!==h[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Qr extends cn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class wo extends cn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Po extends cn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class is extends cn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Xn extends cn{getDefault(){return null}set(i){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Os extends cn{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class Bn extends cn{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Mr extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Wo extends cn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Ys extends cn{constructor(i,h){super(i),this.context=i,this.parent=h}getDefault(){return null}}class Sn extends Ys{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class aa extends Ys{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,this.attachment(),h.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Cs extends aa{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ge{constructor(i,h,_,E){this.context=i,this.width=h,this.height=_;const M=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new Sn(i,M),E&&(this.depthAttachment=new aa(i,M))}destroy(){const i=this.context.gl,h=this.colorAttachment.get();if(h&&i.deleteTexture(h),this.depthAttachment){const _=this.depthAttachment.get();_&&i.deleteRenderbuffer(_)}i.deleteFramebuffer(this.framebuffer)}}class le{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new qn(this),this.clearDepth=new yi(this),this.clearStencil=new ft(this),this.colorMask=new lr(this),this.depthMask=new st(this),this.stencilMask=new Se(this),this.stencilFunc=new _e(this),this.stencilOp=new ve(this),this.stencilTest=new Je(this),this.depthRange=new St(this),this.depthTest=new Xt(this),this.depthFunc=new gr(this),this.blend=new _r(this),this.blendFunc=new rr(this),this.blendColor=new En(this),this.blendEquation=new un(this),this.cullFace=new Lr(this),this.cullFaceSide=new Cn(this),this.frontFace=new ti(this),this.program=new Jn(this),this.activeTexture=new zn(this),this.viewport=new di(this),this.bindFramebuffer=new Qr(this),this.bindRenderbuffer=new wo(this),this.bindTexture=new Po(this),this.bindVertexBuffer=new is(this),this.bindElementBuffer=new Xn(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Os(this),this.pixelStoreUnpack=new Bn(this),this.pixelStoreUnpackPremultiplyAlpha=new Mr(this),this.pixelStoreUnpackFlipY=new Wo(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,h){return new rn(this,i,h)}createVertexBuffer(i,h,_){return new xr(this,i,h,_)}createRenderbuffer(i,h,_){const E=this.gl,M=E.createRenderbuffer();return this.bindRenderbuffer.set(M),E.renderbufferStorage(E.RENDERBUFFER,i,h,_),this.bindRenderbuffer.set(null),M}createFramebuffer(i,h,_){return new Ge(this,i,h,_)}clear({color:i,depth:h,stencil:_}){const E=this.gl;let M=0;i&&(M|=E.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==h&&(M|=E.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),void 0!==_&&(M|=E.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),E.clear(M)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){Z(i.blendFunction,c.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class we extends c.Evented{constructor(i,h,_,E){super(),this.id=i,this.dispatcher=_,this.setEventedParent(E),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},h),c.extend(this,c.pick(h,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Fr(this._options,this.map._requestManager,null,null,(i,h)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new c.ErrorEvent(i)):h&&(c.extend(this,h),h.bounds&&(this.tileBounds=new zr(h.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(h.tiles),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return c.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,h){const _=c.exported.devicePixelRatio>=2,E=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);i.request=c.getImage(this.map._requestManager.transformRequest(E,c.ResourceType.Tile),(M,O,N,B)=>(delete i.request,i.aborted?(i.state="unloaded",h(null)):M?(i.state="errored",h(M)):O?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:N,expires:B}),i.setTexture(O,this.map.painter),i.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),void h(null)):h(null)))}static loadTileData(i,h,_){i.setTexture(h,_)}static unloadTileData(i,h){i.texture&&h.saveTileTexture(i.texture)}abortTile(i,h){i.request&&(i.request.cancel(),delete i.request),h()}unloadTile(i,h){i.texture&&this.map.painter.saveTileTexture(i.texture),h()}hasTransition(){return!1}}let qe;function ot(g,i,h,_,E,M,O,N){const B=[g,h,E,i,_,M,1,1,1],Q=[O,N,1],J=c.adjoint([],B),[fe,Ie,je]=c.transformMat3(Q,Q,c.transpose(J,J));return c.multiply$1(B,[fe,0,0,0,Ie,0,0,0,je],B)}class dt extends c.Evented{constructor(i,h,_,E){super(),this.id=i,this.dispatcher=_,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(E),this.options=h,this._dirty=!1}load(i,h){this._loaded=h||!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(_,E)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new c.ErrorEvent(_));else if(E){const{HTMLImageElement:M}=c.window;this.image=E instanceof M?c.exported.getImageData(E):E,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const h=i.map(c.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let E=1/0,M=1/0,O=-1/0,N=-1/0;for(const fe of _)E=Math.min(E,fe.x),M=Math.min(M,fe.y),O=Math.max(O,fe.x),N=Math.max(N,fe.y);const B=Math.max(O-E,N-M),Q=Math.max(0,Math.floor(-Math.log(B)/Math.LN2)),J=Math.pow(2,Q);return new c.CanonicalTileID(Q,Math.floor((E+O)/2*J),Math.floor((M+N)/2*J))}(h),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const B in this.tiles){const Q=this.tiles[B];"loaded"!==Q.state&&(Q.state="loaded",Q.texture=this.texture)}if(this._boundsArray)return;const h=c.tileTransform(this.tileID,this.map.transform.projection),[_,E,M,O]=this.coordinates.map(B=>{const Q=h.projection.project(B[0],B[1]);return c.getTilePoint(h,Q)._round()});this.perspectiveTransform=function(B,Q,J,fe,Ie,je,Be,Ve,Le,De){const He=ot(0,0,B,0,0,Q,B,Q),Xe=ot(J,fe,Ie,je,Be,Ve,Le,De);return c.multiply$1(Xe,c.adjoint(He,He),Xe),[Xe[6]/Xe[8]*B/c.EXTENT,Xe[7]/Xe[8]*Q/c.EXTENT]}(this.width,this.height,_.x,_.y,E.x,E.y,O.x,O.y,M.x,M.y);const N=this._boundsArray=new c.StructArrayLayout4i8;N.emplaceBack(_.x,_.y,0,0),N.emplaceBack(E.x,E.y,c.EXTENT,0),N.emplaceBack(O.x,O.y,0,c.EXTENT),N.emplaceBack(M.x,M.y,c.EXTENT,c.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(N,c.boundsAttributes.members),this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,h=i.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new c.Texture(i,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(i)}loadTile(i,h){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},h(null)):(i.state="errored",h(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Dt={vector:class extends c.Evented{constructor(g,i,h,_){if(super(),this.id=g,this.dispatcher=h,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(i,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new c.DedupedRequest}load(g){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,h=this.map._worldview;this._tileJSONRequest=Fr(this._options,this.map._requestManager,i,h,(_,E)=>{this._tileJSONRequest=null,this._loaded=!0,_?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),h&&2!==h.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${h}`),this.fire(new c.ErrorEvent(_))):E&&(c.extend(this,E),E.bounds&&(this.tileBounds=new zr(E.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(E.tiles,this.map._requestManager._customAccessToken),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),g&&g(_)})}loaded(){return this._loaded}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}onAdd(g){this.map=g,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const g=this.map.style._getSourceCaches(this.id);for(const i of g)i.clearTiles()})}setSourceProperty(g){g(),this.reload()}setTiles(g){return this._options.tiles=g,this.reload(),this}setUrl(g){return this.url=g,this._options.url=g,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return c.extend({},this._options)}loadTile(g,i){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),_={request:this.map._requestManager.transformRequest(h,c.ResourceType.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:g.isSymbolTile};if(_.request.collectResourceTiming=this._collectResourceTiming,g.actor&&"expired"!==g.state)"loading"===g.state?g.reloadCallback=i:g.request=g.actor.send("reloadTile",_,E.bind(this));else if(g.actor=this._tileWorkers[h]=this._tileWorkers[h]||this.dispatcher.getActor(),this.dispatcher.ready)g.request=g.actor.send("loadTile",_,E.bind(this),void 0,!0);else{const M=c.loadVectorTile.call({deduped:this._deduped},_,(O,N)=>{O||!N?E.call(this,O):(_.data={cacheControl:N.cacheControl,expires:N.expires,rawData:N.rawData.slice(0)},g.actor&&g.actor.send("loadTile",_,E.bind(this),void 0,!0))},!0);g.request={cancel:M}}function E(M,O){return delete g.request,g.aborted?i(null):M&&404!==M.status?i(M):(O&&O.resourceTiming&&(g.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&g.setExpiryData(O),g.loadVectorData(O,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(g.reloadCallback&&(this.loadTile(g,g.reloadCallback),g.reloadCallback=null)))}}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.actor&&g.actor.send("abortTile",{uid:g.uid,type:this.type,source:this.id})}unloadTile(g){g.unloadVectorData(),g.actor&&g.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:we,"raster-dem":class extends we{constructor(g,i,h,_){super(g,i,h,_),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(g,i){const h=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(E,M){E&&(g.state="errored",i(E)),M&&(g.dem=M,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",i(null))}g.request=c.getImage(this.map._requestManager.transformRequest(h,c.ResourceType.Tile),function(E,M,O,N){if(delete g.request,g.aborted)g.state="unloaded",i(null);else if(E)g.state="errored",i(E);else if(M){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:O,expires:N});const B=c.window.ImageBitmap&&M instanceof c.window.ImageBitmap&&(null==qe&&(qe=c.window.OffscreenCanvas&&new c.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof c.window.createImageBitmap),qe),Q=1-(M.width-c.prevPowerOfTwo(M.width))/2;Q<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const J=B?M:c.exported.getImageData(M,Q),fe={uid:g.uid,coord:g.tileID,source:this.id,rawImageData:J,encoding:this.encoding,padding:Q};g.actor&&"expired"!==g.state||(g.actor=this.dispatcher.getActor(),g.actor.send("loadDEMTile",fe,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(g){const i=g.canonical,h=Math.pow(2,i.z),_=(i.x-1+h)%h,E=0===i.x?g.wrap-1:g.wrap,M=(i.x+1+h)%h,O=i.x+1===h?g.wrap+1:g.wrap,N={};return N[new c.OverscaledTileID(g.overscaledZ,E,i.z,_,i.y).key]={backfilled:!1},N[new c.OverscaledTileID(g.overscaledZ,O,i.z,M,i.y).key]={backfilled:!1},i.y>0&&(N[new c.OverscaledTileID(g.overscaledZ,E,i.z,_,i.y-1).key]={backfilled:!1},N[new c.OverscaledTileID(g.overscaledZ,g.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},N[new c.OverscaledTileID(g.overscaledZ,O,i.z,M,i.y-1).key]={backfilled:!1}),i.y+1<h&&(N[new c.OverscaledTileID(g.overscaledZ,E,i.z,_,i.y+1).key]={backfilled:!1},N[new c.OverscaledTileID(g.overscaledZ,g.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},N[new c.OverscaledTileID(g.overscaledZ,O,i.z,M,i.y+1).key]={backfilled:!1}),N}unloadTile(g){g.demTexture&&this.map.painter.saveTileTexture(g.demTexture),g.fbo&&(g.fbo.destroy(),delete g.fbo),g.dem&&delete g.dem,delete g.neighboringTiles,g.state="unloaded"}},geojson:class extends c.Evented{constructor(g,i,h,_){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=h.getActor(),this.setEventedParent(_),this._data=i.data,this._options=c.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const E=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*E,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*E,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:c.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*E,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}getClusterExpansionZoom(g,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id},i),this}getClusterChildren(g,i){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id},i),this}getClusterLeaves(g,i,h,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:g,limit:i,offset:h},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.Event("dataloading",{dataType:"source"})),this._loaded=!1;const g=c.extend({},this.workerOptions),i=this._data;"string"==typeof i?(g.request=this.map._requestManager.transformRequest(c.exported.resolveURL(i),c.ResourceType.Source),g.request.collectResourceTiming=this._collectResourceTiming):g.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,g,(h,_)=>{if(this._loaded=!0,this._pendingLoad=null,h)this.fire(new c.ErrorEvent(h));else{const E={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(E.resourceTiming=_.resourceTiming[this.id]),this.fire(new c.Event("data",E)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(g,i){const h=g.actor?"reloadTile":"loadTile";g.actor=this.actor,g.request=this.actor.send(h,{type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,E)=>(delete g.request,g.unloadVectorData(),g.aborted?i(null):_?i(_):(g.loadVectorData(E,this.map.painter,"reloadTile"===h),i(null))),void 0,"loadTile"===h)}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g){g.unloadVectorData(),this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends dt{constructor(g,i,h,_){super(g,i,h,_),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const i of g.urls)this.urls.push(this.map._requestManager.transformRequest(i,c.ResourceType.Source).url);c.getVideo(this.urls,(i,h)=>{this._loaded=!0,i?this.fire(new c.ErrorEvent(i)):h&&(this.video=h,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const i=this.video.seekable;g<i.start(0)||g>i.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const g=this.map.painter.context,i=g.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new c.Texture(g,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:dt,canvas:class extends dt{constructor(g,i,h,_){super(g,i,h,_),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(E=>!Array.isArray(E)||2!==E.length||E.some(M=>"number"!=typeof M))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${g}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof c.window.HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${g}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof c.window.HTMLCanvasElement?this.options.canvas:c.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(g||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends c.Evented{constructor(g,i,h,_){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=h,this._implementation=i,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new zr(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),c.extend(this,c.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this._map=g,this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:i,y:h,z:_}=g.canonical;return this._implementation.hasTile({x:i,y:h,z:_})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,i){const{x:h,y:_,z:E}=g.tileID.canonical,M=new c.window.AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:h,y:_,z:E},{signal:M.signal})).then(function(O){return delete g.request,g.aborted?(g.state="unloaded",i(null)):void 0===O?(g.state="errored",i(null)):null===O?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",i(null)):(N=O)instanceof c.window.ImageData||N instanceof c.window.HTMLCanvasElement||N instanceof c.window.ImageBitmap||N instanceof c.window.HTMLImageElement?(this.loadTileData(g,O),g.state="loaded",void i(null)):(g.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var N}.bind(this)).catch(O=>{20!==O.code&&(g.state="errored",i(O))}),g.request.cancel=()=>M.abort()}loadTileData(g,i){we.loadTileData(g,i,this._map.painter)}unloadTileData(g){we.unloadTileData(g,this._map.painter)}unloadTile(g,i){if(this.unloadTileData(g),this._implementation.unloadTile){const{x:h,y:_,z:E}=g.tileID.canonical;this._implementation.unloadTile({x:h,y:_,z:E})}i()}abortTile(g,i){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ot=function(g,i,h,_){const E=new Dt[i.type](g,i,h,_);if(E.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${E.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],E),E};function wt(g,i){const h=c.identity([]);return c.scale(h,h,[.5*g.width,.5*-g.height,1]),c.translate(h,h,[1,-1,0]),c.multiply(h,h,g.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(h)}function Ct(g,i,h,_,E,M,O,N=!1){const B=g.tilesIn(_,O,N);B.sort(Rr);const Q=[];for(const fe of B)Q.push({wrappedTileID:fe.tile.tileID.wrapped().key,queryResults:fe.tile.queryRenderedFeatures(i,h,g._state,fe,E,M,wt(g.transform,fe.tile.tileID),N)});const J=function(fe){const Ie={},je={};for(const Be of fe){const Ve=Be.queryResults,Le=Be.wrappedTileID,De=je[Le]=je[Le]||{};for(const He in Ve){const Xe=Ve[He],at=De[He]=De[He]||{},_t=Ie[He]=Ie[He]||[];for(const mt of Xe)at[mt.featureIndex]||(at[mt.featureIndex]=!0,_t.push(mt))}}return Ie}(Q);for(const fe in J)J[fe].forEach(Ie=>{const je=Ie.feature,Be=je.layer;Be&&"background"!==Be.type&&"sky"!==Be.type&&(je.source=Be.source,Be["source-layer"]&&(je.sourceLayer=Be["source-layer"]),je.state=void 0!==je.id?g.getFeatureState(Be["source-layer"],je.id):{})});return J}function sr(g,i){const h=g.getRenderableIds().map(M=>g.getTileByID(M)),_=[],E={};for(let M=0;M<h.length;M++){const O=h[M],N=O.tileID.canonical.key;E[N]||(E[N]=!0,O.querySourceFeatures(_,i))}return _}function Rr(g,i){const h=g.tileID,_=i.tileID;return h.overscaledZ-_.overscaledZ||h.canonical.y-_.canonical.y||h.wrap-_.wrap||h.canonical.x-_.canonical.x}function mr(){return null!=dc.workerClass?new dc.workerClass:new c.window.Worker(dc.workerUrl)}const Yr="mapboxgl_preloaded_worker_pool";class hn{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<hn.workerCount;)this.workers.push(new mr);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Yr]}numActive(){return Object.keys(this.active).length}}let en;function Tn(){return en||(en=new hn),en}function Dn(g,i){const h={};for(const _ in g)"ref"!==_&&(h[_]=g[_]);return c.refProperties.forEach(_=>{_ in i&&(h[_]=i[_])}),h}function xi(g){g=g.slice();const i=Object.create(null);for(let h=0;h<g.length;h++)i[g[h].id]=g[h];for(let h=0;h<g.length;h++)"ref"in g[h]&&(g[h]=Dn(g[h],i[g[h].ref]));return g}hn.workerCount=2;const jr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function mn(g,i,h){h.push({command:jr.addSource,args:[g,i[g]]})}function ro(g,i,h){i.push({command:jr.removeSource,args:[g]}),h[g]=!0}function Ho(g,i,h,_){ro(g,h,_),mn(g,i,h)}function Ts(g,i,h){let _;for(_ in g[h])if(g[h].hasOwnProperty(_)&&"data"!==_&&!Z(g[h][_],i[h][_]))return!1;for(_ in i[h])if(i[h].hasOwnProperty(_)&&"data"!==_&&!Z(g[h][_],i[h][_]))return!1;return!0}function ki(g,i,h,_,E,M){let O;for(O in i=i||{},g=g||{})g.hasOwnProperty(O)&&(Z(g[O],i[O])||h.push({command:M,args:[_,O,i[O],E]}));for(O in i)i.hasOwnProperty(O)&&!g.hasOwnProperty(O)&&(Z(g[O],i[O])||h.push({command:M,args:[_,O,i[O],E]}))}function ur(g){return g.id}function hs(g,i){return g[i.id]=i,g}class Kn{constructor(i,h){this.reset(i,h)}reset(i,h){this.points=i||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=c.clamp(i,0,1);let h=1,_=this._distances[h];const E=i*this.paddedLength+this.padding;for(;_<E&&h<this._distances.length;)_=this._distances[++h];const M=h-1,O=this._distances[M],N=_-O,B=N>0?(E-O)/N:0;return this.points[M].mult(1-B).add(this.points[h].mult(B))}}class Jo{constructor(i,h,_){const E=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(i/_),this.yCellCount=Math.ceil(h/_);for(let O=0;O<this.xCellCount*this.yCellCount;O++)E.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=h,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,h,_,E,M){this._forEachCell(h,_,E,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(h),this.bboxes.push(_),this.bboxes.push(E),this.bboxes.push(M)}insertCircle(i,h,_,E){this._forEachCell(h-E,_-E,h+E,_+E,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(h),this.circles.push(_),this.circles.push(E)}_insertBoxCell(i,h,_,E,M,O){this.boxCells[M].push(O)}_insertCircleCell(i,h,_,E,M,O){this.circleCells[M].push(O)}_query(i,h,_,E,M,O){if(_<0||i>this.width||E<0||h>this.height)return!M&&[];const N=[];if(i<=0&&h<=0&&this.width<=_&&this.height<=E){if(M)return!0;for(let B=0;B<this.boxKeys.length;B++)N.push({key:this.boxKeys[B],x1:this.bboxes[4*B],y1:this.bboxes[4*B+1],x2:this.bboxes[4*B+2],y2:this.bboxes[4*B+3]});for(let B=0;B<this.circleKeys.length;B++){const Q=this.circles[3*B],J=this.circles[3*B+1],fe=this.circles[3*B+2];N.push({key:this.circleKeys[B],x1:Q-fe,y1:J-fe,x2:Q+fe,y2:J+fe})}return O?N.filter(O):N}return this._forEachCell(i,h,_,E,this._queryCell,N,{hitTest:M,seenUids:{box:{},circle:{}}},O),M?N.length>0:N}_queryCircle(i,h,_,E,M){const O=i-_,N=i+_,B=h-_,Q=h+_;if(N<0||O>this.width||Q<0||B>this.height)return!E&&[];const J=[];return this._forEachCell(O,B,N,Q,this._queryCellCircle,J,{hitTest:E,circle:{x:i,y:h,radius:_},seenUids:{box:{},circle:{}}},M),E?J.length>0:J}query(i,h,_,E,M){return this._query(i,h,_,E,!1,M)}hitTest(i,h,_,E,M){return this._query(i,h,_,E,!0,M)}hitTestCircle(i,h,_,E){return this._queryCircle(i,h,_,!0,E)}_queryCell(i,h,_,E,M,O,N,B){const Q=N.seenUids,J=this.boxCells[M];if(null!==J){const Ie=this.bboxes;for(const je of J)if(!Q.box[je]){Q.box[je]=!0;const Be=4*je;if(i<=Ie[Be+2]&&h<=Ie[Be+3]&&_>=Ie[Be+0]&&E>=Ie[Be+1]&&(!B||B(this.boxKeys[je]))){if(N.hitTest)return O.push(!0),!0;O.push({key:this.boxKeys[je],x1:Ie[Be],y1:Ie[Be+1],x2:Ie[Be+2],y2:Ie[Be+3]})}}}const fe=this.circleCells[M];if(null!==fe){const Ie=this.circles;for(const je of fe)if(!Q.circle[je]){Q.circle[je]=!0;const Be=3*je;if(this._circleAndRectCollide(Ie[Be],Ie[Be+1],Ie[Be+2],i,h,_,E)&&(!B||B(this.circleKeys[je]))){if(N.hitTest)return O.push(!0),!0;{const Ve=Ie[Be],Le=Ie[Be+1],De=Ie[Be+2];O.push({key:this.circleKeys[je],x1:Ve-De,y1:Le-De,x2:Ve+De,y2:Le+De})}}}}}_queryCellCircle(i,h,_,E,M,O,N,B){const Q=N.circle,J=N.seenUids,fe=this.boxCells[M];if(null!==fe){const je=this.bboxes;for(const Be of fe)if(!J.box[Be]){J.box[Be]=!0;const Ve=4*Be;if(this._circleAndRectCollide(Q.x,Q.y,Q.radius,je[Ve+0],je[Ve+1],je[Ve+2],je[Ve+3])&&(!B||B(this.boxKeys[Be])))return O.push(!0),!0}}const Ie=this.circleCells[M];if(null!==Ie){const je=this.circles;for(const Be of Ie)if(!J.circle[Be]){J.circle[Be]=!0;const Ve=3*Be;if(this._circlesCollide(je[Ve],je[Ve+1],je[Ve+2],Q.x,Q.y,Q.radius)&&(!B||B(this.circleKeys[Be])))return O.push(!0),!0}}}_forEachCell(i,h,_,E,M,O,N,B){const Q=this._convertToXCellCoord(i),J=this._convertToYCellCoord(h),fe=this._convertToXCellCoord(_),Ie=this._convertToYCellCoord(E);for(let je=Q;je<=fe;je++)for(let Be=J;Be<=Ie;Be++)if(M.call(this,i,h,_,E,this.xCellCount*Be+je,O,N,B))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,h,_,E,M,O){const N=E-i,B=M-h,Q=_+O;return Q*Q>N*N+B*B}_circleAndRectCollide(i,h,_,E,M,O,N){const B=(O-E)/2,Q=Math.abs(i-(E+B));if(Q>B+_)return!1;const J=(N-M)/2,fe=Math.abs(h-(M+J));if(fe>J+_)return!1;if(Q<=B||fe<=J)return!0;const Ie=Q-B,je=fe-J;return Ie*Ie+je*je<=_*_}}const Ou=Math.tan(85*Math.PI/180);function Ko(g,i,h,_,E,M,O){const N=c.create();if(h)if("globe"===M.name){const B=c.calculateGlobeLabelMatrix(E,i);c.multiply(N,N,B)}else{const B=se([],O);N[0]=B[0],N[1]=B[1],N[4]=B[2],N[5]=B[3],_||c.rotateZ(N,N,E.angle)}else c.multiply(N,E.labelPlaneMatrix,g);return N}function ks(g,i,h,_,E,M,O){const N=Ko(g,i,h,_,E,M,O);return"globe"===M.name&&h||(N[2]=N[6]=N[10]=N[14]=0),N}function Pl(g,i,h,_,E,M,O){if(h){if("globe"===M.name){const N=Ko(g,i,h,_,E,M,O);return c.invert(N,N),c.multiply(N,g,N),N}{const N=c.clone(g),B=c.identity([]);return B[0]=O[0],B[1]=O[1],B[4]=O[2],B[5]=O[3],c.multiply(N,N,B),_||c.rotateZ(N,N,-E.angle),N}}return E.glCoordMatrix}function oi(g,i,h,_){const E=[g,i,h,1];h?c.transformMat4$1(E,E,_):Eo(E,E,_);const M=E[3];return E[0]/=M,E[1]/=M,E[2]/=M,E}function Nr(g,i){return Math.min(.5+g/i*.5,1.5)}function Vn(g,i){const h=g[0]/g[3],_=g[1]/g[3];return h>=-i[0]&&h<=i[0]&&_>=-i[1]&&_<=i[1]}function ai(g,i,h,_,E,M,O,N,B,Q){const J=h.transform,fe=_?g.textSizeData:g.iconSizeData,Ie=c.evaluateSizeForZoom(fe,h.transform.zoom),je="globe"===J.projection.name,Be=[256/h.width*2+1,256/h.height*2+1],Ve=_?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;Ve.clear();let Le=null;je&&(Le=_?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const De=g.lineVertexArray,He=_?g.text.placedSymbolArray:g.icon.placedSymbolArray,Xe=h.transform.width/h.transform.height;let at,_t=!1;for(let mt=0;mt<He.length;mt++){const It=He.get(mt),{numGlyphs:Ht,writingMode:jt}=It;if(jt!==c.WritingMode.vertical||_t||at===c.WritingMode.horizontal||(_t=!0),at=jt,(It.hidden||jt===c.WritingMode.vertical)&&!_t){Hs(Ht,Ve);continue}_t=!1;const Rt=new c.pointGeometry(It.tileAnchorX,It.tileAnchorY);let{x:Dr,y:Ut,z:pr}=J.projection.projectTilePoint(Rt.x,Rt.y,Q.canonical);if(B){const[Ln,gn,Nn]=B(Rt);Dr+=Ln,Ut+=gn,pr+=Nn}const er=[Dr,Ut,pr,1];if(c.transformMat4$1(er,er,i),!Vn(er,Be)){Hs(Ht,Ve);continue}const Tr=Nr(h.transform.cameraToCenterDistance,er[3]),ir=c.evaluateSizeForFeature(fe,Ie,It),vr=O?ir/Tr:ir*Tr,Or=oi(Dr,Ut,pr,E);if(Or[3]<=0){Hs(Ht,Ve);continue}let zt={};const Kt=O?null:B,fn=ri(It,vr,!1,N,i,E,M,g.glyphOffsetArray,De,Ve,Le,Or,Rt,zt,Xe,Kt,J.projection,Q,O);_t=fn.useVertical,Kt&&fn.needsFlipping&&(zt={}),(fn.notEnoughRoom||_t||fn.needsFlipping&&ri(It,vr,!0,N,i,E,M,g.glyphOffsetArray,De,Ve,Le,Or,Rt,zt,Xe,Kt,J.projection,Q,O).notEnoughRoom)&&Hs(Ht,Ve)}_?(g.text.dynamicLayoutVertexBuffer.updateData(Ve),Le&&g.text.globeExtVertexBuffer.updateData(Le)):(g.icon.dynamicLayoutVertexBuffer.updateData(Ve),Le&&g.icon.globeExtVertexBuffer.updateData(Le))}function Ws(g,i,h,_,E,M,O,N,B,Q,J,fe,Ie,je,Be,Ve){const{lineStartIndex:Le,glyphStartIndex:De,segment:He}=N,Xe=De+N.numGlyphs,at=Le+N.lineLength,_t=i.getoffsetX(De),mt=i.getoffsetX(Xe-1),It=$n(g*_t,h,_,E,M,O,He,Le,at,B,Q,J,fe,Ie,!0,je,Be,Ve);if(!It)return null;const Ht=$n(g*mt,h,_,E,M,O,He,Le,at,B,Q,J,fe,Ie,!0,je,Be,Ve);return Ht?{first:It,last:Ht}:null}function hi(g,i,h,_){return g===c.WritingMode.horizontal&&Math.abs(_)>Math.abs(h)?{useVertical:!0}:g===c.WritingMode.vertical?_>0?{needsFlipping:!0}:null:0!==i&&(0===(E=h)||Math.abs(_/E)>Ou)?1===i?{needsFlipping:!0}:null:h<0?{needsFlipping:!0}:null;var E}function ri(g,i,h,_,E,M,O,N,B,Q,J,fe,Ie,je,Be,Ve,Le,De,He){const Xe=i/24,at=g.lineOffsetX*Xe,_t=g.lineOffsetY*Xe,{lineStartIndex:mt,glyphStartIndex:It,numGlyphs:Ht,segment:jt,writingMode:Rt,flipState:Dr}=g,Ut=mt+g.lineLength,pr=er=>{if(J){const[Or,zt,Kt]=er.up,fn=Q.length;c.updateGlobeVertexNormal(J,fn+0,Or,zt,Kt),c.updateGlobeVertexNormal(J,fn+1,Or,zt,Kt),c.updateGlobeVertexNormal(J,fn+2,Or,zt,Kt),c.updateGlobeVertexNormal(J,fn+3,Or,zt,Kt)}const[Tr,ir,vr]=er.point;c.addDynamicAttributes(Q,Tr,ir,vr,er.angle)};if(Ht>1){const er=Ws(Xe,N,at,_t,h,fe,Ie,g,B,M,je,Ve,!1,Le,De,He);if(!er)return{notEnoughRoom:!0};if(_&&!h){let[Tr,ir,vr]=er.first.point,[Or,zt,Kt]=er.last.point;[Tr,ir]=oi(Tr,ir,vr,O),[Or,zt]=oi(Or,zt,Kt,O);const fn=hi(Rt,Dr,(Or-Tr)*Be,zt-ir);if(g.flipState=fn&&fn.needsFlipping?1:2,fn)return fn}pr(er.first);for(let Tr=It+1;Tr<It+Ht-1;Tr++){const ir=$n(Xe*N.getoffsetX(Tr),at,_t,h,fe,Ie,jt,mt,Ut,B,M,je,Ve,!1,!1,Le,De,He);if(!ir)return Q.length-=4*(Tr-It),{notEnoughRoom:!0};pr(ir)}pr(er.last)}else{if(_&&!h){const Tr=oi(Ie.x,Ie.y,0,E),ir=mt+jt+1,vr=new c.pointGeometry(B.getx(ir),B.gety(ir)),Or=oi(vr.x,vr.y,0,E),zt=Or[3]>0?Or:zl(Ie,vr,Tr,1,E,void 0,Le,De.canonical),Kt=hi(Rt,Dr,(zt[0]-Tr[0])*Be,zt[1]-Tr[1]);if(g.flipState=Kt&&Kt.needsFlipping?1:2,Kt)return Kt}const er=$n(Xe*N.getoffsetX(It),at,_t,h,fe,Ie,jt,mt,Ut,B,M,je,Ve,!1,!1,Le,De,He);if(!er)return{notEnoughRoom:!0};pr(er)}return{}}function va(g,i,h,_,E){const{x:M,y:O,z:N}=_.projectTilePoint(g.x,g.y,i);if(!E)return oi(M,O,N,h);const[B,Q,J]=E(g);return oi(M+B,O+Q,N+J,h)}function zl(g,i,h,_,E,M,O,N){const B=va(g.sub(i)._unit()._add(g),N,E,O,M);return c.sub(B,h,B),c.normalize(B,B),c.scaleAndAdd(B,h,B,_)}function $n(g,i,h,_,E,M,O,N,B,Q,J,fe,Ie,je,Be,Ve,Le,De){const He=_?g-i:g+i;let Xe=He>0?1:-1,at=0;_&&(Xe*=-1,at=Math.PI),Xe<0&&(at+=Math.PI);let _t=N+O+(Xe>0?0:1)|0,mt=E,It=E,Ht=0,jt=0;const Rt=Math.abs(He),Dr=[],Ut=[];let pr=M,er=pr;const Tr=()=>zl(er,pr,It,Rt-Ht+1,J,Ie,Ve,Le.canonical);for(;Ht+jt<=Rt;){if(_t+=Xe,_t<N||_t>=B)return null;if(It=mt,er=pr,Dr.push(It),je&&Ut.push(er),pr=new c.pointGeometry(Q.getx(_t),Q.gety(_t)),mt=fe[_t],!mt){const Nn=va(pr,Le.canonical,J,Ve,Ie);mt=Nn[3]>0?fe[_t]=Nn:Tr()}Ht+=jt,jt=c.distance(It,mt)}Be&&Ie&&(fe[_t]&&(mt=Tr(),jt=c.distance(It,mt)),fe[_t]=mt);const ir=(Rt-Ht)/jt,vr=pr.sub(er)._mult(ir)._add(er),Or=c.sub([],mt,It),zt=c.scaleAndAdd([],It,Or,ir);let Kt=[0,0,1],fn=Or[0],Ln=Or[1];if(De&&(Kt=Ve.upVector(Le.canonical,vr.x,vr.y),0!==Kt[0]||0!==Kt[1]||1!==Kt[2])){const Nn=[Kt[2],0,-Kt[0]],gi=c.cross([],Kt,Nn);c.normalize(Nn,Nn),c.normalize(gi,gi),fn=c.dot(Or,Nn),Ln=c.dot(Or,gi)}if(h){const Nn=c.cross([],Kt,Or);c.normalize(Nn,Nn),c.scaleAndAdd(zt,zt,Nn,h*Xe)}const gn=at+Math.atan2(Ln,fn);return Dr.push(zt),je&&Ut.push(vr),{point:zt,angle:gn,path:Dr,tilePath:Ut,up:Kt}}function Hs(g,i){const h=i.length,_=h+4*g;i.resize(_),i.float32.fill(-1/0,4*h,4*_)}function Eo(g,i,h){const _=i[0],E=i[1];return g[0]=h[0]*_+h[4]*E+h[12],g[1]=h[1]*_+h[5]*E+h[13],g[3]=h[3]*_+h[7]*E+h[15],g}const R=100;class W{constructor(i,h,_=new Jo(i.width+200,i.height+200,25),E=new Jo(i.width+200,i.height+200,25)){this.transform=i,this.grid=_,this.ignoredGrid=E,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+R,this.screenBottomBoundary=i.height+R,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=h}placeCollisionBox(i,h,_,E,M,O,N,B){let Q=_.projectedAnchorX,J=_.projectedAnchorY,fe=_.projectedAnchorZ;const Ie=_.elevation,je=_.tileID,Be=i.getProjection();if(Ie&&je){const[mt,It,Ht]=Be.upVector(je.canonical,_.tileAnchorX,_.tileAnchorY),jt=Be.upVectorScale(je.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;Q+=mt*Ie*jt,J+=It*Ie*jt,fe+=Ht*Ie*jt}const Ve=this.projectAndGetPerspectiveRatio(N,Q,J,fe,_.tileID,"globe"===Be.name||!!Ie||this.transform.pitch>0,Be),Le=O*Ve.perspectiveRatio,De=(_.x1*h+E.x-_.padding)*Le+Ve.point.x,He=(_.y1*h+E.y-_.padding)*Le+Ve.point.y,Xe=(_.x2*h+E.x+_.padding)*Le+Ve.point.x,at=(_.y2*h+E.y+_.padding)*Le+Ve.point.y,_t=Ve.perspectiveRatio<=.55||Ve.occluded;return!this.isInsideGrid(De,He,Xe,at)||!M&&this.grid.hitTest(De,He,Xe,at,B)||_t?{box:[],offscreen:!1,occluded:Ve.occluded}:{box:[De,He,Xe,at],offscreen:this.isOffscreen(De,He,Xe,at),occluded:!1}}placeCollisionCircles(i,h,_,E,M,O,N,B,Q,J,fe,Ie,je,Be,Ve){const Le=[],De=this.transform.elevation,He=i.getProjection(),Xe=De?De.getAtTileOffsetFunc(Ve,this.transform.center.lat,this.transform.worldSize,He):null,at=new c.pointGeometry(_.tileAnchorX,_.tileAnchorY);let{x:_t,y:mt,z:It}=He.projectTilePoint(at.x,at.y,Ve.canonical);if(Xe){const[vr,Or,zt]=Xe(at);_t+=vr,mt+=Or,It+=zt}const Ht="globe"===He.name,jt=this.projectAndGetPerspectiveRatio(N,_t,mt,It,Ve,Ht||!!De||this.transform.pitch>0,He),{perspectiveRatio:Rt}=jt,Dr=(fe?O/Rt:O*Rt)/c.ONE_EM,Ut=oi(_t,mt,It,B),pr=jt.signedDistanceFromCamera>0?Ws(Dr,M,_.lineOffsetX*Dr,_.lineOffsetY*Dr,!1,Ut,at,_,E,B,{},De&&!fe?Xe:null,fe&&!!De,He,Ve,fe):null;let er=!1,Tr=!1,ir=!0;if(pr&&!jt.occluded){const vr=.5*je*Rt+Be,Or=new c.pointGeometry(-100,-100),zt=new c.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Kt=new Kn,{first:fn,last:Ln}=pr,gn=fn.path.length;let Nn=[];for(let Kr=gn-1;Kr>=1;Kr--)Nn.push(fn.path[Kr]);for(let Kr=1;Kr<Ln.path.length;Kr++)Nn.push(Ln.path[Kr]);const gi=2.5*vr;Q&&(Nn=Nn.map(([Kr,Do,mo],Yo)=>(Xe&&!Ht&&(mo=Xe(Yo<gn-1?fn.tilePath[gn-1-Yo]:Ln.tilePath[Yo-gn+2])[2]),oi(Kr,Do,mo,Q))),Nn.some(Kr=>Kr[3]<=0)&&(Nn=[]));let Pn=[];if(Nn.length>0){let Kr=1/0,Do=-1/0,mo=1/0,Yo=-1/0;for(const yo of Nn)Kr=Math.min(Kr,yo[0]),mo=Math.min(mo,yo[1]),Do=Math.max(Do,yo[0]),Yo=Math.max(Yo,yo[1]);Do>=Or.x&&Kr<=zt.x&&Yo>=Or.y&&mo<=zt.y&&(Pn=[Nn.map(yo=>new c.pointGeometry(yo[0],yo[1]))],(Kr<Or.x||Do>zt.x||mo<Or.y||Yo>zt.y)&&(Pn=c.clipLine(Pn,Or.x,Or.y,zt.x,zt.y)))}for(const Kr of Pn){Kt.reset(Kr,.25*vr);let Do=0;Do=Kt.length<=.5*vr?1:Math.ceil(Kt.paddedLength/gi)+1;for(let mo=0;mo<Do;mo++){const Yo=mo/Math.max(Do-1,1),yo=Kt.lerp(Yo),dl=yo.x+R,El=yo.y+R;Le.push(dl,El,vr,0);const Sl=dl-vr,gu=El-vr,rs=dl+vr,Oo=El+vr;if(ir=ir&&this.isOffscreen(Sl,gu,rs,Oo),Tr=Tr||this.isInsideGrid(Sl,gu,rs,Oo),!h&&this.grid.hitTestCircle(dl,El,vr,Ie)&&(er=!0,!J))return{circles:[],offscreen:!1,collisionDetected:er,occluded:!1}}}}return{circles:!J&&er||!Tr?[]:Le,offscreen:ir,collisionDetected:er,occluded:jt.occluded}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const h=[];let _=1/0,E=1/0,M=-1/0,O=-1/0;for(const J of i){const fe=new c.pointGeometry(J.x+R,J.y+R);_=Math.min(_,fe.x),E=Math.min(E,fe.y),M=Math.max(M,fe.x),O=Math.max(O,fe.y),h.push(fe)}const N=this.grid.query(_,E,M,O).concat(this.ignoredGrid.query(_,E,M,O)),B={},Q={};for(const J of N){const fe=J.key;if(void 0===B[fe.bucketInstanceId]&&(B[fe.bucketInstanceId]={}),B[fe.bucketInstanceId][fe.featureIndex])continue;const Ie=[new c.pointGeometry(J.x1,J.y1),new c.pointGeometry(J.x2,J.y1),new c.pointGeometry(J.x2,J.y2),new c.pointGeometry(J.x1,J.y2)];c.polygonIntersectsPolygon(h,Ie)&&(B[fe.bucketInstanceId][fe.featureIndex]=!0,void 0===Q[fe.bucketInstanceId]&&(Q[fe.bucketInstanceId]=[]),Q[fe.bucketInstanceId].push(fe.featureIndex))}return Q}insertCollisionBox(i,h,_,E,M){(h?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:E,collisionGroupID:M},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,h,_,E,M){const O=h?this.ignoredGrid:this.grid,N={bucketInstanceId:_,featureIndex:E,collisionGroupID:M};for(let B=0;B<i.length;B+=4)O.insertCircle(N,i[B],i[B+1],i[B+2])}projectAndGetPerspectiveRatio(i,h,_,E,M,O,N){const B=[h,_,E,1];let Q=!1;if(E||this.transform.pitch>0){c.transformMat4$1(B,B,i);const fe="globe"===N.name;this.fogState&&M&&!fe&&(Q=function(je,Be,Ve,Le,De,He){const Xe=He.calculateFogTileMatrix(De),at=[Be,Ve,Le];return c.transformMat4(at,at,Xe),ke(je,at,He.pitch,He._fov)}(this.fogState,h,_,E,M.toUnwrapped(),this.transform)>.9)}else Eo(B,B,i);const J=B[3];return{point:new c.pointGeometry((B[0]/J+1)/2*this.transform.width+R,(-B[1]/J+1)/2*this.transform.height+R),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(N)/J*.5,1.5),signedDistanceFromCamera:J,occluded:O&&B[2]>J||Q}}isOffscreen(i,h,_,E){return _<R||i>=this.screenRightBoundary||E<R||h>this.screenBottomBoundary}isInsideGrid(i,h,_,E){return _>=0&&i<this.gridRightBoundary&&E>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const i=c.identity([]);return c.translate(i,i,[-100,-100,0]),i}}function Ce(g,i,h){const _=i.createTileMatrix(g,g.worldSize,h.toUnwrapped());return c.multiply(new Float32Array(16),g.projMatrix,_)}function Et(g,i,h){if(i.projection.name===h.projection.name)return g.projMatrix;const _=h.clone();return _.setProjection(i.projection),Ce(_,i.getProjection(),g)}function Gt(g,i,h){return i.name===h.projection.name?g.projMatrix:Ce(h,i,g)}class et{constructor(i,h,_,E){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?h:-h))):E&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class Bt{constructor(i,h,_,E,M,O=!1){this.text=new et(i?i.text:null,h,_,M),this.icon=new et(i?i.icon:null,h,E,M),this.clipped=O}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class br{constructor(i,h,_,E=!1){this.text=i,this.icon=h,this.skipFade=_,this.clipped=E}}class wr{constructor(){this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.circles=[]}}class Wr{constructor(i,h,_,E,M){this.bucketInstanceId=i,this.featureIndex=h,this.sourceLayerIndex=_,this.bucketIndex=E,this.tileID=M}}class kt{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const h=++this.maxGroupID;this.collisionGroups[i]={ID:h,predicate:_=>_.collisionGroupID===h}}return this.collisionGroups[i]}}function hr(g,i,h,_,E){const{horizontalAlign:M,verticalAlign:O}=c.getAnchorAlignment(g),N=-(M-.5)*i,B=-(O-.5)*h,Q=c.evaluateVariableOffset(g,_);return new c.pointGeometry(N+Q[0]*E,B+Q[1]*E)}function Er(g,i,h,_,E){const M=new c.pointGeometry(g,i);return h&&M._rotate(_?E:-E),M}class Jr{constructor(i,h,_,E,M){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new W(this.transform,M),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=h,this.retainedQueryData={},this.collisionGroups=new kt(_),this.collisionCircleArrays={},this.prevPlacement=E,E&&(E.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,h,_,E){const M=_.getBucket(h),O=_.latestFeatureIndex;if(!M||!O||h.id!==M.layerIds[0])return;const N=M.layers[0].layout,B=_.collisionBoxArray,Q=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),J=_.tileSize/c.EXTENT,fe=_.tileID.toUnwrapped();this.transform.setProjection(M.projection);const Ie=(je=_.tileID,Be=M.getProjection(),Ve=this.transform,Be.name===this.projection?Ve.calculateProjMatrix(je.toUnwrapped()):Ce(Ve,Be,je));var je,Be,Ve;const Le="map"===N.get("text-pitch-alignment"),De="map"===N.get("text-rotation-alignment");h.compileFilter();const He=h.dynamicFilter(),Xe=h.dynamicFilterNeedsFeature(),at=this.transform.calculatePixelsToTileUnitsMatrix(_),_t=ks(Ie,_.tileID.canonical,Le,De,this.transform,M.getProjection(),at);let mt=null;if(Le){const jt=Pl(Ie,_.tileID.canonical,Le,De,this.transform,M.getProjection(),at);mt=c.multiply([],this.transform.labelPlaneMatrix,jt)}let It=null;He&&_.latestFeatureIndex&&(It={unwrappedTileID:fe,dynamicFilter:He,dynamicFilterNeedsFeature:Xe,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[M.bucketInstanceId]=new Wr(M.bucketInstanceId,O,M.sourceLayerIndex,M.index,_.tileID);const Ht={bucket:M,layout:N,posMatrix:Ie,textLabelPlaneMatrix:_t,labelToScreenMatrix:mt,clippingData:It,scale:Q,textPixelRatio:J,holdingForFade:_.holdingForFade(),collisionBoxArray:B,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(M.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:c.evaluateSizeForZoom(M.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(M.sourceID)};if(E)for(const jt of M.sortKeyRanges){const{sortKey:Rt,symbolInstanceStart:Dr,symbolInstanceEnd:Ut}=jt;i.push({sortKey:Rt,symbolInstanceStart:Dr,symbolInstanceEnd:Ut,parameters:Ht})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:M.symbolInstances.length,parameters:Ht})}attemptAnchorPlacement(i,h,_,E,M,O,N,B,Q,J,fe,Ie,je,Be,Ve,Le,De,He){const{textOffset0:Xe,textOffset1:at,crossTileID:_t}=Ie,mt=[Xe,at],It=hr(i,_,E,mt,M),Ht=this.collisionIndex.placeCollisionBox(Be,M,h,Er(It.x,It.y,O,N,this.transform.angle),fe,B,Q,J.predicate);if(Le){const jt=Be.getSymbolInstanceIconSize(He,this.transform.zoom,Ie.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Be,jt,Le,Er(It.x,It.y,O,N,this.transform.angle),fe,B,Q,J.predicate).box.length)return}if(Ht.box.length>0){let jt;return this.prevPlacement&&this.prevPlacement.variableOffsets[_t]&&this.prevPlacement.placements[_t]&&this.prevPlacement.placements[_t].text&&(jt=this.prevPlacement.variableOffsets[_t].anchor),this.variableOffsets[_t]={textOffset:mt,width:_,height:E,anchor:i,textScale:M,prevAnchor:jt},this.markUsedJustification(Be,i,Ie,Ve),Be.allowVerticalPlacement&&(this.markUsedOrientation(Be,Ve,Ie),this.placedOrientations[_t]=Ve),{shift:It,placedGlyphBoxes:Ht}}}placeLayerBucketPart(i,h,_,E){const{bucket:M,layout:O,posMatrix:N,textLabelPlaneMatrix:B,labelToScreenMatrix:Q,clippingData:J,textPixelRatio:fe,holdingForFade:Ie,collisionBoxArray:je,partiallyEvaluatedTextSize:Be,partiallyEvaluatedIconSize:Ve,collisionGroup:Le}=i.parameters,De=O.get("text-optional"),He=O.get("icon-optional"),Xe=O.get("text-allow-overlap"),at=O.get("icon-allow-overlap"),_t="map"===O.get("text-rotation-alignment"),mt="map"===O.get("text-pitch-alignment"),It="none"!==O.get("icon-text-fit"),Ht="viewport-y"===O.get("symbol-z-order");this.transform.setProjection(M.projection);let jt=Xe&&(at||!M.hasIconData()||He),Rt=at&&(Xe||!M.hasTextData()||De);!M.collisionArrays&&je&&M.deserializeCollisionBoxes(je),_&&E&&M.updateCollisionDebugBuffers(this.transform.zoom,je);const Dr=(Ut,pr,er)=>{const{crossTileID:Tr,numVerticalGlyphVertices:ir}=Ut;if(J){const rs={zoom:this.transform.zoom,pitch:this.transform.pitch};let Oo=null;if(J.dynamicFilterNeedsFeature){const Si=this.retainedQueryData[M.bucketInstanceId];Oo=J.featureIndex.loadFeature({featureIndex:Ut.featureIndex,bucketIndex:Si.bucketIndex,sourceLayerIndex:Si.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,J.dynamicFilter)(rs,Oo,this.retainedQueryData[M.bucketInstanceId].tileID.canonical,new c.pointGeometry(Ut.tileAnchorX,Ut.tileAnchorY),this.transform.calculateDistanceTileData(J.unwrappedTileID)))return this.placements[Tr]=new br(!1,!1,!1,!0),void(h[Tr]=!0)}if(h[Tr])return;if(Ie)return void(this.placements[Tr]=new br(!1,!1,!1));let vr=!1,Or=!1,zt=!0,Kt=!1,fn=!1,Ln=null,gn={box:null,offscreen:null,occluded:null},Nn={box:null,offscreen:null,occluded:null},gi=null,Pn=null,Kr=null,Do=0,mo=0,Yo=0;er.textFeatureIndex?Do=er.textFeatureIndex:Ut.useRuntimeCollisionCircles&&(Do=Ut.featureIndex),er.verticalTextFeatureIndex&&(mo=er.verticalTextFeatureIndex);const yo=rs=>{rs.tileID=this.retainedQueryData[M.bucketInstanceId].tileID;const Oo=this.transform.elevation;(Oo||rs.elevation)&&(rs.elevation=Oo?Oo.getAtTileOffset(rs.tileID,rs.tileAnchorX,rs.tileAnchorY):0)},dl=er.textBox;if(dl){yo(dl);const rs=Si=>{let Us=c.WritingMode.horizontal;if(M.allowVerticalPlacement&&!Si&&this.prevPlacement){const Co=this.prevPlacement.placedOrientations[Tr];Co&&(this.placedOrientations[Tr]=Co,Us=Co,this.markUsedOrientation(M,Us,Ut))}return Us},Oo=(Si,Us)=>{if(M.allowVerticalPlacement&&ir>0&&er.verticalTextBox){for(const Co of M.writingModes)if(Co===c.WritingMode.vertical?(gn=Us(),Nn=gn):gn=Si(),gn&&gn.box&&gn.box.length)break}else gn=Si()};if(O.get("text-variable-anchor")){let Si=O.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Tr]){const Fi=this.prevPlacement.variableOffsets[Tr];Si.indexOf(Fi.anchor)>0&&(Si=Si.filter(bo=>bo!==Fi.anchor),Si.unshift(Fi.anchor))}const Us=(Fi,bo,Gs)=>{const fi=M.getSymbolInstanceTextSize(Be,Ut,this.transform.zoom,pr),Yn=(Fi.x2-Fi.x1)*fi+2*Fi.padding,ii=(Fi.y2-Fi.y1)*fi+2*Fi.padding,li=It&&!at?bo:null;li&&yo(li);let ui={box:[],offscreen:!1,occluded:!1};const bi=Xe?2*Si.length:Si.length;for(let _i=0;_i<bi;++_i){const ci=this.attemptAnchorPlacement(Si[_i%Si.length],Fi,Yn,ii,fi,_t,mt,fe,N,Le,_i>=Si.length,Ut,pr,M,Gs,li,Be,Ve);if(ci&&(ui=ci.placedGlyphBoxes,ui&&ui.box&&ui.box.length)){vr=!0,Ln=ci.shift;break}}return ui};Oo(()=>Us(dl,er.iconBox,c.WritingMode.horizontal),()=>{const Fi=er.verticalTextBox;return Fi&&yo(Fi),M.allowVerticalPlacement&&!(gn&&gn.box&&gn.box.length)&&ir>0&&Fi?Us(Fi,er.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),gn&&(vr=gn.box,zt=gn.offscreen,Kt=gn.occluded);const Co=rs(gn&&gn.box);if(!vr&&this.prevPlacement){const Fi=this.prevPlacement.variableOffsets[Tr];Fi&&(this.variableOffsets[Tr]=Fi,this.markUsedJustification(M,Fi.anchor,Ut,Co))}}else{const Si=(Us,Co)=>{const Fi=M.getSymbolInstanceTextSize(Be,Ut,this.transform.zoom,pr),bo=this.collisionIndex.placeCollisionBox(M,Fi,Us,new c.pointGeometry(0,0),Xe,fe,N,Le.predicate);return bo&&bo.box&&bo.box.length&&(this.markUsedOrientation(M,Co,Ut),this.placedOrientations[Tr]=Co),bo};Oo(()=>Si(dl,c.WritingMode.horizontal),()=>{const Us=er.verticalTextBox;return M.allowVerticalPlacement&&ir>0&&Us?(yo(Us),Si(Us,c.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),rs(gn&&gn.box&&gn.box.length)}}if(gi=gn,vr=gi&&gi.box&&gi.box.length>0,zt=gi&&gi.offscreen,Kt=gi&&gi.occluded,Ut.useRuntimeCollisionCircles){const rs=M.text.placedSymbolArray.get(Ut.centerJustifiedTextSymbolIndex>=0?Ut.centerJustifiedTextSymbolIndex:Ut.verticalPlacedTextSymbolIndex),Oo=c.evaluateSizeForFeature(M.textSizeData,Be,rs),Si=O.get("text-padding");Pn=this.collisionIndex.placeCollisionCircles(M,Xe,rs,M.lineVertexArray,M.glyphOffsetArray,Oo,N,B,Q,_,mt,Le.predicate,Ut.collisionCircleDiameter*Oo/c.ONE_EM,Si,this.retainedQueryData[M.bucketInstanceId].tileID),vr=Xe||Pn.circles.length>0&&!Pn.collisionDetected,zt=zt&&Pn.offscreen,Kt=Pn.occluded}if(er.iconFeatureIndex&&(Yo=er.iconFeatureIndex),er.iconBox){const rs=Oo=>{yo(Oo);const Si=It&&Ln?Er(Ln.x,Ln.y,_t,mt,this.transform.angle):new c.pointGeometry(0,0),Us=M.getSymbolInstanceIconSize(Ve,this.transform.zoom,Ut.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(M,Us,Oo,Si,at,fe,N,Le.predicate)};Nn&&Nn.box&&Nn.box.length&&er.verticalIconBox?(Kr=rs(er.verticalIconBox),Or=Kr.box.length>0):(Kr=rs(er.iconBox),Or=Kr.box.length>0),zt=zt&&Kr.offscreen,fn=Kr.occluded}const El=De||0===Ut.numHorizontalGlyphVertices&&0===ir,Sl=He||0===Ut.numIconVertices;if(El||Sl?Sl?El||(Or=Or&&vr):vr=Or&&vr:Or=vr=Or&&vr,vr&&gi&&gi.box&&this.collisionIndex.insertCollisionBox(gi.box,O.get("text-ignore-placement"),M.bucketInstanceId,Nn&&Nn.box&&mo?mo:Do,Le.ID),Or&&Kr&&this.collisionIndex.insertCollisionBox(Kr.box,O.get("icon-ignore-placement"),M.bucketInstanceId,Yo,Le.ID),Pn&&(vr&&this.collisionIndex.insertCollisionCircles(Pn.circles,O.get("text-ignore-placement"),M.bucketInstanceId,Do,Le.ID),_)){const rs=M.bucketInstanceId;let Oo=this.collisionCircleArrays[rs];void 0===Oo&&(Oo=this.collisionCircleArrays[rs]=new wr);for(let Si=0;Si<Pn.circles.length;Si+=4)Oo.circles.push(Pn.circles[Si+0]),Oo.circles.push(Pn.circles[Si+1]),Oo.circles.push(Pn.circles[Si+2]),Oo.circles.push(Pn.collisionDetected?1:0)}const gu="globe"!==M.projection.name;jt=jt&&(gu||!Kt),Rt=Rt&&(gu||!fn),this.placements[Tr]=new br(vr||jt,Or||Rt,zt||M.justReloaded),h[Tr]=!0};if(Ht){const Ut=M.getSortedSymbolIndexes(this.transform.angle);for(let pr=Ut.length-1;pr>=0;--pr){const er=Ut[pr];Dr(M.symbolInstances.get(er),er,M.collisionArrays[er])}}else for(let Ut=i.symbolInstanceStart;Ut<i.symbolInstanceEnd;Ut++)Dr(M.symbolInstances.get(Ut),Ut,M.collisionArrays[Ut]);if(_&&M.bucketInstanceId in this.collisionCircleArrays){const Ut=this.collisionCircleArrays[M.bucketInstanceId];c.invert(Ut.invProjMatrix,N),Ut.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1}markUsedJustification(i,h,_,E){const{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:O,rightJustifiedTextSymbolIndex:N,verticalPlacedTextSymbolIndex:B,crossTileID:Q}=_,J=c.getAnchorJustification(h),fe=E===c.WritingMode.vertical?B:"left"===J?M:"center"===J?O:"right"===J?N:-1;M>=0&&(i.text.placedSymbolArray.get(M).crossTileID=fe>=0&&M!==fe?0:Q),O>=0&&(i.text.placedSymbolArray.get(O).crossTileID=fe>=0&&O!==fe?0:Q),N>=0&&(i.text.placedSymbolArray.get(N).crossTileID=fe>=0&&N!==fe?0:Q),B>=0&&(i.text.placedSymbolArray.get(B).crossTileID=fe>=0&&B!==fe?0:Q)}markUsedOrientation(i,h,_){const E=h===c.WritingMode.horizontal||h===c.WritingMode.horizontalOnly?h:0,M=h===c.WritingMode.vertical?h:0,{leftJustifiedTextSymbolIndex:O,centerJustifiedTextSymbolIndex:N,rightJustifiedTextSymbolIndex:B,verticalPlacedTextSymbolIndex:Q}=_,J=i.text.placedSymbolArray;O>=0&&(J.get(O).placedOrientation=E),N>=0&&(J.get(N).placedOrientation=E),B>=0&&(J.get(B).placedOrientation=E),Q>=0&&(J.get(Q).placedOrientation=M)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let _=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const E=h?h.symbolFadeChange(i):1,M=h?h.opacities:{},O=h?h.variableOffsets:{},N=h?h.placedOrientations:{};for(const B in this.placements){const Q=this.placements[B],J=M[B];J?(this.opacities[B]=new Bt(J,E,Q.text,Q.icon,null,Q.clipped),_=_||Q.text!==J.text.placed||Q.icon!==J.icon.placed):(this.opacities[B]=new Bt(null,E,Q.text,Q.icon,Q.skipFade,Q.clipped),_=_||Q.text||Q.icon)}for(const B in M){const Q=M[B];if(!this.opacities[B]){const J=new Bt(Q,E,!1,!1);J.isHidden()||(this.opacities[B]=J,_=_||Q.text.placed||Q.icon.placed)}}for(const B in O)this.variableOffsets[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.variableOffsets[B]=O[B]);for(const B in N)this.placedOrientations[B]||!this.opacities[B]||this.opacities[B].isHidden()||(this.placedOrientations[B]=N[B]);_?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:i)}updateLayerOpacities(i,h){const _={};for(const E of h){const M=E.getBucket(i);M&&E.latestFeatureIndex&&i.id===M.layerIds[0]&&this.updateBucketOpacities(M,_,E.collisionBoxArray)}}updateBucketOpacities(i,h,_){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const E=i.layers[0].layout,M=!!i.layers[0].dynamicFilter(),O=new Bt(null,0,!1,!1,!0),N=E.get("text-allow-overlap"),B=E.get("icon-allow-overlap"),Q=E.get("text-variable-anchor"),J="map"===E.get("text-rotation-alignment"),fe="map"===E.get("text-pitch-alignment"),Ie="none"!==E.get("icon-text-fit"),je=new Bt(null,0,N&&(B||!i.hasIconData()||E.get("icon-optional")),B&&(N||!i.hasTextData()||E.get("text-optional")),!0);!i.collisionArrays&&_&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(_);const Be=(Le,De,He)=>{for(let Xe=0;Xe<De/4;Xe++)Le.opacityVertexArray.emplaceBack(He)};let Ve=0;for(let Le=0;Le<i.symbolInstances.length;Le++){const De=i.symbolInstances.get(Le),{numHorizontalGlyphVertices:He,numVerticalGlyphVertices:Xe,crossTileID:at,numIconVertices:_t}=De;let mt=this.opacities[at];h[at]?mt=O:mt||(mt=je,this.opacities[at]=mt),h[at]=!0;const It=He>0||Xe>0,Ht=_t>0,jt=this.placedOrientations[at],Rt=jt===c.WritingMode.vertical,Dr=jt===c.WritingMode.horizontal||jt===c.WritingMode.horizontalOnly;if(!It&&!Ht||mt.isHidden()||Ve++,It){const Ut=zo(mt.text);Be(i.text,He,Rt?Rs:Ut),Be(i.text,Xe,Dr?Rs:Ut);const pr=mt.text.isHidden(),{leftJustifiedTextSymbolIndex:er,centerJustifiedTextSymbolIndex:Tr,rightJustifiedTextSymbolIndex:ir,verticalPlacedTextSymbolIndex:vr}=De,Or=i.text.placedSymbolArray,zt=pr||Rt?1:0;er>=0&&(Or.get(er).hidden=zt),Tr>=0&&(Or.get(Tr).hidden=zt),ir>=0&&(Or.get(ir).hidden=zt),vr>=0&&(Or.get(vr).hidden=pr||Dr?1:0);const Kt=this.variableOffsets[at];Kt&&this.markUsedJustification(i,Kt.anchor,De,jt);const fn=this.placedOrientations[at];fn&&(this.markUsedJustification(i,"left",De,fn),this.markUsedOrientation(i,fn,De))}if(Ht){const Ut=zo(mt.icon),{placedIconSymbolIndex:pr,verticalPlacedIconSymbolIndex:er}=De,Tr=i.icon.placedSymbolArray,ir=mt.icon.isHidden()?1:0;pr>=0&&(Be(i.icon,_t,Rt?Rs:Ut),Tr.get(pr).hidden=ir),er>=0&&(Be(i.icon,De.numVerticalIconVertices,Dr?Rs:Ut),Tr.get(er).hidden=ir)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ut=i.collisionArrays[Le];if(Ut){let pr=new c.pointGeometry(0,0),er=!0;if(Ut.textBox||Ut.verticalTextBox){if(Q){const ir=this.variableOffsets[at];ir?(pr=hr(ir.anchor,ir.width,ir.height,ir.textOffset,ir.textScale),J&&pr._rotate(fe?this.transform.angle:-this.transform.angle)):er=!1}M&&(er=!mt.clipped),Ut.textBox&&yn(i.textCollisionBox.collisionVertexArray,mt.text.placed,!er||Rt,pr.x,pr.y),Ut.verticalTextBox&&yn(i.textCollisionBox.collisionVertexArray,mt.text.placed,!er||Dr,pr.x,pr.y)}const Tr=er&&Boolean(!Dr&&Ut.verticalIconBox);Ut.iconBox&&yn(i.iconCollisionBox.collisionVertexArray,mt.icon.placed,Tr,Ie?pr.x:0,Ie?pr.y:0),Ut.verticalIconBox&&yn(i.iconCollisionBox.collisionVertexArray,mt.icon.placed,!Tr,Ie?pr.x:0,Ie?pr.y:0)}}}if(i.fullyClipped=0===Ve,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const Le=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=Le.invProjMatrix,i.placementViewportMatrix=Le.viewportMatrix,i.collisionCircleArray=Le.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,h){const _=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*_>i}setStale(){this.stale=!0}}function yn(g,i,h,_,E){g.emplaceBack(i?1:0,h?1:0,_||0,E||0),g.emplaceBack(i?1:0,h?1:0,_||0,E||0),g.emplaceBack(i?1:0,h?1:0,_||0,E||0),g.emplaceBack(i?1:0,h?1:0,_||0,E||0)}const ao=Math.pow(2,25),fr=Math.pow(2,24),nn=Math.pow(2,17),In=Math.pow(2,16),xn=Math.pow(2,9),_o=Math.pow(2,8),Zr=Math.pow(2,1);function zo(g){if(0===g.opacity&&!g.placed)return 0;if(1===g.opacity&&g.placed)return 4294967295;const i=g.placed?1:0,h=Math.floor(127*g.opacity);return h*ao+i*fr+h*nn+i*In+h*xn+i*_o+h*Zr+i}const Rs=0;class pn{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,h,_,E,M){const O=this._bucketParts;for(;this._currentTileIndex<i.length;)if(h.getBucketParts(O,E,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((N,B)=>N.sortKey-B.sortKey));this._currentPartIndex<O.length;){const N=O[this._currentPartIndex];if(h.placeLayerBucketPart(N,this._seenCrossTileIDs,_,0===N.symbolInstanceStart),this._currentPartIndex++,M())return!0}return!1}}class ji{constructor(i,h,_,E,M,O,N,B){this.placement=new Jr(i,M,O,N,B),this._currentPlacementIndex=h.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=E,this._done=!1}isDone(){return this._done}continuePlacement(i,h,_){const E=c.exported.now(),M=()=>{const O=c.exported.now()-E;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=h[i[this._currentPlacementIndex]],N=this.placement.collisionIndex.transform.zoom;if("symbol"===O.type&&(!O.minzoom||O.minzoom<=N)&&(!O.maxzoom||O.maxzoom>N)){if(this._inProgressLayer||(this._inProgressLayer=new pn(O)),this._inProgressLayer.continuePlacement(_[O.source],this.placement,this._showCollisionBoxes,O,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Xo=512/c.EXTENT/2;class Ns{constructor(i,h,_){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let E=0;E<h.length;E++){const M=h.get(E),O=M.key;this.indexedSymbolInstances[O]||(this.indexedSymbolInstances[O]=[]),this.indexedSymbolInstances[O].push({crossTileID:M.crossTileID,coord:this.getScaledCoordinates(M,i)})}}getScaledCoordinates(i,h){const _=Xo/Math.pow(2,h.canonical.z-this.tileID.canonical.z);return{x:Math.floor((h.canonical.x*c.EXTENT+i.tileAnchorX)*_),y:Math.floor((h.canonical.y*c.EXTENT+i.tileAnchorY)*_)}}findMatches(i,h,_){const E=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let M=0;M<i.length;M++){const O=i.get(M);if(O.crossTileID)continue;const N=this.indexedSymbolInstances[O.key];if(!N)continue;const B=this.getScaledCoordinates(O,h);for(const Q of N)if(Math.abs(Q.coord.x-B.x)<=E&&Math.abs(Q.coord.y-B.y)<=E&&!_[Q.crossTileID]){_[Q.crossTileID]=!0,O.crossTileID=Q.crossTileID;break}}}}class _l{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class gs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const h=Math.round((i-this.lng)/360);if(0!==h)for(const _ in this.indexes){const E=this.indexes[_],M={};for(const O in E){const N=E[O];N.tileID=N.tileID.unwrapTo(N.tileID.wrap+h),M[N.tileID.key]=N}this.indexes[_]=M}this.lng=i}addBucket(i,h,_){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let M=0;M<h.symbolInstances.length;M++)h.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const E=this.usedCrossTileIDs[i.overscaledZ];for(const M in this.indexes){const O=this.indexes[M];if(Number(M)>i.overscaledZ)for(const N in O){const B=O[N];B.tileID.isChildOf(i)&&B.findMatches(h.symbolInstances,i,E)}else{const N=O[i.scaledTo(Number(M)).key];N&&N.findMatches(h.symbolInstances,i,E)}}for(let M=0;M<h.symbolInstances.length;M++){const O=h.symbolInstances.get(M);O.crossTileID||(O.crossTileID=_.generate(),E[O.crossTileID]=!0)}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Ns(i,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(i,h){for(const _ in h.indexedSymbolInstances)for(const E of h.indexedSymbolInstances[_])delete this.usedCrossTileIDs[i][E.crossTileID]}removeStaleBuckets(i){let h=!1;for(const _ in this.indexes){const E=this.indexes[_];for(const M in E)i[E[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,E[M]),delete E[M],h=!0)}return h}}class Js{constructor(){this.layerIndexes={},this.crossTileIDs=new _l,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,h,_,E){let M=this.layerIndexes[i.id];void 0===M&&(M=this.layerIndexes[i.id]=new gs);let O=!1;const N={};"globe"!==E.name&&M.handleWrapJump(_);for(const B of h){const Q=B.getBucket(i);Q&&i.id===Q.layerIds[0]&&(Q.bucketInstanceId||(Q.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(B.tileID,Q,this.crossTileIDs)&&(O=!0),N[Q.bucketInstanceId]=!0)}return M.removeStaleBuckets(N)&&(O=!0),O}pruneUnusedLayers(i){const h={};i.forEach(_=>{h[_]=!0});for(const _ in this.layerIndexes)h[_]||delete this.layerIndexes[_]}}const Ao=(g,i)=>c.emitValidationErrors(g,i&&i.filter(h=>"source.canvas"!==h.identifier)),qi=c.pick(jr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ms=c.pick(jr,["setCenter","setZoom","setBearing","setPitch"]),Vi={version:8,layers:[],sources:{}},Bo={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ps extends c.Evented{constructor(i,h={}){super(),this.map=i,this.dispatcher=new Ue(Tn(),this),this.imageManager=new re,this.imageManager.setEventedParent(this),this.glyphManager=new c.GlyphManager(i._requestManager,h.localFontFamily?c.LocalGlyphMode.all:h.localIdeographFontFamily?c.LocalGlyphMode.ideographs:c.LocalGlyphMode.none,h.localFontFamily||h.localIdeographFontFamily),this.crossTileSymbolIndex=new Js,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const _=this;this._rtlTextPluginCallback=ps.registerForPluginStateChange(E=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},(M,O)=>{if(c.triggerPluginCompletionEvent(M),O&&O.every(N=>N))for(const N in _._sourceCaches){const B=_._sourceCaches[N],Q=B.getSource().type;"vector"!==Q&&"geojson"!==Q||B.reload()}})}),this.on("data",E=>{if("source"!==E.dataType||"metadata"!==E.sourceDataType)return;const M=this.getSource(E.sourceId);if(M&&M.vectorLayerIds)for(const O in this._layers){const N=this._layers[O];N.source===M.id&&this._validateLayer(N)}})}loadURL(i,h={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof h.validate?h.validate:!c.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,h.accessToken);const E=this.map._requestManager.transformRequest(i,c.ResourceType.Style);this._request=c.getJSON(E,(M,O)=>{this._request=null,M?this.fire(new c.ErrorEvent(M)):O&&this._load(O,_)})}loadJSON(i,h={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(i,!1!==h.validate)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(Vi,!1)}_updateLayerCount(i,h){const _=h?1:-1;i.is3D()&&(this._num3DLayers+=_),"circle"===i.type&&(this._numCircleLayers+=_),"symbol"===i.type&&(this._numSymbolLayers+=_)}_load(i,h){if(h&&Ao(this,c.validateStyle(i)))return;this._loaded=!0,this.stylesheet=c.clone$1(i),this._updateMapProjection();for(const E in i.sources)this.addSource(E,i.sources[E],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const _=xi(this.stylesheet.layers);this._order=_.map(E=>E.id),this._layers={},this._serializedLayers={};for(let E of _)E=c.createStyleLayer(E),E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E,this._serializedLayers[E.id]=E.serialize(),this._updateLayerCount(E,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ze(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(i){this._spriteRequest=function(h,_,E){let M,O,N;const B=c.exported.devicePixelRatio>1?"@2x":"";let Q=c.getJSON(_.transformRequest(_.normalizeSpriteURL(h,B,".json"),c.ResourceType.SpriteJSON),(Ie,je)=>{Q=null,N||(N=Ie,M=je,fe())}),J=c.getImage(_.transformRequest(_.normalizeSpriteURL(h,B,".png"),c.ResourceType.SpriteImage),(Ie,je)=>{J=null,N||(N=Ie,O=je,fe())});function fe(){if(N)E(N);else if(M&&O){const Ie=c.exported.getImageData(O),je={};for(const Be in M){const{width:Ve,height:Le,x:De,y:He,sdf:Xe,pixelRatio:at,stretchX:_t,stretchY:mt,content:It}=M[Be],Ht=new c.RGBAImage({width:Ve,height:Le});c.RGBAImage.copy(Ie,Ht,{x:De,y:He},{x:0,y:0},{width:Ve,height:Le}),je[Be]={data:Ht,pixelRatio:at,sdf:Xe,stretchX:_t,stretchY:mt,content:It}}E(null,je)}}return{cancel(){Q&&(Q.cancel(),Q=null),J&&(J.cancel(),J=null)}}}(i,this.map._requestManager,(h,_)=>{if(this._spriteRequest=null,h)this.fire(new c.ErrorEvent(h));else if(_)for(const E in _)this.imageManager.addImage(E,_[E]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(i){const h=this.getSource(i.source);if(!h)return;const _=i.sourceLayer;_&&("geojson"===h.type||h.vectorLayerIds&&-1===h.vectorLayerIds.indexOf(_))&&this.fire(new c.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${h.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const h=[];for(const _ of i){const E=this._layers[_];"custom"!==E.type&&h.push(E.serialize())}return h}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&Bo[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const h=this._changed;if(this._changed){const E=Object.keys(this._updatedLayers),M=Object.keys(this._removedLayers);(E.length||M.length)&&this._updateWorkerLayers(E,M);for(const O in this._updatedSources){const N=this._updatedSources[O];"reload"===N?this._reloadSource(O):"clear"===N&&this._clearSource(O)}this._updateTilesForChangedImages();for(const O in this._updatedPaintProps)this._layers[O].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const _={};for(const E in this._sourceCaches){const M=this._sourceCaches[E];_[E]=M.used,M.used=!1}for(const E of this._order){const M=this._layers[E];if(M.recalculate(i,this._availableImages),!M.isHidden(i.zoom)){const N=this._getLayerSourceCache(M);N&&(N.used=!0)}const O=this.map.painter;if(O){const N=M.getProgramIds();if(!N)continue;const B=M.getProgramConfiguration(i.zoom);for(const Q of N)O.useProgram(Q,B)}}for(const E in _){const M=this._sourceCaches[E];_[E]!==M.used&&M.getSource().fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),h&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const h in this._sourceCaches)this._sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Ao(this,c.validateStyle(i)))return!1;(i=c.clone$1(i)).layers=xi(i.layers);const h=function(E,M){if(!E)return[{command:jr.setStyle,args:[M]}];let O=[];try{if(!Z(E.version,M.version))return[{command:jr.setStyle,args:[M]}];Z(E.center,M.center)||O.push({command:jr.setCenter,args:[M.center]}),Z(E.zoom,M.zoom)||O.push({command:jr.setZoom,args:[M.zoom]}),Z(E.bearing,M.bearing)||O.push({command:jr.setBearing,args:[M.bearing]}),Z(E.pitch,M.pitch)||O.push({command:jr.setPitch,args:[M.pitch]}),Z(E.sprite,M.sprite)||O.push({command:jr.setSprite,args:[M.sprite]}),Z(E.glyphs,M.glyphs)||O.push({command:jr.setGlyphs,args:[M.glyphs]}),Z(E.transition,M.transition)||O.push({command:jr.setTransition,args:[M.transition]}),Z(E.light,M.light)||O.push({command:jr.setLight,args:[M.light]}),Z(E.fog,M.fog)||O.push({command:jr.setFog,args:[M.fog]}),Z(E.projection,M.projection)||O.push({command:jr.setProjection,args:[M.projection]});const N={},B=[];!function(fe,Ie,je,Be){let Ve;for(Ve in Ie=Ie||{},fe=fe||{})fe.hasOwnProperty(Ve)&&(Ie.hasOwnProperty(Ve)||ro(Ve,je,Be));for(Ve in Ie)Ie.hasOwnProperty(Ve)&&(fe.hasOwnProperty(Ve)?Z(fe[Ve],Ie[Ve])||("geojson"===fe[Ve].type&&"geojson"===Ie[Ve].type&&Ts(fe,Ie,Ve)?je.push({command:jr.setGeoJSONSourceData,args:[Ve,Ie[Ve].data]}):Ho(Ve,Ie,je,Be)):mn(Ve,Ie,je))}(E.sources,M.sources,B,N);const Q=[];E.layers&&E.layers.forEach(fe=>{fe.source&&N[fe.source]?O.push({command:jr.removeLayer,args:[fe.id]}):Q.push(fe)});let J=E.terrain;J&&N[J.source]&&(O.push({command:jr.setTerrain,args:[void 0]}),J=void 0),O=O.concat(B),Z(J,M.terrain)||O.push({command:jr.setTerrain,args:[M.terrain]}),function(fe,Ie,je){Ie=Ie||[];const Be=(fe=fe||[]).map(ur),Ve=Ie.map(ur),Le=fe.reduce(hs,{}),De=Ie.reduce(hs,{}),He=Be.slice(),Xe=Object.create(null);let at,_t,mt,It,Ht,jt,Rt;for(at=0,_t=0;at<Be.length;at++)mt=Be[at],De.hasOwnProperty(mt)?_t++:(je.push({command:jr.removeLayer,args:[mt]}),He.splice(He.indexOf(mt,_t),1));for(at=0,_t=0;at<Ve.length;at++)mt=Ve[Ve.length-1-at],He[He.length-1-at]!==mt&&(Le.hasOwnProperty(mt)?(je.push({command:jr.removeLayer,args:[mt]}),He.splice(He.lastIndexOf(mt,He.length-_t),1)):_t++,jt=He[He.length-at],je.push({command:jr.addLayer,args:[De[mt],jt]}),He.splice(He.length-at,0,mt),Xe[mt]=!0);for(at=0;at<Ve.length;at++)if(mt=Ve[at],It=Le[mt],Ht=De[mt],!Xe[mt]&&!Z(It,Ht))if(Z(It.source,Ht.source)&&Z(It["source-layer"],Ht["source-layer"])&&Z(It.type,Ht.type)){for(Rt in ki(It.layout,Ht.layout,je,mt,null,jr.setLayoutProperty),ki(It.paint,Ht.paint,je,mt,null,jr.setPaintProperty),Z(It.filter,Ht.filter)||je.push({command:jr.setFilter,args:[mt,Ht.filter]}),Z(It.minzoom,Ht.minzoom)&&Z(It.maxzoom,Ht.maxzoom)||je.push({command:jr.setLayerZoomRange,args:[mt,Ht.minzoom,Ht.maxzoom]}),It)It.hasOwnProperty(Rt)&&"layout"!==Rt&&"paint"!==Rt&&"filter"!==Rt&&"metadata"!==Rt&&"minzoom"!==Rt&&"maxzoom"!==Rt&&(0===Rt.indexOf("paint.")?ki(It[Rt],Ht[Rt],je,mt,Rt.slice(6),jr.setPaintProperty):Z(It[Rt],Ht[Rt])||je.push({command:jr.setLayerProperty,args:[mt,Rt,Ht[Rt]]}));for(Rt in Ht)Ht.hasOwnProperty(Rt)&&!It.hasOwnProperty(Rt)&&"layout"!==Rt&&"paint"!==Rt&&"filter"!==Rt&&"metadata"!==Rt&&"minzoom"!==Rt&&"maxzoom"!==Rt&&(0===Rt.indexOf("paint.")?ki(It[Rt],Ht[Rt],je,mt,Rt.slice(6),jr.setPaintProperty):Z(It[Rt],Ht[Rt])||je.push({command:jr.setLayerProperty,args:[mt,Rt,Ht[Rt]]}))}else je.push({command:jr.removeLayer,args:[mt]}),jt=He[He.lastIndexOf(mt)+1],je.push({command:jr.addLayer,args:[Ht,jt]})}(Q,M.layers,O)}catch(N){console.warn("Unable to compute style diff:",N),O=[{command:jr.setStyle,args:[M]}]}return O}(this.serialize(),i).filter(E=>!(E.command in Ms));if(0===h.length)return!1;const _=h.filter(E=>!(E.command in qi));if(_.length>0)throw new Error(`Unimplemented: ${_.map(E=>E.command).join(", ")}.`);return h.forEach(E=>{"setTransition"!==E.command&&"setProjection"!==E.command&&this[E.command].apply(this,E.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,h){return this.getImage(i)?this.fire(new c.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,h),this._afterImageUpdated(i),this)}updateImage(i,h){this.imageManager.updateImage(i,h)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new c.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,h,_={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(c.validateSource,`sources.${i}`,h,null,_))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const E=Ot(i,h,this.dispatcher,this);E.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:E.serialize(),sourceId:i}));const M=O=>{const N=(O?"symbol:":"other:")+i,B=this._sourceCaches[N]=new c.SourceCache(N,E,O);(O?this._symbolSourceCaches:this._otherSourceCaches)[i]=B,B.style=this,B.onAdd(this.map)};M(!1),"vector"!==h.type&&"geojson"!==h.type||M(!0),E.onAdd&&E.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const h=this.getSource(i);if(!h)throw new Error("There is no source with this ID");for(const E in this._layers)if(this._layers[E].source===i)return this.fire(new c.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${E}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new c.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(i);for(const E of _)delete this._sourceCaches[E.id],delete this._updatedSources[E.id],E.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:E.getSource().id})),E.setEventedParent(null),E.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],h.setEventedParent(null),h.onRemove&&h.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,h){this._checkLoaded(),this.getSource(i).setData(h),this._changed=!0}getSource(i){const h=this._getSourceCache(i);return h&&h.getSource()}_getSources(){const i=[];for(const h in this._otherSourceCaches){const _=this._getSourceCache(h);_&&i.push(_.getSource())}return i}addLayer(i,h,_={}){this._checkLoaded();const E=i.id;if(this.getLayer(E))return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${E}" already exists on this map`)));let M;if("custom"===i.type){if(Ao(this,c.validateCustomStyleLayer(i)))return;M=c.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(E,i.source),i=c.clone$1(i),i=c.extend(i,{source:E})),this._validate(c.validateLayer,`layers.${E}`,i,{arrayIndex:-1},_))return;M=c.createStyleLayer(i),this._validateLayer(M),M.setEventedParent(this,{layer:{id:E}}),this._serializedLayers[M.id]=M.serialize(),this._updateLayerCount(M,!0)}const O=h?this._order.indexOf(h):this._order.length;if(h&&-1===O)return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`)));this._order.splice(O,0,E),this._layerOrderChanged=!0,this._layers[E]=M;const N=this._getLayerSourceCache(M);if(this._removedLayers[E]&&M.source&&N&&"custom"!==M.type){const B=this._removedLayers[E];delete this._removedLayers[E],B.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",N.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,h){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===h)return;const _=this._order.indexOf(i);this._order.splice(_,1);const E=h?this._order.indexOf(h):this._order.length;h&&-1===E?this.fire(new c.ErrorEvent(new Error(`Layer with id "${h}" does not exist on this map.`))):(this._order.splice(E,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const h=this._layers[i];if(!h)return void this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));h.setEventedParent(null),this._updateLayerCount(h,!1);const _=this._order.indexOf(i);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=h,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],h.onRemove&&h.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const h in this._layers)if(this._layers[h].type===i)return!0;return!1}setLayerZoomRange(i,h,_){this._checkLoaded();const E=this.getLayer(i);E?E.minzoom===h&&E.maxzoom===_||(null!=h&&(E.minzoom=h),null!=_&&(E.maxzoom=_),this._updateLayer(E)):this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,h,_={}){this._checkLoaded();const E=this.getLayer(i);if(E){if(!Z(E.filter,h))return null==h?(E.filter=void 0,void this._updateLayer(E)):void(this._validate(c.validateFilter,`layers.${E.id}.filter`,h,{layerType:E.type},_)||(E.filter=c.clone$1(h),this._updateLayer(E)))}else this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const h=this.getLayer(i);return h&&c.clone$1(h.filter)}setLayoutProperty(i,h,_,E={}){this._checkLoaded();const M=this.getLayer(i);M?Z(M.getLayoutProperty(h),_)||(M.setLayoutProperty(h,_,E),this._updateLayer(M)):this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,h){const _=this.getLayer(i);if(_)return _.getLayoutProperty(h);this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,h,_,E={}){this._checkLoaded();const M=this.getLayer(i);M?Z(M.getPaintProperty(h),_)||(M.setPaintProperty(h,_,E)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,h){const _=this.getLayer(i);return _&&_.getPaintProperty(h)}setFeatureState(i,h){this._checkLoaded();const _=i.source,E=i.sourceLayer,M=this.getSource(_);if(!M)return void this.fire(new c.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const O=M.type;if("geojson"===O&&E)return void this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===O&&!E)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided.")));const N=this._getSourceCaches(_);for(const B of N)B.setFeatureState(E,i.id,h)}removeFeatureState(i,h){this._checkLoaded();const _=i.source,E=this.getSource(_);if(!E)return void this.fire(new c.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const M=E.type,O="vector"===M?i.sourceLayer:void 0;if("vector"===M&&!O)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(h&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const N=this._getSourceCaches(_);for(const B of N)B.removeFeatureState(O,i.id,h)}getFeatureState(i){this._checkLoaded();const h=i.source,_=i.sourceLayer,E=this.getSource(h);if(E){if("vector"!==E.type||_)return void 0===i.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(h)[0].getFeatureState(_,i.id);this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new c.ErrorEvent(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const h in this._sourceCaches){const _=this._sourceCaches[h].getSource();i[_.id]||(i[_.id]=_.serialize())}return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},h=>void 0!==h)}_updateLayer(i){this._updatedLayers[i.id]=!0;const h=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&h&&"raster"!==h.getSource().type&&(this._updatedSources[i.source]="reload",h.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const h=O=>"fill-extrusion"===this._layers[O].type,_={},E=[];for(let O=this._order.length-1;O>=0;O--){const N=this._order[O];if(h(N)){_[N]=O;for(const B of i){const Q=B[N];if(Q)for(const J of Q)E.push(J)}}}E.sort((O,N)=>N.intersectionZ-O.intersectionZ);const M=[];for(let O=this._order.length-1;O>=0;O--){const N=this._order[O];if(h(N))for(let B=E.length-1;B>=0;B--){const Q=E[B].feature;if(_[Q.layer.id]<O)break;M.push(Q),E.pop()}else for(const B of i){const Q=B[N];if(Q)for(const J of Q)M.push(J.feature)}}return M}queryRenderedFeatures(i,h,_){h&&h.filter&&this._validate(c.validateFilter,"queryRenderedFeatures.filter",h.filter,null,h);const E={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const B of h.layers){const Q=this._layers[B];if(!Q)return this.fire(new c.ErrorEvent(new Error(`The layer '${B}' does not exist in the map's style and cannot be queried for features.`))),[];E[Q.source]=!0}}const M=[];h.availableImages=this._availableImages;const O=h&&h.layers?h.layers.some(B=>{const Q=this.getLayer(B);return Q&&Q.is3D()}):this.has3DLayers(),N=Vt.createFromScreenPoints(i,_);for(const B in this._sourceCaches){const Q=this._sourceCaches[B].getSource().id;h.layers&&!E[Q]||M.push(Ct(this._sourceCaches[B],this._layers,this._serializedLayers,N,h,_,O,!!this.map._showQueryGeometry))}return this.placement&&M.push(function(B,Q,J,fe,Ie,je,Be){const Ve={},Le=je.queryRenderedSymbols(fe),De=[];for(const He of Object.keys(Le).map(Number))De.push(Be[He]);De.sort(Rr);for(const He of De){const Xe=He.featureIndex.lookupSymbolFeatures(Le[He.bucketInstanceId],Q,He.bucketIndex,He.sourceLayerIndex,Ie.filter,Ie.layers,Ie.availableImages,B);for(const at in Xe){const _t=Ve[at]=Ve[at]||[],mt=Xe[at];mt.sort((It,Ht)=>{const jt=He.featureSortOrder;if(jt){const Rt=jt.indexOf(It.featureIndex);return jt.indexOf(Ht.featureIndex)-Rt}return Ht.featureIndex-It.featureIndex});for(const It of mt)_t.push(It)}}for(const He in Ve)Ve[He].forEach(Xe=>{const at=Xe.feature,_t=J(B[He]).getFeatureState(at.layer["source-layer"],at.id);at.source=at.layer.source,at.layer["source-layer"]&&(at.sourceLayer=at.layer["source-layer"]),at.state=_t});return Ve}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),N.screenGeometry,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(M)}querySourceFeatures(i,h){h&&h.filter&&this._validate(c.validateFilter,"querySourceFeatures.filter",h.filter,null,h);const _=this._getSourceCaches(i);let E=[];for(const M of _)E=E.concat(sr(M,h));return E}addSourceType(i,h,_){return ps.getSourceType(i)?_(new Error(`A source type called "${i}" already exists.`)):(ps.setSourceType(i,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:h.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(i,h={}){this._checkLoaded();const _=this.light.getLight();let E=!1;for(const O in i)if(!Z(i[O],_[O])){E=!0;break}if(!E)return;const M=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,h),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,h=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===h){if("object"==typeof i.source){const _="terrain-dem-src";this.addSource(_,i.source),i=c.clone$1(i),i=c.extend(i,{source:_})}if(this._validate(c.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&h!==this.terrain.drapeRenderMode)this._createTerrain(i,h);else{const _=this.terrain,E=_.get();for(const M of Object.keys(c.spec.terrain))!i.hasOwnProperty(M)&&c.spec.terrain[M].default&&(i[M]=c.spec.terrain[M].default);for(const M in i)if(!Z(i[M],E[M])){_.set(i),this.stylesheet.terrain=i;const O=this._setTransitionParameters({duration:0});_.updateTransitions(O);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const h=this.fog=new bt(i,this.map.transform);this.stylesheet.fog=i;const _=this._setTransitionParameters({duration:0});h.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const h=this.fog,_=h.get();0===Object.keys(i).length&&h.set(i);for(const E in i)if(!Z(i[E],_[E])){h.set(i),this.stylesheet.fog=i;const M=this._setTransitionParameters({duration:0});h.updateTransitions(M);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:c.exported.now(),transition:c.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(_=>this.isLayerDraped(this._layers[_])),h=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...h)}_createTerrain(i,h){const _=this.terrain=new Nt(i,h);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const E=this._setTransitionParameters({duration:0});_.updateTransitions(E)}_force3DLayerUpdate(){for(const i in this._layers){const h=this._layers[i];"fill-extrusion"===h.type&&this._updateLayer(h)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const h=this._layers[i];"symbol"===h.type&&this._updateLayer(h)}}_validate(i,h,_,E,M={}){return(!M||!1!==M.validate)&&Ao(this,i.call(c.validateStyle,c.extend({key:h,style:this.serialize(),value:_,styleSpec:c.spec},E)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const h=this._getSourceCaches(i);for(const _ of h)_.clearTiles()}_reloadSource(i){const h=this._getSourceCaches(i);for(const _ of h)_.resume(),_.reload()}_reloadSources(){for(const i of this._getSources())i.reload&&i.reload()}_updateSources(i){for(const h in this._sourceCaches)this._sourceCaches[h].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const h=this._sourceCaches[i];h.resume(),h.reload()}}_updatePlacement(i,h,_,E,M=!1){let O=!1,N=!1;const B={};for(const Q of this._order){const J=this._layers[Q];if("symbol"!==J.type)continue;if(!B[J.source]){const Ie=this._getLayerSourceCache(J);if(!Ie)continue;B[J.source]=Ie.getRenderableIds(!0).map(je=>Ie.getTileByID(je)).sort((je,Be)=>Be.tileID.overscaledZ-je.tileID.overscaledZ||(je.tileID.isLessThan(Be.tileID)?-1:1))}const fe=this.crossTileSymbolIndex.addLayer(J,B[J.source],i.center.lng,i.projection);O=O||fe}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),M=M||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new c.Event("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),i.zoom))&&(this.pauseablePlacement=new ji(i,this._order,M,h,_,E,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,B),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),N=!0),O&&this.pauseablePlacement.placement.setStale()),N||O)for(const Q of this._order){const J=this._layers[Q];"symbol"===J.type&&this.placement.updateLayerOpacities(J,B[J.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,h,_){this.imageManager.getImages(h.icons,_),this._updateTilesForChangedImages();const E=M=>{M&&M.setDependencies(h.tileID.key,h.type,h.icons)};E(this._otherSourceCaches[h.source]),E(this._symbolSourceCaches[h.source])}getGlyphs(i,h,_){this.glyphManager.getGlyphs(h.stacks,_)}getResource(i,h,_){return c.makeRequest(h,_)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const h=[];return this._otherSourceCaches[i]&&h.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&h.push(this._symbolSourceCaches[i]),h}_isSourceCacheLoaded(i){const h=this._getSourceCaches(i);return 0===h.length?(this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):h.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ps.getSourceType=function(g){return Dt[g]},ps.setSourceType=function(g,i){Dt[g]=i},ps.registerForPluginStateChange=c.registerForPluginStateChange;var lu="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",la="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ku="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Yu="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",ys="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let sl={},$o={};const Fa=[];Al(lu,Fa),Al(ku,Fa),Al(Yu,Fa),Al(ys,Fa),sl=wi("",ku),$o=wi(ys,Yu);const La=wi("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Wl=lu,lo="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var _n={background:wi("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:wi("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:wi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:wi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:wi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:wi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:wi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:wi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:wi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:wi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:wi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:wi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:wi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:wi("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:wi("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:wi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:wi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:wi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:wi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:wi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:wi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:wi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:wi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:wi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:wi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:wi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",la),skyboxGradient:wi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",la),skyboxCapture:wi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:wi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:wi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Al(g,i){const h=g.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of h)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const E=_.split(" ");for(const M of E)i.includes(M)||i.push(M)}}function wi(g,i){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),E={},M=[...Fa];return Al(g,M),Al(i,M),{fragmentSource:g=g.replace(h,(O,N,B,Q,J)=>(E[J]=!0,"define"===N?`\n#ifndef HAS_UNIFORM_u_${J}\nvarying ${B} ${Q} ${J};\n#else\nuniform ${B} ${Q} u_${J};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${J}\n    ${B} ${Q} ${J} = u_${J};\n#endif\n`)),vertexSource:i=i.replace(h,(O,N,B,Q,J)=>{const fe="float"===Q?"vec2":"vec4",Ie=J.match(/color/)?"color":fe;return E[J]?"define"===N?`\n#ifndef HAS_UNIFORM_u_${J}\nuniform lowp float u_${J}_t;\nattribute ${B} ${fe} a_${J};\nvarying ${B} ${Q} ${J};\n#else\nuniform ${B} ${Q} u_${J};\n#endif\n`:"vec4"===Ie?`\n#ifndef HAS_UNIFORM_u_${J}\n    ${J} = a_${J};\n#else\n    ${B} ${Q} ${J} = u_${J};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${J}\n    ${J} = unpack_mix_${Ie}(a_${J}, u_${J}_t);\n#else\n    ${B} ${Q} ${J} = u_${J};\n#endif\n`:"define"===N?`\n#ifndef HAS_UNIFORM_u_${J}\nuniform lowp float u_${J}_t;\nattribute ${B} ${fe} a_${J};\n#else\nuniform ${B} ${Q} u_${J};\n#endif\n`:"vec4"===Ie?`\n#ifndef HAS_UNIFORM_u_${J}\n    ${B} ${Q} ${J} = a_${J};\n#else\n    ${B} ${Q} ${J} = u_${J};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${J}\n    ${B} ${Q} ${J} = unpack_mix_${Ie}(a_${J}, u_${J}_t);\n#else\n    ${B} ${Q} ${J} = u_${J};\n#endif\n`}),staticAttributes:_,usedDefines:M}}class ua{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,h,_,E,M,O,N){this.context=i;let B=this.boundPaintVertexBuffers.length!==E.length;for(let J=0;!B&&J<E.length;J++)this.boundPaintVertexBuffers[J]!==E[J]&&(B=!0);let Q=this.boundDynamicVertexBuffers.length!==N.length;for(let J=0;!Q&&J<N.length;J++)this.boundDynamicVertexBuffers[J]!==N[J]&&(Q=!0);if(!i.extVertexArrayObject||!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==_||B||Q||this.boundIndexBuffer!==M||this.boundVertexOffset!==O)this.freshBind(h,_,E,M,O,N);else{i.bindVertexArrayOES.set(this.vao);for(const J of N)J&&J.bind();M&&M.dynamicDraw&&M.bind()}}freshBind(i,h,_,E,M,O){let N;const B=i.numAttributes,Q=this.context,J=Q.gl;if(Q.extVertexArrayObject)this.vao&&this.destroy(),this.vao=Q.extVertexArrayObject.createVertexArrayOES(),Q.bindVertexArrayOES.set(this.vao),N=0,this.boundProgram=i,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=E,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=O;else{N=Q.currentNumAttributes||0;for(let fe=B;fe<N;fe++)J.disableVertexAttribArray(fe)}h.enableAttributes(J,i),h.bind(),h.setVertexAttribPointers(J,i,M);for(const fe of _)fe.enableAttributes(J,i),fe.bind(),fe.setVertexAttribPointers(J,i,M);for(const fe of O)fe&&(fe.enableAttributes(J,i),fe.bind(),fe.setVertexAttribPointers(J,i,M));E&&E.bind(),Q.currentNumAttributes=B}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function xa(g,i){const h=Math.pow(2,i.canonical.z),_=i.canonical.y;return[new c.MercatorCoordinate(0,_/h).toLngLat().lat,new c.MercatorCoordinate(0,(_+1)/h).toLngLat().lat]}function al(g,i,h,_,E,M,O){const N=g.context,B=N.gl,Q=h.fbo;if(!Q)return;g.prepareDrawTile();const J=g.useProgram("hillshade");N.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,Q.colorAttachment.get());const fe=((Ve,Le,De,He)=>{const Xe=De.paint.get("hillshade-shadow-color"),at=De.paint.get("hillshade-highlight-color"),_t=De.paint.get("hillshade-accent-color");let mt=De.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===De.paint.get("hillshade-illumination-anchor")&&(mt-=Ve.transform.angle);const It=!Ve.options.moving;return{u_matrix:He||Ve.transform.calculateProjMatrix(Le.tileID.toUnwrapped(),It),u_image:0,u_latrange:xa(0,Le.tileID),u_light:[De.paint.get("hillshade-exaggeration"),mt],u_shadow:Xe,u_highlight:at,u_accent:_t}})(g,h,_,g.terrain?i.projMatrix:null);g.prepareDrawProgram(N,J,i.toUnwrapped());const{tileBoundsBuffer:Ie,tileBoundsIndexBuffer:je,tileBoundsSegments:Be}=g.getTileBoundsBuffers(h);J.draw(N,B.TRIANGLES,E,M,O,c.CullFaceMode.disabled,fe,_.id,Ie,je,Be)}function Ya(g,i,h){if(!i.needsDEMTextureUpload)return;const _=g.context,E=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||g.getTileTexture(h.stride);const M=h.getPixels();i.demTexture?i.demTexture.update(M,{premultiply:!1}):i.demTexture=new c.Texture(_,M,E.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function ll(g,i,h,_,E,M){const O=g.context,N=O.gl;if(!i.dem)return;const B=i.dem;if(O.activeTexture.set(N.TEXTURE1),Ya(g,i,B),!i.demTexture)return;i.demTexture.bind(N.NEAREST,N.CLAMP_TO_EDGE);const Q=B.dim;O.activeTexture.set(N.TEXTURE0);let J=i.fbo;if(!J){const Be=new c.Texture(O,{width:Q,height:Q,data:null},N.RGBA);Be.bind(N.LINEAR,N.CLAMP_TO_EDGE),J=i.fbo=O.createFramebuffer(Q,Q,!0),J.colorAttachment.set(Be.texture)}O.bindFramebuffer.set(J.framebuffer),O.viewport.set([0,0,Q,Q]);const{tileBoundsBuffer:fe,tileBoundsIndexBuffer:Ie,tileBoundsSegments:je}=g.getMercatorTileBoundsBuffers();g.useProgram("hillshadePrepare").draw(O,N.TRIANGLES,_,E,M,c.CullFaceMode.disabled,((Be,Ve)=>{const Le=Ve.stride,De=c.create();return c.ortho(De,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(De,De,[0,-c.EXTENT,0]),{u_matrix:De,u_image:1,u_dimension:[Le,Le],u_zoom:Be.overscaledZ,u_unpack:Ve.unpackVector}})(i.tileID,B),h.id,fe,Ie,je),i.needsHillshadePrepare=!1}const ba=g=>({u_matrix:new c.UniformMatrix4f(g),u_image0:new c.Uniform1i(g),u_skirt_height:new c.Uniform1f(g)}),ni=(g,i)=>({u_matrix:g,u_image0:0,u_skirt_height:i}),wa=(g,i,h,_,E,M,O,N,B,Q,J,fe,Ie,je)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:h,u_zoom_transition:E,u_merc_center:M,u_image0:0,u_frustum_tl:O,u_frustum_tr:N,u_frustum_br:B,u_frustum_bl:Q,u_globe_pos:J,u_globe_radius:fe,u_viewport:Ie,u_grid_matrix:je?Float32Array.from(je):new Float32Array(9)});function Ri(g,i){return null!=g&&null!=i&&!(!g.hasData()||!i.hasData())&&null!=g.demTexture&&null!=i.demTexture&&g.tileID.key!==i.tileID.key}const vl=new class{constructor(){this.operations={}}newMorphing(g,i,h,_,E){if(g in this.operations){const M=this.operations[g];M.to.tileID.key!==h.tileID.key&&(M.queued=h)}else this.operations[g]={startTime:_,phase:0,duration:E,from:i,to:h,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const i=this.operations[g];return{from:i.from,to:i.to,phase:i.phase}}update(g){for(const i in this.operations){const h=this.operations[i];for(h.phase=(g-h.startTime)/h.duration;h.phase>=1||!this._validOp(h);)if(!this._nextOp(h,g)){delete this.operations[i];break}}}_nextOp(g,i){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=i,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Uo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ll(g,i){const h=1<<g.z;return!i&&(0===g.x||g.x===h-1)||0===g.y||g.y===h-1}const si=g=>({u_matrix:g});function xl(g,i,h,_,E){if(E>0){const M=c.exported.now(),O=(M-g.timeAdded)/E,N=i?(M-i.timeAdded)/E:-1,B=h.getSource(),Q=_.coveringZoomLevel({tileSize:B.tileSize,roundZoom:B.roundZoom}),J=!i||Math.abs(i.tileID.overscaledZ-Q)>Math.abs(g.tileID.overscaledZ-Q),fe=J&&g.refreshedUponExpiration?1:c.clamp(J?O:1-N,0,1);return g.refreshedUponExpiration&&O>=1&&(g.refreshedUponExpiration=!1),i?{opacity:1,mix:1-fe}:{opacity:fe,mix:0}}return{opacity:1,mix:0}}class wn extends c.SourceCache{constructor(i){const h={type:"raster-dem",maxzoom:i.transform.maxZoom},_=new Ue(Tn(),null),E=Ot("mock-dem",h,_,i.style);super("mock-dem",E,!1),E.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,h){i.state="loaded",h(null)}}class Dl extends c.SourceCache{constructor(i){const h=Ot("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new Ue(Tn(),null),i.style);super("proxy",h,!1),h.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,h,_){if(i.freezeTileCoverage)return;this.transform=i;const E=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((M,O)=>{if(M[O.key]="",!this._tiles[O.key]){const N=new c.Tile(O,this._source.tileSize*O.overscaleFactor(),i.tileZoom);N.state="loaded",this._tiles[O.key]=N}return M},{});for(const M in this._tiles)M in E||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(i){const h=this.proxyCachedFBO[i];if(void 0!==h){const _=Object.values(h);this.renderCachePool.push(..._),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ms extends c.OverscaledTileID{constructor(i,h,_){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=h,this.projMatrix=_}}class Wa extends c.Elevation{constructor(i,h){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,E,M]=function(B){const Q=new c.StructArrayLayout4i8,J=new c.StructArrayLayout3ui6;Q.reserve(17161),J.reserve(33800);const Ie=c.EXTENT/128,je=c.EXTENT+Ie/2,Be=je+Ie;for(let Le=-Ie;Le<Be;Le+=Ie)for(let De=-Ie;De<Be;De+=Ie){const He=De<0||De>je||Le<0||Le>je?24575:0,Xe=c.clamp(Math.round(De),0,c.EXTENT),at=c.clamp(Math.round(Le),0,c.EXTENT);Q.emplaceBack(Xe+He,at,Xe,at)}const Ve=(Le,De)=>{const He=131*De+Le;J.emplaceBack(He+1,He,He+131),J.emplaceBack(He+131,He+131+1,He+1)};for(let Le=1;Le<129;Le++)for(let De=1;De<129;De++)Ve(De,Le);return[0,129].forEach(Le=>{for(let De=0;De<130;De++)Ve(De,Le),Ve(Le,De)}),[Q,J,32768]}(),O=i.context;this.gridBuffer=O.createVertexBuffer(_,c.boundsAttributes.members),this.gridIndexBuffer=O.createIndexBuffer(E),this.gridSegments=c.SegmentVector.simpleSegment(0,0,_.length,E.length),this.gridNoSkirtSegments=c.SegmentVector.simpleSegment(0,0,_.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Dl(h.map),this.orthoMatrix=c.create(),c.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,c.EXTENT,0,c.EXTENT,0,1);const N=O.gl;this._overlapStencilMode=new c.StencilMode({func:N.GEQUAL,mask:255},0,255,N.KEEP,N.KEEP,N.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=h,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new wn(h.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,h,_){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const E=i.terrain.properties;this.sourceCache=0===i.terrain.drapeRenderMode?this._mockSourceCache:i._getSourceCache(E.get("source")),this._exaggeration=E.get("exaggeration");const M=()=>{this.sourceCache.used&&c.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const O=this.getScaledDemTileSize();this.sourceCache.update(h,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,M(),this._initializing=!0),M(),h.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(h),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&c.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const h=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const E=this.proxyCoords=h.getIds().map(B=>{const Q=h.getTileByID(B).tileID;return Q.projMatrix=_.calculateProjMatrix(Q.toUnwrapped()),Q});(function(B,Q){const J=Q.transform.pointCoordinate(Q.transform.getCameraPoint()),fe=new c.pointGeometry(J.x,J.y);B.sort((Ie,je)=>{if(je.overscaledZ-Ie.overscaledZ)return je.overscaledZ-Ie.overscaledZ;const Be=new c.pointGeometry(Ie.canonical.x+(1<<Ie.canonical.z)*Ie.wrap,Ie.canonical.y),Ve=new c.pointGeometry(je.canonical.x+(1<<je.canonical.z)*je.wrap,je.canonical.y),Le=fe.mult(1<<Ie.canonical.z);return Le.x-=.5,Le.y-=.5,Le.distSqr(Be)-Le.distSqr(Ve)})})(E,this.painter),this._previousZoom=_.zoom;const M=this.proxyToSource||{};this.proxyToSource={},E.forEach(B=>{this.proxyToSource[B.key]={}}),this.terrainTileForTile={};const O=this._style._sourceCaches;for(const B in O){const Q=O[B];if(!Q.used||(Q!==this.sourceCache&&this.resetTileLookupCache(Q.id),this._setupProxiedCoordsForOrtho(Q,i[B],M),Q.usedForTerrain))continue;const J=i[B];Q.getSource().reparseOverscaled&&this._assignTerrainTiles(J)}this.proxiedCoords[h.id]=E.map(B=>new ms(B,B.key,this.orthoMatrix)),this._assignTerrainTiles(E),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1,this._updateTimestamp=c.exported.now();const N={};this._visibleDemTiles=[];for(const B of this.proxyCoords){const Q=this.terrainTileForTile[B.key];if(!Q)continue;const J=Q.tileID.key;J in N||(this._visibleDemTiles.push(Q),N[J]=J)}}_assignTerrainTiles(i){this._initializing||i.forEach(h=>{if(this.terrainTileForTile[h.key])return;const _=this._findTileCoveringTileID(h,this.sourceCache);_&&(this.terrainTileForTile[h.key]=_)})}_prepareDEMTextures(){const i=this.painter.context,h=i.gl;for(const _ in this.terrainTileForTile){const E=this.terrainTileForTile[_],M=E.dem;!M||E.demTexture&&!E.needsDEMTextureUpload||(i.activeTexture.set(h.TEXTURE1),Ya(this.painter,E,M))}}_prepareDemTileUniforms(i,h,_,E){if(!h||null==h.demTexture)return!1;const M=i.tileID.canonical,O=Math.pow(2,h.tileID.canonical.z-M.z),N=E||"";return _[`u_dem_tl${N}`]=[M.x*O%1,M.y*O%1],_[`u_dem_scale${N}`]=O,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,h=i.gl;if(!this._emptyDepthBufferTexture){const _=new c.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new c.Texture(i,_,h.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const h=this._visibleDemTiles.reduce((_,E)=>{if(!E.dem)return _;const M=E.dem.tree.minimums[0];return M>0&&i++,_+M},0);return i?h/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,h=i.gl;i.activeTexture.set(h.TEXTURE2);const _=this._getLoadedAreaMinimum(),E=new c.RGBAImage({width:1,height:1},new Uint8Array(c.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(E,{premultiply:!1}):M=this._emptyDEMTexture=new c.Texture(i,E,h.RGBA,{premultiply:!1}),M}setupElevationDraw(i,h,_){const E=this.painter.context,M=E.gl,O=(N=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:c.DEMData.getUnpackVector(N),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var N;O.u_dem_size=this.sourceCache.getSource().tileSize,O.u_exaggeration=this.exaggeration();let B=null,Q=null,J=1;if(_&&_.morphing&&this._useVertexMorphing){const fe=_.morphing.srcDemTile,Ie=_.morphing.dstDemTile;J=_.morphing.phase,fe&&Ie&&(this._prepareDemTileUniforms(i,fe,O,"_prev")&&(Q=fe),this._prepareDemTileUniforms(i,Ie,O)&&(B=Ie))}if(Q&&B?(E.activeTexture.set(M.TEXTURE2),B.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE,M.NEAREST),E.activeTexture.set(M.TEXTURE4),Q.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE,M.NEAREST),O.u_dem_lerp=J):(B=this.terrainTileForTile[i.tileID.key],E.activeTexture.set(M.TEXTURE2),(this._prepareDemTileUniforms(i,B,O)?B.demTexture:this.emptyDEMTexture).bind(M.NEAREST,M.CLAMP_TO_EDGE)),E.activeTexture.set(M.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),this._depthFBO&&(O.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),O.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&B){const fe=(1<<B.tileID.canonical.z)*c.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;O.u_meter_to_dem=fe}if(_&&_.labelPlaneMatrixInv&&(O.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),h.setTerrainUniformValues(E,O),"globe"===this.painter.transform.projection.name){const fe=this.globeUniformValues(this.painter.transform,i.tileID.canonical,_&&_.useDenormalizedUpVectorScale);h.setGlobeUniformValues(E,fe)}}globeUniformValues(i,h,_){const E=i.projection;return{u_tile_tl_up:E.upVector(h,0,0),u_tile_tr_up:E.upVector(h,c.EXTENT,0),u_tile_br_up:E.upVector(h,c.EXTENT,c.EXTENT),u_tile_bl_up:E.upVector(h,0,c.EXTENT),u_tile_up_scale:_?c.GLOBE_METERS_TO_ECEF:E.upVectorScale(h,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const h=this.painter,_=this.painter.context;0!==i.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),h.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(E,M,O,N,B){if("globe"===E.transform.projection.name)!function(Q,J,fe,Ie,je){const Be=Q.context,Ve=Be.gl;let Le,De;const He=Q.options.showTerrainWireframe?2:0,Xe=Q.transform,at=c.globeUseCustomAntiAliasing(Q,Be,Xe),_t=(Tr,ir)=>{if(De===Tr)return;const vr=[Uo[Tr],"PROJECTION_GLOBE_VIEW"];at&&vr.push("CUSTOM_ANTIALIASING"),ir&&vr.push(Uo[He]),Le=Q.useProgram("globeRaster",null,vr),De=Tr},mt=Q.colorModeForRenderPass(),It=new c.DepthMode(Ve.LEQUAL,c.DepthMode.ReadWrite,Q.depthRangeFor3D);vl.update(je);const Ht=c.calculateGlobeMercatorMatrix(Xe),jt=[c.mercatorXfromLng(Xe.center.lng),c.mercatorYfromLat(Xe.center.lat)],Rt=He?[!1,!0]:[!1],Dr=Q.globeSharedBuffers,Ut=[Xe.width*c.exported.devicePixelRatio,Xe.height*c.exported.devicePixelRatio],pr=Float32Array.from(Xe.globeMatrix),er={useDenormalizedUpVectorScale:!0};if(Rt.forEach(Tr=>{De=-1;const ir=Tr?Ve.LINES:Ve.TRIANGLES;for(const vr of Ie){const Or=fe.getTile(vr),zt=c.StencilMode.disabled,Kt=J.prevTerrainTileForTile[vr.key],fn=J.terrainTileForTile[vr.key];Ri(Kt,fn)&&vl.newMorphing(vr.key,Kt,fn,je,250),Be.activeTexture.set(Ve.TEXTURE0),Or.texture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE);const Ln=vl.getMorphValuesForProxy(vr.key),gn=Ln?1:0;Ln&&c.extend$1(er,{morphing:{srcDemTile:Ln.from,dstDemTile:Ln.to,phase:c.easeCubicInOut(Ln.phase)}});const Nn=c.tileCornersToBounds(vr.canonical),gi=c.getLatitudinalLod(Nn.getCenter().lat),Pn=c.getGridMatrix(vr.canonical,Nn,gi,Xe.worldSize/Xe._pixelsPerMercatorPixel),Kr=c.globeNormalizeECEF(c.globeTileBounds(vr.canonical)),Do=wa(Xe.projMatrix,pr,Ht,Kr,c.globeToMercatorTransition(Xe.zoom),jt,Xe.frustumCorners.TL,Xe.frustumCorners.TR,Xe.frustumCorners.BR,Xe.frustumCorners.BL,Xe.globeCenterInViewSpace,Xe.globeRadius,Ut,Pn);if(_t(gn,Tr),J.setupElevationDraw(Or,Le,er),Q.prepareDrawProgram(Be,Le,vr.toUnwrapped()),Dr){const[mo,Yo,yo]=Tr?Dr.getWirefameBuffers(Q.context,gi):Dr.getGridBuffers(gi);Le.draw(Be,ir,It,zt,mt,c.CullFaceMode.backCCW,Do,"globe_raster",mo,Yo,yo)}}}),Dr){const Tr=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];at&&Tr.push("CUSTOM_ANTIALIASING"),Le=Q.useProgram("globeRaster",null,Tr);for(const ir of Ie){const{x:vr,y:Or,z:zt}=ir.canonical,Kt=0===Or,fn=Or===(1<<zt)-1,[Ln,gn,Nn,gi]=Dr.getPoleBuffers(zt);if(gi&&(Kt||fn)){const Pn=fe.getTile(ir);Be.activeTexture.set(Ve.TEXTURE0),Pn.texture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE);let Kr=c.globePoleMatrixForTile(zt,vr,Xe);const Do=c.globeNormalizeECEF(c.globeTileBounds(ir.canonical)),mo=(Yo,yo)=>Yo.draw(Be,Ve.TRIANGLES,It,c.StencilMode.disabled,mt,c.CullFaceMode.disabled,wa(Xe.projMatrix,Kr,Kr,Do,0,jt,Xe.frustumCorners.TL,Xe.frustumCorners.TR,Xe.frustumCorners.BR,Xe.frustumCorners.BL,Xe.globeCenterInViewSpace,Xe.globeRadius,Ut),"globe_pole_raster",yo,Nn,gi);J.setupElevationDraw(Pn,Le,er),Q.prepareDrawProgram(Be,Le,ir.toUnwrapped()),Kt&&mo(Le,Ln),fn&&(Kr=c.scale(c.create(),Kr,[1,-1,1]),mo(Le,gn))}}}}(E,M,O,N,B);else{const Q=E.context,J=Q.gl;let fe,Ie;const je=E.options.showTerrainWireframe?2:0,Be=(Xe,at)=>{if(Ie===Xe)return;const _t=[Uo[Xe]];at&&_t.push(Uo[je]),fe=E.useProgram("terrainRaster",null,_t),Ie=Xe},Ve=E.colorModeForRenderPass(),Le=new c.DepthMode(J.LEQUAL,c.DepthMode.ReadWrite,E.depthRangeFor3D);vl.update(B);const De=E.transform,He=6*Math.pow(1.5,22-De.zoom)*M.exaggeration();(je?[!1,!0]:[!1]).forEach(Xe=>{Ie=-1;const at=Xe?J.LINES:J.TRIANGLES,[_t,mt]=Xe?M.getWirefameBuffer():[M.gridIndexBuffer,M.gridSegments];for(const It of N){const Ht=O.getTile(It),jt=c.StencilMode.disabled,Rt=M.prevTerrainTileForTile[It.key],Dr=M.terrainTileForTile[It.key];Ri(Rt,Dr)&&vl.newMorphing(It.key,Rt,Dr,B,250),Q.activeTexture.set(J.TEXTURE0),Ht.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST);const Ut=vl.getMorphValuesForProxy(It.key),pr=Ut?1:0;let er;Ut&&(er={morphing:{srcDemTile:Ut.from,dstDemTile:Ut.to,phase:c.easeCubicInOut(Ut.phase)}});const Tr=ni(It.projMatrix,Ll(It.canonical,De.renderWorldCopies)?He/10:He);Be(pr,Xe),M.setupElevationDraw(Ht,fe,er),E.prepareDrawProgram(Q,fe,It.toUnwrapped()),fe.draw(Q,at,Le,jt,Ve,c.CullFaceMode.backCCW,Tr,"terrain_raster",M.gridBuffer,_t,mt)}})}}(h,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,h.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const h=this.painter,_=this.painter.context,E=this.proxySourceCache,M=this.proxiedCoords[E.id],O=this._drapedRenderBatches.shift(),N=[],B=h.style.order;let Q=0;for(const J of M){const fe=E.getTileByID(J.proxyTileKey),Ie=E.proxyCachedFBO[J.key]?E.proxyCachedFBO[J.key][i]:void 0,je=void 0!==Ie?E.renderCache[Ie]:this.pool[Q++],Be=void 0!==Ie;if(fe.texture=je.tex,Be&&!je.dirty){N.push(fe.tileID);continue}let Ve;_.bindFramebuffer.set(je.fb.framebuffer),this.renderedToTile=!1,je.dirty&&(_.clear({color:c.Color.transparent,stencil:0}),je.dirty=!1);for(let Le=O.start;Le<=O.end;++Le){const De=h.style._layers[B[Le]];if(De.isHidden(h.transform.zoom))continue;const He=h.style._getLayerSourceCache(De),Xe=He?this.proxyToSource[J.key][He.id]:[J];if(!Xe)continue;const at=Xe;_.viewport.set([0,0,je.fb.width,je.fb.height]),Ve!==(He?He.id:null)&&(this._setupStencil(je,Xe,De,He),Ve=He?He.id:null),h.renderLayer(h,He,De,at)}this.renderedToTile?(je.dirty=!0,N.push(fe.tileID)):Be||--Q,5===Q&&(Q=0,this.renderToBackBuffer(N))}return this.renderToBackBuffer(N),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,h.width,h.height]),O.end+1}postRender(){}renderCacheEfficiency(i){const h=i.order.length;if(0===h)return{efficiency:100};let _,E=0,M=0,O=!1;for(let N=0;N<h;++N){const B=i._layers[i.order[N]];this._style.isLayerDraped(B)?(O&&++E,++M):O||(O=!0,_=B.id)}return 0===M?{efficiency:100}:{efficiency:100*(1-E/M),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(h=>h.dem).forEach(h=>{i=Math.min(i,h.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,h,_){if(!this._visibleDemTiles)return null;const E=this._visibleDemTiles.filter(M=>M.dem).map(M=>{const O=M.tileID,N=1<<O.overscaledZ,{x:B,y:Q}=O.canonical,J=B/N,fe=(B+1)/N,Ie=Q/N,je=(Q+1)/N;return{minx:J,miny:Ie,maxx:fe,maxy:je,t:M.dem.tree.raycastRoot(J,Ie,fe,je,i,h,_),tile:M}});E.sort((M,O)=>(null!==M.t?M.t:Number.MAX_VALUE)-(null!==O.t?O.t:Number.MAX_VALUE));for(const M of E){if(null==M.t)return null;const O=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,i,h,_);if(null!=O)return O}return null}_createFBO(){const i=this.painter.context,h=i.gl,_=this.drapeBufferSize;i.activeTexture.set(h.TEXTURE0);const E=new c.Texture(i,{width:_[0],height:_[1],data:null},h.RGBA);E.bind(h.LINEAR,h.CLAMP_TO_EDGE);const M=i.createFramebuffer(_[0],_[1],!1);return M.colorAttachment.set(E.texture),M.depthAttachment=new Cs(i,M.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&h.texParameterf(h.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:M,tex:E,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const h=this._style._layers[i],_=h.isHidden(this.painter.transform.zoom);return"custom"!==h.type&&!_&&h.hasTransition()})}_clearRasterFadeFromRenderCache(){let i=!1;for(const h in this._style._sourceCaches)if(this._style._sourceCaches[h]._source instanceof we){i=!0;break}if(i)for(let h=0;h<this._style.order.length;++h){const _=this._style._layers[this._style.order[h]],E=_.isHidden(this.painter.transform.zoom),M=this._style._getLayerSourceCache(_);if("raster"!==_.type||E||!M)continue;const O=_.paint.get("raster-fade-duration");for(const N of this.proxyCoords){const B=this.proxyToSource[N.key][M.id];if(B)for(const Q of B){const J=xl(M.getTile(Q),M.findLoadedParent(Q,0),M,this.painter.transform,O);(1!==J.opacity||0!==J.mix)&&this._clearRenderCacheForTile(M.id,Q)}}}}_setupDrapedRenderBatches(){const i=this._style.order,h=i.length;if(0===h)return;const _=[];let E,M=0,O=this._style._layers[i[M]];for(;!this._style.isLayerDraped(O)&&O.isHidden(this.painter.transform.zoom)&&++M<h;)O=this._style._layers[i[M]];for(;M<h;++M){const N=this._style._layers[i[M]];N.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(N)?void 0===E&&(E=M):void 0!==E&&(_.push({start:E,end:M-1}),E=void 0))}void 0!==E&&_.push({start:E,end:M-1}),this._drapedRenderBatches=_}_setupRenderCache(i){const h=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,h.renderCache.length>h.renderCachePool.length){const O=Object.values(h.proxyCachedFBO);h.proxyCachedFBO={};for(let N=0;N<O.length;++N){const B=Object.values(O[N]);h.renderCachePool.push(...B)}}return}this._clearRasterFadeFromRenderCache();const _=this.proxyCoords,E=this._tilesDirty;for(let O=_.length-1;O>=0;O--){const N=_[O];if(h.getTileByID(N.key),void 0!==h.proxyCachedFBO[N.key]){const B=i[N.key],Q=this.proxyToSource[N.key];let J=0;for(const fe in Q){const Ie=Q[fe],je=B[fe];if(!je||je.length!==Ie.length||Ie.some((Be,Ve)=>Be!==je[Ve]||E[fe]&&E[fe].hasOwnProperty(Be.key))){J=-1;break}++J}for(const fe in h.proxyCachedFBO[N.key])h.renderCache[h.proxyCachedFBO[N.key][fe]].dirty=J<0||J!==Object.values(B).length}}const M=[...this._drapedRenderBatches];M.sort((O,N)=>N.end-N.start-(O.end-O.start));for(const O of M)for(const N of _){if(h.proxyCachedFBO[N.key])continue;let B=h.renderCachePool.pop();void 0===B&&h.renderCache.length<50&&(B=h.renderCache.length,h.renderCache.push(this._createFBO())),void 0!==B&&(h.proxyCachedFBO[N.key]={},h.proxyCachedFBO[N.key][O.start]=B,h.renderCache[B].dirty=!0)}this._tilesDirty={}}_setupStencil(i,h,_,E){if(!E||!this._sourceTilesOverlap[E.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,O=M.gl;if(h.length<=1)return void(this._overlapStencilType=!1);let N;if(_.isTileClipped())N=h.length,this._overlapStencilMode.test={func:O.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(h[0].overscaledZ>h[h.length-1].overscaledZ))return void(this._overlapStencilType=!1);N=1,this._overlapStencilMode.test={func:O.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+N>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=N,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(h,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):c.StencilMode.disabled}_renderTileClippingMasks(i,h){const _=this.painter,E=this.painter.context,M=E.gl;_._tileClippingMaskIDs={},E.setColorMode(c.ColorMode.disabled),E.setDepthMode(c.DepthMode.disabled);const O=_.useProgram("clippingMask");for(const N of i){const B=_._tileClippingMaskIDs[N.key]=--h;O.draw(E,M.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:M.ALWAYS,mask:0},B,255,M.KEEP,M.KEEP,M.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,si(N.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(i){const h=this.painter.transform;if(i.x<0||i.x>h.width||i.y<0||i.y>h.height)return null;const _=[i.x,i.y,1,1];c.transformMat4$1(_,_,h.pixelMatrixInverse),c.scale$1(_,_,1/_[3]),_[0]/=h.worldSize,_[1]/=h.worldSize;const E=h._camera.position,M=c.mercatorZfromAltitude(1,h.center.lat),O=[E[0],E[1],E[2]/M,0],N=c.subtract([],_.slice(0,3),O);c.normalize(N,N);const B=this.raycast(O,N,this._exaggeration);return null!==B&&B?(c.scaleAndAdd(O,O,N,B),O[3]=O[2],O[2]*=M,O):null}drawDepth(){const i=this.painter,h=i.context,_=this.proxySourceCache,E=Math.ceil(i.width),M=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===E&&this._depthFBO.height===M||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const O=h.gl,N=h.createFramebuffer(E,M,!0);h.activeTexture.set(O.TEXTURE0);const B=new c.Texture(h,{width:E,height:M,data:null},O.RGBA);B.bind(O.NEAREST,O.CLAMP_TO_EDGE),N.colorAttachment.set(B.texture);const Q=h.createRenderbuffer(h.gl.DEPTH_COMPONENT16,E,M);N.depthAttachment.set(Q),this._depthFBO=N,this._depthTexture=B}h.bindFramebuffer.set(this._depthFBO.framebuffer),h.viewport.set([0,0,E,M]),function(O,N,B,Q){if("globe"===O.transform.projection.name)return;const J=O.context,fe=J.gl;J.clear({depth:1});const Ie=O.useProgram("terrainDepth"),je=new c.DepthMode(fe.LESS,c.DepthMode.ReadWrite,O.depthRangeFor3D);for(const Be of Q){const Ve=B.getTile(Be),Le=ni(Be.projMatrix,0);N.setupElevationDraw(Ve,Ie),Ie.draw(J,fe.TRIANGLES,je,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.backCCW,Le,"terrain_depth",N.gridBuffer,N.gridIndexBuffer,N.gridNoSkirtSegments)}}(i,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,h,_){if(i.getSource()instanceof dt)return this._setupProxiedCoordsForImageSource(i,h,_);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const E=this.proxiedCoords[i.id]=[],M=this.proxyCoords;for(let N=0;N<M.length;N++){const B=M[N],Q=this._findTileCoveringTileID(B,i);if(Q){const J=this._createProxiedId(B,Q,_[B.key]&&_[B.key][i.id]);E.push(J),this.proxyToSource[B.key][i.id]=[J]}}let O=!1;for(let N=0;N<h.length;N++){const B=i.getTile(h[N]);if(!B||!B.hasData())continue;const Q=this._findTileCoveringTileID(B.tileID,this.proxySourceCache);if(Q&&Q.tileID.canonical.z!==B.tileID.canonical.z){const J=this.proxyToSource[Q.tileID.key][i.id],fe=this._createProxiedId(Q.tileID,B,_[Q.tileID.key]&&_[Q.tileID.key][i.id]);J?J.splice(J.length-1,0,fe):this.proxyToSource[Q.tileID.key][i.id]=[fe],E.push(fe),O=!0}}this._sourceTilesOverlap[i.id]=O}_setupProxiedCoordsForImageSource(i,h,_){if(!i.getSource().loaded())return;const E=this.proxiedCoords[i.id]=[],M=this.proxyCoords,O=i.getSource(),N=new c.pointGeometry(O.tileID.x,O.tileID.y)._div(1<<O.tileID.z),B=O.coordinates.map(c.MercatorCoordinate.fromLngLat).reduce((J,fe)=>(J.min.x=Math.min(J.min.x,fe.x-N.x),J.min.y=Math.min(J.min.y,fe.y-N.y),J.max.x=Math.max(J.max.x,fe.x-N.x),J.max.y=Math.max(J.max.y,fe.y-N.y),J),{min:new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),Q=(J,fe)=>{const Ie=J.wrap+J.canonical.x/(1<<J.canonical.z),je=J.canonical.y/(1<<J.canonical.z),Be=c.EXTENT/(1<<J.canonical.z),Ve=fe.wrap+fe.canonical.x/(1<<fe.canonical.z),Le=fe.canonical.y/(1<<fe.canonical.z);return Ie+Be<Ve+B.min.x||Ie>Ve+B.max.x||je+Be<Le+B.min.y||je>Le+B.max.y};for(let J=0;J<M.length;J++){const fe=M[J];for(let Ie=0;Ie<h.length;Ie++){const je=i.getTile(h[Ie]);if(!je||!je.hasData()||Q(fe,je.tileID))continue;const Be=this._createProxiedId(fe,je,_[fe.key]&&_[fe.key][i.id]),Ve=this.proxyToSource[fe.key][i.id];Ve?Ve.push(Be):this.proxyToSource[fe.key][i.id]=[Be],E.push(Be)}}}_createProxiedId(i,h,_){let E=this.orthoMatrix;if(_){const M=_.find(O=>O.key===h.tileID.key);if(M)return M}if(h.tileID.key!==i.key){const M=i.canonical.z-h.tileID.canonical.z;let O,N,B;E=c.create();const Q=h.tileID.wrap-i.wrap<<i.overscaledZ;M>0?(O=c.EXTENT>>M,N=O*((h.tileID.canonical.x<<M)-i.canonical.x+Q),B=O*((h.tileID.canonical.y<<M)-i.canonical.y)):(O=c.EXTENT<<-M,N=c.EXTENT*(h.tileID.canonical.x-(i.canonical.x+Q<<-M)),B=c.EXTENT*(h.tileID.canonical.y-(i.canonical.y<<-M))),c.ortho(E,0,O,0,O,0,1),c.translate(E,E,[N,B,0])}return new ms(h.tileID,i.key,E)}_findTileCoveringTileID(i,h){let _=h.getTile(i);if(_&&_.hasData())return _;const E=this._findCoveringTileCache[h.id],M=E[i.key];if(_=M?h.getTileByID(M):null,_&&_.hasData()||null===M)return _;let O=_?_.tileID:i,N=O.overscaledZ;const B=h.getSource().minzoom,Q=[];if(!M){const fe=h.getSource().maxzoom;if(i.canonical.z>=fe){const Ie=i.canonical.z-fe;h.getSource().reparseOverscaled?(N=Math.max(i.canonical.z+2,h.transform.tileZoom),O=new c.OverscaledTileID(N,i.wrap,fe,i.canonical.x>>Ie,i.canonical.y>>Ie)):0!==Ie&&(N=fe,O=new c.OverscaledTileID(N,i.wrap,fe,i.canonical.x>>Ie,i.canonical.y>>Ie))}O.key!==i.key&&(Q.push(O.key),_=h.getTile(O))}const J=fe=>{Q.forEach(Ie=>{E[Ie]=fe}),Q.length=0};for(N-=1;N>=B&&(!_||!_.hasData());N--){_&&J(_.tileID.key);const fe=O.calculateScaledKey(N);if(_=h.getTileByID(fe),_&&_.hasData())break;const Ie=E[fe];if(null===Ie)break;void 0===Ie?Q.push(fe):_=h.getTileByID(Ie)}return J(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,h){let _=this._tilesDirty[i];_||(_=this._tilesDirty[i]={}),_[h.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(h){let _=0;const E=new c.StructArrayLayout2ui4,M=131;for(let O=1;O<129;O++){for(let N=1;N<129;N++)_=O*M+N,E.emplaceBack(_,_+1),E.emplaceBack(_,_+M),E.emplaceBack(_+1,_+M),128===O&&E.emplaceBack(_+M,_+M+1);E.emplaceBack(_+1,_+1+M)}return E}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=c.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class uu{static cacheKey(i,h,_,E){let M=`${h}${E?E.cacheKey:""}`;for(const O of _)i.usedDefines.includes(O)&&(M+=`/${O}`);return M}constructor(i,h,_,E,M,O){const N=i.gl;this.program=N.createProgram();const B=function(Le){const De=[];for(let He=0;He<Le.length;He++){if(null===Le[He])continue;const Xe=Le[He].split(" ");De.push(Xe.pop())}return De}(_.staticAttributes),Q=E?E.getBinderAttributes():[],J=B.concat(Q);let fe=E?E.defines():[];fe=fe.concat(O.map(Le=>`#define ${Le}`));const Ie=fe.concat(i.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(lo):lo,lo,Wl,La.fragmentSource,$o.fragmentSource,_.fragmentSource).join("\n"),je=fe.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Wl,La.vertexSource,$o.vertexSource,sl.vertexSource,_.vertexSource).join("\n"),Be=N.createShader(N.FRAGMENT_SHADER);if(N.isContextLost())return void(this.failedToCreate=!0);N.shaderSource(Be,Ie),N.compileShader(Be),N.attachShader(this.program,Be);const Ve=N.createShader(N.VERTEX_SHADER);if(N.isContextLost())this.failedToCreate=!0;else{N.shaderSource(Ve,je),N.compileShader(Ve),N.attachShader(this.program,Ve),this.attributes={},this.numAttributes=J.length;for(let Le=0;Le<this.numAttributes;Le++)J[Le]&&(N.bindAttribLocation(this.program,Le,J[Le]),this.attributes[J[Le]]=Le);N.linkProgram(this.program),N.deleteShader(Ve),N.deleteShader(Be),this.fixedUniforms=M(i),this.binderUniforms=E?E.getUniforms(i):[],O.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new c.Uniform1i(Le=i),u_dem_prev:new c.Uniform1i(Le),u_dem_unpack:new c.Uniform4f(Le),u_dem_tl:new c.Uniform2f(Le),u_dem_scale:new c.Uniform1f(Le),u_dem_tl_prev:new c.Uniform2f(Le),u_dem_scale_prev:new c.Uniform1f(Le),u_dem_size:new c.Uniform1f(Le),u_dem_lerp:new c.Uniform1f(Le),u_exaggeration:new c.Uniform1f(Le),u_depth:new c.Uniform1i(Le),u_depth_size_inv:new c.Uniform2f(Le),u_meter_to_dem:new c.Uniform1f(Le),u_label_plane_matrix_inv:new c.UniformMatrix4f(Le)}),O.includes("GLOBE")&&(this.globeUniforms=(Le=>({u_tile_tl_up:new c.Uniform3f(Le),u_tile_tr_up:new c.Uniform3f(Le),u_tile_br_up:new c.Uniform3f(Le),u_tile_bl_up:new c.Uniform3f(Le),u_tile_up_scale:new c.Uniform1f(Le)}))(i)),O.includes("FOG")&&(this.fogUniforms=(Le=>({u_fog_matrix:new c.UniformMatrix4f(Le),u_fog_range:new c.Uniform2f(Le),u_fog_color:new c.Uniform4f(Le),u_fog_horizon_blend:new c.Uniform1f(Le),u_fog_temporal_offset:new c.Uniform1f(Le),u_frustum_tl:new c.Uniform3f(Le),u_frustum_tr:new c.Uniform3f(Le),u_frustum_br:new c.Uniform3f(Le),u_frustum_bl:new c.Uniform3f(Le),u_globe_pos:new c.Uniform3f(Le),u_globe_radius:new c.Uniform1f(Le),u_globe_transition:new c.Uniform1f(Le),u_is_globe:new c.Uniform1i(Le),u_viewport:new c.Uniform2f(Le)}))(i))}var Le}setTerrainUniformValues(i,h){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const E in h)_[E]&&_[E].set(this.program,E,h[E])}}setGlobeUniformValues(i,h){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const E in h)_[E]&&_[E].set(this.program,E,h[E])}}setFogUniformValues(i,h){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const E in h)_[E].set(this.program,E,h[E])}}draw(i,h,_,E,M,O,N,B,Q,J,fe,Ie,je,Be,Ve){const Le=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(_),i.setStencilMode(E),i.setColorMode(M),i.setCullFace(O);for(const He of Object.keys(this.fixedUniforms))this.fixedUniforms[He].set(this.program,He,N[He]);Be&&Be.setUniforms(this.program,i,this.binderUniforms,Ie,{zoom:je});const De={[Le.LINES]:2,[Le.TRIANGLES]:3,[Le.LINE_STRIP]:1}[h];for(const He of fe.get()){const Xe=He.vaos||(He.vaos={});(Xe[B]||(Xe[B]=new ua)).bind(i,this,Q,Be?Be.getPaintVertexBuffers():[],J,He.vertexOffset,Ve||[]),Le.drawElements(h,He.primitiveLength*De,Le.UNSIGNED_SHORT,He.primitiveOffset*De*2)}}}function Ea(g,i){const h=Math.pow(2,i.tileID.overscaledZ),_=i.tileSize*Math.pow(2,g.transform.tileZoom)/h,E=_*(i.tileID.canonical.x+i.tileID.wrap*h),M=_*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_tile_units_to_pixels:1/Wt(i,1,g.transform.tileZoom),u_pixel_coord_upper:[E>>16,M>>16],u_pixel_coord_lower:[65535&E,65535&M]}}const Ii=c.create(),fs=(g,i,h,_,E,M,O,N,B,Q,J)=>{const fe=i.style.light,Ie=fe.properties.get("position"),je=[Ie.x,Ie.y,Ie.z],Be=c.create$1();"viewport"===fe.properties.get("anchor")&&(c.fromRotation(Be,-i.transform.angle),c.transformMat3(je,je,Be));const Ve=fe.properties.get("color"),Le=i.transform,De={u_matrix:g,u_lightpos:je,u_lightintensity:fe.properties.get("intensity"),u_lightcolor:[Ve.r,Ve.g,Ve.b],u_vertical_gradient:+h,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ii,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:E,u_edge_radius:M};return"globe"===Le.projection.name&&(De.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],De.u_zoom_transition=B,De.u_inv_rot_matrix=J,De.u_merc_center=Q,De.u_up_dir=Le.projection.upVector(new c.CanonicalTileID(0,0,0),Q[0]*c.EXTENT,Q[1]*c.EXTENT),De.u_height_lift=N),De},Bl=(g,i,h,_,E,M,O,N,B,Q,J,fe)=>{const Ie=fs(g,i,h,_,E,M,O,B,Q,J,fe),je={u_height_factor:-Math.pow(2,O.overscaledZ)/N.tileSize/8};return c.extend(Ie,Ea(i,N),je)},Is=g=>({u_matrix:g}),Fs=(g,i,h)=>c.extend(Is(g),Ea(i,h)),_s=(g,i)=>({u_matrix:g,u_world:i}),wu=(g,i,h,_)=>c.extend(Fs(g,i,h),{u_world:_}),Eu=c.create(),ul=(g,i,h,_,E,M)=>{const O=g.transform,N="globe"===O.projection.name;let B;if("map"===M.paint.get("circle-pitch-alignment"))if(N){const J=c.globePixelsToTileUnits(O.zoom,i.canonical)*O._pixelsPerMercatorPixel;B=Float32Array.from([J,0,0,J])}else B=O.calculatePixelsToTileUnitsMatrix(h);else B=new Float32Array([O.pixelsToGLUnits[0],0,0,O.pixelsToGLUnits[1]]);const Q={u_camera_to_center_distance:O.cameraToCenterDistance,u_matrix:g.translatePosMatrix(i.projMatrix,h,M.paint.get("circle-translate"),M.paint.get("circle-translate-anchor")),u_device_pixel_ratio:c.exported.devicePixelRatio,u_extrude_scale:B,u_inv_rot_matrix:Eu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(N){Q.u_inv_rot_matrix=_,Q.u_merc_center=E,Q.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],Q.u_zoom_transition=c.globeToMercatorTransition(O.zoom);const J=E[0]*c.EXTENT,fe=E[1]*c.EXTENT;Q.u_up_dir=O.projection.upVector(new c.CanonicalTileID(0,0,0),J,fe)}return Q},za=g=>{const i=[];return"map"===g.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===g.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},Ha=(g,i,h,_)=>{const E=c.EXTENT/h.tileSize;return{u_matrix:g,u_camera_to_center_distance:i.getCameraToCenterDistance(_),u_extrude_scale:[i.pixelsToGLUnits[0]/E,i.pixelsToGLUnits[1]/E]}},Qo=(g,i,h=1)=>({u_matrix:g,u_color:i,u_overlay:0,u_overlay_scale:h}),Ba=c.create(),Ua=(g,i,h,_,E,M,O)=>{const N=g.transform,B="globe"===N.projection.name,Q=B?c.globePixelsToTileUnits(N.zoom,i.canonical)*N._pixelsPerMercatorPixel:Wt(h,1,M),J={u_matrix:i.projMatrix,u_extrude_scale:Q,u_intensity:O,u_inv_rot_matrix:Ba,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){J.u_inv_rot_matrix=_,J.u_merc_center=E,J.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],J.u_zoom_transition=c.globeToMercatorTransition(N.zoom);const fe=E[0]*c.EXTENT,Ie=E[1]*c.EXTENT;J.u_up_dir=N.projection.upVector(new c.CanonicalTileID(0,0,0),fe,Ie)}return J},Lt=(g,i,h,_,E,M,O)=>{const N=g.transform,B=N.calculatePixelsToTileUnitsMatrix(i);return{u_matrix:An(g,i,h,_),u_pixels_to_tile_units:B,u_device_pixel_ratio:M,u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:E,u_texsize:go(h)?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:kr(i,g.transform),u_alpha_discard_threshold:0,u_trim_offset:O}},tr=(g,i,h,_,E)=>{const M=g.transform;return{u_matrix:An(g,i,h,_),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:M.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:E,u_image:0,u_tile_units_to_pixels:kr(i,M),u_units_to_pixels:[1/M.pixelsToGLUnits[0],1/M.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function kr(g,i){return 1/Wt(g,1,i.tileZoom)}function An(g,i,h,_){return g.translatePosMatrix(_||i.tileID.projMatrix,i,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}function go(g){const i=g.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const Un=(g,i,h,_,E,M)=>{return{u_matrix:g,u_tl_parent:i,u_scale_parent:h,u_fade_t:_.mix,u_opacity:_.opacity*E.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:E.paint.get("raster-brightness-min"),u_brightness_high:E.paint.get("raster-brightness-max"),u_saturation_factor:(N=E.paint.get("raster-saturation"),N>0?1-1/(1.001-N):-N),u_contrast_factor:(O=E.paint.get("raster-contrast"),O>0?1/(1-O):1+O),u_spin_weights:fo(E.paint.get("raster-hue-rotate")),u_perspective_transform:M};var O,N};function fo(g){g*=Math.PI/180;const i=Math.sin(g),h=Math.cos(g);return[(2*h+1)/3,(-Math.sqrt(3)*i-h+1)/3,(Math.sqrt(3)*i-h+1)/3]}const uo=c.create(),Sa=(g,i,h,_,E,M,O,N,B,Q,J,fe,Ie,je,Be,Ve)=>{const Le=E.transform,De={u_is_size_zoom_constant:+("constant"===g||"source"===g),u_is_size_feature_constant:+("constant"===g||"camera"===g),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:Le.cameraToCenterDistance,u_rotate_symbol:+h,u_aspect_ratio:Le.width/Le.height,u_fade_change:E.options.fadeDuration?E.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:O,u_coord_matrix:N,u_is_text:+B,u_pitch_with_map:+_,u_texsize:Q,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:uo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:uo,u_up_vector:[0,-1,0]};return"globe"===Ve.name&&(De.u_tile_id=[J.canonical.x,J.canonical.y,1<<J.canonical.z],De.u_zoom_transition=fe,De.u_inv_rot_matrix=je,De.u_merc_center=Ie,De.u_camera_forward=Le._camera.forward(),De.u_ecef_origin=c.globeECEFOrigin(Le.globeMatrix,J.toUnwrapped()),De.u_tile_matrix=Float32Array.from(Le.globeMatrix),De.u_up_vector=Be),De},Ni=(g,i,h,_,E,M,O,N,B,Q,J,fe,Ie,je,Be,Ve,Le)=>c.extend(Sa(g,i,h,_,E,M,O,N,B,Q,fe,Ie,je,Be,Ve,Le),{u_gamma_scale:_?E.transform.cameraToCenterDistance*Math.cos(E.terrain?0:E.transform._pitch):1,u_device_pixel_ratio:c.exported.devicePixelRatio,u_is_halo:+J}),os=(g,i,h,_,E,M,O,N,B,Q,J,fe,Ie,je,Be,Ve)=>c.extend(Ni(g,i,h,_,E,M,O,N,!0,B,!0,J,fe,Ie,je,Be,Ve),{u_texsize_icon:Q,u_texture_icon:1}),Da=(g,i,h)=>({u_matrix:g,u_opacity:i,u_color:h}),ca=(g,i,h,_,E)=>c.extend(function(M,O,N){const B=O.imageManager.getPattern(M.toString()),{width:Q,height:J}=O.imageManager.getPixelSize(),fe=Math.pow(2,N.tileID.overscaledZ),Ie=N.tileSize*Math.pow(2,O.transform.tileZoom)/fe,je=Ie*(N.tileID.canonical.x+N.tileID.wrap*fe),Be=Ie*N.tileID.canonical.y;return{u_image:0,u_pattern_tl:B.tl,u_pattern_br:B.br,u_texsize:[Q,J],u_pattern_size:B.displaySize,u_tile_units_to_pixels:1/Wt(N,1,O.transform.tileZoom),u_pixel_coord_upper:[je>>16,Be>>16],u_pixel_coord_lower:[65535&je,65535&Be]}}(_,h,E),{u_matrix:g,u_opacity:i}),Ca={fillExtrusion:g=>({u_matrix:new c.UniformMatrix4f(g),u_lightpos:new c.Uniform3f(g),u_lightintensity:new c.Uniform1f(g),u_lightcolor:new c.Uniform3f(g),u_vertical_gradient:new c.Uniform1f(g),u_opacity:new c.Uniform1f(g),u_edge_radius:new c.Uniform1f(g),u_ao:new c.Uniform2f(g),u_tile_id:new c.Uniform3f(g),u_zoom_transition:new c.Uniform1f(g),u_inv_rot_matrix:new c.UniformMatrix4f(g),u_merc_center:new c.Uniform2f(g),u_up_dir:new c.Uniform3f(g),u_height_lift:new c.Uniform1f(g)}),fillExtrusionPattern:g=>({u_matrix:new c.UniformMatrix4f(g),u_lightpos:new c.Uniform3f(g),u_lightintensity:new c.Uniform1f(g),u_lightcolor:new c.Uniform3f(g),u_vertical_gradient:new c.Uniform1f(g),u_height_factor:new c.Uniform1f(g),u_edge_radius:new c.Uniform1f(g),u_ao:new c.Uniform2f(g),u_tile_id:new c.Uniform3f(g),u_zoom_transition:new c.Uniform1f(g),u_inv_rot_matrix:new c.UniformMatrix4f(g),u_merc_center:new c.Uniform2f(g),u_up_dir:new c.Uniform3f(g),u_height_lift:new c.Uniform1f(g),u_image:new c.Uniform1i(g),u_texsize:new c.Uniform2f(g),u_pixel_coord_upper:new c.Uniform2f(g),u_pixel_coord_lower:new c.Uniform2f(g),u_tile_units_to_pixels:new c.Uniform1f(g),u_opacity:new c.Uniform1f(g)}),fill:g=>({u_matrix:new c.UniformMatrix4f(g)}),fillPattern:g=>({u_matrix:new c.UniformMatrix4f(g),u_image:new c.Uniform1i(g),u_texsize:new c.Uniform2f(g),u_pixel_coord_upper:new c.Uniform2f(g),u_pixel_coord_lower:new c.Uniform2f(g),u_tile_units_to_pixels:new c.Uniform1f(g)}),fillOutline:g=>({u_matrix:new c.UniformMatrix4f(g),u_world:new c.Uniform2f(g)}),fillOutlinePattern:g=>({u_matrix:new c.UniformMatrix4f(g),u_world:new c.Uniform2f(g),u_image:new c.Uniform1i(g),u_texsize:new c.Uniform2f(g),u_pixel_coord_upper:new c.Uniform2f(g),u_pixel_coord_lower:new c.Uniform2f(g),u_tile_units_to_pixels:new c.Uniform1f(g)}),circle:g=>({u_camera_to_center_distance:new c.Uniform1f(g),u_extrude_scale:new c.UniformMatrix2f(g),u_device_pixel_ratio:new c.Uniform1f(g),u_matrix:new c.UniformMatrix4f(g),u_inv_rot_matrix:new c.UniformMatrix4f(g),u_merc_center:new c.Uniform2f(g),u_tile_id:new c.Uniform3f(g),u_zoom_transition:new c.Uniform1f(g),u_up_dir:new c.Uniform3f(g)}),collisionBox:g=>({u_matrix:new c.UniformMatrix4f(g),u_camera_to_center_distance:new c.Uniform1f(g),u_extrude_scale:new c.Uniform2f(g)}),collisionCircle:g=>({u_matrix:new c.UniformMatrix4f(g),u_inv_matrix:new c.UniformMatrix4f(g),u_camera_to_center_distance:new c.Uniform1f(g),u_viewport_size:new c.Uniform2f(g)}),debug:g=>({u_color:new c.UniformColor(g),u_matrix:new c.UniformMatrix4f(g),u_overlay:new c.Uniform1i(g),u_overlay_scale:new c.Uniform1f(g)}),clippingMask:g=>({u_matrix:new c.UniformMatrix4f(g)}),heatmap:g=>({u_extrude_scale:new c.Uniform1f(g),u_intensity:new c.Uniform1f(g),u_matrix:new c.UniformMatrix4f(g),u_inv_rot_matrix:new c.UniformMatrix4f(g),u_merc_center:new c.Uniform2f(g),u_tile_id:new c.Uniform3f(g),u_zoom_transition:new c.Uniform1f(g),u_up_dir:new c.Uniform3f(g)}),heatmapTexture:g=>({u_image:new c.Uniform1i(g),u_color_ramp:new c.Uniform1i(g),u_opacity:new c.Uniform1f(g)}),hillshade:g=>({u_matrix:new c.UniformMatrix4f(g),u_image:new c.Uniform1i(g),u_latrange:new c.Uniform2f(g),u_light:new c.Uniform2f(g),u_shadow:new c.UniformColor(g),u_highlight:new c.UniformColor(g),u_accent:new c.UniformColor(g)}),hillshadePrepare:g=>({u_matrix:new c.UniformMatrix4f(g),u_image:new c.Uniform1i(g),u_dimension:new c.Uniform2f(g),u_zoom:new c.Uniform1f(g),u_unpack:new c.Uniform4f(g)}),line:g=>({u_matrix:new c.UniformMatrix4f(g),u_pixels_to_tile_units:new c.UniformMatrix2f(g),u_device_pixel_ratio:new c.Uniform1f(g),u_units_to_pixels:new c.Uniform2f(g),u_dash_image:new c.Uniform1i(g),u_gradient_image:new c.Uniform1i(g),u_image_height:new c.Uniform1f(g),u_texsize:new c.Uniform2f(g),u_tile_units_to_pixels:new c.Uniform1f(g),u_alpha_discard_threshold:new c.Uniform1f(g),u_trim_offset:new c.Uniform2f(g)}),linePattern:g=>({u_matrix:new c.UniformMatrix4f(g),u_texsize:new c.Uniform2f(g),u_pixels_to_tile_units:new c.UniformMatrix2f(g),u_device_pixel_ratio:new c.Uniform1f(g),u_image:new c.Uniform1i(g),u_units_to_pixels:new c.Uniform2f(g),u_tile_units_to_pixels:new c.Uniform1f(g),u_alpha_discard_threshold:new c.Uniform1f(g)}),raster:g=>({u_matrix:new c.UniformMatrix4f(g),u_tl_parent:new c.Uniform2f(g),u_scale_parent:new c.Uniform1f(g),u_fade_t:new c.Uniform1f(g),u_opacity:new c.Uniform1f(g),u_image0:new c.Uniform1i(g),u_image1:new c.Uniform1i(g),u_brightness_low:new c.Uniform1f(g),u_brightness_high:new c.Uniform1f(g),u_saturation_factor:new c.Uniform1f(g),u_contrast_factor:new c.Uniform1f(g),u_spin_weights:new c.Uniform3f(g),u_perspective_transform:new c.Uniform2f(g)}),symbolIcon:g=>({u_is_size_zoom_constant:new c.Uniform1i(g),u_is_size_feature_constant:new c.Uniform1i(g),u_size_t:new c.Uniform1f(g),u_size:new c.Uniform1f(g),u_camera_to_center_distance:new c.Uniform1f(g),u_rotate_symbol:new c.Uniform1i(g),u_aspect_ratio:new c.Uniform1f(g),u_fade_change:new c.Uniform1f(g),u_matrix:new c.UniformMatrix4f(g),u_label_plane_matrix:new c.UniformMatrix4f(g),u_coord_matrix:new c.UniformMatrix4f(g),u_is_text:new c.Uniform1i(g),u_pitch_with_map:new c.Uniform1i(g),u_texsize:new c.Uniform2f(g),u_tile_id:new c.Uniform3f(g),u_zoom_transition:new c.Uniform1f(g),u_inv_rot_matrix:new c.UniformMatrix4f(g),u_merc_center:new c.Uniform2f(g),u_camera_forward:new c.Uniform3f(g),u_tile_matrix:new c.UniformMatrix4f(g),u_up_vector:new c.Uniform3f(g),u_ecef_origin:new c.Uniform3f(g),u_texture:new c.Uniform1i(g)}),symbolSDF:g=>({u_is_size_zoom_constant:new c.Uniform1i(g),u_is_size_feature_constant:new c.Uniform1i(g),u_size_t:new c.Uniform1f(g),u_size:new c.Uniform1f(g),u_camera_to_center_distance:new c.Uniform1f(g),u_rotate_symbol:new c.Uniform1i(g),u_aspect_ratio:new c.Uniform1f(g),u_fade_change:new c.Uniform1f(g),u_matrix:new c.UniformMatrix4f(g),u_label_plane_matrix:new c.UniformMatrix4f(g),u_coord_matrix:new c.UniformMatrix4f(g),u_is_text:new c.Uniform1i(g),u_pitch_with_map:new c.Uniform1i(g),u_texsize:new c.Uniform2f(g),u_texture:new c.Uniform1i(g),u_gamma_scale:new c.Uniform1f(g),u_device_pixel_ratio:new c.Uniform1f(g),u_tile_id:new c.Uniform3f(g),u_zoom_transition:new c.Uniform1f(g),u_inv_rot_matrix:new c.UniformMatrix4f(g),u_merc_center:new c.Uniform2f(g),u_camera_forward:new c.Uniform3f(g),u_tile_matrix:new c.UniformMatrix4f(g),u_up_vector:new c.Uniform3f(g),u_ecef_origin:new c.Uniform3f(g),u_is_halo:new c.Uniform1i(g)}),symbolTextAndIcon:g=>({u_is_size_zoom_constant:new c.Uniform1i(g),u_is_size_feature_constant:new c.Uniform1i(g),u_size_t:new c.Uniform1f(g),u_size:new c.Uniform1f(g),u_camera_to_center_distance:new c.Uniform1f(g),u_rotate_symbol:new c.Uniform1i(g),u_aspect_ratio:new c.Uniform1f(g),u_fade_change:new c.Uniform1f(g),u_matrix:new c.UniformMatrix4f(g),u_label_plane_matrix:new c.UniformMatrix4f(g),u_coord_matrix:new c.UniformMatrix4f(g),u_is_text:new c.Uniform1i(g),u_pitch_with_map:new c.Uniform1i(g),u_texsize:new c.Uniform2f(g),u_texsize_icon:new c.Uniform2f(g),u_texture:new c.Uniform1i(g),u_texture_icon:new c.Uniform1i(g),u_gamma_scale:new c.Uniform1f(g),u_device_pixel_ratio:new c.Uniform1f(g),u_is_halo:new c.Uniform1i(g)}),background:g=>({u_matrix:new c.UniformMatrix4f(g),u_opacity:new c.Uniform1f(g),u_color:new c.UniformColor(g)}),backgroundPattern:g=>({u_matrix:new c.UniformMatrix4f(g),u_opacity:new c.Uniform1f(g),u_image:new c.Uniform1i(g),u_pattern_tl:new c.Uniform2f(g),u_pattern_br:new c.Uniform2f(g),u_texsize:new c.Uniform2f(g),u_pattern_size:new c.Uniform2f(g),u_pixel_coord_upper:new c.Uniform2f(g),u_pixel_coord_lower:new c.Uniform2f(g),u_tile_units_to_pixels:new c.Uniform1f(g)}),terrainRaster:ba,terrainDepth:ba,skybox:g=>({u_matrix:new c.UniformMatrix4f(g),u_sun_direction:new c.Uniform3f(g),u_cubemap:new c.Uniform1i(g),u_opacity:new c.Uniform1f(g),u_temporal_offset:new c.Uniform1f(g)}),skyboxGradient:g=>({u_matrix:new c.UniformMatrix4f(g),u_color_ramp:new c.Uniform1i(g),u_center_direction:new c.Uniform3f(g),u_radius:new c.Uniform1f(g),u_opacity:new c.Uniform1f(g),u_temporal_offset:new c.Uniform1f(g)}),skyboxCapture:g=>({u_matrix_3f:new c.UniformMatrix3f(g),u_sun_direction:new c.Uniform3f(g),u_sun_intensity:new c.Uniform1f(g),u_color_tint_r:new c.Uniform4f(g),u_color_tint_m:new c.Uniform4f(g),u_luminance:new c.Uniform1f(g)}),globeRaster:g=>({u_proj_matrix:new c.UniformMatrix4f(g),u_globe_matrix:new c.UniformMatrix4f(g),u_normalize_matrix:new c.UniformMatrix4f(g),u_merc_matrix:new c.UniformMatrix4f(g),u_zoom_transition:new c.Uniform1f(g),u_merc_center:new c.Uniform2f(g),u_image0:new c.Uniform1i(g),u_grid_matrix:new c.UniformMatrix3f(g),u_frustum_tl:new c.Uniform3f(g),u_frustum_tr:new c.Uniform3f(g),u_frustum_br:new c.Uniform3f(g),u_frustum_bl:new c.Uniform3f(g),u_globe_pos:new c.Uniform3f(g),u_globe_radius:new c.Uniform1f(g),u_viewport:new c.Uniform2f(g)}),globeAtmosphere:g=>({u_frustum_tl:new c.Uniform3f(g),u_frustum_tr:new c.Uniform3f(g),u_frustum_br:new c.Uniform3f(g),u_frustum_bl:new c.Uniform3f(g),u_horizon:new c.Uniform1f(g),u_transition:new c.Uniform1f(g),u_fadeout_range:new c.Uniform1f(g),u_color:new c.Uniform4f(g),u_high_color:new c.Uniform4f(g),u_space_color:new c.Uniform4f(g),u_star_intensity:new c.Uniform1f(g),u_star_density:new c.Uniform1f(g),u_star_size:new c.Uniform1f(g),u_temporal_offset:new c.Uniform1f(g),u_horizon_angle:new c.Uniform1f(g),u_rotation_matrix:new c.UniformMatrix4f(g)})};let Oa;function Ja(g,i,h,_,E,M,O){const N=g.context,B=N.gl,Q=g.transform,J=g.useProgram("collisionBox"),fe=[];let Ie=0,je=0;for(let at=0;at<_.length;at++){const _t=_[at],mt=i.getTile(_t),It=mt.getBucket(h);if(!It)continue;const Ht=Et(_t,It,Q);let jt=Ht;0===E[0]&&0===E[1]||(jt=g.translatePosMatrix(Ht,mt,E,M));const Rt=O?It.textCollisionBox:It.iconCollisionBox,Dr=It.collisionCircleArray;if(Dr.length>0){const Ut=c.create(),pr=jt;c.mul(Ut,It.placementInvProjMatrix,Q.glCoordMatrix),c.mul(Ut,Ut,It.placementViewportMatrix),fe.push({circleArray:Dr,circleOffset:je,transform:pr,invTransform:Ut,projection:It.getProjection()}),Ie+=Dr.length/4,je=Ie}Rt&&(g.terrain&&g.terrain.setupElevationDraw(mt,J),J.draw(N,B.LINES,c.DepthMode.disabled,c.StencilMode.disabled,g.colorModeForRenderPass(),c.CullFaceMode.disabled,Ha(jt,Q,mt,It.getProjection()),h.id,Rt.layoutVertexBuffer,Rt.indexBuffer,Rt.segments,null,Q.zoom,null,[Rt.collisionVertexBuffer,Rt.collisionVertexBufferExt]))}if(!O||!fe.length)return;const Be=g.useProgram("collisionCircle"),Ve=new c.StructArrayLayout2f1f2i16;Ve.resize(4*Ie),Ve._trim();let Le=0;for(const at of fe)for(let _t=0;_t<at.circleArray.length/4;_t++){const mt=4*_t,It=at.circleArray[mt+0],Ht=at.circleArray[mt+1],jt=at.circleArray[mt+2],Rt=at.circleArray[mt+3];Ve.emplace(Le++,It,Ht,jt,Rt,0),Ve.emplace(Le++,It,Ht,jt,Rt,1),Ve.emplace(Le++,It,Ht,jt,Rt,2),Ve.emplace(Le++,It,Ht,jt,Rt,3)}(!Oa||Oa.length<2*Ie)&&(Oa=function(at){const _t=2*at,mt=new c.StructArrayLayout3ui6;mt.resize(_t),mt._trim();for(let It=0;It<_t;It++){const Ht=6*It;mt.uint16[Ht+0]=4*It+0,mt.uint16[Ht+1]=4*It+1,mt.uint16[Ht+2]=4*It+2,mt.uint16[Ht+3]=4*It+2,mt.uint16[Ht+4]=4*It+3,mt.uint16[Ht+5]=4*It+0}return mt}(Ie));const De=N.createIndexBuffer(Oa,!0),He=N.createVertexBuffer(Ve,c.collisionCircleLayout.members,!0);for(const at of fe){const _t={u_matrix:at.transform,u_inv_matrix:at.invTransform,u_camera_to_center_distance:(Xe=Q).getCameraToCenterDistance(at.projection),u_viewport_size:[Xe.width,Xe.height]};Be.draw(N,B.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,g.colorModeForRenderPass(),c.CullFaceMode.disabled,_t,h.id,He,De,c.SegmentVector.simpleSegment(0,2*at.circleOffset,at.circleArray.length,at.circleArray.length/2),null,Q.zoom)}var Xe;He.destroy(),De.destroy()}const zs=c.create();function es({width:g,height:i,anchor:h,textOffset:_,textScale:E},M){const{horizontalAlign:O,verticalAlign:N}=c.getAnchorAlignment(h),B=-(O-.5)*g,Q=-(N-.5)*i,J=c.evaluateVariableOffset(h,_);return new c.pointGeometry((B/E+J[0])*M,(Q/E+J[1])*M)}function cl(g,i,h,_,E,M,O,N,B,Q,J){const fe=g.text.placedSymbolArray,Ie=g.text.dynamicLayoutVertexArray,je=g.icon.dynamicLayoutVertexArray,Be={},Ve=g.getProjection(),Le=Gt(N,Ve,M),De=M.elevation,He=Ve.upVectorScale(N.canonical,M.center.lat,M.worldSize).metersToTile;Ie.clear();for(let Xe=0;Xe<fe.length;Xe++){const at=fe.get(Xe),{tileAnchorX:_t,tileAnchorY:mt,numGlyphs:It}=at,Ht=g.allowVerticalPlacement&&!at.placedOrientation,jt=at.hidden||!at.crossTileID||Ht?null:_[at.crossTileID];if(jt){let Rt=0,Dr=0,Ut=0;if(De){const fn=De?De.getAtTileOffset(N,_t,mt):0,[Ln,gn,Nn]=Ve.upVector(N.canonical,_t,mt);Rt=fn*Ln*He,Dr=fn*gn*He,Ut=fn*Nn*He}let[pr,er,Tr,ir]=oi(at.projectedAnchorX+Rt,at.projectedAnchorY+Dr,at.projectedAnchorZ+Ut,h?Le:O);const vr=Nr(M.getCameraToCenterDistance(Ve),ir);let Or=E.evaluateSizeForFeature(g.textSizeData,Q,at)*vr/c.ONE_EM;h&&(Or*=g.tilePixelRatio/B);const zt=es(jt,Or);h?(({x:pr,y:er,z:Tr}=Ve.projectTilePoint(_t+zt.x,mt+zt.y,N.canonical)),[pr,er,Tr]=oi(pr+Rt,er+Dr,Tr+Ut,O)):(i&&zt._rotate(-M.angle),pr+=zt.x,er+=zt.y,Tr=0);const Kt=g.allowVerticalPlacement&&at.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let fn=0;fn<It;fn++)c.addDynamicAttributes(Ie,pr,er,Tr,Kt);J&&at.associatedIconIndex>=0&&(Be[at.associatedIconIndex]={x:pr,y:er,z:Tr,angle:Kt})}else Hs(It,Ie)}if(J){je.clear();const Xe=g.icon.placedSymbolArray;for(let at=0;at<Xe.length;at++){const _t=Xe.get(at),{numGlyphs:mt}=_t,It=Be[at];if(_t.hidden||!It)Hs(mt,je);else{const{x:Ht,y:jt,z:Rt,angle:Dr}=It;for(let Ut=0;Ut<mt;Ut++)c.addDynamicAttributes(je,Ht,jt,Rt,Dr)}}g.icon.dynamicLayoutVertexBuffer.updateData(je)}g.text.dynamicLayoutVertexBuffer.updateData(Ie)}function vs(g,i,h){return h.iconsInText&&i?"symbolTextAndIcon":g?"symbolSDF":"symbolIcon"}function Ks(g,i,h,_,E,M,O,N,B,Q,J,fe){const Ie=g.context,je=Ie.gl,Be=g.transform,Ve="map"===N,Le="map"===B,De=Ve&&"point"!==h.layout.get("symbol-placement"),He=Ve&&!Le&&!De,Xe=void 0!==h.layout.get("symbol-sort-key").constantOr(1);let at=!1;const _t=g.depthModeForSublayer(0,c.DepthMode.ReadOnly),mt=[c.mercatorXfromLng(Be.center.lng),c.mercatorYfromLat(Be.center.lat)],It=h.layout.get("text-variable-anchor"),Ht="globe"===Be.projection.name,jt=[],Rt=[0,-1,0];let Dr=Rt;!Ht&&!Be.mercatorFromTransition||Ve||(Dr=function(Ut){const pr=Ut._camera.getWorldToCamera(Ut.worldSize,1),er=c.multiply([],pr,Ut.globeMatrix);c.invert(er,er);const Tr=[0,0,0],ir=[0,1,0,0];return c.transformMat4$1(ir,ir,er),Tr[0]=ir[0],Tr[1]=ir[1],Tr[2]=ir[2],c.normalize(Tr,Tr),Tr}(Be));for(const Ut of _){const pr=i.getTile(Ut),er=pr.getBucket(h);if(!er||"mercator"===er.projection.name&&Ht)continue;const Tr=E?er.text:er.icon;if(!Tr||er.fullyClipped||!Tr.segments.get().length)continue;const ir=Tr.programConfigurations.get(h.id),vr=E||er.sdfIcons,Or=E?er.textSizeData:er.iconSizeData,zt=Le||0!==Be.pitch,Kt=c.evaluateSizeForZoom(Or,Be.zoom);let fn,Ln,gn,Nn,gi=[0,0],Pn=null;if(E){if(Ln=pr.glyphAtlasTexture,gn=je.LINEAR,fn=pr.glyphAtlasTexture.size,er.iconsInText){gi=pr.imageAtlasTexture.size,Pn=pr.imageAtlasTexture;const ii="composite"===Or.kind||"camera"===Or.kind;Nn=zt||g.options.rotating||g.options.zooming||ii?je.LINEAR:je.NEAREST}}else{const ii=1!==h.layout.get("icon-size").constantOr(0)||er.iconsNeedLinear;Ln=pr.imageAtlasTexture,gn=vr||g.options.rotating||g.options.zooming||ii||zt?je.LINEAR:je.NEAREST,fn=pr.imageAtlasTexture.size}const Kr="globe"===er.projection.name,Do=Kr?Dr:Rt,mo=Kr?c.globeToMercatorTransition(Be.zoom):0,Yo=Gt(Ut,er.getProjection(),Be),yo=Be.calculatePixelsToTileUnitsMatrix(pr),dl=Ko(Yo,pr.tileID.canonical,Le,Ve,Be,er.getProjection(),yo),El=g.terrain&&Le&&De?c.invert(c.create(),dl):zs,Sl=Pl(Yo,pr.tileID.canonical,Le,Ve,Be,er.getProjection(),yo),gu=It&&er.hasTextData(),rs="none"!==h.layout.get("icon-text-fit")&&gu&&er.hasIconData();if(De){const ii=Be.elevation,li=ii?ii.getAtTileOffsetFunc(Ut,Be.center.lat,Be.worldSize,er.getProjection()):null,ui=ks(Yo,pr.tileID.canonical,Le,Ve,Be,er.getProjection(),yo);ai(er,Yo,g,E,ui,Sl,Le,Q,li,Ut)}const Oo=De||E&&It||rs,Si=g.translatePosMatrix(Yo,pr,M,O),Us=Oo?zs:dl,Co=g.translatePosMatrix(Sl,pr,M,O,!0),Fi=er.getProjection().createInversionMatrix(Be,Ut.canonical),bo=[];g.terrainRenderModeElevated()&&Le&&bo.push("PITCH_WITH_MAP_TERRAIN"),Kr&&bo.push("PROJECTION_GLOBE_VIEW"),Oo&&bo.push("PROJECTED_POS_ON_VIEWPORT");const Gs=vr&&0!==h.paint.get(E?"text-halo-width":"icon-halo-width").constantOr(1);let fi;fi=vr?er.iconsInText?os(Or.kind,Kt,He,Le,g,Si,Us,Co,fn,gi,Ut,mo,mt,Fi,Do,er.getProjection()):Ni(Or.kind,Kt,He,Le,g,Si,Us,Co,E,fn,!0,Ut,mo,mt,Fi,Do,er.getProjection()):Sa(Or.kind,Kt,He,Le,g,Si,Us,Co,E,fn,Ut,mo,mt,Fi,Do,er.getProjection());const Yn={program:g.useProgram(vs(vr,E,er),ir,bo),buffers:Tr,uniformValues:fi,atlasTexture:Ln,atlasTextureIcon:Pn,atlasInterpolation:gn,atlasInterpolationIcon:Nn,isSDF:vr,hasHalo:Gs,tile:pr,labelPlaneMatrixInv:El};if(Xe&&er.canOverlap){at=!0;const ii=Tr.segments.get();for(const li of ii)jt.push({segments:new c.SegmentVector([li]),sortKey:li.sortKey,state:Yn})}else jt.push({segments:Tr.segments,sortKey:0,state:Yn})}at&&jt.sort((Ut,pr)=>Ut.sortKey-pr.sortKey);for(const Ut of jt){const pr=Ut.state;if(g.terrain&&g.terrain.setupElevationDraw(pr.tile,pr.program,{useDepthForOcclusion:!Ht,labelPlaneMatrixInv:pr.labelPlaneMatrixInv}),Ie.activeTexture.set(je.TEXTURE0),pr.atlasTexture.bind(pr.atlasInterpolation,je.CLAMP_TO_EDGE),pr.atlasTextureIcon&&(Ie.activeTexture.set(je.TEXTURE1),pr.atlasTextureIcon&&pr.atlasTextureIcon.bind(pr.atlasInterpolationIcon,je.CLAMP_TO_EDGE)),pr.isSDF){const er=pr.uniformValues;pr.hasHalo&&(er.u_is_halo=1,Ul(pr.buffers,Ut.segments,h,g,pr.program,_t,J,fe,er)),er.u_is_halo=0}Ul(pr.buffers,Ut.segments,h,g,pr.program,_t,J,fe,pr.uniformValues)}}function Ul(g,i,h,_,E,M,O,N,B){const Q=_.context,J=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.globeExtVertexBuffer];E.draw(Q,Q.gl.TRIANGLES,M,O,N,c.CullFaceMode.disabled,B,h.id,g.layoutVertexBuffer,g.indexBuffer,i,h.paint,_.transform.zoom,g.programConfigurations.get(h.id),J)}function vo(g,i,h,_,E,M,O){const N=g.context.gl,B=h.paint.get("fill-pattern"),Q=B&&B.constantOr(1);let J,fe,Ie,je,Be;O?(fe=Q&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",J=N.LINES):(fe=Q?"fillPattern":"fill",J=N.TRIANGLES);for(const Ve of _){const Le=i.getTile(Ve);if(Q&&!Le.patternsLoaded())continue;const De=Le.getBucket(h);if(!De)continue;g.prepareDrawTile();const He=De.programConfigurations.get(h.id),Xe=g.useProgram(fe,He);Q&&(g.context.activeTexture.set(N.TEXTURE0),Le.imageAtlasTexture.bind(N.LINEAR,N.CLAMP_TO_EDGE),He.updatePaintBuffers());const at=B.constantOr(null);if(at&&Le.imageAtlas){const mt=Le.imageAtlas.patternPositions[at.toString()];mt&&He.setConstantPatternPositions(mt)}const _t=g.translatePosMatrix(Ve.projMatrix,Le,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(O){je=De.indexBuffer2,Be=De.segments2;const mt=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[N.drawingBufferWidth,N.drawingBufferHeight];Ie="fillOutlinePattern"===fe&&Q?wu(_t,g,Le,mt):_s(_t,mt)}else je=De.indexBuffer,Be=De.segments,Ie=Q?Fs(_t,g,Le):Is(_t);g.prepareDrawProgram(g.context,Xe,Ve.toUnwrapped()),Xe.draw(g.context,J,E,g.stencilModeForClipping(Ve),M,c.CullFaceMode.disabled,Ie,h.id,De.layoutVertexBuffer,je,Be,h.paint,g.transform.zoom,He)}}function Pi(g,i,h,_,E,M,O){const N=g.context,B=N.gl,Q=g.transform,J=h.paint.get("fill-extrusion-pattern"),fe=J.constantOr(1),Ie=h.paint.get("fill-extrusion-opacity"),je=[h.paint.get("fill-extrusion-ambient-occlusion-intensity"),h.paint.get("fill-extrusion-ambient-occlusion-radius")],Be=h.layout.get("fill-extrusion-edge-radius"),Ve="globe"===Q.projection.name?c.fillExtrusionHeightLift():0,Le="globe"===Q.projection.name,De=Le?c.globeToMercatorTransition(Q.zoom):0,He=[c.mercatorXfromLng(Q.center.lng),c.mercatorYfromLat(Q.center.lat)],Xe=[];Le&&(Xe.push("PROJECTION_GLOBE_VIEW"),g.style.terrainSetForDrapingOnly()&&Xe.push("TERRAIN")),je[0]>0&&Xe.push("FAUX_AO");for(const at of _){const _t=i.getTile(at),mt=_t.getBucket(h);if(!mt||mt.projection.name!==Q.projection.name)continue;const It=mt.programConfigurations.get(h.id),Ht=g.useProgram(fe?"fillExtrusionPattern":"fillExtrusion",It,Xe);if(g.terrain){const Tr=g.terrain;if(g.style.terrainSetForDrapingOnly())Tr.setupElevationDraw(_t,Ht,{useMeterToDem:!0});else{if(!mt.enableTerrain)continue;if(Tr.setupElevationDraw(_t,Ht,{useMeterToDem:!0}),Ka(N,i,at,mt,h,Tr),!mt.centroidVertexBuffer){const ir=Ht.attributes.a_centroid_pos;void 0!==ir&&B.vertexAttrib2f(ir,0,0)}}}fe&&(g.context.activeTexture.set(B.TEXTURE0),_t.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),It.updatePaintBuffers());const jt=J.constantOr(null);if(jt&&_t.imageAtlas){const Tr=_t.imageAtlas.patternPositions[jt.toString()];Tr&&It.setConstantPatternPositions(Tr)}const Rt=g.translatePosMatrix(at.projMatrix,_t,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Dr=Q.projection.createInversionMatrix(Q,at.canonical),Ut=h.paint.get("fill-extrusion-vertical-gradient"),pr=fe?Bl(Rt,g,Ut,Ie,je,Be,at,_t,Ve,De,He,Dr):fs(Rt,g,Ut,Ie,je,Be,at,Ve,De,He,Dr);g.prepareDrawProgram(N,Ht,at.toUnwrapped());const er=[];g.terrain&&er.push(mt.centroidVertexBuffer),Le&&er.push(mt.layoutVertexExtBuffer),Ht.draw(N,N.gl.TRIANGLES,E,M,O,c.CullFaceMode.backCCW,pr,h.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,h.paint,g.transform.zoom,It,er)}}function Ka(g,i,h,_,E,M){const O=[De=>{let He=De.canonical.x-1,Xe=De.wrap;return He<0&&(He=(1<<De.canonical.z)-1,Xe--),new c.OverscaledTileID(De.overscaledZ,Xe,De.canonical.z,He,De.canonical.y)},De=>{let He=De.canonical.x+1,Xe=De.wrap;return He===1<<De.canonical.z&&(He=0,Xe++),new c.OverscaledTileID(De.overscaledZ,Xe,De.canonical.z,He,De.canonical.y)},De=>new c.OverscaledTileID(De.overscaledZ,De.wrap,De.canonical.z,De.canonical.x,(0===De.canonical.y?1<<De.canonical.z:De.canonical.y)-1),De=>new c.OverscaledTileID(De.overscaledZ,De.wrap,De.canonical.z,De.canonical.x,De.canonical.y===(1<<De.canonical.z)-1?0:De.canonical.y+1)],N=De=>{const He=i.getSource().minzoom,Xe=_t=>{const mt=i.getTileByID(_t);if(mt&&mt.hasData())return mt.getBucket(E)},at=[0,-1,1];for(const _t of at){if(De.overscaledZ+_t<He)continue;const mt=Xe(De.calculateScaledKey(De.overscaledZ+_t));if(mt)return mt}},B=[0,0,0],Q=(De,He)=>(B[0]=Math.min(De.min.y,He.min.y),B[1]=Math.max(De.max.y,He.max.y),B[2]=c.EXTENT-He.min.x>De.max.x?He.min.x-c.EXTENT:De.max.x,B),J=(De,He)=>(B[0]=Math.min(De.min.x,He.min.x),B[1]=Math.max(De.max.x,He.max.x),B[2]=c.EXTENT-He.min.y>De.max.y?He.min.y-c.EXTENT:De.max.y,B),fe=[(De,He)=>Q(De,He),(De,He)=>Q(He,De),(De,He)=>J(De,He),(De,He)=>J(He,De)],Ie=new c.pointGeometry(0,0);let je,Be,Ve;const Le=(De,He,Xe,at,_t)=>{const mt=[[at?Xe:De,at?De:Xe,0],[at?Xe:He,at?He:Xe,0]],It=_t<0?c.EXTENT+_t:_t,Ht=[at?It:(De+He)/2,at?(De+He)/2:It,0];return 0===Xe&&_t<0||0!==Xe&&_t>0?M.getForTilePoints(Ve,[Ht],!0,Be):mt.push(Ht),M.getForTilePoints(h,mt,!0,je),Math.max(mt[0][2],mt[1][2],Ht[2])/M.exaggeration()};for(let De=0;De<4;De++){const He=(De<2?1:5)-De,Xe=_.borders[De];if(0===Xe.length)continue;const at=Ve=O[De](h),_t=N(at);if(!(_t&&_t instanceof c.FillExtrusionBucket&&_t.enableTerrain)||_.borderDoneWithNeighborZ[De]===_t.canonical.z&&_t.borderDoneWithNeighborZ[He]===_.canonical.z||(Be=M.findDEMTileFor(at),!Be||!Be.dem))continue;if(!je){const jt=M.findDEMTileFor(h);if(!jt||!jt.dem)return;je=jt}const mt=_t.borders[He];let It=0;const Ht=_t.borderDoneWithNeighborZ[He]!==_.canonical.z;if(_.canonical.z===_t.canonical.z){for(let jt=0;jt<Xe.length;jt++){const Rt=_.featuresOnBorder[Xe[jt]],Dr=Rt.borders[De];let Ut;for(;It<mt.length&&(Ut=_t.featuresOnBorder[mt[It]],!(Ut.borders[He][1]>Dr[0]+3));)Ht&&_t.encodeCentroid(void 0,Ut,!1),It++;if(Ut&&It<mt.length){const pr=It;let er=0;for(;!(Ut.borders[He][0]>Dr[1]-3)&&(er++,++It!==mt.length);)Ut=_t.featuresOnBorder[mt[It]];if(Ut=_t.featuresOnBorder[mt[pr]],Rt.intersectsCount()>1||Ut.intersectsCount()>1||1!==er){1!==er&&(It=pr),_.encodeCentroid(void 0,Rt,!1),Ht&&_t.encodeCentroid(void 0,Ut,!1);continue}const Tr=fe[De](Rt,Ut),ir=De%2?c.EXTENT-1:0;Ie.x=Le(Tr[0],Math.min(c.EXTENT-1,Tr[1]),ir,De<2,Tr[2]),Ie.y=0,_.encodeCentroid(Ie,Rt,!1),Ht&&_t.encodeCentroid(Ie,Ut,!1)}else _.encodeCentroid(void 0,Rt,!1)}_.borderDoneWithNeighborZ[De]=_t.canonical.z,_.needsCentroidUpdate=!0,Ht&&(_t.borderDoneWithNeighborZ[He]=_.canonical.z,_t.needsCentroidUpdate=!0)}else{for(const jt of Xe)_.encodeCentroid(void 0,_.featuresOnBorder[jt],!1);if(Ht){for(const jt of mt)_t.encodeCentroid(void 0,_t.featuresOnBorder[jt],!1);_t.borderDoneWithNeighborZ[He]=_.canonical.z,_t.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[De]=_t.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(g)}const Qs=new c.Color(1,0,0,1),ds=new c.Color(0,1,0,1),Go=new c.Color(0,0,1,1),Lo=new c.Color(1,0,1,1),Ol=new c.Color(0,1,1,1);function Ga(g,i,h){const _=g.context,E=g.transform,M=_.gl,O="globe"===E.projection.name,N=O?["PROJECTION_GLOBE_VIEW"]:null;let B=h.projMatrix;if(O&&c.globeToMercatorTransition(E.zoom)>0){const Rt=c.transitionTileAABBinECEF(h.canonical,E),Dr=c.globeDenormalizeECEF(Rt);B=c.multiply(new Float32Array(16),E.globeMatrix,Dr),c.multiply(B,E.projMatrix,B)}const Q=g.useProgram("debug",null,N),J=i.getTileByID(h.key);g.terrain&&g.terrain.setupElevationDraw(J,Q);const fe=c.DepthMode.disabled,Ie=c.StencilMode.disabled,je=g.colorModeForRenderPass();_.activeTexture.set(M.TEXTURE0),g.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),O?J._makeGlobeTileDebugBuffers(g.context,E):J._makeDebugTileBoundsBuffers(g.context,E.projection);const Ve=J._tileDebugBuffer||g.debugBuffer,Le=J._tileDebugIndexBuffer||g.debugIndexBuffer,De=J._tileDebugSegments||g.debugSegments;Q.draw(_,M.LINE_STRIP,fe,Ie,je,c.CullFaceMode.disabled,Qo(B,c.Color.red),"$debug",Ve,Le,De,null,null,null,[J._globeTileDebugBorderBuffer]);const He=J.latestRawTileData,Xe=Math.floor((He&&He.byteLength||0)/1024),at=i.getTile(h).tileSize,_t=512/Math.min(at,512)*(h.overscaledZ/E.zoom)*.5;let mt=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(mt+=` => ${h.overscaledZ}`),mt+=` ${Xe}kb`,function(Rt,Dr){Rt.initDebugOverlayCanvas();const Ut=Rt.debugOverlayCanvas,pr=Rt.context.gl,er=Rt.debugOverlayCanvas.getContext("2d");er.clearRect(0,0,Ut.width,Ut.height),er.shadowColor="white",er.shadowBlur=2,er.lineWidth=1.5,er.strokeStyle="white",er.textBaseline="top",er.font="bold 36px Open Sans, sans-serif",er.fillText(Dr,5,5),er.strokeText(Dr,5,5),Rt.debugOverlayTexture.update(Ut),Rt.debugOverlayTexture.bind(pr.LINEAR,pr.CLAMP_TO_EDGE)}(g,mt);const It=J._tileDebugTextBuffer||g.debugBuffer,Ht=J._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,jt=J._tileDebugTextSegments||g.debugSegments;Q.draw(_,M.TRIANGLES,fe,Ie,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,Qo(B,c.Color.transparent,_t),"$debug",It,Ht,jt,null,null,null,[J._globeTileDebugTextBuffer])}function hl(g,i,h,_){Bi(g,0,i+h/2,g.transform.width,h,_)}function So(g,i,h,_){Bi(g,i-h/2,0,h,g.transform.height,_)}function Bi(g,i,h,_,E,M){const O=g.context,N=O.gl;N.enable(N.SCISSOR_TEST),N.scissor(i*c.exported.devicePixelRatio,h*c.exported.devicePixelRatio,_*c.exported.devicePixelRatio,E*c.exported.devicePixelRatio),O.clear({color:M}),N.disable(N.SCISSOR_TEST)}const ea=c.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ta}=ea;function ha(g,i,h,_){g.emplaceBack(i,h,_)}class Ta{constructor(i){this.vertexArray=new c.StructArrayLayout3f12,this.indices=new c.StructArrayLayout3ui6,ha(this.vertexArray,-1,-1,1),ha(this.vertexArray,1,-1,1),ha(this.vertexArray,-1,1,1),ha(this.vertexArray,1,1,1),ha(this.vertexArray,-1,-1,-1),ha(this.vertexArray,1,-1,-1),ha(this.vertexArray,-1,1,-1),ha(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,ta),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=c.SegmentVector.simpleSegment(0,0,36,12)}}function ra(g,i,h,_,E,M){const O=g.gl,N=i.paint.get("sky-atmosphere-color"),B=i.paint.get("sky-atmosphere-halo-color"),Q=i.paint.get("sky-atmosphere-sun-intensity"),J={u_matrix_3f:c.fromMat4(c.create$1(),_),u_sun_direction:E,u_sun_intensity:Q,u_color_tint_r:[(Be=N).r,Be.g,Be.b,Be.a],u_color_tint_m:[(Ve=B).r,Ve.g,Ve.b,Ve.a],u_luminance:5e-5};var Be,Ve;O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+M,i.skyboxTexture,0),h.draw(g,O.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.frontCW,J,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Bs=c.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Ei{constructor(i){const h=new c.StructArrayLayout5f20;h.emplaceBack(-1,1,1,0,0),h.emplaceBack(1,1,1,1,0),h.emplaceBack(1,-1,1,1,1),h.emplaceBack(-1,-1,1,0,1);const _=new c.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(h,Bs.members),this.indexBuffer=i.createIndexBuffer(_),this.segments=c.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const jo={symbol:function(g,i,h,_,E){if("translucent"!==g.renderPass)return;const M=c.StencilMode.disabled,O=g.colorModeForRenderPass();h.layout.get("text-variable-anchor")&&function(N,B,Q,J,fe,Ie,je){const Be=B.transform,Ve="map"===fe,Le="map"===Ie;for(const De of N){const He=J.getTile(De),Xe=He.getBucket(Q);if(!Xe||!Xe.text||!Xe.text.segments.get().length)continue;const at=c.evaluateSizeForZoom(Xe.textSizeData,Be.zoom),_t=Gt(De,Xe.getProjection(),Be),mt=Be.calculatePixelsToTileUnitsMatrix(He),It=Ko(_t,He.tileID.canonical,Le,Ve,Be,Xe.getProjection(),mt),Ht="none"!==Q.layout.get("icon-text-fit")&&Xe.hasIconData();if(at){const jt=Math.pow(2,Be.zoom-He.tileID.overscaledZ);cl(Xe,Ve,Le,je,c.symbolSize,Be,It,De,jt,at,Ht)}}}(_,g,h,i,h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),E),0!==h.paint.get("icon-opacity").constantOr(1)&&Ks(g,i,h,_,!1,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),h.layout.get("icon-rotation-alignment"),h.layout.get("icon-pitch-alignment"),h.layout.get("icon-keep-upright"),M,O),0!==h.paint.get("text-opacity").constantOr(1)&&Ks(g,i,h,_,!0,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),h.layout.get("text-rotation-alignment"),h.layout.get("text-pitch-alignment"),h.layout.get("text-keep-upright"),M,O),i.map.showCollisionBoxes&&(Ja(g,i,h,_,h.paint.get("text-translate"),h.paint.get("text-translate-anchor"),!0),Ja(g,i,h,_,h.paint.get("icon-translate"),h.paint.get("icon-translate-anchor"),!1))},circle:function(g,i,h,_){if("translucent"!==g.renderPass)return;const E=h.paint.get("circle-opacity"),M=h.paint.get("circle-stroke-width"),O=h.paint.get("circle-stroke-opacity"),N=void 0!==h.layout.get("circle-sort-key").constantOr(1);if(0===E.constantOr(1)&&(0===M.constantOr(1)||0===O.constantOr(1)))return;const B=g.context,Q=B.gl,J=g.transform,fe=g.depthModeForSublayer(0,c.DepthMode.ReadOnly),Ie=c.StencilMode.disabled,je=g.colorModeForRenderPass(),Be="globe"===J.projection.name,Ve=[c.mercatorXfromLng(J.center.lng),c.mercatorYfromLat(J.center.lat)],Le=[];for(let He=0;He<_.length;He++){const Xe=_[He],at=i.getTile(Xe),_t=at.getBucket(h);if(!_t||_t.projection.name!==J.projection.name)continue;const mt=_t.programConfigurations.get(h.id),It=za(h);Be&&It.push("PROJECTION_GLOBE_VIEW");const Ht=g.useProgram("circle",mt,It),jt=_t.layoutVertexBuffer,Rt=_t.globeExtVertexBuffer,Dr=_t.indexBuffer,Ut=J.projection.createInversionMatrix(J,Xe.canonical),pr={programConfiguration:mt,program:Ht,layoutVertexBuffer:jt,globeExtVertexBuffer:Rt,indexBuffer:Dr,uniformValues:ul(g,Xe,at,Ut,Ve,h),tile:at};if(N){const er=_t.segments.get();for(const Tr of er)Le.push({segments:new c.SegmentVector([Tr]),sortKey:Tr.sortKey,state:pr})}else Le.push({segments:_t.segments,sortKey:0,state:pr})}N&&Le.sort((He,Xe)=>He.sortKey-Xe.sortKey);const De={useDepthForOcclusion:!Be};for(const He of Le){const{programConfiguration:Xe,program:at,layoutVertexBuffer:_t,globeExtVertexBuffer:mt,indexBuffer:It,uniformValues:Ht,tile:jt}=He.state,Rt=He.segments;g.terrain&&g.terrain.setupElevationDraw(jt,at,De),g.prepareDrawProgram(B,at,jt.tileID.toUnwrapped()),at.draw(B,Q.TRIANGLES,fe,Ie,je,c.CullFaceMode.disabled,Ht,h.id,_t,It,Rt,h.paint,J.zoom,Xe,[mt])}},heatmap:function(g,i,h,_){if(0!==h.paint.get("heatmap-opacity"))if("offscreen"===g.renderPass){const E=g.context,M=E.gl,O=c.StencilMode.disabled,N=new c.ColorMode([M.ONE,M.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(je,Be,Ve,Le){const De=je.gl,He=Be.width*Le,Xe=Be.height*Le;je.activeTexture.set(De.TEXTURE1),je.viewport.set([0,0,He,Xe]);let at=Ve.heatmapFbo;if(!at||at&&(at.width!==He||at.height!==Xe)){at&&at.destroy();const _t=De.createTexture();De.bindTexture(De.TEXTURE_2D,_t),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_WRAP_S,De.CLAMP_TO_EDGE),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_WRAP_T,De.CLAMP_TO_EDGE),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_MIN_FILTER,De.LINEAR),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_MAG_FILTER,De.LINEAR),at=Ve.heatmapFbo=je.createFramebuffer(He,Xe,!1),function(mt,It,Ht,jt,Rt,Dr){const Ut=mt.gl;Ut.texImage2D(Ut.TEXTURE_2D,0,Ut.RGBA,Rt,Dr,0,Ut.RGBA,mt.extRenderToTextureHalfFloat?mt.extTextureHalfFloat.HALF_FLOAT_OES:Ut.UNSIGNED_BYTE,null),jt.colorAttachment.set(Ht)}(je,0,_t,at,He,Xe)}else De.bindTexture(De.TEXTURE_2D,at.colorAttachment.get()),je.bindFramebuffer.set(at.framebuffer)})(E,g,h,"globe"===g.transform.projection.name?.5:.25),E.clear({color:c.Color.transparent});const B=g.transform,Q="globe"===B.projection.name,J=Q?["PROJECTION_GLOBE_VIEW"]:null,fe=Q?c.CullFaceMode.frontCCW:c.CullFaceMode.disabled,Ie=[c.mercatorXfromLng(B.center.lng),c.mercatorYfromLat(B.center.lat)];for(let je=0;je<_.length;je++){const Be=_[je];if(i.hasRenderableParent(Be))continue;const Ve=i.getTile(Be),Le=Ve.getBucket(h);if(!Le||Le.projection.name!==B.projection.name)continue;const De=Le.programConfigurations.get(h.id),He=g.useProgram("heatmap",De,J),{zoom:Xe}=g.transform;g.terrain&&g.terrain.setupElevationDraw(Ve,He),g.prepareDrawProgram(E,He,Be.toUnwrapped());const at=B.projection.createInversionMatrix(B,Be.canonical);He.draw(E,M.TRIANGLES,c.DepthMode.disabled,O,N,fe,Ua(g,Be,Ve,at,Ie,Xe,h.paint.get("heatmap-intensity")),h.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,h.paint,g.transform.zoom,De,Q?[Le.globeExtVertexBuffer]:null)}E.viewport.set([0,0,g.width,g.height])}else"translucent"===g.renderPass&&(g.context.setColorMode(g.colorModeForRenderPass()),function(E,M){const O=E.context,N=O.gl,B=M.heatmapFbo;if(!B)return;O.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,B.colorAttachment.get()),O.activeTexture.set(N.TEXTURE1);let Q=M.colorRampTexture;Q||(Q=M.colorRampTexture=new c.Texture(O,M.colorRamp,N.RGBA)),Q.bind(N.LINEAR,N.CLAMP_TO_EDGE),E.useProgram("heatmapTexture").draw(O,N.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,E.colorModeForRenderPass(),c.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:M.paint.get("heatmap-opacity")},M.id,E.viewportBuffer,E.quadTriangleIndexBuffer,E.viewportSegments,M.paint,E.transform.zoom)}(g,h))},line:function(g,i,h,_){if("translucent"!==g.renderPass)return;const E=h.paint.get("line-opacity"),M=h.paint.get("line-width");if(0===E.constantOr(1)||0===M.constantOr(1))return;const O=g.depthModeForSublayer(0,c.DepthMode.ReadOnly),N=g.colorModeForRenderPass(),B=g.terrain&&g.terrain.renderingToTexture?1:c.exported.devicePixelRatio,Q=h.paint.get("line-dasharray"),J=Q.constantOr(1),fe=h.layout.get("line-cap"),Ie=h.paint.get("line-pattern"),je=Ie.constantOr(1),Be=h.paint.get("line-gradient"),Ve=je?"linePattern":"line",Le=g.context,De=Le.gl,He=(at=>{const _t=[];go(at)&&_t.push("RENDER_LINE_DASH"),at.paint.get("line-gradient")&&_t.push("RENDER_LINE_GRADIENT");const mt=at.paint.get("line-trim-offset");0===mt[0]&&0===mt[1]||_t.push("RENDER_LINE_TRIM_OFFSET");const It=at.paint.get("line-pattern").constantOr(1),Ht=1!==at.paint.get("line-opacity").constantOr(1);return!It&&Ht&&_t.push("RENDER_LINE_ALPHA_DISCARD"),_t})(h);let Xe=He.includes("RENDER_LINE_ALPHA_DISCARD");g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(Xe=!1);for(const at of _){const _t=i.getTile(at);if(je&&!_t.patternsLoaded())continue;const mt=_t.getBucket(h);if(!mt)continue;g.prepareDrawTile();const It=mt.programConfigurations.get(h.id),Ht=g.useProgram(Ve,It,He),jt=Ie.constantOr(null);if(jt&&_t.imageAtlas){const vr=_t.imageAtlas.patternPositions[jt.toString()];vr&&It.setConstantPatternPositions(vr)}const Rt=Q.constantOr(null),Dr=fe.constantOr(null);if(!je&&Rt&&Dr&&_t.lineAtlas){const vr=_t.lineAtlas.getDash(Rt,Dr);vr&&It.setConstantPatternPositions(vr)}let[Ut,pr]=h.paint.get("line-trim-offset");("round"===Dr||"square"===Dr)&&Ut!==pr&&(0===Ut&&(Ut-=1),1===pr&&(pr+=1));const er=g.terrain?at.projMatrix:null,Tr=je?tr(g,_t,h,er,B):Lt(g,_t,h,er,mt.lineClipsArray.length,B,[Ut,pr]);if(Be){const vr=mt.gradients[h.id];let Or=vr.texture;if(h.gradientVersion!==vr.version){let zt=256;if(h.stepInterpolant){const Kt=i.getSource().maxzoom,fn=at.canonical.z===Kt?Math.ceil(1<<g.transform.maxZoom-at.canonical.z):1;zt=c.clamp(c.nextPowerOfTwo(mt.maxLineLength/c.EXTENT*1024*fn),256,Le.maxTextureSize)}vr.gradient=c.renderColorRamp({expression:h.gradientExpression(),evaluationKey:"lineProgress",resolution:zt,image:vr.gradient||void 0,clips:mt.lineClipsArray}),vr.texture?vr.texture.update(vr.gradient):vr.texture=new c.Texture(Le,vr.gradient,De.RGBA),vr.version=h.gradientVersion,Or=vr.texture}Le.activeTexture.set(De.TEXTURE1),Or.bind(h.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}J&&(Le.activeTexture.set(De.TEXTURE0),_t.lineAtlasTexture.bind(De.LINEAR,De.REPEAT),It.updatePaintBuffers()),je&&(Le.activeTexture.set(De.TEXTURE0),_t.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),It.updatePaintBuffers()),g.prepareDrawProgram(Le,Ht,at.toUnwrapped());const ir=vr=>{Ht.draw(Le,De.TRIANGLES,O,vr,N,c.CullFaceMode.disabled,Tr,h.id,mt.layoutVertexBuffer,mt.indexBuffer,mt.segments,h.paint,g.transform.zoom,It,[mt.layoutVertexBuffer2])};if(Xe){const vr=g.stencilModeForClipping(at).ref;0===vr&&g.terrain&&Le.clear({stencil:0});const Or={func:De.EQUAL,mask:255};Tr.u_alpha_discard_threshold=.8,ir(new c.StencilMode(Or,vr,255,De.KEEP,De.KEEP,De.INVERT)),Tr.u_alpha_discard_threshold=0,ir(new c.StencilMode(Or,vr,255,De.KEEP,De.KEEP,De.KEEP))}else ir(g.stencilModeForClipping(at))}Xe&&(g.resetStencilClippingMasks(),g.terrain&&Le.clear({stencil:0}))},fill:function(g,i,h,_){const E=h.paint.get("fill-color"),M=h.paint.get("fill-opacity");if(0===M.constantOr(1))return;const O=g.colorModeForRenderPass(),N=h.paint.get("fill-pattern"),B=g.opaquePassEnabledForLayer()&&!N.constantOr(1)&&1===E.constantOr(c.Color.transparent).a&&1===M.constantOr(0)?"opaque":"translucent";if(g.renderPass===B){const Q=g.depthModeForSublayer(1,"opaque"===g.renderPass?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly);vo(g,i,h,_,Q,O,!1)}if("translucent"===g.renderPass&&h.paint.get("fill-antialias")){const Q=g.depthModeForSublayer(h.getPaintProperty("fill-outline-color")?2:0,c.DepthMode.ReadOnly);vo(g,i,h,_,Q,O,!0)}},"fill-extrusion":function(g,i,h,_){const E=h.paint.get("fill-extrusion-opacity");if(0!==E&&"translucent"===g.renderPass){const M=new c.DepthMode(g.context.gl.LEQUAL,c.DepthMode.ReadWrite,g.depthRangeFor3D);if(1!==E||h.paint.get("fill-extrusion-pattern").constantOr(1))Pi(g,i,h,_,M,c.StencilMode.disabled,c.ColorMode.disabled),Pi(g,i,h,_,M,g.stencilModeFor3D(),g.colorModeForRenderPass()),g.resetStencilClippingMasks();else{const O=g.colorModeForRenderPass();Pi(g,i,h,_,M,c.StencilMode.disabled,O)}}},hillshade:function(g,i,h,_){if("offscreen"!==g.renderPass&&"translucent"!==g.renderPass)return;const E=g.context,M=g.depthModeForSublayer(0,c.DepthMode.ReadOnly),O=g.colorModeForRenderPass(),N=g.terrain&&g.terrain.renderingToTexture,[B,Q]="translucent"!==g.renderPass||N?[{},_]:g.stencilConfigForOverlap(_);for(const J of Q){const fe=i.getTile(J);if(fe.needsHillshadePrepare&&"offscreen"===g.renderPass)ll(g,fe,h,M,c.StencilMode.disabled,O);else if("translucent"===g.renderPass){const Ie=N&&g.terrain?g.terrain.stencilModeForRTTOverlap(J):B[J.overscaledZ];al(g,J,fe,h,M,Ie,O)}}E.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,i,h,_,E,M){if("translucent"!==g.renderPass||0===h.paint.get("raster-opacity")||!_.length)return;const O=g.context,N=O.gl,B=i.getSource(),Q=g.useProgram("raster"),J=g.colorModeForRenderPass(),fe=g.terrain&&g.terrain.renderingToTexture,[Ie,je]=B instanceof dt||fe?[{},_]:g.stencilConfigForOverlap(_),Be=je[je.length-1].overscaledZ,Ve=!g.options.moving;for(const Le of je){const De=fe?c.DepthMode.disabled:g.depthModeForSublayer(Le.overscaledZ-Be,1===h.paint.get("raster-opacity")?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly,N.LESS),He=Le.toUnwrapped(),Xe=i.getTile(Le);if(fe&&(!Xe||!Xe.hasData()))continue;const at=fe?Le.projMatrix:g.transform.calculateProjMatrix(He,Ve),_t=g.terrain&&fe?g.terrain.stencilModeForRTTOverlap(Le):Ie[Le.overscaledZ],mt=M?0:h.paint.get("raster-fade-duration");Xe.registerFadeDuration(mt);const It=i.findLoadedParent(Le,0),Ht=xl(Xe,It,i,g.transform,mt);let jt,Rt;g.terrain&&g.terrain.prepareDrawTile();const Dr="nearest"===h.paint.get("raster-resampling")?N.NEAREST:N.LINEAR;O.activeTexture.set(N.TEXTURE0),Xe.texture.bind(Dr,N.CLAMP_TO_EDGE),O.activeTexture.set(N.TEXTURE1),It?(It.texture.bind(Dr,N.CLAMP_TO_EDGE),jt=Math.pow(2,It.tileID.overscaledZ-Xe.tileID.overscaledZ),Rt=[Xe.tileID.canonical.x*jt%1,Xe.tileID.canonical.y*jt%1]):Xe.texture.bind(Dr,N.CLAMP_TO_EDGE);const Ut=Un(at,Rt||[0,0],jt||1,Ht,h,B instanceof dt?B.perspectiveTransform:[0,0]);if(g.prepareDrawProgram(O,Q,He),B instanceof dt)B.boundsBuffer&&B.boundsSegments&&Q.draw(O,N.TRIANGLES,De,c.StencilMode.disabled,J,c.CullFaceMode.disabled,Ut,h.id,B.boundsBuffer,g.quadTriangleIndexBuffer,B.boundsSegments);else{const{tileBoundsBuffer:pr,tileBoundsIndexBuffer:er,tileBoundsSegments:Tr}=g.getTileBoundsBuffers(Xe);Q.draw(O,N.TRIANGLES,De,_t,J,c.CullFaceMode.disabled,Ut,h.id,pr,er,Tr)}}g.resetStencilClippingMasks()},background:function(g,i,h,_){const E=h.paint.get("background-color"),M=h.paint.get("background-opacity");if(0===M)return;const O=g.context,N=O.gl,B=g.transform,Q=B.tileSize,J=h.paint.get("background-pattern");if(g.isPatternMissing(J))return;const fe=!J&&1===E.a&&1===M&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==fe)return;const Ie=c.StencilMode.disabled,je=g.depthModeForSublayer(0,"opaque"===fe?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),Be=g.colorModeForRenderPass(),Ve=g.useProgram(J?"backgroundPattern":"background");let Le,De=_;De||(Le=g.getBackgroundTiles(),De=Object.values(Le).map(He=>He.tileID)),J&&(O.activeTexture.set(N.TEXTURE0),g.imageManager.bind(g.context));for(const He of De){const Xe=He.toUnwrapped(),at=_?He.projMatrix:g.transform.calculateProjMatrix(Xe);g.prepareDrawTile();const _t=i?i.getTile(He):Le?Le[He.key]:new c.Tile(He,Q,B.zoom,g),mt=J?ca(at,M,g,J,{tileID:He,tileSize:Q}):Da(at,M,E);g.prepareDrawProgram(O,Ve,Xe);const{tileBoundsBuffer:It,tileBoundsIndexBuffer:Ht,tileBoundsSegments:jt}=g.getTileBoundsBuffers(_t);Ve.draw(O,N.TRIANGLES,je,Ie,Be,c.CullFaceMode.disabled,mt,h.id,It,Ht,jt)}},sky:function(g,i,h){const _=g.transform,E="mercator"===_.projection.name||"globe"===_.projection.name?1:c.smoothstep(7,8,_.zoom),M=h.paint.get("sky-opacity")*E;if(0===M)return;const O=g.context,N=h.paint.get("sky-type"),B=new c.DepthMode(O.gl.LEQUAL,c.DepthMode.ReadOnly,[0,1]),Q=g.frameCounter/1e3%1;"atmosphere"===N?"offscreen"===g.renderPass?h.needsSkyboxCapture(g)&&(function(J,fe,Ie,je){const Be=J.context,Ve=Be.gl;let Le=fe.skyboxFbo;if(!Le){Le=fe.skyboxFbo=Be.createFramebuffer(32,32,!1),fe.skyboxGeometry=new Ta(Be),fe.skyboxTexture=Be.gl.createTexture(),Ve.bindTexture(Ve.TEXTURE_CUBE_MAP,fe.skyboxTexture),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_WRAP_S,Ve.CLAMP_TO_EDGE),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_WRAP_T,Ve.CLAMP_TO_EDGE),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_MIN_FILTER,Ve.LINEAR),Ve.texParameteri(Ve.TEXTURE_CUBE_MAP,Ve.TEXTURE_MAG_FILTER,Ve.LINEAR);for(let at=0;at<6;++at)Ve.texImage2D(Ve.TEXTURE_CUBE_MAP_POSITIVE_X+at,0,Ve.RGBA,32,32,0,Ve.RGBA,Ve.UNSIGNED_BYTE,null)}Be.bindFramebuffer.set(Le.framebuffer),Be.viewport.set([0,0,32,32]);const De=fe.getCenter(J,!0),He=J.useProgram("skyboxCapture"),Xe=new Float64Array(16);c.identity(Xe),c.rotateY(Xe,Xe,.5*-Math.PI),ra(Be,fe,He,Xe,De,0),c.identity(Xe),c.rotateY(Xe,Xe,.5*Math.PI),ra(Be,fe,He,Xe,De,1),c.identity(Xe),c.rotateX(Xe,Xe,.5*-Math.PI),ra(Be,fe,He,Xe,De,2),c.identity(Xe),c.rotateX(Xe,Xe,.5*Math.PI),ra(Be,fe,He,Xe,De,3),c.identity(Xe),ra(Be,fe,He,Xe,De,4),c.identity(Xe),c.rotateY(Xe,Xe,Math.PI),ra(Be,fe,He,Xe,De,5),Be.viewport.set([0,0,J.width,J.height])}(g,h),h.markSkyboxValid(g)):"sky"===g.renderPass&&function(J,fe,Ie,je,Be){const Ve=J.context,Le=Ve.gl,De=J.transform,He=J.useProgram("skybox");Ve.activeTexture.set(Le.TEXTURE0),Le.bindTexture(Le.TEXTURE_CUBE_MAP,fe.skyboxTexture);const Xe={u_matrix:De.skyboxMatrix,u_sun_direction:fe.getCenter(J,!1),u_cubemap:0,u_opacity:je,u_temporal_offset:Be};J.prepareDrawProgram(Ve,He),He.draw(Ve,Le.TRIANGLES,Ie,c.StencilMode.disabled,J.colorModeForRenderPass(),c.CullFaceMode.backCW,Xe,"skybox",fe.skyboxGeometry.vertexBuffer,fe.skyboxGeometry.indexBuffer,fe.skyboxGeometry.segment)}(g,h,B,M,Q):"gradient"===N&&"sky"===g.renderPass&&function(J,fe,Ie,je,Be){const Ve=J.context,Le=Ve.gl,De=J.transform,He=J.useProgram("skyboxGradient");fe.skyboxGeometry||(fe.skyboxGeometry=new Ta(Ve)),Ve.activeTexture.set(Le.TEXTURE0);let Xe=fe.colorRampTexture;Xe||(Xe=fe.colorRampTexture=new c.Texture(Ve,fe.colorRamp,Le.RGBA)),Xe.bind(Le.LINEAR,Le.CLAMP_TO_EDGE);const at=(_t=De.skyboxMatrix,mt=fe.getCenter(J,!1),It=fe.paint.get("sky-gradient-radius"),Ht=je,jt=Be,{u_matrix:_t,u_color_ramp:0,u_center_direction:mt,u_radius:c.degToRad(It),u_opacity:Ht,u_temporal_offset:jt});var _t,mt,It,Ht,jt;J.prepareDrawProgram(Ve,He),He.draw(Ve,Le.TRIANGLES,Ie,c.StencilMode.disabled,J.colorModeForRenderPass(),c.CullFaceMode.backCW,at,"skyboxGradient",fe.skyboxGeometry.vertexBuffer,fe.skyboxGeometry.indexBuffer,fe.skyboxGeometry.segment)}(g,h,B,M,Q)},debug:function(g,i,h){for(let _=0;_<h.length;_++)Ga(g,i,h[_])},custom:function(g,i,h){const _=g.context,E=h.implementation;if(g.transform.projection.unsupportedLayers&&g.transform.projection.unsupportedLayers.includes("custom"))c.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===g.renderPass){const M=E.prerender;M&&(g.setCustomLayerDefaults(),_.setColorMode(g.colorModeForRenderPass()),M.call(E,_.gl,g.transform.customLayerMatrix()),_.setDirty(),g.setBaseState())}else if("translucent"===g.renderPass){g.setCustomLayerDefaults(),_.setColorMode(g.colorModeForRenderPass()),_.setStencilMode(c.StencilMode.disabled);const M="3d"===E.renderingMode?new c.DepthMode(g.context.gl.LEQUAL,c.DepthMode.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,c.DepthMode.ReadOnly);_.setDepthMode(M),E.render(_.gl,g.transform.customLayerMatrix()),_.setDirty(),g.setBaseState(),_.bindFramebuffer.set(null)}}};class uc{constructor(i,h){this.context=new le(i),this.transform=h,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=c.SourceCache.maxUnderzooming+c.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Js,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,h){const _=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Wa(this,i));const E=this._terrain;this.transform.elevation=_?E:null,E.update(i,this.transform,h)}_updateFog(i){const h=i.fog;if(!h||"globe"===this.transform.projection.name||h.getOpacity(this.transform.pitch)<1||h.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,E]=h.getFovAdjustedRange(this.transform._fov);if(_>E)return void(this.transform.fogCullDistSq=null);const M=_+.78*(E-_);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,h){if(this.width=i*c.exported.devicePixelRatio,this.height=h*c.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const i=this.context,h=new c.StructArrayLayout2i4;h.emplaceBack(0,0),h.emplaceBack(c.EXTENT,0),h.emplaceBack(0,c.EXTENT),h.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(h,c.posAttributes.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const _=new c.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(c.EXTENT,0),_.emplaceBack(0,c.EXTENT),_.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=i.createVertexBuffer(_,c.posAttributes.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const E=new c.StructArrayLayout2i4;E.emplaceBack(-1,-1),E.emplaceBack(1,-1),E.emplaceBack(-1,1),E.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(E,c.posAttributes.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const M=new c.StructArrayLayout4i8;M.emplaceBack(0,0,0,0),M.emplaceBack(c.EXTENT,0,c.EXTENT,0),M.emplaceBack(0,c.EXTENT,0,c.EXTENT),M.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(M,c.boundsAttributes.members),this.mercatorBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const O=new c.StructArrayLayout3ui6;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(O);const N=new c.StructArrayLayout1ui2;for(const Q of[0,1,3,2,0])N.emplaceBack(Q);this.debugIndexBuffer=i.createIndexBuffer(N),this.emptyTexture=new c.Texture(i,new c.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=c.create();const B=this.context.gl;this.stencilClearMode=new c.StencilMode({func:B.ALWAYS,mask:0},0,255,B.ZERO,B.ZERO,B.ZERO),this.loadTimeStamps.push(c.window.performance.now()),this.atmosphereBuffer=new Ei(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,h=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,h.TRIANGLES,c.DepthMode.disabled,this.stencilClearMode,c.ColorMode.disabled,c.CullFaceMode.disabled,si(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,h,_){if(!h||this.currentStencilSource===h.id||!i.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let N=!1;for(const B of _)if(void 0===this._tileClippingMaskIDs[B.key]){N=!0;break}if(!N)return}this.currentStencilSource=h.id;const E=this.context,M=E.gl;this.nextStencilID+_.length>256&&this.clearStencil(),E.setColorMode(c.ColorMode.disabled),E.setDepthMode(c.DepthMode.disabled);const O=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const N of _){const B=h.getTile(N),Q=this._tileClippingMaskIDs[N.key]=this.nextStencilID++,{tileBoundsBuffer:J,tileBoundsIndexBuffer:fe,tileBoundsSegments:Ie}=this.getTileBoundsBuffers(B);O.draw(E,M.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:M.ALWAYS,mask:0},Q,255,M.KEEP,M.KEEP,M.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,si(N.projMatrix),"$clipping",J,fe,Ie)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,h=this.context.gl;return new c.StencilMode({func:h.NOTEQUAL,mask:255},i,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const h=this.context.gl;return new c.StencilMode({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(i){const h=this.context.gl,_=i.sort((O,N)=>N.overscaledZ-O.overscaledZ),E=_[_.length-1].overscaledZ,M=_[0].overscaledZ-E+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const O={};for(let N=0;N<M;N++)O[N+E]=new c.StencilMode({func:h.GEQUAL,mask:255},N+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=M,[O,_]}return[{[E]:c.StencilMode.disabled},_]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new c.ColorMode([i.CONSTANT_COLOR,i.ONE],new c.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?c.ColorMode.unblended:c.ColorMode.alphaBlended}depthModeForSublayer(i,h,_){if(!this.opaquePassEnabledForLayer())return c.DepthMode.disabled;const E=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new c.DepthMode(_||this.context.gl.LEQUAL,h,[E,E])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,h){this.style=i,this.options=h,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const _=this.style.order,E=this.style._sourceCaches;for(const B in E){const Q=E[B];Q.used&&Q.prepare(this.context)}const M={},O={},N={};for(const B in E){const Q=E[B];M[B]=Q.getVisibleCoordinates(),O[B]=M[B].slice().reverse(),N[B]=Q.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let B=0;B<_.length;B++)if(this.style._layers[_[B]].is3D()){this.opaquePassCutoff=B;break}if(this.terrain&&(this.terrain.updateTileBinding(N),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new c.GlobeSharedBuffers(this.context)),c.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const B of _){const Q=this.style._layers[B],J=i._getLayerSourceCache(Q);if(!Q.hasOffscreenPass()||Q.isHidden(this.transform.zoom))continue;const fe=J?O[J.id]:void 0;("custom"===Q.type||Q.isSky()||fe&&fe.length)&&this.renderLayer(this,J,Q,fe)}if(this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:h.showOverdrawInspector?c.Color.black:c.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const B=this.style._layers[_[this.currentLayer]],Q=i._getLayerSourceCache(B);if(B.isSky())continue;const J=Q?O[Q.id]:void 0;this._renderTileClippingMasks(B,Q,J),this.renderLayer(this,Q,B,J)}if(this.style.fog&&this.transform.projection.supportsFog&&function(B,Q){const J=B.context,fe=J.gl,Ie=B.transform,je=new c.DepthMode(fe.LEQUAL,c.DepthMode.ReadOnly,[0,1]),Be=B.useProgram("globeAtmosphere",null,"globe"===Ie.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Ve=c.globeToMercatorTransition(Ie.zoom),Le=Q.properties.get("color").toArray01(),De=Q.properties.get("high-color").toArray01(),He=Q.properties.get("space-color").toArray01PremultipliedAlpha(),Xe=c.identity$1([]);c.rotateY$1(Xe,Xe,-c.degToRad(Ie._center.lng)),c.rotateX$1(Xe,Xe,c.degToRad(Ie._center.lat)),c.rotateZ$1(Xe,Xe,Ie.angle),c.rotateX$1(Xe,Xe,-Ie._pitch);const at=c.fromQuat(new Float32Array(16),Xe),_t=c.mapValue(Q.properties.get("star-intensity"),0,1,0,.25),It=c.mapValue(Q.properties.get("horizon-blend"),0,1,5e-4,.25),Ht=c.globeUseCustomAntiAliasing(B,J,Ie)&&5e-4===It?Ie.worldSize/(2*Math.PI*1.025)-1:Ie.globeRadius,jt=B.frameCounter/1e3%1,Rt=c.length(Ie.globeCenterInViewSpace),Dr=Math.sqrt(Math.pow(Rt,2)-Math.pow(Ht,2)),Ut=Math.acos(Dr/Rt),pr={u_frustum_tl:Ie.frustumCorners.TL,u_frustum_tr:Ie.frustumCorners.TR,u_frustum_br:Ie.frustumCorners.BR,u_frustum_bl:Ie.frustumCorners.BL,u_horizon:Ie.frustumCorners.horizon,u_transition:Ve,u_fadeout_range:It,u_color:Le,u_high_color:De,u_space_color:He,u_star_intensity:_t,u_star_size:5*c.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:jt,u_horizon_angle:Ut,u_rotation_matrix:at};B.prepareDrawProgram(J,Be);const er=B.atmosphereBuffer;er&&Be.draw(J,fe.TRIANGLES,je,c.StencilMode.disabled,c.ColorMode.alphaBlended,c.CullFaceMode.backCW,pr,"skybox",er.vertexBuffer,er.indexBuffer,er.segments)}(this,this.style.fog),this.renderPass="sky",(c.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const B=this.style._layers[_[this.currentLayer]],Q=i._getLayerSourceCache(B);B.isSky()&&this.renderLayer(this,Q,B,Q?O[Q.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const B=this.style._layers[_[this.currentLayer]],Q=i._getLayerSourceCache(B);if(B.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(B)){if(B.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const J=Q?("symbol"===B.type?N:O)[Q.id]:void 0;this._renderTileClippingMasks(B,Q,Q?M[Q.id]:void 0),this.renderLayer(this,Q,B,J),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let B=null;c.values(this.style._layers).forEach(Q=>{const J=i._getLayerSourceCache(Q);J&&!Q.isHidden(this.transform.zoom)&&(!B||B.getSource().maxzoom<J.getSource().maxzoom)&&(B=J)}),B&&this.options.showTileBoundaries&&jo.debug(this,B,B.getVisibleCoordinates())}this.options.showPadding&&function(B){const Q=B.transform.padding;hl(B,B.transform.height-(Q.top||0),3,Qs),hl(B,Q.bottom||0,3,ds),So(B,Q.left||0,3,Go),So(B,B.transform.width-(Q.right||0),3,Lo);const J=B.transform.centerPoint;var fe,Ie,je,Be;Bi(fe=B,(Ie=J.x)-1,(je=B.transform.height-J.y)-10,2,20,Be=Ol),Bi(fe,Ie-10,je-1,20,2,Be)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(c.window.performance.now()),this.saveCanvasCopy())}}renderLayer(i,h,_,E){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||E&&E.length)&&(this.id=_.id,this.gpuTimingStart(_),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(_.type)||jo[_.type](i,h,_,E,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const h=this.context.extTimerQuery;let _=this.gpuTimers[i.id];_||(_=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:h.createQueryEXT()}),_.calls++,h.beginQueryEXT(h.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,h=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(h),i.beginQueryEXT(i.TIME_ELAPSED_EXT,h)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const h={};for(const _ in i){const E=i[_],M=this.context.extTimerQuery,O=M.getQueryObjectEXT(E.query,M.QUERY_RESULT_EXT)/1e6;M.deleteQueryEXT(E.query),h[_]=O}return h}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const h=this.context.extTimerQuery;let _=0;for(const E of i)_+=h.getQueryObjectEXT(E,h.QUERY_RESULT_EXT)/1e6,h.deleteQueryEXT(E);return _}translatePosMatrix(i,h,_,E,M){if(!_[0]&&!_[1])return i;const O=M?"map"===E?this.transform.angle:0:"viewport"===E?-this.transform.angle:0;if(O){const Q=Math.sin(O),J=Math.cos(O);_=[_[0]*J-_[1]*Q,_[0]*Q+_[1]*J]}const N=[M?_[0]:Wt(h,_[0],this.transform.zoom),M?_[1]:Wt(h,_[1],this.transform.zoom),0],B=new Float32Array(16);return c.translate(B,i,N),B}saveTileTexture(i){const h=this._tileTextures[i.size[0]];h?h.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const h=this._tileTextures[i];return h&&h.length>0?h.pop():null}isPatternMissing(i){return null===i||void 0!==i&&!this.imageManager.getPattern(i.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,h=this.terrain&&0===this.terrain.exaggeration(),_=this.style&&this.style.fog,E=[];return this.terrainRenderModeElevated()&&E.push("TERRAIN"),"globe"===this.transform.projection.name&&E.push("GLOBE"),h&&E.push("ZERO_EXAGGERATION"),_&&!i&&0!==_.getOpacity(this.transform.pitch)&&E.push("FOG"),i&&E.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&E.push("OVERDRAW_INSPECTOR"),E}useProgram(i,h,_){this.cache=this.cache||{};const E=_||[],M=this.currentGlobalDefines().concat(E),O=uu.cacheKey(_n[i],i,M,h);return this.cache[O]||(this.cache[O]=new uu(this.context,i,_n[i],h,Ca[i],M)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=c.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,h,_){if(this.terrain&&this.terrain.renderingToTexture)return;const E=this.style.fog;if(E){const M=E.getOpacity(this.transform.pitch),O=((N,B,Q,J,fe,Ie,je,Be,Ve,Le,De)=>{const He=N.transform,Xe=B.properties.get("color").toArray01();Xe[3]=J;const at=N.frameCounter/1e3%1;return{u_fog_matrix:Q?He.calculateFogTileMatrix(Q):N.identityMat,u_fog_range:B.getFovAdjustedRange(He._fov),u_fog_color:Xe,u_fog_horizon_blend:B.properties.get("horizon-blend"),u_fog_temporal_offset:at,u_frustum_tl:fe,u_frustum_tr:Ie,u_frustum_br:je,u_frustum_bl:Be,u_globe_pos:Ve,u_globe_radius:Le,u_viewport:De,u_globe_transition:c.globeToMercatorTransition(He.zoom),u_is_globe:+("globe"===He.projection.name)}})(this,E,_,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.exported.devicePixelRatio,this.transform.height*c.exported.devicePixelRatio]);h.setFogUniformValues(i,O)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,h=i.createTexture();return i.bindTexture(i.TEXTURE_2D,h),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),h}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,h=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const E of _)h[E.key]=i[E.key]||new c.Tile(E,512,this.transform.tileZoom,this);return h}clearBackgroundTiles(){this._backgroundTiles={}}}class ja{constructor(i=0,h=0,_=0,E=0){if(isNaN(i)||i<0||isNaN(h)||h<0||isNaN(_)||_<0||isNaN(E)||E<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=h,this.left=_,this.right=E}interpolate(i,h,_){return null!=h.top&&null!=i.top&&(this.top=c.number(i.top,h.top,_)),null!=h.bottom&&null!=i.bottom&&(this.bottom=c.number(i.bottom,h.bottom,_)),null!=h.left&&null!=i.left&&(this.left=c.number(i.left,h.left,_)),null!=h.right&&null!=i.right&&(this.right=c.number(i.right,h.right,_)),this}getCenter(i,h){const _=c.clamp((this.left+i-this.right)/2,0,i),E=c.clamp((this.top+h-this.bottom)/2,0,h);return new c.pointGeometry(_,E)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new ja(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ss(g,i){const h=c.getColumn(g,3);c.fromQuat(g,i),c.setColumn(g,3,h)}function Qa(g,i){const h=c.identity$1([]);return c.rotateZ$1(h,h,-i),c.rotateX$1(h,h,-g),h}function cu(g,i){const h=[g[0],g[1],0],_=[i[0],i[1],0];if(c.length(h)>=1e-15){const O=c.normalize([],h);c.scale$2(_,O,c.dot(_,O)),i[0]=_[0],i[1]=_[1]}const E=c.cross([],i,g);if(c.len(E)<1e-15)return null;const M=Math.atan2(-E[1],E[0]);return Qa(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),M)}class hu{constructor(i,h){this.position=i,this.orientation=h}get position(){return this._position}set position(i){if(i){const h=i instanceof c.MercatorCoordinate?i:new c.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(h.x=c.wrap(h.x,0,1)),this._position=h}else this._position=null}lookAtPoint(i,h){if(this.orientation=null,!this.position)return;const _=this._elevation?this._elevation.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(i)):0,E=this.position,M=c.MercatorCoordinate.fromLngLat(i,_),O=[M.x-E.x,M.y-E.y,M.z-E.z];h||(h=[0,0,1]),h[2]=Math.abs(h[2]),this.orientation=cu(O,h)}setPitchBearing(i,h){this.orientation=Qa(c.degToRad(i),c.degToRad(-h))}}class el{constructor(i,h){this._transform=c.identity([]),this.orientation=h,this.position=i}get mercatorPosition(){const i=this.position;return new c.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=c.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var h;i&&c.setColumn(this._transform,3,[(h=i)[0],h[1],h[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||c.identity$1([]),i&&ss(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),h=this.right();return{bearing:Math.atan2(-h[1],h[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,h){this._orientation=Qa(i,h),ss(this._transform,this._orientation)}forward(){const i=c.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=c.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=c.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,h){const _=new Float64Array(16);return c.invert(_,this.getWorldToCamera(i,h)),_}getWorldToCameraPosition(i,h,_){const E=this.position;c.scale$2(E,E,-i);const M=new Float64Array(16);return c.fromScaling(M,[_,_,_]),c.translate(M,M,E),M[10]*=h,M}getWorldToCamera(i,h){const _=new Float64Array(16),E=new Float64Array(4),M=this.position;return c.conjugate(E,this._orientation),c.scale$2(M,M,-i),c.fromQuat(_,E),c.translate(_,_,M),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=h,_[9]*=h,_[10]*=h,_[11]*=h,_}getCameraToClipPerspective(i,h,_,E){const M=new Float64Array(16);return c.perspective(M,i,h,_,E),M}getDistanceToElevation(i,h=!1){const _=0===i?0:c.mercatorZfromAltitude(i,h?c.latFromMercatorY(this.position[1]):this.position[1]),E=this.forward();return(_-this.position[2])/E[2]}clone(){return new el([...this.position],[...this.orientation])}}function Gl(g,i){const h=Ma(g.projection,g.zoom,g.width,g.height),_=function(M,O,N,B,Q){const J=new c.LngLat(N.lng-180*xo,N.lat),fe=new c.LngLat(N.lng+180*xo,N.lat),Ie=M.project(J.lng,J.lat),je=M.project(fe.lng,fe.lat),Be=-Math.atan2(je.y-Ie.y,je.x-Ie.x),Ve=c.MercatorCoordinate.fromLngLat(N);Ve.y=c.clamp(Ve.y,-.999975,.999975);const Le=Ve.toLngLat(),De=M.project(Le.lng,Le.lat),He=c.MercatorCoordinate.fromLngLat(Le);He.x+=xo;const Xe=He.toLngLat(),at=M.project(Xe.lng,Xe.lat),_t=Wu(at.x-De.x,at.y-De.y,Be),mt=c.MercatorCoordinate.fromLngLat(Le);mt.y+=xo;const It=mt.toLngLat(),Ht=M.project(It.lng,It.lat),jt=Wu(Ht.x-De.x,Ht.y-De.y,Be),Rt=Math.abs(_t.x)/Math.abs(jt.y),Dr=c.identity([]);c.rotateZ(Dr,Dr,-Be*(1-(Q?0:B)));const Ut=c.identity([]);return c.scale(Ut,Ut,[1,1-(1-Rt)*B,1]),Ut[4]=-jt.x/jt.y*B,c.rotateZ(Ut,Ut,Be),c.multiply(Ut,Dr,Ut),Ut}(g.projection,0,g.center,h,i),E=Ps(g);return c.scale(_,_,[E,E,1]),_}function Ps(g){const i=g.projection,h=Ma(g.projection,g.zoom,g.width,g.height),_=cc(i,g.center),E=cc(i,c.LngLat.convert(i.center));return Math.pow(2,_*h+(1-h)*E)}function Ma(g,i,h,_,E=1/0){const M=g.range;if(!M)return 0;const O=Math.min(E,Math.max(h,_)),N=Math.log(O/1024)/Math.LN2;return c.smoothstep(M[0]+N,M[1]+N,i)}const xo=1/4e4;function cc(g,i){const h=c.clamp(i.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),_=new c.LngLat(i.lng-180*xo,h),E=new c.LngLat(i.lng+180*xo,h),M=g.project(_.lng,h),O=g.project(E.lng,h),N=c.MercatorCoordinate.fromLngLat(_),B=c.MercatorCoordinate.fromLngLat(E),Q=O.x-M.x,J=O.y-M.y,fe=B.x-N.x,Ie=B.y-N.y,je=Math.sqrt((fe*fe+Ie*Ie)/(Q*Q+J*J));return Math.log(je)/Math.LN2}function Wu(g,i,h){const _=Math.cos(h),E=Math.sin(h);return{x:g*_-i*E,y:g*E+i*_}}class xs{constructor(i,h,_,E,M,O,N){this.tileSize=512,this._renderWorldCopies=void 0===M||M,this._minZoom=i||0,this._maxZoom=h||22,this._minPitch=_??0,this._maxPitch=E??60,this.setProjection(O),this.setMaxBounds(N),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ja,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new el,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new xs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i,h=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(i||_)&&this._constrainCamera(h),this._calcMatrices()}getProjection(){return c.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const h=this.projection?this.getProjection():void 0;this.projection=c.getProjection(this.projectionOptions);const _=!Z(h,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.getProjection({name:"mercator"});const h=i!==this.projection.name;return h&&this._calcMatrices(),h}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.pointGeometry(this.width,this.height)}get bearing(){return c.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const h=-i*Math.PI/180;var _,E,M,O,N,B,Q,J,fe,Ie;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=(_=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),E=this.rotationMatrix,O=this.angle,N=(M=this.rotationMatrix)[0],B=M[1],Q=M[2],J=M[3],fe=Math.sin(O),Ie=Math.cos(O),E[0]=N*Ie+Q*fe,E[1]=B*Ie+J*fe,E[2]=N*-fe+Q*Ie,E[3]=B*-fe+J*Ie)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const h=c.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=c.degToRad(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const h=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._setZoom(h),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,h=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let E=0,M=0;for(let O=0;O<h.length;O++){const N=new c.pointGeometry(h[O][0]*this.width,_+h[O][1]*(this.height-_)),B=i.pointCoordinate(N);if(!B)continue;const Q=1/Math.hypot(B[0]-this._camera.position[0],B[1]-this._camera.position[1]);E+=B[3]*Q,M+=Q}return 0===M?NaN:E/M}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const i=this._seaLevelZoom,h=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*h,E=this._mercatorZfromZoom(i),M=this._mercatorZfromZoom(this._maxZoom),O=Math.max(E-_,M);this._setZoom(this._zoomFromMercatorZ(O))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const h=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let _;_=i.z<this._camera.position[2]?[h.x,h.y,h.z]:[i.x,i.y,i.z];const E=c.length(c.sub([],this._camera.position,_));return c.clamp(this._zoomFromMercatorZ(E),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let h=!1;if(i.orientation&&!c.exactEquals(i.orientation,this._camera.orientation)&&(h=this._setCameraOrientation(i.orientation)),i.position){const _=[i.position.x,i.position.y,i.position.z];c.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),h=!0)}h&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,h=new hu;return h.position=new c.MercatorCoordinate(i[0],i[1],i[2]),h.orientation=this._camera.orientation,h._elevation=this.elevation,h._renderWorldCopies=this.renderWorldCopies,h}_setCameraOrientation(i){if(!c.length$1(i))return!1;c.normalize$1(i,i);const h=c.transformQuat([],[0,0,-1],i),_=c.transformQuat([],[0,-1,0],i);if(_[2]<0)return!1;const E=cu(h,_);return!!E&&(this._camera.orientation=E,!0)}_setCameraPosition(i){const h=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,E=this.cameraToCenterDistance;i[2]=c.clamp(i[2],E/_,E/h),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,h,_){this._unmodified=!1,this._edgeInsets.interpolate(i,h,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const h=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(i){const h=[new c.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const _=this.pointCoordinate(new c.pointGeometry(0,0)),E=this.pointCoordinate(new c.pointGeometry(this.width,0)),M=this.pointCoordinate(new c.pointGeometry(this.width,this.height)),O=this.pointCoordinate(new c.pointGeometry(0,this.height)),N=Math.floor(Math.min(_.x,E.x,M.x,O.x)),B=Math.floor(Math.max(_.x,E.x,M.x,O.x)),Q=1;for(let J=N-Q;J<=B+Q;J++)0!==J&&h.push(new c.UnwrappedTileID(J,i))}return h}coveringTiles(i){let h=this.coveringZoomLevel(i);const _=h,E=this.elevation&&!i.isTerrainDEM,M="mercator"===this.projection.name;if(void 0!==i.minzoom&&h<i.minzoom)return[];void 0!==i.maxzoom&&h>i.maxzoom&&(h=i.maxzoom);const O=this.locationCoordinate(this.center),N=this.center.lat,B=1<<h,Q=[B*O.x,B*O.y,0],J="globe"===this.projection.name,fe=!J,Ie=c.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,h,fe),je=J?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Be=B*c.mercatorZfromAltitude(1,this.center.lat),Ve=this._camera.position[2]/c.mercatorZfromAltitude(1,this.center.lat),Le=[B*je.x,B*je.y,Ve*(fe?1:Be)],De=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),He=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?h:0,Xe=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,at=i.isTerrainDEM?-Xe:this._elevation?this._elevation.getMinElevationBelowMSL():0,_t=this.projection.isReprojectedInTileSpace?Ps(this):1,mt=ir=>{const Or=new c.MercatorCoordinate(ir.x+25e-6,ir.y,ir.z),zt=new c.MercatorCoordinate(ir.x,ir.y+25e-6,ir.z),Kt=ir.toLngLat(),fn=Or.toLngLat(),Ln=zt.toLngLat(),gn=this.locationCoordinate(Kt),Nn=this.locationCoordinate(fn),gi=this.locationCoordinate(Ln),Pn=Math.hypot(Nn.x-gn.x,Nn.y-gn.y),Kr=Math.hypot(gi.x-gn.x,gi.y-gn.y);return Math.sqrt(Pn*Kr)*_t/25e-6},It=ir=>{const vr=Xe,Or=at;return{aabb:c.tileAABB(this,B,0,0,0,ir,Or,vr,this.projection),zoom:0,x:0,y:0,minZ:Or,maxZ:vr,wrap:ir,fullyVisible:!1}},Ht=[];let jt=[];const Rt=h,Dr=i.reparseOverscaled?_:h,Ut=ir=>ir*ir,pr=Ut((Ve-this._centerAltitude)*Be),er=ir=>{if(!this._elevation||!ir.tileID||!M)return;const vr=this._elevation.getMinMaxForTile(ir.tileID),Or=ir.aabb;vr?(Or.min[2]=vr.min,Or.max[2]=vr.max,Or.center[2]=(Or.min[2]+Or.max[2])/2):(ir.shouldSplit=Tr(ir),ir.shouldSplit||(Or.min[2]=Or.max[2]=Or.center[2]=this._centerAltitude))},Tr=ir=>{if(ir.zoom<He)return!0;if(ir.zoom===Rt)return!1;if(null!=ir.shouldSplit)return ir.shouldSplit;const vr=ir.aabb.distanceX(Le),Or=ir.aabb.distanceY(Le);let zt=pr,Kt=1;if(J){zt=Ut(ir.aabb.distanceZ(Le));const gn=Math.pow(2,ir.zoom),Nn=c.latFromMercatorY((ir.y+1)/gn),gi=c.latFromMercatorY(ir.y/gn),Pn=Math.min(Math.max(N,Nn),gi),Kr=c.circumferenceAtLatitude(Pn)/c.circumferenceAtLatitude(N);if(Kt=Pn===N?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Kr/this._mercatorScaleRatio),this.zoom<=c.GLOBE_ZOOM_THRESHOLD_MIN&&ir.zoom===Rt-1&&Kr>=.9)return!0}else if(E&&(zt=Ut(ir.aabb.distanceZ(Le)*Be)),this.projection.isReprojectedInTileSpace&&_<=5){const gn=Math.pow(2,ir.zoom),Nn=mt(new c.MercatorCoordinate((ir.x+.5)/gn,(ir.y+.5)/gn));Kt=Nn>.85?1:Nn}const fn=vr*vr+Or*Or+zt;return fn<Ut((1<<Rt-ir.zoom)*De*Kt*((gn,Nn)=>{if(Nn*Ut(.707)<gn)return 1;const gi=Math.sqrt(Nn/gn);return gi/(1.4144271570014144+(Math.pow(1.1,gi-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(zt,pr),fn))};if(this.renderWorldCopies)for(let ir=1;ir<=3;ir++)Ht.push(It(-ir)),Ht.push(It(ir));for(Ht.push(It(0));Ht.length>0;){const ir=Ht.pop(),vr=ir.x,Or=ir.y;let zt=ir.fullyVisible;if(!zt){const Kt=ir.aabb.intersects(Ie);if(0===Kt)continue;zt=2===Kt}if(ir.zoom!==Rt&&Tr(ir))for(let Kt=0;Kt<4;Kt++){const fn=(vr<<1)+Kt%2,Ln=(Or<<1)+(Kt>>1),gn={aabb:M?ir.aabb.quadrant(Kt):c.tileAABB(this,B,ir.zoom+1,fn,Ln,ir.wrap,ir.minZ,ir.maxZ,this.projection),zoom:ir.zoom+1,x:fn,y:Ln,wrap:ir.wrap,fullyVisible:zt,tileID:void 0,shouldSplit:void 0,minZ:ir.minZ,maxZ:ir.maxZ};E&&!J&&(gn.tileID=new c.OverscaledTileID(ir.zoom+1===Rt?Dr:ir.zoom+1,ir.wrap,ir.zoom+1,fn,Ln),er(gn)),Ht.push(gn)}else{const Kt=ir.zoom===Rt?Dr:ir.zoom;if(i.minzoom&&i.minzoom>Kt)continue;const fn=Q[0]-(.5+vr+(ir.wrap<<ir.zoom))*(1<<h-ir.zoom),Ln=Q[1]-.5-Or,gn=ir.tileID?ir.tileID:new c.OverscaledTileID(Kt,ir.wrap,ir.zoom,vr,Or);jt.push({tileID:gn,distanceSq:fn*fn+Ln*Ln})}}if(this.fogCullDistSq){const ir=this.fogCullDistSq,vr=this.horizonLineFromTop();jt=jt.filter(Or=>{const zt=[0,0,0,1],Kt=[c.EXTENT,c.EXTENT,0,1],fn=this.calculateFogTileMatrix(Or.tileID.toUnwrapped());c.transformMat4$1(zt,zt,fn),c.transformMat4$1(Kt,Kt,fn);const Ln=c.getAABBPointSquareDist(zt,Kt);if(0===Ln)return!0;let gn=!1;const Nn=this._elevation;if(Nn&&Ln>ir&&0!==vr){const gi=this.calculateProjMatrix(Or.tileID.toUnwrapped());let Pn;i.isTerrainDEM||(Pn=Nn.getMinMaxForTile(Or.tileID)),Pn||(Pn={min:at,max:Xe});const Kr=c.furthestTileCorner(this.rotation),Do=[Kr[0]*c.EXTENT,Kr[1]*c.EXTENT,Pn.max];c.transformMat4(Do,Do,gi),gn=(1-Do[1])*this.height*.5<vr}return Ln<ir||gn})}return jt.sort((ir,vr)=>ir.distanceSq-vr.distanceSq).map(ir=>ir.tileID)}resize(i,h){this.width=i,this.height=h,this.pixelsToGLUnits=[2/i,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const h=c.clamp(i.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),_=this.projection.project(i.lng,h);return new c.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,h){let _,E;const M=this.centerPoint;if("globe"===this.projection.name){const N=this.worldSize;_=(h.x-M.x)/N,E=(h.y-M.y)/N}else{const N=this.pointCoordinate(h),B=this.pointCoordinate(M);_=N.x-B.x,E=N.y-B.y}const O=this.locationCoordinate(i);this.setLocation(new c.MercatorCoordinate(O.x-_,O.y-E))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,h){const _=h?c.mercatorZfromAltitude(h,i.lat):void 0,E=this.projection.project(i.lng,i.lat);return new c.MercatorCoordinate(E.x,E.y,_)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,h){const _=h??this._centerAltitude,E=[i.x,i.y,0,1],M=[i.x,i.y,1,1];c.transformMat4$1(E,E,this.pixelMatrixInverse),c.transformMat4$1(M,M,this.pixelMatrixInverse);const O=M[3];c.scale$1(E,E,1/E[3]),c.scale$1(M,M,1/O);const N=E[2],B=M[2];return{p0:E,p1:M,t:N===B?0:(_-N)/(B-N)}}screenPointToMercatorRay(i){const h=[i.x,i.y,0,1],_=[i.x,i.y,1,1];return c.transformMat4$1(h,h,this.pixelMatrixInverse),c.transformMat4$1(_,_,this.pixelMatrixInverse),c.scale$1(h,h,1/h[3]),c.scale$1(_,_,1/_[3]),h[2]=c.mercatorZfromAltitude(h[2],this._center.lat)*this.worldSize,_[2]=c.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,c.scale$1(h,h,1/this.worldSize),c.scale$1(_,_,1/this.worldSize),new c.Ray([h[0],h[1],h[2]],c.normalize([],c.sub([],_,h)))}rayIntersectionCoordinate(i){const{p0:h,p1:_,t:E}=i,M=c.mercatorZfromAltitude(h[2],this._center.lat),O=c.mercatorZfromAltitude(_[2],this._center.lat);return new c.MercatorCoordinate(c.number(h[0],_[0],E)/this.worldSize,c.number(h[1],_[1],E)/this.worldSize,c.number(M,O,E))}pointCoordinate(i,h=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,h)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let h=this.projection.pointCoordinate3D(this,i.x,i.y);if(h)return new c.MercatorCoordinate(h[0],h[1],h[2]);let _=0,E=this.horizonLineFromTop();if(i.y>E)return this.pointCoordinate(i);const M=.02*E,O=i.clone();for(let N=0;N<10&&E-_>M;N++){O.y=c.number(_,E,.66);const B=this.projection.pointCoordinate3D(this,O.x,O.y);B?(E=O.y,h=B):_=O.y}return h?new c.MercatorCoordinate(h[0],h[1],h[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}_coordinatePoint(i,h){const _=h&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,E=[i.x*this.worldSize,i.y*this.worldSize,_+i.toAltitude(),1];return c.transformMat4$1(E,E,this.pixelMatrix),E[3]>0?new c.pointGeometry(E[0]/E[3],E[1]/E[3]):new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:i,left:h}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,E=this.width-this._edgeInsets.right,M=this.pointCoordinate3D(new c.pointGeometry(h,i)),O=this.pointCoordinate3D(new c.pointGeometry(E,i)),N=this.pointCoordinate3D(new c.pointGeometry(E,_)),B=this.pointCoordinate3D(new c.pointGeometry(h,_));let Q=Math.min(M.x,B.x),J=Math.max(O.x,N.x),fe=Math.min(M.y,O.y),Ie=Math.max(B.y,N.y);const je=Math.pow(2,-this.zoom)/16,Be=(mt,It,Ht,jt)=>{const Rt=(mt+Ht)/2,Dr=(It+jt)/2,Ut=new c.pointGeometry(Rt,Dr),pr=this.pointCoordinate3D(Ut),er=Math.max(0,Q-pr.x,fe-pr.y,pr.x-J,pr.y-Ie);Q=Math.min(Q,pr.x),J=Math.max(J,pr.x),fe=Math.min(fe,pr.y),Ie=Math.max(Ie,pr.y),er>je&&(Be(mt,It,Rt,Dr),Be(Rt,Dr,Ht,jt))};Be(h,i,E,i),Be(E,i,E,_),Be(E,_,h,_),Be(h,_,h,i);const[Ve,Le]=c.polesInViewport(this),De=Ve||Le,He=Ve?90:c.latFromMercatorY(fe),Xe=De?180:c.lngFromMercatorX(J),at=Le?-90:c.latFromMercatorY(Ie),_t=De?-180:c.lngFromMercatorX(Q);return new c.LngLatBounds(new c.LngLat(_t,at),new c.LngLat(Xe,He))}_getBounds(i,h){if("globe"===this.projection.name)return this._getGlobeBounds();const _=new c.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),E=new c.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),M=new c.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),O=new c.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let N=this.pointCoordinate(_,i),B=this.pointCoordinate(E,i);const Q=this.pointCoordinate(M,h),J=this.pointCoordinate(O,h),fe=(Ie,je)=>(je.y-Ie.y)/(je.x-Ie.x);return N.y>1&&B.y>=0?N=new c.MercatorCoordinate((1-J.y)/fe(J,N)+J.x,1):N.y<0&&B.y<=1&&(N=new c.MercatorCoordinate(-J.y/fe(J,N)+J.x,0)),B.y>1&&N.y>=0?B=new c.MercatorCoordinate((1-Q.y)/fe(Q,B)+Q.x,1):B.y<0&&N.y<=1&&(B=new c.MercatorCoordinate(-Q.y/fe(Q,B)+Q.x,0)),(new c.LngLatBounds).extend(this.coordinateLocation(N)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(J)).extend(this.coordinateLocation(Q))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBounds(0,0);const h=i.visibleDemTiles.reduce((_,E)=>{if(E.dem){const M=E.dem.tree;_.min=Math.min(_.min,M.minimums[0]),_.max=Math.max(_.max,M.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBounds(h.min*i.exaggeration(),h.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const h=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-h*(1-this._horizonShift);return i?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-c.MAX_MERCATOR_LATITUDE,this.maxLat=c.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=c.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=c.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=c.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,h){return this.projection.createTileMatrix(this,h,i)}calculateDistanceTileData(i){const h=i.key,_=this._distanceTileDataCache;if(_[h])return _[h];const E=i.canonical,M=1/this.height,O=this.cameraWorldSize,N=O/this.zoomScale(E.z),B=(E.x+Math.pow(2,E.z)*i.wrap)*N,Q=E.y*N,J=this.point;J.x*=O/this.worldSize,J.y*=O/this.worldSize;const fe=this.angle,Ie=Math.sin(-fe),je=-Math.cos(-fe);return _[h]={bearing:[Ie,je],center:[(J.x-B)*M,(J.y-Q)*M],scale:N/c.EXTENT*M},_[h]}calculateFogTileMatrix(i){const h=i.key,_=this._fogTileMatrixCache;if(_[h])return _[h];const E=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return c.multiply(E,this.worldToFogMatrix,E),_[h]=new Float32Array(E),_[h]}calculateProjMatrix(i,h=!1){const _=i.key,E=h?this._alignedProjMatrixCache:this._projMatrixCache;if(E[_])return E[_];const M=this.calculatePosMatrix(i,this.worldSize);return c.multiply(M,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:h?this.alignedProjMatrix:this.projMatrix,M),E[_]=new Float32Array(M),E[_]}calculatePixelsToTileUnitsMatrix(i){const h=i.tileID.key,_=this._pixelsToTileUnitsCache;if(_[h])return _[h];const E=function(M,O){const{scale:N}=M.tileTransform,B=N*c.EXTENT/(M.tileSize*Math.pow(2,O.zoom-M.tileID.overscaledZ+M.tileID.canonical.z));return Q=new Float32Array(4),Ie=(J=O.inverseAdjustmentMatrix)[1],je=J[2],Be=J[3],Le=(fe=[B,B])[1],Q[0]=J[0]*(Ve=fe[0]),Q[1]=Ie*Ve,Q[2]=je*Le,Q[3]=Be*Le,Q;var Q,J,fe,Ie,je,Be,Ve,Le}(i,this);return _[h]=E,_[h]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const i=this._elevation;this._updateCameraState();const h=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(h),E=this._camera.forward(),M=c.mercatorZfromAltitude(1,this._center.lat);_[2]/=M,E[2]/=M,c.normalize(E,E);const O=i.raycast(_,E,i.exaggeration());if(O){const N=c.scaleAndAdd([],_,E,O),B=new c.MercatorCoordinate(N[0],N[1],c.mercatorZfromAltitude(N[2],c.latFromMercatorY(N[1]))),Q=(B.z+c.length([B.x-_[0],B.y-_[1],B.z-_[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(Q),this._centerAltitude=B.toAltitude(),this._center=this.coordinateLocation(B),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const h=this._elevation,_=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,E=this._computeCameraPosition(_),M=h.getAtPointOrZero(new c.MercatorCoordinate(...E)),O=this.pixelsPerMeter/this.worldSize*M,N=this._minimumHeightOverTerrain(),B=E[2]-O;if(B<=N)if(B<0||i){const Q=this.locationCoordinate(this._center,this._centerAltitude),J=[E[0],E[1],Q.z-E[2]],fe=c.length(J);J[2]-=(N-B)/this._pixelsPerMercatorPixel;const Ie=c.length(J);if(0===Ie)return;c.scale$2(J,J,fe/Ie*this._pixelsPerMercatorPixel),this._camera.position=[E[0],E[1],Q.z*this._pixelsPerMercatorPixel-J[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const Ie=this.center;return Ie.lat=c.clamp(Ie.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(Ie.lng=c.clamp(Ie.lng,this.minLng,this.maxLng)),this.center=Ie,void(this._constraining=!1)}const h=this._unmodified,{x:_,y:E}=this.point;let M=0,O=_,N=E;const B=this.width/2,Q=this.height/2,J=this.worldMinY*this.scale,fe=this.worldMaxY*this.scale;if(E-Q<J&&(N=J+Q),E+Q>fe&&(N=fe-Q),fe-J<this.height&&(M=Math.max(M,this.height/(fe-J)),N=(fe+J)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Ie=this.worldMinX*this.scale,je=this.worldMaxX*this.scale,Be=this.worldSize/2-(Ie+je)/2;O=(_+Be+this.worldSize)%this.worldSize-Be,O-B<Ie&&(O=Ie+B),O+B>je&&(O=je-B),je-Ie<this.width&&(M=Math.max(M,this.width/(je-Ie)),O=(je+Ie)/2)}O===_&&N===E||(this.center=this.unproject(new c.pointGeometry(O,N))),M&&(this.zoom+=this.scaleZoom(M)),this._constrainCamera(),this._unmodified=h,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,h=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=c.mercatorZfromAltitude(1,this.center.lat)/c.mercatorZfromAltitude(1,c.GLOBE_SCALE_MATCH_LATITUDE));const _=Ma(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const E=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?h:1),M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);M[8]=2*-i.x/this.width,M[9]=2*i.y/this.height;let O=c.mul([],M,E);if(this.projection.isReprojectedInTileSpace){const _t=this.locationCoordinate(this.center),mt=c.identity([]);c.translate(mt,mt,[_t.x*this.worldSize,_t.y*this.worldSize,0]),c.multiply(mt,mt,Gl(this)),c.translate(mt,mt,[-_t.x*this.worldSize,-_t.y*this.worldSize,0]),c.multiply(O,O,mt),this.inverseAdjustmentMatrix=function(It){const Ht=Gl(It,!0);return se([],[Ht[0],Ht[1],Ht[4],Ht[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=c.scale([],O,[this.worldSize,this.worldSize,this.worldSize/h,1]),this.projMatrix=O,this.invProjMatrix=c.invert(new Float64Array(16),this.projMatrix);const N=c.invert([],M);this.frustumCorners=c.FrustumCorners.fromInvProjectionMatrix(N,this.horizonLineFromTop(),this.height);const B=new Float32Array(16);c.identity(B),c.scale(B,B,[1,-1,1]),c.rotateX(B,B,this._pitch),c.rotateZ(B,B,this.angle);const Q=c.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),J=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;Q[8]=2*-i.x/this.width,Q[9]=2*(i.y+J)/this.height,this.skyboxMatrix=c.multiply(B,Q,B);const fe=this.point,Ie=fe.x,je=fe.y,Be=this.width%2/2,Ve=this.height%2/2,Le=Math.cos(this.angle),De=Math.sin(this.angle),He=Ie-Math.round(Ie)+Le*Be+De*Ve,Xe=je-Math.round(je)+Le*Ve+De*Be,at=new Float64Array(O);if(c.translate(at,at,[He>.5?He-1:He,Xe>.5?Xe-1:Xe,0]),this.alignedProjMatrix=at,O=c.create(),c.scale(O,O,[this.width/2,-this.height/2,1]),c.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=c.create(),c.scale(O,O,[1,-1,1]),c.translate(O,O,[-1,-1,0]),c.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},O=c.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=c.calculateGlobeMatrix(this);const _t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.transformMat4(_t,_t,E),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,h=this.cameraPixelsPerMeter,_=this._camera.position,E=1/this.height/this._pixelsPerMercatorPixel,M=[i,i,h];c.scale$2(M,M,E),c.scale$2(_,_,-1),c.multiply$2(_,_,M);const O=c.create();c.translate(O,O,_),c.scale(O,O,M),this.mercatorFogMatrix=O,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,h,E)}_computeCameraPosition(i){const h=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),E=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*h-i/this.worldSize*this._centerAltitude;return[E.x/this.worldSize-_[0]*M,E.y/this.worldSize-_[1]*M,i/this.worldSize*this._centerAltitude-_[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const h=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],E=i[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),E>0&&(M=Math.min((h-_)/E,1)),this._camera.position=c.scaleAndAdd([],this._camera.position,i,M),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,h=this._camera.forward(),{pitch:_,bearing:E}=this._camera.getPitchBearing(),M=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,O=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.degToRad(this._maxPitch)),N=Math.max((i[2]-M)/Math.cos(_),O),B=this._zoomFromMercatorZ(N);c.scaleAndAdd(i,i,h,N),this._pitch=c.clamp(_,c.degToRad(this.minPitch),c.degToRad(this.maxPitch)),this.angle=c.wrap(E,-Math.PI,Math.PI),this._setZoom(c.clamp(B,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){const h=O=>{const N=this.getCameraToCenterDistance(this.projection,O);return this.scaleZoom(N/(i*this.tileSize))};let _,E=h(this.zoom),M=Math.abs(E-h(E));for(;_!==M;)E=h(E),_=M,M=Math.abs(E-h(E));return E}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,h){const _=Math.min(i.x,h.x),E=Math.max(i.x,h.x),M=Math.min(i.y,h.y),O=Math.max(i.y,h.y);if(M<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const N=[new c.pointGeometry(_,M),new c.pointGeometry(E,O),new c.pointGeometry(_,O),new c.pointGeometry(E,M)],B=this.renderWorldCopies?-3:0,Q=this.renderWorldCopies?4:1;for(const J of N){const fe=this.pointRayIntersection(J);if(fe.t<0)return!0;const Ie=this.rayIntersectionCoordinate(fe);if(Ie.x<B||Ie.y<0||Ie.x>Q||Ie.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.pointGeometry(0,0),new c.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,h){const _=c.length(c.sub([],this._camera.position,i)),E=this._zoomFromMercatorZ(_)+h;return _-this._mercatorZfromZoom(E)}getCameraPoint(){if("globe"===this.projection.name){const i=function([h,_,E],M){const O=[h,_,E,1];c.transformMat4$1(O,O,M);const N=O[3]=Math.max(O[3],1e-6);return O[0]/=N,O[1]/=N,O[2]/=N,O}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.pointGeometry(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.pointGeometry(0,i))}}getCameraToCenterDistance(i,h=this.zoom){const _=Ma(i,h,this.width,this.height,1024),E=i.pixelSpaceConversion(this.center.lat,this.worldSize,_);return.5/Math.tan(.5*this._fov)*this.height*E}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&c.multiply(i,i,this.globeMatrix),i}}function bl(g,i){let h=!1,_=null;const E=()=>{_=null,h&&(g(),_=setTimeout(E,i),h=!1)};return()=>(h=!0,_||E(),_)}class Hr{constructor(i){this._hashName=i&&encodeURIComponent(i),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=bl(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,c.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),c.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const h=Ia(i);if(this._hashName){const _=this._hashName;let E=!1;const M=c.window.location.hash.slice(1).split("&").map(O=>{const N=O.split("=")[0];return N===_?(E=!0,`${N}=${h}`):O}).filter(O=>O);return E||M.push(`${_}=${h}`),`#${M.join("&")}`}return`#${h}`}_getCurrentHash(){const i=c.window.location.hash.replace("#","");if(this._hashName){let h;return i.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(h=_)}),(h&&h[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const h=this._getCurrentHash();if(h.length>=3&&!h.some(_=>isNaN(_))){const _=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(h[3]||0):i.getBearing();return i.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:_,pitch:+(h[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=c.window.location.href.replace(/(#.+)?$/,this.getHashString());c.window.history.replaceState(c.window.history.state,null,i)}}function Ia(g,i){const h=g.getCenter(),_=Math.round(100*g.getZoom())/100,E=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,E),O=Math.round(h.lng*M)/M,N=Math.round(h.lat*M)/M,B=g.getBearing(),Q=g.getPitch();let J=i?`/${O}/${N}/${_}`:`${_}/${N}/${O}`;return(B||Q)&&(J+="/"+Math.round(10*B)/10),Q&&(J+=`/${Math.round(Q)}`),J}const pl={linearity:.3,easing:c.bezier(0,0,.3,1)},As=c.extend({deceleration:2500,maxSpeed:1400},pl),pa=c.extend({deceleration:20,maxSpeed:1400},pl),jl=c.extend({deceleration:1e3,maxSpeed:360},pl),fa=c.extend({deceleration:1e3,maxSpeed:90},pl);class pu{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,h=c.exported.now();for(;i.length>0&&h-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new c.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)h.zoom+=M.zoomDelta||0,h.bearing+=M.bearingDelta||0,h.pitch+=M.pitchDelta||0,M.panDelta&&h.pan._add(M.panDelta),M.around&&(h.around=M.around),M.pinchAround&&(h.pinchAround=M.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(h.pan.mag()){const M=as(h.pan.mag(),_,c.extend({},As,i||{}));E.offset=h.pan.mult(M.amount/h.pan.mag()),E.center=this._map.transform.center,fu(E,M)}if(h.zoom){const M=as(h.zoom,_,pa);E.zoom=this._map.transform.zoom+M.amount,fu(E,M)}if(h.bearing){const M=as(h.bearing,_,jl);E.bearing=this._map.transform.bearing+c.clamp(M.amount,-179,179),fu(E,M)}if(h.pitch){const M=as(h.pitch,_,fa);E.pitch=this._map.transform.pitch+M.amount,fu(E,M)}if(E.zoom||E.bearing){const M=void 0===h.pinchAround?h.around:h.pinchAround;E.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),E.noMoveStart=!0,E}}function fu(g,i){(!g.duration||g.duration<i.duration)&&(g.duration=i.duration,g.easing=i.easing)}function as(g,i,h){const{maxSpeed:_,linearity:E,deceleration:M}=h,O=c.clamp(g*E/(i/1e3),-_,_),N=Math.abs(O)/(M*E);return{easing:h.easing,duration:1e3*N,amount:O*(N/2)}}class tl extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,_,E={}){const M=X(h.getCanvasContainer(),_),O=h.unproject(M);super(i,c.extend({point:M,lngLat:O,originalEvent:_},E)),this._defaultPrevented=!1,this.target=h}}class rl extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,_){const E="touchend"===i?_.changedTouches:_.touches,M=ee(h.getCanvasContainer(),E),O=M.map(B=>h.unproject(B)),N=M.reduce((B,Q,J,fe)=>B.add(Q.div(fe.length)),new c.pointGeometry(0,0));super(i,{points:M,point:N,lngLats:O,lngLat:h.unproject(N),originalEvent:_}),this._defaultPrevented=!1}}class Ru extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,h,_){super(i,{originalEvent:_}),this._defaultPrevented=!1}}class hc{constructor(i,h){this._map=i,this._clickTolerance=h.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Ru(i.type,this._map,i))}mousedown(i,h){return this._mousedownPos=h,this._firePreventable(new tl(i.type,this._map,i))}mouseup(i){this._map.fire(new tl(i.type,this._map,i))}preclick(i){const h=c.extend({},i);h.type="preclick",this._map.fire(new tl(h.type,this._map,h))}click(i,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||(this.preclick(i),this._map.fire(new tl(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new tl(i.type,this._map,i))}mouseover(i){this._map.fire(new tl(i.type,this._map,i))}mouseout(i){this._map.fire(new tl(i.type,this._map,i))}touchstart(i){return this._firePreventable(new rl(i.type,this._map,i))}touchmove(i){this._map.fire(new rl(i.type,this._map,i))}touchend(i){this._map.fire(new rl(i.type,this._map,i))}touchcancel(i){this._map.fire(new rl(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Mp{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new tl(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new tl(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class uh{constructor(i,h){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,h){this.isEnabled()&&i.shiftKey&&0===i.button&&(We(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(i,h){if(!this._active)return;const _=h,E=this._startPos,M=this._lastPos;if(!E||!M||M.equals(_)||!this._box&&_.dist(E)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=Te("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const O=Math.min(E.x,_.x),N=Math.max(E.x,_.x),B=Math.min(E.y,_.y),Q=Math.max(E.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${O}px,${B}px)`,this._box.style.width=N-O+"px",this._box.style.height=Q-B+"px")})}mouseupWindow(i,h){if(!this._active)return;const _=this._startPos,E=h;if(_&&0===i.button){if(this.reset(),K(),_.x!==E.x||_.y!==E.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:M=>M.fitScreenCoordinates(_,E,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),H(),delete this._startPos,delete this._lastPos}_fireEvent(i,h){return this._map.fire(new c.Event(i,{originalEvent:h}))}}function qa(g,i){const h={};for(let _=0;_<g.length;_++)h[g[_].identifier]=i[_];return h}class du{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,h,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=i.timeStamp),_.length===this.numTouches&&(this.centroid=function(E){const M=new c.pointGeometry(0,0);for(const O of E)M._add(O);return M.div(E.length)}(h),this.touches=qa(_,h)))}touchmove(i,h,_){if(this.aborted||!this.centroid)return;const E=qa(_,h);for(const M in this.touches){const O=this.touches[M],N=E[M];(!N||N.dist(O)>30)&&(this.aborted=!0)}}touchend(i,h,_){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const E=!this.aborted&&this.centroid;if(this.reset(),E)return E}}}class ql{constructor(i){this.singleTap=new du(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,h,_){this.singleTap.touchstart(i,h,_)}touchmove(i,h,_){this.singleTap.touchmove(i,h,_)}touchend(i,h,_){const E=this.singleTap.touchend(i,h,_);if(E){const M=i.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(E)<30;if(M&&O||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=E,this.count===this.numTaps)return this.reset(),E}}}class Fc{constructor(){this._zoomIn=new ql({numTouches:1,numTaps:2}),this._zoomOut=new ql({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,h,_){this._zoomIn.touchstart(i,h,_),this._zoomOut.touchstart(i,h,_)}touchmove(i,h,_){this._zoomIn.touchmove(i,h,_),this._zoomOut.touchmove(i,h,_)}touchend(i,h,_){const E=this._zoomIn.touchend(i,h,_),M=this._zoomOut.touchend(i,h,_);return E?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(E)},{originalEvent:i})}):M?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(M)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Vl={0:1,2:2};class fl{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,h){return!1}_move(i,h){return{}}mousedown(i,h){if(this._lastPoint)return;const _=ie(i);this._correctButton(i,_)&&(this._lastPoint=h,this._eventButton=_)}mousemoveWindow(i,h){const _=this._lastPoint;if(_)if(i.preventDefault(),null!=this._eventButton&&function(E,M){const O=Vl[M];return void 0===E.buttons||(E.buttons&O)!==O}(i,this._eventButton))this.reset();else if(this._moved||!(h.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=h,this._move(_,h)}mouseupWindow(i){this._lastPoint&&ie(i)===this._eventButton&&(this._moved&&K(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nu extends fl{mousedown(i,h){super.mousedown(i,h),this._lastPoint&&(this._active=!0)}_correctButton(i,h){return 0===h&&!i.ctrlKey}_move(i,h){return{around:h,panDelta:h.sub(i)}}}class Hl extends fl{_correctButton(i,h){return 0===h&&i.ctrlKey||2===h}_move(i,h){const _=.8*(h.x-i.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(i){i.preventDefault()}}class kl extends fl{_correctButton(i,h){return 0===h&&i.ctrlKey||2===h}_move(i,h){const _=-.5*(h.y-i.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(i){i.preventDefault()}}class Zn{constructor(i,h){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset(),c.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.pointGeometry(0,0)}touchstart(i,h,_){return this._calculateTransform(i,h,_)}touchmove(i,h,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!c.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,h,_)}}touchend(i,h,_){this._calculateTransform(i,h,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,h,_){_.length>0&&(this._active=!0);const E=qa(_,h),M=new c.pointGeometry(0,0),O=new c.pointGeometry(0,0);let N=0;for(const Q in E){const J=E[Q],fe=this._touches[Q];fe&&(M._add(J),O._add(J.sub(fe)),N++,E[Q]=J)}if(this._touches=E,N<this._minTouches||!O.mag())return;const B=O.div(N);return this._sum._add(B),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(N),panDelta:B}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Te("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Rl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,h,_){return{}}touchstart(i,h,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([h[0],h[1]]))}touchmove(i,h,_){const E=this._firstTwoTouches;if(!E)return;i.preventDefault();const[M,O]=E,N=Pa(_,h,M),B=Pa(_,h,O);if(!N||!B)return;const Q=this._aroundCenter?null:N.add(B).div(2);return this._move([N,B],Q,i)}touchend(i,h,_){if(!this._firstTwoTouches)return;const[E,M]=this._firstTwoTouches,O=Pa(_,h,E),N=Pa(_,h,M);O&&N||(this._active&&K(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Pa(g,i,h){for(let _=0;_<g.length;_++)if(g[_].identifier===h)return i[_]}function Jl(g,i){return Math.log(g/i)/Math.LN2}class Va extends Rl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,h){const _=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(Jl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jl(this._distance,_),pinchAround:h}}}function ch(g,i){return 180*g.angleWith(i)/Math.PI}class Za extends Rl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,h){const _=this._vector;if(this._vector=i[0].sub(i[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ch(this._vector,_),pinchAround:h}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const h=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const E=ch(i,_);return Math.abs(E)<h}}function ts(g){return Math.abs(g.y)>Math.abs(g.x)}class zc extends Rl{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,ts(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,h,_){const E=this._lastPoints;if(!E)return;const M=i[0].sub(E[0]),O=i[1].sub(E[1]);return this._map._cooperativeGestures&&!c.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(M,O,_.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(M.y+O.y)/2*-.5})}gestureBeginsVertically(i,h,_){if(void 0!==this._valid)return this._valid;const E=i.mag()>=2,M=h.mag()>=2;if(!E&&!M)return;if(!E||!M)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const O=i.y>0==h.y>0;return ts(i)&&ts(h)&&O}}const Hu={panStep:100,bearingStep:15,pitchStep:10};class r{constructor(){const i=Hu;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let h=0,_=0,E=0,M=0,O=0;switch(i.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:i.shiftKey?_=-1:(i.preventDefault(),M=-1);break;case 39:i.shiftKey?_=1:(i.preventDefault(),M=1);break;case 38:i.shiftKey?E=1:(i.preventDefault(),O=-1);break;case 40:i.shiftKey?E=-1:(i.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(_=0,E=0),{cameraAnimation:N=>{const B=N.getZoom();N.easeTo({duration:300,easeId:"keyboardHandler",easing:s,zoom:h?Math.round(B)+h*(i.shiftKey?2:1):B,bearing:N.getBearing()+_*this._bearingStep,pitch:N.getPitch()+E*this._pitchStep,offset:[-M*this._panStep,-O*this._panStep],center:N.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function s(g){return g*(2-g)}const f=4.000244140625;class m{constructor(i,h){this._map=i,this._el=i.getCanvasContainer(),this._handler=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||c.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let h=i.deltaMode===c.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const _=c.exported.now(),E=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==h&&h%f==0?this._type="wheel":0!==h&&Math.abs(h)<4?this._type="trackpad":E>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(E*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),i.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=i,this._delta-=h,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=X(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:h,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;"wheel"===this._type&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const h=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const B="wheel"===this._type&&Math.abs(this._delta)>f?this._wheelZoomRate:this._defaultZoomRate;let Q=2/(1+Math.exp(-Math.abs(this._delta*B)));this._delta<0&&0!==Q&&(Q=1/Q);const J=h(),fe=Math.pow(2,J),Ie="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):fe;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(Ie*Q))),"wheel"===this._type&&(this._startZoom=J,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:h(),E=this._startZoom,M=this._easing;let O,N=!1;if("wheel"===this._type&&E&&M){const B=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),Q=M(B);O=c.number(E,_,Q),B<1?this._frameId||(this._frameId=!0):N=!0}else O=_,N=!0;return this._active=!0,N&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!N,zoomDelta:O-h(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let h=c.ease;if(this._prevEase){const _=this._prevEase,E=(c.exported.now()-_.start)/_.duration,M=_.easing(E+.01)-_.easing(E),O=.27/Math.sqrt(M*M+1e-4)*.01,N=Math.sqrt(.0729-O*O);h=c.bezier(O,N,.25,1)}return this._prevEase={start:c.exported.now(),duration:i,easing:h},h}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Te("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(c.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class S{constructor(i,h){this._clickZoom=i,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class k{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,h){return i.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(i.shiftKey?-1:1),around:_.unproject(h)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class V{constructor(){this._tap=new ql({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,h,_){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=h[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(i,h,_))}touchmove(i,h,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const E=h[0],M=E.y-this._swipePoint.y;return this._swipePoint=E,i.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(i,h,_)}touchend(i,h,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(i,h,_)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class de{constructor(i,h,_){this._el=i,this._mousePan=h,this._touchPan=_}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Re{constructor(i,h,_){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=h,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class yt{constructor(i,h,_,E){this._el=i,this._touchZoom=h,this._touchRotate=_,this._tapDragZoom=E,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gt=g=>g.zoom||g.drag||g.pitch||g.rotate;class ar extends c.Event{}class Gr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,h){const _=c.sub([],h,i);this.radius=c.length(_[2]<0?c.div([],_,this.constants):[_[0],_[1],0])}projectRay(i){c.div(i,i,this.constants),c.normalize(i,i),c.mul$1(i,i,this.constants);const h=c.scale$2([],i,this.radius);if(h[2]>0){const _=c.scale$2([],[0,0,1],c.dot(h,[0,0,1])),E=c.scale$2([],c.normalize([],[h[0],h[1],0]),this.radius),M=c.add([],h,c.scale$2([],c.sub([],c.add([],E,_),h),2));h[0]=M[0],h[1]=M[1]}return h}}function Br(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class sn{constructor(i,h){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new pu(i),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Gr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(h),c.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[c.window.document,"mousemove",{capture:!0}],[c.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[c.window,"blur",void 0]];for(const[E,M,O]of this._listeners)E.addEventListener(M,E===c.window.document?this.handleWindowEvent:this.handleEvent,O)}destroy(){for(const[i,h,_]of this._listeners)i.removeEventListener(h,i===c.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(i){const h=this._map,_=h.getCanvasContainer();this._add("mapEvent",new hc(h,i));const E=h.boxZoom=new uh(h,i);this._add("boxZoom",E);const M=new Fc,O=new k;h.doubleClickZoom=new S(O,M),this._add("tapZoom",M),this._add("clickZoom",O);const N=new V;this._add("tapDragZoom",N);const B=h.touchPitch=new zc(h);this._add("touchPitch",B);const Q=new Hl(i),J=new kl(i);h.dragRotate=new Re(i,Q,J),this._add("mouseRotate",Q,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]);const fe=new Nu(i),Ie=new Zn(h,i);h.dragPan=new de(_,fe,Ie),this._add("mousePan",fe),this._add("touchPan",Ie,["touchZoom","touchRotate"]);const je=new Za,Be=new Va;h.touchZoomRotate=new yt(_,Be,je,N),this._add("touchRotate",je,["touchPan","touchZoom"]),this._add("touchZoom",Be,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Mp(h));const Ve=h.scrollZoom=new m(h,this);this._add("scrollZoom",Ve,["mousePan"]);const Le=h.keyboard=new r;this._add("keyboard",Le);for(const De of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[De]&&h[De].enable(i[De])}_add(i,h,_){this._handlers.push({handlerName:i,handler:h,allowed:_}),this._handlersById[i]=h}stop(i){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gt(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,h,_){for(const E in i)if(E!==_&&(!h||h.indexOf(E)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const h=[];for(const _ of i)this._el.contains(_.target)&&h.push(_);return h}handleEvent(i,h){this._updatingCamera=!0;const _="renderFrame"===i.type,E=_?void 0:i,M={needsRenderFrame:!1},O={},N={},B=i.touches?this._getMapTouches(i.touches):void 0,Q=B?ee(this._el,B):_?void 0:X(this._el,i);for(const{handlerName:Ie,handler:je,allowed:Be}of this._handlers){if(!je.isEnabled())continue;let Ve;this._blockedByActive(N,Be,Ie)?je.reset():je[h||i.type]&&(Ve=je[h||i.type](i,Q,B),this.mergeHandlerResult(M,O,Ve,Ie,E),Ve&&Ve.needsRenderFrame&&this._triggerRenderFrame()),(Ve||je.isActive())&&(N[Ie]=je)}const J={};for(const Ie in this._previousActiveHandlers)N[Ie]||(J[Ie]=E);this._previousActiveHandlers=N,(Object.keys(J).length||Br(M))&&(this._changes.push([M,O,J]),this._triggerRenderFrame()),(Object.keys(N).length||Br(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:fe}=M;fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],fe(this._map))}mergeHandlerResult(i,h,_,E,M){if(!_)return;c.extend(i,_);const O={handlerName:E,originalEvent:_.originalEvent||M};void 0!==_.zoomDelta&&(h.zoom=O),void 0!==_.panDelta&&(h.drag=O),void 0!==_.pitchDelta&&(h.pitch=O),void 0!==_.bearingDelta&&(h.rotate=O)}_applyChanges(){const i={},h={},_={};for(const[E,M,O]of this._changes)E.panDelta&&(i.panDelta=(i.panDelta||new c.pointGeometry(0,0))._add(E.panDelta)),E.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+E.pitchDelta),void 0!==E.around&&(i.around=E.around),void 0!==E.aroundCoord&&(i.aroundCoord=E.aroundCoord),void 0!==E.pinchAround&&(i.pinchAround=E.pinchAround),E.noInertia&&(i.noInertia=E.noInertia),c.extend(h,M),c.extend(_,O);this._updateMapTransform(i,h,_),this._changes=[]}_updateMapTransform(i,h,_){const E=this._map,M=E.transform,O=He=>[He.x,He.y,He.z];if((He=>{const Xe=this._eventsInProgress.drag;return Xe&&!this._handlersById[Xe.handlerName].isActive()})()&&!Br(i)){const He=M.zoom;M.cameraElevationReference="sea",M.recenterOnTerrain(),M.cameraElevationReference="ground",He!==M.zoom&&this._map._update(!0)}if(M._isCameraConstrained&&E._stop(!0),!Br(i))return void this._fireEvents(h,_,!0);let{panDelta:N,zoomDelta:B,bearingDelta:Q,pitchDelta:J,around:fe,aroundCoord:Ie,pinchAround:je}=i;M._isCameraConstrained&&(B>0&&(B=0),M._isCameraConstrained=!1),void 0!==je&&(fe=je),(He=>h.drag&&!this._eventsInProgress.drag)()&&fe&&(this._dragOrigin=O(M.pointCoordinate3D(fe)),this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",E._stop(!0),fe=fe||E.transform.centerPoint,Q&&(M.bearing+=Q),J&&(M.pitch+=J),M._updateCameraState();const Be=[0,0,0];if(N)if("mercator"===M.projection.name){const He=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(fe).dir),Xe=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(fe.sub(N)).dir);Be[0]=Xe[0]-He[0],Be[1]=Xe[1]-He[1]}else{const He=M.pointCoordinate(fe);if("globe"===M.projection.name){N=N.rotate(-M.angle);const Xe=M._pixelsPerMercatorPixel/M.worldSize;Be[0]=-N.x*c.mercatorScale(c.latFromMercatorY(He.y))*Xe,Be[1]=-N.y*c.mercatorScale(M.center.lat)*Xe}else{const Xe=M.pointCoordinate(fe.sub(N));He&&Xe&&(Be[0]=Xe.x-He.x,Be[1]=Xe.y-He.y)}}const Ve=M.zoom,Le=[0,0,0];if(B){const He=O(Ie||M.pointCoordinate3D(fe)),Xe={dir:c.normalize([],c.sub([],He,M._camera.position))};if(Xe.dir[2]<0){const at=M.zoomDeltaToMovement(He,B);c.scale$2(Le,Xe.dir,at)}}const De=c.add(Be,Be,Le);M._translateCameraConstrained(De),B&&Math.abs(M.zoom-Ve)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(h,_,!0)}_fireEvents(i,h,_){const E=gt(this._eventsInProgress),M=gt(i),O={};for(const J in i){const{originalEvent:fe}=i[J];this._eventsInProgress[J]||(O[`${J}start`]=fe),this._eventsInProgress[J]=i[J]}!E&&M&&this._fireEvent("movestart",M.originalEvent);for(const J in O)this._fireEvent(J,O[J]);M&&this._fireEvent("move",M.originalEvent);for(const J in i){const{originalEvent:fe}=i[J];this._fireEvent(J,fe)}const N={};let B;for(const J in this._eventsInProgress){const{handlerName:fe,originalEvent:Ie}=this._eventsInProgress[J];this._handlersById[fe].isActive()||(delete this._eventsInProgress[J],B=h[fe]||Ie,N[`${J}end`]=B)}for(const J in N)this._fireEvent(J,N[J]);const Q=gt(this._eventsInProgress);if(_&&(E||M)&&!Q){this._updatingCamera=!0;const J=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),fe=Ie=>0!==Ie&&-this._bearingSnap<Ie&&Ie<this._bearingSnap;J?(fe(J.bearing||this._map.getBearing())&&(J.bearing=0),this._map.easeTo(J,{originalEvent:B})):(this._map.fire(new c.Event("moveend",{originalEvent:B})),fe(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,h){this._map.fire(new c.Event(i,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new ar("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Mn="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class no extends c.Evented{constructor(i,h){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=h.bearingSnap,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,h){return this.jumpTo({center:i},h)}panBy(i,h,_){return i=c.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,c.extend({offset:i},h),_)}panTo(i,h,_){return this.easeTo(c.extend({center:i},h),_)}getZoom(){return this.transform.zoom}setZoom(i,h){return this.jumpTo({zoom:i},h),this}zoomTo(i,h,_){return this.easeTo(c.extend({zoom:i},h),_)}zoomIn(i,h){return this.zoomTo(this.getZoom()+1,i,h),this}zoomOut(i,h){return this.zoomTo(this.getZoom()-1,i,h),this}getBearing(){return this.transform.bearing}setBearing(i,h){return this.jumpTo({bearing:i},h),this}getPadding(){return this.transform.padding}setPadding(i,h){return this.jumpTo({padding:i},h),this}rotateTo(i,h,_){return this.easeTo(c.extend({bearing:i},h),_)}resetNorth(i,h){return this.rotateTo(0,c.extend({duration:1e3},i),h),this}resetNorthPitch(i,h){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},i),h),this}snapToNorth(i,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,h):this}getPitch(){return this.transform.pitch}setPitch(i,h){return this.jumpTo({pitch:i},h),this}cameraForBounds(i,h){i=c.LngLatBounds.convert(i);const _=h&&h.bearing||0,E=h&&h.pitch||0,M=i.getNorthWest(),O=i.getSouthEast();return this._cameraForBounds(this.transform,M,O,_,E,h)}_extendCameraOptions(i){const h={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=c.extend({padding:h,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const _=i.padding;i.padding={top:_,bottom:_,right:_,left:_}}return i.padding=c.extend(h,i.padding),i}_minimumAABBFrustumDistance(i,h){const _=h.max[0]-h.min[0],E=h.max[1]-h.min[1];return _/E>i.aspect?_/(2*Math.tan(.5*i.fovX)*i.aspect):E/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,h,_,E,M,O){const N=i.clone(),B=this._extendCameraOptions(O);N.bearing=E,N.pitch=M;const Q=c.LngLat.convert(h),J=c.LngLat.convert(_),fe=.5*(Q.lat+J.lat),Ie=.5*(Q.lng+J.lng),je=c.latLngToECEF(fe,Ie),Be=c.normalize([],je),Ve=c.normalize([],c.cross([],Be,[0,1,0])),Le=c.cross([],Ve,Be),De=[Ve[0],Ve[1],Ve[2],0,Le[0],Le[1],Le[2],0,Be[0],Be[1],Be[2],0,0,0,0,1],He=[je,c.latLngToECEF(Q.lat,Q.lng),c.latLngToECEF(J.lat,Q.lng),c.latLngToECEF(J.lat,J.lng),c.latLngToECEF(Q.lat,J.lng),c.latLngToECEF(fe,Q.lng),c.latLngToECEF(fe,J.lng),c.latLngToECEF(Q.lat,Ie),c.latLngToECEF(J.lat,Ie)];let Xe=c.Aabb.fromPoints(He.map(zt=>[c.dot(Ve,zt),c.dot(Le,zt),c.dot(Be,zt)]));const at=c.transformMat4([],Xe.center,De);0===c.squaredLength(at)&&c.set(at,0,0,1),c.normalize(at,at),c.scale$2(at,at,c.GLOBE_RADIUS),N.center=c.ecefToLatLng(at);const _t=N.getWorldToCameraMatrix(),mt=c.invert(new Float64Array(16),_t);Xe=c.Aabb.applyTransform(Xe,c.multiply([],_t,De)),c.transformMat4(at,at,_t);const It=.5*(Xe.max[2]-Xe.min[2]),Ht=this._minimumAABBFrustumDistance(N,Xe),jt=c.scale$2([],[0,0,1],It),Rt=c.add(jt,at,jt),Dr=Ht+(0===N.pitch?0:c.distance(at,Rt)),Ut=N.globeCenterInViewSpace,pr=c.sub([],at,[Ut[0],Ut[1],Ut[2]]);c.normalize(pr,pr),c.scale$2(pr,pr,Dr);const er=c.add([],at,pr);c.transformMat4(er,er,mt);const Tr=c.earthRadius/c.GLOBE_RADIUS,ir=c.length(er),vr=c.mercatorZfromAltitude(ir*Tr-c.earthRadius,0),Or=Math.min(N.zoomFromMercatorZAdjusted(vr),B.maxZoom);return Or>.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(N.setProjection({name:"mercator"}),N.zoom=Or,this._cameraForBounds(N,h,_,E,M,O)):{center:N.center,zoom:Or,bearing:E,pitch:M}}queryTerrainElevation(i,h){const _=this.transform.elevation;return _?(h=c.extend({},{exaggerated:!0},h),_.getAtPoint(c.MercatorCoordinate.fromLngLat(i),null,h.exaggerated)):null}_cameraForBounds(i,h,_,E,M,O){if("globe"===i.projection.name)return this._cameraForBoundsOnGlobe(i,h,_,E,M,O);const N=i.clone(),B=this._extendCameraOptions(O),Q=N.padding;N.bearing=E,N.pitch=M;const J=c.LngLat.convert(h),fe=c.LngLat.convert(_),Ie=new c.LngLat(J.lng,fe.lat),je=new c.LngLat(fe.lng,J.lat),Be=N.project(J),Ve=N.project(fe),Le=this.queryTerrainElevation(J),De=this.queryTerrainElevation(fe),He=this.queryTerrainElevation(Ie),Xe=this.queryTerrainElevation(je),at=[[Be.x,Be.y,Math.min(Le||0,De||0,He||0,Xe||0)],[Ve.x,Ve.y,Math.max(Le||0,De||0,He||0,Xe||0)]];let _t=c.Aabb.fromPoints(at);const mt=N.getWorldToCameraMatrix(),It=c.invert(new Float64Array(16),mt);_t=c.Aabb.applyTransform(_t,mt);const Ht=c.sub([],_t.max,_t.min),jt=Q.left||0,Rt=Q.right||0,Dr=Q.bottom||0,Ut=Q.top||0,{left:pr,right:er,top:Tr,bottom:ir}=B.padding,vr=.5*(jt+Rt),Or=.5*(Ut+Dr),zt=Math.min(N.scaleZoom(N.scale*Math.min((N.width-(jt+Rt+pr+er))/Ht[0],(N.height-(Dr+Ut+ir+Tr))/Ht[1])),B.maxZoom),Kt=N.scale/N.zoomScale(zt);_t=new c.Aabb([_t.min[0]-(pr+vr)*Kt,_t.min[1]-(ir+Or)*Kt,_t.min[2]],[_t.max[0]+(er+vr)*Kt,_t.max[1]+(Tr+Or)*Kt,_t.max[2]]);const fn=.5*Ht[2],Ln=this._minimumAABBFrustumDistance(N,_t),gn=[0,0,1,0];c.transformMat4$1(gn,gn,mt),c.normalize$2(gn,gn);const Nn=c.scale$2([],gn,Ln+fn),gi=c.add([],_t.center,Nn),Pn=("number"==typeof B.offset.x&&"number"==typeof B.offset.y?new c.pointGeometry(B.offset.x,B.offset.y):c.pointGeometry.convert(B.offset)).rotate(-c.degToRad(E));_t.center[0]-=Pn.x*Kt,_t.center[1]+=Pn.y*Kt,c.transformMat4(_t.center,_t.center,It),c.transformMat4(gi,gi,It);const Kr=[_t.center[0],_t.center[1],gi[2]*N.pixelsPerMeter];c.scale$2(Kr,Kr,1/N.worldSize);const Do=c.lngFromMercatorX(Kr[0]),mo=c.latFromMercatorY(Kr[1]),Yo=Math.min(N._zoomFromMercatorZ(Kr[2]),B.maxZoom),yo=new c.LngLat(Do,mo);return N.mercatorFromTransition&&Yo<.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(N.setProjection({name:"globe"}),N.zoom=Yo,this._cameraForBounds(N,h,_,E,M,O)):{center:yo,zoom:Yo,bearing:E,pitch:M}}fitBounds(i,h,_){const E=this.cameraForBounds(i,h);return this._fitInternal(E,h,_)}fitScreenCoordinates(i,h,_,E,M){const O=c.pointGeometry.convert(i),N=c.pointGeometry.convert(h),B=new c.pointGeometry(Math.min(O.x,N.x),Math.min(O.y,N.y)),Q=new c.pointGeometry(Math.max(O.x,N.x),Math.max(O.y,N.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(O,N))return this;const J=this.transform.pointLocation3D(B),fe=this.transform.pointLocation3D(Q),Ie=this.transform.pointLocation3D(new c.pointGeometry(B.x,Q.y)),je=this.transform.pointLocation3D(new c.pointGeometry(Q.x,B.y)),Be=[Math.min(J.lng,fe.lng,Ie.lng,je.lng),Math.min(J.lat,fe.lat,Ie.lat,je.lat)],Ve=[Math.max(J.lng,fe.lng,Ie.lng,je.lng),Math.max(J.lat,fe.lat,Ie.lat,je.lat)],Le=E&&E.pitch?E.pitch:this.getPitch(),De=this._cameraForBounds(this.transform,Be,Ve,_,Le,E);return this._fitInternal(De,E,M)}_fitInternal(i,h,_){return i?(delete(h=c.extend(i,h)).padding,h.linear?this.easeTo(h,_):this.flyTo(h,_)):this}jumpTo(i,h){this.stop();const _=i.preloadOnly?this.transform.clone():this.transform;let E=!1,M=!1,O=!1;return"zoom"in i&&_.zoom!==+i.zoom&&(E=!0,_.zoom=+i.zoom),void 0!==i.center&&(_.center=c.LngLat.convert(i.center)),"bearing"in i&&_.bearing!==+i.bearing&&(M=!0,_.bearing=+i.bearing),"pitch"in i&&_.pitch!==+i.pitch&&(O=!0,_.pitch=+i.pitch),null==i.padding||_.isPaddingEqual(i.padding)||(_.padding=i.padding),i.preloadOnly?(this._preloadTiles(_),this):(this.fire(new c.Event("movestart",h)).fire(new c.Event("move",h)),E&&this.fire(new c.Event("zoomstart",h)).fire(new c.Event("zoom",h)).fire(new c.Event("zoomend",h)),M&&this.fire(new c.Event("rotatestart",h)).fire(new c.Event("rotate",h)).fire(new c.Event("rotateend",h)),O&&this.fire(new c.Event("pitchstart",h)).fire(new c.Event("pitch",h)).fire(new c.Event("pitchend",h)),this.fire(new c.Event("moveend",h)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.warnOnce(Mn),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,h){const _=this.transform;if(!_.projection.supportsFreeCamera)return c.warnOnce(Mn),this;this.stop();const E=_.zoom,M=_.pitch,O=_.bearing;_.setFreeCameraOptions(i);const N=E!==_.zoom,B=M!==_.pitch,Q=O!==_.bearing;return this.fire(new c.Event("movestart",h)).fire(new c.Event("move",h)),N&&this.fire(new c.Event("zoomstart",h)).fire(new c.Event("zoom",h)).fire(new c.Event("zoomend",h)),Q&&this.fire(new c.Event("rotatestart",h)).fire(new c.Event("rotate",h)).fire(new c.Event("rotateend",h)),B&&this.fire(new c.Event("pitchstart",h)).fire(new c.Event("pitch",h)).fire(new c.Event("pitchend",h)),this.fire(new c.Event("moveend",h)),this}easeTo(i,h){this._stop(!1,i.easeId),(!1===(i=c.extend({offset:[0,0],duration:500,easing:c.ease},i)).animate||!i.essential&&c.exported.prefersReducedMotion)&&(i.duration=0);const _=this.transform,E=this.getZoom(),M=this.getBearing(),O=this.getPitch(),N=this.getPadding(),B="zoom"in i?+i.zoom:E,Q="bearing"in i?this._normalizeBearing(i.bearing,M):M,J="pitch"in i?+i.pitch:O,fe="padding"in i?i.padding:_.padding,Ie=c.pointGeometry.convert(i.offset);let je,Be,Ve;if("globe"===_.projection.name){const jt=c.MercatorCoordinate.fromLngLat(_.center),Rt=Ie.rotate(-_.angle);jt.x+=Rt.x/_.worldSize,jt.y+=Rt.y/_.worldSize;const Dr=jt.toLngLat(),Ut=c.LngLat.convert(i.center||Dr);this._normalizeCenter(Ut),je=_.centerPoint.add(Rt),Be=new c.pointGeometry(jt.x,jt.y).mult(_.worldSize),Ve=new c.pointGeometry(c.mercatorXfromLng(Ut.lng),c.mercatorYfromLat(Ut.lat)).mult(_.worldSize).sub(Be)}else{je=_.centerPoint.add(Ie);const jt=_.pointLocation(je),Rt=c.LngLat.convert(i.center||jt);this._normalizeCenter(Rt),Be=_.project(jt),Ve=_.project(Rt).sub(Be)}const Le=_.zoomScale(B-E);let De,He;i.around&&(De=c.LngLat.convert(i.around),He=_.locationPoint(De));const Xe=this._zooming||B!==E,at=this._rotating||M!==Q,_t=this._pitching||J!==O,mt=!_.isPaddingEqual(fe),It=jt=>Rt=>{if(Xe&&(jt.zoom=c.number(E,B,Rt)),at&&(jt.bearing=c.number(M,Q,Rt)),_t&&(jt.pitch=c.number(O,J,Rt)),mt&&(jt.interpolatePadding(N,fe,Rt),je=jt.centerPoint.add(Ie)),De)jt.setLocationAtPoint(De,He);else{const Dr=jt.zoomScale(jt.zoom-E),Ut=B>E?Math.min(2,Le):Math.max(.5,Le),pr=Math.pow(Ut,1-Rt),er=jt.unproject(Be.add(Ve.mult(Rt*pr)).mult(Dr));jt.setLocationAtPoint(jt.renderWorldCopies?er.wrap():er,je)}return i.preloadOnly||this._fireMoveEvents(h),jt};if(i.preloadOnly){const jt=this._emulate(It,i.duration,_);return this._preloadTiles(jt),this}const Ht={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Xe,this._rotating=at,this._pitching=_t,this._padding=mt,this._easeId=i.easeId,this._prepareEase(h,i.noMoveStart,Ht),this._ease(It(_),jt=>{_.recenterOnTerrain(),this._afterEase(h,jt)},i),this}_prepareEase(i,h,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",h||_.moving||this.fire(new c.Event("movestart",i)),this._zooming&&!_.zooming&&this.fire(new c.Event("zoomstart",i)),this._rotating&&!_.rotating&&this.fire(new c.Event("rotatestart",i)),this._pitching&&!_.pitching&&this.fire(new c.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new c.Event("move",i)),this._zooming&&this.fire(new c.Event("zoom",i)),this._rotating&&this.fire(new c.Event("rotate",i)),this._pitching&&this.fire(new c.Event("pitch",i))}_afterEase(i,h){if(this._easeId&&h&&this._easeId===h)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,E=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new c.Event("zoomend",i)),E&&this.fire(new c.Event("rotateend",i)),M&&this.fire(new c.Event("pitchend",i)),this.fire(new c.Event("moveend",i))}flyTo(i,h){if(!i.essential&&c.exported.prefersReducedMotion){const zt=c.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(zt,h)}this.stop(),i=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},i);const _=this.transform,E=this.getZoom(),M=this.getBearing(),O=this.getPitch(),N=this.getPadding(),B="zoom"in i?c.clamp(+i.zoom,_.minZoom,_.maxZoom):E,Q="bearing"in i?this._normalizeBearing(i.bearing,M):M,J="pitch"in i?+i.pitch:O,fe="padding"in i?i.padding:_.padding,Ie=_.zoomScale(B-E),je=c.pointGeometry.convert(i.offset);let Be=_.centerPoint.add(je);const Ve=_.pointLocation(Be),Le=c.LngLat.convert(i.center||Ve);this._normalizeCenter(Le);const De=_.project(Ve),He=_.project(Le).sub(De);let Xe=i.curve;const at=Math.max(_.width,_.height),_t=at/Ie,mt=He.mag();if("minZoom"in i){const zt=c.clamp(Math.min(i.minZoom,E,B),_.minZoom,_.maxZoom),Kt=at/_.zoomScale(zt-E);Xe=Math.sqrt(Kt/mt*2)}const It=Xe*Xe;function Ht(zt){const Kt=(_t*_t-at*at+(zt?-1:1)*It*It*mt*mt)/(2*(zt?_t:at)*It*mt);return Math.log(Math.sqrt(Kt*Kt+1)-Kt)}function jt(zt){return(Math.exp(zt)-Math.exp(-zt))/2}function Rt(zt){return(Math.exp(zt)+Math.exp(-zt))/2}const Dr=Ht(0);let Ut=function(zt){return Rt(Dr)/Rt(Dr+Xe*zt)},pr=function(zt){return at*((Rt(Dr)*(jt(Kt=Dr+Xe*zt)/Rt(Kt))-jt(Dr))/It)/mt;var Kt},er=(Ht(1)-Dr)/Xe;if(Math.abs(mt)<1e-6||!isFinite(er)){if(Math.abs(at-_t)<1e-6)return this.easeTo(i,h);const zt=_t<at?-1:1;er=Math.abs(Math.log(_t/at))/Xe,pr=function(){return 0},Ut=function(Kt){return Math.exp(zt*Xe*Kt)}}i.duration="duration"in i?+i.duration:1e3*er/("screenSpeed"in i?+i.screenSpeed/Xe:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Tr=M!==Q,ir=J!==O,vr=!_.isPaddingEqual(fe),Or=zt=>Kt=>{const fn=Kt*er,Ln=1/Ut(fn);zt.zoom=1===Kt?B:E+zt.scaleZoom(Ln),Tr&&(zt.bearing=c.number(M,Q,Kt)),ir&&(zt.pitch=c.number(O,J,Kt)),vr&&(zt.interpolatePadding(N,fe,Kt),Be=zt.centerPoint.add(je));const gn=1===Kt?Le:zt.unproject(De.add(He.mult(pr(fn))).mult(Ln));return zt.setLocationAtPoint(zt.renderWorldCopies?gn.wrap():gn,Be),zt._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(h),zt};if(i.preloadOnly){const zt=this._emulate(Or,i.duration,_);return this._preloadTiles(zt),this}return this._zooming=!0,this._rotating=Tr,this._pitching=ir,this._padding=vr,this._prepareEase(h,!1),this._ease(Or(_),()=>this._afterEase(h),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,h)}if(!i){const _=this.handlers;_&&_.stop(!1)}return this}_ease(i,h,_){!1===_.animate||0===_.duration?(i(1),h()):(this._easeStart=c.exported.now(),this._easeOptions=_,this._onEaseFrame=i,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1),h=this._onEaseFrame;h&&h(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,h){i=c.wrap(i,-180,180);const _=Math.abs(i-h);return Math.abs(i-360-h)<_&&(i-=360),Math.abs(i+360-h)<_&&(i+=360),i}_normalizeCenter(i){const h=this.transform;if(!h.renderWorldCopies||h.maxBounds)return;const _=i.lng-h.center.lng;i.lng+=_>180?-360:_<-180?360:0}_emulate(i,h,_){const E=Math.ceil(15*h/1e3),M=[],O=i(_.clone());for(let N=0;N<=E;N++){const B=O(N/E);M.push(B.clone())}return M}}class ls{constructor(i={}){this.options=i,c.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const h=this.options&&this.options.compact;return this._map=i,this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Te("button","mapboxgl-ctrl-attrib-button",this._container),Te("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Te("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),h&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===h&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,h){const _=this._map._getUIString(`AttributionControl.${h}`);i.setAttribute("aria-label",_),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const h=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.config.ACCESS_TOKEN}];if(i){const _=h.reduce((E,M,O)=>(M.value&&(E+=`${M.key}=${M.value}${O<h.length-1?"&":""}`),E),"?");i.href=`${c.config.FEEDBACK_URL}/${_}#${Ia(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const E=this._map.style.stylesheet;this.styleOwner=E.owner,this.styleId=E.id}const h=this._map.style._sourceCaches;for(const E in h){const M=h[E];if(M.used){const O=M.getSource();O.attribution&&i.indexOf(O.attribution)<0&&i.push(O.attribution)}}i.sort((E,M)=>E.length-M.length),i=i.filter((E,M)=>{for(let O=M+1;O<i.length;O++)if(i[O].indexOf(E)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const _=i.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,i.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class na{constructor(){c.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=Te("div","mapboxgl-ctrl");const h=Te("a","mapboxgl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://www.mapbox.com/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const h in i){const _=i[h].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const h=i[0];this._map.getCanvasContainer().offsetWidth<250?h.classList.add("mapboxgl-compact"):h.classList.remove("mapboxgl-compact")}}}class wl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const h=++this._id;return this._queue.push({callback:i,id:h,cancelled:!1}),h}remove(i){const h=this._currentlyRunning,_=h?this._queue.concat(h):this._queue;for(const E of _)if(E.id===i)return void(E.cancelled=!0)}run(i=0){const h=this._currentlyRunning=this._queue;this._queue=[];for(const _ of h)if(!_.cancelled&&(_.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Nl(g,i,h){if(g=new c.LngLat(g.lng,g.lat),i){const _=new c.LngLat(g.lng-360,g.lat),E=new c.LngLat(g.lng+360,g.lat),M=360*Math.ceil(Math.abs(g.lng-h.center.lng)/360),O=h.locationPoint(g).distSqr(i),N=i.x<0||i.y<0||i.x>h.width||i.y>h.height;h.locationPoint(_).distSqr(i)<O&&(N||Math.abs(_.lng-h.center.lng)<M)?g=_:h.locationPoint(E).distSqr(i)<O&&(N||Math.abs(E.lng-h.center.lng)<M)&&(g=E)}for(;Math.abs(g.lng-h.center.lng)>180;){const _=h.locationPoint(g);if(_.x>=0&&_.y>=0&&_.x<=h.width&&_.y<=h.height)break;g.lng>h.center.lng?g.lng-=360:g.lng+=360}return g}const Su={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Bc extends c.Evented{constructor(i,h){if(super(),(i instanceof c.window.HTMLElement||h)&&(i=c.extend({element:i},h)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=c.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Te("div");const E=41,M=27,O=$e("svg",{display:"block",height:E*this._scale+"px",width:M*this._scale+"px",viewBox:`0 0 ${M} ${E}`},this._element),N=$e("radialGradient",{id:"shadowGradient"},$e("defs",{},O));$e("stop",{offset:"10%","stop-opacity":.4},N),$e("stop",{offset:"100%","stop-opacity":.05},N),$e("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},O),$e("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},O),$e("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},O),$e("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},O),this._offset=c.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",E=>{E.preventDefault()}),this._element.addEventListener("mousedown",E=>{E.preventDefault()});const _=this._element.classList;for(const E in Su)_.remove(`mapboxgl-marker-anchor-${E}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=c.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const E=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[E,-1*(24.6+E)],"bottom-right":[-E,-1*(24.6+E)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const h=i.code,_=i.charCode||i.keyCode;"Space"!==h&&"Enter"!==h&&32!==_&&13!==_||this.togglePopup()}_onMapClick(i){const h=i.originalEvent.target,_=this._element;this._popup&&(h===_||_.contains(h))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,h=this._pos;if(!i||!h)return!1;const _=i.unproject(h),E=i.getFreeCameraOptions();if(!E.position)return!1;const M=E.position.toLngLat();return M.distanceTo(_)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const h=this._pos;if(!h||h.x<0||h.x>i.transform.width||h.y<0||h.y>i.transform.height)return void this._clearFadeTimer();const _=i.unproject(h);let E;i._showingGlobe()&&c.isLngLatBehindGlobe(i.transform,this._lngLat)?E=0:(E=1-i._queryFogOpacity(_),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(E*=this._occludedOpacity)),this._element.style.opacity=`${E}`,this._element.style.pointerEvents=E>0?"auto":"none",this._popup&&this._popup._setOpacity(E),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const h=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${i.x}px,${i.y}px)\n            ${Su[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${h.x}px,${h.y}px)\n        `}_calculateXYTransform(){const i=this._pos,h=this._map,_=this.getPitchAlignment();if(!h||!i||"map"!==_)return"";if(!h._showingGlobe()){const B=h.getPitch();return B?`rotateX(${B}deg)`:""}const E=c.radToDeg(c.globeTiltAtLngLat(h.transform,this._lngLat)),M=i.sub(c.globeCenterToScreenPoint(h.transform)),O=Math.abs(M.x)+Math.abs(M.y);if(0===O)return"";const N=E/O;return`rotateX(${-M.y*N}deg) rotateY(${M.x*N}deg)`}_calculateZTransform(){const i=this._pos,h=this._map;if(!h||!i)return"";let _=0;const E=this.getRotationAlignment();if("map"===E)if(h._showingGlobe()){const M=h.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),O=h.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(M);_=c.radToDeg(Math.atan2(O.y,O.x))-90}else _=-h.getBearing();else if("horizon"===E){const M=c.smoothstep(4,6,h.getZoom()),O=c.globeCenterToScreenPoint(h.transform);O.y+=M*h.transform.height;const N=i.sub(O),B=c.radToDeg(Math.atan2(N.y,N.x));_=(B>90?B-270:B+90)*(1-M)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(i){c.window.cancelAnimationFrame(this._updateFrameId);const h=this._map;h&&(h.transform.renderWorldCopies&&(this._lngLat=Nl(this._lngLat,this._pos,h.transform)),this._pos=h.project(this._lngLat),!0===i?this._updateFrameId=c.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),h._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(h._showingGlobe()||h.getTerrain()||h.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=c.pointGeometry.convert(i),this._update(),this}_onMove(i){const h=this._map;if(!h)return;const _=this._pointerdownPos,E=this._positionDelta;if(_&&E){if(!this._isDragging){const M=this._clickTolerance||h._clickTolerance;if(i.point.dist(_)<M)return;this._isDragging=!0}this._pos=i.point.sub(E),this._lngLat=h.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(i){const h=this._map,_=this._pos;h&&_&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(_),this._pointerdownPos=i.point,this._state="pending",h.on("mousemove",this._onMove),h.on("touchmove",this._onMove),h.once("mouseup",this._onUp),h.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const h=this._map;return h&&(i?(h.on("mousedown",this._addDragHandler),h.on("touchstart",this._addDragHandler)):(h.off("mousedown",this._addDragHandler),h.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const hh={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},pc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function zh(g=new c.pointGeometry(0,0),i="bottom"){if("number"==typeof g){const h=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(i){case"top":return new c.pointGeometry(0,g);case"top-left":return new c.pointGeometry(h,h);case"top-right":return new c.pointGeometry(-h,h);case"bottom":return new c.pointGeometry(0,-g);case"bottom-left":return new c.pointGeometry(h,-h);case"bottom-right":return new c.pointGeometry(-h,-h);case"left":return new c.pointGeometry(g,0);case"right":return new c.pointGeometry(-g,0)}return new c.pointGeometry(0,0)}return g instanceof c.pointGeometry||Array.isArray(g)?c.pointGeometry.convert(g):c.pointGeometry.convert(g[i]||[0,0])}class Bh{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const h=c.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-h)+this._end*h}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,h,_){this._start=this.getValue(h),this._end=i,this._startTime=h,this._endTime=h+_}}const Uh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Uc={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Ip={showCompass:!0,showZoom:!0,visualizePitch:!1};class fc{constructor(i,h,_=!1){this._clickTolerance=10,this.element=h,this.mouseRotate=new Hl({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,_&&(this.mousePitch=new kl({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),h.addEventListener("mousedown",this.mousedown),h.addEventListener("touchstart",this.touchstart,{passive:!1}),h.addEventListener("touchmove",this.touchmove),h.addEventListener("touchend",this.touchend),h.addEventListener("touchcancel",this.reset)}down(i,h){this.mouseRotate.mousedown(i,h),this.mousePitch&&this.mousePitch.mousedown(i,h),We()}move(i,h){const _=this.map,E=this.mouseRotate.mousemoveWindow(i,h),M=E&&E.bearingDelta;if(M&&_.setBearing(_.getBearing()+M),this.mousePitch){const O=this.mousePitch.mousemoveWindow(i,h),N=O&&O.pitchDelta;N&&_.setPitch(_.getPitch()+N)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){H(),c.window.removeEventListener("mousemove",this.mousemove),c.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(c.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),X(this.element,i)),c.window.addEventListener("mousemove",this.mousemove),c.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,X(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=ee(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=ee(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Fu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Pp={maxWidth:100,unit:"metric"};function Bf(g,i,h){const _=Ap(i),E=_/i,M={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[h];this._map._requestDomTask(()=>{this._container.style.width=g*E+"px",this._container.innerHTML=`${_}&nbsp;${M}`})}function Ap(g){const i=Math.pow(10,`${Math.floor(g)}`.length-1);let h=g/i;return h=h>=10?10:h>=5?5:h>=3?3:h>=2?2:h>=1?1:function(_){const E=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*E)/E}(h),i*h}const dc={version:c.version,supported:ce,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends no{constructor(g){if(c.LivePerformanceUtils.mark(c.PerformanceMarkers.create),null!=(g=c.extend({},Uc,g)).minZoom&&null!=g.maxZoom&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=g.minPitch&&null!=g.maxPitch&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=g.minPitch&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=g.maxPitch&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&c.isSafariWithAntialiasingBug(c.window)&&(g.antialias=!1,c.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new xs(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies),g),this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._optimizeForTerrain=g.optimizeForTerrain,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new wl,this._domRenderTaskQueue=new wl,this._controls=[],this._markers=[],this._popups=[],this._mapId=c.uniqueId(),this._locale=c.extend({},Uh,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new c.RequestManager(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,"string"==typeof g.container){if(this._container=c.window.document.getElementById(g.container),!this._container)throw new Error(`Container '${g.container}' not found.`)}else{if(!(g.container instanceof c.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&c.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==c.window&&(c.window.addEventListener("online",this._onWindowOnline,!1),c.window.addEventListener("resize",this._onWindowResize,!1),c.window.addEventListener("orientationchange",this._onWindowResize,!1),c.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new sn(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this._hash=g.hash&&new Hr("string"==typeof g.hash&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,c.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),g.attributionControl&&this.addControl(new ls({customAttribution:g.customAttribution})),this._logoControl=new na,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new c.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new c.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(g,i){if(void 0===i&&(i=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=g.onAdd(this);this._controls.push(g);const _=this._controlPositions[i];return-1!==i.indexOf("bottom")?_.insertBefore(h,_.firstChild):_.appendChild(h),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(g);return i>-1&&this._controls.splice(i,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new c.Event("movestart",g)).fire(new c.Event("move",g)),this.fire(new c.Event("resize",g)),i&&this.fire(new c.Event("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(c.LngLatBounds.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return"auto"===g?c.window.navigator.language:Array.isArray(g)?0===g.length?void 0:g.map(i=>"auto"===i?c.window.navigator.language:i):g}setLanguage(g){const i=this._parseLanguage(g);if(!this.style||i===this._language)return this;this._language=i,this.style._reloadSources();for(const h of this._controls)h._setLanguage&&h._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(g){return this._lazyInitEmptyStyle(),g?"string"==typeof g&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const g=this.transform,i=g.projection.name;let h;"globe"===i&&g.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?(g.setMercatorFromTransition(),h=!0):"mercator"===i&&g.zoom<c.GLOBE_ZOOM_THRESHOLD_MAX&&(g.setProjection({name:"globe"}),h=!0),h&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(g,i){return this._updateProjection(g||i||{name:"mercator"})}_updateProjection(g){let i;if(i="globe"===g.name&&this.transform.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const h in this.style._sourceCaches)this.style._sourceCaches[h].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(g){return this.transform.locationPoint3D(c.LngLat.convert(g))}unproject(g){return this.transform.pointLocation3D(c.pointGeometry.convert(g))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,i,h){if("mouseenter"===g||"mouseover"===g){let _=!1;const E=O=>{const N=i.filter(Q=>this.getLayer(Q)),B=N.length?this.queryRenderedFeatures(O.point,{layers:N}):[];B.length?_||(_=!0,h.call(this,new tl(g,this,O.originalEvent,{features:B}))):_=!1},M=()=>{_=!1};return{layers:new Set(i),listener:h,delegates:{mousemove:E,mouseout:M}}}if("mouseleave"===g||"mouseout"===g){let _=!1;const E=O=>{const N=i.filter(B=>this.getLayer(B));(N.length?this.queryRenderedFeatures(O.point,{layers:N}):[]).length?_=!0:_&&(_=!1,h.call(this,new tl(g,this,O.originalEvent)))},M=O=>{_&&(_=!1,h.call(this,new tl(g,this,O.originalEvent)))};return{layers:new Set(i),listener:h,delegates:{mousemove:E,mouseout:M}}}{const _=E=>{const M=i.filter(N=>this.getLayer(N)),O=M.length?this.queryRenderedFeatures(E.point,{layers:M}):[];O.length&&(E.features=O,h.call(this,E),delete E.features)};return{layers:new Set(i),listener:h,delegates:{[g]:_}}}}on(g,i,h){if(void 0===h)return super.on(g,i);Array.isArray(i)||(i=[i]);const _=this._createDelegatedListener(g,i,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(_);for(const E in _.delegates)this.on(E,_.delegates[E]);return this}once(g,i,h){if(void 0===h)return super.once(g,i);Array.isArray(i)||(i=[i]);const _=this._createDelegatedListener(g,i,h);for(const E in _.delegates)this.once(E,_.delegates[E]);return this}off(g,i,h){if(void 0===h)return super.off(g,i);i=new Set(Array.isArray(i)?i:[i]);const _=(M,O)=>{if(M.size!==O.size)return!1;for(const N of M)if(!O.has(N))return!1;return!0},E=this._delegatedListeners?this._delegatedListeners[g]:void 0;return E&&(M=>{for(let O=0;O<M.length;O++){const N=M[O];if(N.listener===h&&_(N.layers,i)){for(const B in N.delegates)this.off(B,N.delegates[B]);return M.splice(O,1),this}}})(E),this}queryRenderedFeatures(g,i){return this.style?(void 0!==i||void 0===g||g instanceof c.pointGeometry||Array.isArray(g)||(i=g,g=void 0),this.style.queryRenderedFeatures(g=g||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(g,i){return this.style.querySourceFeatures(g,i)}setStyle(g,i){return!1!==(i=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&g?(this._diffStyle(g,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(g,i))}_getUIString(g){const i=this._locale[g];if(null==i)throw new Error(`Missing UI string '${g}'`);return i}_updateStyle(g,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g&&(this.style=new ps(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof g?this.style.loadURL(g):this.style.loadJSON(g)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ps(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(g,i){if("string"==typeof g){const h=this._requestManager.normalizeStyleURL(g),_=this._requestManager.transformRequest(h,c.ResourceType.Style);c.getJSON(_,(E,M)=>{E?this.fire(new c.ErrorEvent(E)):M&&this._updateDiff(M,i)})}else"object"==typeof g&&this._updateDiff(g,i)}_updateDiff(g,i){try{this.style.setState(g)&&this._update(!0)}catch(h){c.warnOnce(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(g,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.warnOnce("There is no style added to the map."),!1)}addSource(g,i){return this._lazyInitEmptyStyle(),this.style.addSource(g,i),this._update(!0)}isSourceLoaded(g){return!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){const g=this.style&&this.style._sourceCaches;for(const i in g){const h=g[i]._tiles;for(const _ in h){const E=h[_];if("loaded"!==E.state&&"errored"!==E.state)return!1}}return!0}addSourceType(g,i,h){this._lazyInitEmptyStyle(),this.style.addSourceType(g,i,h)}removeSource(g){return this.style.removeSource(g),this._updateTerrain(),this._update(!0)}getSource(g){return this.style.getSource(g)}addImage(g,i,{pixelRatio:h=1,sdf:_=!1,stretchX:E,stretchY:M,content:O}={}){if(this._lazyInitEmptyStyle(),i instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&i instanceof c.window.ImageBitmap){const{width:N,height:B,data:Q}=c.exported.getImageData(i);this.style.addImage(g,{data:new c.RGBAImage({width:N,height:B},Q),pixelRatio:h,stretchX:E,stretchY:M,content:O,sdf:_,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:N,height:B}=i,Q=i;this.style.addImage(g,{data:new c.RGBAImage({width:N,height:B},new Uint8Array(Q.data)),pixelRatio:h,stretchX:E,stretchY:M,content:O,sdf:_,version:0,userImage:Q}),Q.onAdd&&Q.onAdd(this,g)}}updateImage(g,i){const h=this.style.getImage(g);if(!h)return void this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=i instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&i instanceof c.window.ImageBitmap?c.exported.getImageData(i):i,{width:E,height:M}=_;void 0!==E&&void 0!==M?E===h.data.width&&M===h.data.height?(h.data.replace(_.data,!(i instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&i instanceof c.window.ImageBitmap)),this.style.updateImage(g,h)):this.fire(new c.ErrorEvent(new Error(`The width and height of the updated image (${E}, ${M})\n                must be that same as the previous version of the image\n                (${h.data.width}, ${h.data.height})`))):this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(g){return g?!!this.style.getImage(g):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(g)}loadImage(g,i){c.getImage(this._requestManager.transformRequest(g,c.ResourceType.Image),(h,_)=>{i(h,_ instanceof c.window.HTMLImageElement?c.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(g,i){return this._lazyInitEmptyStyle(),this.style.addLayer(g,i),this._update(!0)}moveLayer(g,i){return this.style.moveLayer(g,i),this._update(!0)}removeLayer(g){return this.style.removeLayer(g),this._update(!0)}getLayer(g){return this.style.getLayer(g)}setLayerZoomRange(g,i,h){return this.style.setLayerZoomRange(g,i,h),this._update(!0)}setFilter(g,i,h={}){return this.style.setFilter(g,i,h),this._update(!0)}getFilter(g){return this.style.getFilter(g)}setPaintProperty(g,i,h,_={}){return this.style.setPaintProperty(g,i,h,_),this._update(!0)}getPaintProperty(g,i){return this.style.getPaintProperty(g,i)}setLayoutProperty(g,i,h,_={}){return this.style.setLayoutProperty(g,i,h,_),this._update(!0)}getLayoutProperty(g,i){return this.style.getLayoutProperty(g,i)}setLight(g,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(g,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.LngLat.convert(g),this.transform):0}setFeatureState(g,i){return this.style.setFeatureState(g,i),this._update()}removeFeatureState(g,i){return this.style.removeFeatureState(g,i),this._update()}getFeatureState(g){return this.style.getFeatureState(g)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let h,_,E,M=this._container;for(;M&&(!_||!E);){const O=c.window.getComputedStyle(M).transform;O&&"none"!==O&&(h=O.match(/matrix.*\((.+)\)/)[1].split(", "),h[0]&&"0"!==h[0]&&"1"!==h[0]&&(_=h[0]),h[3]&&"0"!==h[3]&&"1"!==h[3]&&(E=h[3])),M=M.parentElement}this._containerWidth=_?Math.abs(g/_):g,this._containerHeight=E?Math.abs(i/E):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==c.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&c.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Te("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=Te("div","mapboxgl-canvas-container",g);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=Te("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const h=this._controlContainer=Te("div","mapboxgl-control-container",g),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(E=>{_[E]=Te("div",`mapboxgl-ctrl-${E}`,h)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,i){const h=c.exported.devicePixelRatio||1;this._canvas.width=h*Math.ceil(g),this._canvas.height=h*Math.ceil(i),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${i}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const i=this._markers.indexOf(g);-1!==i&&this._markers.splice(i,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const i=this._popups.indexOf(g);-1!==i&&this._popups.splice(i,1)}_setupPainter(){const g=c.extend({},ce.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);i?(c.storeAuthState(i,!0),this.painter=new uc(i,this.transform),this.on("data",h=>{"source"===h.dataType&&this.painter.setTileLoadedFlag(!0)}),c.exported$1.testSupport(i)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let i;const h=this.painter.context.extTimerQuery,_=c.exported.now();if(this.listens("gpu-timing-frame")&&(i=h.createQueryEXT(),h.beginQueryEXT(h.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],c.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],c.window.performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const E=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const N=this.transform.zoom,B=this.transform.pitch,Q=c.exported.now(),J=new c.EvaluationParameters(N,{now:Q,fadeDuration:E,pitch:B,transition:this.style.getTransition()});this.style.update(J)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):M=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,E,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:E,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new c.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const N=c.exported.now()-_;h.endQueryEXT(h.TIME_ELAPSED_EXT,i),setTimeout(()=>{const B=h.getQueryObjectEXT(i,h.QUERY_RESULT_EXT)/1e6;h.deleteQueryEXT(i),this.fire(new c.Event("gpu-timing-frame",{cpuTime:N,gpuTime:B})),c.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:B}})},50)}if(this.listens("gpu-timing-layer")){const N=this.painter.collectGpuTimers();setTimeout(()=>{const B=this.painter.queryGpuTimers(N);this.fire(new c.Event("gpu-timing-layer",{layerTimes:B}))},50)}if(this.listens("gpu-timing-deferred-render")){const N=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const B=this.painter.queryGpuTimeDeferredRender(N);this.fire(new c.Event("gpu-timing-deferred-render",{gpuTime:B}))},50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(O||this._repaint)this.triggerRepaint();else{const N=!this.isMoving()&&this.loaded();if(N&&(M=this._updateAverageElevation(_,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),N&&(this.fire(new c.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const B=this._calculateSpeedIndex();this.fire(new c.Event("speedindexcompleted",{speedIndex:B})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,c.LivePerformanceUtils.mark(c.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&c.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const i of this._markers)g&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!g||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(g,i=!1){const h=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&h(0);if((i||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const _=this.transform.averageElevation;let E=this.transform.sampleAverageElevation(),M=!1;this.transform.elevation&&(M=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(E)?E=0:this._averageElevationLastSampledAt=g;const O=Math.abs(_-E);if(O>1){if(this._isInitialLoad||M)return this._averageElevation.jumpTo(E),h(E);this._averageElevation.easeTo(E,g,300)}else if(O>1e-4)return this._averageElevation.jumpTo(E),h(E)}return!!this._averageElevation.isEasing(g)&&h(this._averageElevation.getValue(g))}_authenticate(){c.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,g=>{if(g&&(g.message===c.AUTH_ERR_MSG||401===g.status)){const i=this.painter.context.gl;c.storeAuthState(i,!1),this._logoControl instanceof na&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),c.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const h=this.painter.context.gl,_=h.createFramebuffer();function E(M){h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,M,0);const O=new Uint8Array(h.drawingBufferWidth*h.drawingBufferHeight*4);return h.readPixels(0,0,h.drawingBufferWidth,h.drawingBufferHeight,h.RGBA,h.UNSIGNED_BYTE,O),O}return h.bindFramebuffer(h.FRAMEBUFFER,_),this._canvasPixelComparison(E(g),i.canvasCopies.map(E),i.timeStamps)}_canvasPixelComparison(g,i,h){let _=h[1]-h[0];const E=g.length/4;for(let M=0;M<i.length;M++){const O=i[M];let N=0;for(let B=0;B<O.length;B+=4)O[B]===g[B]&&O[B+1]===g[B+1]&&O[B+2]===g[B+2]&&O[B+3]===g[B+3]&&(N+=1);_+=(h[M+2]-h[M+1])*(1-N/E)}return _}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==c.window&&(c.window.removeEventListener("resize",this._onWindowResize,!1),c.window.removeEventListener("orientationchange",this._onWindowResize,!1),c.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.removeEventListener("online",this._onWindowOnline,!1),c.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),c.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=c.exported.frame(i=>{const h=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,h&&this._render(i)}))}_preloadTiles(g){const i=this.style?Object.values(this.style._sourceCaches):[];return c.asyncAll(i,(h,_)=>h._preloadTiles(g,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){"hidden"===c.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,g&&this._update())}_setCacheLimits(g,i){c.setCacheLimits(g,i)}get version(){return c.version}},NavigationControl:class{constructor(g){this.options=c.extend({},Ip,g),this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),Te("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),Te("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const h=this._map;h&&(this.options.visualizePitch?h.resetNorthPitch({},{originalEvent:i}):h.resetNorth({},{originalEvent:i}))}),this._compassIcon=Te("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const i=g.getZoom(),h=i===g.getMaxZoom(),_=i===g.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new fc(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,i){const h=Te("button",g,this._container);return h.type="button",h.addEventListener("click",i),h}_setButtonTitle(g,i){if(!this._map)return;const h=this._map._getUIString(`NavigationControl.${i}`);g.setAttribute("aria-label",h),g.firstElementChild&&g.firstElementChild.setAttribute("title",h)}},GeolocateControl:class extends c.Evented{constructor(g){super(),this.options=c.extend({geolocation:c.window.navigator.geolocation},Fu,g),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=bl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const i=(h=!!this.options.geolocation)=>{this._supportsGeolocation=h,g(h)};void 0!==this._supportsGeolocation?g(this._supportsGeolocation):void 0!==c.window.navigator.permissions?c.window.navigator.permissions.query({name:"geolocation"}).then(h=>i("denied"!==h.state)).catch(()=>i()):i()}_isOutOfMapMaxBounds(g){const i=this._map.getMaxBounds(),h=g.coords;return!!i&&(h.longitude<i.getWest()||h.longitude>i.getEast()||h.latitude<i.getSouth()||h.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(g),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(g),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",g)),this._finish()}}_updateCamera(g){const i=new c.LngLat(g.coords.longitude,g.coords.latitude),h=g.coords.accuracy,_=this._map.getBearing(),E=c.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(h),E,{geolocateSource:!0})}_updateMarker(g){if(g){const i=new c.LngLat(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,i=c.mercatorZfromAltitude(1,g._center.lat)*g.worldSize,h=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${h}px`,this._circleElement.style.height=`${h}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(1===g.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===g.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Te("button","mapboxgl-ctrl-geolocate",this._container),Te("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===g){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Te("div","mapboxgl-user-location"),this._dotElement.appendChild(Te("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Te("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Bc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Te("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Bc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:!0===g.absolute&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{c.window.addEventListener("ondeviceorientationabsolute"in c.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==c.window.DeviceMotionEvent&&"function"==typeof c.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&g()}).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),c.window.removeEventListener("deviceorientation",this._onDeviceOrientation),c.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ls,ScaleControl:class{constructor(g){this.options=c.extend({},Pp,g),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Bf.bind(this)),c.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,i=this._map,h=i._containerHeight/2,_=i._containerWidth/2-g/2,E=i.unproject([_,h]),M=i.unproject([_+g,h]),O=E.distanceTo(M);if("imperial"===this.options.unit){const N=3.2808*O;N>5280?this._setScale(g,N/5280,"mile"):this._setScale(g,N,"foot")}else"nautical"===this.options.unit?this._setScale(g,O/1852,"nautical-mile"):O>=1e3?this._setScale(g,O/1e3,"kilometer"):this._setScale(g,O,"meter")}_setScale(g,i,h){const _=Ap(i),E=_/i;this._map._requestDomTask(()=>{this._container.style.width=g*E+"px",this._container.innerHTML="nautical-mile"!==h?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:h}).format(_):`${_}&nbsp;nm`})}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=Te("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g){this._fullscreen=!1,g&&g.container&&(g.container instanceof c.window.HTMLElement?this._container=g.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in c.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in c.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=Te("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,c.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!c.window.document.fullscreenEnabled&&!c.window.document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=Te("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Te("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),c.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(c.window.document.fullscreenElement||c.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?c.window.document.exitFullscreen?c.window.document.exitFullscreen():c.window.document.webkitCancelFullScreen&&c.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends c.Evented{constructor(g){super(),this.options=c.extend(Object.create(hh),g),c.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=c.LngLat.convert(g),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(c.window.document.createTextNode(g))}setHTML(g){const i=c.window.document.createDocumentFragment(),h=c.window.document.createElement("body");let _;for(h.innerHTML=g;_=h.firstChild,_;)i.appendChild(_);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=Te("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(g),this.options.closeButton){const h=this._closeButton=Te("button","mapboxgl-popup-close-button",i);h.type="button",h.setAttribute("aria-label","Close popup"),h.setAttribute("aria-hidden","true"),h.innerHTML="&#215;",h.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let i;return this._classList.delete(g)?i=!1:(this._classList.add(g),i=!0),this._updateClassList(),i}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const i=this._map,h=this._container,_=this._pos;if(!i||!h||!_)return"bottom";const E=h.offsetWidth,M=h.offsetHeight,O=_.x<E/2,N=_.x>i.transform.width-E/2;if(_.y+g<M)return O?"top-left":N?"top-right":"top";if(_.y>i.transform.height-M){if(O)return"bottom-left";if(N)return"bottom-right"}return O?"left":N?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),g.className=i.join(" ")}_update(g){const i=this._map,h=this._content;if(!i||!this._lngLat&&!this._trackPointer||!h)return;let _=this._container;if(_||(_=this._container=Te("div","mapboxgl-popup",i.getContainer()),this._tip=Te("div","mapboxgl-popup-tip",_),_.appendChild(h)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Nl(this._lngLat,this._pos,i.transform)),!this._trackPointer||g){const E=this._pos=this._trackPointer&&g?g:i.project(this._lngLat),M=zh(this.options.offset),O=this._anchor=this._getAnchor(M.y),N=zh(this.options.offset,O),B=E.add(N).round();i._requestDomTask(()=>{this._container&&O&&(this._container.style.transform=`${Su[O]} translate(${B.x}px,${B.y}px)`)})}if(!this._marker&&i._showingGlobe()){const E=c.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(E)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(pc);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:Bc,Style:ps,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.pointGeometry,MercatorCoordinate:c.MercatorCoordinate,FreeCameraOptions:hu,Evented:c.Evented,config:c.config,prewarm:function(){Tn().acquire(Yr)},clearPrewarmedResources:function(){const g=en;g&&(g.isPreloaded()&&1===g.numActive()?(g.release(Yr),en=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return c.config.ACCESS_TOKEN},set accessToken(g){c.config.ACCESS_TOKEN=g},get baseApiUrl(){return c.config.API_URL},set baseApiUrl(g){c.config.API_URL=g},get workerCount(){return hn.workerCount},set workerCount(g){hn.workerCount=g},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){c.config.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){c.clearTileCache(g)},workerUrl:"",workerClass:null,setNow:c.exported.setNow,restoreNow:c.exported.restoreNow};return dc}),ae}()},3990:function(Mt,Ye,ue){var ae,pe;ae=function(){var b,c,xe,ge,We,ce={},be={},ye={currentLocale:"en",zeroFormat:null,nullFormat:null,defaultFormat:"0,0",scalePercentBy100:!0},Te={currentLocale:ye.currentLocale,zeroFormat:ye.zeroFormat,nullFormat:ye.nullFormat,defaultFormat:ye.defaultFormat,scalePercentBy100:ye.scalePercentBy100};function $e(xe,ge){this._input=xe,this._value=ge}return(b=function(xe){var ge,Oe,We,H;if(b.isNumeral(xe))ge=xe.value();else if(0===xe||typeof xe>"u")ge=0;else if(null===xe||c.isNaN(xe))ge=null;else if("string"==typeof xe)if(Te.zeroFormat&&xe===Te.zeroFormat)ge=0;else if(Te.nullFormat&&xe===Te.nullFormat||!xe.replace(/[^0-9]+/g,"").length)ge=null;else{for(Oe in ce)if((H="function"==typeof ce[Oe].regexps.unformat?ce[Oe].regexps.unformat():ce[Oe].regexps.unformat)&&xe.match(H)){We=ce[Oe].unformat;break}ge=(We=We||b._.stringToNumber)(xe)}else ge=Number(xe)||null;return new $e(xe,ge)}).version="2.0.6",b.isNumeral=function(xe){return xe instanceof $e},b._=c={numberToFormat:function(xe,ge,Oe){var nt,ze,Nt,ke,xt,Ae,pt,K,We=be[b.options.currentLocale],H=!1,q=!1,X="",ee=1e12,ie=1e9,ne=1e6,he="",re=!1;if(xe=xe||0,ze=Math.abs(xe),b._.includes(ge,"(")?(H=!0,ge=ge.replace(/[\(|\)]/g,"")):(b._.includes(ge,"+")||b._.includes(ge,"-"))&&(xt=b._.includes(ge,"+")?ge.indexOf("+"):xe<0?ge.indexOf("-"):-1,ge=ge.replace(/[\+|\-]/g,"")),b._.includes(ge,"a")&&(nt=!!(nt=ge.match(/a(k|m|b|t)?/))&&nt[1],b._.includes(ge," a")&&(X=" "),ge=ge.replace(new RegExp(X+"a[kmbt]?"),""),ze>=ee&&!nt||"t"===nt?(X+=We.abbreviations.trillion,xe/=ee):ze<ee&&ze>=ie&&!nt||"b"===nt?(X+=We.abbreviations.billion,xe/=ie):ze<ie&&ze>=ne&&!nt||"m"===nt?(X+=We.abbreviations.million,xe/=ne):(ze<ne&&ze>=1e3&&!nt||"k"===nt)&&(X+=We.abbreviations.thousand,xe/=1e3)),b._.includes(ge,"[.]")&&(q=!0,ge=ge.replace("[.]",".")),Nt=xe.toString().split(".")[0],ke=ge.split(".")[1],Ae=ge.indexOf(","),K=(ge.split(".")[0].split(",")[0].match(/0/g)||[]).length,ke?(b._.includes(ke,"[")?(ke=(ke=ke.replace("]","")).split("["),he=b._.toFixed(xe,ke[0].length+ke[1].length,Oe,ke[1].length)):he=b._.toFixed(xe,ke.length,Oe),Nt=he.split(".")[0],he=b._.includes(he,".")?We.delimiters.decimal+he.split(".")[1]:"",q&&0===Number(he.slice(1))&&(he="")):Nt=b._.toFixed(xe,0,Oe),X&&!nt&&Number(Nt)>=1e3&&X!==We.abbreviations.trillion)switch(Nt=String(Number(Nt)/1e3),X){case We.abbreviations.thousand:X=We.abbreviations.million;break;case We.abbreviations.million:X=We.abbreviations.billion;break;case We.abbreviations.billion:X=We.abbreviations.trillion}if(b._.includes(Nt,"-")&&(Nt=Nt.slice(1),re=!0),Nt.length<K)for(var bt=K-Nt.length;bt>0;bt--)Nt="0"+Nt;return Ae>-1&&(Nt=Nt.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+We.delimiters.thousands)),0===ge.indexOf(".")&&(Nt=""),pt=Nt+he+(X||""),H?pt=(H&&re?"(":"")+pt+(H&&re?")":""):xt>=0?pt=0===xt?(re?"-":"+")+pt:pt+(re?"-":"+"):re&&(pt="-"+pt),pt},stringToNumber:function(xe){var H,q,X,ge=be[Te.currentLocale],Oe=xe,We={thousand:3,million:6,billion:9,trillion:12};if(Te.zeroFormat&&xe===Te.zeroFormat)q=0;else if(Te.nullFormat&&xe===Te.nullFormat||!xe.replace(/[^0-9]+/g,"").length)q=null;else{for(H in q=1,"."!==ge.delimiters.decimal&&(xe=xe.replace(/\./g,"").replace(ge.delimiters.decimal,".")),We)if(X=new RegExp("[^a-zA-Z]"+ge.abbreviations[H]+"(?:\\)|(\\"+ge.currency.symbol+")?(?:\\))?)?$"),Oe.match(X)){q*=Math.pow(10,We[H]);break}q*=(xe.split("-").length+Math.min(xe.split("(").length-1,xe.split(")").length-1))%2?1:-1,xe=xe.replace(/[^0-9\.]+/g,""),q*=Number(xe)}return q},isNaN:function(xe){return"number"==typeof xe&&isNaN(xe)},includes:function(xe,ge){return-1!==xe.indexOf(ge)},insert:function(xe,ge,Oe){return xe.slice(0,Oe)+ge+xe.slice(Oe)},reduce:function(xe,ge){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof ge)throw new TypeError(ge+" is not a function");var q,Oe=Object(xe),We=Oe.length>>>0,H=0;if(3===arguments.length)q=arguments[2];else{for(;H<We&&!(H in Oe);)H++;if(H>=We)throw new TypeError("Reduce of empty array with no initial value");q=Oe[H++]}for(;H<We;H++)H in Oe&&(q=ge(q,Oe[H],H,Oe));return q},multiplier:function(xe){var ge=xe.toString().split(".");return ge.length<2?1:Math.pow(10,ge[1].length)},correctionFactor:function(){return Array.prototype.slice.call(arguments).reduce(function(ge,Oe){var We=c.multiplier(Oe);return ge>We?ge:We},1)},toFixed:function(xe,ge,Oe,We){var K,X,ee,ie,H=xe.toString().split("."),q=ge-(We||0);return K=2===H.length?Math.min(Math.max(H[1].length,q),ge):q,ee=Math.pow(10,K),ie=(Oe(xe+"e+"+K)/ee).toFixed(K),We>ge-K&&(X=new RegExp("\\.?0{1,"+(We-(ge-K))+"}$"),ie=ie.replace(X,"")),ie}},b.options=Te,b.formats=ce,b.locales=be,b.locale=function(xe){return xe&&(Te.currentLocale=xe.toLowerCase()),Te.currentLocale},b.localeData=function(xe){if(!xe)return be[Te.currentLocale];if(xe=xe.toLowerCase(),!be[xe])throw new Error("Unknown locale : "+xe);return be[xe]},b.reset=function(){for(var xe in ye)Te[xe]=ye[xe]},b.zeroFormat=function(xe){Te.zeroFormat="string"==typeof xe?xe:null},b.nullFormat=function(xe){Te.nullFormat="string"==typeof xe?xe:null},b.defaultFormat=function(xe){Te.defaultFormat="string"==typeof xe?xe:"0.0"},b.register=function(xe,ge,Oe){if(ge=ge.toLowerCase(),this[xe+"s"][ge])throw new TypeError(ge+" "+xe+" already registered.");return this[xe+"s"][ge]=Oe,Oe},b.validate=function(xe,ge){var Oe,We,H,q,K,X,ee,ie;if("string"!=typeof xe&&(xe+="",console.warn&&console.warn("Numeral.js: Value is not string. It has been co-erced to: ",xe)),(xe=xe.trim()).match(/^\d+$/))return!0;if(""===xe)return!1;try{ee=b.localeData(ge)}catch{ee=b.localeData(b.locale())}return H=ee.currency.symbol,K=ee.abbreviations,Oe=ee.delimiters.decimal,We="."===ee.delimiters.thousands?"\\.":ee.delimiters.thousands,!(null!==(ie=xe.match(/^[^\d]+/))&&(xe=xe.substr(1),ie[0]!==H)||null!==(ie=xe.match(/[^\d]+$/))&&(xe=xe.slice(0,-1),ie[0]!==K.thousand&&ie[0]!==K.million&&ie[0]!==K.billion&&ie[0]!==K.trillion)||(X=new RegExp(We+"{2}"),xe.match(/[^\d.,]/g)||(q=xe.split(Oe)).length>2||(q.length<2?!q[0].match(/^\d+.*\d$/)||q[0].match(X):1===q[0].length?!q[0].match(/^\d+$/)||q[0].match(X)||!q[1].match(/^\d+$/):!q[0].match(/^\d+.*\d$/)||q[0].match(X)||!q[1].match(/^\d+$/))))},b.fn=$e.prototype={clone:function(){return b(this)},format:function(xe,ge){var H,q,K,Oe=this._value,We=xe||Te.defaultFormat;if(ge=ge||Math.round,0===Oe&&null!==Te.zeroFormat)q=Te.zeroFormat;else if(null===Oe&&null!==Te.nullFormat)q=Te.nullFormat;else{for(H in ce)if(We.match(ce[H].regexps.format)){K=ce[H].format;break}q=(K=K||b._.numberToFormat)(Oe,We,ge)}return q},value:function(){return this._value},input:function(){return this._input},set:function(xe){return this._value=Number(xe),this},add:function(xe){var ge=c.correctionFactor.call(null,this._value,xe);return this._value=c.reduce([this._value,xe],function Oe(We,H,q,K){return We+Math.round(ge*H)},0)/ge,this},subtract:function(xe){var ge=c.correctionFactor.call(null,this._value,xe);return this._value=c.reduce([xe],function Oe(We,H,q,K){return We-Math.round(ge*H)},Math.round(this._value*ge))/ge,this},multiply:function(xe){return this._value=c.reduce([this._value,xe],function ge(Oe,We,H,q){var K=c.correctionFactor(Oe,We);return Math.round(Oe*K)*Math.round(We*K)/Math.round(K*K)},1),this},divide:function(xe){return this._value=c.reduce([this._value,xe],function ge(Oe,We,H,q){var K=c.correctionFactor(Oe,We);return Math.round(Oe*K)/Math.round(We*K)}),this},difference:function(xe){return Math.abs(b(this._value).subtract(xe).value())}},b.register("locale","en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(xe){var ge=xe%10;return 1==~~(xe%100/10)?"th":1===ge?"st":2===ge?"nd":3===ge?"rd":"th"},currency:{symbol:"$"}}),b.register("format","bps",{regexps:{format:/(BPS)/,unformat:/(BPS)/},format:function(xe,ge,Oe){var H,We=b._.includes(ge," BPS")?" ":"";return xe*=1e4,ge=ge.replace(/\s?BPS/,""),H=b._.numberToFormat(xe,ge,Oe),b._.includes(H,")")?((H=H.split("")).splice(-1,0,We+"BPS"),H=H.join("")):H=H+We+"BPS",H},unformat:function(xe){return+(1e-4*b._.stringToNumber(xe)).toFixed(15)}}),We="("+(We=(xe={base:1e3,suffixes:["B","KB","MB","GB","TB","PB","EB","ZB","YB"]}).suffixes.concat((ge={base:1024,suffixes:["B","KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"]}).suffixes.filter(function(H){return xe.suffixes.indexOf(H)<0})).join("|")).replace("B","B(?!PS)")+")",b.register("format","bytes",{regexps:{format:/([0\s]i?b)/,unformat:new RegExp(We)},format:function(H,q,K){var ne,se,he,ee=b._.includes(q,"ib")?ge:xe,ie=b._.includes(q," b")||b._.includes(q," ib")?" ":"";for(q=q.replace(/\s?i?b/,""),ne=0;ne<=ee.suffixes.length;ne++)if(se=Math.pow(ee.base,ne),he=Math.pow(ee.base,ne+1),null===H||0===H||H>=se&&H<he){ie+=ee.suffixes[ne],se>0&&(H/=se);break}return b._.numberToFormat(H,q,K)+ie},unformat:function(H){var K,X,q=b._.stringToNumber(H);if(q){for(K=xe.suffixes.length-1;K>=0;K--){if(b._.includes(H,xe.suffixes[K])){X=Math.pow(xe.base,K);break}if(b._.includes(H,ge.suffixes[K])){X=Math.pow(ge.base,K);break}}q*=X||1}return q}}),b.register("format","currency",{regexps:{format:/(\$)/},format:function(xe,ge,Oe){var q,K,X,We=b.locales[b.options.currentLocale],H={before:ge.match(/^([\+|\-|\(|\s|\$]*)/)[0],after:ge.match(/([\+|\-|\)|\s|\$]*)$/)[0]};for(ge=ge.replace(/\s?\$\s?/,""),q=b._.numberToFormat(xe,ge,Oe),xe>=0?(H.before=H.before.replace(/[\-\(]/,""),H.after=H.after.replace(/[\-\)]/,"")):xe<0&&!b._.includes(H.before,"-")&&!b._.includes(H.before,"(")&&(H.before="-"+H.before),X=0;X<H.before.length;X++)switch(K=H.before[X],K){case"$":q=b._.insert(q,We.currency.symbol,X);break;case" ":q=b._.insert(q," ",X+We.currency.symbol.length-1)}for(X=H.after.length-1;X>=0;X--)switch(K=H.after[X],K){case"$":q=X===H.after.length-1?q+We.currency.symbol:b._.insert(q,We.currency.symbol,-(H.after.length-(1+X)));break;case" ":q=X===H.after.length-1?q+" ":b._.insert(q," ",-(H.after.length-(1+X)+We.currency.symbol.length-1))}return q}}),b.register("format","exponential",{regexps:{format:/(e\+|e-)/,unformat:/(e\+|e-)/},format:function(xe,ge,Oe){var q=("number"!=typeof xe||b._.isNaN(xe)?"0e+0":xe.toExponential()).split("e");return ge=ge.replace(/e[\+|\-]{1}0/,""),b._.numberToFormat(Number(q[0]),ge,Oe)+"e"+q[1]},unformat:function(xe){var ge=b._.includes(xe,"e+")?xe.split("e+"):xe.split("e-"),Oe=Number(ge[0]),We=Number(ge[1]);return We=b._.includes(xe,"e-")?We*=-1:We,b._.reduce([Oe,Math.pow(10,We)],function H(q,K,X,ee){var ie=b._.correctionFactor(q,K);return q*ie*(K*ie)/(ie*ie)},1)}}),b.register("format","ordinal",{regexps:{format:/(o)/},format:function(xe,ge,Oe){var We=b.locales[b.options.currentLocale],q=b._.includes(ge," o")?" ":"";return ge=ge.replace(/\s?o/,""),q+=We.ordinal(xe),b._.numberToFormat(xe,ge,Oe)+q}}),b.register("format","percentage",{regexps:{format:/(%)/,unformat:/(%)/},format:function(xe,ge,Oe){var H,We=b._.includes(ge," %")?" ":"";return b.options.scalePercentBy100&&(xe*=100),ge=ge.replace(/\s?\%/,""),H=b._.numberToFormat(xe,ge,Oe),b._.includes(H,")")?((H=H.split("")).splice(-1,0,We+"%"),H=H.join("")):H=H+We+"%",H},unformat:function(xe){var ge=b._.stringToNumber(xe);return b.options.scalePercentBy100?.01*ge:ge}}),b.register("format","time",{regexps:{format:/(:)/,unformat:/(:)/},format:function(xe,ge,Oe){var We=Math.floor(xe/60/60),H=Math.floor((xe-60*We*60)/60),q=Math.round(xe-60*We*60-60*H);return We+":"+(H<10?"0"+H:H)+":"+(q<10?"0"+q:q)},unformat:function(xe){var ge=xe.split(":"),Oe=0;return 3===ge.length?(Oe+=60*Number(ge[0])*60,Oe+=60*Number(ge[1]),Oe+=Number(ge[2])):2===ge.length&&(Oe+=60*Number(ge[0]),Oe+=Number(ge[1])),Number(Oe)}}),b},void 0!==(pe=ae.call(Ye,ue,Ye,Mt))&&(Mt.exports=pe)},5943:Mt=>{"use strict";var Ye=Object.getOwnPropertySymbols,ue=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;function pe(c){if(null==c)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(c)}Mt.exports=function b(){try{if(!Object.assign)return!1;var c=new String("abc");if(c[5]="de","5"===Object.getOwnPropertyNames(c)[0])return!1;for(var Z={},ce=0;ce<10;ce++)Z["_"+String.fromCharCode(ce)]=ce;if("0123456789"!==Object.getOwnPropertyNames(Z).map(function(Te){return Z[Te]}).join(""))return!1;var ye={};return"abcdefghijklmnopqrst".split("").forEach(function(Te){ye[Te]=Te}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},ye)).join("")}catch{return!1}}()?Object.assign:function(c,Z){for(var ce,ye,be=pe(c),Te=1;Te<arguments.length;Te++){for(var $e in ce=Object(arguments[Te]))ue.call(ce,$e)&&(be[$e]=ce[$e]);if(Ye){ye=Ye(ce);for(var xe=0;xe<ye.length;xe++)ae.call(ce,ye[xe])&&(be[ye[xe]]=ce[ye[xe]])}}return be}},1175:Mt=>{"use strict";var Ye=function(ue){return ue!=ue};Mt.exports=function(ae,pe){return 0===ae&&0===pe?1/ae==1/pe:!!(ae===pe||Ye(ae)&&Ye(pe))}},2e3:(Mt,Ye,ue)=>{"use strict";var ae=ue(2358),pe=ue(5685),b=ue(1175),c=ue(6305),Z=ue(3859),ce=pe(c(),Object);ae(ce,{getPolyfill:c,implementation:b,shim:Z}),Mt.exports=ce},6305:(Mt,Ye,ue)=>{"use strict";var ae=ue(1175);Mt.exports=function(){return"function"==typeof Object.is?Object.is:ae}},3859:(Mt,Ye,ue)=>{"use strict";var ae=ue(6305),pe=ue(2358);Mt.exports=function(){var c=ae();return pe(Object,{is:c},{is:function(){return Object.is!==c}}),c}},2450:(Mt,Ye,ue)=>{"use strict";var ae;if(!Object.keys){var pe=Object.prototype.hasOwnProperty,b=Object.prototype.toString,c=ue(9978),Z=Object.prototype.propertyIsEnumerable,ce=!Z.call({toString:null},"toString"),be=Z.call(function(){},"prototype"),ye=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Te=function(Oe){var We=Oe.constructor;return We&&We.prototype===Oe},$e={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},xe=function(){if(typeof window>"u")return!1;for(var Oe in window)try{if(!$e["$"+Oe]&&pe.call(window,Oe)&&null!==window[Oe]&&"object"==typeof window[Oe])try{Te(window[Oe])}catch{return!0}}catch{return!0}return!1}();ae=function(We){var H=null!==We&&"object"==typeof We,q="[object Function]"===b.call(We),K=c(We),X=H&&"[object String]"===b.call(We),ee=[];if(!H&&!q&&!K)throw new TypeError("Object.keys called on a non-object");var ie=be&&q;if(X&&We.length>0&&!pe.call(We,0))for(var ne=0;ne<We.length;++ne)ee.push(String(ne));if(K&&We.length>0)for(var se=0;se<We.length;++se)ee.push(String(se));else for(var he in We)(!ie||"prototype"!==he)&&pe.call(We,he)&&ee.push(String(he));if(ce)for(var re=function(Oe){if(typeof window>"u"||!xe)return Te(Oe);try{return Te(Oe)}catch{return!1}}(We),nt=0;nt<ye.length;++nt)(!re||"constructor"!==ye[nt])&&pe.call(We,ye[nt])&&ee.push(ye[nt]);return ee}}Mt.exports=ae},1356:(Mt,Ye,ue)=>{"use strict";var ae=Array.prototype.slice,pe=ue(9978),b=Object.keys,c=b?function(be){return b(be)}:ue(2450),Z=Object.keys;c.shim=function(){if(Object.keys){var be=function(){var ye=Object.keys(arguments);return ye&&ye.length===arguments.length}(1,2);be||(Object.keys=function(Te){return pe(Te)?Z(ae.call(Te)):Z(Te)})}else Object.keys=c;return Object.keys||c},Mt.exports=c},9978:Mt=>{"use strict";var Ye=Object.prototype.toString;Mt.exports=function(ae){var pe=Ye.call(ae),b="[object Arguments]"===pe;return b||(b="[object Array]"!==pe&&null!==ae&&"object"==typeof ae&&"number"==typeof ae.length&&ae.length>=0&&"[object Function]"===Ye.call(ae.callee)),b}},1766:Mt=>{Mt.exports=function(ue,ae,pe,b){var c=ue[0],Z=ue[1],ce=!1;void 0===pe&&(pe=0),void 0===b&&(b=ae.length);for(var be=(b-pe)/2,ye=0,Te=be-1;ye<be;Te=ye++){var $e=ae[pe+2*ye+0],xe=ae[pe+2*ye+1],Oe=ae[pe+2*Te+1];xe>Z!=Oe>Z&&c<(ae[pe+2*Te+0]-$e)*(Z-xe)/(Oe-xe)+$e&&(ce=!ce)}return ce}},3870:(Mt,Ye,ue)=>{var ae=ue(1766),pe=ue(2260);Mt.exports=function(c,Z,ce,be){return Z.length>0&&Array.isArray(Z[0])?pe(c,Z,ce,be):ae(c,Z,ce,be)},Mt.exports.nested=pe,Mt.exports.flat=ae},2260:Mt=>{Mt.exports=function(ue,ae,pe,b){var c=ue[0],Z=ue[1],ce=!1;void 0===pe&&(pe=0),void 0===b&&(b=ae.length);for(var be=b-pe,ye=0,Te=be-1;ye<be;Te=ye++){var $e=ae[ye+pe][0],xe=ae[ye+pe][1],Oe=ae[Te+pe][1];xe>Z!=Oe>Z&&c<(ae[Te+pe][0]-$e)*(Z-xe)/(Oe-xe)+$e&&(ce=!ce)}return ce}},9855:function(Mt){Mt.exports=function(){"use strict";function Ye(st,Se){if(!(st instanceof Se))throw new TypeError("Cannot call a class as a function")}function ue(st,Se){for(var _e=0;_e<Se.length;_e++){var ve=Se[_e];ve.enumerable=ve.enumerable||!1,ve.configurable=!0,"value"in ve&&(ve.writable=!0),Object.defineProperty(st,ve.key,ve)}}function ae(st,Se,_e){return Se&&ue(st.prototype,Se),_e&&ue(st,_e),st}var pe=function st(Se,_e){this.next=null,this.key=Se,this.data=_e,this.left=null,this.right=null};function b(st,Se){return st>Se?1:st<Se?-1:0}function c(st,Se,_e){for(var ve=new pe(null,null),Je=ve,St=ve;;){var Xt=_e(st,Se.key);if(Xt<0){if(null===Se.left)break;if(_e(st,Se.left.key)<0&&(Se.left=(gr=Se.left).right,gr.right=Se,null===(Se=gr).left))break;St.left=Se,St=Se,Se=Se.left}else{if(!(Xt>0))break;if(null===Se.right)break;var gr;if(_e(st,Se.right.key)>0&&(Se.right=(gr=Se.right).left,gr.left=Se,null===(Se=gr).right))break;Je.right=Se,Je=Se,Se=Se.right}}return Je.right=Se.left,St.left=Se.right,Se.left=ve.right,Se.right=ve.left,Se}function Z(st,Se,_e,ve){var Je=new pe(st,Se);if(null===_e)return Je.left=Je.right=null,Je;var St=ve(st,(_e=c(st,_e,ve)).key);return St<0?(Je.left=_e.left,Je.right=_e,_e.left=null):St>=0&&(Je.right=_e.right,Je.left=_e,_e.right=null),Je}function ce(st,Se,_e){var ve=null,Je=null;if(Se){var St=_e((Se=c(st,Se,_e)).key,st);0===St?(ve=Se.left,Je=Se.right):St<0?(Je=Se.right,Se.right=null,ve=Se):(ve=Se.left,Se.left=null,Je=Se)}return{left:ve,right:Je}}function ye(st,Se,_e,ve,Je){if(st){ve(Se+(_e?"\u2514\u2500\u2500 ":"\u251c\u2500\u2500 ")+Je(st)+"\n");var St=Se+(_e?"    ":"\u2502   ");st.left&&ye(st.left,St,!1,ve,Je),st.right&&ye(st.right,St,!0,ve,Je)}}var Te=function(){function st(Se){void 0===Se&&(Se=b),this._root=null,this._size=0,this._comparator=Se}return st.prototype.insert=function(Se,_e){return this._size++,this._root=Z(Se,_e,this._root,this._comparator)},st.prototype.add=function(Se,_e){var ve=new pe(Se,_e);null===this._root&&(ve.left=ve.right=null,this._size++,this._root=ve);var Je=this._comparator,St=c(Se,this._root,Je),Xt=Je(Se,St.key);return 0===Xt?this._root=St:(Xt<0?(ve.left=St.left,ve.right=St,St.left=null):Xt>0&&(ve.right=St.right,ve.left=St,St.right=null),this._size++,this._root=ve),this._root},st.prototype.remove=function(Se){this._root=this._remove(Se,this._root,this._comparator)},st.prototype._remove=function(Se,_e,ve){var Je;return null===_e?null:0===ve(Se,(_e=c(Se,_e,ve)).key)?(null===_e.left?Je=_e.right:(Je=c(Se,_e.left,ve)).right=_e.right,this._size--,Je):_e},st.prototype.pop=function(){var Se=this._root;if(Se){for(;Se.left;)Se=Se.left;return this._root=c(Se.key,this._root,this._comparator),this._root=this._remove(Se.key,this._root,this._comparator),{key:Se.key,data:Se.data}}return null},st.prototype.findStatic=function(Se){for(var _e=this._root,ve=this._comparator;_e;){var Je=ve(Se,_e.key);if(0===Je)return _e;_e=Je<0?_e.left:_e.right}return null},st.prototype.find=function(Se){return this._root&&(this._root=c(Se,this._root,this._comparator),0!==this._comparator(Se,this._root.key))?null:this._root},st.prototype.contains=function(Se){for(var _e=this._root,ve=this._comparator;_e;){var Je=ve(Se,_e.key);if(0===Je)return!0;_e=Je<0?_e.left:_e.right}return!1},st.prototype.forEach=function(Se,_e){for(var ve=this._root,Je=[],St=!1;!St;)null!==ve?(Je.push(ve),ve=ve.left):0!==Je.length?(ve=Je.pop(),Se.call(_e,ve),ve=ve.right):St=!0;return this},st.prototype.range=function(Se,_e,ve,Je){for(var St=[],Xt=this._comparator,gr=this._root;0!==St.length||gr;)if(gr)St.push(gr),gr=gr.left;else{if(Xt((gr=St.pop()).key,_e)>0)break;if(Xt(gr.key,Se)>=0&&ve.call(Je,gr))return this;gr=gr.right}return this},st.prototype.keys=function(){var Se=[];return this.forEach(function(_e){return Se.push(_e.key)}),Se},st.prototype.values=function(){var Se=[];return this.forEach(function(_e){return Se.push(_e.data)}),Se},st.prototype.min=function(){return this._root?this.minNode(this._root).key:null},st.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},st.prototype.minNode=function(Se){if(void 0===Se&&(Se=this._root),Se)for(;Se.left;)Se=Se.left;return Se},st.prototype.maxNode=function(Se){if(void 0===Se&&(Se=this._root),Se)for(;Se.right;)Se=Se.right;return Se},st.prototype.at=function(Se){for(var _e=this._root,ve=!1,Je=0,St=[];!ve;)if(_e)St.push(_e),_e=_e.left;else if(St.length>0){if(_e=St.pop(),Je===Se)return _e;Je++,_e=_e.right}else ve=!0;return null},st.prototype.next=function(Se){var _e=this._root,ve=null;if(Se.right){for(ve=Se.right;ve.left;)ve=ve.left;return ve}for(var Je=this._comparator;_e;){var St=Je(Se.key,_e.key);if(0===St)break;St<0?(ve=_e,_e=_e.left):_e=_e.right}return ve},st.prototype.prev=function(Se){var _e=this._root,ve=null;if(null!==Se.left){for(ve=Se.left;ve.right;)ve=ve.right;return ve}for(var Je=this._comparator;_e;){var St=Je(Se.key,_e.key);if(0===St)break;St<0?_e=_e.left:(ve=_e,_e=_e.right)}return ve},st.prototype.clear=function(){return this._root=null,this._size=0,this},st.prototype.toList=function(){return function ge(st){for(var Se=st,_e=[],ve=!1,Je=new pe(null,null),St=Je;!ve;)Se?(_e.push(Se),Se=Se.left):_e.length>0?Se=(Se=St=St.next=_e.pop()).right:ve=!0;return St.next=null,Je.next}(this._root)},st.prototype.load=function(Se,_e,ve){void 0===_e&&(_e=[]),void 0===ve&&(ve=!1);var Je=Se.length,St=this._comparator;if(ve&&H(Se,_e,0,Je-1,St),null===this._root)this._root=$e(Se,_e,0,Je),this._size=Je;else{var Xt=function We(st,Se,_e){for(var ve=new pe(null,null),Je=ve,St=st,Xt=Se;null!==St&&null!==Xt;)_e(St.key,Xt.key)<0?(Je.next=St,St=St.next):(Je.next=Xt,Xt=Xt.next),Je=Je.next;return null!==St?Je.next=St:null!==Xt&&(Je.next=Xt),ve.next}(this.toList(),function xe(st,Se){for(var _e=new pe(null,null),ve=_e,Je=0;Je<st.length;Je++)ve=ve.next=new pe(st[Je],Se[Je]);return ve.next=null,_e.next}(Se,_e),St);this._root=Oe({head:Xt},0,Je=this._size+Je)}return this},st.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(st.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(st.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),st.prototype.toString=function(Se){void 0===Se&&(Se=function(Je){return String(Je.key)});var _e=[];return ye(this._root,"",!0,function(ve){return _e.push(ve)},Se),_e.join("")},st.prototype.update=function(Se,_e,ve){var Je=this._comparator,St=ce(Se,this._root,Je),Xt=St.left,gr=St.right;Je(Se,_e)<0?gr=Z(_e,ve,gr,Je):Xt=Z(_e,ve,Xt,Je),this._root=function be(st,Se,_e){return null===Se?st:(null===st||((Se=c(st.key,Se,_e)).left=st),Se)}(Xt,gr,Je)},st.prototype.split=function(Se){return ce(Se,this._root,this._comparator)},st}();function $e(st,Se,_e,ve){var Je=ve-_e;if(Je>0){var St=_e+Math.floor(Je/2),_r=new pe(st[St],Se[St]);return _r.left=$e(st,Se,_e,St),_r.right=$e(st,Se,St+1,ve),_r}return null}function Oe(st,Se,_e){var ve=_e-Se;if(ve>0){var Je=Se+Math.floor(ve/2),St=Oe(st,Se,Je),Xt=st.head;return Xt.left=St,st.head=st.head.next,Xt.right=Oe(st,Je+1,_e),Xt}return null}function H(st,Se,_e,ve,Je){if(!(_e>=ve)){for(var St=st[_e+ve>>1],Xt=_e-1,gr=ve+1;;){do{Xt++}while(Je(st[Xt],St)<0);do{gr--}while(Je(st[gr],St)>0);if(Xt>=gr)break;var _r=st[Xt];st[Xt]=st[gr],st[gr]=_r,_r=Se[Xt],Se[Xt]=Se[gr],Se[gr]=_r}H(st,Se,_e,gr,Je),H(st,Se,gr+1,ve,Je)}}var q=function(Se,_e){return Se.ll.x<=_e.x&&_e.x<=Se.ur.x&&Se.ll.y<=_e.y&&_e.y<=Se.ur.y},K=function(Se,_e){return _e.ur.x<Se.ll.x||Se.ur.x<_e.ll.x||_e.ur.y<Se.ll.y||Se.ur.y<_e.ll.y?null:{ll:{x:Se.ll.x<_e.ll.x?_e.ll.x:Se.ll.x,y:Se.ll.y<_e.ll.y?_e.ll.y:Se.ll.y},ur:{x:Se.ur.x<_e.ur.x?Se.ur.x:_e.ur.x,y:Se.ur.y<_e.ur.y?Se.ur.y:_e.ur.y}}},X=Number.EPSILON;void 0===X&&(X=Math.pow(2,-52));var ee=X*X,ie=function(Se,_e){if(-X<Se&&Se<X&&-X<_e&&_e<X)return 0;var ve=Se-_e;return ve*ve<ee*Se*_e?0:Se<_e?-1:1},ne=function(){function st(){Ye(this,st),this.reset()}return ae(st,[{key:"reset",value:function(){this.xRounder=new se,this.yRounder=new se}},{key:"round",value:function(_e,ve){return{x:this.xRounder.round(_e),y:this.yRounder.round(ve)}}}]),st}(),se=function(){function st(){Ye(this,st),this.tree=new Te,this.round(0)}return ae(st,[{key:"round",value:function(_e){var ve=this.tree.add(_e),Je=this.tree.prev(ve);if(null!==Je&&0===ie(ve.key,Je.key))return this.tree.remove(_e),Je.key;var St=this.tree.next(ve);return null!==St&&0===ie(ve.key,St.key)?(this.tree.remove(_e),St.key):_e}}]),st}(),he=new ne,re=function(Se,_e){return Se.x*_e.y-Se.y*_e.x},nt=function(Se,_e){return Se.x*_e.x+Se.y*_e.y},ze=function(Se,_e,ve){var Xt=re({x:_e.x-Se.x,y:_e.y-Se.y},{x:ve.x-Se.x,y:ve.y-Se.y});return ie(Xt,0)},Ze=function(Se){return Math.sqrt(nt(Se,Se))},Ee=function(Se,_e,ve){var Je={x:_e.x-Se.x,y:_e.y-Se.y},St={x:ve.x-Se.x,y:ve.y-Se.y};return re(St,Je)/Ze(St)/Ze(Je)},Jt=function(Se,_e,ve){var Je={x:_e.x-Se.x,y:_e.y-Se.y},St={x:ve.x-Se.x,y:ve.y-Se.y};return nt(St,Je)/Ze(St)/Ze(Je)},Nt=function(Se,_e,ve){return 0===_e.y?null:{x:Se.x+_e.x/_e.y*(ve-Se.y),y:ve}},ke=function(Se,_e,ve){return 0===_e.x?null:{x:ve,y:Se.y+_e.y/_e.x*(ve-Se.x)}},Ae=function(){function st(Se,_e){Ye(this,st),void 0===Se.events?Se.events=[this]:Se.events.push(this),this.point=Se,this.isLeft=_e}return ae(st,null,[{key:"compare",value:function(_e,ve){var Je=st.comparePoints(_e.point,ve.point);return 0!==Je?Je:(_e.point!==ve.point&&_e.link(ve),_e.isLeft!==ve.isLeft?_e.isLeft?1:-1:bt.compare(_e.segment,ve.segment))}},{key:"comparePoints",value:function(_e,ve){return _e.x<ve.x?-1:_e.x>ve.x?1:_e.y<ve.y?-1:_e.y>ve.y?1:0}}]),ae(st,[{key:"link",value:function(_e){if(_e.point===this.point)throw new Error("Tried to link already linked events");for(var ve=_e.point.events,Je=0,St=ve.length;Je<St;Je++){var Xt=ve[Je];this.point.events.push(Xt),Xt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var _e=this.point.events.length,ve=0;ve<_e;ve++){var Je=this.point.events[ve];if(void 0===Je.segment.consumedBy)for(var St=ve+1;St<_e;St++){var Xt=this.point.events[St];void 0===Xt.consumedBy&&Je.otherSE.point.events===Xt.otherSE.point.events&&Je.segment.consume(Xt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var _e=[],ve=0,Je=this.point.events.length;ve<Je;ve++){var St=this.point.events[ve];St!==this&&!St.segment.ringOut&&St.segment.isInResult()&&_e.push(St)}return _e}},{key:"getLeftmostComparator",value:function(_e){var ve=this,Je=new Map,St=function(gr){var _r=gr.otherSE;Je.set(gr,{sine:Ee(ve.point,_e.point,_r.point),cosine:Jt(ve.point,_e.point,_r.point)})};return function(Xt,gr){Je.has(Xt)||St(Xt),Je.has(gr)||St(gr);var _r=Je.get(Xt),rr=_r.sine,En=_r.cosine,un=Je.get(gr),Lr=un.sine,Cn=un.cosine;return rr>=0&&Lr>=0?En<Cn?1:En>Cn?-1:0:rr<0&&Lr<0?En<Cn?-1:En>Cn?1:0:Lr<rr?-1:Lr>rr?1:0}}}]),st}(),pt=0,bt=function(){function st(Se,_e,ve,Je){Ye(this,st),this.id=++pt,this.leftSE=Se,Se.segment=this,Se.otherSE=_e,this.rightSE=_e,_e.segment=this,_e.otherSE=Se,this.rings=ve,this.windings=Je}return ae(st,null,[{key:"compare",value:function(_e,ve){var Je=_e.leftSE.point.x,St=ve.leftSE.point.x,Xt=_e.rightSE.point.x,gr=ve.rightSE.point.x;if(gr<Je)return 1;if(Xt<St)return-1;var _r=_e.leftSE.point.y,rr=ve.leftSE.point.y,En=_e.rightSE.point.y,un=ve.rightSE.point.y;if(Je<St){if(rr<_r&&rr<En)return 1;if(rr>_r&&rr>En)return-1;var Lr=_e.comparePoint(ve.leftSE.point);if(Lr<0)return 1;if(Lr>0)return-1;var Cn=ve.comparePoint(_e.rightSE.point);return 0!==Cn?Cn:-1}if(Je>St){if(_r<rr&&_r<un)return-1;if(_r>rr&&_r>un)return 1;var ti=ve.comparePoint(_e.leftSE.point);if(0!==ti)return ti;var Jn=_e.comparePoint(ve.rightSE.point);return Jn<0?1:Jn>0?-1:1}if(_r<rr)return-1;if(_r>rr)return 1;if(Xt<gr){var zn=ve.comparePoint(_e.rightSE.point);if(0!==zn)return zn}if(Xt>gr){var di=_e.comparePoint(ve.rightSE.point);if(di<0)return 1;if(di>0)return-1}if(Xt!==gr){var Qr=En-_r,wo=Xt-Je,Po=un-rr,is=gr-St;if(Qr>wo&&Po<is)return 1;if(Qr<wo&&Po>is)return-1}return Xt>gr?1:Xt<gr||En<un?-1:En>un?1:_e.id<ve.id?-1:_e.id>ve.id?1:0}}]),ae(st,[{key:"replaceRightSE",value:function(_e){this.rightSE=_e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var _e=this.leftSE.point.y,ve=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:_e<ve?_e:ve},ur:{x:this.rightSE.point.x,y:_e>ve?_e:ve}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(_e){return _e.x===this.leftSE.point.x&&_e.y===this.leftSE.point.y||_e.x===this.rightSE.point.x&&_e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(_e){if(this.isAnEndpoint(_e))return 0;var ve=this.leftSE.point,Je=this.rightSE.point,St=this.vector();if(ve.x===Je.x)return _e.x===ve.x?0:_e.x<ve.x?1:-1;if(_e.x===ve.x+(_e.y-ve.y)/St.y*St.x)return 0;var rr=ve.y+(_e.x-ve.x)/St.x*St.y;return _e.y===rr?0:_e.y<rr?-1:1}},{key:"getIntersection",value:function(_e){var ve=this.bbox(),Je=_e.bbox(),St=K(ve,Je);if(null===St)return null;var Xt=this.leftSE.point,gr=this.rightSE.point,_r=_e.leftSE.point,rr=_e.rightSE.point,En=q(ve,_r)&&0===this.comparePoint(_r),un=q(Je,Xt)&&0===_e.comparePoint(Xt),Lr=q(ve,rr)&&0===this.comparePoint(rr),Cn=q(Je,gr)&&0===_e.comparePoint(gr);if(un&&En)return Cn&&!Lr?gr:!Cn&&Lr?rr:null;if(un)return Lr&&Xt.x===rr.x&&Xt.y===rr.y?null:Xt;if(En)return Cn&&gr.x===_r.x&&gr.y===_r.y?null:_r;if(Cn&&Lr)return null;if(Cn)return gr;if(Lr)return rr;var ti=function(Se,_e,ve,Je){if(0===_e.x)return ke(ve,Je,Se.x);if(0===Je.x)return ke(Se,_e,ve.x);if(0===_e.y)return Nt(ve,Je,Se.y);if(0===Je.y)return Nt(Se,_e,ve.y);var St=re(_e,Je);if(0==St)return null;var Xt={x:ve.x-Se.x,y:ve.y-Se.y},gr=re(Xt,_e)/St,_r=re(Xt,Je)/St;return{x:(Se.x+_r*_e.x+(ve.x+gr*Je.x))/2,y:(Se.y+_r*_e.y+(ve.y+gr*Je.y))/2}}(Xt,this.vector(),_r,_e.vector());return null!==ti&&q(St,ti)?he.round(ti.x,ti.y):null}},{key:"split",value:function(_e){var ve=[],Je=void 0!==_e.events,St=new Ae(_e,!0),Xt=new Ae(_e,!1),gr=this.rightSE;this.replaceRightSE(Xt),ve.push(Xt),ve.push(St);var _r=new st(St,gr,this.rings.slice(),this.windings.slice());return Ae.comparePoints(_r.leftSE.point,_r.rightSE.point)>0&&_r.swapEvents(),Ae.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Je&&(St.checkForConsuming(),Xt.checkForConsuming()),ve}},{key:"swapEvents",value:function(){var _e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=_e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var ve=0,Je=this.windings.length;ve<Je;ve++)this.windings[ve]*=-1}},{key:"consume",value:function(_e){for(var ve=this,Je=_e;ve.consumedBy;)ve=ve.consumedBy;for(;Je.consumedBy;)Je=Je.consumedBy;var St=st.compare(ve,Je);if(0!==St){if(St>0){var Xt=ve;ve=Je,Je=Xt}if(ve.prev===Je){var gr=ve;ve=Je,Je=gr}for(var _r=0,rr=Je.rings.length;_r<rr;_r++){var En=Je.rings[_r],un=Je.windings[_r],Lr=ve.rings.indexOf(En);-1===Lr?(ve.rings.push(En),ve.windings.push(un)):ve.windings[Lr]+=un}Je.rings=null,Je.windings=null,Je.consumedBy=ve,Je.leftSE.consumedBy=ve.leftSE,Je.rightSE.consumedBy=ve.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this._prevInResult=this.prev?this.prev.isInResult()?this.prev:this.prev.prevInResult():null),this._prevInResult}},{key:"beforeState",value:function(){return void 0!==this._beforeState||(this._beforeState=this.prev?(this.prev.consumedBy||this.prev).afterState():{rings:[],windings:[],multiPolys:[]}),this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var _e=this.beforeState();this._afterState={rings:_e.rings.slice(0),windings:_e.windings.slice(0),multiPolys:[]};for(var ve=this._afterState.rings,Je=this._afterState.windings,St=this._afterState.multiPolys,Xt=0,gr=this.rings.length;Xt<gr;Xt++){var _r=this.rings[Xt],rr=this.windings[Xt],En=ve.indexOf(_r);-1===En?(ve.push(_r),Je.push(rr)):Je[En]+=rr}for(var un=[],Lr=[],Cn=0,ti=ve.length;Cn<ti;Cn++)if(0!==Je[Cn]){var Jn=ve[Cn],zn=Jn.poly;if(-1===Lr.indexOf(zn))if(Jn.isExterior)un.push(zn);else{-1===Lr.indexOf(zn)&&Lr.push(zn);var di=un.indexOf(Jn.poly);-1!==di&&un.splice(di,1)}}for(var Qr=0,wo=un.length;Qr<wo;Qr++){var Po=un[Qr].multiPoly;-1===St.indexOf(Po)&&St.push(Po)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var _e=this.beforeState().multiPolys,ve=this.afterState().multiPolys;switch(xr.type){case"union":this._isInResult=0===_e.length!=(0===ve.length);break;case"intersection":var Xt,gr;_e.length<ve.length?(Xt=_e.length,gr=ve.length):(Xt=ve.length,gr=_e.length),this._isInResult=gr===xr.numMultiPolys&&Xt<gr;break;case"xor":var _r=Math.abs(_e.length-ve.length);this._isInResult=_r%2==1;break;case"difference":var rr=function(un){return 1===un.length&&un[0].isSubject};this._isInResult=rr(_e)!==rr(ve);break;default:throw new Error("Unrecognized operation type found ".concat(xr.type))}return this._isInResult}}],[{key:"fromRing",value:function(_e,ve,Je){var St,Xt,gr,_r=Ae.comparePoints(_e,ve);if(_r<0)St=_e,Xt=ve,gr=1;else{if(!(_r>0))throw new Error("Tried to create degenerate segment at [".concat(_e.x,", ").concat(_e.y,"]"));St=ve,Xt=_e,gr=-1}return new st(new Ae(St,!0),new Ae(Xt,!1),[Je],[gr])}}]),st}(),Ue=function(){function st(Se,_e,ve){if(Ye(this,st),!Array.isArray(Se)||0===Se.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=_e,this.isExterior=ve,this.segments=[],"number"!=typeof Se[0][0]||"number"!=typeof Se[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Je=he.round(Se[0][0],Se[0][1]);this.bbox={ll:{x:Je.x,y:Je.y},ur:{x:Je.x,y:Je.y}};for(var St=Je,Xt=1,gr=Se.length;Xt<gr;Xt++){if("number"!=typeof Se[Xt][0]||"number"!=typeof Se[Xt][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var _r=he.round(Se[Xt][0],Se[Xt][1]);_r.x===St.x&&_r.y===St.y||(this.segments.push(bt.fromRing(St,_r,this)),_r.x<this.bbox.ll.x&&(this.bbox.ll.x=_r.x),_r.y<this.bbox.ll.y&&(this.bbox.ll.y=_r.y),_r.x>this.bbox.ur.x&&(this.bbox.ur.x=_r.x),_r.y>this.bbox.ur.y&&(this.bbox.ur.y=_r.y),St=_r)}(Je.x!==St.x||Je.y!==St.y)&&this.segments.push(bt.fromRing(St,Je,this))}return ae(st,[{key:"getSweepEvents",value:function(){for(var _e=[],ve=0,Je=this.segments.length;ve<Je;ve++){var St=this.segments[ve];_e.push(St.leftSE),_e.push(St.rightSE)}return _e}}]),st}(),Wt=function(){function st(Se,_e){if(Ye(this,st),!Array.isArray(Se))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ue(Se[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var ve=1,Je=Se.length;ve<Je;ve++){var St=new Ue(Se[ve],this,!1);St.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=St.bbox.ll.x),St.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=St.bbox.ll.y),St.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=St.bbox.ur.x),St.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=St.bbox.ur.y),this.interiorRings.push(St)}this.multiPoly=_e}return ae(st,[{key:"getSweepEvents",value:function(){for(var _e=this.exteriorRing.getSweepEvents(),ve=0,Je=this.interiorRings.length;ve<Je;ve++)for(var St=this.interiorRings[ve].getSweepEvents(),Xt=0,gr=St.length;Xt<gr;Xt++)_e.push(St[Xt]);return _e}}]),st}(),Vt=function(){function st(Se,_e){if(Ye(this,st),!Array.isArray(Se))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof Se[0][0][0]&&(Se=[Se])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var ve=0,Je=Se.length;ve<Je;ve++){var St=new Wt(Se[ve],this);St.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=St.bbox.ll.x),St.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=St.bbox.ll.y),St.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=St.bbox.ur.x),St.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=St.bbox.ur.y),this.polys.push(St)}this.isSubject=_e}return ae(st,[{key:"getSweepEvents",value:function(){for(var _e=[],ve=0,Je=this.polys.length;ve<Je;ve++)for(var St=this.polys[ve].getSweepEvents(),Xt=0,gr=St.length;Xt<gr;Xt++)_e.push(St[Xt]);return _e}}]),st}(),Cr=function(){function st(Se){Ye(this,st),this.events=Se;for(var _e=0,ve=Se.length;_e<ve;_e++)Se[_e].segment.ringOut=this;this.poly=null}return ae(st,null,[{key:"factory",value:function(_e){for(var ve=[],Je=0,St=_e.length;Je<St;Je++){var Xt=_e[Je];if(Xt.isInResult()&&!Xt.ringOut){for(var gr=null,_r=Xt.leftSE,rr=Xt.rightSE,En=[_r],un=_r.point,Lr=[];gr=_r,En.push(_r=rr),_r.point!==un;)for(;;){var Cn=_r.getAvailableLinkedEvents();if(0===Cn.length){var ti=En[0].point,Jn=En[En.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(ti.x,",")+" ".concat(ti.y,"]. Last matching segment found ends at")+" [".concat(Jn.x,", ").concat(Jn.y,"]."))}if(1===Cn.length){rr=Cn[0].otherSE;break}for(var zn=null,di=0,Qr=Lr.length;di<Qr;di++)if(Lr[di].point===_r.point){zn=di;break}if(null===zn){Lr.push({index:En.length,point:_r.point});var is=_r.getLeftmostComparator(gr);rr=Cn.sort(is)[0].otherSE;break}var wo=Lr.splice(zn)[0],Po=En.splice(wo.index);Po.unshift(Po[0].otherSE),ve.push(new st(Po.reverse()))}ve.push(new st(En))}}return ve}}]),ae(st,[{key:"getGeom",value:function(){for(var _e=this.events[0].point,ve=[_e],Je=1,St=this.events.length-1;Je<St;Je++){var Xt=this.events[Je].point;0!==ze(Xt,_e,this.events[Je+1].point)&&(ve.push(Xt),_e=Xt)}if(1===ve.length)return null;0===ze(ve[0],_e,ve[1])&&ve.shift(),ve.push(ve[0]);for(var En=this.isExteriorRing()?1:-1,un=this.isExteriorRing()?0:ve.length-1,Lr=this.isExteriorRing()?ve.length:-1,Cn=[],ti=un;ti!=Lr;ti+=En)Cn.push([ve[ti].x,ve[ti].y]);return Cn}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var _e=this.enclosingRing();this._isExteriorRing=!_e||!_e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var _e=this.events[0],ve=1,Je=this.events.length;ve<Je;ve++){var St=this.events[ve];Ae.compare(_e,St)>0&&(_e=St)}for(var Xt=_e.segment.prevInResult(),gr=Xt?Xt.prevInResult():null;;){if(!Xt)return null;if(!gr)return Xt.ringOut;if(gr.ringOut!==Xt.ringOut)return gr.ringOut.enclosingRing()!==Xt.ringOut?Xt.ringOut:Xt.ringOut.enclosingRing();Xt=gr.prevInResult(),gr=Xt?Xt.prevInResult():null}}}]),st}(),Ft=function(){function st(Se){Ye(this,st),this.exteriorRing=Se,Se.poly=this,this.interiorRings=[]}return ae(st,[{key:"addInterior",value:function(_e){this.interiorRings.push(_e),_e.poly=this}},{key:"getGeom",value:function(){var _e=[this.exteriorRing.getGeom()];if(null===_e[0])return null;for(var ve=0,Je=this.interiorRings.length;ve<Je;ve++){var St=this.interiorRings[ve].getGeom();null!==St&&_e.push(St)}return _e}}]),st}(),Ur=function(){function st(Se){Ye(this,st),this.rings=Se,this.polys=this._composePolys(Se)}return ae(st,[{key:"getGeom",value:function(){for(var _e=[],ve=0,Je=this.polys.length;ve<Je;ve++){var St=this.polys[ve].getGeom();null!==St&&_e.push(St)}return _e}},{key:"_composePolys",value:function(_e){for(var ve=[],Je=0,St=_e.length;Je<St;Je++){var Xt=_e[Je];if(!Xt.poly)if(Xt.isExteriorRing())ve.push(new Ft(Xt));else{var gr=Xt.enclosingRing();gr.poly||ve.push(new Ft(gr)),gr.poly.addInterior(Xt)}}return ve}}]),st}(),Fr=function(){function st(Se){var _e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bt.compare;Ye(this,st),this.queue=Se,this.tree=new Te(_e),this.segments=[]}return ae(st,[{key:"process",value:function(_e){var ve=_e.segment,Je=[];if(_e.consumedBy)return _e.isLeft?this.queue.remove(_e.otherSE):this.tree.remove(ve),Je;var St=_e.isLeft?this.tree.insert(ve):this.tree.find(ve);if(!St)throw new Error("Unable to find segment #".concat(ve.id," ")+"[".concat(ve.leftSE.point.x,", ").concat(ve.leftSE.point.y,"] -> ")+"[".concat(ve.rightSE.point.x,", ").concat(ve.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Xt=St,gr=St,_r=void 0,rr=void 0;void 0===_r;)null===(Xt=this.tree.prev(Xt))?_r=null:void 0===Xt.key.consumedBy&&(_r=Xt.key);for(;void 0===rr;)null===(gr=this.tree.next(gr))?rr=null:void 0===gr.key.consumedBy&&(rr=gr.key);if(_e.isLeft){var En=null;if(_r){var un=_r.getIntersection(ve);if(null!==un&&(ve.isAnEndpoint(un)||(En=un),!_r.isAnEndpoint(un)))for(var Lr=this._splitSafely(_r,un),Cn=0,ti=Lr.length;Cn<ti;Cn++)Je.push(Lr[Cn])}var Jn=null;if(rr){var zn=rr.getIntersection(ve);if(null!==zn&&(ve.isAnEndpoint(zn)||(Jn=zn),!rr.isAnEndpoint(zn)))for(var di=this._splitSafely(rr,zn),Qr=0,wo=di.length;Qr<wo;Qr++)Je.push(di[Qr])}if(null!==En||null!==Jn){var Po;Po=null===En?Jn:null===Jn||Ae.comparePoints(En,Jn)<=0?En:Jn,this.queue.remove(ve.rightSE),Je.push(ve.rightSE);for(var Xn=ve.split(Po),Os=0,Bn=Xn.length;Os<Bn;Os++)Je.push(Xn[Os])}Je.length>0?(this.tree.remove(ve),Je.push(_e)):(this.segments.push(ve),ve.prev=_r)}else{if(_r&&rr){var Mr=_r.getIntersection(rr);if(null!==Mr){if(!_r.isAnEndpoint(Mr))for(var Wo=this._splitSafely(_r,Mr),Ys=0,Sn=Wo.length;Ys<Sn;Ys++)Je.push(Wo[Ys]);if(!rr.isAnEndpoint(Mr))for(var aa=this._splitSafely(rr,Mr),Cs=0,Ge=aa.length;Cs<Ge;Cs++)Je.push(aa[Cs])}}this.tree.remove(ve)}return Je}},{key:"_splitSafely",value:function(_e,ve){this.tree.remove(_e);var Je=_e.rightSE;this.queue.remove(Je);var St=_e.split(ve);return St.push(Je),void 0===_e.consumedBy&&this.tree.insert(_e),St}}]),st}(),zr=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,rn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,xr=new(function(){function st(){Ye(this,st)}return ae(st,[{key:"run",value:function(_e,ve,Je){xr.type=_e,he.reset();for(var St=[new Vt(ve,!0)],Xt=0,gr=Je.length;Xt<gr;Xt++)St.push(new Vt(Je[Xt],!1));if(xr.numMultiPolys=St.length,"difference"===xr.type)for(var _r=St[0],rr=1;rr<St.length;)null!==K(St[rr].bbox,_r.bbox)?rr++:St.splice(rr,1);if("intersection"===xr.type)for(var En=0,un=St.length;En<un;En++)for(var Lr=St[En],Cn=En+1,ti=St.length;Cn<ti;Cn++)if(null===K(Lr.bbox,St[Cn].bbox))return[];for(var Jn=new Te(Ae.compare),zn=0,di=St.length;zn<di;zn++)for(var Qr=St[zn].getSweepEvents(),wo=0,Po=Qr.length;wo<Po;wo++)if(Jn.insert(Qr[wo]),Jn.size>zr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var is=new Fr(Jn),Xn=Jn.size,Os=Jn.pop();Os;){var Bn=Os.key;if(Jn.size===Xn){var Mr=Bn.segment;throw new Error("Unable to pop() ".concat(Bn.isLeft?"left":"right"," SweepEvent ")+"[".concat(Bn.point.x,", ").concat(Bn.point.y,"] from segment #").concat(Mr.id," ")+"[".concat(Mr.leftSE.point.x,", ").concat(Mr.leftSE.point.y,"] -> ")+"[".concat(Mr.rightSE.point.x,", ").concat(Mr.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(Jn.size>zr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(is.segments.length>rn)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Wo=is.process(Bn),Ys=0,Sn=Wo.length;Ys<Sn;Ys++){var aa=Wo[Ys];void 0===aa.consumedBy&&Jn.insert(aa)}Xn=Jn.size,Os=Jn.pop()}he.reset();var Cs=Cr.factory(is.segments);return new Ur(Cs).getGeom()}}]),st}());return{union:function(Se){for(var _e=arguments.length,ve=new Array(_e>1?_e-1:0),Je=1;Je<_e;Je++)ve[Je-1]=arguments[Je];return xr.run("union",Se,ve)},intersection:function(Se){for(var _e=arguments.length,ve=new Array(_e>1?_e-1:0),Je=1;Je<_e;Je++)ve[Je-1]=arguments[Je];return xr.run("intersection",Se,ve)},xor:function(Se){for(var _e=arguments.length,ve=new Array(_e>1?_e-1:0),Je=1;Je<_e;Je++)ve[Je-1]=arguments[Je];return xr.run("xor",Se,ve)},difference:function(Se){for(var _e=arguments.length,ve=new Array(_e>1?_e-1:0),Je=1;Je<_e;Je++)ve[Je-1]=arguments[Je];return xr.run("difference",Se,ve)}}}()},3544:(Mt,Ye,ue)=>{"use strict";Mt.exports=pe,Mt.exports.default=pe;var ae=ue(6709);function pe(K,X){if(!(this instanceof pe))return new pe(K,X);this._maxEntries=Math.max(4,K||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),X&&this._initFormat(X),this.clear()}function b(K,X,ee){if(!ee)return X.indexOf(K);for(var ie=0;ie<X.length;ie++)if(ee(K,X[ie]))return ie;return-1}function c(K,X){Z(K,0,K.children.length,X,K)}function Z(K,X,ee,ie,ne){ne||(ne=H(null)),ne.minX=1/0,ne.minY=1/0,ne.maxX=-1/0,ne.maxY=-1/0;for(var he,se=X;se<ee;se++)he=K.children[se],ce(ne,K.leaf?ie(he):he);return ne}function ce(K,X){return K.minX=Math.min(K.minX,X.minX),K.minY=Math.min(K.minY,X.minY),K.maxX=Math.max(K.maxX,X.maxX),K.maxY=Math.max(K.maxY,X.maxY),K}function be(K,X){return K.minX-X.minX}function ye(K,X){return K.minY-X.minY}function Te(K){return(K.maxX-K.minX)*(K.maxY-K.minY)}function $e(K){return K.maxX-K.minX+(K.maxY-K.minY)}function xe(K,X){return(Math.max(X.maxX,K.maxX)-Math.min(X.minX,K.minX))*(Math.max(X.maxY,K.maxY)-Math.min(X.minY,K.minY))}function ge(K,X){var ee=Math.max(K.minX,X.minX),ie=Math.max(K.minY,X.minY),ne=Math.min(K.maxX,X.maxX),se=Math.min(K.maxY,X.maxY);return Math.max(0,ne-ee)*Math.max(0,se-ie)}function Oe(K,X){return K.minX<=X.minX&&K.minY<=X.minY&&X.maxX<=K.maxX&&X.maxY<=K.maxY}function We(K,X){return X.minX<=K.maxX&&X.minY<=K.maxY&&X.maxX>=K.minX&&X.maxY>=K.minY}function H(K){return{children:K,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function q(K,X,ee,ie,ne){for(var he,se=[X,ee];se.length;)!((ee=se.pop())-(X=se.pop())<=ie)&&(he=X+Math.ceil((ee-X)/ie/2)*ie,ae(K,he,X,ee,ne),se.push(X,he,he,ee))}pe.prototype={all:function(){return this._all(this.data,[])},search:function(K){var X=this.data,ee=[],ie=this.toBBox;if(!We(K,X))return ee;for(var se,he,re,nt,ne=[];X;){for(se=0,he=X.children.length;se<he;se++)re=X.children[se],We(K,nt=X.leaf?ie(re):re)&&(X.leaf?ee.push(re):Oe(K,nt)?this._all(re,ee):ne.push(re));X=ne.pop()}return ee},collides:function(K){var X=this.data,ee=this.toBBox;if(!We(K,X))return!1;for(var ne,se,he,re,ie=[];X;){for(ne=0,se=X.children.length;ne<se;ne++)if(he=X.children[ne],We(K,re=X.leaf?ee(he):he)){if(X.leaf||Oe(K,re))return!0;ie.push(he)}X=ie.pop()}return!1},load:function(K){if(!K||!K.length)return this;if(K.length<this._minEntries){for(var X=0,ee=K.length;X<ee;X++)this.insert(K[X]);return this}var ie=this._build(K.slice(),0,K.length-1,0);if(this.data.children.length)if(this.data.height===ie.height)this._splitRoot(this.data,ie);else{if(this.data.height<ie.height){var ne=this.data;this.data=ie,ie=ne}this._insert(ie,this.data.height-ie.height-1,!0)}else this.data=ie;return this},insert:function(K){return K&&this._insert(K,this.data.height-1),this},clear:function(){return this.data=H([]),this},remove:function(K,X){if(!K)return this;for(var he,re,nt,ze,ee=this.data,ie=this.toBBox(K),ne=[],se=[];ee||ne.length;){if(ee||(ee=ne.pop(),re=ne[ne.length-1],he=se.pop(),ze=!0),ee.leaf&&-1!==(nt=b(K,ee.children,X)))return ee.children.splice(nt,1),ne.push(ee),this._condense(ne),this;ze||ee.leaf||!Oe(ee,ie)?re?(he++,ee=re.children[he],ze=!1):ee=null:(ne.push(ee),se.push(he),he=0,re=ee,ee=ee.children[0])}return this},toBBox:function(K){return K},compareMinX:be,compareMinY:ye,toJSON:function(){return this.data},fromJSON:function(K){return this.data=K,this},_all:function(K,X){for(var ee=[];K;)K.leaf?X.push.apply(X,K.children):ee.push.apply(ee,K.children),K=ee.pop();return X},_build:function(K,X,ee,ie){var he,ne=ee-X+1,se=this._maxEntries;if(ne<=se)return c(he=H(K.slice(X,ee+1)),this.toBBox),he;ie||(ie=Math.ceil(Math.log(ne)/Math.log(se)),se=Math.ceil(ne/Math.pow(se,ie-1))),(he=H([])).leaf=!1,he.height=ie;var ze,Ze,Ee,Jt,re=Math.ceil(ne/se),nt=re*Math.ceil(Math.sqrt(se));for(q(K,X,ee,nt,this.compareMinX),ze=X;ze<=ee;ze+=nt)for(q(K,ze,Ee=Math.min(ze+nt-1,ee),re,this.compareMinY),Ze=ze;Ze<=Ee;Ze+=re)Jt=Math.min(Ze+re-1,Ee),he.children.push(this._build(K,Ze,Jt,ie-1));return c(he,this.toBBox),he},_chooseSubtree:function(K,X,ee,ie){for(var ne,se,he,re,nt,ze,Ze,Ee;ie.push(X),!X.leaf&&ie.length-1!==ee;){for(Ze=Ee=1/0,ne=0,se=X.children.length;ne<se;ne++)nt=Te(he=X.children[ne]),(ze=xe(K,he)-nt)<Ee?(Ee=ze,Ze=nt<Ze?nt:Ze,re=he):ze===Ee&&nt<Ze&&(Ze=nt,re=he);X=re||X.children[0]}return X},_insert:function(K,X,ee){var ne=ee?K:(0,this.toBBox)(K),se=[],he=this._chooseSubtree(ne,this.data,X,se);for(he.children.push(K),ce(he,ne);X>=0&&se[X].children.length>this._maxEntries;)this._split(se,X),X--;this._adjustParentBBoxes(ne,se,X)},_split:function(K,X){var ee=K[X],ie=ee.children.length,ne=this._minEntries;this._chooseSplitAxis(ee,ne,ie);var se=this._chooseSplitIndex(ee,ne,ie),he=H(ee.children.splice(se,ee.children.length-se));he.height=ee.height,he.leaf=ee.leaf,c(ee,this.toBBox),c(he,this.toBBox),X?K[X-1].children.push(he):this._splitRoot(ee,he)},_splitRoot:function(K,X){this.data=H([K,X]),this.data.height=K.height+1,this.data.leaf=!1,c(this.data,this.toBBox)},_chooseSplitIndex:function(K,X,ee){var ie,ne,se,he,re,nt,ze,Ze;for(nt=ze=1/0,ie=X;ie<=ee-X;ie++)he=ge(ne=Z(K,0,ie,this.toBBox),se=Z(K,ie,ee,this.toBBox)),re=Te(ne)+Te(se),he<nt?(nt=he,Ze=ie,ze=re<ze?re:ze):he===nt&&re<ze&&(ze=re,Ze=ie);return Ze},_chooseSplitAxis:function(K,X,ee){var ie=K.leaf?this.compareMinX:be,ne=K.leaf?this.compareMinY:ye;this._allDistMargin(K,X,ee,ie)<this._allDistMargin(K,X,ee,ne)&&K.children.sort(ie)},_allDistMargin:function(K,X,ee,ie){K.children.sort(ie);var nt,ze,ne=this.toBBox,se=Z(K,0,X,ne),he=Z(K,ee-X,ee,ne),re=$e(se)+$e(he);for(nt=X;nt<ee-X;nt++)ze=K.children[nt],ce(se,K.leaf?ne(ze):ze),re+=$e(se);for(nt=ee-X-1;nt>=X;nt--)ze=K.children[nt],ce(he,K.leaf?ne(ze):ze),re+=$e(he);return re},_adjustParentBBoxes:function(K,X,ee){for(var ie=ee;ie>=0;ie--)ce(X[ie],K)},_condense:function(K){for(var ee,X=K.length-1;X>=0;X--)0===K[X].children.length?X>0?(ee=K[X-1].children).splice(ee.indexOf(K[X]),1):this.clear():c(K[X],this.toBBox)},_initFormat:function(K){var X=["return a"," - b",";"];this.compareMinX=new Function("a","b",X.join(K[0])),this.compareMinY=new Function("a","b",X.join(K[1])),this.toBBox=new Function("a","return {minX: a"+K[0]+", minY: a"+K[1]+", maxX: a"+K[2]+", maxY: a"+K[3]+"};")}}},6709:function(Mt){Mt.exports=function(){"use strict";function ue(b,c,Z,ce,be){for(;ce>Z;){if(ce-Z>600){var ye=ce-Z+1,Te=c-Z+1,$e=Math.log(ye),xe=.5*Math.exp(2*$e/3),ge=.5*Math.sqrt($e*xe*(ye-xe)/ye)*(Te-ye/2<0?-1:1);ue(b,c,Math.max(Z,Math.floor(c-Te*xe/ye+ge)),Math.min(ce,Math.floor(c+(ye-Te)*xe/ye+ge)),be)}var H=b[c],q=Z,K=ce;for(ae(b,Z,c),be(b[ce],H)>0&&ae(b,Z,ce);q<K;){for(ae(b,q,K),q++,K--;be(b[q],H)<0;)q++;for(;be(b[K],H)>0;)K--}0===be(b[Z],H)?ae(b,Z,K):ae(b,++K,ce),K<=c&&(Z=K+1),c<=K&&(ce=K-1)}}function ae(b,c,Z){var ce=b[c];b[c]=b[Z],b[Z]=ce}function pe(b,c){return b<c?-1:b>c?1:0}return function Ye(b,c,Z,ce,be){ue(b,c,Z||0,ce||b.length-1,be||pe)}}()},4468:(Mt,Ye,ue)=>{"use strict";var ae=ue(9582).functionsHaveConfigurableNames(),pe=Object,b=TypeError;Mt.exports=function(){if(null!=this&&this!==pe(this))throw new b("RegExp.prototype.flags getter called on non-object");var Z="";return this.hasIndices&&(Z+="d"),this.global&&(Z+="g"),this.ignoreCase&&(Z+="i"),this.multiline&&(Z+="m"),this.dotAll&&(Z+="s"),this.unicode&&(Z+="u"),this.sticky&&(Z+="y"),Z},ae&&Object.defineProperty&&Object.defineProperty(Mt.exports,"name",{value:"get flags"})},9235:(Mt,Ye,ue)=>{"use strict";var ae=ue(2358),pe=ue(5685),b=ue(4468),c=ue(6343),Z=ue(1956),ce=pe(c());ae(ce,{getPolyfill:c,implementation:b,shim:Z}),Mt.exports=ce},6343:(Mt,Ye,ue)=>{"use strict";var ae=ue(4468),pe=ue(2358).supportsDescriptors,b=Object.getOwnPropertyDescriptor;Mt.exports=function(){if(pe&&"gim"===/a/gim.flags){var Z=b(RegExp.prototype,"flags");if(Z&&"function"==typeof Z.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var ce="",be={};if(Object.defineProperty(be,"hasIndices",{get:function(){ce+="d"}}),Object.defineProperty(be,"sticky",{get:function(){ce+="y"}}),"dy"===ce)return Z.get}}return ae}},1956:(Mt,Ye,ue)=>{"use strict";var ae=ue(2358).supportsDescriptors,pe=ue(6343),b=Object.getOwnPropertyDescriptor,c=Object.defineProperty,Z=TypeError,ce=Object.getPrototypeOf,be=/a/;Mt.exports=function(){if(!ae||!ce)throw new Z("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var Te=pe(),$e=ce(be),xe=b($e,"flags");return(!xe||xe.get!==Te)&&c($e,"flags",{configurable:!0,enumerable:!1,get:Te}),Te}},7563:function(Mt,Ye){!function(ue){"use strict";function b(Oe,We,H,q,K){let X,ee,ie,ne,se=We[0],he=q[0],re=0,nt=0;he>se==he>-se?(X=se,se=We[++re]):(X=he,he=q[++nt]);let ze=0;if(re<Oe&&nt<H)for(he>se==he>-se?(ie=X-((ee=se+X)-se),se=We[++re]):(ie=X-((ee=he+X)-he),he=q[++nt]),X=ee,0!==ie&&(K[ze++]=ie);re<Oe&&nt<H;)he>se==he>-se?(ie=X-((ee=X+se)-(ne=ee-X))+(se-ne),se=We[++re]):(ie=X-((ee=X+he)-(ne=ee-X))+(he-ne),he=q[++nt]),X=ee,0!==ie&&(K[ze++]=ie);for(;re<Oe;)ie=X-((ee=X+se)-(ne=ee-X))+(se-ne),se=We[++re],X=ee,0!==ie&&(K[ze++]=ie);for(;nt<H;)ie=X-((ee=X+he)-(ne=ee-X))+(he-ne),he=q[++nt],X=ee,0!==ie&&(K[ze++]=ie);return 0===X&&0!==ze||(K[ze++]=X),ze}function c(Oe){return new Float64Array(Oe)}const ye=c(4),Te=c(8),$e=c(12),xe=c(16),ge=c(4);ue.orient2d=function(Oe,We,H,q,K,X){const ee=(We-X)*(H-K),ie=(Oe-K)*(q-X),ne=ee-ie;if(0===ee||0===ie||ee>0!=ie>0)return ne;const se=Math.abs(ee+ie);return Math.abs(ne)>=33306690738754716e-32*se?ne:-function(he,re,nt,ze,Ze,Ee,Jt){let Nt,ke,xt,Ae,pt,bt,Ue,Wt,Vt,Cr,Ft,Ur,Fr,zr,rn,Ar,xr,cn;const qn=he-Ze,yi=nt-Ze,ft=re-Ee,lr=ze-Ee;pt=(rn=(Wt=qn-(Ue=(bt=134217729*qn)-(bt-qn)))*(Cr=lr-(Vt=(bt=134217729*lr)-(bt-lr)))-((zr=qn*lr)-Ue*Vt-Wt*Vt-Ue*Cr))-(Ft=rn-(xr=(Wt=ft-(Ue=(bt=134217729*ft)-(bt-ft)))*(Cr=yi-(Vt=(bt=134217729*yi)-(bt-yi)))-((Ar=ft*yi)-Ue*Vt-Wt*Vt-Ue*Cr))),ye[0]=rn-(Ft+pt)+(pt-xr),pt=(Fr=zr-((Ur=zr+Ft)-(pt=Ur-zr))+(Ft-pt))-(Ft=Fr-Ar),ye[1]=Fr-(Ft+pt)+(pt-Ar),pt=(cn=Ur+Ft)-Ur,ye[2]=Ur-(cn-pt)+(Ft-pt),ye[3]=cn;let st=function(St,Xt){let gr=Xt[0];for(let _r=1;_r<4;_r++)gr+=Xt[_r];return gr}(0,ye),Se=22204460492503146e-32*Jt;if(st>=Se||-st>=Se||(Nt=he-(qn+(pt=he-qn))+(pt-Ze),xt=nt-(yi+(pt=nt-yi))+(pt-Ze),ke=re-(ft+(pt=re-ft))+(pt-Ee),Ae=ze-(lr+(pt=ze-lr))+(pt-Ee),0===Nt&&0===ke&&0===xt&&0===Ae)||(Se=11093356479670487e-47*Jt+33306690738754706e-32*Math.abs(st),(st+=qn*Ae+lr*Nt-(ft*xt+yi*ke))>=Se||-st>=Se))return st;pt=(rn=(Wt=Nt-(Ue=(bt=134217729*Nt)-(bt-Nt)))*(Cr=lr-(Vt=(bt=134217729*lr)-(bt-lr)))-((zr=Nt*lr)-Ue*Vt-Wt*Vt-Ue*Cr))-(Ft=rn-(xr=(Wt=ke-(Ue=(bt=134217729*ke)-(bt-ke)))*(Cr=yi-(Vt=(bt=134217729*yi)-(bt-yi)))-((Ar=ke*yi)-Ue*Vt-Wt*Vt-Ue*Cr))),ge[0]=rn-(Ft+pt)+(pt-xr),pt=(Fr=zr-((Ur=zr+Ft)-(pt=Ur-zr))+(Ft-pt))-(Ft=Fr-Ar),ge[1]=Fr-(Ft+pt)+(pt-Ar),pt=(cn=Ur+Ft)-Ur,ge[2]=Ur-(cn-pt)+(Ft-pt),ge[3]=cn;const _e=b(4,ye,4,ge,Te);pt=(rn=(Wt=qn-(Ue=(bt=134217729*qn)-(bt-qn)))*(Cr=Ae-(Vt=(bt=134217729*Ae)-(bt-Ae)))-((zr=qn*Ae)-Ue*Vt-Wt*Vt-Ue*Cr))-(Ft=rn-(xr=(Wt=ft-(Ue=(bt=134217729*ft)-(bt-ft)))*(Cr=xt-(Vt=(bt=134217729*xt)-(bt-xt)))-((Ar=ft*xt)-Ue*Vt-Wt*Vt-Ue*Cr))),ge[0]=rn-(Ft+pt)+(pt-xr),pt=(Fr=zr-((Ur=zr+Ft)-(pt=Ur-zr))+(Ft-pt))-(Ft=Fr-Ar),ge[1]=Fr-(Ft+pt)+(pt-Ar),pt=(cn=Ur+Ft)-Ur,ge[2]=Ur-(cn-pt)+(Ft-pt),ge[3]=cn;const ve=b(_e,Te,4,ge,$e);pt=(rn=(Wt=Nt-(Ue=(bt=134217729*Nt)-(bt-Nt)))*(Cr=Ae-(Vt=(bt=134217729*Ae)-(bt-Ae)))-((zr=Nt*Ae)-Ue*Vt-Wt*Vt-Ue*Cr))-(Ft=rn-(xr=(Wt=ke-(Ue=(bt=134217729*ke)-(bt-ke)))*(Cr=xt-(Vt=(bt=134217729*xt)-(bt-xt)))-((Ar=ke*xt)-Ue*Vt-Wt*Vt-Ue*Cr))),ge[0]=rn-(Ft+pt)+(pt-xr),pt=(Fr=zr-((Ur=zr+Ft)-(pt=Ur-zr))+(Ft-pt))-(Ft=Fr-Ar),ge[1]=Fr-(Ft+pt)+(pt-Ar),pt=(cn=Ur+Ft)-Ur,ge[2]=Ur-(cn-pt)+(Ft-pt),ge[3]=cn;const Je=b(ve,$e,4,ge,xe);return xe[Je-1]}(Oe,We,H,q,K,X,se)},ue.orient2dfast=function(Oe,We,H,q,K,X){return(We-X)*(H-K)-(Oe-K)*(q-X)},Object.defineProperty(ue,"__esModule",{value:!0})}(Ye)},9231:Mt=>{"use strict";Mt.exports={eudist:function(ue,ae,pe){for(var b=ue.length,c=0,Z=0;Z<b;Z++){var ce=(ue[Z]||0)-(ae[Z]||0);c+=ce*ce}return pe?Math.sqrt(c):c},mandist:function(ue,ae,pe){for(var b=ue.length,c=0,Z=0;Z<b;Z++)c+=Math.abs((ue[Z]||0)-(ae[Z]||0));return pe?Math.sqrt(c):c},dist:function(ue,ae,pe){var b=Math.abs(ue-ae);return pe?b:b*b}}},5561:(Mt,Ye,ue)=>{"use strict";var ae=ue(9231),pe=ae.eudist,b=ae.dist;Mt.exports={kmrand:function(Z,ce){for(var be={},ye=[],Te=ce<<2,$e=Z.length,xe=Z[0].length>0;ye.length<ce&&Te-- >0;){var ge=Z[Math.floor(Math.random()*$e)],Oe=xe?ge.join("_"):""+ge;be[Oe]||(be[Oe]=!0,ye.push(ge))}if(ye.length<ce)throw new Error("Error initializating clusters");return ye},kmpp:function(Z,ce){var be=Z[0].length?pe:b,ye=[],Te=Z.length,$e=Z[0].length>0,ge=Z[Math.floor(Math.random()*Te)];for($e&&ge.join("_"),ye.push(ge);ye.length<ce;){for(var We=[],H=ye.length,q=0,K=[],X=0;X<Te;X++){for(var ee=1/0,ie=0;ie<H;ie++){var ne=be(Z[X],ye[ie]);ne<=ee&&(ee=ne)}We[X]=ee}for(var se=0;se<Te;se++)q+=We[se];for(var he=0;he<Te;he++)K[he]={i:he,v:Z[he],pr:We[he]/q,cs:0};K.sort(function(Ze,Ee){return Ze.pr-Ee.pr}),K[0].cs=K[0].pr;for(var re=1;re<Te;re++)K[re].cs=K[re-1].cs+K[re].pr;for(var nt=Math.random(),ze=0;ze<Te-1&&K[ze++].cs<nt;);ye.push(K[ze-1].v)}return ye}}},9475:(Mt,Ye,ue)=>{"use strict";var ae=ue(9231),pe=ue(5561),b=ae.eudist,ce=pe.kmrand,be=pe.kmpp;function Te(xe,ge,Oe){Oe=Oe||[];for(var We=0;We<xe;We++)Oe[We]=ge;return Oe}Mt.exports=function $e(xe,ge,Oe,We){var H=[],q=[],K=[],X=[],ee=!1,ie=We||1e4,ne=xe.length,se=xe[0].length,he=se>0,re=[];if(Oe)H="kmrand"==Oe?ce(xe,ge):"kmpp"==Oe?be(xe,ge):Oe;else for(var nt={};H.length<ge;){var ze=Math.floor(Math.random()*ne);nt[ze]||(nt[ze]=!0,H.push(xe[ze]))}do{Te(ge,0,re);for(var Ze=0;Ze<ne;Ze++){for(var Ee=1/0,Jt=0,Nt=0;Nt<ge;Nt++)(X=he?b(xe[Ze],H[Nt]):Math.abs(xe[Ze]-H[Nt]))<=Ee&&(Ee=X,Jt=Nt);K[Ze]=Jt,re[Jt]++}for(var ke=[],Ae=(q=[],0);Ae<ge;Ae++)ke[Ae]=he?Te(se,0,ke[Ae]):0,q[Ae]=H[Ae];if(he){for(var pt=0;pt<ge;pt++)H[pt]=[];for(var bt=0;bt<ne;bt++)for(var Wt=ke[K[bt]],Vt=xe[bt],Cr=0;Cr<se;Cr++)Wt[Cr]+=Vt[Cr];ee=!0;for(var Ft=0;Ft<ge;Ft++){for(var Ur=H[Ft],Fr=ke[Ft],zr=q[Ft],rn=re[Ft],Ar=0;Ar<se;Ar++)Ur[Ar]=Fr[Ar]/rn||0;if(ee)for(var xr=0;xr<se;xr++)if(zr[xr]!=Ur[xr]){ee=!1;break}}}else{for(var cn=0;cn<ne;cn++)ke[K[cn]]+=xe[cn];for(var yi=0;yi<ge;yi++)H[yi]=ke[yi]/re[yi]||0;ee=!0;for(var ft=0;ft<ge;ft++)if(q[ft]!=H[ft]){ee=!1;break}}ee=ee||--ie<=0}while(!ee);return{it:1e4-ie,k:ge,idxs:K,centroids:H}}},6775:function(Mt){var ae;ae=function(){var ue=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function ae(ce){return ce.match(ue)||[]}function b(ce){return{language:(ce=ae(ce))[1]||"",extlang:ce[2]||"",script:ce[3]||"",region:ce[4]||""}}function c(ce,be,ye){Object.defineProperty(ce,be,{value:ye,enumerable:!0})}function Z(ce,be,ye){function Te($e){return ae($e)[ce]||""}c(Te,"pattern",be),c(b,ye,Te)}return Z(1,/^[a-zA-Z]{2,3}$/,"language"),Z(2,/^[a-zA-Z]{3}$/,"extlang"),Z(3,/^[a-zA-Z]{4}$/,"script"),Z(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),c(b,"split",function pe(ce){return ae(ce).filter(function(be,ye){return be&&ye})}),b},Mt.exports?Mt.exports=ae():this.subtag=ae()},5562:(Mt,Ye,ue)=>{"use strict";var ae=ue(8576);Mt.exports=ae,typeof window<"u"&&(window.Suggestions=ae)},7554:Mt=>{"use strict";var Ye=function(ue){return this.component=ue,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,ue.el.parentNode.insertBefore(this.wrapper,ue.el.nextSibling),this};Ye.prototype.show=function(){this.element.style.display="block"},Ye.prototype.hide=function(){this.element.style.display="none"},Ye.prototype.add=function(ue){this.items.push(ue)},Ye.prototype.clear=function(){this.items=[],this.active=0},Ye.prototype.isEmpty=function(){return!this.items.length},Ye.prototype.isVisible=function(){return"block"===this.element.style.display},Ye.prototype.draw=function(){if(this.element.innerHTML="",0!==this.items.length){for(var ue=0;ue<this.items.length;ue++)this.drawItem(this.items[ue],this.active===ue);this.show()}else this.hide()},Ye.prototype.drawItem=function(ue,ae){var pe=document.createElement("li"),b=document.createElement("a");ae&&(pe.className+=" active"),b.innerHTML=ue.string,pe.appendChild(b),this.element.appendChild(pe),pe.addEventListener("mousedown",function(){this.selectingListItem=!0}.bind(this)),pe.addEventListener("mouseup",function(){this.handleMouseUp.call(this,ue)}.bind(this))},Ye.prototype.handleMouseUp=function(ue){this.selectingListItem=!1,this.component.value(ue.original),this.clear(),this.draw()},Ye.prototype.move=function(ue){this.active=ue,this.draw()},Ye.prototype.previous=function(){this.move(0===this.active?this.items.length-1:this.active-1)},Ye.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},Ye.prototype.drawError=function(ue){var ae=document.createElement("li");ae.innerHTML=ue,this.element.appendChild(ae),this.show()},Mt.exports=Ye},8576:(Mt,Ye,ue)=>{"use strict";var ae=ue(4703),pe=ue(5780),b=ue(7554),c=function(Z,ce,be){return this.options=ae({minLength:2,limit:5,filter:!0,hideOnBlur:!0},be=be||{}),this.el=Z,this.data=ce||[],this.list=new b(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",function(ye){this.handleKeyUp(ye.keyCode)}.bind(this),!1),this.el.addEventListener("keydown",function(ye){this.handleKeyDown(ye)}.bind(this)),this.el.addEventListener("focus",function(){this.handleFocus()}.bind(this)),this.el.addEventListener("blur",function(){this.handleBlur()}.bind(this)),this.el.addEventListener("paste",function(ye){this.handlePaste(ye)}.bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};c.prototype.handleKeyUp=function(Z){40===Z||38===Z||27===Z||13===Z||9===Z||this.handleInputChange(this.el.value)},c.prototype.handleKeyDown=function(Z){switch(Z.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&Z.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next()}},c.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},c.prototype.handlePaste=function(Z){if(Z.clipboardData)this.handleInputChange(Z.clipboardData.getData("Text"));else{var ce=this;setTimeout(function(){ce.handleInputChange(Z.target.value)},100)}},c.prototype.handleInputChange=function(Z){this.query=this.normalize(Z),this.list.clear(),this.query.length<this.options.minLength?this.list.draw():this.getCandidates(function(ce){for(var be=0;be<ce.length&&(this.list.add(ce[be]),be!==this.options.limit-1);be++);this.list.draw()}.bind(this))},c.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},c.prototype.update=function(Z){this.data=Z,this.handleKeyUp()},c.prototype.clear=function(){this.data=[],this.list.clear()},c.prototype.normalize=function(Z){return Z.toLowerCase()},c.prototype.match=function(Z,ce){return Z.indexOf(ce)>-1},c.prototype.value=function(Z){if(this.selected=Z,this.el.value=this.getItemValue(Z),document.createEvent){var ce=document.createEvent("HTMLEvents");ce.initEvent("change",!0,!1),this.el.dispatchEvent(ce)}else this.el.fireEvent("onchange")},c.prototype.getCandidates=function(Z){var ce={pre:"<strong>",post:"</strong>",extract:function(ye){return this.getItemValue(ye)}.bind(this)};Z(this.options.filter?pe.filter(this.query,this.data,ce).map(function(ye){return{original:ye.original,string:this.render(ye.original,ye.string)}}.bind(this)):this.data.map(function(ye){return{original:ye,string:this.render(ye)}}.bind(this)))},c.prototype.getItemValue=function(Z){return Z},c.prototype.render=function(Z,ce){if(ce)return ce;for(var be=this.getItemValue(Z.original?Z.original:Z),ye=this.normalize(be),Te=ye.lastIndexOf(this.query);Te>-1;){var $e=Te+this.query.length;be=be.slice(0,Te)+"<strong>"+be.slice(Te,$e)+"</strong>"+be.slice($e),Te=ye.slice(0,Te).lastIndexOf(this.query)}return be},c.prototype.renderError=function(Z){this.list.drawError(Z)},Mt.exports=c},7253:(Mt,Ye,ue)=>{"use strict";ue.r(Ye),ue.d(Ye,{default:()=>ae});class ae{constructor(c=[],Z=pe){if(this.data=c,this.length=this.data.length,this.compare=Z,this.length>0)for(let ce=(this.length>>1)-1;ce>=0;ce--)this._down(ce)}push(c){this.data.push(c),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const c=this.data[0],Z=this.data.pop();return this.length--,this.length>0&&(this.data[0]=Z,this._down(0)),c}peek(){return this.data[0]}_up(c){const{data:Z,compare:ce}=this,be=Z[c];for(;c>0;){const ye=c-1>>1,Te=Z[ye];if(ce(be,Te)>=0)break;Z[c]=Te,c=ye}Z[c]=be}_down(c){const{data:Z,compare:ce}=this,be=this.length>>1,ye=Z[c];for(;c<be;){let Te=1+(c<<1),$e=Z[Te];const xe=Te+1;if(xe<this.length&&ce(Z[xe],$e)<0&&(Te=xe,$e=Z[xe]),ce($e,ye)>=0)break;Z[c]=$e,c=Te}Z[c]=ye}}function pe(b,c){return b<c?-1:b>c?1:0}},770:function(Mt,Ye){!function(ue){"use strict";function ae(){}function pe(r){this.message=r||""}function b(r){this.message=r||""}function c(r){this.message=r||""}function Z(){}function ce(r){return null===r?dt:r.color}function be(r){return null===r?null:r.parent}function ye(r,s){null!==r&&(r.color=s)}function Te(r){return null===r?null:r.left}function $e(r){return null===r?null:r.right}function xe(){this.root_=null,this.size_=0}function ge(){}function Oe(){this.array_=[],arguments[0]instanceof Xn&&this.addAll(arguments[0])}function We(){}function H(r){this.message=r||""}function q(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(r){if(null==this)throw new TypeError(this+" is not an object");var s=Object(this),f=Math.max(Math.min(s.length,9007199254740991),0)||0,m=1 in arguments&&parseInt(Number(arguments[1]),10)||0;m=m<0?Math.max(f+m,0):Math.min(m,f);var S=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:f;for(S=S<0?Math.max(f+arguments[2],0):Math.min(S,f);m<S;)s[m]=r,++m;return s},writable:!0}),Number.isFinite=Number.isFinite||function(r){return"number"==typeof r&&isFinite(r)},Number.isInteger=Number.isInteger||function(r){return"number"==typeof r&&isFinite(r)&&Math.floor(r)===r},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(r){return r!=r},Math.trunc=Math.trunc||function(r){return r<0?Math.ceil(r):Math.floor(r)};var K=function(){};K.prototype.interfaces_=function(){return[]},K.prototype.getClass=function(){return K},K.prototype.equalsWithTolerance=function(r,s,f){return Math.abs(r-s)<=f};var X=function(r){function s(f){r.call(this,f),this.name="IllegalArgumentException",this.message=f,this.stack=(new r).stack}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s}(Error),ee=function(){},ie={MAX_VALUE:{configurable:!0}};ee.isNaN=function(r){return Number.isNaN(r)},ee.doubleToLongBits=function(r){return r},ee.longBitsToDouble=function(r){return r},ee.isInfinite=function(r){return!Number.isFinite(r)},ie.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(ee,ie);var ne=function(){},se=function(){},he=function(){},re=function r(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=r.NULL_ORDINATE;else if(1===arguments.length){var s=arguments[0];this.x=s.x,this.y=s.y,this.z=s.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=r.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},nt={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};re.prototype.setOrdinate=function(r,s){switch(r){case re.X:this.x=s;break;case re.Y:this.y=s;break;case re.Z:this.z=s;break;default:throw new X("Invalid ordinate index: "+r)}},re.prototype.equals2D=function(){if(1===arguments.length){var r=arguments[0];return this.x===r.x&&this.y===r.y}if(2===arguments.length){var s=arguments[0],f=arguments[1];return!!K.equalsWithTolerance(this.x,s.x,f)&&!!K.equalsWithTolerance(this.y,s.y,f)}},re.prototype.getOrdinate=function(r){switch(r){case re.X:return this.x;case re.Y:return this.y;case re.Z:return this.z}throw new X("Invalid ordinate index: "+r)},re.prototype.equals3D=function(r){return this.x===r.x&&this.y===r.y&&(this.z===r.z||ee.isNaN(this.z))&&ee.isNaN(r.z)},re.prototype.equals=function(r){return r instanceof re&&this.equals2D(r)},re.prototype.equalInZ=function(r,s){return K.equalsWithTolerance(this.z,r.z,s)},re.prototype.compareTo=function(r){return this.x<r.x?-1:this.x>r.x?1:this.y<r.y?-1:this.y>r.y?1:0},re.prototype.clone=function(){},re.prototype.copy=function(){return new re(this)},re.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},re.prototype.distance3D=function(r){var s=this.x-r.x,f=this.y-r.y,m=this.z-r.z;return Math.sqrt(s*s+f*f+m*m)},re.prototype.distance=function(r){var s=this.x-r.x,f=this.y-r.y;return Math.sqrt(s*s+f*f)},re.prototype.hashCode=function(){var r=17;return 37*(r=37*r+re.hashCode(this.x))+re.hashCode(this.y)},re.prototype.setCoordinate=function(r){this.x=r.x,this.y=r.y,this.z=r.z},re.prototype.interfaces_=function(){return[ne,se,ae]},re.prototype.getClass=function(){return re},re.hashCode=function(){if(1===arguments.length){var s=ee.doubleToLongBits(arguments[0]);return Math.trunc((s^s)>>>32)}},nt.DimensionalComparator.get=function(){return ze},nt.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},nt.NULL_ORDINATE.get=function(){return ee.NaN},nt.X.get=function(){return 0},nt.Y.get=function(){return 1},nt.Z.get=function(){return 2},Object.defineProperties(re,nt);var ze=function(r){if(this._dimensionsToTest=2,0!==arguments.length&&1===arguments.length){var s=arguments[0];if(2!==s&&3!==s)throw new X("only 2 or 3 dimensions may be specified");this._dimensionsToTest=s}};ze.prototype.compare=function(r,s){var f=r,m=s,S=ze.compare(f.x,m.x);if(0!==S)return S;var k=ze.compare(f.y,m.y);return 0!==k?k:this._dimensionsToTest<=2?0:ze.compare(f.z,m.z)},ze.prototype.interfaces_=function(){return[he]},ze.prototype.getClass=function(){return ze},ze.compare=function(r,s){return r<s?-1:r>s?1:ee.isNaN(r)?ee.isNaN(s)?0:-1:ee.isNaN(s)?1:0};var Ze=function(){};Ze.prototype.create=function(){},Ze.prototype.interfaces_=function(){return[]},Ze.prototype.getClass=function(){return Ze};var Ee=function(){},Jt={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Ee.prototype.interfaces_=function(){return[]},Ee.prototype.getClass=function(){return Ee},Ee.toLocationSymbol=function(r){switch(r){case Ee.EXTERIOR:return"e";case Ee.BOUNDARY:return"b";case Ee.INTERIOR:return"i";case Ee.NONE:return"-"}throw new X("Unknown location value: "+r)},Jt.INTERIOR.get=function(){return 0},Jt.BOUNDARY.get=function(){return 1},Jt.EXTERIOR.get=function(){return 2},Jt.NONE.get=function(){return-1},Object.defineProperties(Ee,Jt);var Nt=function(r,s){return r.interfaces_&&r.interfaces_().indexOf(s)>-1},ke=function(){},xt={LOG_10:{configurable:!0}};ke.prototype.interfaces_=function(){return[]},ke.prototype.getClass=function(){return ke},ke.log10=function(r){var s=Math.log(r);return ee.isInfinite(s)||ee.isNaN(s)?s:s/ke.LOG_10},ke.min=function(r,s,f,m){var S=r;return s<S&&(S=s),f<S&&(S=f),m<S&&(S=m),S},ke.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var r=arguments[0],s=arguments[1],f=arguments[2];return r<s?s:r>f?f:r}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var m=arguments[0],S=arguments[1],k=arguments[2];return m<S?S:m>k?k:m}},ke.wrap=function(r,s){return r<0?s- -r%s:r%s},ke.max=function(){if(3===arguments.length){var s=arguments[1],f=arguments[2],m=arguments[0];return s>m&&(m=s),f>m&&(m=f),m}if(4===arguments.length){var k=arguments[1],V=arguments[2],de=arguments[3],Re=arguments[0];return k>Re&&(Re=k),V>Re&&(Re=V),de>Re&&(Re=de),Re}},ke.average=function(r,s){return(r+s)/2},xt.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(ke,xt);var Ae=function(r){this.str=r};Ae.prototype.append=function(r){this.str+=r},Ae.prototype.setCharAt=function(r,s){this.str=this.str.substr(0,r)+s+this.str.substr(r+1)},Ae.prototype.toString=function(r){return this.str};var pt=function(r){this.value=r};pt.prototype.intValue=function(){return this.value},pt.prototype.compareTo=function(r){return this.value<r?-1:this.value>r?1:0},pt.isNaN=function(r){return Number.isNaN(r)};var bt=function(){};bt.isWhitespace=function(r){return r<=32&&r>=0||127===r},bt.toUpperCase=function(r){return r.toUpperCase()};var Ue=function r(){this._hi=0,this._lo=0,0===arguments.length?this.init(0):1===arguments.length?"number"==typeof arguments[0]||arguments[0]instanceof r?this.init(arguments[0]):"string"==typeof arguments[0]&&r.call(this,r.parse(arguments[0])):2===arguments.length&&this.init(arguments[0],arguments[1])},Wt={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Ue.prototype.le=function(r){return(this._hi<r._hi||this._hi===r._hi)&&this._lo<=r._lo},Ue.prototype.extractSignificantDigits=function(r,s){var f=this.abs(),m=Ue.magnitude(f._hi),S=Ue.TEN.pow(m);(f=f.divide(S)).gt(Ue.TEN)?(f=f.divide(Ue.TEN),m+=1):f.lt(Ue.ONE)&&(f=f.multiply(Ue.TEN),m-=1);for(var k=m+1,V=new Ae,de=Ue.MAX_PRINT_DIGITS-1,Re=0;Re<=de;Re++){r&&Re===k&&V.append(".");var yt=Math.trunc(f._hi);if(yt<0)break;var gt=!1,ar=0;yt>9?(gt=!0,ar="9"):ar="0"+yt,V.append(ar),f=f.subtract(Ue.valueOf(yt)).multiply(Ue.TEN),gt&&f.selfAdd(Ue.TEN);var Gr=!0,Br=Ue.magnitude(f._hi);if(Br<0&&Math.abs(Br)>=de-Re&&(Gr=!1),!Gr)break}return s[0]=m,V.toString()},Ue.prototype.sqr=function(){return this.multiply(this)},Ue.prototype.doubleValue=function(){return this._hi+this._lo},Ue.prototype.subtract=function(){return arguments[0]instanceof Ue?this.add(arguments[0].negate()):"number"==typeof arguments[0]?this.add(-arguments[0]):void 0},Ue.prototype.equals=function(){if(1===arguments.length){var r=arguments[0];return this._hi===r._hi&&this._lo===r._lo}},Ue.prototype.isZero=function(){return 0===this._hi&&0===this._lo},Ue.prototype.selfSubtract=function(){if(arguments[0]instanceof Ue){var r=arguments[0];return this.isNaN()?this:this.selfAdd(-r._hi,-r._lo)}if("number"==typeof arguments[0]){var s=arguments[0];return this.isNaN()?this:this.selfAdd(-s,0)}},Ue.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Ue.prototype.min=function(r){return this.le(r)?this:r},Ue.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof Ue){var r=arguments[0];return this.selfDivide(r._hi,r._lo)}if("number"==typeof arguments[0])return this.selfDivide(arguments[0],0)}else if(2===arguments.length){var f=arguments[0],S=null,k=null,V=null,de=null,Re=null,yt=null,gt=null,ar=null;return this._hi=ar=(Re=this._hi/f)+(yt=(this._hi-(gt=Re*f)-(ar=(S=(yt=Ue.SPLIT*Re)-(S=yt-Re))*(V=(ar=Ue.SPLIT*f)-(V=ar-f))-gt+S*(de=f-V)+(k=Re-S)*V+k*de)+this._lo-Re*arguments[1])/f),this._lo=Re-ar+yt,this}},Ue.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},Ue.prototype.divide=function(){if(arguments[0]instanceof Ue){var r=arguments[0],s=null,f=null,m=null,S=null,k=null,V=null,de=null,Re=null;return f=(k=this._hi/r._hi)-(s=(V=Ue.SPLIT*k)-(s=V-k)),Re=s*(m=(Re=Ue.SPLIT*r._hi)-(m=Re-r._hi))-(de=k*r._hi)+s*(S=r._hi-m)+f*m+f*S,new Ue(Re=k+(V=(this._hi-de-Re+this._lo-k*r._lo)/r._hi),k-Re+V)}if("number"==typeof arguments[0]){var yt=arguments[0];return ee.isNaN(yt)?Ue.createNaN():Ue.copy(this).selfDivide(yt,0)}},Ue.prototype.ge=function(r){return(this._hi>r._hi||this._hi===r._hi)&&this._lo>=r._lo},Ue.prototype.pow=function(r){if(0===r)return Ue.valueOf(1);var s=new Ue(this),f=Ue.valueOf(1),m=Math.abs(r);if(m>1)for(;m>0;)m%2==1&&f.selfMultiply(s),(m/=2)>0&&(s=s.sqr());else f=s;return r<0?f.reciprocal():f},Ue.prototype.ceil=function(){if(this.isNaN())return Ue.NaN;var r=Math.ceil(this._hi),s=0;return r===this._hi&&(s=Math.ceil(this._lo)),new Ue(r,s)},Ue.prototype.compareTo=function(r){return this._hi<r._hi?-1:this._hi>r._hi?1:this._lo<r._lo?-1:this._lo>r._lo?1:0},Ue.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Ue.prototype.setValue=function(){return arguments[0]instanceof Ue||"number"==typeof arguments[0]?(this.init(arguments[0]),this):void 0},Ue.prototype.max=function(r){return this.ge(r)?this:r},Ue.prototype.sqrt=function(){if(this.isZero())return Ue.valueOf(0);if(this.isNegative())return Ue.NaN;var r=1/Math.sqrt(this._hi),f=Ue.valueOf(this._hi*r),m=this.subtract(f.sqr())._hi*(.5*r);return f.add(m)},Ue.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof Ue){var r=arguments[0];return this.selfAdd(r._hi,r._lo)}if("number"==typeof arguments[0]){var s=arguments[0],f=null,m=null,S=null,V=null,de=null;return this._hi=(f=(S=this._hi+s)+(de=s-(V=S-this._hi)+(this._hi-(S-V))+this._lo))+(m=de+(S-f)),this._lo=m+(f-this._hi),this}}else if(2===arguments.length){var Re=arguments[0],yt=arguments[1],gt=null,ar=null,Gr=null,Br=null,sn=null,Mn=null,no=null;sn=(Br=this._hi+Re)-(Mn=Br-this._hi),Gr=(ar=this._lo+yt)-(no=ar-this._lo);var ls=(gt=Br+(Mn=(sn=Re-Mn+(this._hi-sn))+ar))+(Mn=(Gr=yt-no+(this._lo-Gr))+(Mn+(Br-gt))),na=Mn+(gt-ls);return this._hi=ls,this._lo=na,this}},Ue.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof Ue){var r=arguments[0];return this.selfMultiply(r._hi,r._lo)}if("number"==typeof arguments[0])return this.selfMultiply(arguments[0],0)}else if(2===arguments.length){var f=arguments[0],S=null,k=null,V=null,de=null,Re=null,yt=null;S=(Re=Ue.SPLIT*this._hi)-this._hi,S=Re-S;var gt=(Re=this._hi*f)+(yt=S*(V=(yt=Ue.SPLIT*f)-(V=yt-f))-Re+S*(de=f-V)+(k=this._hi-S)*V+k*de+(this._hi*arguments[1]+this._lo*f)),ar=yt+(S=Re-gt);return this._hi=gt,this._lo=ar,this}},Ue.prototype.selfSqr=function(){return this.selfMultiply(this)},Ue.prototype.floor=function(){if(this.isNaN())return Ue.NaN;var r=Math.floor(this._hi),s=0;return r===this._hi&&(s=Math.floor(this._lo)),new Ue(r,s)},Ue.prototype.negate=function(){return this.isNaN()?this:new Ue(-this._hi,-this._lo)},Ue.prototype.clone=function(){},Ue.prototype.multiply=function(){if(arguments[0]instanceof Ue){var r=arguments[0];return r.isNaN()?Ue.createNaN():Ue.copy(this).selfMultiply(r)}if("number"==typeof arguments[0]){var s=arguments[0];return ee.isNaN(s)?Ue.createNaN():Ue.copy(this).selfMultiply(s,0)}},Ue.prototype.isNaN=function(){return ee.isNaN(this._hi)},Ue.prototype.intValue=function(){return Math.trunc(this._hi)},Ue.prototype.toString=function(){var r=Ue.magnitude(this._hi);return r>=-3&&r<=20?this.toStandardNotation():this.toSciNotation()},Ue.prototype.toStandardNotation=function(){var r=this.getSpecialNumberString();if(null!==r)return r;var s=new Array(1).fill(null),f=this.extractSignificantDigits(!0,s),m=s[0]+1,S=f;return"."===f.charAt(0)?S="0"+f:m<0?S="0."+Ue.stringOfChar("0",-m)+f:-1===f.indexOf(".")&&(S=f+Ue.stringOfChar("0",m-f.length)+".0"),this.isNegative()?"-"+S:S},Ue.prototype.reciprocal=function(){var s,m,S,V,r=null,f=null,k=null,de=null;s=(S=1/this._hi)-(r=(k=Ue.SPLIT*S)-(r=k-S)),f=(de=Ue.SPLIT*this._hi)-this._hi;var Re=S+(k=(1-(V=S*this._hi)-(de=r*(f=de-f)-V+r*(m=this._hi-f)+s*f+s*m)-S*this._lo)/this._hi);return new Ue(Re,S-Re+k)},Ue.prototype.toSciNotation=function(){if(this.isZero())return Ue.SCI_NOT_ZERO;var r=this.getSpecialNumberString();if(null!==r)return r;var s=new Array(1).fill(null),f=this.extractSignificantDigits(!1,s),m=Ue.SCI_NOT_EXPONENT_CHAR+s[0];if("0"===f.charAt(0))throw new Error("Found leading zero: "+f);var S="";f.length>1&&(S=f.substring(1));var k=f.charAt(0)+"."+S;return this.isNegative()?"-"+k+m:k+m},Ue.prototype.abs=function(){return this.isNaN()?Ue.NaN:this.isNegative()?this.negate():new Ue(this)},Ue.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},Ue.prototype.lt=function(r){return(this._hi<r._hi||this._hi===r._hi)&&this._lo<r._lo},Ue.prototype.add=function(){if(arguments[0]instanceof Ue){var r=arguments[0];return Ue.copy(this).selfAdd(r)}if("number"==typeof arguments[0]){var s=arguments[0];return Ue.copy(this).selfAdd(s)}},Ue.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0])this._hi=arguments[0],this._lo=0;else if(arguments[0]instanceof Ue){var s=arguments[0];this._hi=s._hi,this._lo=s._lo}}else if(2===arguments.length){var m=arguments[1];this._hi=arguments[0],this._lo=m}},Ue.prototype.gt=function(r){return(this._hi>r._hi||this._hi===r._hi)&&this._lo>r._lo},Ue.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},Ue.prototype.trunc=function(){return this.isNaN()?Ue.NaN:this.isPositive()?this.floor():this.ceil()},Ue.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},Ue.prototype.interfaces_=function(){return[ae,ne,se]},Ue.prototype.getClass=function(){return Ue},Ue.sqr=function(r){return Ue.valueOf(r).selfMultiply(r)},Ue.valueOf=function(){return"string"==typeof arguments[0]?Ue.parse(arguments[0]):"number"==typeof arguments[0]?new Ue(arguments[0]):void 0},Ue.sqrt=function(r){return Ue.valueOf(r).sqrt()},Ue.parse=function(r){for(var s=0,f=r.length;bt.isWhitespace(r.charAt(s));)s++;var m=!1;if(s<f){var S=r.charAt(s);"-"!==S&&"+"!==S||(s++,"-"===S&&(m=!0))}for(var k=new Ue,V=0,de=0,Re=0;!(s>=f);){var yt=r.charAt(s);if(s++,bt.isDigit(yt)){var gt=yt-"0";k.selfMultiply(Ue.TEN),k.selfAdd(gt),V++}else{if("."!==yt){if("e"===yt||"E"===yt){var ar=r.substring(s);try{Re=pt.parseInt(ar)}catch(no){throw no instanceof Error?new Error("Invalid exponent "+ar+" in string "+r):no}break}throw new Error("Unexpected character '"+yt+"' at position "+s+" in string "+r)}de=V}}var Gr=k,Br=V-de-Re;if(0===Br)Gr=k;else if(Br>0){var sn=Ue.TEN.pow(Br);Gr=k.divide(sn)}else if(Br<0){var Mn=Ue.TEN.pow(-Br);Gr=k.multiply(Mn)}return m?Gr.negate():Gr},Ue.createNaN=function(){return new Ue(ee.NaN,ee.NaN)},Ue.copy=function(r){return new Ue(r)},Ue.magnitude=function(r){var s=Math.abs(r),f=Math.log(s)/Math.log(10),m=Math.trunc(Math.floor(f));return 10*Math.pow(10,m)<=s&&(m+=1),m},Ue.stringOfChar=function(r,s){for(var f=new Ae,m=0;m<s;m++)f.append(r);return f.toString()},Wt.PI.get=function(){return new Ue(3.141592653589793,12246467991473532e-32)},Wt.TWO_PI.get=function(){return new Ue(6.283185307179586,24492935982947064e-32)},Wt.PI_2.get=function(){return new Ue(1.5707963267948966,6123233995736766e-32)},Wt.E.get=function(){return new Ue(2.718281828459045,14456468917292502e-32)},Wt.NaN.get=function(){return new Ue(ee.NaN,ee.NaN)},Wt.EPS.get=function(){return 123259516440783e-46},Wt.SPLIT.get=function(){return 134217729},Wt.MAX_PRINT_DIGITS.get=function(){return 32},Wt.TEN.get=function(){return Ue.valueOf(10)},Wt.ONE.get=function(){return Ue.valueOf(1)},Wt.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Wt.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Ue,Wt);var Vt=function(){},Cr={DP_SAFE_EPSILON:{configurable:!0}};Vt.prototype.interfaces_=function(){return[]},Vt.prototype.getClass=function(){return Vt},Vt.orientationIndex=function(r,s,f){var m=Vt.orientationIndexFilter(r,s,f);if(m<=1)return m;var S=Ue.valueOf(s.x).selfAdd(-r.x),k=Ue.valueOf(s.y).selfAdd(-r.y),V=Ue.valueOf(f.x).selfAdd(-s.x),de=Ue.valueOf(f.y).selfAdd(-s.y);return S.selfMultiply(de).selfSubtract(k.selfMultiply(V)).signum()},Vt.signOfDet2x2=function(r,s,f,m){return r.multiply(m).selfSubtract(s.multiply(f)).signum()},Vt.intersection=function(r,s,f,m){var S=Ue.valueOf(m.y).selfSubtract(f.y).selfMultiply(Ue.valueOf(s.x).selfSubtract(r.x)),k=Ue.valueOf(m.x).selfSubtract(f.x).selfMultiply(Ue.valueOf(s.y).selfSubtract(r.y)),V=S.subtract(k),de=Ue.valueOf(m.x).selfSubtract(f.x).selfMultiply(Ue.valueOf(r.y).selfSubtract(f.y)),Re=Ue.valueOf(m.y).selfSubtract(f.y).selfMultiply(Ue.valueOf(r.x).selfSubtract(f.x)),yt=de.subtract(Re).selfDivide(V).doubleValue(),gt=Ue.valueOf(r.x).selfAdd(Ue.valueOf(s.x).selfSubtract(r.x).selfMultiply(yt)).doubleValue(),ar=Ue.valueOf(s.x).selfSubtract(r.x).selfMultiply(Ue.valueOf(r.y).selfSubtract(f.y)),Gr=Ue.valueOf(s.y).selfSubtract(r.y).selfMultiply(Ue.valueOf(r.x).selfSubtract(f.x)),Br=ar.subtract(Gr).selfDivide(V).doubleValue(),sn=Ue.valueOf(f.y).selfAdd(Ue.valueOf(m.y).selfSubtract(f.y).selfMultiply(Br)).doubleValue();return new re(gt,sn)},Vt.orientationIndexFilter=function(r,s,f){var m=null,S=(r.x-f.x)*(s.y-f.y),k=(r.y-f.y)*(s.x-f.x),V=S-k;if(S>0){if(k<=0)return Vt.signum(V);m=S+k}else{if(!(S<0)||k>=0)return Vt.signum(V);m=-S-k}var de=Vt.DP_SAFE_EPSILON*m;return V>=de||-V>=de?Vt.signum(V):2},Vt.signum=function(r){return r>0?1:r<0?-1:0},Cr.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Vt,Cr);var Ft=function(){},Ur={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Ur.X.get=function(){return 0},Ur.Y.get=function(){return 1},Ur.Z.get=function(){return 2},Ur.M.get=function(){return 3},Ft.prototype.setOrdinate=function(r,s,f){},Ft.prototype.size=function(){},Ft.prototype.getOrdinate=function(r,s){},Ft.prototype.getCoordinate=function(){},Ft.prototype.getCoordinateCopy=function(r){},Ft.prototype.getDimension=function(){},Ft.prototype.getX=function(r){},Ft.prototype.clone=function(){},Ft.prototype.expandEnvelope=function(r){},Ft.prototype.copy=function(){},Ft.prototype.getY=function(r){},Ft.prototype.toCoordinateArray=function(){},Ft.prototype.interfaces_=function(){return[se]},Ft.prototype.getClass=function(){return Ft},Object.defineProperties(Ft,Ur);var Fr=function(){},zr=function(r){function s(){r.call(this,"Projective point not representable on the Cartesian plane.")}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Fr),rn=function(){};rn.arraycopy=function(r,s,f,m,S){for(var k=0,V=s;V<s+S;V++)f[m+k]=r[V],k++},rn.getProperty=function(r){return{"line.separator":"\n"}[r]};var Ar=function r(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var s=arguments[0];this.x=s.x,this.y=s.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var m=arguments[1];this.x=arguments[0],this.y=m,this.w=1}else if(arguments[0]instanceof r&&arguments[1]instanceof r){var S=arguments[0],k=arguments[1];this.x=S.y*k.w-k.y*S.w,this.y=k.x*S.w-S.x*k.w,this.w=S.x*k.y-k.x*S.y}else if(arguments[0]instanceof re&&arguments[1]instanceof re){var V=arguments[0],de=arguments[1];this.x=V.y-de.y,this.y=de.x-V.x,this.w=V.x*de.y-de.x*V.y}}else if(3===arguments.length){var yt=arguments[1],gt=arguments[2];this.x=arguments[0],this.y=yt,this.w=gt}else if(4===arguments.length){var ar=arguments[0],Gr=arguments[1],Br=arguments[2],sn=arguments[3],Mn=ar.y-Gr.y,no=Gr.x-ar.x,ls=ar.x*Gr.y-Gr.x*ar.y,na=Br.y-sn.y,wl=sn.x-Br.x,Nl=Br.x*sn.y-sn.x*Br.y;this.x=no*Nl-wl*ls,this.y=na*ls-Mn*Nl,this.w=Mn*wl-na*no}};Ar.prototype.getY=function(){var r=this.y/this.w;if(ee.isNaN(r)||ee.isInfinite(r))throw new zr;return r},Ar.prototype.getX=function(){var r=this.x/this.w;if(ee.isNaN(r)||ee.isInfinite(r))throw new zr;return r},Ar.prototype.getCoordinate=function(){var r=new re;return r.x=this.getX(),r.y=this.getY(),r},Ar.prototype.interfaces_=function(){return[]},Ar.prototype.getClass=function(){return Ar},Ar.intersection=function(r,s,f,m){var S=r.y-s.y,k=s.x-r.x,V=r.x*s.y-s.x*r.y,de=f.y-m.y,Re=m.x-f.x,yt=f.x*m.y-m.x*f.y,gt=S*Re-de*k,ar=(k*yt-Re*V)/gt,Gr=(de*V-S*yt)/gt;if(ee.isNaN(ar)||ee.isInfinite(ar)||ee.isNaN(Gr)||ee.isInfinite(Gr))throw new zr;return new re(ar,Gr)};var xr=function r(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length)if(arguments[0]instanceof re){var s=arguments[0];this.init(s.x,s.x,s.y,s.y)}else arguments[0]instanceof r&&this.init(arguments[0]);else if(2===arguments.length){var m=arguments[0],S=arguments[1];this.init(m.x,S.x,m.y,S.y)}else 4===arguments.length&&this.init(arguments[0],arguments[1],arguments[2],arguments[3])},cn={serialVersionUID:{configurable:!0}};xr.prototype.getArea=function(){return this.getWidth()*this.getHeight()},xr.prototype.equals=function(r){if(!(r instanceof xr))return!1;var s=r;return this.isNull()?s.isNull():this._maxx===s.getMaxX()&&this._maxy===s.getMaxY()&&this._minx===s.getMinX()&&this._miny===s.getMinY()},xr.prototype.intersection=function(r){return this.isNull()||r.isNull()||!this.intersects(r)?new xr:new xr(this._minx>r._minx?this._minx:r._minx,this._maxx<r._maxx?this._maxx:r._maxx,this._miny>r._miny?this._miny:r._miny,this._maxy<r._maxy?this._maxy:r._maxy)},xr.prototype.isNull=function(){return this._maxx<this._minx},xr.prototype.getMaxX=function(){return this._maxx},xr.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof re){var r=arguments[0];return this.covers(r.x,r.y)}if(arguments[0]instanceof xr){var s=arguments[0];return!this.isNull()&&!s.isNull()&&s.getMinX()>=this._minx&&s.getMaxX()<=this._maxx&&s.getMinY()>=this._miny&&s.getMaxY()<=this._maxy}}else if(2===arguments.length){var f=arguments[0],m=arguments[1];return!this.isNull()&&f>=this._minx&&f<=this._maxx&&m>=this._miny&&m<=this._maxy}},xr.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof xr){var r=arguments[0];return!this.isNull()&&!r.isNull()&&!(r._minx>this._maxx||r._maxx<this._minx||r._miny>this._maxy||r._maxy<this._miny)}if(arguments[0]instanceof re){var s=arguments[0];return this.intersects(s.x,s.y)}}else if(2===arguments.length){var f=arguments[0],m=arguments[1];return!this.isNull()&&!(f>this._maxx||f<this._minx||m>this._maxy||m<this._miny)}},xr.prototype.getMinY=function(){return this._miny},xr.prototype.getMinX=function(){return this._minx},xr.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof re){var r=arguments[0];this.expandToInclude(r.x,r.y)}else if(arguments[0]instanceof xr){var s=arguments[0];if(s.isNull())return null;this.isNull()?(this._minx=s.getMinX(),this._maxx=s.getMaxX(),this._miny=s.getMinY(),this._maxy=s.getMaxY()):(s._minx<this._minx&&(this._minx=s._minx),s._maxx>this._maxx&&(this._maxx=s._maxx),s._miny<this._miny&&(this._miny=s._miny),s._maxy>this._maxy&&(this._maxy=s._maxy))}}else if(2===arguments.length){var f=arguments[0],m=arguments[1];this.isNull()?(this._minx=f,this._maxx=f,this._miny=m,this._maxy=m):(f<this._minx&&(this._minx=f),f>this._maxx&&(this._maxx=f),m<this._miny&&(this._miny=m),m>this._maxy&&(this._maxy=m))}},xr.prototype.minExtent=function(){if(this.isNull())return 0;var r=this.getWidth(),s=this.getHeight();return r<s?r:s},xr.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},xr.prototype.compareTo=function(r){var s=r;return this.isNull()?s.isNull()?0:-1:s.isNull()?1:this._minx<s._minx?-1:this._minx>s._minx?1:this._miny<s._miny?-1:this._miny>s._miny?1:this._maxx<s._maxx?-1:this._maxx>s._maxx?1:this._maxy<s._maxy?-1:this._maxy>s._maxy?1:0},xr.prototype.translate=function(r,s){if(this.isNull())return null;this.init(this.getMinX()+r,this.getMaxX()+r,this.getMinY()+s,this.getMaxY()+s)},xr.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},xr.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},xr.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},xr.prototype.maxExtent=function(){if(this.isNull())return 0;var r=this.getWidth(),s=this.getHeight();return r>s?r:s},xr.prototype.expandBy=function(){if(1===arguments.length){var r=arguments[0];this.expandBy(r,r)}else if(2===arguments.length){var s=arguments[0],f=arguments[1];if(this.isNull())return null;this._minx-=s,this._maxx+=s,this._miny-=f,this._maxy+=f,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},xr.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof xr)return this.covers(arguments[0]);if(arguments[0]instanceof re)return this.covers(arguments[0])}else if(2===arguments.length)return this.covers(arguments[0],arguments[1])},xr.prototype.centre=function(){return this.isNull()?null:new re((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},xr.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof re){var r=arguments[0];this.init(r.x,r.x,r.y,r.y)}else if(arguments[0]instanceof xr){var s=arguments[0];this._minx=s._minx,this._maxx=s._maxx,this._miny=s._miny,this._maxy=s._maxy}}else if(2===arguments.length){var f=arguments[0],m=arguments[1];this.init(f.x,m.x,f.y,m.y)}else if(4===arguments.length){var S=arguments[0],k=arguments[1],V=arguments[2],de=arguments[3];S<k?(this._minx=S,this._maxx=k):(this._minx=k,this._maxx=S),V<de?(this._miny=V,this._maxy=de):(this._miny=de,this._maxy=V)}},xr.prototype.getMaxY=function(){return this._maxy},xr.prototype.distance=function(r){if(this.intersects(r))return 0;var s=0;this._maxx<r._minx?s=r._minx-this._maxx:this._minx>r._maxx&&(s=this._minx-r._maxx);var f=0;return this._maxy<r._miny?f=r._miny-this._maxy:this._miny>r._maxy&&(f=this._miny-r._maxy),0===s?f:0===f?s:Math.sqrt(s*s+f*f)},xr.prototype.hashCode=function(){var r=17;return 37*(r=37*(r=37*(r=37*r+re.hashCode(this._minx))+re.hashCode(this._maxx))+re.hashCode(this._miny))+re.hashCode(this._maxy)},xr.prototype.interfaces_=function(){return[ne,ae]},xr.prototype.getClass=function(){return xr},xr.intersects=function(){if(3===arguments.length){var r=arguments[0],s=arguments[1],f=arguments[2];return f.x>=(r.x<s.x?r.x:s.x)&&f.x<=(r.x>s.x?r.x:s.x)&&f.y>=(r.y<s.y?r.y:s.y)&&f.y<=(r.y>s.y?r.y:s.y)}if(4===arguments.length){var m=arguments[0],S=arguments[1],k=arguments[2],V=arguments[3],de=Math.min(k.x,V.x),Re=Math.max(k.x,V.x),yt=Math.min(m.x,S.x),gt=Math.max(m.x,S.x);return!(yt>Re||gt<de||(de=Math.min(k.y,V.y),Re=Math.max(k.y,V.y),yt=Math.min(m.y,S.y),gt=Math.max(m.y,S.y),yt>Re||gt<de))}},cn.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(xr,cn);var qn={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},yi=function(r){this.geometryFactory=r||new $n};yi.prototype.read=function(r){var s,f;r=r.replace(/[\n\r]/g," ");var S=qn.typeStr.exec(r);if(-1!==r.search("EMPTY")&&((S=qn.emptyTypeStr.exec(r))[2]=void 0),S&&(f=S[1].toLowerCase(),lr[f]&&(s=lr[f].apply(this,[S[2]]))),void 0===s)throw new Error("Could not parse WKT "+r);return s},yi.prototype.write=function(r){return this.extractGeometry(r)},yi.prototype.extractGeometry=function(r){var s=r.getGeometryType().toLowerCase();if(!ft[s])return null;var f=s.toUpperCase();return r.isEmpty()?f+" EMPTY":f+"("+ft[s].apply(this,[r])+")"};var ft={coordinate:function(r){return r.x+" "+r.y},point:function(r){return ft.coordinate.call(this,r._coordinates._coordinates[0])},multipoint:function(r){for(var s=[],f=0,m=r._geometries.length;f<m;++f)s.push("("+ft.point.apply(this,[r._geometries[f]])+")");return s.join(",")},linestring:function(r){for(var s=[],f=0,m=r._points._coordinates.length;f<m;++f)s.push(ft.coordinate.apply(this,[r._points._coordinates[f]]));return s.join(",")},linearring:function(r){for(var s=[],f=0,m=r._points._coordinates.length;f<m;++f)s.push(ft.coordinate.apply(this,[r._points._coordinates[f]]));return s.join(",")},multilinestring:function(r){for(var s=[],f=0,m=r._geometries.length;f<m;++f)s.push("("+ft.linestring.apply(this,[r._geometries[f]])+")");return s.join(",")},polygon:function(r){var s=[];s.push("("+ft.linestring.apply(this,[r._shell])+")");for(var f=0,m=r._holes.length;f<m;++f)s.push("("+ft.linestring.apply(this,[r._holes[f]])+")");return s.join(",")},multipolygon:function(r){for(var s=[],f=0,m=r._geometries.length;f<m;++f)s.push("("+ft.polygon.apply(this,[r._geometries[f]])+")");return s.join(",")},geometrycollection:function(r){for(var s=[],f=0,m=r._geometries.length;f<m;++f)s.push(this.extractGeometry(r._geometries[f]));return s.join(",")}},lr={point:function(r){if(void 0===r)return this.geometryFactory.createPoint();var s=r.trim().split(qn.spaces);return this.geometryFactory.createPoint(new re(Number.parseFloat(s[0]),Number.parseFloat(s[1])))},multipoint:function(r){if(void 0===r)return this.geometryFactory.createMultiPoint();for(var s,f=r.trim().split(","),m=[],S=0,k=f.length;S<k;++S)s=f[S].replace(qn.trimParens,"$1"),m.push(lr.point.apply(this,[s]));return this.geometryFactory.createMultiPoint(m)},linestring:function(r){if(void 0===r)return this.geometryFactory.createLineString();for(var s,f=r.trim().split(","),m=[],S=0,k=f.length;S<k;++S)s=f[S].trim().split(qn.spaces),m.push(new re(Number.parseFloat(s[0]),Number.parseFloat(s[1])));return this.geometryFactory.createLineString(m)},linearring:function(r){if(void 0===r)return this.geometryFactory.createLinearRing();for(var s,f=r.trim().split(","),m=[],S=0,k=f.length;S<k;++S)s=f[S].trim().split(qn.spaces),m.push(new re(Number.parseFloat(s[0]),Number.parseFloat(s[1])));return this.geometryFactory.createLinearRing(m)},multilinestring:function(r){if(void 0===r)return this.geometryFactory.createMultiLineString();for(var s,f=r.trim().split(qn.parenComma),m=[],S=0,k=f.length;S<k;++S)s=f[S].replace(qn.trimParens,"$1"),m.push(lr.linestring.apply(this,[s]));return this.geometryFactory.createMultiLineString(m)},polygon:function(r){if(void 0===r)return this.geometryFactory.createPolygon();for(var s,f,m,S,k=r.trim().split(qn.parenComma),V=[],de=0,Re=k.length;de<Re;++de)s=k[de].replace(qn.trimParens,"$1"),f=lr.linestring.apply(this,[s]),m=this.geometryFactory.createLinearRing(f._points),0===de?S=m:V.push(m);return this.geometryFactory.createPolygon(S,V)},multipolygon:function(r){if(void 0===r)return this.geometryFactory.createMultiPolygon();for(var s,f=r.trim().split(qn.doubleParenComma),m=[],S=0,k=f.length;S<k;++S)s=f[S].replace(qn.trimParens,"$1"),m.push(lr.polygon.apply(this,[s]));return this.geometryFactory.createMultiPolygon(m)},geometrycollection:function(r){if(void 0===r)return this.geometryFactory.createGeometryCollection();for(var s=(r=r.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),f=[],m=0,S=s.length;m<S;++m)f.push(this.read(s[m]));return this.geometryFactory.createGeometryCollection(f)}},st=function(r){this.parser=new yi(r)};st.prototype.write=function(r){return this.parser.write(r)},st.toLineString=function(r,s){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+r.x+" "+r.y+", "+s.x+" "+s.y+" )"};var Se=function(r){function s(f){r.call(this,f),this.name="RuntimeException",this.message=f,this.stack=(new r).stack}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s}(Error),_e=function(r){function s(){r.call(this),0===arguments.length?r.call(this):1===arguments.length&&r.call(this,arguments[0])}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Se),ve=function(){};ve.prototype.interfaces_=function(){return[]},ve.prototype.getClass=function(){return ve},ve.shouldNeverReachHere=function(){if(0===arguments.length)ve.shouldNeverReachHere(null);else if(1===arguments.length){var r=arguments[0];throw new _e("Should never reach here"+(null!==r?": "+r:""))}},ve.isTrue=function(){var s;if(1===arguments.length)ve.isTrue(arguments[0],null);else if(2===arguments.length&&(s=arguments[1],!arguments[0]))throw null===s?new _e:new _e(s)},ve.equals=function(){var r,s,f;if(2===arguments.length)ve.equals(r=arguments[0],s=arguments[1],null);else if(3===arguments.length&&(f=arguments[2],!(s=arguments[1]).equals(r=arguments[0])))throw new _e("Expected "+r+" but encountered "+s+(null!==f?": "+f:""))};var Je=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new re,this._intPt[1]=new re,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},St={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Je.prototype.getIndexAlongSegment=function(r,s){return this.computeIntLineIndex(),this._intLineIndex[r][s]},Je.prototype.getTopologySummary=function(){var r=new Ae;return this.isEndPoint()&&r.append(" endpoint"),this._isProper&&r.append(" proper"),this.isCollinear()&&r.append(" collinear"),r.toString()},Je.prototype.computeIntersection=function(r,s,f,m){this._inputLines[0][0]=r,this._inputLines[0][1]=s,this._inputLines[1][0]=f,this._inputLines[1][1]=m,this._result=this.computeIntersect(r,s,f,m)},Je.prototype.getIntersectionNum=function(){return this._result},Je.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var r=arguments[0];this.getEdgeDistance(r,0)>this.getEdgeDistance(r,1)?(this._intLineIndex[r][0]=0,this._intLineIndex[r][1]=1):(this._intLineIndex[r][0]=1,this._intLineIndex[r][1]=0)}},Je.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},Je.prototype.setPrecisionModel=function(r){this._precisionModel=r},Je.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var r=arguments[0],s=0;s<this._result;s++)if(!this._intPt[s].equals2D(this._inputLines[r][0])&&!this._intPt[s].equals2D(this._inputLines[r][1]))return!0;return!1}},Je.prototype.getIntersection=function(r){return this._intPt[r]},Je.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},Je.prototype.hasIntersection=function(){return this._result!==Je.NO_INTERSECTION},Je.prototype.getEdgeDistance=function(r,s){return Je.computeEdgeDistance(this._intPt[s],this._inputLines[r][0],this._inputLines[r][1])},Je.prototype.isCollinear=function(){return this._result===Je.COLLINEAR_INTERSECTION},Je.prototype.toString=function(){return st.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+st.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},Je.prototype.getEndpoint=function(r,s){return this._inputLines[r][s]},Je.prototype.isIntersection=function(r){for(var s=0;s<this._result;s++)if(this._intPt[s].equals2D(r))return!0;return!1},Je.prototype.getIntersectionAlongSegment=function(r,s){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[r][s]]},Je.prototype.interfaces_=function(){return[]},Je.prototype.getClass=function(){return Je},Je.computeEdgeDistance=function(r,s,f){var m=Math.abs(f.x-s.x),S=Math.abs(f.y-s.y),k=-1;if(r.equals(s))k=0;else if(r.equals(f))k=m>S?m:S;else{var V=Math.abs(r.x-s.x),de=Math.abs(r.y-s.y);0!==(k=m>S?V:de)||r.equals(s)||(k=Math.max(V,de))}return ve.isTrue(!(0===k&&!r.equals(s)),"Bad distance calculation"),k},Je.nonRobustComputeEdgeDistance=function(r,s,f){var m=r.x-s.x,S=r.y-s.y,k=Math.sqrt(m*m+S*S);return ve.isTrue(!(0===k&&!r.equals(s)),"Invalid distance calculation"),k},St.DONT_INTERSECT.get=function(){return 0},St.DO_INTERSECT.get=function(){return 1},St.COLLINEAR.get=function(){return 2},St.NO_INTERSECTION.get=function(){return 0},St.POINT_INTERSECTION.get=function(){return 1},St.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(Je,St);var Xt=function(r){function s(){r.apply(this,arguments)}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.isInSegmentEnvelopes=function(f){var m=new xr(this._inputLines[0][0],this._inputLines[0][1]),S=new xr(this._inputLines[1][0],this._inputLines[1][1]);return m.contains(f)&&S.contains(f)},s.prototype.computeIntersection=function(){if(3!==arguments.length)return r.prototype.computeIntersection.apply(this,arguments);var f=arguments[0],m=arguments[1],S=arguments[2];if(this._isProper=!1,xr.intersects(m,S,f)&&0===rr.orientationIndex(m,S,f)&&0===rr.orientationIndex(S,m,f))return this._isProper=!0,(f.equals(m)||f.equals(S))&&(this._isProper=!1),this._result=r.POINT_INTERSECTION,null;this._result=r.NO_INTERSECTION},s.prototype.normalizeToMinimum=function(f,m,S,k,V){V.x=this.smallestInAbsValue(f.x,m.x,S.x,k.x),V.y=this.smallestInAbsValue(f.y,m.y,S.y,k.y),f.x-=V.x,f.y-=V.y,m.x-=V.x,m.y-=V.y,S.x-=V.x,S.y-=V.y,k.x-=V.x,k.y-=V.y},s.prototype.safeHCoordinateIntersection=function(f,m,S,k){var V=null;try{V=Ar.intersection(f,m,S,k)}catch(de){if(!(de instanceof zr))throw de;V=s.nearestEndpoint(f,m,S,k)}return V},s.prototype.intersection=function(f,m,S,k){var V=this.intersectionWithNormalization(f,m,S,k);return this.isInSegmentEnvelopes(V)||(V=new re(s.nearestEndpoint(f,m,S,k))),null!==this._precisionModel&&this._precisionModel.makePrecise(V),V},s.prototype.smallestInAbsValue=function(f,m,S,k){var V=f,de=Math.abs(V);return Math.abs(m)<de&&(V=m,de=Math.abs(m)),Math.abs(S)<de&&(V=S,de=Math.abs(S)),Math.abs(k)<de&&(V=k),V},s.prototype.checkDD=function(f,m,S,k,V){var de=Vt.intersection(f,m,S,k),Re=this.isInSegmentEnvelopes(de);rn.out.println("DD in env = "+Re+"  --------------------- "+de),V.distance(de)>1e-4&&rn.out.println("Distance = "+V.distance(de))},s.prototype.intersectionWithNormalization=function(f,m,S,k){var V=new re(f),de=new re(m),Re=new re(S),yt=new re(k),gt=new re;this.normalizeToEnvCentre(V,de,Re,yt,gt);var ar=this.safeHCoordinateIntersection(V,de,Re,yt);return ar.x+=gt.x,ar.y+=gt.y,ar},s.prototype.computeCollinearIntersection=function(f,m,S,k){var V=xr.intersects(f,m,S),de=xr.intersects(f,m,k),Re=xr.intersects(S,k,f),yt=xr.intersects(S,k,m);return V&&de?(this._intPt[0]=S,this._intPt[1]=k,r.COLLINEAR_INTERSECTION):Re&&yt?(this._intPt[0]=f,this._intPt[1]=m,r.COLLINEAR_INTERSECTION):V&&Re?(this._intPt[0]=S,this._intPt[1]=f,!S.equals(f)||de||yt?r.COLLINEAR_INTERSECTION:r.POINT_INTERSECTION):V&&yt?(this._intPt[0]=S,this._intPt[1]=m,!S.equals(m)||de||Re?r.COLLINEAR_INTERSECTION:r.POINT_INTERSECTION):de&&Re?(this._intPt[0]=k,this._intPt[1]=f,!k.equals(f)||V||yt?r.COLLINEAR_INTERSECTION:r.POINT_INTERSECTION):de&&yt?(this._intPt[0]=k,this._intPt[1]=m,!k.equals(m)||V||Re?r.COLLINEAR_INTERSECTION:r.POINT_INTERSECTION):r.NO_INTERSECTION},s.prototype.normalizeToEnvCentre=function(f,m,S,k,V){var de=f.x<m.x?f.x:m.x,Re=f.y<m.y?f.y:m.y,yt=f.x>m.x?f.x:m.x,gt=f.y>m.y?f.y:m.y,ar=S.x<k.x?S.x:k.x,Gr=S.y<k.y?S.y:k.y,Br=S.x>k.x?S.x:k.x,sn=S.y>k.y?S.y:k.y,no=((Re>Gr?Re:Gr)+(gt<sn?gt:sn))/2;V.x=((de>ar?de:ar)+(yt<Br?yt:Br))/2,V.y=no,f.x-=V.x,f.y-=V.y,m.x-=V.x,m.y-=V.y,S.x-=V.x,S.y-=V.y,k.x-=V.x,k.y-=V.y},s.prototype.computeIntersect=function(f,m,S,k){if(this._isProper=!1,!xr.intersects(f,m,S,k))return r.NO_INTERSECTION;var V=rr.orientationIndex(f,m,S),de=rr.orientationIndex(f,m,k);if(V>0&&de>0||V<0&&de<0)return r.NO_INTERSECTION;var Re=rr.orientationIndex(S,k,f),yt=rr.orientationIndex(S,k,m);return Re>0&&yt>0||Re<0&&yt<0?r.NO_INTERSECTION:0===V&&0===de&&0===Re&&0===yt?this.computeCollinearIntersection(f,m,S,k):(0===V||0===de||0===Re||0===yt?(this._isProper=!1,f.equals2D(S)||f.equals2D(k)?this._intPt[0]=f:m.equals2D(S)||m.equals2D(k)?this._intPt[0]=m:0===V?this._intPt[0]=new re(S):0===de?this._intPt[0]=new re(k):0===Re?this._intPt[0]=new re(f):0===yt&&(this._intPt[0]=new re(m))):(this._isProper=!0,this._intPt[0]=this.intersection(f,m,S,k)),r.POINT_INTERSECTION)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.nearestEndpoint=function(f,m,S,k){var V=f,de=rr.distancePointLine(f,S,k),Re=rr.distancePointLine(m,S,k);return Re<de&&(de=Re,V=m),(Re=rr.distancePointLine(S,f,m))<de&&(de=Re,V=S),(Re=rr.distancePointLine(k,f,m))<de&&(de=Re,V=k),V},s}(Je),gr=function(){};gr.prototype.interfaces_=function(){return[]},gr.prototype.getClass=function(){return gr},gr.orientationIndex=function(r,s,f){return gr.signOfDet2x2(s.x-r.x,s.y-r.y,f.x-s.x,f.y-s.y)},gr.signOfDet2x2=function(r,s,f,m){var S=null,k=null,V=null;if(S=1,0===r||0===m)return 0===s||0===f?0:s>0?f>0?-S:S:f>0?S:-S;if(0===s||0===f)return m>0?r>0?S:-S:r>0?-S:S;if(s>0?m>0?s<=m||(S=-S,k=r,r=f,f=k,k=s,s=m,m=k):s<=-m?(S=-S,f=-f,m=-m):(k=r,r=-f,f=k,k=s,s=-m,m=k):m>0?-s<=m?(S=-S,r=-r,s=-s):(k=-r,r=f,f=k,k=-s,s=m,m=k):s>=m?(r=-r,s=-s,f=-f,m=-m):(S=-S,k=-r,r=-f,f=k,k=-s,s=-m,m=k),r>0){if(!(f>0&&r<=f))return S}else{if(f>0||!(r>=f))return-S;S=-S,r=-r,f=-f}for(;;){if((m-=(V=Math.floor(f/r))*s)<0)return-S;if(m>s)return S;if(r>(f-=V*r)+f){if(s<m+m)return S}else{if(s>m+m)return-S;f=r-f,m=s-m,S=-S}if(0===m)return 0===f?0:-S;if(0===f||(r-=(V=Math.floor(r/f))*f,(s-=V*m)<0))return S;if(s>m)return-S;if(f>r+r){if(m<s+s)return-S}else{if(m>s+s)return S;r=f-r,s=m-s,S=-S}if(0===s)return 0===r?0:S;if(0===r)return-S}};var _r=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1,this._p=arguments[0]};_r.prototype.countSegment=function(r,s){if(r.x<this._p.x&&s.x<this._p.x)return null;if(this._p.x===s.x&&this._p.y===s.y)return this._isPointOnSegment=!0,null;if(r.y===this._p.y&&s.y===this._p.y){var f=r.x,m=s.x;return f>m&&(f=s.x,m=r.x),this._p.x>=f&&this._p.x<=m&&(this._isPointOnSegment=!0),null}if(r.y>this._p.y&&s.y<=this._p.y||s.y>this._p.y&&r.y<=this._p.y){var k=r.y-this._p.y,de=s.y-this._p.y,Re=gr.signOfDet2x2(r.x-this._p.x,k,s.x-this._p.x,de);if(0===Re)return this._isPointOnSegment=!0,null;de<k&&(Re=-Re),Re>0&&this._crossingCount++}},_r.prototype.isPointInPolygon=function(){return this.getLocation()!==Ee.EXTERIOR},_r.prototype.getLocation=function(){return this._isPointOnSegment?Ee.BOUNDARY:this._crossingCount%2==1?Ee.INTERIOR:Ee.EXTERIOR},_r.prototype.isOnSegment=function(){return this._isPointOnSegment},_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r},_r.locatePointInRing=function(){if(arguments[0]instanceof re&&Nt(arguments[1],Ft)){for(var s=arguments[1],f=new _r(arguments[0]),m=new re,S=new re,k=1;k<s.size();k++)if(s.getCoordinate(k,m),s.getCoordinate(k-1,S),f.countSegment(m,S),f.isOnSegment())return f.getLocation();return f.getLocation()}if(arguments[0]instanceof re&&arguments[1]instanceof Array){for(var de=arguments[1],Re=new _r(arguments[0]),yt=1;yt<de.length;yt++)if(Re.countSegment(de[yt],de[yt-1]),Re.isOnSegment())return Re.getLocation();return Re.getLocation()}};var rr=function(){},En={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};rr.prototype.interfaces_=function(){return[]},rr.prototype.getClass=function(){return rr},rr.orientationIndex=function(r,s,f){return Vt.orientationIndex(r,s,f)},rr.signedArea=function(){if(arguments[0]instanceof Array){var r=arguments[0];if(r.length<3)return 0;for(var s=0,f=r[0].x,m=1;m<r.length-1;m++)s+=(r[m].x-f)*(r[m-1].y-r[m+1].y);return s/2}if(Nt(arguments[0],Ft)){var V=arguments[0],de=V.size();if(de<3)return 0;var Re=new re,yt=new re,gt=new re;V.getCoordinate(0,yt),V.getCoordinate(1,gt);var ar=yt.x;gt.x-=ar;for(var Gr=0,Br=1;Br<de-1;Br++)Re.y=yt.y,yt.x=gt.x,yt.y=gt.y,V.getCoordinate(Br+1,gt),gt.x-=ar,Gr+=yt.x*(Re.y-gt.y);return Gr/2}},rr.distanceLineLine=function(r,s,f,m){if(r.equals(s))return rr.distancePointLine(r,f,m);if(f.equals(m))return rr.distancePointLine(m,r,s);var S=!1;if(xr.intersects(r,s,f,m)){var k=(s.x-r.x)*(m.y-f.y)-(s.y-r.y)*(m.x-f.x);if(0===k)S=!0;else{var de=((r.y-f.y)*(s.x-r.x)-(r.x-f.x)*(s.y-r.y))/k,Re=((r.y-f.y)*(m.x-f.x)-(r.x-f.x)*(m.y-f.y))/k;(Re<0||Re>1||de<0||de>1)&&(S=!0)}}else S=!0;return S?ke.min(rr.distancePointLine(r,f,m),rr.distancePointLine(s,f,m),rr.distancePointLine(f,r,s),rr.distancePointLine(m,r,s)):0},rr.isPointInRing=function(r,s){return rr.locatePointInRing(r,s)!==Ee.EXTERIOR},rr.computeLength=function(r){var s=r.size();if(s<=1)return 0;var f=0,m=new re;r.getCoordinate(0,m);for(var S=m.x,k=m.y,V=1;V<s;V++){r.getCoordinate(V,m);var de=m.x,Re=m.y,yt=de-S,gt=Re-k;f+=Math.sqrt(yt*yt+gt*gt),S=de,k=Re}return f},rr.isCCW=function(r){var s=r.length-1;if(s<3)throw new X("Ring has fewer than 4 points, so orientation cannot be determined");for(var f=r[0],m=0,S=1;S<=s;S++){var k=r[S];k.y>f.y&&(f=k,m=S)}var V=m;do{(V-=1)<0&&(V=s)}while(r[V].equals2D(f)&&V!==m);var de=m;do{de=(de+1)%s}while(r[de].equals2D(f)&&de!==m);var Re=r[V],yt=r[de];if(Re.equals2D(f)||yt.equals2D(f)||Re.equals2D(yt))return!1;var gt=rr.computeOrientation(Re,f,yt);return 0===gt?Re.x>yt.x:gt>0},rr.locatePointInRing=function(r,s){return _r.locatePointInRing(r,s)},rr.distancePointLinePerpendicular=function(r,s,f){var m=(f.x-s.x)*(f.x-s.x)+(f.y-s.y)*(f.y-s.y);return Math.abs(((s.y-r.y)*(f.x-s.x)-(s.x-r.x)*(f.y-s.y))/m)*Math.sqrt(m)},rr.computeOrientation=function(r,s,f){return rr.orientationIndex(r,s,f)},rr.distancePointLine=function(){if(2===arguments.length){var r=arguments[0],s=arguments[1];if(0===s.length)throw new X("Line array must contain at least one vertex");for(var f=r.distance(s[0]),m=0;m<s.length-1;m++){var S=rr.distancePointLine(r,s[m],s[m+1]);S<f&&(f=S)}return f}if(3===arguments.length){var k=arguments[0],V=arguments[1],de=arguments[2];if(V.x===de.x&&V.y===de.y)return k.distance(V);var Re=(de.x-V.x)*(de.x-V.x)+(de.y-V.y)*(de.y-V.y),yt=((k.x-V.x)*(de.x-V.x)+(k.y-V.y)*(de.y-V.y))/Re;return yt<=0?k.distance(V):yt>=1?k.distance(de):Math.abs(((V.y-k.y)*(de.x-V.x)-(V.x-k.x)*(de.y-V.y))/Re)*Math.sqrt(Re)}},rr.isOnLine=function(r,s){for(var f=new Xt,m=1;m<s.length;m++)if(f.computeIntersection(r,s[m-1],s[m]),f.hasIntersection())return!0;return!1},En.CLOCKWISE.get=function(){return-1},En.RIGHT.get=function(){return rr.CLOCKWISE},En.COUNTERCLOCKWISE.get=function(){return 1},En.LEFT.get=function(){return rr.COUNTERCLOCKWISE},En.COLLINEAR.get=function(){return 0},En.STRAIGHT.get=function(){return rr.COLLINEAR},Object.defineProperties(rr,En);var un=function(){};un.prototype.filter=function(r){},un.prototype.interfaces_=function(){return[]},un.prototype.getClass=function(){return un};var Lr=function(){var r=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=r,this._SRID=r.getSRID()},Cn={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Lr.prototype.isGeometryCollection=function(){return this.getSortIndex()===Lr.SORTINDEX_GEOMETRYCOLLECTION},Lr.prototype.getFactory=function(){return this._factory},Lr.prototype.getGeometryN=function(r){return this},Lr.prototype.getArea=function(){return 0},Lr.prototype.isRectangle=function(){return!1},Lr.prototype.equals=function(){if(arguments[0]instanceof Lr){var r=arguments[0];return null!==r&&this.equalsTopo(r)}if(arguments[0]instanceof Object){var s=arguments[0];return s instanceof Lr&&this.equalsExact(s)}},Lr.prototype.equalsExact=function(r){return this===r||this.equalsExact(r,0)},Lr.prototype.geometryChanged=function(){this.apply(Lr.geometryChangedFilter)},Lr.prototype.geometryChangedAction=function(){this._envelope=null},Lr.prototype.equalsNorm=function(r){return null!==r&&this.norm().equalsExact(r.norm())},Lr.prototype.getLength=function(){return 0},Lr.prototype.getNumGeometries=function(){return 1},Lr.prototype.compareTo=function(){if(1===arguments.length){var r=arguments[0],s=r;return this.getSortIndex()!==s.getSortIndex()?this.getSortIndex()-s.getSortIndex():this.isEmpty()&&s.isEmpty()?0:this.isEmpty()?-1:s.isEmpty()?1:this.compareToSameClass(r)}if(2===arguments.length){var f=arguments[0],m=arguments[1];return this.getSortIndex()!==f.getSortIndex()?this.getSortIndex()-f.getSortIndex():this.isEmpty()&&f.isEmpty()?0:this.isEmpty()?-1:f.isEmpty()?1:this.compareToSameClass(f,m)}},Lr.prototype.getUserData=function(){return this._userData},Lr.prototype.getSRID=function(){return this._SRID},Lr.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},Lr.prototype.checkNotGeometryCollection=function(r){if(r.getSortIndex()===Lr.SORTINDEX_GEOMETRYCOLLECTION)throw new X("This method does not support GeometryCollection arguments")},Lr.prototype.equal=function(r,s,f){return 0===f?r.equals(s):r.distance(s)<=f},Lr.prototype.norm=function(){var r=this.copy();return r.normalize(),r},Lr.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},Lr.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new xr(this._envelope)},Lr.prototype.setSRID=function(r){this._SRID=r},Lr.prototype.setUserData=function(r){this._userData=r},Lr.prototype.compare=function(r,s){for(var f=r.iterator(),m=s.iterator();f.hasNext()&&m.hasNext();){var S=f.next(),k=m.next(),V=S.compareTo(k);if(0!==V)return V}return f.hasNext()?1:m.hasNext()?-1:0},Lr.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},Lr.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Lr.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Lr.SORTINDEX_MULTIPOINT||this.getSortIndex()===Lr.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Lr.SORTINDEX_MULTIPOLYGON},Lr.prototype.interfaces_=function(){return[se,ne,ae]},Lr.prototype.getClass=function(){return Lr},Lr.hasNonEmptyElements=function(r){for(var s=0;s<r.length;s++)if(!r[s].isEmpty())return!0;return!1},Lr.hasNullElements=function(r){for(var s=0;s<r.length;s++)if(null===r[s])return!0;return!1},Cn.serialVersionUID.get=function(){return 0x799ea46522854c00},Cn.SORTINDEX_POINT.get=function(){return 0},Cn.SORTINDEX_MULTIPOINT.get=function(){return 1},Cn.SORTINDEX_LINESTRING.get=function(){return 2},Cn.SORTINDEX_LINEARRING.get=function(){return 3},Cn.SORTINDEX_MULTILINESTRING.get=function(){return 4},Cn.SORTINDEX_POLYGON.get=function(){return 5},Cn.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Cn.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Cn.geometryChangedFilter.get=function(){return ti},Object.defineProperties(Lr,Cn);var ti=function(){};ti.interfaces_=function(){return[un]},ti.filter=function(r){r.geometryChangedAction()};var Jn=function(){};Jn.prototype.filter=function(r){},Jn.prototype.interfaces_=function(){return[]},Jn.prototype.getClass=function(){return Jn};var zn=function(){},di={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};zn.prototype.isInBoundary=function(r){},zn.prototype.interfaces_=function(){return[]},zn.prototype.getClass=function(){return zn},di.Mod2BoundaryNodeRule.get=function(){return Qr},di.EndPointBoundaryNodeRule.get=function(){return wo},di.MultiValentEndPointBoundaryNodeRule.get=function(){return Po},di.MonoValentEndPointBoundaryNodeRule.get=function(){return is},di.MOD2_BOUNDARY_RULE.get=function(){return new Qr},di.ENDPOINT_BOUNDARY_RULE.get=function(){return new wo},di.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Po},di.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new is},di.OGC_SFS_BOUNDARY_RULE.get=function(){return zn.MOD2_BOUNDARY_RULE},Object.defineProperties(zn,di);var Qr=function(){};Qr.prototype.isInBoundary=function(r){return r%2==1},Qr.prototype.interfaces_=function(){return[zn]},Qr.prototype.getClass=function(){return Qr};var wo=function(){};wo.prototype.isInBoundary=function(r){return r>0},wo.prototype.interfaces_=function(){return[zn]},wo.prototype.getClass=function(){return wo};var Po=function(){};Po.prototype.isInBoundary=function(r){return r>1},Po.prototype.interfaces_=function(){return[zn]},Po.prototype.getClass=function(){return Po};var is=function(){};is.prototype.isInBoundary=function(r){return 1===r},is.prototype.interfaces_=function(){return[zn]},is.prototype.getClass=function(){return is};var Xn=function(){};Xn.prototype.add=function(){},Xn.prototype.addAll=function(){},Xn.prototype.isEmpty=function(){},Xn.prototype.iterator=function(){},Xn.prototype.size=function(){},Xn.prototype.toArray=function(){},Xn.prototype.remove=function(){},(pe.prototype=new Error).name="IndexOutOfBoundsException";var Os=function(){};Os.prototype.hasNext=function(){},Os.prototype.next=function(){},Os.prototype.remove=function(){};var Bn=function(r){function s(){r.apply(this,arguments)}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.get=function(){},s.prototype.set=function(){},s.prototype.isEmpty=function(){},s}(Xn);(b.prototype=new Error).name="NoSuchElementException";var Mr=function(r){function s(){r.call(this),this.array_=[],arguments[0]instanceof Xn&&this.addAll(arguments[0])}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.ensureCapacity=function(){},s.prototype.interfaces_=function(){return[r,Xn]},s.prototype.add=function(f){return 1===arguments.length?this.array_.push(f):this.array_.splice(arguments[0],arguments[1]),!0},s.prototype.clear=function(){this.array_=[]},s.prototype.addAll=function(f){for(var m=f.iterator();m.hasNext();)this.add(m.next());return!0},s.prototype.set=function(f,m){var S=this.array_[f];return this.array_[f]=m,S},s.prototype.iterator=function(){return new Wo(this)},s.prototype.get=function(f){if(f<0||f>=this.size())throw new pe;return this.array_[f]},s.prototype.isEmpty=function(){return 0===this.array_.length},s.prototype.size=function(){return this.array_.length},s.prototype.toArray=function(){for(var f=[],m=0,S=this.array_.length;m<S;m++)f.push(this.array_[m]);return f},s.prototype.remove=function(f){for(var m=!1,S=0,k=this.array_.length;S<k;S++)if(this.array_[S]===f){this.array_.splice(S,1),m=!0;break}return m},s}(Bn),Wo=function(r){function s(f){r.call(this),this.arrayList_=f,this.position_=0}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new b;return this.arrayList_.get(this.position_++)},s.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},s.prototype.set=function(f){return this.arrayList_.set(this.position_-1,f)},s.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},s}(Os),Ys=function(r){function s(){if(r.call(this),0!==arguments.length)if(1===arguments.length){var m=arguments[0];this.ensureCapacity(m.length),this.add(m,!0)}else if(2===arguments.length){var S=arguments[0],k=arguments[1];this.ensureCapacity(S.length),this.add(S,k)}}r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s;var f={coordArrayType:{configurable:!0}};return f.coordArrayType.get=function(){return new Array(0).fill(null)},s.prototype.getCoordinate=function(m){return this.get(m)},s.prototype.addAll=function(){if(2===arguments.length){for(var S=arguments[1],k=!1,V=arguments[0].iterator();V.hasNext();)this.add(V.next(),S),k=!0;return k}return r.prototype.addAll.apply(this,arguments)},s.prototype.clone=function(){for(var m=r.prototype.clone.call(this),S=0;S<this.size();S++)m.add(S,this.get(S).copy());return m},s.prototype.toCoordinateArray=function(){return this.toArray(s.coordArrayType)},s.prototype.add=function(){if(1===arguments.length)r.prototype.add.call(this,arguments[0]);else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1],!0),!0;if(arguments[0]instanceof re&&"boolean"==typeof arguments[1]){var V=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(V))return null;r.prototype.add.call(this,V)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1]),!0}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var yt=arguments[0],gt=arguments[1];if(arguments[2])for(var ar=0;ar<yt.length;ar++)this.add(yt[ar],gt);else for(var Gr=yt.length-1;Gr>=0;Gr--)this.add(yt[Gr],gt);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof re){var Br=arguments[0],sn=arguments[1];if(!arguments[2]){var Mn=this.size();if(Mn>0&&(Br>0&&this.get(Br-1).equals2D(sn)||Br<Mn&&this.get(Br).equals2D(sn)))return null}r.prototype.add.call(this,Br,sn)}}else if(4===arguments.length){var no=arguments[0],ls=arguments[1],na=arguments[2],wl=arguments[3],Nl=1;na>wl&&(Nl=-1);for(var Su=na;Su!==wl;Su+=Nl)this.add(no[Su],ls);return!0}},s.prototype.closeRing=function(){this.size()>0&&this.add(new re(this.get(0)),!1)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},Object.defineProperties(s,f),s}(Mr),Sn=function(){},aa={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};aa.ForwardComparator.get=function(){return Cs},aa.BidirectionalComparator.get=function(){return Ge},aa.coordArrayType.get=function(){return new Array(0).fill(null)},Sn.prototype.interfaces_=function(){return[]},Sn.prototype.getClass=function(){return Sn},Sn.isRing=function(r){return!(r.length<4||!r[0].equals2D(r[r.length-1]))},Sn.ptNotInList=function(r,s){for(var f=0;f<r.length;f++){var m=r[f];if(Sn.indexOf(m,s)<0)return m}return null},Sn.scroll=function(r,s){var f=Sn.indexOf(s,r);if(f<0)return null;var m=new Array(r.length).fill(null);rn.arraycopy(r,f,m,0,r.length-f),rn.arraycopy(r,0,m,r.length-f,f),rn.arraycopy(m,0,r,0,r.length)},Sn.equals=function(){if(2===arguments.length){var r=arguments[0],s=arguments[1];if(r===s)return!0;if(null===r||null===s||r.length!==s.length)return!1;for(var f=0;f<r.length;f++)if(!r[f].equals(s[f]))return!1;return!0}if(3===arguments.length){var m=arguments[0],S=arguments[1],k=arguments[2];if(m===S)return!0;if(null===m||null===S||m.length!==S.length)return!1;for(var V=0;V<m.length;V++)if(0!==k.compare(m[V],S[V]))return!1;return!0}},Sn.intersection=function(r,s){for(var f=new Ys,m=0;m<r.length;m++)s.intersects(r[m])&&f.add(r[m],!0);return f.toCoordinateArray()},Sn.hasRepeatedPoints=function(r){for(var s=1;s<r.length;s++)if(r[s-1].equals(r[s]))return!0;return!1},Sn.removeRepeatedPoints=function(r){return Sn.hasRepeatedPoints(r)?new Ys(r,!1).toCoordinateArray():r},Sn.reverse=function(r){for(var s=r.length-1,f=Math.trunc(s/2),m=0;m<=f;m++){var S=r[m];r[m]=r[s-m],r[s-m]=S}},Sn.removeNull=function(r){for(var s=0,f=0;f<r.length;f++)null!==r[f]&&s++;var m=new Array(s).fill(null);if(0===s)return m;for(var S=0,k=0;k<r.length;k++)null!==r[k]&&(m[S++]=r[k]);return m},Sn.copyDeep=function(){if(1===arguments.length){for(var r=arguments[0],s=new Array(r.length).fill(null),f=0;f<r.length;f++)s[f]=new re(r[f]);return s}if(5===arguments.length)for(var m=arguments[0],S=arguments[1],k=arguments[2],V=arguments[3],de=arguments[4],Re=0;Re<de;Re++)k[V+Re]=new re(m[S+Re])},Sn.isEqualReversed=function(r,s){for(var f=0;f<r.length;f++)if(0!==r[f].compareTo(s[r.length-f-1]))return!1;return!0},Sn.envelope=function(r){for(var s=new xr,f=0;f<r.length;f++)s.expandToInclude(r[f]);return s},Sn.toCoordinateArray=function(r){return r.toArray(Sn.coordArrayType)},Sn.atLeastNCoordinatesOrNothing=function(r,s){return s.length>=r?s:[]},Sn.indexOf=function(r,s){for(var f=0;f<s.length;f++)if(r.equals(s[f]))return f;return-1},Sn.increasingDirection=function(r){for(var s=0;s<Math.trunc(r.length/2);s++){var m=r[s].compareTo(r[r.length-1-s]);if(0!==m)return m}return 1},Sn.compare=function(r,s){for(var f=0;f<r.length&&f<s.length;){var m=r[f].compareTo(s[f]);if(0!==m)return m;f++}return f<s.length?-1:f<r.length?1:0},Sn.minCoordinate=function(r){for(var s=null,f=0;f<r.length;f++)(null===s||s.compareTo(r[f])>0)&&(s=r[f]);return s},Sn.extract=function(r,s,f){s=ke.clamp(s,0,r.length);var m=(f=ke.clamp(f,-1,r.length))-s+1;f<0&&(m=0),s>=r.length&&(m=0),f<s&&(m=0);var S=new Array(m).fill(null);if(0===m)return S;for(var k=0,V=s;V<=f;V++)S[k++]=r[V];return S},Object.defineProperties(Sn,aa);var Cs=function(){};Cs.prototype.compare=function(r,s){return Sn.compare(r,s)},Cs.prototype.interfaces_=function(){return[he]},Cs.prototype.getClass=function(){return Cs};var Ge=function(){};Ge.prototype.compare=function(r,s){var f=r,m=s;if(f.length<m.length)return-1;if(f.length>m.length)return 1;if(0===f.length)return 0;var S=Sn.compare(f,m);return Sn.isEqualReversed(f,m)?0:S},Ge.prototype.OLDcompare=function(r,s){var f=r,m=s;if(f.length<m.length)return-1;if(f.length>m.length)return 1;if(0===f.length)return 0;for(var S=Sn.increasingDirection(f),k=Sn.increasingDirection(m),V=S>0?0:f.length-1,de=k>0?0:f.length-1,Re=0;Re<f.length;Re++){var yt=f[V].compareTo(m[de]);if(0!==yt)return yt;V+=S,de+=k}return 0},Ge.prototype.interfaces_=function(){return[he]},Ge.prototype.getClass=function(){return Ge};var le=function(){};le.prototype.get=function(){},le.prototype.put=function(){},le.prototype.size=function(){},le.prototype.values=function(){},le.prototype.entrySet=function(){};var we=function(r){function s(){r.apply(this,arguments)}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s}(le);(c.prototype=new Error).name="OperationNotSupported",(Z.prototype=new Xn).contains=function(){};var qe=function(r){function s(){r.call(this),this.array_=[],arguments[0]instanceof Xn&&this.addAll(arguments[0])}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.contains=function(f){for(var m=0,S=this.array_.length;m<S;m++)if(this.array_[m]===f)return!0;return!1},s.prototype.add=function(f){return!this.contains(f)&&(this.array_.push(f),!0)},s.prototype.addAll=function(f){for(var m=f.iterator();m.hasNext();)this.add(m.next());return!0},s.prototype.remove=function(f){throw new Error},s.prototype.size=function(){return this.array_.length},s.prototype.isEmpty=function(){return 0===this.array_.length},s.prototype.toArray=function(){for(var f=[],m=0,S=this.array_.length;m<S;m++)f.push(this.array_[m]);return f},s.prototype.iterator=function(){return new ot(this)},s}(Z),ot=function(r){function s(f){r.call(this),this.hashSet_=f,this.position_=0}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new b;return this.hashSet_.array_[this.position_++]},s.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},s.prototype.remove=function(){throw new c},s}(Os),dt=0;(xe.prototype=new we).get=function(r){for(var s=this.root_;null!==s;){var f=r.compareTo(s.key);if(f<0)s=s.left;else{if(!(f>0))return s.value;s=s.right}}return null},xe.prototype.put=function(r,s){if(null===this.root_)return this.root_={key:r,value:s,left:null,right:null,parent:null,color:dt,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var f,m,S=this.root_;do{if(f=S,(m=r.compareTo(S.key))<0)S=S.left;else{if(!(m>0)){var k=S.value;return S.value=s,k}S=S.right}}while(null!==S);var V={key:r,left:null,right:null,value:s,parent:f,color:dt,getValue:function(){return this.value},getKey:function(){return this.key}};return m<0?f.left=V:f.right=V,this.fixAfterInsertion(V),this.size_++,null},xe.prototype.fixAfterInsertion=function(r){for(r.color=1;null!=r&&r!==this.root_&&1===r.parent.color;)if(be(r)===Te(be(be(r)))){var s=$e(be(be(r)));1===ce(s)?(ye(be(r),dt),ye(s,dt),ye(be(be(r)),1),r=be(be(r))):(r===$e(be(r))&&(r=be(r),this.rotateLeft(r)),ye(be(r),dt),ye(be(be(r)),1),this.rotateRight(be(be(r))))}else{var f=Te(be(be(r)));1===ce(f)?(ye(be(r),dt),ye(f,dt),ye(be(be(r)),1),r=be(be(r))):(r===Te(be(r))&&(r=be(r),this.rotateRight(r)),ye(be(r),dt),ye(be(be(r)),1),this.rotateLeft(be(be(r))))}this.root_.color=dt},xe.prototype.values=function(){var r=new Mr,s=this.getFirstEntry();if(null!==s)for(r.add(s.value);null!==(s=xe.successor(s));)r.add(s.value);return r},xe.prototype.entrySet=function(){var r=new qe,s=this.getFirstEntry();if(null!==s)for(r.add(s);null!==(s=xe.successor(s));)r.add(s);return r},xe.prototype.rotateLeft=function(r){if(null!=r){var s=r.right;r.right=s.left,null!=s.left&&(s.left.parent=r),s.parent=r.parent,null===r.parent?this.root_=s:r.parent.left===r?r.parent.left=s:r.parent.right=s,s.left=r,r.parent=s}},xe.prototype.rotateRight=function(r){if(null!=r){var s=r.left;r.left=s.right,null!=s.right&&(s.right.parent=r),s.parent=r.parent,null===r.parent?this.root_=s:r.parent.right===r?r.parent.right=s:r.parent.left=s,s.right=r,r.parent=s}},xe.prototype.getFirstEntry=function(){var r=this.root_;if(null!=r)for(;null!=r.left;)r=r.left;return r},xe.successor=function(r){if(null===r)return null;if(null!==r.right){for(var s=r.right;null!==s.left;)s=s.left;return s}for(var f=r.parent,m=r;null!==f&&m===f.right;)m=f,f=f.parent;return f},xe.prototype.size=function(){return this.size_};var Dt=function(){};Dt.prototype.interfaces_=function(){return[]},Dt.prototype.getClass=function(){return Dt},ge.prototype=new Z,(Oe.prototype=new ge).contains=function(r){for(var s=0,f=this.array_.length;s<f;s++)if(0===this.array_[s].compareTo(r))return!0;return!1},Oe.prototype.add=function(r){if(this.contains(r))return!1;for(var s=0,f=this.array_.length;s<f;s++)if(1===this.array_[s].compareTo(r))return this.array_.splice(s,0,r),!0;return this.array_.push(r),!0},Oe.prototype.addAll=function(r){for(var s=r.iterator();s.hasNext();)this.add(s.next());return!0},Oe.prototype.remove=function(r){throw new c},Oe.prototype.size=function(){return this.array_.length},Oe.prototype.isEmpty=function(){return 0===this.array_.length},Oe.prototype.toArray=function(){for(var r=[],s=0,f=this.array_.length;s<f;s++)r.push(this.array_[s]);return r},Oe.prototype.iterator=function(){return new Ot(this)};var Ot=function(r){this.treeSet_=r,this.position_=0};Ot.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new b;return this.treeSet_.array_[this.position_++]},Ot.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Ot.prototype.remove=function(){throw new c};var wt=function(){};wt.sort=function(){var r,s,f,S=arguments[0];if(1===arguments.length)S.sort(function(V,de){return V.compareTo(de)});else if(2===arguments.length)f=arguments[1],S.sort(function(V,de){return f.compare(V,de)});else if(3===arguments.length){(s=S.slice(arguments[1],arguments[2])).sort();var k=S.slice(0,arguments[1]).concat(s,S.slice(arguments[2],S.length));for(S.splice(0,S.length),r=0;r<k.length;r++)S.push(k[r])}else if(4===arguments.length)for(s=S.slice(arguments[1],arguments[2]),f=arguments[3],s.sort(function(V,de){return f.compare(V,de)}),k=S.slice(0,arguments[1]).concat(s,S.slice(arguments[2],S.length)),S.splice(0,S.length),r=0;r<k.length;r++)S.push(k[r])},wt.asList=function(r){for(var s=new Mr,f=0,m=r.length;f<m;f++)s.add(r[f]);return s};var Ct=function(){},sr={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};sr.P.get=function(){return 0},sr.L.get=function(){return 1},sr.A.get=function(){return 2},sr.FALSE.get=function(){return-1},sr.TRUE.get=function(){return-2},sr.DONTCARE.get=function(){return-3},sr.SYM_FALSE.get=function(){return"F"},sr.SYM_TRUE.get=function(){return"T"},sr.SYM_DONTCARE.get=function(){return"*"},sr.SYM_P.get=function(){return"0"},sr.SYM_L.get=function(){return"1"},sr.SYM_A.get=function(){return"2"},Ct.prototype.interfaces_=function(){return[]},Ct.prototype.getClass=function(){return Ct},Ct.toDimensionSymbol=function(r){switch(r){case Ct.FALSE:return Ct.SYM_FALSE;case Ct.TRUE:return Ct.SYM_TRUE;case Ct.DONTCARE:return Ct.SYM_DONTCARE;case Ct.P:return Ct.SYM_P;case Ct.L:return Ct.SYM_L;case Ct.A:return Ct.SYM_A}throw new X("Unknown dimension value: "+r)},Ct.toDimensionValue=function(r){switch(bt.toUpperCase(r)){case Ct.SYM_FALSE:return Ct.FALSE;case Ct.SYM_TRUE:return Ct.TRUE;case Ct.SYM_DONTCARE:return Ct.DONTCARE;case Ct.SYM_P:return Ct.P;case Ct.SYM_L:return Ct.L;case Ct.SYM_A:return Ct.A}throw new X("Unknown dimension symbol: "+r)},Object.defineProperties(Ct,sr);var Rr=function(){};Rr.prototype.filter=function(r){},Rr.prototype.interfaces_=function(){return[]},Rr.prototype.getClass=function(){return Rr};var mr=function(){};mr.prototype.filter=function(r,s){},mr.prototype.isDone=function(){},mr.prototype.isGeometryChanged=function(){},mr.prototype.interfaces_=function(){return[]},mr.prototype.getClass=function(){return mr};var Yr=function(r){function s(m,S){if(r.call(this,S),this._geometries=m||[],r.hasNullElements(this._geometries))throw new X("geometries must not contain null elements")}r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s;var f={serialVersionUID:{configurable:!0}};return s.prototype.computeEnvelopeInternal=function(){for(var m=new xr,S=0;S<this._geometries.length;S++)m.expandToInclude(this._geometries[S].getEnvelopeInternal());return m},s.prototype.getGeometryN=function(m){return this._geometries[m]},s.prototype.getSortIndex=function(){return r.SORTINDEX_GEOMETRYCOLLECTION},s.prototype.getCoordinates=function(){for(var m=new Array(this.getNumPoints()).fill(null),S=-1,k=0;k<this._geometries.length;k++)for(var V=this._geometries[k].getCoordinates(),de=0;de<V.length;de++)m[++S]=V[de];return m},s.prototype.getArea=function(){for(var m=0,S=0;S<this._geometries.length;S++)m+=this._geometries[S].getArea();return m},s.prototype.equalsExact=function(){if(2===arguments.length){var m=arguments[0],S=arguments[1];if(!this.isEquivalentClass(m))return!1;var k=m;if(this._geometries.length!==k._geometries.length)return!1;for(var V=0;V<this._geometries.length;V++)if(!this._geometries[V].equalsExact(k._geometries[V],S))return!1;return!0}return r.prototype.equalsExact.apply(this,arguments)},s.prototype.normalize=function(){for(var m=0;m<this._geometries.length;m++)this._geometries[m].normalize();wt.sort(this._geometries)},s.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},s.prototype.getBoundaryDimension=function(){for(var m=Ct.FALSE,S=0;S<this._geometries.length;S++)m=Math.max(m,this._geometries[S].getBoundaryDimension());return m},s.prototype.getDimension=function(){for(var m=Ct.FALSE,S=0;S<this._geometries.length;S++)m=Math.max(m,this._geometries[S].getDimension());return m},s.prototype.getLength=function(){for(var m=0,S=0;S<this._geometries.length;S++)m+=this._geometries[S].getLength();return m},s.prototype.getNumPoints=function(){for(var m=0,S=0;S<this._geometries.length;S++)m+=this._geometries[S].getNumPoints();return m},s.prototype.getNumGeometries=function(){return this._geometries.length},s.prototype.reverse=function(){for(var S=new Array(this._geometries.length).fill(null),k=0;k<this._geometries.length;k++)S[k]=this._geometries[k].reverse();return this.getFactory().createGeometryCollection(S)},s.prototype.compareToSameClass=function(){if(1===arguments.length){var m=arguments[0],S=new Oe(wt.asList(this._geometries)),k=new Oe(wt.asList(m._geometries));return this.compare(S,k)}if(2===arguments.length){for(var de=arguments[1],Re=arguments[0],yt=this.getNumGeometries(),gt=Re.getNumGeometries(),ar=0;ar<yt&&ar<gt;){var Gr=this.getGeometryN(ar),Br=Re.getGeometryN(ar),sn=Gr.compareToSameClass(Br,de);if(0!==sn)return sn;ar++}return ar<yt?1:ar<gt?-1:0}},s.prototype.apply=function(){if(Nt(arguments[0],Jn))for(var m=arguments[0],S=0;S<this._geometries.length;S++)this._geometries[S].apply(m);else if(Nt(arguments[0],mr)){var k=arguments[0];if(0===this._geometries.length)return null;for(var V=0;V<this._geometries.length&&(this._geometries[V].apply(k),!k.isDone());V++);k.isGeometryChanged()&&this.geometryChanged()}else if(Nt(arguments[0],Rr)){var de=arguments[0];de.filter(this);for(var Re=0;Re<this._geometries.length;Re++)this._geometries[Re].apply(de)}else if(Nt(arguments[0],un)){var yt=arguments[0];yt.filter(this);for(var gt=0;gt<this._geometries.length;gt++)this._geometries[gt].apply(yt)}},s.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),ve.shouldNeverReachHere(),null},s.prototype.clone=function(){var m=r.prototype.clone.call(this);m._geometries=new Array(this._geometries.length).fill(null);for(var S=0;S<this._geometries.length;S++)m._geometries[S]=this._geometries[S].clone();return m},s.prototype.getGeometryType=function(){return"GeometryCollection"},s.prototype.copy=function(){for(var m=new Array(this._geometries.length).fill(null),S=0;S<m.length;S++)m[S]=this._geometries[S].copy();return new s(m,this._factory)},s.prototype.isEmpty=function(){for(var m=0;m<this._geometries.length;m++)if(!this._geometries[m].isEmpty())return!1;return!0},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},f.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(s,f),s}(Lr),hn=function(r){function s(){r.apply(this,arguments)}r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s;var f={serialVersionUID:{configurable:!0}};return s.prototype.getSortIndex=function(){return Lr.SORTINDEX_MULTILINESTRING},s.prototype.equalsExact=function(){if(2===arguments.length){var m=arguments[0],S=arguments[1];return!!this.isEquivalentClass(m)&&r.prototype.equalsExact.call(this,m,S)}return r.prototype.equalsExact.apply(this,arguments)},s.prototype.getBoundaryDimension=function(){return this.isClosed()?Ct.FALSE:0},s.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var m=0;m<this._geometries.length;m++)if(!this._geometries[m].isClosed())return!1;return!0},s.prototype.getDimension=function(){return 1},s.prototype.reverse=function(){for(var m=this._geometries.length,S=new Array(m).fill(null),k=0;k<this._geometries.length;k++)S[m-1-k]=this._geometries[k].reverse();return this.getFactory().createMultiLineString(S)},s.prototype.getBoundary=function(){return new en(this).getBoundary()},s.prototype.getGeometryType=function(){return"MultiLineString"},s.prototype.copy=function(){for(var m=new Array(this._geometries.length).fill(null),S=0;S<m.length;S++)m[S]=this._geometries[S].copy();return new s(m,this._factory)},s.prototype.interfaces_=function(){return[Dt]},s.prototype.getClass=function(){return s},f.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(s,f),s}(Yr),en=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var r=arguments[0],s=zn.MOD2_BOUNDARY_RULE;this._geom=r,this._geomFact=r.getFactory(),this._bnRule=s}else if(2===arguments.length){var f=arguments[0],m=arguments[1];this._geom=f,this._geomFact=f.getFactory(),this._bnRule=m}};en.prototype.boundaryMultiLineString=function(r){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var s=this.computeBoundaryCoordinates(r);return 1===s.length?this._geomFact.createPoint(s[0]):this._geomFact.createMultiPointFromCoords(s)},en.prototype.getBoundary=function(){return this._geom instanceof mn?this.boundaryLineString(this._geom):this._geom instanceof hn?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},en.prototype.boundaryLineString=function(r){return this._geom.isEmpty()?this.getEmptyMultiPoint():r.isClosed()?this._bnRule.isInBoundary(2)?r.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([r.getStartPoint(),r.getEndPoint()])},en.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},en.prototype.computeBoundaryCoordinates=function(r){var s=new Mr;this._endpointMap=new xe;for(var f=0;f<r.getNumGeometries();f++){var m=r.getGeometryN(f);0!==m.getNumPoints()&&(this.addEndpoint(m.getCoordinateN(0)),this.addEndpoint(m.getCoordinateN(m.getNumPoints()-1)))}for(var S=this._endpointMap.entrySet().iterator();S.hasNext();){var k=S.next(),V=k.getValue().count;this._bnRule.isInBoundary(V)&&s.add(k.getKey())}return Sn.toCoordinateArray(s)},en.prototype.addEndpoint=function(r){var s=this._endpointMap.get(r);null===s&&(s=new Tn,this._endpointMap.put(r,s)),s.count++},en.prototype.interfaces_=function(){return[]},en.prototype.getClass=function(){return en},en.getBoundary=function(){return 1===arguments.length?new en(arguments[0]).getBoundary():2===arguments.length?new en(arguments[0],arguments[1]).getBoundary():void 0};var Tn=function(){this.count=null};Tn.prototype.interfaces_=function(){return[]},Tn.prototype.getClass=function(){return Tn};var Dn=function(){},xi={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Dn.prototype.interfaces_=function(){return[]},Dn.prototype.getClass=function(){return Dn},Dn.chars=function(r,s){for(var f=new Array(s).fill(null),m=0;m<s;m++)f[m]=r;return String(f)},Dn.getStackTrace=function(){if(1===arguments.length){var r=arguments[0],s=new function(){},f=new function(){}(s);return r.printStackTrace(f),s.toString()}if(2===arguments.length){for(var S=arguments[1],k="",V=new function(){}(new function(){}(Dn.getStackTrace(arguments[0]))),de=0;de<S;de++)try{k+=V.readLine()+Dn.NEWLINE}catch(Re){if(!(Re instanceof We))throw Re;ve.shouldNeverReachHere()}return k}},Dn.split=function(r,s){for(var f=s.length,m=new Mr,S=""+r,k=S.indexOf(s);k>=0;){var V=S.substring(0,k);m.add(V),k=(S=S.substring(k+f)).indexOf(s)}S.length>0&&m.add(S);for(var de=new Array(m.size()).fill(null),Re=0;Re<de.length;Re++)de[Re]=m.get(Re);return de},Dn.toString=function(){if(1===arguments.length)return Dn.SIMPLE_ORDINATE_FORMAT.format(arguments[0])},Dn.spaces=function(r){return Dn.chars(" ",r)},xi.NEWLINE.get=function(){return rn.getProperty("line.separator")},xi.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(Dn,xi);var jr=function(){};jr.prototype.interfaces_=function(){return[]},jr.prototype.getClass=function(){return jr},jr.copyCoord=function(r,s,f,m){for(var S=Math.min(r.getDimension(),f.getDimension()),k=0;k<S;k++)f.setOrdinate(m,k,r.getOrdinate(s,k))},jr.isRing=function(r){var s=r.size();return 0===s||!(s<=3)&&r.getOrdinate(0,Ft.X)===r.getOrdinate(s-1,Ft.X)&&r.getOrdinate(0,Ft.Y)===r.getOrdinate(s-1,Ft.Y)},jr.isEqual=function(r,s){var f=r.size();if(f!==s.size())return!1;for(var m=Math.min(r.getDimension(),s.getDimension()),S=0;S<f;S++)for(var k=0;k<m;k++){var V=r.getOrdinate(S,k),de=s.getOrdinate(S,k);if(!(r.getOrdinate(S,k)===s.getOrdinate(S,k)||ee.isNaN(V)&&ee.isNaN(de)))return!1}return!0},jr.extend=function(r,s,f){var m=r.create(f,s.getDimension()),S=s.size();if(jr.copy(s,0,m,0,S),S>0)for(var k=S;k<f;k++)jr.copy(s,S-1,m,k,1);return m},jr.reverse=function(r){for(var s=r.size()-1,f=Math.trunc(s/2),m=0;m<=f;m++)jr.swap(r,m,s-m)},jr.swap=function(r,s,f){if(s===f)return null;for(var m=0;m<r.getDimension();m++){var S=r.getOrdinate(s,m);r.setOrdinate(s,m,r.getOrdinate(f,m)),r.setOrdinate(f,m,S)}},jr.copy=function(r,s,f,m,S){for(var k=0;k<S;k++)jr.copyCoord(r,s+k,f,m+k)},jr.toString=function(){if(1===arguments.length){var r=arguments[0],s=r.size();if(0===s)return"()";var f=r.getDimension(),m=new Ae;m.append("(");for(var S=0;S<s;S++){S>0&&m.append(" ");for(var k=0;k<f;k++)k>0&&m.append(","),m.append(Dn.toString(r.getOrdinate(S,k)))}return m.append(")"),m.toString()}},jr.ensureValidRing=function(r,s){var f=s.size();return 0===f?s:f<=3?jr.createClosedRing(r,s,4):s.getOrdinate(0,Ft.X)===s.getOrdinate(f-1,Ft.X)&&s.getOrdinate(0,Ft.Y)===s.getOrdinate(f-1,Ft.Y)?s:jr.createClosedRing(r,s,f+1)},jr.createClosedRing=function(r,s,f){var m=r.create(f,s.getDimension()),S=s.size();jr.copy(s,0,m,0,S);for(var k=S;k<f;k++)jr.copy(s,0,m,k,1);return m};var mn=function(r){function s(m,S){r.call(this,S),this._points=null,this.init(m)}r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s;var f={serialVersionUID:{configurable:!0}};return s.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new xr:this._points.expandEnvelope(new xr)},s.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},s.prototype.getSortIndex=function(){return r.SORTINDEX_LINESTRING},s.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},s.prototype.equalsExact=function(){if(2===arguments.length){var m=arguments[0],S=arguments[1];if(!this.isEquivalentClass(m))return!1;var k=m;if(this._points.size()!==k._points.size())return!1;for(var V=0;V<this._points.size();V++)if(!this.equal(this._points.getCoordinate(V),k._points.getCoordinate(V),S))return!1;return!0}return r.prototype.equalsExact.apply(this,arguments)},s.prototype.normalize=function(){for(var m=0;m<Math.trunc(this._points.size()/2);m++){var S=this._points.size()-1-m;if(!this._points.getCoordinate(m).equals(this._points.getCoordinate(S)))return this._points.getCoordinate(m).compareTo(this._points.getCoordinate(S))>0&&jr.reverse(this._points),null}},s.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},s.prototype.getBoundaryDimension=function(){return this.isClosed()?Ct.FALSE:0},s.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},s.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},s.prototype.getDimension=function(){return 1},s.prototype.getLength=function(){return rr.computeLength(this._points)},s.prototype.getNumPoints=function(){return this._points.size()},s.prototype.reverse=function(){var m=this._points.copy();return jr.reverse(m),this.getFactory().createLineString(m)},s.prototype.compareToSameClass=function(){if(1===arguments.length){for(var m=arguments[0],S=0,k=0;S<this._points.size()&&k<m._points.size();){var V=this._points.getCoordinate(S).compareTo(m._points.getCoordinate(k));if(0!==V)return V;S++,k++}return S<this._points.size()?1:k<m._points.size()?-1:0}if(2===arguments.length)return arguments[1].compare(this._points,arguments[0]._points)},s.prototype.apply=function(){if(Nt(arguments[0],Jn))for(var m=arguments[0],S=0;S<this._points.size();S++)m.filter(this._points.getCoordinate(S));else if(Nt(arguments[0],mr)){var k=arguments[0];if(0===this._points.size())return null;for(var V=0;V<this._points.size()&&(k.filter(this._points,V),!k.isDone());V++);k.isGeometryChanged()&&this.geometryChanged()}else(Nt(arguments[0],Rr)||Nt(arguments[0],un))&&arguments[0].filter(this)},s.prototype.getBoundary=function(){return new en(this).getBoundary()},s.prototype.isEquivalentClass=function(m){return m instanceof s},s.prototype.clone=function(){var m=r.prototype.clone.call(this);return m._points=this._points.clone(),m},s.prototype.getCoordinateN=function(m){return this._points.getCoordinate(m)},s.prototype.getGeometryType=function(){return"LineString"},s.prototype.copy=function(){return new s(this._points.copy(),this._factory)},s.prototype.getCoordinateSequence=function(){return this._points},s.prototype.isEmpty=function(){return 0===this._points.size()},s.prototype.init=function(m){if(null===m&&(m=this.getFactory().getCoordinateSequenceFactory().create([])),1===m.size())throw new X("Invalid number of points in LineString (found "+m.size()+" - must be 0 or >= 2)");this._points=m},s.prototype.isCoordinate=function(m){for(var S=0;S<this._points.size();S++)if(this._points.getCoordinate(S).equals(m))return!0;return!1},s.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},s.prototype.getPointN=function(m){return this.getFactory().createPoint(this._points.getCoordinate(m))},s.prototype.interfaces_=function(){return[Dt]},s.prototype.getClass=function(){return s},f.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(s,f),s}(Lr),ro=function(){};ro.prototype.interfaces_=function(){return[]},ro.prototype.getClass=function(){return ro};var Ho=function(r){function s(m,S){r.call(this,S),this._coordinates=m||null,this.init(this._coordinates)}r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s;var f={serialVersionUID:{configurable:!0}};return s.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new xr;var m=new xr;return m.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),m},s.prototype.getSortIndex=function(){return r.SORTINDEX_POINT},s.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},s.prototype.equalsExact=function(){if(2===arguments.length){var m=arguments[0],S=arguments[1];return!!this.isEquivalentClass(m)&&(!(!this.isEmpty()||!m.isEmpty())||this.isEmpty()===m.isEmpty()&&this.equal(m.getCoordinate(),this.getCoordinate(),S))}return r.prototype.equalsExact.apply(this,arguments)},s.prototype.normalize=function(){},s.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},s.prototype.getBoundaryDimension=function(){return Ct.FALSE},s.prototype.getDimension=function(){return 0},s.prototype.getNumPoints=function(){return this.isEmpty()?0:1},s.prototype.reverse=function(){return this.copy()},s.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},s.prototype.compareToSameClass=function(){if(1===arguments.length){var m=arguments[0];return this.getCoordinate().compareTo(m.getCoordinate())}if(2===arguments.length)return arguments[1].compare(this._coordinates,arguments[0]._coordinates)},s.prototype.apply=function(){if(Nt(arguments[0],Jn)){var m=arguments[0];if(this.isEmpty())return null;m.filter(this.getCoordinate())}else if(Nt(arguments[0],mr)){var S=arguments[0];if(this.isEmpty())return null;S.filter(this._coordinates,0),S.isGeometryChanged()&&this.geometryChanged()}else(Nt(arguments[0],Rr)||Nt(arguments[0],un))&&arguments[0].filter(this)},s.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},s.prototype.clone=function(){var m=r.prototype.clone.call(this);return m._coordinates=this._coordinates.clone(),m},s.prototype.getGeometryType=function(){return"Point"},s.prototype.copy=function(){return new s(this._coordinates.copy(),this._factory)},s.prototype.getCoordinateSequence=function(){return this._coordinates},s.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},s.prototype.isEmpty=function(){return 0===this._coordinates.size()},s.prototype.init=function(m){null===m&&(m=this.getFactory().getCoordinateSequenceFactory().create([])),ve.isTrue(m.size()<=1),this._coordinates=m},s.prototype.isSimple=function(){return!0},s.prototype.interfaces_=function(){return[ro]},s.prototype.getClass=function(){return s},f.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(s,f),s}(Lr),Ts=function(){};Ts.prototype.interfaces_=function(){return[]},Ts.prototype.getClass=function(){return Ts};var ki=function(r){function s(m,S,k){if(r.call(this,k),this._shell=null,this._holes=null,null===m&&(m=this.getFactory().createLinearRing()),null===S&&(S=[]),r.hasNullElements(S))throw new X("holes must not contain null elements");if(m.isEmpty()&&r.hasNonEmptyElements(S))throw new X("shell is empty but holes are not");this._shell=m,this._holes=S}r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s;var f={serialVersionUID:{configurable:!0}};return s.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},s.prototype.getSortIndex=function(){return r.SORTINDEX_POLYGON},s.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var m=new Array(this.getNumPoints()).fill(null),S=-1,k=this._shell.getCoordinates(),V=0;V<k.length;V++)m[++S]=k[V];for(var de=0;de<this._holes.length;de++)for(var Re=this._holes[de].getCoordinates(),yt=0;yt<Re.length;yt++)m[++S]=Re[yt];return m},s.prototype.getArea=function(){var m=0;m+=Math.abs(rr.signedArea(this._shell.getCoordinateSequence()));for(var S=0;S<this._holes.length;S++)m-=Math.abs(rr.signedArea(this._holes[S].getCoordinateSequence()));return m},s.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing()||null===this._shell||5!==this._shell.getNumPoints())return!1;for(var m=this._shell.getCoordinateSequence(),S=this.getEnvelopeInternal(),k=0;k<5;k++){var V=m.getX(k);if(V!==S.getMinX()&&V!==S.getMaxX())return!1;var de=m.getY(k);if(de!==S.getMinY()&&de!==S.getMaxY())return!1}for(var Re=m.getX(0),yt=m.getY(0),gt=1;gt<=4;gt++){var ar=m.getX(gt),Gr=m.getY(gt);if(ar!==Re==(Gr!==yt))return!1;Re=ar,yt=Gr}return!0},s.prototype.equalsExact=function(){if(2===arguments.length){var m=arguments[0],S=arguments[1];if(!this.isEquivalentClass(m))return!1;var k=m;if(!this._shell.equalsExact(k._shell,S)||this._holes.length!==k._holes.length)return!1;for(var Re=0;Re<this._holes.length;Re++)if(!this._holes[Re].equalsExact(k._holes[Re],S))return!1;return!0}return r.prototype.equalsExact.apply(this,arguments)},s.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var m=0;m<this._holes.length;m++)this.normalize(this._holes[m],!1);wt.sort(this._holes)}else if(2===arguments.length){var S=arguments[0],k=arguments[1];if(S.isEmpty())return null;var V=new Array(S.getCoordinates().length-1).fill(null);rn.arraycopy(S.getCoordinates(),0,V,0,V.length);var de=Sn.minCoordinate(S.getCoordinates());Sn.scroll(V,de),rn.arraycopy(V,0,S.getCoordinates(),0,V.length),S.getCoordinates()[V.length]=V[0],rr.isCCW(S.getCoordinates())===k&&Sn.reverse(S.getCoordinates())}},s.prototype.getCoordinate=function(){return this._shell.getCoordinate()},s.prototype.getNumInteriorRing=function(){return this._holes.length},s.prototype.getBoundaryDimension=function(){return 1},s.prototype.getDimension=function(){return 2},s.prototype.getLength=function(){var m=0;m+=this._shell.getLength();for(var S=0;S<this._holes.length;S++)m+=this._holes[S].getLength();return m},s.prototype.getNumPoints=function(){for(var m=this._shell.getNumPoints(),S=0;S<this._holes.length;S++)m+=this._holes[S].getNumPoints();return m},s.prototype.reverse=function(){var m=this.copy();m._shell=this._shell.copy().reverse(),m._holes=new Array(this._holes.length).fill(null);for(var S=0;S<this._holes.length;S++)m._holes[S]=this._holes[S].copy().reverse();return m},s.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},s.prototype.compareToSameClass=function(){if(1===arguments.length)return this._shell.compareToSameClass(arguments[0]._shell);if(2===arguments.length){var de=arguments[1],Re=arguments[0],ar=this._shell.compareToSameClass(Re._shell,de);if(0!==ar)return ar;for(var Gr=this.getNumInteriorRing(),Br=Re.getNumInteriorRing(),sn=0;sn<Gr&&sn<Br;){var Mn=this.getInteriorRingN(sn),no=Re.getInteriorRingN(sn),ls=Mn.compareToSameClass(no,de);if(0!==ls)return ls;sn++}return sn<Gr?1:sn<Br?-1:0}},s.prototype.apply=function(m){if(Nt(m,Jn)){this._shell.apply(m);for(var S=0;S<this._holes.length;S++)this._holes[S].apply(m)}else if(Nt(m,mr)){if(this._shell.apply(m),!m.isDone())for(var k=0;k<this._holes.length&&(this._holes[k].apply(m),!m.isDone());k++);m.isGeometryChanged()&&this.geometryChanged()}else if(Nt(m,Rr))m.filter(this);else if(Nt(m,un)){m.filter(this),this._shell.apply(m);for(var V=0;V<this._holes.length;V++)this._holes[V].apply(m)}},s.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var m=new Array(this._holes.length+1).fill(null);m[0]=this._shell;for(var S=0;S<this._holes.length;S++)m[S+1]=this._holes[S];return m.length<=1?this.getFactory().createLinearRing(m[0].getCoordinateSequence()):this.getFactory().createMultiLineString(m)},s.prototype.clone=function(){var m=r.prototype.clone.call(this);m._shell=this._shell.clone(),m._holes=new Array(this._holes.length).fill(null);for(var S=0;S<this._holes.length;S++)m._holes[S]=this._holes[S].clone();return m},s.prototype.getGeometryType=function(){return"Polygon"},s.prototype.copy=function(){for(var m=this._shell.copy(),S=new Array(this._holes.length).fill(null),k=0;k<S.length;k++)S[k]=this._holes[k].copy();return new s(m,S,this._factory)},s.prototype.getExteriorRing=function(){return this._shell},s.prototype.isEmpty=function(){return this._shell.isEmpty()},s.prototype.getInteriorRingN=function(m){return this._holes[m]},s.prototype.interfaces_=function(){return[Ts]},s.prototype.getClass=function(){return s},f.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(s,f),s}(Lr),ur=function(r){function s(){r.apply(this,arguments)}r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s;var f={serialVersionUID:{configurable:!0}};return s.prototype.getSortIndex=function(){return Lr.SORTINDEX_MULTIPOINT},s.prototype.isValid=function(){return!0},s.prototype.equalsExact=function(){if(2===arguments.length){var m=arguments[0],S=arguments[1];return!!this.isEquivalentClass(m)&&r.prototype.equalsExact.call(this,m,S)}return r.prototype.equalsExact.apply(this,arguments)},s.prototype.getCoordinate=function(){return 1===arguments.length?this._geometries[arguments[0]].getCoordinate():r.prototype.getCoordinate.apply(this,arguments)},s.prototype.getBoundaryDimension=function(){return Ct.FALSE},s.prototype.getDimension=function(){return 0},s.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},s.prototype.getGeometryType=function(){return"MultiPoint"},s.prototype.copy=function(){for(var m=new Array(this._geometries.length).fill(null),S=0;S<m.length;S++)m[S]=this._geometries[S].copy();return new s(m,this._factory)},s.prototype.interfaces_=function(){return[ro]},s.prototype.getClass=function(){return s},f.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(s,f),s}(Yr),hs=function(r){function s(m,S){m instanceof re&&S instanceof $n&&(m=S.getCoordinateSequenceFactory().create(m)),r.call(this,m,S),this.validateConstruction()}r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s;var f={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return s.prototype.getSortIndex=function(){return Lr.SORTINDEX_LINEARRING},s.prototype.getBoundaryDimension=function(){return Ct.FALSE},s.prototype.isClosed=function(){return!!this.isEmpty()||r.prototype.isClosed.call(this)},s.prototype.reverse=function(){var m=this._points.copy();return jr.reverse(m),this.getFactory().createLinearRing(m)},s.prototype.validateConstruction=function(){if(!this.isEmpty()&&!r.prototype.isClosed.call(this))throw new X("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<s.MINIMUM_VALID_SIZE)throw new X("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},s.prototype.getGeometryType=function(){return"LinearRing"},s.prototype.copy=function(){return new s(this._points.copy(),this._factory)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},f.MINIMUM_VALID_SIZE.get=function(){return 4},f.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(s,f),s}(mn),Kn=function(r){function s(){r.apply(this,arguments)}r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s;var f={serialVersionUID:{configurable:!0}};return s.prototype.getSortIndex=function(){return Lr.SORTINDEX_MULTIPOLYGON},s.prototype.equalsExact=function(){if(2===arguments.length){var m=arguments[0],S=arguments[1];return!!this.isEquivalentClass(m)&&r.prototype.equalsExact.call(this,m,S)}return r.prototype.equalsExact.apply(this,arguments)},s.prototype.getBoundaryDimension=function(){return 1},s.prototype.getDimension=function(){return 2},s.prototype.reverse=function(){for(var S=new Array(this._geometries.length).fill(null),k=0;k<this._geometries.length;k++)S[k]=this._geometries[k].reverse();return this.getFactory().createMultiPolygon(S)},s.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var m=new Mr,S=0;S<this._geometries.length;S++)for(var k=this._geometries[S].getBoundary(),V=0;V<k.getNumGeometries();V++)m.add(k.getGeometryN(V));var de=new Array(m.size()).fill(null);return this.getFactory().createMultiLineString(m.toArray(de))},s.prototype.getGeometryType=function(){return"MultiPolygon"},s.prototype.copy=function(){for(var m=new Array(this._geometries.length).fill(null),S=0;S<m.length;S++)m[S]=this._geometries[S].copy();return new s(m,this._factory)},s.prototype.interfaces_=function(){return[Ts]},s.prototype.getClass=function(){return s},f.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(s,f),s}(Yr),Jo=function(r){this._factory=r||null,this._isUserDataCopied=!1},Ou={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Jo.prototype.setCopyUserData=function(r){this._isUserDataCopied=r},Jo.prototype.edit=function(r,s){if(null===r)return null;var f=this.editInternal(r,s);return this._isUserDataCopied&&f.setUserData(r.getUserData()),f},Jo.prototype.editInternal=function(r,s){return null===this._factory&&(this._factory=r.getFactory()),r instanceof Yr?this.editGeometryCollection(r,s):r instanceof ki?this.editPolygon(r,s):r instanceof Ho||r instanceof mn?s.edit(r,this._factory):(ve.shouldNeverReachHere("Unsupported Geometry class: "+r.getClass().getName()),null)},Jo.prototype.editGeometryCollection=function(r,s){for(var f=s.edit(r,this._factory),m=new Mr,S=0;S<f.getNumGeometries();S++){var k=this.edit(f.getGeometryN(S),s);null===k||k.isEmpty()||m.add(k)}return f.getClass()===ur?this._factory.createMultiPoint(m.toArray([])):f.getClass()===hn?this._factory.createMultiLineString(m.toArray([])):f.getClass()===Kn?this._factory.createMultiPolygon(m.toArray([])):this._factory.createGeometryCollection(m.toArray([]))},Jo.prototype.editPolygon=function(r,s){var f=s.edit(r,this._factory);if(null===f&&(f=this._factory.createPolygon(null)),f.isEmpty())return f;var m=this.edit(f.getExteriorRing(),s);if(null===m||m.isEmpty())return this._factory.createPolygon();for(var S=new Mr,k=0;k<f.getNumInteriorRing();k++){var V=this.edit(f.getInteriorRingN(k),s);null===V||V.isEmpty()||S.add(V)}return this._factory.createPolygon(m,S.toArray([]))},Jo.prototype.interfaces_=function(){return[]},Jo.prototype.getClass=function(){return Jo},Jo.GeometryEditorOperation=function(){},Ou.NoOpGeometryOperation.get=function(){return Ko},Ou.CoordinateOperation.get=function(){return ks},Ou.CoordinateSequenceOperation.get=function(){return Pl},Object.defineProperties(Jo,Ou);var Ko=function(){};Ko.prototype.edit=function(r,s){return r},Ko.prototype.interfaces_=function(){return[Jo.GeometryEditorOperation]},Ko.prototype.getClass=function(){return Ko};var ks=function(){};ks.prototype.edit=function(r,s){var f=this.editCoordinates(r.getCoordinates(),r);return null===f?r:r instanceof hs?s.createLinearRing(f):r instanceof mn?s.createLineString(f):r instanceof Ho?f.length>0?s.createPoint(f[0]):s.createPoint():r},ks.prototype.interfaces_=function(){return[Jo.GeometryEditorOperation]},ks.prototype.getClass=function(){return ks};var Pl=function(){};Pl.prototype.edit=function(r,s){return r instanceof hs?s.createLinearRing(this.edit(r.getCoordinateSequence(),r)):r instanceof mn?s.createLineString(this.edit(r.getCoordinateSequence(),r)):r instanceof Ho?s.createPoint(this.edit(r.getCoordinateSequence(),r)):r},Pl.prototype.interfaces_=function(){return[Jo.GeometryEditorOperation]},Pl.prototype.getClass=function(){return Pl};var oi=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var r=arguments[0];this._coordinates=new Array(r).fill(null);for(var s=0;s<r;s++)this._coordinates[s]=new re}else if(Nt(arguments[0],Ft)){var f=arguments[0];if(null===f)return this._coordinates=new Array(0).fill(null),null;this._dimension=f.getDimension(),this._coordinates=new Array(f.size()).fill(null);for(var m=0;m<this._coordinates.length;m++)this._coordinates[m]=f.getCoordinateCopy(m)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var S=arguments[0],k=arguments[1];this._coordinates=S,this._dimension=k,null===S&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var V=arguments[0],de=arguments[1];this._coordinates=new Array(V).fill(null),this._dimension=de;for(var Re=0;Re<V;Re++)this._coordinates[Re]=new re}},Nr={serialVersionUID:{configurable:!0}};oi.prototype.setOrdinate=function(r,s,f){switch(s){case Ft.X:this._coordinates[r].x=f;break;case Ft.Y:this._coordinates[r].y=f;break;case Ft.Z:this._coordinates[r].z=f;break;default:throw new X("invalid ordinateIndex")}},oi.prototype.size=function(){return this._coordinates.length},oi.prototype.getOrdinate=function(r,s){switch(s){case Ft.X:return this._coordinates[r].x;case Ft.Y:return this._coordinates[r].y;case Ft.Z:return this._coordinates[r].z}return ee.NaN},oi.prototype.getCoordinate=function(){if(1===arguments.length)return this._coordinates[arguments[0]];if(2===arguments.length){var s=arguments[0],f=arguments[1];f.x=this._coordinates[s].x,f.y=this._coordinates[s].y,f.z=this._coordinates[s].z}},oi.prototype.getCoordinateCopy=function(r){return new re(this._coordinates[r])},oi.prototype.getDimension=function(){return this._dimension},oi.prototype.getX=function(r){return this._coordinates[r].x},oi.prototype.clone=function(){for(var r=new Array(this.size()).fill(null),s=0;s<this._coordinates.length;s++)r[s]=this._coordinates[s].clone();return new oi(r,this._dimension)},oi.prototype.expandEnvelope=function(r){for(var s=0;s<this._coordinates.length;s++)r.expandToInclude(this._coordinates[s]);return r},oi.prototype.copy=function(){for(var r=new Array(this.size()).fill(null),s=0;s<this._coordinates.length;s++)r[s]=this._coordinates[s].copy();return new oi(r,this._dimension)},oi.prototype.toString=function(){if(this._coordinates.length>0){var r=new Ae(17*this._coordinates.length);r.append("("),r.append(this._coordinates[0]);for(var s=1;s<this._coordinates.length;s++)r.append(", "),r.append(this._coordinates[s]);return r.append(")"),r.toString()}return"()"},oi.prototype.getY=function(r){return this._coordinates[r].y},oi.prototype.toCoordinateArray=function(){return this._coordinates},oi.prototype.interfaces_=function(){return[Ft,ae]},oi.prototype.getClass=function(){return oi},Nr.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(oi,Nr);var Vn=function(){},ai={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Vn.prototype.readResolve=function(){return Vn.instance()},Vn.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new oi(arguments[0]);if(Nt(arguments[0],Ft))return new oi(arguments[0])}else if(2===arguments.length){var f=arguments[0],m=arguments[1];return m>3&&(m=3),m<2?new oi(f):new oi(f,m)}},Vn.prototype.interfaces_=function(){return[Ze,ae]},Vn.prototype.getClass=function(){return Vn},Vn.instance=function(){return Vn.instanceObject},ai.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},ai.instanceObject.get=function(){return new Vn},Object.defineProperties(Vn,ai);var Ws=function(r){function s(){r.call(this),this.map_=new Map}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.get=function(f){return this.map_.get(f)||null},s.prototype.put=function(f,m){return this.map_.set(f,m),m},s.prototype.values=function(){for(var f=new Mr,m=this.map_.values(),S=m.next();!S.done;)f.add(S.value),S=m.next();return f},s.prototype.entrySet=function(){var f=new qe;return this.map_.entries().forEach(function(m){return f.add(m)}),f},s.prototype.size=function(){return this.map_.size()},s}(le),hi=function r(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=r.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof va){var s=arguments[0];this._modelType=s,s===r.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var f=arguments[0];this._modelType=r.FIXED,this.setScale(f)}else if(arguments[0]instanceof r){var m=arguments[0];this._modelType=m._modelType,this._scale=m._scale}},ri={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};hi.prototype.equals=function(r){return r instanceof hi&&this._modelType===r._modelType&&this._scale===r._scale},hi.prototype.compareTo=function(r){var s=r,f=this.getMaximumSignificantDigits(),m=s.getMaximumSignificantDigits();return new pt(f).compareTo(new pt(m))},hi.prototype.getScale=function(){return this._scale},hi.prototype.isFloating=function(){return this._modelType===hi.FLOATING||this._modelType===hi.FLOATING_SINGLE},hi.prototype.getType=function(){return this._modelType},hi.prototype.toString=function(){var r="UNKNOWN";return this._modelType===hi.FLOATING?r="Floating":this._modelType===hi.FLOATING_SINGLE?r="Floating-Single":this._modelType===hi.FIXED&&(r="Fixed (Scale="+this.getScale()+")"),r},hi.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var r=arguments[0];return ee.isNaN(r)||this._modelType===hi.FLOATING_SINGLE?r:this._modelType===hi.FIXED?Math.round(r*this._scale)/this._scale:r}if(arguments[0]instanceof re){var s=arguments[0];if(this._modelType===hi.FLOATING)return null;s.x=this.makePrecise(s.x),s.y=this.makePrecise(s.y)}},hi.prototype.getMaximumSignificantDigits=function(){var r=16;return this._modelType===hi.FLOATING?r=16:this._modelType===hi.FLOATING_SINGLE?r=6:this._modelType===hi.FIXED&&(r=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),r},hi.prototype.setScale=function(r){this._scale=Math.abs(r)},hi.prototype.interfaces_=function(){return[ae,ne]},hi.prototype.getClass=function(){return hi},hi.mostPrecise=function(r,s){return r.compareTo(s)>=0?r:s},ri.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},ri.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(hi,ri);var va=function r(s){this._name=s||null,r.nameToTypeMap.put(s,this)},zl={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};va.prototype.readResolve=function(){return va.nameToTypeMap.get(this._name)},va.prototype.toString=function(){return this._name},va.prototype.interfaces_=function(){return[ae]},va.prototype.getClass=function(){return va},zl.serialVersionUID.get=function(){return-552860263173159e4},zl.nameToTypeMap.get=function(){return new Ws},Object.defineProperties(va,zl),hi.Type=va,hi.FIXED=new va("FIXED"),hi.FLOATING=new va("FLOATING"),hi.FLOATING_SINGLE=new va("FLOATING SINGLE");var $n=function r(){this._precisionModel=new hi,this._SRID=0,this._coordinateSequenceFactory=r.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?Nt(arguments[0],Ze)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof hi&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},Hs={serialVersionUID:{configurable:!0}};$n.prototype.toGeometry=function(r){return r.isNull()?this.createPoint(null):r.getMinX()===r.getMaxX()&&r.getMinY()===r.getMaxY()?this.createPoint(new re(r.getMinX(),r.getMinY())):r.getMinX()===r.getMaxX()||r.getMinY()===r.getMaxY()?this.createLineString([new re(r.getMinX(),r.getMinY()),new re(r.getMaxX(),r.getMaxY())]):this.createPolygon(this.createLinearRing([new re(r.getMinX(),r.getMinY()),new re(r.getMinX(),r.getMaxY()),new re(r.getMaxX(),r.getMaxY()),new re(r.getMaxX(),r.getMinY()),new re(r.getMinX(),r.getMinY())]),null)},$n.prototype.createLineString=function(r){return r?r instanceof Array?new mn(this.getCoordinateSequenceFactory().create(r),this):Nt(r,Ft)?new mn(r,this):void 0:new mn(this.getCoordinateSequenceFactory().create([]),this)},$n.prototype.createMultiLineString=function(){return 0===arguments.length?new hn(null,this):1===arguments.length?new hn(arguments[0],this):void 0},$n.prototype.buildGeometry=function(r){for(var s=null,f=!1,m=!1,S=r.iterator();S.hasNext();){var k=S.next(),V=k.getClass();null===s&&(s=V),V!==s&&(f=!0),k.isGeometryCollectionOrDerived()&&(m=!0)}if(null===s)return this.createGeometryCollection();if(f||m)return this.createGeometryCollection($n.toGeometryArray(r));var de=r.iterator().next();if(r.size()>1){if(de instanceof ki)return this.createMultiPolygon($n.toPolygonArray(r));if(de instanceof mn)return this.createMultiLineString($n.toLineStringArray(r));if(de instanceof Ho)return this.createMultiPoint($n.toPointArray(r));ve.shouldNeverReachHere("Unhandled class: "+de.getClass().getName())}return de},$n.prototype.createMultiPointFromCoords=function(r){return this.createMultiPoint(null!==r?this.getCoordinateSequenceFactory().create(r):null)},$n.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof re){var r=arguments[0];return this.createPoint(null!==r?this.getCoordinateSequenceFactory().create([r]):null)}if(Nt(arguments[0],Ft))return new Ho(arguments[0],this)}},$n.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},$n.prototype.createPolygon=function(){if(0===arguments.length)return new ki(null,null,this);if(1===arguments.length){if(Nt(arguments[0],Ft))return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Array)return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof hs)return this.createPolygon(arguments[0],null)}else if(2===arguments.length)return new ki(arguments[0],arguments[1],this)},$n.prototype.getSRID=function(){return this._SRID},$n.prototype.createGeometryCollection=function(){return 0===arguments.length?new Yr(null,this):1===arguments.length?new Yr(arguments[0],this):void 0},$n.prototype.createGeometry=function(r){return new Jo(this).edit(r,{edit:function(){if(2===arguments.length)return this._coordinateSequenceFactory.create(arguments[0])}})},$n.prototype.getPrecisionModel=function(){return this._precisionModel},$n.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var r=arguments[0];return this.createLinearRing(null!==r?this.getCoordinateSequenceFactory().create(r):null)}if(Nt(arguments[0],Ft))return new hs(arguments[0],this)}},$n.prototype.createMultiPolygon=function(){return 0===arguments.length?new Kn(null,this):1===arguments.length?new Kn(arguments[0],this):void 0},$n.prototype.createMultiPoint=function(){if(0===arguments.length)return new ur(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new ur(arguments[0],this);if(arguments[0]instanceof Array){var s=arguments[0];return this.createMultiPoint(null!==s?this.getCoordinateSequenceFactory().create(s):null)}if(Nt(arguments[0],Ft)){var f=arguments[0];if(null===f)return this.createMultiPoint(new Array(0).fill(null));for(var m=new Array(f.size()).fill(null),S=0;S<f.size();S++){var k=this.getCoordinateSequenceFactory().create(1,f.getDimension());jr.copy(f,S,k,0,1),m[S]=this.createPoint(k)}return this.createMultiPoint(m)}}},$n.prototype.interfaces_=function(){return[ae]},$n.prototype.getClass=function(){return $n},$n.toMultiPolygonArray=function(r){var s=new Array(r.size()).fill(null);return r.toArray(s)},$n.toGeometryArray=function(r){if(null===r)return null;var s=new Array(r.size()).fill(null);return r.toArray(s)},$n.getDefaultCoordinateSequenceFactory=function(){return Vn.instance()},$n.toMultiLineStringArray=function(r){var s=new Array(r.size()).fill(null);return r.toArray(s)},$n.toLineStringArray=function(r){var s=new Array(r.size()).fill(null);return r.toArray(s)},$n.toMultiPointArray=function(r){var s=new Array(r.size()).fill(null);return r.toArray(s)},$n.toLinearRingArray=function(r){var s=new Array(r.size()).fill(null);return r.toArray(s)},$n.toPointArray=function(r){var s=new Array(r.size()).fill(null);return r.toArray(s)},$n.toPolygonArray=function(r){var s=new Array(r.size()).fill(null);return r.toArray(s)},$n.createPointFromInternalCoord=function(r,s){return s.getPrecisionModel().makePrecise(r),s.getFactory().createPoint(r)},Hs.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties($n,Hs);var Eo=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],R=function(r){this.geometryFactory=r||new $n};R.prototype.read=function(r){var s,f=(s="string"==typeof r?JSON.parse(r):r).type;if(!W[f])throw new Error("Unknown GeoJSON type: "+s.type);return-1!==Eo.indexOf(f)?W[f].apply(this,[s.coordinates]):W[f].apply(this,"GeometryCollection"===f?[s.geometries]:[s])},R.prototype.write=function(r){var s=r.getGeometryType();if(!Ce[s])throw new Error("Geometry is not supported");return Ce[s].apply(this,[r])};var W={Feature:function(r){var s={};for(var f in r)s[f]=r[f];if(r.geometry){if(!W[r.geometry.type])throw new Error("Unknown GeoJSON type: "+r.type);s.geometry=this.read(r.geometry)}return r.bbox&&(s.bbox=W.bbox.apply(this,[r.bbox])),s},FeatureCollection:function(r){var s={};if(r.features){s.features=[];for(var f=0;f<r.features.length;++f)s.features.push(this.read(r.features[f]))}return r.bbox&&(s.bbox=this.parse.bbox.apply(this,[r.bbox])),s},coordinates:function(r){for(var s=[],f=0;f<r.length;++f){var m=r[f];s.push(new re(m[0],m[1]))}return s},bbox:function(r){return this.geometryFactory.createLinearRing([new re(r[0],r[1]),new re(r[2],r[1]),new re(r[2],r[3]),new re(r[0],r[3]),new re(r[0],r[1])])},Point:function(r){var s=new re(r[0],r[1]);return this.geometryFactory.createPoint(s)},MultiPoint:function(r){for(var s=[],f=0;f<r.length;++f)s.push(W.Point.apply(this,[r[f]]));return this.geometryFactory.createMultiPoint(s)},LineString:function(r){var s=W.coordinates.apply(this,[r]);return this.geometryFactory.createLineString(s)},MultiLineString:function(r){for(var s=[],f=0;f<r.length;++f)s.push(W.LineString.apply(this,[r[f]]));return this.geometryFactory.createMultiLineString(s)},Polygon:function(r){for(var s=W.coordinates.apply(this,[r[0]]),f=this.geometryFactory.createLinearRing(s),m=[],S=1;S<r.length;++S){var V=W.coordinates.apply(this,[r[S]]),de=this.geometryFactory.createLinearRing(V);m.push(de)}return this.geometryFactory.createPolygon(f,m)},MultiPolygon:function(r){for(var s=[],f=0;f<r.length;++f)s.push(W.Polygon.apply(this,[r[f]]));return this.geometryFactory.createMultiPolygon(s)},GeometryCollection:function(r){for(var s=[],f=0;f<r.length;++f)s.push(this.read(r[f]));return this.geometryFactory.createGeometryCollection(s)}},Ce={coordinate:function(r){return[r.x,r.y]},Point:function(r){return{type:"Point",coordinates:Ce.coordinate.apply(this,[r.getCoordinate()])}},MultiPoint:function(r){for(var s=[],f=0;f<r._geometries.length;++f){var S=Ce.Point.apply(this,[r._geometries[f]]);s.push(S.coordinates)}return{type:"MultiPoint",coordinates:s}},LineString:function(r){for(var s=[],f=r.getCoordinates(),m=0;m<f.length;++m)s.push(Ce.coordinate.apply(this,[f[m]]));return{type:"LineString",coordinates:s}},MultiLineString:function(r){for(var s=[],f=0;f<r._geometries.length;++f){var S=Ce.LineString.apply(this,[r._geometries[f]]);s.push(S.coordinates)}return{type:"MultiLineString",coordinates:s}},Polygon:function(r){var s=[],f=Ce.LineString.apply(this,[r._shell]);s.push(f.coordinates);for(var m=0;m<r._holes.length;++m){var k=Ce.LineString.apply(this,[r._holes[m]]);s.push(k.coordinates)}return{type:"Polygon",coordinates:s}},MultiPolygon:function(r){for(var s=[],f=0;f<r._geometries.length;++f){var S=Ce.Polygon.apply(this,[r._geometries[f]]);s.push(S.coordinates)}return{type:"MultiPolygon",coordinates:s}},GeometryCollection:function(r){for(var s=[],f=0;f<r._geometries.length;++f){var m=r._geometries[f],S=m.getGeometryType();s.push(Ce[S].apply(this,[m]))}return{type:"GeometryCollection",geometries:s}}},Et=function(r){this.geometryFactory=r||new $n,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new R(this.geometryFactory)};Et.prototype.read=function(r){var s=this.parser.read(r);return this.precisionModel.getType()===hi.FIXED&&this.reducePrecision(s),s},Et.prototype.reducePrecision=function(r){var s,f;if(r.coordinate)this.precisionModel.makePrecise(r.coordinate);else if(r.points)for(s=0,f=r.points.length;s<f;s++)this.precisionModel.makePrecise(r.points[s]);else if(r.geometries)for(s=0,f=r.geometries.length;s<f;s++)this.reducePrecision(r.geometries[s])};var Gt=function(){this.parser=new R(this.geometryFactory)};Gt.prototype.write=function(r){return this.parser.write(r)};var et=function(){},Bt={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};et.prototype.interfaces_=function(){return[]},et.prototype.getClass=function(){return et},et.opposite=function(r){return r===et.LEFT?et.RIGHT:r===et.RIGHT?et.LEFT:r},Bt.ON.get=function(){return 0},Bt.LEFT.get=function(){return 1},Bt.RIGHT.get=function(){return 2},Object.defineProperties(et,Bt),(H.prototype=new Error).name="EmptyStackException",(q.prototype=new Bn).add=function(r){return this.array_.push(r),!0},q.prototype.get=function(r){if(r<0||r>=this.size())throw new Error;return this.array_[r]},q.prototype.push=function(r){return this.array_.push(r),r},q.prototype.pop=function(r){if(0===this.array_.length)throw new H;return this.array_.pop()},q.prototype.peek=function(){if(0===this.array_.length)throw new H;return this.array_[this.array_.length-1]},q.prototype.empty=function(){return 0===this.array_.length},q.prototype.isEmpty=function(){return this.empty()},q.prototype.search=function(r){return this.array_.indexOf(r)},q.prototype.size=function(){return this.array_.length},q.prototype.toArray=function(){for(var r=[],s=0,f=this.array_.length;s<f;s++)r.push(this.array_[s]);return r};var br=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};br.prototype.getCoordinate=function(){return this._minCoord},br.prototype.getRightmostSide=function(r,s){var f=this.getRightmostSideOfSegment(r,s);return f<0&&(f=this.getRightmostSideOfSegment(r,s-1)),f<0&&(this._minCoord=null,this.checkForRightmostCoordinate(r)),f},br.prototype.findRightmostEdgeAtVertex=function(){var r=this._minDe.getEdge().getCoordinates();ve.isTrue(this._minIndex>0&&this._minIndex<r.length,"rightmost point expected to be interior vertex of edge");var s=r[this._minIndex-1],f=r[this._minIndex+1],m=rr.computeOrientation(this._minCoord,f,s),S=!1;(s.y<this._minCoord.y&&f.y<this._minCoord.y&&m===rr.COUNTERCLOCKWISE||s.y>this._minCoord.y&&f.y>this._minCoord.y&&m===rr.CLOCKWISE)&&(S=!0),S&&(this._minIndex=this._minIndex-1)},br.prototype.getRightmostSideOfSegment=function(r,s){var f=r.getEdge().getCoordinates();if(s<0||s+1>=f.length||f[s].y===f[s+1].y)return-1;var m=et.LEFT;return f[s].y<f[s+1].y&&(m=et.RIGHT),m},br.prototype.getEdge=function(){return this._orientedDe},br.prototype.checkForRightmostCoordinate=function(r){for(var s=r.getEdge().getCoordinates(),f=0;f<s.length-1;f++)(null===this._minCoord||s[f].x>this._minCoord.x)&&(this._minDe=r,this._minIndex=f,this._minCoord=s[f])},br.prototype.findRightmostEdgeAtNode=function(){var r=this._minDe.getNode().getEdges();this._minDe=r.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},br.prototype.findEdge=function(r){for(var s=r.iterator();s.hasNext();){var f=s.next();f.isForward()&&this.checkForRightmostCoordinate(f)}ve.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===et.LEFT&&(this._orientedDe=this._minDe.getSym())},br.prototype.interfaces_=function(){return[]},br.prototype.getClass=function(){return br};var wr=function(r){function s(f,m){r.call(this,s.msgWithCoord(f,m)),this.pt=m?new re(m):null,this.name="TopologyException"}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.getCoordinate=function(){return this.pt},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.msgWithCoord=function(f,m){return m?f:f+" [ "+m+" ]"},s}(Se),Wr=function(){this.array_=[]};Wr.prototype.addLast=function(r){this.array_.push(r)},Wr.prototype.removeFirst=function(){return this.array_.shift()},Wr.prototype.isEmpty=function(){return 0===this.array_.length};var kt=function(){this._finder=null,this._dirEdgeList=new Mr,this._nodes=new Mr,this._rightMostCoord=null,this._env=null,this._finder=new br};kt.prototype.clearVisitedEdges=function(){for(var r=this._dirEdgeList.iterator();r.hasNext();)r.next().setVisited(!1)},kt.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},kt.prototype.computeNodeDepth=function(r){for(var s=null,f=r.getEdges().iterator();f.hasNext();){var m=f.next();if(m.isVisited()||m.getSym().isVisited()){s=m;break}}if(null===s)throw new wr("unable to find edge to compute depths at "+r.getCoordinate());r.getEdges().computeDepths(s);for(var S=r.getEdges().iterator();S.hasNext();){var k=S.next();k.setVisited(!0),this.copySymDepths(k)}},kt.prototype.computeDepth=function(r){this.clearVisitedEdges();var s=this._finder.getEdge();s.setEdgeDepths(et.RIGHT,r),this.copySymDepths(s),this.computeDepths(s)},kt.prototype.create=function(r){this.addReachable(r),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},kt.prototype.findResultEdges=function(){for(var r=this._dirEdgeList.iterator();r.hasNext();){var s=r.next();s.getDepth(et.RIGHT)>=1&&s.getDepth(et.LEFT)<=0&&!s.isInteriorAreaEdge()&&s.setInResult(!0)}},kt.prototype.computeDepths=function(r){var s=new qe,f=new Wr,m=r.getNode();for(f.addLast(m),s.add(m),r.setVisited(!0);!f.isEmpty();){var S=f.removeFirst();s.add(S),this.computeNodeDepth(S);for(var k=S.getEdges().iterator();k.hasNext();){var V=k.next().getSym();if(!V.isVisited()){var de=V.getNode();s.contains(de)||(f.addLast(de),s.add(de))}}}},kt.prototype.compareTo=function(r){return this._rightMostCoord.x<r._rightMostCoord.x?-1:this._rightMostCoord.x>r._rightMostCoord.x?1:0},kt.prototype.getEnvelope=function(){if(null===this._env){for(var r=new xr,s=this._dirEdgeList.iterator();s.hasNext();)for(var f=s.next().getEdge().getCoordinates(),m=0;m<f.length-1;m++)r.expandToInclude(f[m]);this._env=r}return this._env},kt.prototype.addReachable=function(r){var s=new q;for(s.add(r);!s.empty();){var f=s.pop();this.add(f,s)}},kt.prototype.copySymDepths=function(r){var s=r.getSym();s.setDepth(et.LEFT,r.getDepth(et.RIGHT)),s.setDepth(et.RIGHT,r.getDepth(et.LEFT))},kt.prototype.add=function(r,s){r.setVisited(!0),this._nodes.add(r);for(var f=r.getEdges().iterator();f.hasNext();){var m=f.next();this._dirEdgeList.add(m);var S=m.getSym().getNode();S.isVisited()||s.push(S)}},kt.prototype.getNodes=function(){return this._nodes},kt.prototype.getDirectedEdges=function(){return this._dirEdgeList},kt.prototype.interfaces_=function(){return[ne]},kt.prototype.getClass=function(){return kt};var hr=function r(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array)this.init(arguments[0].length);else if(Number.isInteger(arguments[0])){var f=arguments[0];this.init(1),this.location[et.ON]=f}else if(arguments[0]instanceof r){var m=arguments[0];if(this.init(m.location.length),null!==m)for(var S=0;S<this.location.length;S++)this.location[S]=m.location[S]}}else if(3===arguments.length){var k=arguments[0],V=arguments[1],de=arguments[2];this.init(3),this.location[et.ON]=k,this.location[et.LEFT]=V,this.location[et.RIGHT]=de}};hr.prototype.setAllLocations=function(r){for(var s=0;s<this.location.length;s++)this.location[s]=r},hr.prototype.isNull=function(){for(var r=0;r<this.location.length;r++)if(this.location[r]!==Ee.NONE)return!1;return!0},hr.prototype.setAllLocationsIfNull=function(r){for(var s=0;s<this.location.length;s++)this.location[s]===Ee.NONE&&(this.location[s]=r)},hr.prototype.isLine=function(){return 1===this.location.length},hr.prototype.merge=function(r){if(r.location.length>this.location.length){var s=new Array(3).fill(null);s[et.ON]=this.location[et.ON],s[et.LEFT]=Ee.NONE,s[et.RIGHT]=Ee.NONE,this.location=s}for(var f=0;f<this.location.length;f++)this.location[f]===Ee.NONE&&f<r.location.length&&(this.location[f]=r.location[f])},hr.prototype.getLocations=function(){return this.location},hr.prototype.flip=function(){if(this.location.length<=1)return null;var r=this.location[et.LEFT];this.location[et.LEFT]=this.location[et.RIGHT],this.location[et.RIGHT]=r},hr.prototype.toString=function(){var r=new Ae;return this.location.length>1&&r.append(Ee.toLocationSymbol(this.location[et.LEFT])),r.append(Ee.toLocationSymbol(this.location[et.ON])),this.location.length>1&&r.append(Ee.toLocationSymbol(this.location[et.RIGHT])),r.toString()},hr.prototype.setLocations=function(r,s,f){this.location[et.ON]=r,this.location[et.LEFT]=s,this.location[et.RIGHT]=f},hr.prototype.get=function(r){return r<this.location.length?this.location[r]:Ee.NONE},hr.prototype.isArea=function(){return this.location.length>1},hr.prototype.isAnyNull=function(){for(var r=0;r<this.location.length;r++)if(this.location[r]===Ee.NONE)return!0;return!1},hr.prototype.setLocation=function(){1===arguments.length?this.setLocation(et.ON,arguments[0]):2===arguments.length&&(this.location[arguments[0]]=arguments[1])},hr.prototype.init=function(r){this.location=new Array(r).fill(null),this.setAllLocations(Ee.NONE)},hr.prototype.isEqualOnSide=function(r,s){return this.location[s]===r.location[s]},hr.prototype.allPositionsEqual=function(r){for(var s=0;s<this.location.length;s++)if(this.location[s]!==r)return!1;return!0},hr.prototype.interfaces_=function(){return[]},hr.prototype.getClass=function(){return hr};var Er=function r(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var s=arguments[0];this.elt[0]=new hr(s),this.elt[1]=new hr(s)}else if(arguments[0]instanceof r){var f=arguments[0];this.elt[0]=new hr(f.elt[0]),this.elt[1]=new hr(f.elt[1])}}else if(2===arguments.length){var m=arguments[0],S=arguments[1];this.elt[0]=new hr(Ee.NONE),this.elt[1]=new hr(Ee.NONE),this.elt[m].setLocation(S)}else if(3===arguments.length){var k=arguments[0],V=arguments[1],de=arguments[2];this.elt[0]=new hr(k,V,de),this.elt[1]=new hr(k,V,de)}else if(4===arguments.length){var Re=arguments[0],yt=arguments[1],gt=arguments[2],ar=arguments[3];this.elt[0]=new hr(Ee.NONE,Ee.NONE,Ee.NONE),this.elt[1]=new hr(Ee.NONE,Ee.NONE,Ee.NONE),this.elt[Re].setLocations(yt,gt,ar)}};Er.prototype.getGeometryCount=function(){var r=0;return this.elt[0].isNull()||r++,this.elt[1].isNull()||r++,r},Er.prototype.setAllLocations=function(r,s){this.elt[r].setAllLocations(s)},Er.prototype.isNull=function(r){return this.elt[r].isNull()},Er.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var r=arguments[0];this.setAllLocationsIfNull(0,r),this.setAllLocationsIfNull(1,r)}else 2===arguments.length&&this.elt[arguments[0]].setAllLocationsIfNull(arguments[1])},Er.prototype.isLine=function(r){return this.elt[r].isLine()},Er.prototype.merge=function(r){for(var s=0;s<2;s++)null===this.elt[s]&&null!==r.elt[s]?this.elt[s]=new hr(r.elt[s]):this.elt[s].merge(r.elt[s])},Er.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Er.prototype.getLocation=function(){return 1===arguments.length?this.elt[arguments[0]].get(et.ON):2===arguments.length?this.elt[arguments[0]].get(arguments[1]):void 0},Er.prototype.toString=function(){var r=new Ae;return null!==this.elt[0]&&(r.append("A:"),r.append(this.elt[0].toString())),null!==this.elt[1]&&(r.append(" B:"),r.append(this.elt[1].toString())),r.toString()},Er.prototype.isArea=function(){return 0===arguments.length?this.elt[0].isArea()||this.elt[1].isArea():1===arguments.length?this.elt[arguments[0]].isArea():void 0},Er.prototype.isAnyNull=function(r){return this.elt[r].isAnyNull()},Er.prototype.setLocation=function(){2===arguments.length?this.elt[arguments[0]].setLocation(et.ON,arguments[1]):3===arguments.length&&this.elt[arguments[0]].setLocation(arguments[1],arguments[2])},Er.prototype.isEqualOnSide=function(r,s){return this.elt[0].isEqualOnSide(r.elt[0],s)&&this.elt[1].isEqualOnSide(r.elt[1],s)},Er.prototype.allPositionsEqual=function(r,s){return this.elt[r].allPositionsEqual(s)},Er.prototype.toLine=function(r){this.elt[r].isArea()&&(this.elt[r]=new hr(this.elt[r].location[0]))},Er.prototype.interfaces_=function(){return[]},Er.prototype.getClass=function(){return Er},Er.toLineLabel=function(r){for(var s=new Er(Ee.NONE),f=0;f<2;f++)s.setLocation(f,r.getLocation(f));return s};var Jr=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Mr,this._pts=new Mr,this._label=new Er(Ee.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Mr,this._geometryFactory=null;var r=arguments[0];this._geometryFactory=arguments[1],this.computePoints(r),this.computeRing()};Jr.prototype.computeRing=function(){if(null!==this._ring)return null;for(var r=new Array(this._pts.size()).fill(null),s=0;s<this._pts.size();s++)r[s]=this._pts.get(s);this._ring=this._geometryFactory.createLinearRing(r),this._isHole=rr.isCCW(this._ring.getCoordinates())},Jr.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},Jr.prototype.computePoints=function(r){this._startDe=r;var s=r,f=!0;do{if(null===s)throw new wr("Found null DirectedEdge");if(s.getEdgeRing()===this)throw new wr("Directed Edge visited twice during ring-building at "+s.getCoordinate());this._edges.add(s);var m=s.getLabel();ve.isTrue(m.isArea()),this.mergeLabel(m),this.addPoints(s.getEdge(),s.isForward(),f),f=!1,this.setEdgeRing(s,this),s=this.getNext(s)}while(s!==this._startDe)},Jr.prototype.getLinearRing=function(){return this._ring},Jr.prototype.getCoordinate=function(r){return this._pts.get(r)},Jr.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var r=this._startDe;do{var s=r.getNode().getEdges().getOutgoingDegree(this);s>this._maxNodeDegree&&(this._maxNodeDegree=s),r=this.getNext(r)}while(r!==this._startDe);this._maxNodeDegree*=2},Jr.prototype.addPoints=function(r,s,f){var m=r.getCoordinates();if(s){var S=1;f&&(S=0);for(var k=S;k<m.length;k++)this._pts.add(m[k])}else{var V=m.length-2;f&&(V=m.length-1);for(var de=V;de>=0;de--)this._pts.add(m[de])}},Jr.prototype.isHole=function(){return this._isHole},Jr.prototype.setInResult=function(){var r=this._startDe;do{r.getEdge().setInResult(!0),r=r.getNext()}while(r!==this._startDe)},Jr.prototype.containsPoint=function(r){var s=this.getLinearRing();if(!s.getEnvelopeInternal().contains(r)||!rr.isPointInRing(r,s.getCoordinates()))return!1;for(var f=this._holes.iterator();f.hasNext();)if(f.next().containsPoint(r))return!1;return!0},Jr.prototype.addHole=function(r){this._holes.add(r)},Jr.prototype.isShell=function(){return null===this._shell},Jr.prototype.getLabel=function(){return this._label},Jr.prototype.getEdges=function(){return this._edges},Jr.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},Jr.prototype.getShell=function(){return this._shell},Jr.prototype.mergeLabel=function(){if(1===arguments.length){var r=arguments[0];this.mergeLabel(r,0),this.mergeLabel(r,1)}else if(2===arguments.length){var f=arguments[1],m=arguments[0].getLocation(f,et.RIGHT);if(m===Ee.NONE)return null;if(this._label.getLocation(f)===Ee.NONE)return this._label.setLocation(f,m),null}},Jr.prototype.setShell=function(r){this._shell=r,null!==r&&r.addHole(this)},Jr.prototype.toPolygon=function(r){for(var s=new Array(this._holes.size()).fill(null),f=0;f<this._holes.size();f++)s[f]=this._holes.get(f).getLinearRing();return r.createPolygon(this.getLinearRing(),s)},Jr.prototype.interfaces_=function(){return[]},Jr.prototype.getClass=function(){return Jr};var yn=function(r){function s(){r.call(this,arguments[0],arguments[1])}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.setEdgeRing=function(f,m){f.setMinEdgeRing(m)},s.prototype.getNext=function(f){return f.getNextMin()},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Jr),ao=function(r){function s(){r.call(this,arguments[0],arguments[1])}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.buildMinimalRings=function(){var f=new Mr,m=this._startDe;do{if(null===m.getMinEdgeRing()){var S=new yn(m,this._geometryFactory);f.add(S)}m=m.getNext()}while(m!==this._startDe);return f},s.prototype.setEdgeRing=function(f,m){f.setEdgeRing(m)},s.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var f=this._startDe;do{f.getNode().getEdges().linkMinimalDirectedEdges(this),f=f.getNext()}while(f!==this._startDe)},s.prototype.getNext=function(f){return f.getNext()},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Jr),fr=function(){this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0!==arguments.length&&1===arguments.length&&(this._label=arguments[0])};fr.prototype.setVisited=function(r){this._isVisited=r},fr.prototype.setInResult=function(r){this._isInResult=r},fr.prototype.isCovered=function(){return this._isCovered},fr.prototype.isCoveredSet=function(){return this._isCoveredSet},fr.prototype.setLabel=function(r){this._label=r},fr.prototype.getLabel=function(){return this._label},fr.prototype.setCovered=function(r){this._isCovered=r,this._isCoveredSet=!0},fr.prototype.updateIM=function(r){ve.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(r)},fr.prototype.isInResult=function(){return this._isInResult},fr.prototype.isVisited=function(){return this._isVisited},fr.prototype.interfaces_=function(){return[]},fr.prototype.getClass=function(){return fr};var nn=function(r){function s(){r.call(this),this._coord=null,this._edges=null;var m=arguments[1];this._coord=arguments[0],this._edges=m,this._label=new Er(0,Ee.NONE)}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.isIncidentEdgeInResult=function(){for(var f=this.getEdges().getEdges().iterator();f.hasNext();)if(f.next().getEdge().isInResult())return!0;return!1},s.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},s.prototype.getCoordinate=function(){return this._coord},s.prototype.print=function(f){f.println("node "+this._coord+" lbl: "+this._label)},s.prototype.computeIM=function(f){},s.prototype.computeMergedLocation=function(f,m){var S=Ee.NONE;if(S=this._label.getLocation(m),!f.isNull(m)){var k=f.getLocation(m);S!==Ee.BOUNDARY&&(S=k)}return S},s.prototype.setLabel=function(){if(2!==arguments.length)return r.prototype.setLabel.apply(this,arguments);var f=arguments[0],m=arguments[1];null===this._label?this._label=new Er(f,m):this._label.setLocation(f,m)},s.prototype.getEdges=function(){return this._edges},s.prototype.mergeLabel=function(){if(arguments[0]instanceof s)this.mergeLabel(arguments[0]._label);else if(arguments[0]instanceof Er)for(var m=arguments[0],S=0;S<2;S++){var k=this.computeMergedLocation(m,S);this._label.getLocation(S)===Ee.NONE&&this._label.setLocation(S,k)}},s.prototype.add=function(f){this._edges.insert(f),f.setNode(this)},s.prototype.setLabelBoundary=function(f){if(null===this._label)return null;var m=Ee.NONE;null!==this._label&&(m=this._label.getLocation(f)),this._label.setLocation(f,m===Ee.BOUNDARY?Ee.INTERIOR:Ee.BOUNDARY)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(fr),In=function(){this.nodeMap=new xe,this.nodeFact=null,this.nodeFact=arguments[0]};In.prototype.find=function(r){return this.nodeMap.get(r)},In.prototype.addNode=function(){if(arguments[0]instanceof re){var r=arguments[0],s=this.nodeMap.get(r);return null===s&&(s=this.nodeFact.createNode(r),this.nodeMap.put(r,s)),s}if(arguments[0]instanceof nn){var f=arguments[0],m=this.nodeMap.get(f.getCoordinate());return null===m?(this.nodeMap.put(f.getCoordinate(),f),f):(m.mergeLabel(f),m)}},In.prototype.print=function(r){for(var s=this.iterator();s.hasNext();)s.next().print(r)},In.prototype.iterator=function(){return this.nodeMap.values().iterator()},In.prototype.values=function(){return this.nodeMap.values()},In.prototype.getBoundaryNodes=function(r){for(var s=new Mr,f=this.iterator();f.hasNext();){var m=f.next();m.getLabel().getLocation(r)===Ee.BOUNDARY&&s.add(m)}return s},In.prototype.add=function(r){var s=r.getCoordinate();this.addNode(s).add(r)},In.prototype.interfaces_=function(){return[]},In.prototype.getClass=function(){return In};var xn=function(){},_o={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};xn.prototype.interfaces_=function(){return[]},xn.prototype.getClass=function(){return xn},xn.isNorthern=function(r){return r===xn.NE||r===xn.NW},xn.isOpposite=function(r,s){return r!==s&&(r-s+4)%4==2},xn.commonHalfPlane=function(r,s){if(r===s)return r;if((r-s+4)%4==2)return-1;var f=r<s?r:s;return 0===f&&3===(r>s?r:s)?3:f},xn.isInHalfPlane=function(r,s){return s===xn.SE?r===xn.SE||r===xn.SW:r===s||r===s+1},xn.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var r=arguments[0],s=arguments[1];if(0===r&&0===s)throw new X("Cannot compute the quadrant for point ( "+r+", "+s+" )");return r>=0?s>=0?xn.NE:xn.SE:s>=0?xn.NW:xn.SW}if(arguments[0]instanceof re&&arguments[1]instanceof re){var f=arguments[0],m=arguments[1];if(m.x===f.x&&m.y===f.y)throw new X("Cannot compute the quadrant for two identical points "+f);return m.x>=f.x?m.y>=f.y?xn.NE:xn.SE:m.y>=f.y?xn.NW:xn.SW}},_o.NE.get=function(){return 0},_o.NW.get=function(){return 1},_o.SW.get=function(){return 2},_o.SE.get=function(){return 3},Object.defineProperties(xn,_o);var Zr=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length)this._edge=arguments[0];else if(3===arguments.length){var f=arguments[1],m=arguments[2];this._edge=arguments[0],this.init(f,m),this._label=null}else if(4===arguments.length){var k=arguments[1],V=arguments[2],de=arguments[3];this._edge=arguments[0],this.init(k,V),this._label=de}};Zr.prototype.compareDirection=function(r){return this._dx===r._dx&&this._dy===r._dy?0:this._quadrant>r._quadrant?1:this._quadrant<r._quadrant?-1:rr.computeOrientation(r._p0,r._p1,this._p1)},Zr.prototype.getDy=function(){return this._dy},Zr.prototype.getCoordinate=function(){return this._p0},Zr.prototype.setNode=function(r){this._node=r},Zr.prototype.print=function(r){var s=Math.atan2(this._dy,this._dx),f=this.getClass().getName(),m=f.lastIndexOf("."),S=f.substring(m+1);r.print("  "+S+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+s+"   "+this._label)},Zr.prototype.compareTo=function(r){return this.compareDirection(r)},Zr.prototype.getDirectedCoordinate=function(){return this._p1},Zr.prototype.getDx=function(){return this._dx},Zr.prototype.getLabel=function(){return this._label},Zr.prototype.getEdge=function(){return this._edge},Zr.prototype.getQuadrant=function(){return this._quadrant},Zr.prototype.getNode=function(){return this._node},Zr.prototype.toString=function(){var r=Math.atan2(this._dy,this._dx),s=this.getClass().getName(),f=s.lastIndexOf(".");return"  "+s.substring(f+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+r+"   "+this._label},Zr.prototype.computeLabel=function(r){},Zr.prototype.init=function(r,s){this._p0=r,this._p1=s,this._dx=s.x-r.x,this._dy=s.y-r.y,this._quadrant=xn.quadrant(this._dx,this._dy),ve.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Zr.prototype.interfaces_=function(){return[ne]},Zr.prototype.getClass=function(){return Zr};var zo=function(r){function s(){var f=arguments[0],m=arguments[1];if(r.call(this,f),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=m,m)this.init(f.getCoordinate(0),f.getCoordinate(1));else{var S=f.getNumPoints()-1;this.init(f.getCoordinate(S),f.getCoordinate(S-1))}this.computeDirectedLabel()}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.getNextMin=function(){return this._nextMin},s.prototype.getDepth=function(f){return this._depth[f]},s.prototype.setVisited=function(f){this._isVisited=f},s.prototype.computeDirectedLabel=function(){this._label=new Er(this._edge.getLabel()),this._isForward||this._label.flip()},s.prototype.getNext=function(){return this._next},s.prototype.setDepth=function(f,m){if(-999!==this._depth[f]&&this._depth[f]!==m)throw new wr("assigned depths do not match",this.getCoordinate());this._depth[f]=m},s.prototype.isInteriorAreaEdge=function(){for(var f=!0,m=0;m<2;m++)this._label.isArea(m)&&this._label.getLocation(m,et.LEFT)===Ee.INTERIOR&&this._label.getLocation(m,et.RIGHT)===Ee.INTERIOR||(f=!1);return f},s.prototype.setNextMin=function(f){this._nextMin=f},s.prototype.print=function(f){r.prototype.print.call(this,f),f.print(" "+this._depth[et.LEFT]+"/"+this._depth[et.RIGHT]),f.print(" ("+this.getDepthDelta()+")"),this._isInResult&&f.print(" inResult")},s.prototype.setMinEdgeRing=function(f){this._minEdgeRing=f},s.prototype.isLineEdge=function(){var f=this._label.isLine(0)||this._label.isLine(1),m=!this._label.isArea(0)||this._label.allPositionsEqual(0,Ee.EXTERIOR),S=!this._label.isArea(1)||this._label.allPositionsEqual(1,Ee.EXTERIOR);return f&&m&&S},s.prototype.setEdgeRing=function(f){this._edgeRing=f},s.prototype.getMinEdgeRing=function(){return this._minEdgeRing},s.prototype.getDepthDelta=function(){var f=this._edge.getDepthDelta();return this._isForward||(f=-f),f},s.prototype.setInResult=function(f){this._isInResult=f},s.prototype.getSym=function(){return this._sym},s.prototype.isForward=function(){return this._isForward},s.prototype.getEdge=function(){return this._edge},s.prototype.printEdge=function(f){this.print(f),f.print(" "),this._isForward?this._edge.print(f):this._edge.printReverse(f)},s.prototype.setSym=function(f){this._sym=f},s.prototype.setVisitedEdge=function(f){this.setVisited(f),this._sym.setVisited(f)},s.prototype.setEdgeDepths=function(f,m){var S=this.getEdge().getDepthDelta();this._isForward||(S=-S);var k=1;f===et.LEFT&&(k=-1);var V=et.opposite(f),de=m+S*k;this.setDepth(f,m),this.setDepth(V,de)},s.prototype.getEdgeRing=function(){return this._edgeRing},s.prototype.isInResult=function(){return this._isInResult},s.prototype.setNext=function(f){this._next=f},s.prototype.isVisited=function(){return this._isVisited},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.depthFactor=function(f,m){return f===Ee.EXTERIOR&&m===Ee.INTERIOR?1:f===Ee.INTERIOR&&m===Ee.EXTERIOR?-1:0},s}(Zr),Rs=function(){};Rs.prototype.createNode=function(r){return new nn(r,null)},Rs.prototype.interfaces_=function(){return[]},Rs.prototype.getClass=function(){return Rs};var pn=function(){this._edges=new Mr,this._nodes=null,this._edgeEndList=new Mr,0===arguments.length?this._nodes=new In(new Rs):1===arguments.length&&(this._nodes=new In(arguments[0]))};pn.prototype.printEdges=function(r){r.println("Edges:");for(var s=0;s<this._edges.size();s++){r.println("edge "+s+":");var f=this._edges.get(s);f.print(r),f.eiList.print(r)}},pn.prototype.find=function(r){return this._nodes.find(r)},pn.prototype.addNode=function(){return arguments[0]instanceof nn||arguments[0]instanceof re?this._nodes.addNode(arguments[0]):void 0},pn.prototype.getNodeIterator=function(){return this._nodes.iterator()},pn.prototype.linkResultDirectedEdges=function(){for(var r=this._nodes.iterator();r.hasNext();)r.next().getEdges().linkResultDirectedEdges()},pn.prototype.debugPrintln=function(r){rn.out.println(r)},pn.prototype.isBoundaryNode=function(r,s){var f=this._nodes.find(s);if(null===f)return!1;var m=f.getLabel();return null!==m&&m.getLocation(r)===Ee.BOUNDARY},pn.prototype.linkAllDirectedEdges=function(){for(var r=this._nodes.iterator();r.hasNext();)r.next().getEdges().linkAllDirectedEdges()},pn.prototype.matchInSameDirection=function(r,s,f,m){return!!r.equals(f)&&rr.computeOrientation(r,s,m)===rr.COLLINEAR&&xn.quadrant(r,s)===xn.quadrant(f,m)},pn.prototype.getEdgeEnds=function(){return this._edgeEndList},pn.prototype.debugPrint=function(r){rn.out.print(r)},pn.prototype.getEdgeIterator=function(){return this._edges.iterator()},pn.prototype.findEdgeInSameDirection=function(r,s){for(var f=0;f<this._edges.size();f++){var m=this._edges.get(f),S=m.getCoordinates();if(this.matchInSameDirection(r,s,S[0],S[1])||this.matchInSameDirection(r,s,S[S.length-1],S[S.length-2]))return m}return null},pn.prototype.insertEdge=function(r){this._edges.add(r)},pn.prototype.findEdgeEnd=function(r){for(var s=this.getEdgeEnds().iterator();s.hasNext();){var f=s.next();if(f.getEdge()===r)return f}return null},pn.prototype.addEdges=function(r){for(var s=r.iterator();s.hasNext();){var f=s.next();this._edges.add(f);var m=new zo(f,!0),S=new zo(f,!1);m.setSym(S),S.setSym(m),this.add(m),this.add(S)}},pn.prototype.add=function(r){this._nodes.add(r),this._edgeEndList.add(r)},pn.prototype.getNodes=function(){return this._nodes.values()},pn.prototype.findEdge=function(r,s){for(var f=0;f<this._edges.size();f++){var m=this._edges.get(f),S=m.getCoordinates();if(r.equals(S[0])&&s.equals(S[1]))return m}return null},pn.prototype.interfaces_=function(){return[]},pn.prototype.getClass=function(){return pn},pn.linkResultDirectedEdges=function(r){for(var s=r.iterator();s.hasNext();)s.next().getEdges().linkResultDirectedEdges()};var ji=function(){this._geometryFactory=null,this._shellList=new Mr,this._geometryFactory=arguments[0]};ji.prototype.sortShellsAndHoles=function(r,s,f){for(var m=r.iterator();m.hasNext();){var S=m.next();S.isHole()?f.add(S):s.add(S)}},ji.prototype.computePolygons=function(r){for(var s=new Mr,f=r.iterator();f.hasNext();){var m=f.next().toPolygon(this._geometryFactory);s.add(m)}return s},ji.prototype.placeFreeHoles=function(r,s){for(var f=s.iterator();f.hasNext();){var m=f.next();if(null===m.getShell()){var S=this.findEdgeRingContaining(m,r);if(null===S)throw new wr("unable to assign hole to a shell",m.getCoordinate(0));m.setShell(S)}}},ji.prototype.buildMinimalEdgeRings=function(r,s,f){for(var m=new Mr,S=r.iterator();S.hasNext();){var k=S.next();if(k.getMaxNodeDegree()>2){k.linkDirectedEdgesForMinimalEdgeRings();var V=k.buildMinimalRings(),de=this.findShell(V);null!==de?(this.placePolygonHoles(de,V),s.add(de)):f.addAll(V)}else m.add(k)}return m},ji.prototype.containsPoint=function(r){for(var s=this._shellList.iterator();s.hasNext();)if(s.next().containsPoint(r))return!0;return!1},ji.prototype.buildMaximalEdgeRings=function(r){for(var s=new Mr,f=r.iterator();f.hasNext();){var m=f.next();if(m.isInResult()&&m.getLabel().isArea()&&null===m.getEdgeRing()){var S=new ao(m,this._geometryFactory);s.add(S),S.setInResult()}}return s},ji.prototype.placePolygonHoles=function(r,s){for(var f=s.iterator();f.hasNext();){var m=f.next();m.isHole()&&m.setShell(r)}},ji.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},ji.prototype.findEdgeRingContaining=function(r,s){for(var f=r.getLinearRing(),m=f.getEnvelopeInternal(),S=f.getCoordinateN(0),k=null,V=null,de=s.iterator();de.hasNext();){var Re=de.next(),yt=Re.getLinearRing(),gt=yt.getEnvelopeInternal();null!==k&&(V=k.getLinearRing().getEnvelopeInternal());var ar=!1;gt.contains(m)&&rr.isPointInRing(S,yt.getCoordinates())&&(ar=!0),ar&&(null===k||V.contains(gt))&&(k=Re)}return k},ji.prototype.findShell=function(r){for(var s=0,f=null,m=r.iterator();m.hasNext();){var S=m.next();S.isHole()||(f=S,s++)}return ve.isTrue(s<=1,"found two shells in MinimalEdgeRing list"),f},ji.prototype.add=function(){if(1===arguments.length){var r=arguments[0];this.add(r.getEdgeEnds(),r.getNodes())}else if(2===arguments.length){var s=arguments[0];pn.linkResultDirectedEdges(arguments[1]);var m=this.buildMaximalEdgeRings(s),S=new Mr,k=this.buildMinimalEdgeRings(m,this._shellList,S);this.sortShellsAndHoles(k,this._shellList,S),this.placeFreeHoles(this._shellList,S)}},ji.prototype.interfaces_=function(){return[]},ji.prototype.getClass=function(){return ji};var Xo=function(){};Xo.prototype.getBounds=function(){},Xo.prototype.interfaces_=function(){return[]},Xo.prototype.getClass=function(){return Xo};var Ns=function(){this._bounds=null,this._item=null;var s=arguments[1];this._bounds=arguments[0],this._item=s};Ns.prototype.getItem=function(){return this._item},Ns.prototype.getBounds=function(){return this._bounds},Ns.prototype.interfaces_=function(){return[Xo,ae]},Ns.prototype.getClass=function(){return Ns};var _l=function(){this._size=null,this._items=null,this._size=0,this._items=new Mr,this._items.add(null)};_l.prototype.poll=function(){if(this.isEmpty())return null;var r=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),r},_l.prototype.size=function(){return this._size},_l.prototype.reorder=function(r){for(var s=null,f=this._items.get(r);2*r<=this._size&&((s=2*r)!==this._size&&this._items.get(s+1).compareTo(this._items.get(s))<0&&s++,this._items.get(s).compareTo(f)<0);r=s)this._items.set(r,this._items.get(s));this._items.set(r,f)},_l.prototype.clear=function(){this._size=0,this._items.clear()},_l.prototype.isEmpty=function(){return 0===this._size},_l.prototype.add=function(r){this._items.add(null),this._size+=1;var s=this._size;for(this._items.set(0,r);r.compareTo(this._items.get(Math.trunc(s/2)))<0;s/=2)this._items.set(s,this._items.get(Math.trunc(s/2)));this._items.set(s,r)},_l.prototype.interfaces_=function(){return[]},_l.prototype.getClass=function(){return _l};var gs=function(){};gs.prototype.visitItem=function(r){},gs.prototype.interfaces_=function(){return[]},gs.prototype.getClass=function(){return gs};var Js=function(){};Js.prototype.insert=function(r,s){},Js.prototype.remove=function(r,s){},Js.prototype.query=function(){},Js.prototype.interfaces_=function(){return[]},Js.prototype.getClass=function(){return Js};var Ao=function(){this._childBoundables=new Mr,this._bounds=null,this._level=null,0!==arguments.length&&1===arguments.length&&(this._level=arguments[0])},qi={serialVersionUID:{configurable:!0}};Ao.prototype.getLevel=function(){return this._level},Ao.prototype.size=function(){return this._childBoundables.size()},Ao.prototype.getChildBoundables=function(){return this._childBoundables},Ao.prototype.addChildBoundable=function(r){ve.isTrue(null===this._bounds),this._childBoundables.add(r)},Ao.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},Ao.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},Ao.prototype.interfaces_=function(){return[Xo,ae]},Ao.prototype.getClass=function(){return Ao},qi.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Ao,qi);var Ms=function(){};Ms.reverseOrder=function(){return{compare:function(r,s){return s.compareTo(r)}}},Ms.min=function(r){return Ms.sort(r),r.get(0)},Ms.sort=function(r,s){var f=r.toArray();s?wt.sort(f,s):wt.sort(f);for(var m=r.iterator(),S=0,k=f.length;S<k;S++)m.next(),m.set(f[S])},Ms.singletonList=function(r){var s=new Mr;return s.add(r),s};var Vi=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var s=arguments[1],f=arguments[2];this._boundable1=arguments[0],this._boundable2=s,this._itemDistance=f,this._distance=this.distance()};Vi.prototype.expandToQueue=function(r,s){var f=Vi.isComposite(this._boundable1),m=Vi.isComposite(this._boundable2);if(f&&m)return Vi.area(this._boundable1)>Vi.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,r,s),null):(this.expand(this._boundable2,this._boundable1,r,s),null);if(f)return this.expand(this._boundable1,this._boundable2,r,s),null;if(m)return this.expand(this._boundable2,this._boundable1,r,s),null;throw new X("neither boundable is composite")},Vi.prototype.isLeaves=function(){return!(Vi.isComposite(this._boundable1)||Vi.isComposite(this._boundable2))},Vi.prototype.compareTo=function(r){return this._distance<r._distance?-1:this._distance>r._distance?1:0},Vi.prototype.expand=function(r,s,f,m){for(var S=r.getChildBoundables().iterator();S.hasNext();){var k=S.next(),V=new Vi(k,s,this._itemDistance);V.getDistance()<m&&f.add(V)}},Vi.prototype.getBoundable=function(r){return 0===r?this._boundable1:this._boundable2},Vi.prototype.getDistance=function(){return this._distance},Vi.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},Vi.prototype.interfaces_=function(){return[ne]},Vi.prototype.getClass=function(){return Vi},Vi.area=function(r){return r.getBounds().getArea()},Vi.isComposite=function(r){return r instanceof Ao};var Bo=function r(){if(this._root=null,this._built=!1,this._itemBoundables=new Mr,this._nodeCapacity=null,0===arguments.length)this._nodeCapacity=r.DEFAULT_NODE_CAPACITY;else if(1===arguments.length){var f=arguments[0];ve.isTrue(f>1,"Node capacity must be greater than 1"),this._nodeCapacity=f}},ps={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Bo.prototype.getNodeCapacity=function(){return this._nodeCapacity},Bo.prototype.lastNode=function(r){return r.get(r.size()-1)},Bo.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var r=0,s=arguments[0].getChildBoundables().iterator();s.hasNext();){var f=s.next();f instanceof Ao?r+=this.size(f):f instanceof Ns&&(r+=1)}return r}},Bo.prototype.removeItem=function(r,s){for(var f=null,m=r.getChildBoundables().iterator();m.hasNext();){var S=m.next();S instanceof Ns&&S.getItem()===s&&(f=S)}return null!==f&&(r.getChildBoundables().remove(f),!0)},Bo.prototype.itemsTree=function(){if(0===arguments.length){this.build();var r=this.itemsTree(this._root);return null===r?new Mr:r}if(1===arguments.length){for(var s=arguments[0],f=new Mr,m=s.getChildBoundables().iterator();m.hasNext();){var S=m.next();if(S instanceof Ao){var k=this.itemsTree(S);null!==k&&f.add(k)}else S instanceof Ns?f.add(S.getItem()):ve.shouldNeverReachHere()}return f.size()<=0?null:f}},Bo.prototype.insert=function(r,s){ve.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Ns(r,s))},Bo.prototype.boundablesAtLevel=function(){if(1===arguments.length){var r=arguments[0],s=new Mr;return this.boundablesAtLevel(r,this._root,s),s}if(3===arguments.length){var f=arguments[0],m=arguments[1],S=arguments[2];if(ve.isTrue(f>-2),m.getLevel()===f)return S.add(m),null;for(var k=m.getChildBoundables().iterator();k.hasNext();){var V=k.next();V instanceof Ao?this.boundablesAtLevel(f,V,S):(ve.isTrue(V instanceof Ns),-1===f&&S.add(V))}return null}},Bo.prototype.query=function(){if(1===arguments.length){var r=arguments[0];this.build();var s=new Mr;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,s),s}if(2===arguments.length){var f=arguments[0],m=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),f)&&this.query(f,this._root,m)}else if(3===arguments.length)if(Nt(arguments[2],gs)&&arguments[0]instanceof Object&&arguments[1]instanceof Ao)for(var S=arguments[0],V=arguments[2],de=arguments[1].getChildBoundables(),Re=0;Re<de.size();Re++){var yt=de.get(Re);this.getIntersectsOp().intersects(yt.getBounds(),S)&&(yt instanceof Ao?this.query(S,yt,V):yt instanceof Ns?V.visitItem(yt.getItem()):ve.shouldNeverReachHere())}else if(Nt(arguments[2],Bn)&&arguments[0]instanceof Object&&arguments[1]instanceof Ao)for(var gt=arguments[0],Gr=arguments[2],Br=arguments[1].getChildBoundables(),sn=0;sn<Br.size();sn++){var Mn=Br.get(sn);this.getIntersectsOp().intersects(Mn.getBounds(),gt)&&(Mn instanceof Ao?this.query(gt,Mn,Gr):Mn instanceof Ns?Gr.add(Mn.getItem()):ve.shouldNeverReachHere())}},Bo.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},Bo.prototype.getRoot=function(){return this.build(),this._root},Bo.prototype.remove=function(){if(2===arguments.length){var r=arguments[0],s=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.remove(r,this._root,s)}if(3===arguments.length){var f=arguments[0],m=arguments[1],S=arguments[2],k=this.removeItem(m,S);if(k)return!0;for(var V=null,de=m.getChildBoundables().iterator();de.hasNext();){var Re=de.next();if(this.getIntersectsOp().intersects(Re.getBounds(),f)&&Re instanceof Ao&&(k=this.remove(f,Re,S))){V=Re;break}}return null!==V&&V.getChildBoundables().isEmpty()&&m.getChildBoundables().remove(V),k}},Bo.prototype.createHigherLevels=function(r,s){ve.isTrue(!r.isEmpty());var f=this.createParentBoundables(r,s+1);return 1===f.size()?f.get(0):this.createHigherLevels(f,s+1)},Bo.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var r=0,s=arguments[0].getChildBoundables().iterator();s.hasNext();){var f=s.next();if(f instanceof Ao){var m=this.depth(f);m>r&&(r=m)}}return r+1}},Bo.prototype.createParentBoundables=function(r,s){ve.isTrue(!r.isEmpty());var f=new Mr;f.add(this.createNode(s));var m=new Mr(r);Ms.sort(m,this.getComparator());for(var S=m.iterator();S.hasNext();){var k=S.next();this.lastNode(f).getChildBoundables().size()===this.getNodeCapacity()&&f.add(this.createNode(s)),this.lastNode(f).addChildBoundable(k)}return f},Bo.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},Bo.prototype.interfaces_=function(){return[ae]},Bo.prototype.getClass=function(){return Bo},Bo.compareDoubles=function(r,s){return r>s?1:r<s?-1:0},ps.IntersectsOp.get=function(){return lu},ps.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},ps.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(Bo,ps);var lu=function(){},la=function(){};la.prototype.distance=function(r,s){},la.prototype.interfaces_=function(){return[]},la.prototype.getClass=function(){return la};var ku=function(r){function s(m){r.call(this,m=m||s.DEFAULT_NODE_CAPACITY)}r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s;var f={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return s.prototype.createParentBoundablesFromVerticalSlices=function(m,S){ve.isTrue(m.length>0);for(var k=new Mr,V=0;V<m.length;V++)k.addAll(this.createParentBoundablesFromVerticalSlice(m[V],S));return k},s.prototype.createNode=function(m){return new Yu(m)},s.prototype.size=function(){return 0===arguments.length?r.prototype.size.call(this):r.prototype.size.apply(this,arguments)},s.prototype.insert=function(){if(2!==arguments.length)return r.prototype.insert.apply(this,arguments);var m=arguments[0],S=arguments[1];if(m.isNull())return null;r.prototype.insert.call(this,m,S)},s.prototype.getIntersectsOp=function(){return s.intersectsOp},s.prototype.verticalSlices=function(m,S){for(var k=Math.trunc(Math.ceil(m.size()/S)),V=new Array(S).fill(null),de=m.iterator(),Re=0;Re<S;Re++){V[Re]=new Mr;for(var yt=0;de.hasNext()&&yt<k;){var gt=de.next();V[Re].add(gt),yt++}}return V},s.prototype.query=function(){if(1===arguments.length)return r.prototype.query.call(this,arguments[0]);2===arguments.length?r.prototype.query.call(this,arguments[0],arguments[1]):3===arguments.length&&(Nt(arguments[2],gs)&&arguments[0]instanceof Object&&arguments[1]instanceof Ao||Nt(arguments[2],Bn)&&arguments[0]instanceof Object&&arguments[1]instanceof Ao)&&r.prototype.query.call(this,arguments[0],arguments[1],arguments[2])},s.prototype.getComparator=function(){return s.yComparator},s.prototype.createParentBoundablesFromVerticalSlice=function(m,S){return r.prototype.createParentBoundables.call(this,m,S)},s.prototype.remove=function(){return 2===arguments.length?r.prototype.remove.call(this,arguments[0],arguments[1]):r.prototype.remove.apply(this,arguments)},s.prototype.depth=function(){return 0===arguments.length?r.prototype.depth.call(this):r.prototype.depth.apply(this,arguments)},s.prototype.createParentBoundables=function(m,S){ve.isTrue(!m.isEmpty());var k=Math.trunc(Math.ceil(m.size()/this.getNodeCapacity())),V=new Mr(m);Ms.sort(V,s.xComparator);var de=this.verticalSlices(V,Math.trunc(Math.ceil(Math.sqrt(k))));return this.createParentBoundablesFromVerticalSlices(de,S)},s.prototype.nearestNeighbour=function(){if(1===arguments.length){if(Nt(arguments[0],la)){var m=arguments[0],S=new Vi(this.getRoot(),this.getRoot(),m);return this.nearestNeighbour(S)}if(arguments[0]instanceof Vi)return this.nearestNeighbour(arguments[0],ee.POSITIVE_INFINITY)}else if(2===arguments.length){if(arguments[0]instanceof s&&Nt(arguments[1],la)){var V=arguments[0],de=arguments[1],Re=new Vi(this.getRoot(),V.getRoot(),de);return this.nearestNeighbour(Re)}if(arguments[0]instanceof Vi&&"number"==typeof arguments[1]){var yt=arguments[0],gt=arguments[1],ar=null,Gr=new _l;for(Gr.add(yt);!Gr.isEmpty()&&gt>0;){var Br=Gr.poll(),sn=Br.getDistance();if(sn>=gt)break;Br.isLeaves()?(gt=sn,ar=Br):Br.expandToQueue(Gr,gt)}return[ar.getBoundable(0).getItem(),ar.getBoundable(1).getItem()]}}else if(3===arguments.length){var ls=arguments[2],na=new Ns(arguments[0],arguments[1]),wl=new Vi(this.getRoot(),na,ls);return this.nearestNeighbour(wl)[0]}},s.prototype.interfaces_=function(){return[Js,ae]},s.prototype.getClass=function(){return s},s.centreX=function(m){return s.avg(m.getMinX(),m.getMaxX())},s.avg=function(m,S){return(m+S)/2},s.centreY=function(m){return s.avg(m.getMinY(),m.getMaxY())},f.STRtreeNode.get=function(){return Yu},f.serialVersionUID.get=function(){return 0x39920f7d5f261e0},f.xComparator.get=function(){return{interfaces_:function(){return[he]},compare:function(m,S){return r.compareDoubles(s.centreX(m.getBounds()),s.centreX(S.getBounds()))}}},f.yComparator.get=function(){return{interfaces_:function(){return[he]},compare:function(m,S){return r.compareDoubles(s.centreY(m.getBounds()),s.centreY(S.getBounds()))}}},f.intersectsOp.get=function(){return{interfaces_:function(){return[r.IntersectsOp]},intersects:function(m,S){return m.intersects(S)}}},f.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(s,f),s}(Bo),Yu=function(r){function s(){r.call(this,arguments[0])}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.computeBounds=function(){for(var f=null,m=this.getChildBoundables().iterator();m.hasNext();){var S=m.next();null===f?f=new xr(S.getBounds()):f.expandToInclude(S.getBounds())}return f},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Ao),ys=function(){};ys.prototype.interfaces_=function(){return[]},ys.prototype.getClass=function(){return ys},ys.relativeSign=function(r,s){return r<s?-1:r>s?1:0},ys.compare=function(r,s,f){if(s.equals2D(f))return 0;var m=ys.relativeSign(s.x,f.x),S=ys.relativeSign(s.y,f.y);switch(r){case 0:return ys.compareValue(m,S);case 1:return ys.compareValue(S,m);case 2:return ys.compareValue(S,-m);case 3:return ys.compareValue(-m,S);case 4:return ys.compareValue(-m,-S);case 5:return ys.compareValue(-S,-m);case 6:return ys.compareValue(-S,m);case 7:return ys.compareValue(m,-S)}return ve.shouldNeverReachHere("invalid octant value"),0},ys.compareValue=function(r,s){return r<0?-1:r>0?1:s<0?-1:s>0?1:0};var sl=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var r=arguments[0],s=arguments[1],f=arguments[2],m=arguments[3];this._segString=r,this.coord=new re(s),this.segmentIndex=f,this._segmentOctant=m,this._isInterior=!s.equals2D(r.getCoordinate(f))};sl.prototype.getCoordinate=function(){return this.coord},sl.prototype.print=function(r){r.print(this.coord),r.print(" seg # = "+this.segmentIndex)},sl.prototype.compareTo=function(r){var s=r;return this.segmentIndex<s.segmentIndex?-1:this.segmentIndex>s.segmentIndex?1:this.coord.equals2D(s.coord)?0:ys.compare(this._segmentOctant,this.coord,s.coord)},sl.prototype.isEndPoint=function(r){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===r},sl.prototype.isInterior=function(){return this._isInterior},sl.prototype.interfaces_=function(){return[ne]},sl.prototype.getClass=function(){return sl};var $o=function(){this._nodeMap=new xe,this._edge=null,this._edge=arguments[0]};$o.prototype.getSplitCoordinates=function(){var r=new Ys;this.addEndpoints();for(var s=this.iterator(),f=s.next();s.hasNext();){var m=s.next();this.addEdgeCoordinates(f,m,r),f=m}return r.toCoordinateArray()},$o.prototype.addCollapsedNodes=function(){var r=new Mr;this.findCollapsesFromInsertedNodes(r),this.findCollapsesFromExistingVertices(r);for(var s=r.iterator();s.hasNext();){var f=s.next().intValue();this.add(this._edge.getCoordinate(f),f)}},$o.prototype.print=function(r){r.println("Intersections:");for(var s=this.iterator();s.hasNext();)s.next().print(r)},$o.prototype.findCollapsesFromExistingVertices=function(r){for(var s=0;s<this._edge.size()-2;s++){var f=this._edge.getCoordinate(s),m=this._edge.getCoordinate(s+2);f.equals2D(m)&&r.add(new pt(s+1))}},$o.prototype.addEdgeCoordinates=function(r,s,f){var m=this._edge.getCoordinate(s.segmentIndex),S=s.isInterior()||!s.coord.equals2D(m);f.add(new re(r.coord),!1);for(var k=r.segmentIndex+1;k<=s.segmentIndex;k++)f.add(this._edge.getCoordinate(k));S&&f.add(new re(s.coord))},$o.prototype.iterator=function(){return this._nodeMap.values().iterator()},$o.prototype.addSplitEdges=function(r){this.addEndpoints(),this.addCollapsedNodes();for(var s=this.iterator(),f=s.next();s.hasNext();){var m=s.next(),S=this.createSplitEdge(f,m);r.add(S),f=m}},$o.prototype.findCollapseIndex=function(r,s,f){if(!r.coord.equals2D(s.coord))return!1;var m=s.segmentIndex-r.segmentIndex;return s.isInterior()||m--,1===m&&(f[0]=r.segmentIndex+1,!0)},$o.prototype.findCollapsesFromInsertedNodes=function(r){for(var s=new Array(1).fill(null),f=this.iterator(),m=f.next();f.hasNext();){var S=f.next();this.findCollapseIndex(m,S,s)&&r.add(new pt(s[0])),m=S}},$o.prototype.getEdge=function(){return this._edge},$o.prototype.addEndpoints=function(){var r=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(r),r)},$o.prototype.createSplitEdge=function(r,s){var f=s.segmentIndex-r.segmentIndex+2,m=this._edge.getCoordinate(s.segmentIndex),S=s.isInterior()||!s.coord.equals2D(m);S||f--;var k=new Array(f).fill(null),V=0;k[V++]=new re(r.coord);for(var de=r.segmentIndex+1;de<=s.segmentIndex;de++)k[V++]=this._edge.getCoordinate(de);return S&&(k[V]=new re(s.coord)),new lo(k,this._edge.getData())},$o.prototype.add=function(r,s){var f=new sl(this._edge,r,s,this._edge.getSegmentOctant(s)),m=this._nodeMap.get(f);return null!==m?(ve.isTrue(m.coord.equals2D(r),"Found equal nodes with different coordinates"),m):(this._nodeMap.put(f,f),f)},$o.prototype.checkSplitEdgesCorrectness=function(r){var s=this._edge.getCoordinates(),f=r.get(0).getCoordinate(0);if(!f.equals2D(s[0]))throw new Se("bad split edge start point at "+f);var m=r.get(r.size()-1).getCoordinates(),S=m[m.length-1];if(!S.equals2D(s[s.length-1]))throw new Se("bad split edge end point at "+S)},$o.prototype.interfaces_=function(){return[]},$o.prototype.getClass=function(){return $o};var Fa=function(){};Fa.prototype.interfaces_=function(){return[]},Fa.prototype.getClass=function(){return Fa},Fa.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var r=arguments[0],s=arguments[1];if(0===r&&0===s)throw new X("Cannot compute the octant for point ( "+r+", "+s+" )");var f=Math.abs(r),m=Math.abs(s);return r>=0?s>=0?f>=m?0:1:f>=m?7:6:s>=0?f>=m?3:2:f>=m?4:5}if(arguments[0]instanceof re&&arguments[1]instanceof re){var S=arguments[0],k=arguments[1],V=k.x-S.x,de=k.y-S.y;if(0===V&&0===de)throw new X("Cannot compute the octant for two identical points "+S);return Fa.octant(V,de)}};var La=function(){};La.prototype.getCoordinates=function(){},La.prototype.size=function(){},La.prototype.getCoordinate=function(r){},La.prototype.isClosed=function(){},La.prototype.setData=function(r){},La.prototype.getData=function(){},La.prototype.interfaces_=function(){return[]},La.prototype.getClass=function(){return La};var Wl=function(){};Wl.prototype.addIntersection=function(r,s){},Wl.prototype.interfaces_=function(){return[La]},Wl.prototype.getClass=function(){return Wl};var lo=function(){this._nodeList=new $o(this),this._pts=null,this._data=null;var s=arguments[1];this._pts=arguments[0],this._data=s};lo.prototype.getCoordinates=function(){return this._pts},lo.prototype.size=function(){return this._pts.length},lo.prototype.getCoordinate=function(r){return this._pts[r]},lo.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},lo.prototype.getSegmentOctant=function(r){return r===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(r),this.getCoordinate(r+1))},lo.prototype.setData=function(r){this._data=r},lo.prototype.safeOctant=function(r,s){return r.equals2D(s)?0:Fa.octant(r,s)},lo.prototype.getData=function(){return this._data},lo.prototype.addIntersection=function(){if(2===arguments.length)this.addIntersectionNode(arguments[0],arguments[1]);else if(4===arguments.length){var m=arguments[1],k=new re(arguments[0].getIntersection(arguments[3]));this.addIntersection(k,m)}},lo.prototype.toString=function(){return st.toLineString(new oi(this._pts))},lo.prototype.getNodeList=function(){return this._nodeList},lo.prototype.addIntersectionNode=function(r,s){var f=s,m=f+1;return m<this._pts.length&&r.equals2D(this._pts[m])&&(f=m),this._nodeList.add(r,f)},lo.prototype.addIntersections=function(r,s,f){for(var m=0;m<r.getIntersectionNum();m++)this.addIntersection(r,s,f,m)},lo.prototype.interfaces_=function(){return[Wl]},lo.prototype.getClass=function(){return lo},lo.getNodedSubstrings=function(){if(1===arguments.length){var r=arguments[0],s=new Mr;return lo.getNodedSubstrings(r,s),s}if(2===arguments.length)for(var m=arguments[1],S=arguments[0].iterator();S.hasNext();)S.next().getNodeList().addSplitEdges(m)};var _n=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new re,this.p1=new re;else if(1===arguments.length){var r=arguments[0];this.p0=new re(r.p0),this.p1=new re(r.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var m=arguments[2],S=arguments[3];this.p0=new re(arguments[0],arguments[1]),this.p1=new re(m,S)}},Al={serialVersionUID:{configurable:!0}};_n.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},_n.prototype.orientationIndex=function(){if(arguments[0]instanceof _n){var r=arguments[0],s=rr.orientationIndex(this.p0,this.p1,r.p0),f=rr.orientationIndex(this.p0,this.p1,r.p1);return s>=0&&f>=0||s<=0&&f<=0?Math.max(s,f):0}if(arguments[0]instanceof re)return rr.orientationIndex(this.p0,this.p1,arguments[0])},_n.prototype.toGeometry=function(r){return r.createLineString([this.p0,this.p1])},_n.prototype.isVertical=function(){return this.p0.x===this.p1.x},_n.prototype.equals=function(r){if(!(r instanceof _n))return!1;var s=r;return this.p0.equals(s.p0)&&this.p1.equals(s.p1)},_n.prototype.intersection=function(r){var s=new Xt;return s.computeIntersection(this.p0,this.p1,r.p0,r.p1),s.hasIntersection()?s.getIntersection(0):null},_n.prototype.project=function(){if(arguments[0]instanceof re){var r=arguments[0];if(r.equals(this.p0)||r.equals(this.p1))return new re(r);var s=this.projectionFactor(r),f=new re;return f.x=this.p0.x+s*(this.p1.x-this.p0.x),f.y=this.p0.y+s*(this.p1.y-this.p0.y),f}if(arguments[0]instanceof _n){var m=arguments[0],S=this.projectionFactor(m.p0),k=this.projectionFactor(m.p1);if(S>=1&&k>=1||S<=0&&k<=0)return null;var V=this.project(m.p0);S<0&&(V=this.p0),S>1&&(V=this.p1);var de=this.project(m.p1);return k<0&&(de=this.p0),k>1&&(de=this.p1),new _n(V,de)}},_n.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},_n.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},_n.prototype.getCoordinate=function(r){return 0===r?this.p0:this.p1},_n.prototype.distancePerpendicular=function(r){return rr.distancePointLinePerpendicular(r,this.p0,this.p1)},_n.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},_n.prototype.midPoint=function(){return _n.midPoint(this.p0,this.p1)},_n.prototype.projectionFactor=function(r){if(r.equals(this.p0))return 0;if(r.equals(this.p1))return 1;var s=this.p1.x-this.p0.x,f=this.p1.y-this.p0.y,m=s*s+f*f;return m<=0?ee.NaN:((r.x-this.p0.x)*s+(r.y-this.p0.y)*f)/m},_n.prototype.closestPoints=function(r){var s=this.intersection(r);if(null!==s)return[s,s];var f=new Array(2).fill(null),m=ee.MAX_VALUE,S=null,k=this.closestPoint(r.p0);m=k.distance(r.p0),f[0]=k,f[1]=r.p0;var V=this.closestPoint(r.p1);(S=V.distance(r.p1))<m&&(m=S,f[0]=V,f[1]=r.p1);var de=r.closestPoint(this.p0);(S=de.distance(this.p0))<m&&(m=S,f[0]=this.p0,f[1]=de);var Re=r.closestPoint(this.p1);return(S=Re.distance(this.p1))<m&&(m=S,f[0]=this.p1,f[1]=Re),f},_n.prototype.closestPoint=function(r){var s=this.projectionFactor(r);return s>0&&s<1?this.project(r):this.p0.distance(r)<this.p1.distance(r)?this.p0:this.p1},_n.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},_n.prototype.getLength=function(){return this.p0.distance(this.p1)},_n.prototype.compareTo=function(r){var s=r,f=this.p0.compareTo(s.p0);return 0!==f?f:this.p1.compareTo(s.p1)},_n.prototype.reverse=function(){var r=this.p0;this.p0=this.p1,this.p1=r},_n.prototype.equalsTopo=function(r){return this.p0.equals(r.p0)&&(this.p1.equals(r.p1)||this.p0.equals(r.p1))&&this.p1.equals(r.p0)},_n.prototype.lineIntersection=function(r){try{return Ar.intersection(this.p0,this.p1,r.p0,r.p1)}catch(s){if(!(s instanceof zr))throw s}return null},_n.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},_n.prototype.pointAlongOffset=function(r,s){var f=this.p0.x+r*(this.p1.x-this.p0.x),m=this.p0.y+r*(this.p1.y-this.p0.y),S=this.p1.x-this.p0.x,k=this.p1.y-this.p0.y,V=Math.sqrt(S*S+k*k),de=0,Re=0;if(0!==s){if(V<=0)throw new Error("Cannot compute offset from zero-length line segment");de=s*S/V,Re=s*k/V}return new re(f-Re,m+de)},_n.prototype.setCoordinates=function(){if(1===arguments.length){var r=arguments[0];this.setCoordinates(r.p0,r.p1)}else if(2===arguments.length){var s=arguments[0],f=arguments[1];this.p0.x=s.x,this.p0.y=s.y,this.p1.x=f.x,this.p1.y=f.y}},_n.prototype.segmentFraction=function(r){var s=this.projectionFactor(r);return s<0?s=0:(s>1||ee.isNaN(s))&&(s=1),s},_n.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},_n.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},_n.prototype.distance=function(){if(arguments[0]instanceof _n){var r=arguments[0];return rr.distanceLineLine(this.p0,this.p1,r.p0,r.p1)}if(arguments[0]instanceof re)return rr.distancePointLine(arguments[0],this.p0,this.p1)},_n.prototype.pointAlong=function(r){var s=new re;return s.x=this.p0.x+r*(this.p1.x-this.p0.x),s.y=this.p0.y+r*(this.p1.y-this.p0.y),s},_n.prototype.hashCode=function(){var r=ee.doubleToLongBits(this.p0.x);r^=31*ee.doubleToLongBits(this.p0.y);var s=Math.trunc(r)^Math.trunc(r>>32),f=ee.doubleToLongBits(this.p1.x);return f^=31*ee.doubleToLongBits(this.p1.y),s^Math.trunc(f)^Math.trunc(f>>32)},_n.prototype.interfaces_=function(){return[ne,ae]},_n.prototype.getClass=function(){return _n},_n.midPoint=function(r,s){return new re((r.x+s.x)/2,(r.y+s.y)/2)},Al.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(_n,Al);var wi=function(){this.tempEnv1=new xr,this.tempEnv2=new xr,this._overlapSeg1=new _n,this._overlapSeg2=new _n};wi.prototype.overlap=function(){if(2!==arguments.length&&4===arguments.length){var f=arguments[2],m=arguments[3];arguments[0].getLineSegment(arguments[1],this._overlapSeg1),f.getLineSegment(m,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},wi.prototype.interfaces_=function(){return[]},wi.prototype.getClass=function(){return wi};var ua=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var s=arguments[1],f=arguments[2],m=arguments[3];this._pts=arguments[0],this._start=s,this._end=f,this._context=m};ua.prototype.getLineSegment=function(r,s){s.p0=this._pts[r],s.p1=this._pts[r+1]},ua.prototype.computeSelect=function(r,s,f,m){if(m.tempEnv1.init(this._pts[s],this._pts[f]),f-s==1)return m.select(this,s),null;if(!r.intersects(m.tempEnv1))return null;var V=Math.trunc((s+f)/2);s<V&&this.computeSelect(r,s,V,m),V<f&&this.computeSelect(r,V,f,m)},ua.prototype.getCoordinates=function(){for(var r=new Array(this._end-this._start+1).fill(null),s=0,f=this._start;f<=this._end;f++)r[s++]=this._pts[f];return r},ua.prototype.computeOverlaps=function(r,s){this.computeOverlapsInternal(this._start,this._end,r,r._start,r._end,s)},ua.prototype.setId=function(r){this._id=r},ua.prototype.select=function(r,s){this.computeSelect(r,this._start,this._end,s)},ua.prototype.getEnvelope=function(){return null===this._env&&(this._env=new xr(this._pts[this._start],this._pts[this._end])),this._env},ua.prototype.getEndIndex=function(){return this._end},ua.prototype.getStartIndex=function(){return this._start},ua.prototype.getContext=function(){return this._context},ua.prototype.getId=function(){return this._id},ua.prototype.computeOverlapsInternal=function(r,s,f,m,S,k){var V=this._pts[r],de=this._pts[s],Re=f._pts[m],yt=f._pts[S];if(s-r==1&&S-m==1)return k.overlap(this,r,f,m),null;if(k.tempEnv1.init(V,de),k.tempEnv2.init(Re,yt),!k.tempEnv1.intersects(k.tempEnv2))return null;var gt=Math.trunc((r+s)/2),ar=Math.trunc((m+S)/2);r<gt&&(m<ar&&this.computeOverlapsInternal(r,gt,f,m,ar,k),ar<S&&this.computeOverlapsInternal(r,gt,f,ar,S,k)),gt<s&&(m<ar&&this.computeOverlapsInternal(gt,s,f,m,ar,k),ar<S&&this.computeOverlapsInternal(gt,s,f,ar,S,k))},ua.prototype.interfaces_=function(){return[]},ua.prototype.getClass=function(){return ua};var xa=function(){};xa.prototype.interfaces_=function(){return[]},xa.prototype.getClass=function(){return xa},xa.getChainStartIndices=function(r){var s=0,f=new Mr;f.add(new pt(s));do{var m=xa.findChainEnd(r,s);f.add(new pt(m)),s=m}while(s<r.length-1);return xa.toIntArray(f)},xa.findChainEnd=function(r,s){for(var f=s;f<r.length-1&&r[f].equals2D(r[f+1]);)f++;if(f>=r.length-1)return r.length-1;for(var m=xn.quadrant(r[f],r[f+1]),S=s+1;S<r.length&&(r[S-1].equals2D(r[S])||xn.quadrant(r[S-1],r[S])===m);)S++;return S-1},xa.getChains=function(){if(1===arguments.length)return xa.getChains(arguments[0],null);if(2===arguments.length){for(var s=arguments[0],f=arguments[1],m=new Mr,S=xa.getChainStartIndices(s),k=0;k<S.length-1;k++){var V=new ua(s,S[k],S[k+1],f);m.add(V)}return m}},xa.toIntArray=function(r){for(var s=new Array(r.size()).fill(null),f=0;f<s.length;f++)s[f]=r.get(f).intValue();return s};var al=function(){};al.prototype.computeNodes=function(r){},al.prototype.getNodedSubstrings=function(){},al.prototype.interfaces_=function(){return[]},al.prototype.getClass=function(){return al};var Ya=function(){this._segInt=null,0!==arguments.length&&1===arguments.length&&this.setSegmentIntersector(arguments[0])};Ya.prototype.setSegmentIntersector=function(r){this._segInt=r},Ya.prototype.interfaces_=function(){return[al]},Ya.prototype.getClass=function(){return Ya};var ll=function(r){function s(m){m?r.call(this,m):r.call(this),this._monoChains=new Mr,this._index=new ku,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s;var f={SegmentOverlapAction:{configurable:!0}};return s.prototype.getMonotoneChains=function(){return this._monoChains},s.prototype.getNodedSubstrings=function(){return lo.getNodedSubstrings(this._nodedSegStrings)},s.prototype.getIndex=function(){return this._index},s.prototype.add=function(m){for(var S=xa.getChains(m.getCoordinates(),m).iterator();S.hasNext();){var k=S.next();k.setId(this._idCounter++),this._index.insert(k.getEnvelope(),k),this._monoChains.add(k)}},s.prototype.computeNodes=function(m){this._nodedSegStrings=m;for(var S=m.iterator();S.hasNext();)this.add(S.next());this.intersectChains()},s.prototype.intersectChains=function(){for(var m=new ba(this._segInt),S=this._monoChains.iterator();S.hasNext();)for(var k=S.next(),V=this._index.query(k.getEnvelope()).iterator();V.hasNext();){var de=V.next();if(de.getId()>k.getId()&&(k.computeOverlaps(de,m),this._nOverlaps++),this._segInt.isDone())return null}},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},f.SegmentOverlapAction.get=function(){return ba},Object.defineProperties(s,f),s}(Ya),ba=function(r){function s(){r.call(this),this._si=null,this._si=arguments[0]}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.overlap=function(){if(4!==arguments.length)return r.prototype.overlap.apply(this,arguments);var m=arguments[1],S=arguments[2],k=arguments[3],V=arguments[0].getContext(),de=S.getContext();this._si.processIntersections(V,m,de,k)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(wi),ni=function r(){if(this._quadrantSegments=r.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=r.CAP_ROUND,this._joinStyle=r.JOIN_ROUND,this._mitreLimit=r.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=r.DEFAULT_SIMPLIFY_FACTOR,0!==arguments.length)if(1===arguments.length)this.setQuadrantSegments(arguments[0]);else if(2===arguments.length){var m=arguments[1];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(m)}else if(4===arguments.length){var k=arguments[1],V=arguments[2],de=arguments[3];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(k),this.setJoinStyle(V),this.setMitreLimit(de)}},wa={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};ni.prototype.getEndCapStyle=function(){return this._endCapStyle},ni.prototype.isSingleSided=function(){return this._isSingleSided},ni.prototype.setQuadrantSegments=function(r){this._quadrantSegments=r,0===this._quadrantSegments&&(this._joinStyle=ni.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=ni.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),r<=0&&(this._quadrantSegments=1),this._joinStyle!==ni.JOIN_ROUND&&(this._quadrantSegments=ni.DEFAULT_QUADRANT_SEGMENTS)},ni.prototype.getJoinStyle=function(){return this._joinStyle},ni.prototype.setJoinStyle=function(r){this._joinStyle=r},ni.prototype.setSimplifyFactor=function(r){this._simplifyFactor=r<0?0:r},ni.prototype.getSimplifyFactor=function(){return this._simplifyFactor},ni.prototype.getQuadrantSegments=function(){return this._quadrantSegments},ni.prototype.setEndCapStyle=function(r){this._endCapStyle=r},ni.prototype.getMitreLimit=function(){return this._mitreLimit},ni.prototype.setMitreLimit=function(r){this._mitreLimit=r},ni.prototype.setSingleSided=function(r){this._isSingleSided=r},ni.prototype.interfaces_=function(){return[]},ni.prototype.getClass=function(){return ni},ni.bufferDistanceError=function(r){var s=Math.PI/2/r;return 1-Math.cos(s/2)},wa.CAP_ROUND.get=function(){return 1},wa.CAP_FLAT.get=function(){return 2},wa.CAP_SQUARE.get=function(){return 3},wa.JOIN_ROUND.get=function(){return 1},wa.JOIN_MITRE.get=function(){return 2},wa.JOIN_BEVEL.get=function(){return 3},wa.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},wa.DEFAULT_MITRE_LIMIT.get=function(){return 5},wa.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(ni,wa);var Ri=function(r){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=rr.COUNTERCLOCKWISE,this._inputLine=r||null},vl={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Ri.prototype.isDeletable=function(r,s,f,m){var S=this._inputLine[r],k=this._inputLine[s],V=this._inputLine[f];return!!this.isConcave(S,k,V)&&!!this.isShallow(S,k,V,m)&&this.isShallowSampled(S,k,r,f,m)},Ri.prototype.deleteShallowConcavities=function(){for(var r=1,s=this.findNextNonDeletedIndex(r),f=this.findNextNonDeletedIndex(s),m=!1;f<this._inputLine.length;){var S=!1;this.isDeletable(r,s,f,this._distanceTol)&&(this._isDeleted[s]=Ri.DELETE,S=!0,m=!0),s=this.findNextNonDeletedIndex(r=S?f:s),f=this.findNextNonDeletedIndex(s)}return m},Ri.prototype.isShallowConcavity=function(r,s,f,m){return rr.computeOrientation(r,s,f)===this._angleOrientation&&rr.distancePointLine(s,r,f)<m},Ri.prototype.isShallowSampled=function(r,s,f,m,S){var k=Math.trunc((m-f)/Ri.NUM_PTS_TO_CHECK);k<=0&&(k=1);for(var V=f;V<m;V+=k)if(!this.isShallow(r,s,this._inputLine[V],S))return!1;return!0},Ri.prototype.isConcave=function(r,s,f){return rr.computeOrientation(r,s,f)===this._angleOrientation},Ri.prototype.simplify=function(r){this._distanceTol=Math.abs(r),r<0&&(this._angleOrientation=rr.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var s=!1;do{s=this.deleteShallowConcavities()}while(s);return this.collapseLine()},Ri.prototype.findNextNonDeletedIndex=function(r){for(var s=r+1;s<this._inputLine.length&&this._isDeleted[s]===Ri.DELETE;)s++;return s},Ri.prototype.isShallow=function(r,s,f,m){return rr.distancePointLine(s,r,f)<m},Ri.prototype.collapseLine=function(){for(var r=new Ys,s=0;s<this._inputLine.length;s++)this._isDeleted[s]!==Ri.DELETE&&r.add(this._inputLine[s]);return r.toCoordinateArray()},Ri.prototype.interfaces_=function(){return[]},Ri.prototype.getClass=function(){return Ri},Ri.simplify=function(r,s){return new Ri(r).simplify(s)},vl.INIT.get=function(){return 0},vl.DELETE.get=function(){return 1},vl.KEEP.get=function(){return 1},vl.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Ri,vl);var Uo=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Mr},Ll={COORDINATE_ARRAY_TYPE:{configurable:!0}};Uo.prototype.getCoordinates=function(){return this._ptList.toArray(Uo.COORDINATE_ARRAY_TYPE)},Uo.prototype.setPrecisionModel=function(r){this._precisionModel=r},Uo.prototype.addPt=function(r){var s=new re(r);if(this._precisionModel.makePrecise(s),this.isRedundant(s))return null;this._ptList.add(s)},Uo.prototype.revere=function(){},Uo.prototype.addPts=function(r,s){if(s)for(var f=0;f<r.length;f++)this.addPt(r[f]);else for(var m=r.length-1;m>=0;m--)this.addPt(r[m])},Uo.prototype.isRedundant=function(r){if(this._ptList.size()<1)return!1;var s=this._ptList.get(this._ptList.size()-1);return r.distance(s)<this._minimimVertexDistance},Uo.prototype.toString=function(){return(new $n).createLineString(this.getCoordinates()).toString()},Uo.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var r=new re(this._ptList.get(0)),s=this._ptList.get(this._ptList.size()-1);if(r.equals(s))return null;this._ptList.add(r)},Uo.prototype.setMinimumVertexDistance=function(r){this._minimimVertexDistance=r},Uo.prototype.interfaces_=function(){return[]},Uo.prototype.getClass=function(){return Uo},Ll.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Uo,Ll);var si=function(){},xl={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};si.prototype.interfaces_=function(){return[]},si.prototype.getClass=function(){return si},si.toDegrees=function(r){return 180*r/Math.PI},si.normalize=function(r){for(;r>Math.PI;)r-=si.PI_TIMES_2;for(;r<=-Math.PI;)r+=si.PI_TIMES_2;return r},si.angle=function(){if(1===arguments.length){var r=arguments[0];return Math.atan2(r.y,r.x)}if(2===arguments.length){var s=arguments[0],f=arguments[1];return Math.atan2(f.y-s.y,f.x-s.x)}},si.isAcute=function(r,s,f){return(r.x-s.x)*(f.x-s.x)+(r.y-s.y)*(f.y-s.y)>0},si.isObtuse=function(r,s,f){return(r.x-s.x)*(f.x-s.x)+(r.y-s.y)*(f.y-s.y)<0},si.interiorAngle=function(r,s,f){var m=si.angle(s,r),S=si.angle(s,f);return Math.abs(S-m)},si.normalizePositive=function(r){if(r<0){for(;r<0;)r+=si.PI_TIMES_2;r>=si.PI_TIMES_2&&(r=0)}else{for(;r>=si.PI_TIMES_2;)r-=si.PI_TIMES_2;r<0&&(r=0)}return r},si.angleBetween=function(r,s,f){var m=si.angle(s,r),S=si.angle(s,f);return si.diff(m,S)},si.diff=function(r,s){var f=null;return(f=r<s?s-r:r-s)>Math.PI&&(f=2*Math.PI-f),f},si.toRadians=function(r){return r*Math.PI/180},si.getTurn=function(r,s){var f=Math.sin(s-r);return f>0?si.COUNTERCLOCKWISE:f<0?si.CLOCKWISE:si.NONE},si.angleBetweenOriented=function(r,s,f){var m=si.angle(s,r),S=si.angle(s,f)-m;return S<=-Math.PI?S+si.PI_TIMES_2:S>Math.PI?S-si.PI_TIMES_2:S},xl.PI_TIMES_2.get=function(){return 2*Math.PI},xl.PI_OVER_2.get=function(){return Math.PI/2},xl.PI_OVER_4.get=function(){return Math.PI/4},xl.COUNTERCLOCKWISE.get=function(){return rr.COUNTERCLOCKWISE},xl.CLOCKWISE.get=function(){return rr.CLOCKWISE},xl.NONE.get=function(){return rr.COLLINEAR},Object.defineProperties(si,xl);var wn=function r(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new _n,this._seg1=new _n,this._offset0=new _n,this._offset1=new _n,this._side=0,this._hasNarrowConcaveAngle=!1;var f=arguments[1],m=arguments[2];this._precisionModel=arguments[0],this._bufParams=f,this._li=new Xt,this._filletAngleQuantum=Math.PI/2/f.getQuadrantSegments(),f.getQuadrantSegments()>=8&&f.getJoinStyle()===ni.JOIN_ROUND&&(this._closingSegLengthFactor=r.MAX_CLOSING_SEG_LEN_FACTOR),this.init(m)},Dl={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};wn.prototype.addNextSegment=function(r,s){if(this._s0=this._s1,this._s1=this._s2,this._s2=r,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var f=rr.computeOrientation(this._s0,this._s1,this._s2),m=f===rr.CLOCKWISE&&this._side===et.LEFT||f===rr.COUNTERCLOCKWISE&&this._side===et.RIGHT;0===f?this.addCollinear(s):m?this.addOutsideTurn(f,s):this.addInsideTurn(f,s)},wn.prototype.addLineEndCap=function(r,s){var f=new _n(r,s),m=new _n;this.computeOffsetSegment(f,et.LEFT,this._distance,m);var S=new _n;this.computeOffsetSegment(f,et.RIGHT,this._distance,S);var de=Math.atan2(s.y-r.y,s.x-r.x);switch(this._bufParams.getEndCapStyle()){case ni.CAP_ROUND:this._segList.addPt(m.p1),this.addFilletArc(s,de+Math.PI/2,de-Math.PI/2,rr.CLOCKWISE,this._distance),this._segList.addPt(S.p1);break;case ni.CAP_FLAT:this._segList.addPt(m.p1),this._segList.addPt(S.p1);break;case ni.CAP_SQUARE:var Re=new re;Re.x=Math.abs(this._distance)*Math.cos(de),Re.y=Math.abs(this._distance)*Math.sin(de);var yt=new re(m.p1.x+Re.x,m.p1.y+Re.y),gt=new re(S.p1.x+Re.x,S.p1.y+Re.y);this._segList.addPt(yt),this._segList.addPt(gt)}},wn.prototype.getCoordinates=function(){return this._segList.getCoordinates()},wn.prototype.addMitreJoin=function(r,s,f,m){var S=!0,k=null;try{k=Ar.intersection(s.p0,s.p1,f.p0,f.p1),(m<=0?1:k.distance(r)/Math.abs(m))>this._bufParams.getMitreLimit()&&(S=!1)}catch(V){if(!(V instanceof zr))throw V;k=new re(0,0),S=!1}S?this._segList.addPt(k):this.addLimitedMitreJoin(s,f,m,this._bufParams.getMitreLimit())},wn.prototype.addFilletCorner=function(r,s,f,m,S){var de=Math.atan2(s.y-r.y,s.x-r.x),gt=Math.atan2(f.y-r.y,f.x-r.x);m===rr.CLOCKWISE?de<=gt&&(de+=2*Math.PI):de>=gt&&(de-=2*Math.PI),this._segList.addPt(s),this.addFilletArc(r,de,gt,m,S),this._segList.addPt(f)},wn.prototype.addOutsideTurn=function(r,s){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*wn.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===ni.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===ni.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(s&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,r,this._distance),this._segList.addPt(this._offset1.p0))},wn.prototype.createSquare=function(r){this._segList.addPt(new re(r.x+this._distance,r.y+this._distance)),this._segList.addPt(new re(r.x+this._distance,r.y-this._distance)),this._segList.addPt(new re(r.x-this._distance,r.y-this._distance)),this._segList.addPt(new re(r.x-this._distance,r.y+this._distance)),this._segList.closeRing()},wn.prototype.addSegments=function(r,s){this._segList.addPts(r,s)},wn.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},wn.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},wn.prototype.initSideSegments=function(r,s,f){this._s1=r,this._s2=s,this._side=f,this._seg1.setCoordinates(r,s),this.computeOffsetSegment(this._seg1,f,this._distance,this._offset1)},wn.prototype.addLimitedMitreJoin=function(r,s,f,m){var S=this._seg0.p1,k=si.angle(S,this._seg0.p0),V=si.angleBetweenOriented(this._seg0.p0,S,this._seg1.p1)/2,de=si.normalize(k+V),Re=si.normalize(de+Math.PI),yt=m*f,gt=f-yt*Math.abs(Math.sin(V)),ar=S.x+yt*Math.cos(Re),Gr=S.y+yt*Math.sin(Re),Br=new re(ar,Gr),sn=new _n(S,Br),Mn=sn.pointAlongOffset(1,gt),no=sn.pointAlongOffset(1,-gt);this._side===et.LEFT?(this._segList.addPt(Mn),this._segList.addPt(no)):(this._segList.addPt(no),this._segList.addPt(Mn))},wn.prototype.computeOffsetSegment=function(r,s,f,m){var S=s===et.LEFT?1:-1,k=r.p1.x-r.p0.x,V=r.p1.y-r.p0.y,de=Math.sqrt(k*k+V*V),Re=S*f*k/de,yt=S*f*V/de;m.p0.x=r.p0.x-yt,m.p0.y=r.p0.y+Re,m.p1.x=r.p1.x-yt,m.p1.y=r.p1.y+Re},wn.prototype.addFilletArc=function(r,s,f,m,S){var k=m===rr.CLOCKWISE?-1:1,V=Math.abs(s-f),de=Math.trunc(V/this._filletAngleQuantum+.5);if(de<1)return null;for(var Re=V/de,yt=0,gt=new re;yt<V;){var ar=s+k*yt;gt.x=r.x+S*Math.cos(ar),gt.y=r.y+S*Math.sin(ar),this._segList.addPt(gt),yt+=Re}},wn.prototype.addInsideTurn=function(r,s){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*wn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var f=new re((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(f);var m=new re((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(m)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},wn.prototype.createCircle=function(r){var s=new re(r.x+this._distance,r.y);this._segList.addPt(s),this.addFilletArc(r,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},wn.prototype.addBevelJoin=function(r,s){this._segList.addPt(r.p1),this._segList.addPt(s.p0)},wn.prototype.init=function(r){this._distance=r,this._maxCurveSegmentError=r*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Uo,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(r*wn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},wn.prototype.addCollinear=function(r){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===ni.JOIN_BEVEL||this._bufParams.getJoinStyle()===ni.JOIN_MITRE?(r&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,rr.CLOCKWISE,this._distance))},wn.prototype.closeRing=function(){this._segList.closeRing()},wn.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},wn.prototype.interfaces_=function(){return[]},wn.prototype.getClass=function(){return wn},Dl.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Dl.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Dl.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Dl.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(wn,Dl);var ms=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var s=arguments[1];this._precisionModel=arguments[0],this._bufParams=s};ms.prototype.getOffsetCurve=function(r,s){if(this._distance=s,0===s)return null;var f=s<0,m=Math.abs(s),S=this.getSegGen(m);r.length<=1?this.computePointCurve(r[0],S):this.computeOffsetCurve(r,f,S);var k=S.getCoordinates();return f&&Sn.reverse(k),k},ms.prototype.computeSingleSidedBufferCurve=function(r,s,f){var m=this.simplifyTolerance(this._distance);if(s){f.addSegments(r,!0);var S=Ri.simplify(r,-m),k=S.length-1;f.initSideSegments(S[k],S[k-1],et.LEFT),f.addFirstSegment();for(var V=k-2;V>=0;V--)f.addNextSegment(S[V],!0)}else{f.addSegments(r,!1);var de=Ri.simplify(r,m),Re=de.length-1;f.initSideSegments(de[0],de[1],et.LEFT),f.addFirstSegment();for(var yt=2;yt<=Re;yt++)f.addNextSegment(de[yt],!0)}f.addLastSegment(),f.closeRing()},ms.prototype.computeRingBufferCurve=function(r,s,f){var m=this.simplifyTolerance(this._distance);s===et.RIGHT&&(m=-m);var S=Ri.simplify(r,m),k=S.length-1;f.initSideSegments(S[k-1],S[0],s);for(var V=1;V<=k;V++)f.addNextSegment(S[V],1!==V);f.closeRing()},ms.prototype.computeLineBufferCurve=function(r,s){var f=this.simplifyTolerance(this._distance),m=Ri.simplify(r,f),S=m.length-1;s.initSideSegments(m[0],m[1],et.LEFT);for(var k=2;k<=S;k++)s.addNextSegment(m[k],!0);s.addLastSegment(),s.addLineEndCap(m[S-1],m[S]);var V=Ri.simplify(r,-f),de=V.length-1;s.initSideSegments(V[de],V[de-1],et.LEFT);for(var Re=de-2;Re>=0;Re--)s.addNextSegment(V[Re],!0);s.addLastSegment(),s.addLineEndCap(V[1],V[0]),s.closeRing()},ms.prototype.computePointCurve=function(r,s){switch(this._bufParams.getEndCapStyle()){case ni.CAP_ROUND:s.createCircle(r);break;case ni.CAP_SQUARE:s.createSquare(r)}},ms.prototype.getLineCurve=function(r,s){if(this._distance=s,s<0&&!this._bufParams.isSingleSided()||0===s)return null;var f=Math.abs(s),m=this.getSegGen(f);return r.length<=1?this.computePointCurve(r[0],m):this._bufParams.isSingleSided()?this.computeSingleSidedBufferCurve(r,s<0,m):this.computeLineBufferCurve(r,m),m.getCoordinates()},ms.prototype.getBufferParameters=function(){return this._bufParams},ms.prototype.simplifyTolerance=function(r){return r*this._bufParams.getSimplifyFactor()},ms.prototype.getRingCurve=function(r,s,f){if(this._distance=f,r.length<=2)return this.getLineCurve(r,f);if(0===f)return ms.copyCoordinates(r);var m=this.getSegGen(f);return this.computeRingBufferCurve(r,s,m),m.getCoordinates()},ms.prototype.computeOffsetCurve=function(r,s,f){var m=this.simplifyTolerance(this._distance);if(s){var S=Ri.simplify(r,-m),k=S.length-1;f.initSideSegments(S[k],S[k-1],et.LEFT),f.addFirstSegment();for(var V=k-2;V>=0;V--)f.addNextSegment(S[V],!0)}else{var de=Ri.simplify(r,m),Re=de.length-1;f.initSideSegments(de[0],de[1],et.LEFT),f.addFirstSegment();for(var yt=2;yt<=Re;yt++)f.addNextSegment(de[yt],!0)}f.addLastSegment()},ms.prototype.getSegGen=function(r){return new wn(this._precisionModel,this._bufParams,r)},ms.prototype.interfaces_=function(){return[]},ms.prototype.getClass=function(){return ms},ms.copyCoordinates=function(r){for(var s=new Array(r.length).fill(null),f=0;f<s.length;f++)s[f]=new re(r[f]);return s};var Wa=function(){this._subgraphs=null,this._seg=new _n,this._cga=new rr,this._subgraphs=arguments[0]},uu={DepthSegment:{configurable:!0}};Wa.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var r=arguments[0],s=new Mr,f=this._subgraphs.iterator();f.hasNext();){var m=f.next(),S=m.getEnvelope();r.y<S.getMinY()||r.y>S.getMaxY()||this.findStabbedSegments(r,m.getDirectedEdges(),s)}return s}if(3===arguments.length)if(Nt(arguments[2],Bn)&&arguments[0]instanceof re&&arguments[1]instanceof zo){for(var k=arguments[0],V=arguments[1],de=arguments[2],Re=V.getEdge().getCoordinates(),yt=0;yt<Re.length-1;yt++)if(this._seg.p0=Re[yt],this._seg.p1=Re[yt+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<k.x||this._seg.isHorizontal()||k.y<this._seg.p0.y||k.y>this._seg.p1.y||rr.computeOrientation(this._seg.p0,this._seg.p1,k)===rr.RIGHT)){var gt=V.getDepth(et.LEFT);this._seg.p0.equals(Re[yt])||(gt=V.getDepth(et.RIGHT));var ar=new Ea(this._seg,gt);de.add(ar)}}else if(Nt(arguments[2],Bn)&&arguments[0]instanceof re&&Nt(arguments[1],Bn))for(var Gr=arguments[0],sn=arguments[2],Mn=arguments[1].iterator();Mn.hasNext();){var no=Mn.next();no.isForward()&&this.findStabbedSegments(Gr,no,sn)}},Wa.prototype.getDepth=function(r){var s=this.findStabbedSegments(r);return 0===s.size()?0:Ms.min(s)._leftDepth},Wa.prototype.interfaces_=function(){return[]},Wa.prototype.getClass=function(){return Wa},uu.DepthSegment.get=function(){return Ea},Object.defineProperties(Wa,uu);var Ea=function(){this._upwardSeg=null,this._leftDepth=null;var s=arguments[1];this._upwardSeg=new _n(arguments[0]),this._leftDepth=s};Ea.prototype.compareTo=function(r){var s=r;if(this._upwardSeg.minX()>=s._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=s._upwardSeg.minX())return-1;var f=this._upwardSeg.orientationIndex(s._upwardSeg);return 0!==f||0!=(f=-1*s._upwardSeg.orientationIndex(this._upwardSeg))?f:this._upwardSeg.compareTo(s._upwardSeg)},Ea.prototype.compareX=function(r,s){var f=r.p0.compareTo(s.p0);return 0!==f?f:r.p1.compareTo(s.p1)},Ea.prototype.toString=function(){return this._upwardSeg.toString()},Ea.prototype.interfaces_=function(){return[ne]},Ea.prototype.getClass=function(){return Ea};var Ii=function(r,s,f){this.p0=r||null,this.p1=s||null,this.p2=f||null};Ii.prototype.area=function(){return Ii.area(this.p0,this.p1,this.p2)},Ii.prototype.signedArea=function(){return Ii.signedArea(this.p0,this.p1,this.p2)},Ii.prototype.interpolateZ=function(r){if(null===r)throw new X("Supplied point is null.");return Ii.interpolateZ(r,this.p0,this.p1,this.p2)},Ii.prototype.longestSideLength=function(){return Ii.longestSideLength(this.p0,this.p1,this.p2)},Ii.prototype.isAcute=function(){return Ii.isAcute(this.p0,this.p1,this.p2)},Ii.prototype.circumcentre=function(){return Ii.circumcentre(this.p0,this.p1,this.p2)},Ii.prototype.area3D=function(){return Ii.area3D(this.p0,this.p1,this.p2)},Ii.prototype.centroid=function(){return Ii.centroid(this.p0,this.p1,this.p2)},Ii.prototype.inCentre=function(){return Ii.inCentre(this.p0,this.p1,this.p2)},Ii.prototype.interfaces_=function(){return[]},Ii.prototype.getClass=function(){return Ii},Ii.area=function(r,s,f){return Math.abs(((f.x-r.x)*(s.y-r.y)-(s.x-r.x)*(f.y-r.y))/2)},Ii.signedArea=function(r,s,f){return((f.x-r.x)*(s.y-r.y)-(s.x-r.x)*(f.y-r.y))/2},Ii.det=function(r,s,f,m){return r*m-s*f},Ii.interpolateZ=function(r,s,f,m){var S=s.x,k=s.y,V=f.x-S,de=m.x-S,Re=f.y-k,yt=m.y-k,gt=V*yt-de*Re,ar=r.x-S,Gr=r.y-k;return s.z+(yt*ar-de*Gr)/gt*(f.z-s.z)+(-Re*ar+V*Gr)/gt*(m.z-s.z)},Ii.longestSideLength=function(r,s,f){var m=r.distance(s),S=s.distance(f),k=f.distance(r),V=m;return S>V&&(V=S),k>V&&(V=k),V},Ii.isAcute=function(r,s,f){return!!si.isAcute(r,s,f)&&!!si.isAcute(s,f,r)&&!!si.isAcute(f,r,s)},Ii.circumcentre=function(r,s,f){var m=f.x,S=f.y,k=r.x-m,V=r.y-S,de=s.x-m,Re=s.y-S,yt=2*Ii.det(k,V,de,Re),gt=Ii.det(V,k*k+V*V,Re,de*de+Re*Re),ar=Ii.det(k,k*k+V*V,de,de*de+Re*Re);return new re(m-gt/yt,S+ar/yt)},Ii.perpendicularBisector=function(r,s){var f=s.x-r.x,m=s.y-r.y,S=new Ar(r.x+f/2,r.y+m/2,1),k=new Ar(r.x-m+f/2,r.y+f+m/2,1);return new Ar(S,k)},Ii.angleBisector=function(r,s,f){var m=s.distance(r),S=m/(m+s.distance(f));return new re(r.x+S*(f.x-r.x),r.y+S*(f.y-r.y))},Ii.area3D=function(r,s,f){var m=s.x-r.x,S=s.y-r.y,k=s.z-r.z,V=f.x-r.x,de=f.y-r.y,Re=f.z-r.z,yt=S*Re-k*de,gt=k*V-m*Re,ar=m*de-S*V;return Math.sqrt(yt*yt+gt*gt+ar*ar)/2},Ii.centroid=function(r,s,f){return new re((r.x+s.x+f.x)/3,(r.y+s.y+f.y)/3)},Ii.inCentre=function(r,s,f){var m=s.distance(f),S=r.distance(f),k=r.distance(s),V=m+S+k;return new re((m*r.x+S*s.x+k*f.x)/V,(m*r.y+S*s.y+k*f.y)/V)};var fs=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Mr;var s=arguments[1],f=arguments[2];this._inputGeom=arguments[0],this._distance=s,this._curveBuilder=f};fs.prototype.addPoint=function(r){if(this._distance<=0)return null;var s=r.getCoordinates(),f=this._curveBuilder.getLineCurve(s,this._distance);this.addCurve(f,Ee.EXTERIOR,Ee.INTERIOR)},fs.prototype.addPolygon=function(r){var s=this._distance,f=et.LEFT;this._distance<0&&(s=-this._distance,f=et.RIGHT);var m=r.getExteriorRing(),S=Sn.removeRepeatedPoints(m.getCoordinates());if(this._distance<0&&this.isErodedCompletely(m,this._distance)||this._distance<=0&&S.length<3)return null;this.addPolygonRing(S,s,f,Ee.EXTERIOR,Ee.INTERIOR);for(var k=0;k<r.getNumInteriorRing();k++){var V=r.getInteriorRingN(k),de=Sn.removeRepeatedPoints(V.getCoordinates());this._distance>0&&this.isErodedCompletely(V,-this._distance)||this.addPolygonRing(de,s,et.opposite(f),Ee.INTERIOR,Ee.EXTERIOR)}},fs.prototype.isTriangleErodedCompletely=function(r,s){var f=new Ii(r[0],r[1],r[2]),m=f.inCentre();return rr.distancePointLine(m,f.p0,f.p1)<Math.abs(s)},fs.prototype.addLineString=function(r){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var s=Sn.removeRepeatedPoints(r.getCoordinates()),f=this._curveBuilder.getLineCurve(s,this._distance);this.addCurve(f,Ee.EXTERIOR,Ee.INTERIOR)},fs.prototype.addCurve=function(r,s,f){if(null===r||r.length<2)return null;var m=new lo(r,new Er(0,Ee.BOUNDARY,s,f));this._curveList.add(m)},fs.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},fs.prototype.addPolygonRing=function(r,s,f,m,S){if(0===s&&r.length<hs.MINIMUM_VALID_SIZE)return null;var k=m,V=S;r.length>=hs.MINIMUM_VALID_SIZE&&rr.isCCW(r)&&(k=S,V=m,f=et.opposite(f));var de=this._curveBuilder.getRingCurve(r,f,s);this.addCurve(de,k,V)},fs.prototype.add=function(r){if(r.isEmpty())return null;r instanceof ki?this.addPolygon(r):r instanceof mn?this.addLineString(r):r instanceof Ho?this.addPoint(r):(r instanceof ur||r instanceof hn||r instanceof Kn||r instanceof Yr)&&this.addCollection(r)},fs.prototype.isErodedCompletely=function(r,s){var f=r.getCoordinates();if(f.length<4)return s<0;if(4===f.length)return this.isTriangleErodedCompletely(f,s);var m=r.getEnvelopeInternal(),S=Math.min(m.getHeight(),m.getWidth());return s<0&&2*Math.abs(s)>S},fs.prototype.addCollection=function(r){for(var s=0;s<r.getNumGeometries();s++){var f=r.getGeometryN(s);this.add(f)}},fs.prototype.interfaces_=function(){return[]},fs.prototype.getClass=function(){return fs};var Bl=function(){};Bl.prototype.locate=function(r){},Bl.prototype.interfaces_=function(){return[]},Bl.prototype.getClass=function(){return Bl};var Is=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var r=arguments[0];this._parent=r,this._atStart=!0,this._index=0,this._max=r.getNumGeometries()};Is.prototype.next=function(){if(this._atStart)return this._atStart=!1,Is.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new b;var r=this._parent.getGeometryN(this._index++);return r instanceof Yr?(this._subcollectionIterator=new Is(r),this._subcollectionIterator.next()):r},Is.prototype.remove=function(){throw new Error(this.getClass().getName())},Is.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Is.prototype.interfaces_=function(){return[Os]},Is.prototype.getClass=function(){return Is},Is.isAtomic=function(r){return!(r instanceof Yr)};var Fs=function(){this._geom=null,this._geom=arguments[0]};Fs.prototype.locate=function(r){return Fs.locate(r,this._geom)},Fs.prototype.interfaces_=function(){return[Bl]},Fs.prototype.getClass=function(){return Fs},Fs.isPointInRing=function(r,s){return!!s.getEnvelopeInternal().intersects(r)&&rr.isPointInRing(r,s.getCoordinates())},Fs.containsPointInPolygon=function(r,s){if(s.isEmpty())return!1;var f=s.getExteriorRing();if(!Fs.isPointInRing(r,f))return!1;for(var m=0;m<s.getNumInteriorRing();m++){var S=s.getInteriorRingN(m);if(Fs.isPointInRing(r,S))return!1}return!0},Fs.containsPoint=function(r,s){if(s instanceof ki)return Fs.containsPointInPolygon(r,s);if(s instanceof Yr)for(var f=new Is(s);f.hasNext();){var m=f.next();if(m!==s&&Fs.containsPoint(r,m))return!0}return!1},Fs.locate=function(r,s){return s.isEmpty()?Ee.EXTERIOR:Fs.containsPoint(r,s)?Ee.INTERIOR:Ee.EXTERIOR};var _s=function(){this._edgeMap=new xe,this._edgeList=null,this._ptInAreaLocation=[Ee.NONE,Ee.NONE]};_s.prototype.getNextCW=function(r){this.getEdges();var s=this._edgeList.indexOf(r),f=s-1;return 0===s&&(f=this._edgeList.size()-1),this._edgeList.get(f)},_s.prototype.propagateSideLabels=function(r){for(var s=Ee.NONE,f=this.iterator();f.hasNext();){var m=f.next().getLabel();m.isArea(r)&&m.getLocation(r,et.LEFT)!==Ee.NONE&&(s=m.getLocation(r,et.LEFT))}if(s===Ee.NONE)return null;for(var S=s,k=this.iterator();k.hasNext();){var V=k.next(),de=V.getLabel();if(de.getLocation(r,et.ON)===Ee.NONE&&de.setLocation(r,et.ON,S),de.isArea(r)){var Re=de.getLocation(r,et.LEFT),yt=de.getLocation(r,et.RIGHT);if(yt!==Ee.NONE){if(yt!==S)throw new wr("side location conflict",V.getCoordinate());Re===Ee.NONE&&ve.shouldNeverReachHere("found single null side (at "+V.getCoordinate()+")"),S=Re}else ve.isTrue(de.getLocation(r,et.LEFT)===Ee.NONE,"found single null side"),de.setLocation(r,et.RIGHT,S),de.setLocation(r,et.LEFT,S)}}},_s.prototype.getCoordinate=function(){var r=this.iterator();return r.hasNext()?r.next().getCoordinate():null},_s.prototype.print=function(r){rn.out.println("EdgeEndStar:   "+this.getCoordinate());for(var s=this.iterator();s.hasNext();)s.next().print(r)},_s.prototype.isAreaLabelsConsistent=function(r){return this.computeEdgeEndLabels(r.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},_s.prototype.checkAreaLabelsConsistent=function(r){var s=this.getEdges();if(s.size()<=0)return!0;var f=s.size()-1,m=s.get(f).getLabel().getLocation(r,et.LEFT);ve.isTrue(m!==Ee.NONE,"Found unlabelled area edge");for(var S=m,k=this.iterator();k.hasNext();){var V=k.next().getLabel();ve.isTrue(V.isArea(r),"Found non-area edge");var de=V.getLocation(r,et.LEFT),Re=V.getLocation(r,et.RIGHT);if(de===Re||Re!==S)return!1;S=de}return!0},_s.prototype.findIndex=function(r){this.iterator();for(var s=0;s<this._edgeList.size();s++)if(this._edgeList.get(s)===r)return s;return-1},_s.prototype.iterator=function(){return this.getEdges().iterator()},_s.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new Mr(this._edgeMap.values())),this._edgeList},_s.prototype.getLocation=function(r,s,f){return this._ptInAreaLocation[r]===Ee.NONE&&(this._ptInAreaLocation[r]=Fs.locate(s,f[r].getGeometry())),this._ptInAreaLocation[r]},_s.prototype.toString=function(){var r=new Ae;r.append("EdgeEndStar:   "+this.getCoordinate()),r.append("\n");for(var s=this.iterator();s.hasNext();){var f=s.next();r.append(f),r.append("\n")}return r.toString()},_s.prototype.computeEdgeEndLabels=function(r){for(var s=this.iterator();s.hasNext();)s.next().computeLabel(r)},_s.prototype.computeLabelling=function(r){this.computeEdgeEndLabels(r[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var s=[!1,!1],f=this.iterator();f.hasNext();)for(var m=f.next().getLabel(),S=0;S<2;S++)m.isLine(S)&&m.getLocation(S)===Ee.BOUNDARY&&(s[S]=!0);for(var k=this.iterator();k.hasNext();)for(var V=k.next(),de=V.getLabel(),Re=0;Re<2;Re++)if(de.isAnyNull(Re)){var yt=Ee.NONE;if(s[Re])yt=Ee.EXTERIOR;else{var gt=V.getCoordinate();yt=this.getLocation(Re,gt,r)}de.setAllLocationsIfNull(Re,yt)}},_s.prototype.getDegree=function(){return this._edgeMap.size()},_s.prototype.insertEdgeEnd=function(r,s){this._edgeMap.put(r,s),this._edgeList=null},_s.prototype.interfaces_=function(){return[]},_s.prototype.getClass=function(){return _s};var wu=function(r){function s(){r.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var f=null,m=null,S=this._SCANNING_FOR_INCOMING,k=0;k<this._resultAreaEdgeList.size();k++){var V=this._resultAreaEdgeList.get(k),de=V.getSym();if(V.getLabel().isArea())switch(null===f&&V.isInResult()&&(f=V),S){case this._SCANNING_FOR_INCOMING:if(!de.isInResult())continue;m=de,S=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!V.isInResult())continue;m.setNext(V),S=this._SCANNING_FOR_INCOMING}}if(S===this._LINKING_TO_OUTGOING){if(null===f)throw new wr("no outgoing dirEdge found",this.getCoordinate());ve.isTrue(f.isInResult(),"unable to link last incoming dirEdge"),m.setNext(f)}},s.prototype.insert=function(f){this.insertEdgeEnd(f,f)},s.prototype.getRightmostEdge=function(){var f=this.getEdges(),m=f.size();if(m<1)return null;var S=f.get(0);if(1===m)return S;var k=f.get(m-1),V=S.getQuadrant(),de=k.getQuadrant();return xn.isNorthern(V)&&xn.isNorthern(de)?S:xn.isNorthern(V)||xn.isNorthern(de)?0!==S.getDy()?S:0!==k.getDy()?k:(ve.shouldNeverReachHere("found two horizontal edges incident on node"),null):k},s.prototype.print=function(f){rn.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var m=this.iterator();m.hasNext();){var S=m.next();f.print("out "),S.print(f),f.println(),f.print("in "),S.getSym().print(f),f.println()}},s.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Mr;for(var f=this.iterator();f.hasNext();){var m=f.next();(m.isInResult()||m.getSym().isInResult())&&this._resultAreaEdgeList.add(m)}return this._resultAreaEdgeList},s.prototype.updateLabelling=function(f){for(var m=this.iterator();m.hasNext();){var S=m.next().getLabel();S.setAllLocationsIfNull(0,f.getLocation(0)),S.setAllLocationsIfNull(1,f.getLocation(1))}},s.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var f=null,m=null,S=this._edgeList.size()-1;S>=0;S--){var k=this._edgeList.get(S),V=k.getSym();null===m&&(m=V),null!==f&&V.setNext(f),f=k}m.setNext(f)},s.prototype.computeDepths=function(){if(1===arguments.length){var f=arguments[0],m=this.findIndex(f),S=f.getDepth(et.LEFT),k=f.getDepth(et.RIGHT),V=this.computeDepths(m+1,this._edgeList.size(),S);if(this.computeDepths(0,m,V)!==k)throw new wr("depth mismatch at "+f.getCoordinate())}else if(3===arguments.length){for(var Re=arguments[1],yt=arguments[2],gt=arguments[0];gt<Re;gt++){var ar=this._edgeList.get(gt);ar.setEdgeDepths(et.RIGHT,yt),yt=ar.getDepth(et.LEFT)}return yt}},s.prototype.mergeSymLabels=function(){for(var f=this.iterator();f.hasNext();){var m=f.next();m.getLabel().merge(m.getSym().getLabel())}},s.prototype.linkMinimalDirectedEdges=function(f){for(var m=null,S=null,k=this._SCANNING_FOR_INCOMING,V=this._resultAreaEdgeList.size()-1;V>=0;V--){var de=this._resultAreaEdgeList.get(V),Re=de.getSym();switch(null===m&&de.getEdgeRing()===f&&(m=de),k){case this._SCANNING_FOR_INCOMING:if(Re.getEdgeRing()!==f)continue;S=Re,k=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(de.getEdgeRing()!==f)continue;S.setNextMin(de),k=this._SCANNING_FOR_INCOMING}}k===this._LINKING_TO_OUTGOING&&(ve.isTrue(null!==m,"found null for first outgoing dirEdge"),ve.isTrue(m.getEdgeRing()===f,"unable to link last incoming dirEdge"),S.setNextMin(m))},s.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var f=0,m=this.iterator();m.hasNext();)m.next().isInResult()&&f++;return f}if(1===arguments.length){for(var S=arguments[0],k=0,V=this.iterator();V.hasNext();)V.next().getEdgeRing()===S&&k++;return k}},s.prototype.getLabel=function(){return this._label},s.prototype.findCoveredLineEdges=function(){for(var f=Ee.NONE,m=this.iterator();m.hasNext();){var S=m.next(),k=S.getSym();if(!S.isLineEdge()){if(S.isInResult()){f=Ee.INTERIOR;break}if(k.isInResult()){f=Ee.EXTERIOR;break}}}if(f===Ee.NONE)return null;for(var V=f,de=this.iterator();de.hasNext();){var Re=de.next(),yt=Re.getSym();Re.isLineEdge()?Re.getEdge().setCovered(V===Ee.INTERIOR):(Re.isInResult()&&(V=Ee.EXTERIOR),yt.isInResult()&&(V=Ee.INTERIOR))}},s.prototype.computeLabelling=function(f){r.prototype.computeLabelling.call(this,f),this._label=new Er(Ee.NONE);for(var m=this.iterator();m.hasNext();)for(var S=m.next().getEdge().getLabel(),k=0;k<2;k++){var V=S.getLocation(k);V!==Ee.INTERIOR&&V!==Ee.BOUNDARY||this._label.setLocation(k,Ee.INTERIOR)}},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(_s),Eu=function(r){function s(){r.apply(this,arguments)}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.createNode=function(f){return new nn(f,new wu)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Rs),ul=function r(){this._pts=null,this._orientation=null;var s=arguments[0];this._pts=s,this._orientation=r.orientation(s)};ul.prototype.compareTo=function(r){return ul.compareOriented(this._pts,this._orientation,r._pts,r._orientation)},ul.prototype.interfaces_=function(){return[ne]},ul.prototype.getClass=function(){return ul},ul.orientation=function(r){return 1===Sn.increasingDirection(r)},ul.compareOriented=function(r,s,f,m){for(var S=s?1:-1,k=m?1:-1,V=s?r.length:-1,de=m?f.length:-1,Re=s?0:r.length-1,yt=m?0:f.length-1;;){var gt=r[Re].compareTo(f[yt]);if(0!==gt)return gt;var ar=(Re+=S)===V,Gr=(yt+=k)===de;if(ar&&!Gr)return-1;if(!ar&&Gr)return 1;if(ar&&Gr)return 0}};var za=function(){this._edges=new Mr,this._ocaMap=new xe};za.prototype.print=function(r){r.print("MULTILINESTRING ( ");for(var s=0;s<this._edges.size();s++){var f=this._edges.get(s);s>0&&r.print(","),r.print("(");for(var m=f.getCoordinates(),S=0;S<m.length;S++)S>0&&r.print(","),r.print(m[S].x+" "+m[S].y);r.println(")")}r.print(")  ")},za.prototype.addAll=function(r){for(var s=r.iterator();s.hasNext();)this.add(s.next())},za.prototype.findEdgeIndex=function(r){for(var s=0;s<this._edges.size();s++)if(this._edges.get(s).equals(r))return s;return-1},za.prototype.iterator=function(){return this._edges.iterator()},za.prototype.getEdges=function(){return this._edges},za.prototype.get=function(r){return this._edges.get(r)},za.prototype.findEqualEdge=function(r){var s=new ul(r.getCoordinates());return this._ocaMap.get(s)},za.prototype.add=function(r){this._edges.add(r);var s=new ul(r.getCoordinates());this._ocaMap.put(s,r)},za.prototype.interfaces_=function(){return[]},za.prototype.getClass=function(){return za};var Ha=function(){};Ha.prototype.processIntersections=function(r,s,f,m){},Ha.prototype.isDone=function(){},Ha.prototype.interfaces_=function(){return[]},Ha.prototype.getClass=function(){return Ha};var Qo=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0,this._li=arguments[0]};Qo.prototype.isTrivialIntersection=function(r,s,f,m){if(r===f&&1===this._li.getIntersectionNum()){if(Qo.isAdjacentSegments(s,m))return!0;if(r.isClosed()){var S=r.size()-1;if(0===s&&m===S||0===m&&s===S)return!0}}return!1},Qo.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Qo.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Qo.prototype.getLineIntersector=function(){return this._li},Qo.prototype.hasProperIntersection=function(){return this._hasProper},Qo.prototype.processIntersections=function(r,s,f,m){if(r===f&&s===m)return null;this.numTests++;var S=r.getCoordinates()[s],k=r.getCoordinates()[s+1],V=f.getCoordinates()[m],de=f.getCoordinates()[m+1];this._li.computeIntersection(S,k,V,de),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(r,s,f,m)||(this._hasIntersection=!0,r.addIntersections(this._li,s,0),f.addIntersections(this._li,m,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Qo.prototype.hasIntersection=function(){return this._hasIntersection},Qo.prototype.isDone=function(){return!1},Qo.prototype.hasInteriorIntersection=function(){return this._hasInterior},Qo.prototype.interfaces_=function(){return[Ha]},Qo.prototype.getClass=function(){return Qo},Qo.isAdjacentSegments=function(r,s){return 1===Math.abs(r-s)};var Ba=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var s=arguments[1],f=arguments[2];this.coord=new re(arguments[0]),this.segmentIndex=s,this.dist=f};Ba.prototype.getSegmentIndex=function(){return this.segmentIndex},Ba.prototype.getCoordinate=function(){return this.coord},Ba.prototype.print=function(r){r.print(this.coord),r.print(" seg # = "+this.segmentIndex),r.println(" dist = "+this.dist)},Ba.prototype.compareTo=function(r){return this.compare(r.segmentIndex,r.dist)},Ba.prototype.isEndPoint=function(r){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===r},Ba.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Ba.prototype.getDistance=function(){return this.dist},Ba.prototype.compare=function(r,s){return this.segmentIndex<r?-1:this.segmentIndex>r?1:this.dist<s?-1:this.dist>s?1:0},Ba.prototype.interfaces_=function(){return[ne]},Ba.prototype.getClass=function(){return Ba};var Ua=function(){this._nodeMap=new xe,this.edge=null,this.edge=arguments[0]};Ua.prototype.print=function(r){r.println("Intersections:");for(var s=this.iterator();s.hasNext();)s.next().print(r)},Ua.prototype.iterator=function(){return this._nodeMap.values().iterator()},Ua.prototype.addSplitEdges=function(r){this.addEndpoints();for(var s=this.iterator(),f=s.next();s.hasNext();){var m=s.next(),S=this.createSplitEdge(f,m);r.add(S),f=m}},Ua.prototype.addEndpoints=function(){var r=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[r],r,0)},Ua.prototype.createSplitEdge=function(r,s){var f=s.segmentIndex-r.segmentIndex+2,S=s.dist>0||!s.coord.equals2D(this.edge.pts[s.segmentIndex]);S||f--;var k=new Array(f).fill(null),V=0;k[V++]=new re(r.coord);for(var de=r.segmentIndex+1;de<=s.segmentIndex;de++)k[V++]=this.edge.pts[de];return S&&(k[V]=s.coord),new go(k,new Er(this.edge._label))},Ua.prototype.add=function(r,s,f){var m=new Ba(r,s,f),S=this._nodeMap.get(m);return null!==S?S:(this._nodeMap.put(m,m),m)},Ua.prototype.isIntersection=function(r){for(var s=this.iterator();s.hasNext();)if(s.next().coord.equals(r))return!0;return!1},Ua.prototype.interfaces_=function(){return[]},Ua.prototype.getClass=function(){return Ua};var Lt=function(){};Lt.prototype.getChainStartIndices=function(r){var s=0,f=new Mr;f.add(new pt(s));do{var m=this.findChainEnd(r,s);f.add(new pt(m)),s=m}while(s<r.length-1);return Lt.toIntArray(f)},Lt.prototype.findChainEnd=function(r,s){for(var f=xn.quadrant(r[s],r[s+1]),m=s+1;m<r.length&&xn.quadrant(r[m-1],r[m])===f;)m++;return m-1},Lt.prototype.interfaces_=function(){return[]},Lt.prototype.getClass=function(){return Lt},Lt.toIntArray=function(r){for(var s=new Array(r.size()).fill(null),f=0;f<s.length;f++)s[f]=r.get(f).intValue();return s};var tr=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new xr,this.env2=new xr;var r=arguments[0];this.e=r,this.pts=r.getCoordinates();var s=new Lt;this.startIndex=s.getChainStartIndices(this.pts)};tr.prototype.getCoordinates=function(){return this.pts},tr.prototype.getMaxX=function(r){var s=this.pts[this.startIndex[r]].x,f=this.pts[this.startIndex[r+1]].x;return s>f?s:f},tr.prototype.getMinX=function(r){var s=this.pts[this.startIndex[r]].x,f=this.pts[this.startIndex[r+1]].x;return s<f?s:f},tr.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var r=arguments[0],s=arguments[1],f=arguments[2];this.computeIntersectsForChain(this.startIndex[r],this.startIndex[r+1],s,s.startIndex[f],s.startIndex[f+1],arguments[3])}else if(6===arguments.length){var S=arguments[0],k=arguments[1],V=arguments[2],de=arguments[3],Re=arguments[4],yt=arguments[5],gt=this.pts[S],ar=this.pts[k],Gr=V.pts[de],Br=V.pts[Re];if(k-S==1&&Re-de==1)return yt.addIntersections(this.e,S,V.e,de),null;if(this.env1.init(gt,ar),this.env2.init(Gr,Br),!this.env1.intersects(this.env2))return null;var sn=Math.trunc((S+k)/2),Mn=Math.trunc((de+Re)/2);S<sn&&(de<Mn&&this.computeIntersectsForChain(S,sn,V,de,Mn,yt),Mn<Re&&this.computeIntersectsForChain(S,sn,V,Mn,Re,yt)),sn<k&&(de<Mn&&this.computeIntersectsForChain(sn,k,V,de,Mn,yt),Mn<Re&&this.computeIntersectsForChain(sn,k,V,Mn,Re,yt))}},tr.prototype.getStartIndexes=function(){return this.startIndex},tr.prototype.computeIntersects=function(r,s){for(var f=0;f<this.startIndex.length-1;f++)for(var m=0;m<r.startIndex.length-1;m++)this.computeIntersectsForChain(f,r,m,s)},tr.prototype.interfaces_=function(){return[]},tr.prototype.getClass=function(){return tr};var kr=function r(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var s=0;s<2;s++)for(var f=0;f<3;f++)this._depth[s][f]=r.NULL_VALUE},An={NULL_VALUE:{configurable:!0}};kr.prototype.getDepth=function(r,s){return this._depth[r][s]},kr.prototype.setDepth=function(r,s,f){this._depth[r][s]=f},kr.prototype.isNull=function(){if(0===arguments.length){for(var r=0;r<2;r++)for(var s=0;s<3;s++)if(this._depth[r][s]!==kr.NULL_VALUE)return!1;return!0}return 1===arguments.length?this._depth[arguments[0]][1]===kr.NULL_VALUE:2===arguments.length?this._depth[arguments[0]][arguments[1]]===kr.NULL_VALUE:void 0},kr.prototype.normalize=function(){for(var r=0;r<2;r++)if(!this.isNull(r)){var s=this._depth[r][1];this._depth[r][2]<s&&(s=this._depth[r][2]),s<0&&(s=0);for(var f=1;f<3;f++){var m=0;this._depth[r][f]>s&&(m=1),this._depth[r][f]=m}}},kr.prototype.getDelta=function(r){return this._depth[r][et.RIGHT]-this._depth[r][et.LEFT]},kr.prototype.getLocation=function(r,s){return this._depth[r][s]<=0?Ee.EXTERIOR:Ee.INTERIOR},kr.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},kr.prototype.add=function(){if(1===arguments.length)for(var r=arguments[0],s=0;s<2;s++)for(var f=1;f<3;f++){var m=r.getLocation(s,f);m!==Ee.EXTERIOR&&m!==Ee.INTERIOR||(this.isNull(s,f)?this._depth[s][f]=kr.depthAtLocation(m):this._depth[s][f]+=kr.depthAtLocation(m))}else 3===arguments.length&&arguments[2]===Ee.INTERIOR&&this._depth[arguments[0]][arguments[1]]++},kr.prototype.interfaces_=function(){return[]},kr.prototype.getClass=function(){return kr},kr.depthAtLocation=function(r){return r===Ee.EXTERIOR?0:r===Ee.INTERIOR?1:kr.NULL_VALUE},An.NULL_VALUE.get=function(){return-1},Object.defineProperties(kr,An);var go=function(r){function s(){if(r.call(this),this.pts=null,this._env=null,this.eiList=new Ua(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new kr,this._depthDelta=0,1===arguments.length)s.call(this,arguments[0],null);else if(2===arguments.length){var S=arguments[1];this.pts=arguments[0],this._label=S}}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.getDepth=function(){return this._depth},s.prototype.getCollapsedEdge=function(){var f=new Array(2).fill(null);return f[0]=this.pts[0],f[1]=this.pts[1],new s(f,Er.toLineLabel(this._label))},s.prototype.isIsolated=function(){return this._isIsolated},s.prototype.getCoordinates=function(){return this.pts},s.prototype.setIsolated=function(f){this._isIsolated=f},s.prototype.setName=function(f){this._name=f},s.prototype.equals=function(f){if(!(f instanceof s))return!1;var m=f;if(this.pts.length!==m.pts.length)return!1;for(var S=!0,k=!0,V=this.pts.length,de=0;de<this.pts.length;de++)if(this.pts[de].equals2D(m.pts[de])||(S=!1),this.pts[de].equals2D(m.pts[--V])||(k=!1),!S&&!k)return!1;return!0},s.prototype.getCoordinate=function(){return 0===arguments.length?this.pts.length>0?this.pts[0]:null:1===arguments.length?this.pts[arguments[0]]:void 0},s.prototype.print=function(f){f.print("edge "+this._name+": "),f.print("LINESTRING (");for(var m=0;m<this.pts.length;m++)m>0&&f.print(","),f.print(this.pts[m].x+" "+this.pts[m].y);f.print(")  "+this._label+" "+this._depthDelta)},s.prototype.computeIM=function(f){s.updateIM(this._label,f)},s.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},s.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},s.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},s.prototype.getDepthDelta=function(){return this._depthDelta},s.prototype.getNumPoints=function(){return this.pts.length},s.prototype.printReverse=function(f){f.print("edge "+this._name+": ");for(var m=this.pts.length-1;m>=0;m--)f.print(this.pts[m]+" ");f.println("")},s.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new tr(this)),this._mce},s.prototype.getEnvelope=function(){if(null===this._env){this._env=new xr;for(var f=0;f<this.pts.length;f++)this._env.expandToInclude(this.pts[f])}return this._env},s.prototype.addIntersection=function(f,m,S,k){var V=new re(f.getIntersection(k)),de=m,Re=f.getEdgeDistance(S,k),yt=de+1;yt<this.pts.length&&V.equals2D(this.pts[yt])&&(de=yt,Re=0),this.eiList.add(V,de,Re)},s.prototype.toString=function(){var f=new Ae;f.append("edge "+this._name+": "),f.append("LINESTRING (");for(var m=0;m<this.pts.length;m++)m>0&&f.append(","),f.append(this.pts[m].x+" "+this.pts[m].y);return f.append(")  "+this._label+" "+this._depthDelta),f.toString()},s.prototype.isPointwiseEqual=function(f){if(this.pts.length!==f.pts.length)return!1;for(var m=0;m<this.pts.length;m++)if(!this.pts[m].equals2D(f.pts[m]))return!1;return!0},s.prototype.setDepthDelta=function(f){this._depthDelta=f},s.prototype.getEdgeIntersectionList=function(){return this.eiList},s.prototype.addIntersections=function(f,m,S){for(var k=0;k<f.getIntersectionNum();k++)this.addIntersection(f,m,S,k)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.updateIM=function(){if(2!==arguments.length)return r.prototype.updateIM.apply(this,arguments);var f=arguments[0],m=arguments[1];m.setAtLeastIfValid(f.getLocation(0,et.ON),f.getLocation(1,et.ON),1),f.isArea()&&(m.setAtLeastIfValid(f.getLocation(0,et.LEFT),f.getLocation(1,et.LEFT),2),m.setAtLeastIfValid(f.getLocation(0,et.RIGHT),f.getLocation(1,et.RIGHT),2))},s}(fr),Un=function(r){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new za,this._bufParams=r||null};Un.prototype.setWorkingPrecisionModel=function(r){this._workingPrecisionModel=r},Un.prototype.insertUniqueEdge=function(r){var s=this._edgeList.findEqualEdge(r);if(null!==s){var f=s.getLabel(),m=r.getLabel();s.isPointwiseEqual(r)||(m=new Er(r.getLabel())).flip(),f.merge(m);var S=Un.depthDelta(m),k=s.getDepthDelta()+S;s.setDepthDelta(k)}else this._edgeList.add(r),r.setDepthDelta(Un.depthDelta(r.getLabel()))},Un.prototype.buildSubgraphs=function(r,s){for(var f=new Mr,m=r.iterator();m.hasNext();){var S=m.next(),k=S.getRightmostCoordinate(),V=new Wa(f).getDepth(k);S.computeDepth(V),S.findResultEdges(),f.add(S),s.add(S.getDirectedEdges(),S.getNodes())}},Un.prototype.createSubgraphs=function(r){for(var s=new Mr,f=r.getNodes().iterator();f.hasNext();){var m=f.next();if(!m.isVisited()){var S=new kt;S.create(m),s.add(S)}}return Ms.sort(s,Ms.reverseOrder()),s},Un.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},Un.prototype.getNoder=function(r){if(null!==this._workingNoder)return this._workingNoder;var s=new ll,f=new Xt;return f.setPrecisionModel(r),s.setSegmentIntersector(new Qo(f)),s},Un.prototype.buffer=function(r,s){var f=this._workingPrecisionModel;null===f&&(f=r.getPrecisionModel()),this._geomFact=r.getFactory();var m=new ms(f,this._bufParams),S=new fs(r,s,m).getCurves();if(S.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(S,f),this._graph=new pn(new Eu),this._graph.addEdges(this._edgeList.getEdges());var k=this.createSubgraphs(this._graph),V=new ji(this._geomFact);this.buildSubgraphs(k,V);var de=V.getPolygons();return de.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(de)},Un.prototype.computeNodedEdges=function(r,s){var f=this.getNoder(s);f.computeNodes(r);for(var m=f.getNodedSubstrings().iterator();m.hasNext();){var S=m.next(),k=S.getCoordinates();if(2!==k.length||!k[0].equals2D(k[1])){var V=S.getData(),de=new go(S.getCoordinates(),new Er(V));this.insertUniqueEdge(de)}}},Un.prototype.setNoder=function(r){this._workingNoder=r},Un.prototype.interfaces_=function(){return[]},Un.prototype.getClass=function(){return Un},Un.depthDelta=function(r){var s=r.getLocation(0,et.LEFT),f=r.getLocation(0,et.RIGHT);return s===Ee.INTERIOR&&f===Ee.EXTERIOR?1:s===Ee.EXTERIOR&&f===Ee.INTERIOR?-1:0},Un.convertSegStrings=function(r){for(var s=new $n,f=new Mr;r.hasNext();){var m=r.next(),S=s.createLineString(m.getCoordinates());f.add(S)}return s.buildGeometry(f)};var fo=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var s=arguments[1];this._noder=arguments[0],this._scaleFactor=s,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var m=arguments[1],S=arguments[2],k=arguments[3];this._noder=arguments[0],this._scaleFactor=m,this._offsetX=S,this._offsetY=k,this._isScaled=!this.isIntegerPrecision()}};fo.prototype.rescale=function(){if(Nt(arguments[0],Xn))for(var r=arguments[0].iterator();r.hasNext();){var s=r.next();this.rescale(s.getCoordinates())}else if(arguments[0]instanceof Array){for(var f=arguments[0],m=0;m<f.length;m++)f[m].x=f[m].x/this._scaleFactor+this._offsetX,f[m].y=f[m].y/this._scaleFactor+this._offsetY;2===f.length&&f[0].equals2D(f[1])&&rn.out.println(f)}},fo.prototype.scale=function(){if(Nt(arguments[0],Xn)){for(var r=arguments[0],s=new Mr,f=r.iterator();f.hasNext();){var m=f.next();s.add(new lo(this.scale(m.getCoordinates()),m.getData()))}return s}if(arguments[0]instanceof Array){for(var S=arguments[0],k=new Array(S.length).fill(null),V=0;V<S.length;V++)k[V]=new re(Math.round((S[V].x-this._offsetX)*this._scaleFactor),Math.round((S[V].y-this._offsetY)*this._scaleFactor),S[V].z);return Sn.removeRepeatedPoints(k)}},fo.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},fo.prototype.getNodedSubstrings=function(){var r=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(r),r},fo.prototype.computeNodes=function(r){var s=r;this._isScaled&&(s=this.scale(r)),this._noder.computeNodes(s)},fo.prototype.interfaces_=function(){return[al]},fo.prototype.getClass=function(){return fo};var uo=function(){this._li=new Xt,this._segStrings=null,this._segStrings=arguments[0]},Sa={fact:{configurable:!0}};uo.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var r=this._segStrings.iterator();r.hasNext();){var s=r.next().getCoordinates();this.checkEndPtVertexIntersections(s[0],this._segStrings),this.checkEndPtVertexIntersections(s[s.length-1],this._segStrings)}else if(2===arguments.length)for(var f=arguments[0],m=arguments[1].iterator();m.hasNext();)for(var S=m.next().getCoordinates(),k=1;k<S.length-1;k++)if(S[k].equals(f))throw new Se("found endpt/interior pt intersection at index "+k+" :pt "+f)},uo.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var r=this._segStrings.iterator();r.hasNext();)for(var s=r.next(),f=this._segStrings.iterator();f.hasNext();){var m=f.next();this.checkInteriorIntersections(s,m)}else if(2===arguments.length)for(var S=arguments[0],k=arguments[1],V=S.getCoordinates(),de=k.getCoordinates(),Re=0;Re<V.length-1;Re++)for(var yt=0;yt<de.length-1;yt++)this.checkInteriorIntersections(S,Re,k,yt);else if(4===arguments.length){var gt=arguments[0],ar=arguments[1],Gr=arguments[2],Br=arguments[3];if(gt===Gr&&ar===Br)return null;var sn=gt.getCoordinates()[ar],Mn=gt.getCoordinates()[ar+1],no=Gr.getCoordinates()[Br],ls=Gr.getCoordinates()[Br+1];if(this._li.computeIntersection(sn,Mn,no,ls),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,sn,Mn)||this.hasInteriorIntersection(this._li,no,ls)))throw new Se("found non-noded intersection at "+sn+"-"+Mn+" and "+no+"-"+ls)}},uo.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},uo.prototype.checkCollapses=function(){if(0===arguments.length)for(var r=this._segStrings.iterator();r.hasNext();){var s=r.next();this.checkCollapses(s)}else if(1===arguments.length)for(var f=arguments[0].getCoordinates(),m=0;m<f.length-2;m++)this.checkCollapse(f[m],f[m+1],f[m+2])},uo.prototype.hasInteriorIntersection=function(r,s,f){for(var m=0;m<r.getIntersectionNum();m++){var S=r.getIntersection(m);if(!S.equals(s)&&!S.equals(f))return!0}return!1},uo.prototype.checkCollapse=function(r,s,f){if(r.equals(f))throw new Se("found non-noded collapse at "+uo.fact.createLineString([r,s,f]))},uo.prototype.interfaces_=function(){return[]},uo.prototype.getClass=function(){return uo},Sa.fact.get=function(){return new $n},Object.defineProperties(uo,Sa);var Ni=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var r=arguments[0],s=arguments[1],f=arguments[2];if(this._originalPt=r,this._pt=r,this._scaleFactor=s,this._li=f,s<=0)throw new X("Scale factor must be non-zero");1!==s&&(this._pt=new re(this.scale(r.x),this.scale(r.y)),this._p0Scaled=new re,this._p1Scaled=new re),this.initCorners(this._pt)},os={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Ni.prototype.intersectsScaled=function(r,s){var f=Math.min(r.x,s.x),m=Math.max(r.x,s.x),S=Math.min(r.y,s.y),k=Math.max(r.y,s.y),V=this._maxx<f||this._minx>m||this._maxy<S||this._miny>k;if(V)return!1;var de=this.intersectsToleranceSquare(r,s);return ve.isTrue(!(V&&de),"Found bad envelope test"),de},Ni.prototype.initCorners=function(r){this._minx=r.x-.5,this._maxx=r.x+.5,this._miny=r.y-.5,this._maxy=r.y+.5,this._corner[0]=new re(this._maxx,this._maxy),this._corner[1]=new re(this._minx,this._maxy),this._corner[2]=new re(this._minx,this._miny),this._corner[3]=new re(this._maxx,this._miny)},Ni.prototype.intersects=function(r,s){return 1===this._scaleFactor?this.intersectsScaled(r,s):(this.copyScaled(r,this._p0Scaled),this.copyScaled(s,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},Ni.prototype.scale=function(r){return Math.round(r*this._scaleFactor)},Ni.prototype.getCoordinate=function(){return this._originalPt},Ni.prototype.copyScaled=function(r,s){s.x=this.scale(r.x),s.y=this.scale(r.y)},Ni.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var r=Ni.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new xr(this._originalPt.x-r,this._originalPt.x+r,this._originalPt.y-r,this._originalPt.y+r)}return this._safeEnv},Ni.prototype.intersectsPixelClosure=function(r,s){return this._li.computeIntersection(r,s,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(r,s,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(r,s,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(r,s,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},Ni.prototype.intersectsToleranceSquare=function(r,s){var f=!1,m=!1;return this._li.computeIntersection(r,s,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(r,s,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(f=!0),this._li.computeIntersection(r,s,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(m=!0),this._li.computeIntersection(r,s,this._corner[3],this._corner[0]),this._li.isProper()||f&&m||r.equals(this._pt)||s.equals(this._pt)))))},Ni.prototype.addSnappedNode=function(r,s){var f=r.getCoordinate(s),m=r.getCoordinate(s+1);return!!this.intersects(f,m)&&(r.addIntersection(this.getCoordinate(),s),!0)},Ni.prototype.interfaces_=function(){return[]},Ni.prototype.getClass=function(){return Ni},os.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(Ni,os);var Da=function(){this.tempEnv1=new xr,this.selectedSegment=new _n};Da.prototype.select=function(){1!==arguments.length&&2===arguments.length&&(arguments[0].getLineSegment(arguments[1],this.selectedSegment),this.select(this.selectedSegment))},Da.prototype.interfaces_=function(){return[]},Da.prototype.getClass=function(){return Da};var ca=function(){this._index=null,this._index=arguments[0]},Ca={HotPixelSnapAction:{configurable:!0}};ca.prototype.snap=function(){if(1===arguments.length)return this.snap(arguments[0],null,-1);if(3===arguments.length){var s=arguments[0],f=arguments[1],m=arguments[2],S=s.getSafeEnvelope(),k=new Oa(s,f,m);return this._index.query(S,{interfaces_:function(){return[gs]},visitItem:function(V){V.select(S,k)}}),k.isNodeAdded()}},ca.prototype.interfaces_=function(){return[]},ca.prototype.getClass=function(){return ca},Ca.HotPixelSnapAction.get=function(){return Oa},Object.defineProperties(ca,Ca);var Oa=function(r){function s(){r.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var m=arguments[1],S=arguments[2];this._hotPixel=arguments[0],this._parentEdge=m,this._hotPixelVertexIndex=S}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.isNodeAdded=function(){return this._isNodeAdded},s.prototype.select=function(){if(2!==arguments.length)return r.prototype.select.apply(this,arguments);var m=arguments[1],S=arguments[0].getContext();if(null!==this._parentEdge&&S===this._parentEdge&&m===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(S,m)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Da),Ja=function(){this._li=null,this._interiorIntersections=null,this._li=arguments[0],this._interiorIntersections=new Mr};Ja.prototype.processIntersections=function(r,s,f,m){if(r===f&&s===m)return null;var S=r.getCoordinates()[s],k=r.getCoordinates()[s+1],V=f.getCoordinates()[m],de=f.getCoordinates()[m+1];if(this._li.computeIntersection(S,k,V,de),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var Re=0;Re<this._li.getIntersectionNum();Re++)this._interiorIntersections.add(this._li.getIntersection(Re));r.addIntersections(this._li,s,0),f.addIntersections(this._li,m,1)}},Ja.prototype.isDone=function(){return!1},Ja.prototype.getInteriorIntersections=function(){return this._interiorIntersections},Ja.prototype.interfaces_=function(){return[Ha]},Ja.prototype.getClass=function(){return Ja};var zs=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var r=arguments[0];this._pm=r,this._li=new Xt,this._li.setPrecisionModel(r),this._scaleFactor=r.getScale()};zs.prototype.checkCorrectness=function(r){var s=lo.getNodedSubstrings(r),f=new uo(s);try{f.checkValid()}catch(m){if(!(m instanceof Fr))throw m;m.printStackTrace()}},zs.prototype.getNodedSubstrings=function(){return lo.getNodedSubstrings(this._nodedSegStrings)},zs.prototype.snapRound=function(r,s){var f=this.findInteriorIntersections(r,s);this.computeIntersectionSnaps(f),this.computeVertexSnaps(r)},zs.prototype.findInteriorIntersections=function(r,s){var f=new Ja(s);return this._noder.setSegmentIntersector(f),this._noder.computeNodes(r),f.getInteriorIntersections()},zs.prototype.computeVertexSnaps=function(){if(Nt(arguments[0],Xn))for(var r=arguments[0].iterator();r.hasNext();){var s=r.next();this.computeVertexSnaps(s)}else if(arguments[0]instanceof lo)for(var f=arguments[0],m=f.getCoordinates(),S=0;S<m.length;S++){var k=new Ni(m[S],this._scaleFactor,this._li);this._pointSnapper.snap(k,f,S)&&f.addIntersection(m[S],S)}},zs.prototype.computeNodes=function(r){this._nodedSegStrings=r,this._noder=new ll,this._pointSnapper=new ca(this._noder.getIndex()),this.snapRound(r,this._li)},zs.prototype.computeIntersectionSnaps=function(r){for(var s=r.iterator();s.hasNext();){var f=s.next(),m=new Ni(f,this._scaleFactor,this._li);this._pointSnapper.snap(m)}},zs.prototype.interfaces_=function(){return[al]},zs.prototype.getClass=function(){return zs};var es=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new ni,this._resultGeometry=null,this._saveException=null,1===arguments.length)this._argGeom=arguments[0];else if(2===arguments.length){var f=arguments[1];this._argGeom=arguments[0],this._bufParams=f}},cl={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};es.prototype.bufferFixedPrecision=function(r){var s=new fo(new zs(new hi(1)),r.getScale()),f=new Un(this._bufParams);f.setWorkingPrecisionModel(r),f.setNoder(s),this._resultGeometry=f.buffer(this._argGeom,this._distance)},es.prototype.bufferReducedPrecision=function(){var r=this;if(0===arguments.length){for(var s=es.MAX_PRECISION_DIGITS;s>=0;s--){try{r.bufferReducedPrecision(s)}catch(k){if(!(k instanceof wr))throw k;r._saveException=k}if(null!==r._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var m=es.precisionScaleFactor(this._argGeom,this._distance,arguments[0]),S=new hi(m);this.bufferFixedPrecision(S)}},es.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var r=this._argGeom.getFactory().getPrecisionModel();r.getType()===hi.FIXED?this.bufferFixedPrecision(r):this.bufferReducedPrecision()},es.prototype.setQuadrantSegments=function(r){this._bufParams.setQuadrantSegments(r)},es.prototype.bufferOriginalPrecision=function(){try{var r=new Un(this._bufParams);this._resultGeometry=r.buffer(this._argGeom,this._distance)}catch(s){if(!(s instanceof Se))throw s;this._saveException=s}},es.prototype.getResultGeometry=function(r){return this._distance=r,this.computeGeometry(),this._resultGeometry},es.prototype.setEndCapStyle=function(r){this._bufParams.setEndCapStyle(r)},es.prototype.interfaces_=function(){return[]},es.prototype.getClass=function(){return es},es.bufferOp=function(){if(2===arguments.length){var s=arguments[1];return new es(arguments[0]).getResultGeometry(s)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Lr&&"number"==typeof arguments[1]){var m=arguments[1],S=arguments[2],k=new es(arguments[0]);return k.setQuadrantSegments(S),k.getResultGeometry(m)}if(arguments[2]instanceof ni&&arguments[0]instanceof Lr&&"number"==typeof arguments[1]){var de=arguments[1];return new es(arguments[0],arguments[2]).getResultGeometry(de)}}else if(4===arguments.length){var gt=arguments[1],ar=arguments[2],Gr=arguments[3],Br=new es(arguments[0]);return Br.setQuadrantSegments(ar),Br.setEndCapStyle(Gr),Br.getResultGeometry(gt)}},es.precisionScaleFactor=function(r,s,f){var m=r.getEnvelopeInternal(),S=ke.max(Math.abs(m.getMaxX()),Math.abs(m.getMaxY()),Math.abs(m.getMinX()),Math.abs(m.getMinY()))+2*(s>0?s:0),k=f-Math.trunc(Math.log(S)/Math.log(10)+1);return Math.pow(10,k)},cl.CAP_ROUND.get=function(){return ni.CAP_ROUND},cl.CAP_BUTT.get=function(){return ni.CAP_FLAT},cl.CAP_FLAT.get=function(){return ni.CAP_FLAT},cl.CAP_SQUARE.get=function(){return ni.CAP_SQUARE},cl.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(es,cl);var vs=function(){this._pt=[new re,new re],this._distance=ee.NaN,this._isNull=!0};vs.prototype.getCoordinates=function(){return this._pt},vs.prototype.getCoordinate=function(r){return this._pt[r]},vs.prototype.setMinimum=function(){if(1===arguments.length){var r=arguments[0];this.setMinimum(r._pt[0],r._pt[1])}else if(2===arguments.length){var s=arguments[0],f=arguments[1];if(this._isNull)return this.initialize(s,f),null;var m=s.distance(f);m<this._distance&&this.initialize(s,f,m)}},vs.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var r=arguments[0],s=arguments[1];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(s),this._distance=r.distance(s),this._isNull=!1}else if(3===arguments.length){var m=arguments[1],S=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(m),this._distance=S,this._isNull=!1}},vs.prototype.getDistance=function(){return this._distance},vs.prototype.setMaximum=function(){if(1===arguments.length){var r=arguments[0];this.setMaximum(r._pt[0],r._pt[1])}else if(2===arguments.length){var s=arguments[0],f=arguments[1];if(this._isNull)return this.initialize(s,f),null;var m=s.distance(f);m>this._distance&&this.initialize(s,f,m)}},vs.prototype.interfaces_=function(){return[]},vs.prototype.getClass=function(){return vs};var Ks=function(){};Ks.prototype.interfaces_=function(){return[]},Ks.prototype.getClass=function(){return Ks},Ks.computeDistance=function(){if(arguments[2]instanceof vs&&arguments[0]instanceof mn&&arguments[1]instanceof re)for(var s=arguments[1],f=arguments[2],m=arguments[0].getCoordinates(),S=new _n,k=0;k<m.length-1;k++){S.setCoordinates(m[k],m[k+1]);var V=S.closestPoint(s);f.setMinimum(V,s)}else if(arguments[2]instanceof vs&&arguments[0]instanceof ki&&arguments[1]instanceof re){var de=arguments[0],Re=arguments[1],yt=arguments[2];Ks.computeDistance(de.getExteriorRing(),Re,yt);for(var gt=0;gt<de.getNumInteriorRing();gt++)Ks.computeDistance(de.getInteriorRingN(gt),Re,yt)}else if(arguments[2]instanceof vs&&arguments[0]instanceof Lr&&arguments[1]instanceof re){var ar=arguments[0],Gr=arguments[1],Br=arguments[2];if(ar instanceof mn)Ks.computeDistance(ar,Gr,Br);else if(ar instanceof ki)Ks.computeDistance(ar,Gr,Br);else if(ar instanceof Yr)for(var sn=ar,Mn=0;Mn<sn.getNumGeometries();Mn++){var no=sn.getGeometryN(Mn);Ks.computeDistance(no,Gr,Br)}else Br.setMinimum(ar.getCoordinate(),Gr)}else if(arguments[2]instanceof vs&&arguments[0]instanceof _n&&arguments[1]instanceof re){var na=arguments[1],wl=arguments[2],Nl=arguments[0].closestPoint(na);wl.setMinimum(Nl,na)}};var Ul=function(r){this._maxPtDist=new vs,this._inputGeom=r||null},vo={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Ul.prototype.computeMaxMidpointDistance=function(r){var s=new Ka(this._inputGeom);r.apply(s),this._maxPtDist.setMaximum(s.getMaxPointDistance())},Ul.prototype.computeMaxVertexDistance=function(r){var s=new Pi(this._inputGeom);r.apply(s),this._maxPtDist.setMaximum(s.getMaxPointDistance())},Ul.prototype.findDistance=function(r){return this.computeMaxVertexDistance(r),this.computeMaxMidpointDistance(r),this._maxPtDist.getDistance()},Ul.prototype.getDistancePoints=function(){return this._maxPtDist},Ul.prototype.interfaces_=function(){return[]},Ul.prototype.getClass=function(){return Ul},vo.MaxPointDistanceFilter.get=function(){return Pi},vo.MaxMidpointDistanceFilter.get=function(){return Ka},Object.defineProperties(Ul,vo);var Pi=function(r){this._maxPtDist=new vs,this._minPtDist=new vs,this._geom=r||null};Pi.prototype.filter=function(r){this._minPtDist.initialize(),Ks.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Pi.prototype.getMaxPointDistance=function(){return this._maxPtDist},Pi.prototype.interfaces_=function(){return[Jn]},Pi.prototype.getClass=function(){return Pi};var Ka=function(r){this._maxPtDist=new vs,this._minPtDist=new vs,this._geom=r||null};Ka.prototype.filter=function(r,s){if(0===s)return null;var f=r.getCoordinate(s-1),m=r.getCoordinate(s),S=new re((f.x+m.x)/2,(f.y+m.y)/2);this._minPtDist.initialize(),Ks.computeDistance(this._geom,S,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Ka.prototype.isDone=function(){return!1},Ka.prototype.isGeometryChanged=function(){return!1},Ka.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ka.prototype.interfaces_=function(){return[mr]},Ka.prototype.getClass=function(){return Ka};var Qs=function(r){this._comps=r||null};Qs.prototype.filter=function(r){r instanceof ki&&this._comps.add(r)},Qs.prototype.interfaces_=function(){return[Rr]},Qs.prototype.getClass=function(){return Qs},Qs.getPolygons=function(){if(1===arguments.length)return Qs.getPolygons(arguments[0],new Mr);if(2===arguments.length){var s=arguments[0],f=arguments[1];return s instanceof ki?f.add(s):s instanceof Yr&&s.apply(new Qs(f)),f}};var ds=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length)this._lines=arguments[0];else if(2===arguments.length){var f=arguments[1];this._lines=arguments[0],this._isForcedToLineString=f}};ds.prototype.filter=function(r){if(this._isForcedToLineString&&r instanceof hs){var s=r.getFactory().createLineString(r.getCoordinateSequence());return this._lines.add(s),null}r instanceof mn&&this._lines.add(r)},ds.prototype.setForceToLineString=function(r){this._isForcedToLineString=r},ds.prototype.interfaces_=function(){return[un]},ds.prototype.getClass=function(){return ds},ds.getGeometry=function(){if(1===arguments.length){var r=arguments[0];return r.getFactory().buildGeometry(ds.getLines(r))}if(2===arguments.length){var s=arguments[0],f=arguments[1];return s.getFactory().buildGeometry(ds.getLines(s,f))}},ds.getLines=function(){if(1===arguments.length)return ds.getLines(arguments[0],!1);if(2===arguments.length){if(Nt(arguments[0],Xn)&&Nt(arguments[1],Xn)){for(var f=arguments[1],m=arguments[0].iterator();m.hasNext();){var S=m.next();ds.getLines(S,f)}return f}if(arguments[0]instanceof Lr&&"boolean"==typeof arguments[1]){var k=arguments[0],V=arguments[1],de=new Mr;return k.apply(new ds(de,V)),de}if(arguments[0]instanceof Lr&&Nt(arguments[1],Xn)){var Re=arguments[0],yt=arguments[1];return Re instanceof mn?yt.add(Re):Re.apply(new ds(yt)),yt}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&Nt(arguments[0],Xn)&&Nt(arguments[1],Xn)){for(var ar=arguments[1],Gr=arguments[2],Br=arguments[0].iterator();Br.hasNext();){var sn=Br.next();ds.getLines(sn,ar,Gr)}return ar}if("boolean"==typeof arguments[2]&&arguments[0]instanceof Lr&&Nt(arguments[1],Xn)){var no=arguments[1];return arguments[0].apply(new ds(no,arguments[2])),no}}};var Go=function(){if(this._boundaryRule=zn.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0!==arguments.length&&1===arguments.length){var r=arguments[0];if(null===r)throw new X("Rule must be non-null");this._boundaryRule=r}};Go.prototype.locateInternal=function(){if(arguments[0]instanceof re&&arguments[1]instanceof ki){var r=arguments[0],s=arguments[1];if(s.isEmpty())return Ee.EXTERIOR;var f=s.getExteriorRing(),m=this.locateInPolygonRing(r,f);if(m===Ee.EXTERIOR)return Ee.EXTERIOR;if(m===Ee.BOUNDARY)return Ee.BOUNDARY;for(var S=0;S<s.getNumInteriorRing();S++){var k=s.getInteriorRingN(S),V=this.locateInPolygonRing(r,k);if(V===Ee.INTERIOR)return Ee.EXTERIOR;if(V===Ee.BOUNDARY)return Ee.BOUNDARY}return Ee.INTERIOR}if(arguments[0]instanceof re&&arguments[1]instanceof mn){var de=arguments[0],Re=arguments[1];if(!Re.getEnvelopeInternal().intersects(de))return Ee.EXTERIOR;var yt=Re.getCoordinates();return Re.isClosed()||!de.equals(yt[0])&&!de.equals(yt[yt.length-1])?rr.isOnLine(de,yt)?Ee.INTERIOR:Ee.EXTERIOR:Ee.BOUNDARY}if(arguments[0]instanceof re&&arguments[1]instanceof Ho){var gt=arguments[0];return arguments[1].getCoordinate().equals2D(gt)?Ee.INTERIOR:Ee.EXTERIOR}},Go.prototype.locateInPolygonRing=function(r,s){return s.getEnvelopeInternal().intersects(r)?rr.locatePointInRing(r,s.getCoordinates()):Ee.EXTERIOR},Go.prototype.intersects=function(r,s){return this.locate(r,s)!==Ee.EXTERIOR},Go.prototype.updateLocationInfo=function(r){r===Ee.INTERIOR&&(this._isIn=!0),r===Ee.BOUNDARY&&this._numBoundaries++},Go.prototype.computeLocation=function(r,s){if(s instanceof Ho&&this.updateLocationInfo(this.locateInternal(r,s)),s instanceof mn)this.updateLocationInfo(this.locateInternal(r,s));else if(s instanceof ki)this.updateLocationInfo(this.locateInternal(r,s));else if(s instanceof hn)for(var f=s,m=0;m<f.getNumGeometries();m++){var S=f.getGeometryN(m);this.updateLocationInfo(this.locateInternal(r,S))}else if(s instanceof Kn)for(var k=s,V=0;V<k.getNumGeometries();V++){var de=k.getGeometryN(V);this.updateLocationInfo(this.locateInternal(r,de))}else if(s instanceof Yr)for(var Re=new Is(s);Re.hasNext();){var yt=Re.next();yt!==s&&this.computeLocation(r,yt)}},Go.prototype.locate=function(r,s){return s.isEmpty()?Ee.EXTERIOR:s instanceof mn||s instanceof ki?this.locateInternal(r,s):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(r,s),this._boundaryRule.isInBoundary(this._numBoundaries)?Ee.BOUNDARY:this._numBoundaries>0||this._isIn?Ee.INTERIOR:Ee.EXTERIOR)},Go.prototype.interfaces_=function(){return[]},Go.prototype.getClass=function(){return Go};var Lo=function r(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)r.call(this,arguments[0],r.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var S=arguments[1],k=arguments[2];this._component=arguments[0],this._segIndex=S,this._pt=k}},Ol={INSIDE_AREA:{configurable:!0}};Lo.prototype.isInsideArea=function(){return this._segIndex===Lo.INSIDE_AREA},Lo.prototype.getCoordinate=function(){return this._pt},Lo.prototype.getGeometryComponent=function(){return this._component},Lo.prototype.getSegmentIndex=function(){return this._segIndex},Lo.prototype.interfaces_=function(){return[]},Lo.prototype.getClass=function(){return Lo},Ol.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Lo,Ol);var Ga=function(r){this._pts=r||null};Ga.prototype.filter=function(r){r instanceof Ho&&this._pts.add(r)},Ga.prototype.interfaces_=function(){return[Rr]},Ga.prototype.getClass=function(){return Ga},Ga.getPoints=function(){if(1===arguments.length){var r=arguments[0];return r instanceof Ho?Ms.singletonList(r):Ga.getPoints(r,new Mr)}if(2===arguments.length){var s=arguments[0],f=arguments[1];return s instanceof Ho?f.add(s):s instanceof Yr&&s.apply(new Ga(f)),f}};var hl=function(){this._locations=null,this._locations=arguments[0]};hl.prototype.filter=function(r){(r instanceof Ho||r instanceof mn||r instanceof ki)&&this._locations.add(new Lo(r,0,r.getCoordinate()))},hl.prototype.interfaces_=function(){return[Rr]},hl.prototype.getClass=function(){return hl},hl.getLocations=function(r){var s=new Mr;return r.apply(new hl(s)),s};var So=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Go,this._minDistanceLocation=null,this._minDistance=ee.MAX_VALUE,2===arguments.length)this._geom=[arguments[0],arguments[1]],this._terminateDistance=0;else if(3===arguments.length){var f=arguments[0],m=arguments[1],S=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=f,this._geom[1]=m,this._terminateDistance=S}};So.prototype.computeContainmentDistance=function(){if(0===arguments.length){var r=new Array(2).fill(null);if(this.computeContainmentDistance(0,r),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,r)}else if(2===arguments.length){var s=arguments[0],f=arguments[1],m=1-s,S=Qs.getPolygons(this._geom[s]);if(S.size()>0){var k=hl.getLocations(this._geom[m]);if(this.computeContainmentDistance(k,S,f),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[m]=f[0],this._minDistanceLocation[s]=f[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&Nt(arguments[0],Bn)&&Nt(arguments[1],Bn)){for(var V=arguments[0],de=arguments[1],Re=arguments[2],yt=0;yt<V.size();yt++)for(var gt=V.get(yt),ar=0;ar<de.size();ar++)if(this.computeContainmentDistance(gt,de.get(ar),Re),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Lo&&arguments[1]instanceof ki){var Gr=arguments[0],Br=arguments[1],sn=arguments[2],Mn=Gr.getCoordinate();if(Ee.EXTERIOR!==this._ptLocator.locate(Mn,Br))return this._minDistance=0,sn[0]=Gr,sn[1]=new Lo(Br,Mn),null}},So.prototype.computeMinDistanceLinesPoints=function(r,s,f){for(var m=0;m<r.size();m++)for(var S=r.get(m),k=0;k<s.size();k++){var V=s.get(k);if(this.computeMinDistance(S,V,f),this._minDistance<=this._terminateDistance)return null}},So.prototype.computeFacetDistance=function(){var r=new Array(2).fill(null),s=ds.getLines(this._geom[0]),f=ds.getLines(this._geom[1]),m=Ga.getPoints(this._geom[0]),S=Ga.getPoints(this._geom[1]);return this.computeMinDistanceLines(s,f,r),this.updateMinDistance(r,!1),this._minDistance<=this._terminateDistance?null:(r[0]=null,r[1]=null,this.computeMinDistanceLinesPoints(s,S,r),this.updateMinDistance(r,!1),this._minDistance<=this._terminateDistance?null:(r[0]=null,r[1]=null,this.computeMinDistanceLinesPoints(f,m,r),this.updateMinDistance(r,!0),this._minDistance<=this._terminateDistance?null:(r[0]=null,r[1]=null,this.computeMinDistancePoints(m,S,r),void this.updateMinDistance(r,!1))))},So.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},So.prototype.updateMinDistance=function(r,s){if(null===r[0])return null;s?(this._minDistanceLocation[0]=r[1],this._minDistanceLocation[1]=r[0]):(this._minDistanceLocation[0]=r[0],this._minDistanceLocation[1]=r[1])},So.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},So.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof mn&&arguments[1]instanceof Ho){var r=arguments[0],s=arguments[1],f=arguments[2];if(r.getEnvelopeInternal().distance(s.getEnvelopeInternal())>this._minDistance)return null;for(var m=r.getCoordinates(),S=s.getCoordinate(),k=0;k<m.length-1;k++){var V=rr.distancePointLine(S,m[k],m[k+1]);if(V<this._minDistance){this._minDistance=V;var de=new _n(m[k],m[k+1]).closestPoint(S);f[0]=new Lo(r,k,de),f[1]=new Lo(s,0,S)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof mn&&arguments[1]instanceof mn){var Re=arguments[0],yt=arguments[1],gt=arguments[2];if(Re.getEnvelopeInternal().distance(yt.getEnvelopeInternal())>this._minDistance)return null;for(var ar=Re.getCoordinates(),Gr=yt.getCoordinates(),Br=0;Br<ar.length-1;Br++)for(var sn=0;sn<Gr.length-1;sn++){var Mn=rr.distanceLineLine(ar[Br],ar[Br+1],Gr[sn],Gr[sn+1]);if(Mn<this._minDistance){this._minDistance=Mn;var no=new _n(ar[Br],ar[Br+1]),ls=new _n(Gr[sn],Gr[sn+1]),na=no.closestPoints(ls);gt[0]=new Lo(Re,Br,na[0]),gt[1]=new Lo(yt,sn,na[1])}if(this._minDistance<=this._terminateDistance)return null}}},So.prototype.computeMinDistancePoints=function(r,s,f){for(var m=0;m<r.size();m++)for(var S=r.get(m),k=0;k<s.size();k++){var V=s.get(k),de=S.getCoordinate().distance(V.getCoordinate());if(de<this._minDistance&&(this._minDistance=de,f[0]=new Lo(S,0,S.getCoordinate()),f[1]=new Lo(V,0,V.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},So.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new X("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},So.prototype.computeMinDistanceLines=function(r,s,f){for(var m=0;m<r.size();m++)for(var S=r.get(m),k=0;k<s.size();k++){var V=s.get(k);if(this.computeMinDistance(S,V,f),this._minDistance<=this._terminateDistance)return null}},So.prototype.interfaces_=function(){return[]},So.prototype.getClass=function(){return So},So.distance=function(r,s){return new So(r,s).distance()},So.isWithinDistance=function(r,s,f){return new So(r,s,f).distance()<=f},So.nearestPoints=function(r,s){return new So(r,s).nearestPoints()};var Bi=function(){this._pt=[new re,new re],this._distance=ee.NaN,this._isNull=!0};Bi.prototype.getCoordinates=function(){return this._pt},Bi.prototype.getCoordinate=function(r){return this._pt[r]},Bi.prototype.setMinimum=function(){if(1===arguments.length){var r=arguments[0];this.setMinimum(r._pt[0],r._pt[1])}else if(2===arguments.length){var s=arguments[0],f=arguments[1];if(this._isNull)return this.initialize(s,f),null;var m=s.distance(f);m<this._distance&&this.initialize(s,f,m)}},Bi.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var r=arguments[0],s=arguments[1];this._pt[0].setCoordinate(r),this._pt[1].setCoordinate(s),this._distance=r.distance(s),this._isNull=!1}else if(3===arguments.length){var m=arguments[1],S=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(m),this._distance=S,this._isNull=!1}},Bi.prototype.toString=function(){return st.toLineString(this._pt[0],this._pt[1])},Bi.prototype.getDistance=function(){return this._distance},Bi.prototype.setMaximum=function(){if(1===arguments.length){var r=arguments[0];this.setMaximum(r._pt[0],r._pt[1])}else if(2===arguments.length){var s=arguments[0],f=arguments[1];if(this._isNull)return this.initialize(s,f),null;var m=s.distance(f);m>this._distance&&this.initialize(s,f,m)}},Bi.prototype.interfaces_=function(){return[]},Bi.prototype.getClass=function(){return Bi};var ea=function(){};ea.prototype.interfaces_=function(){return[]},ea.prototype.getClass=function(){return ea},ea.computeDistance=function(){if(arguments[2]instanceof Bi&&arguments[0]instanceof mn&&arguments[1]instanceof re)for(var r=arguments[0],s=arguments[1],f=arguments[2],m=new _n,S=r.getCoordinates(),k=0;k<S.length-1;k++){m.setCoordinates(S[k],S[k+1]);var V=m.closestPoint(s);f.setMinimum(V,s)}else if(arguments[2]instanceof Bi&&arguments[0]instanceof ki&&arguments[1]instanceof re){var de=arguments[0],Re=arguments[1],yt=arguments[2];ea.computeDistance(de.getExteriorRing(),Re,yt);for(var gt=0;gt<de.getNumInteriorRing();gt++)ea.computeDistance(de.getInteriorRingN(gt),Re,yt)}else if(arguments[2]instanceof Bi&&arguments[0]instanceof Lr&&arguments[1]instanceof re){var ar=arguments[0],Gr=arguments[1],Br=arguments[2];if(ar instanceof mn)ea.computeDistance(ar,Gr,Br);else if(ar instanceof ki)ea.computeDistance(ar,Gr,Br);else if(ar instanceof Yr)for(var sn=ar,Mn=0;Mn<sn.getNumGeometries();Mn++){var no=sn.getGeometryN(Mn);ea.computeDistance(no,Gr,Br)}else Br.setMinimum(ar.getCoordinate(),Gr)}else if(arguments[2]instanceof Bi&&arguments[0]instanceof _n&&arguments[1]instanceof re){var na=arguments[1],wl=arguments[2],Nl=arguments[0].closestPoint(na);wl.setMinimum(Nl,na)}};var ta=function(){this._g0=null,this._g1=null,this._ptDist=new Bi,this._densifyFrac=0;var s=arguments[1];this._g0=arguments[0],this._g1=s},ha={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};ta.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},ta.prototype.setDensifyFraction=function(r){if(r>1||r<=0)throw new X("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=r},ta.prototype.compute=function(r,s){this.computeOrientedDistance(r,s,this._ptDist),this.computeOrientedDistance(s,r,this._ptDist)},ta.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},ta.prototype.computeOrientedDistance=function(r,s,f){var m=new Ta(s);if(r.apply(m),f.setMaximum(m.getMaxPointDistance()),this._densifyFrac>0){var S=new ra(s,this._densifyFrac);r.apply(S),f.setMaximum(S.getMaxPointDistance())}},ta.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},ta.prototype.interfaces_=function(){return[]},ta.prototype.getClass=function(){return ta},ta.distance=function(){if(2===arguments.length)return new ta(arguments[0],arguments[1]).distance();if(3===arguments.length){var S=arguments[2],k=new ta(arguments[0],arguments[1]);return k.setDensifyFraction(S),k.distance()}},ha.MaxPointDistanceFilter.get=function(){return Ta},ha.MaxDensifiedByFractionDistanceFilter.get=function(){return ra},Object.defineProperties(ta,ha);var Ta=function(){this._maxPtDist=new Bi,this._minPtDist=new Bi,this._euclideanDist=new ea,this._geom=null,this._geom=arguments[0]};Ta.prototype.filter=function(r){this._minPtDist.initialize(),ea.computeDistance(this._geom,r,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Ta.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ta.prototype.interfaces_=function(){return[Jn]},Ta.prototype.getClass=function(){return Ta};var ra=function(){this._maxPtDist=new Bi,this._minPtDist=new Bi,this._geom=null,this._numSubSegs=0;var s=arguments[1];this._geom=arguments[0],this._numSubSegs=Math.trunc(Math.round(1/s))};ra.prototype.filter=function(r,s){if(0===s)return null;for(var f=r.getCoordinate(s-1),m=r.getCoordinate(s),S=(m.x-f.x)/this._numSubSegs,k=(m.y-f.y)/this._numSubSegs,V=0;V<this._numSubSegs;V++){var yt=new re(f.x+V*S,f.y+V*k);this._minPtDist.initialize(),ea.computeDistance(this._geom,yt,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},ra.prototype.isDone=function(){return!1},ra.prototype.isGeometryChanged=function(){return!1},ra.prototype.getMaxPointDistance=function(){return this._maxPtDist},ra.prototype.interfaces_=function(){return[mr]},ra.prototype.getClass=function(){return ra};var Bs=function(r,s,f){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=r||null,this._bufDistance=s||null,this._result=f||null},Ei={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Bs.prototype.checkMaximumDistance=function(r,s,f){var m=new ta(s,r);if(m.setDensifyFraction(.25),this._maxDistanceFound=m.orientedDistance(),this._maxDistanceFound>f){this._isValid=!1;var S=m.getCoordinates();this._errorLocation=S[1],this._errorIndicator=r.getFactory().createLineString(S),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+st.toLineString(S[0],S[1])+")"}},Bs.prototype.isValid=function(){var r=Math.abs(this._bufDistance),s=Bs.MAX_DISTANCE_DIFF_FRAC*r;return this._minValidDistance=r-s,this._maxValidDistance=r+s,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Bs.VERBOSE&&rn.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Bs.prototype.checkNegativeValid=function(){if(!(this._input instanceof ki||this._input instanceof Kn||this._input instanceof Yr))return null;var r=this.getPolygonLines(this._input);if(this.checkMinimumDistance(r,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(r,this._result,this._maxValidDistance)},Bs.prototype.getErrorIndicator=function(){return this._errorIndicator},Bs.prototype.checkMinimumDistance=function(r,s,f){var m=new So(r,s,f);if(this._minDistanceFound=m.distance(),this._minDistanceFound<f){this._isValid=!1;var S=m.nearestPoints();this._errorLocation=m.nearestPoints()[1],this._errorIndicator=r.getFactory().createLineString(S),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+st.toLineString(S[0],S[1])+" )"}},Bs.prototype.checkPositiveValid=function(){var r=this._result.getBoundary();if(this.checkMinimumDistance(this._input,r,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,r,this._maxValidDistance)},Bs.prototype.getErrorLocation=function(){return this._errorLocation},Bs.prototype.getPolygonLines=function(r){for(var s=new Mr,f=new ds(s),m=Qs.getPolygons(r).iterator();m.hasNext();)m.next().apply(f);return r.getFactory().buildGeometry(s)},Bs.prototype.getErrorMessage=function(){return this._errMsg},Bs.prototype.interfaces_=function(){return[]},Bs.prototype.getClass=function(){return Bs},Ei.VERBOSE.get=function(){return!1},Ei.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Bs,Ei);var jo=function(r,s,f){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=r||null,this._distance=s||null,this._result=f||null},uc={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};jo.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},jo.prototype.checkEnvelope=function(){if(this._distance<0)return null;var r=this._distance*jo.MAX_ENV_DIFF_FRAC;0===r&&(r=.001);var s=new xr(this._input.getEnvelopeInternal());s.expandBy(this._distance);var f=new xr(this._result.getEnvelopeInternal());f.expandBy(r),f.contains(s)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(f)),this.report("Envelope")},jo.prototype.checkDistance=function(){var r=new Bs(this._input,this._distance,this._result);r.isValid()||(this._isValid=!1,this._errorMsg=r.getErrorMessage(),this._errorLocation=r.getErrorLocation(),this._errorIndicator=r.getErrorIndicator()),this.report("Distance")},jo.prototype.checkArea=function(){var r=this._input.getArea(),s=this._result.getArea();this._distance>0&&r>s&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&r<s&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},jo.prototype.checkPolygonal=function(){this._result instanceof ki||this._result instanceof Kn||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},jo.prototype.getErrorIndicator=function(){return this._errorIndicator},jo.prototype.getErrorLocation=function(){return this._errorLocation},jo.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},jo.prototype.report=function(r){if(!jo.VERBOSE)return null;rn.out.println("Check "+r+": "+(this._isValid?"passed":"FAILED"))},jo.prototype.getErrorMessage=function(){return this._errorMsg},jo.prototype.interfaces_=function(){return[]},jo.prototype.getClass=function(){return jo},jo.isValidMsg=function(r,s,f){var m=new jo(r,s,f);return m.isValid()?null:m.getErrorMessage()},jo.isValid=function(r,s,f){return!!new jo(r,s,f).isValid()},uc.VERBOSE.get=function(){return!1},uc.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(jo,uc);var ja=function(){this._pts=null,this._data=null;var s=arguments[1];this._pts=arguments[0],this._data=s};ja.prototype.getCoordinates=function(){return this._pts},ja.prototype.size=function(){return this._pts.length},ja.prototype.getCoordinate=function(r){return this._pts[r]},ja.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},ja.prototype.getSegmentOctant=function(r){return r===this._pts.length-1?-1:Fa.octant(this.getCoordinate(r),this.getCoordinate(r+1))},ja.prototype.setData=function(r){this._data=r},ja.prototype.getData=function(){return this._data},ja.prototype.toString=function(){return st.toLineString(new oi(this._pts))},ja.prototype.interfaces_=function(){return[La]},ja.prototype.getClass=function(){return ja};var ss=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Mr,this._intersectionCount=0,this._keepIntersections=!0,this._li=arguments[0],this._interiorIntersection=null};ss.prototype.getInteriorIntersection=function(){return this._interiorIntersection},ss.prototype.setCheckEndSegmentsOnly=function(r){this._isCheckEndSegmentsOnly=r},ss.prototype.getIntersectionSegments=function(){return this._intSegments},ss.prototype.count=function(){return this._intersectionCount},ss.prototype.getIntersections=function(){return this._intersections},ss.prototype.setFindAllIntersections=function(r){this._findAllIntersections=r},ss.prototype.setKeepIntersections=function(r){this._keepIntersections=r},ss.prototype.processIntersections=function(r,s,f,m){if(!this._findAllIntersections&&this.hasIntersection()||r===f&&s===m||this._isCheckEndSegmentsOnly&&!this.isEndSegment(r,s)&&!this.isEndSegment(f,m))return null;var S=r.getCoordinates()[s],k=r.getCoordinates()[s+1],V=f.getCoordinates()[m],de=f.getCoordinates()[m+1];this._li.computeIntersection(S,k,V,de),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=S,this._intSegments[1]=k,this._intSegments[2]=V,this._intSegments[3]=de,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},ss.prototype.isEndSegment=function(r,s){return 0===s||s>=r.size()-2},ss.prototype.hasIntersection=function(){return null!==this._interiorIntersection},ss.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},ss.prototype.interfaces_=function(){return[Ha]},ss.prototype.getClass=function(){return ss},ss.createAllIntersectionsFinder=function(r){var s=new ss(r);return s.setFindAllIntersections(!0),s},ss.createAnyIntersectionFinder=function(r){return new ss(r)},ss.createIntersectionCounter=function(r){var s=new ss(r);return s.setFindAllIntersections(!0),s.setKeepIntersections(!1),s};var Qa=function(){this._li=new Xt,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0,this._segStrings=arguments[0]};Qa.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},Qa.prototype.getIntersections=function(){return this._segInt.getIntersections()},Qa.prototype.isValid=function(){return this.execute(),this._isValid},Qa.prototype.setFindAllIntersections=function(r){this._findAllIntersections=r},Qa.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new ss(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var r=new ll;if(r.setSegmentIntersector(this._segInt),r.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},Qa.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new wr(this.getErrorMessage(),this._segInt.getInteriorIntersection())},Qa.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var r=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+st.toLineString(r[0],r[1])+" and "+st.toLineString(r[2],r[3])},Qa.prototype.interfaces_=function(){return[]},Qa.prototype.getClass=function(){return Qa},Qa.computeIntersections=function(r){var s=new Qa(r);return s.setFindAllIntersections(!0),s.isValid(),s.getIntersections()};var cu=function r(){this._nv=null,this._nv=new Qa(r.toSegmentStrings(arguments[0]))};cu.prototype.checkValid=function(){this._nv.checkValid()},cu.prototype.interfaces_=function(){return[]},cu.prototype.getClass=function(){return cu},cu.toSegmentStrings=function(r){for(var s=new Mr,f=r.iterator();f.hasNext();){var m=f.next();s.add(new ja(m.getCoordinates(),m))}return s},cu.checkValid=function(r){new cu(r).checkValid()};var hu=function(r){this._mapOp=r};hu.prototype.map=function(r){for(var s=new Mr,f=0;f<r.getNumGeometries();f++){var m=this._mapOp.map(r.getGeometryN(f));m.isEmpty()||s.add(m)}return r.getFactory().createGeometryCollection($n.toGeometryArray(s))},hu.prototype.interfaces_=function(){return[]},hu.prototype.getClass=function(){return hu},hu.map=function(r,s){return new hu(s).map(r)};var el=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Mr,this._resultLineList=new Mr;var s=arguments[1],f=arguments[2];this._op=arguments[0],this._geometryFactory=s,this._ptLocator=f};el.prototype.collectLines=function(r){for(var s=this._op.getGraph().getEdgeEnds().iterator();s.hasNext();){var f=s.next();this.collectLineEdge(f,r,this._lineEdgesList),this.collectBoundaryTouchEdge(f,r,this._lineEdgesList)}},el.prototype.labelIsolatedLine=function(r,s){var f=this._ptLocator.locate(r.getCoordinate(),this._op.getArgGeometry(s));r.getLabel().setLocation(s,f)},el.prototype.build=function(r){return this.findCoveredLineEdges(),this.collectLines(r),this.buildLines(r),this._resultLineList},el.prototype.collectLineEdge=function(r,s,f){var m=r.getLabel(),S=r.getEdge();r.isLineEdge()&&(r.isVisited()||!Zn.isResultOfOp(m,s)||S.isCovered()||(f.add(S),r.setVisitedEdge(!0)))},el.prototype.findCoveredLineEdges=function(){for(var r=this._op.getGraph().getNodes().iterator();r.hasNext();)r.next().getEdges().findCoveredLineEdges();for(var s=this._op.getGraph().getEdgeEnds().iterator();s.hasNext();){var f=s.next(),m=f.getEdge();if(f.isLineEdge()&&!m.isCoveredSet()){var S=this._op.isCoveredByA(f.getCoordinate());m.setCovered(S)}}},el.prototype.labelIsolatedLines=function(r){for(var s=r.iterator();s.hasNext();){var f=s.next(),m=f.getLabel();f.isIsolated()&&(m.isNull(0)?this.labelIsolatedLine(f,0):this.labelIsolatedLine(f,1))}},el.prototype.buildLines=function(r){for(var s=this._lineEdgesList.iterator();s.hasNext();){var f=s.next(),m=this._geometryFactory.createLineString(f.getCoordinates());this._resultLineList.add(m),f.setInResult(!0)}},el.prototype.collectBoundaryTouchEdge=function(r,s,f){var m=r.getLabel();return r.isLineEdge()||r.isVisited()||r.isInteriorAreaEdge()||r.getEdge().isInResult()?null:(ve.isTrue(!(r.isInResult()||r.getSym().isInResult())||!r.getEdge().isInResult()),void(Zn.isResultOfOp(m,s)&&s===Zn.INTERSECTION&&(f.add(r.getEdge()),r.setVisitedEdge(!0))))},el.prototype.interfaces_=function(){return[]},el.prototype.getClass=function(){return el};var Gl=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Mr;var s=arguments[1];this._op=arguments[0],this._geometryFactory=s};Gl.prototype.filterCoveredNodeToPoint=function(r){var s=r.getCoordinate();if(!this._op.isCoveredByLA(s)){var f=this._geometryFactory.createPoint(s);this._resultPointList.add(f)}},Gl.prototype.extractNonCoveredResultNodes=function(r){for(var s=this._op.getGraph().getNodes().iterator();s.hasNext();){var f=s.next();if(!(f.isInResult()||f.isIncidentEdgeInResult()||0!==f.getEdges().getDegree()&&r!==Zn.INTERSECTION)){var m=f.getLabel();Zn.isResultOfOp(m,r)&&this.filterCoveredNodeToPoint(f)}}},Gl.prototype.build=function(r){return this.extractNonCoveredResultNodes(r),this._resultPointList},Gl.prototype.interfaces_=function(){return[]},Gl.prototype.getClass=function(){return Gl};var Ps=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Ps.prototype.transformPoint=function(r,s){return this._factory.createPoint(this.transformCoordinates(r.getCoordinateSequence(),r))},Ps.prototype.transformPolygon=function(r,s){var f=!0,m=this.transformLinearRing(r.getExteriorRing(),r);null!==m&&m instanceof hs&&!m.isEmpty()||(f=!1);for(var S=new Mr,k=0;k<r.getNumInteriorRing();k++){var V=this.transformLinearRing(r.getInteriorRingN(k),r);null===V||V.isEmpty()||(V instanceof hs||(f=!1),S.add(V))}if(f)return this._factory.createPolygon(m,S.toArray([]));var de=new Mr;return null!==m&&de.add(m),de.addAll(S),this._factory.buildGeometry(de)},Ps.prototype.createCoordinateSequence=function(r){return this._factory.getCoordinateSequenceFactory().create(r)},Ps.prototype.getInputGeometry=function(){return this._inputGeom},Ps.prototype.transformMultiLineString=function(r,s){for(var f=new Mr,m=0;m<r.getNumGeometries();m++){var S=this.transformLineString(r.getGeometryN(m),r);null!==S&&(S.isEmpty()||f.add(S))}return this._factory.buildGeometry(f)},Ps.prototype.transformCoordinates=function(r,s){return this.copy(r)},Ps.prototype.transformLineString=function(r,s){return this._factory.createLineString(this.transformCoordinates(r.getCoordinateSequence(),r))},Ps.prototype.transformMultiPoint=function(r,s){for(var f=new Mr,m=0;m<r.getNumGeometries();m++){var S=this.transformPoint(r.getGeometryN(m),r);null!==S&&(S.isEmpty()||f.add(S))}return this._factory.buildGeometry(f)},Ps.prototype.transformMultiPolygon=function(r,s){for(var f=new Mr,m=0;m<r.getNumGeometries();m++){var S=this.transformPolygon(r.getGeometryN(m),r);null!==S&&(S.isEmpty()||f.add(S))}return this._factory.buildGeometry(f)},Ps.prototype.copy=function(r){return r.copy()},Ps.prototype.transformGeometryCollection=function(r,s){for(var f=new Mr,m=0;m<r.getNumGeometries();m++){var S=this.transform(r.getGeometryN(m));null!==S&&(this._pruneEmptyGeometry&&S.isEmpty()||f.add(S))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection($n.toGeometryArray(f)):this._factory.buildGeometry(f)},Ps.prototype.transform=function(r){if(this._inputGeom=r,this._factory=r.getFactory(),r instanceof Ho)return this.transformPoint(r,null);if(r instanceof ur)return this.transformMultiPoint(r,null);if(r instanceof hs)return this.transformLinearRing(r,null);if(r instanceof mn)return this.transformLineString(r,null);if(r instanceof hn)return this.transformMultiLineString(r,null);if(r instanceof ki)return this.transformPolygon(r,null);if(r instanceof Kn)return this.transformMultiPolygon(r,null);if(r instanceof Yr)return this.transformGeometryCollection(r,null);throw new X("Unknown Geometry subtype: "+r.getClass().getName())},Ps.prototype.transformLinearRing=function(r,s){var f=this.transformCoordinates(r.getCoordinateSequence(),r);if(null===f)return this._factory.createLinearRing(null);var m=f.size();return m>0&&m<4&&!this._preserveType?this._factory.createLineString(f):this._factory.createLinearRing(f)},Ps.prototype.interfaces_=function(){return[]},Ps.prototype.getClass=function(){return Ps};var Ma=function r(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new _n,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof mn&&"number"==typeof arguments[1]){var f=arguments[1];r.call(this,arguments[0].getCoordinates(),f)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var m=arguments[0],S=arguments[1];this._srcPts=m,this._isClosed=r.isClosed(m),this._snapTolerance=S}};Ma.prototype.snapVertices=function(r,s){for(var f=this._isClosed?r.size()-1:r.size(),m=0;m<f;m++){var S=r.get(m),k=this.findSnapForVertex(S,s);null!==k&&(r.set(m,new re(k)),0===m&&this._isClosed&&r.set(r.size()-1,new re(k)))}},Ma.prototype.findSnapForVertex=function(r,s){for(var f=0;f<s.length;f++){if(r.equals2D(s[f]))return null;if(r.distance(s[f])<this._snapTolerance)return s[f]}return null},Ma.prototype.snapTo=function(r){var s=new Ys(this._srcPts);return this.snapVertices(s,r),this.snapSegments(s,r),s.toCoordinateArray()},Ma.prototype.snapSegments=function(r,s){if(0===s.length)return null;var f=s.length;s[0].equals2D(s[s.length-1])&&(f=s.length-1);for(var m=0;m<f;m++){var S=s[m],k=this.findSegmentIndexToSnap(S,r);k>=0&&r.add(k+1,new re(S),!1)}},Ma.prototype.findSegmentIndexToSnap=function(r,s){for(var f=ee.MAX_VALUE,m=-1,S=0;S<s.size()-1;S++){if(this._seg.p0=s.get(S),this._seg.p1=s.get(S+1),this._seg.p0.equals2D(r)||this._seg.p1.equals2D(r)){if(this._allowSnappingToSourceVertices)continue;return-1}var k=this._seg.distance(r);k<this._snapTolerance&&k<f&&(f=k,m=S)}return m},Ma.prototype.setAllowSnappingToSourceVertices=function(r){this._allowSnappingToSourceVertices=r},Ma.prototype.interfaces_=function(){return[]},Ma.prototype.getClass=function(){return Ma},Ma.isClosed=function(r){return!(r.length<=1)&&r[0].equals2D(r[r.length-1])};var xo=function(r){this._srcGeom=r||null},cc={SNAP_PRECISION_FACTOR:{configurable:!0}};xo.prototype.snapTo=function(r,s){var f=this.extractTargetCoordinates(r);return new Wu(s,f).transform(this._srcGeom)},xo.prototype.snapToSelf=function(r,s){var f=this.extractTargetCoordinates(this._srcGeom),m=new Wu(r,f,!0).transform(this._srcGeom),S=m;return s&&Nt(S,Ts)&&(S=m.buffer(0)),S},xo.prototype.computeSnapTolerance=function(r){return this.computeMinimumSegmentLength(r)/10},xo.prototype.extractTargetCoordinates=function(r){for(var s=new Oe,f=r.getCoordinates(),m=0;m<f.length;m++)s.add(f[m]);return s.toArray(new Array(0).fill(null))},xo.prototype.computeMinimumSegmentLength=function(r){for(var s=ee.MAX_VALUE,f=0;f<r.length-1;f++){var m=r[f].distance(r[f+1]);m<s&&(s=m)}return s},xo.prototype.interfaces_=function(){return[]},xo.prototype.getClass=function(){return xo},xo.snap=function(r,s,f){var m=new Array(2).fill(null),S=new xo(r);m[0]=S.snapTo(s,f);var k=new xo(s);return m[1]=k.snapTo(m[0],f),m},xo.computeOverlaySnapTolerance=function(){if(1===arguments.length){var r=arguments[0],s=xo.computeSizeBasedSnapTolerance(r),f=r.getPrecisionModel();if(f.getType()===hi.FIXED){var m=1/f.getScale()*2/1.415;m>s&&(s=m)}return s}if(2===arguments.length){var k=arguments[1];return Math.min(xo.computeOverlaySnapTolerance(arguments[0]),xo.computeOverlaySnapTolerance(k))}},xo.computeSizeBasedSnapTolerance=function(r){var s=r.getEnvelopeInternal();return Math.min(s.getHeight(),s.getWidth())*xo.SNAP_PRECISION_FACTOR},xo.snapToSelf=function(r,s,f){return new xo(r).snapToSelf(s,f)},cc.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(xo,cc);var Wu=function(r){function s(f,m,S){r.call(this),this._snapTolerance=f||null,this._snapPts=m||null,this._isSelfSnap=void 0!==S&&S}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.snapLine=function(f,m){var S=new Ma(f,this._snapTolerance);return S.setAllowSnappingToSourceVertices(this._isSelfSnap),S.snapTo(m)},s.prototype.transformCoordinates=function(f,m){var S=f.toCoordinateArray(),k=this.snapLine(S,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(k)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Ps),xs=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};xs.prototype.getCommon=function(){return ee.longBitsToDouble(this._commonBits)},xs.prototype.add=function(r){var s=ee.doubleToLongBits(r);return this._isFirst?(this._commonBits=s,this._commonSignExp=xs.signExpBits(this._commonBits),this._isFirst=!1,null):xs.signExpBits(s)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=xs.numCommonMostSigMantissaBits(this._commonBits,s),void(this._commonBits=xs.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},xs.prototype.toString=function(){if(1===arguments.length){var r=arguments[0],s=ee.longBitsToDouble(r),f="0000000000000000000000000000000000000000000000000000000000000000"+ee.toBinaryString(r),m=f.substring(f.length-64);return m.substring(0,1)+"  "+m.substring(1,12)+"(exp) "+m.substring(12)+" [ "+s+" ]"}},xs.prototype.interfaces_=function(){return[]},xs.prototype.getClass=function(){return xs},xs.getBit=function(r,s){return 0!=(r&1<<s)?1:0},xs.signExpBits=function(r){return r>>52},xs.zeroLowerBits=function(r,s){return r&~((1<<s)-1)},xs.numCommonMostSigMantissaBits=function(r,s){for(var f=0,m=52;m>=0;m--){if(xs.getBit(r,m)!==xs.getBit(s,m))return f;f++}return 52};var bl=function(){this._commonCoord=null,this._ccFilter=new Ia},Hr={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};bl.prototype.addCommonBits=function(r){var s=new pl(this._commonCoord);r.apply(s),r.geometryChanged()},bl.prototype.removeCommonBits=function(r){if(0===this._commonCoord.x&&0===this._commonCoord.y)return r;var s=new re(this._commonCoord);s.x=-s.x,s.y=-s.y;var f=new pl(s);return r.apply(f),r.geometryChanged(),r},bl.prototype.getCommonCoordinate=function(){return this._commonCoord},bl.prototype.add=function(r){r.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},bl.prototype.interfaces_=function(){return[]},bl.prototype.getClass=function(){return bl},Hr.CommonCoordinateFilter.get=function(){return Ia},Hr.Translater.get=function(){return pl},Object.defineProperties(bl,Hr);var Ia=function(){this._commonBitsX=new xs,this._commonBitsY=new xs};Ia.prototype.filter=function(r){this._commonBitsX.add(r.x),this._commonBitsY.add(r.y)},Ia.prototype.getCommonCoordinate=function(){return new re(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},Ia.prototype.interfaces_=function(){return[Jn]},Ia.prototype.getClass=function(){return Ia};var pl=function(){this.trans=null,this.trans=arguments[0]};pl.prototype.filter=function(r,s){var f=r.getOrdinate(s,0)+this.trans.x,m=r.getOrdinate(s,1)+this.trans.y;r.setOrdinate(s,0,f),r.setOrdinate(s,1,m)},pl.prototype.isDone=function(){return!1},pl.prototype.isGeometryChanged=function(){return!0},pl.prototype.interfaces_=function(){return[mr]},pl.prototype.getClass=function(){return pl};var As=function(r,s){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=r,this._geom[1]=s,this.computeSnapTolerance()};As.prototype.selfSnap=function(r){return new xo(r).snapTo(r,this._snapTolerance)},As.prototype.removeCommonBits=function(r){this._cbr=new bl,this._cbr.add(r[0]),this._cbr.add(r[1]);var s=new Array(2).fill(null);return s[0]=this._cbr.removeCommonBits(r[0].copy()),s[1]=this._cbr.removeCommonBits(r[1].copy()),s},As.prototype.prepareResult=function(r){return this._cbr.addCommonBits(r),r},As.prototype.getResultGeometry=function(r){var s=this.snap(this._geom),f=Zn.overlayOp(s[0],s[1],r);return this.prepareResult(f)},As.prototype.checkValid=function(r){r.isValid()||rn.out.println("Snapped geometry is invalid")},As.prototype.computeSnapTolerance=function(){this._snapTolerance=xo.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},As.prototype.snap=function(r){var s=this.removeCommonBits(r);return xo.snap(s[0],s[1],this._snapTolerance)},As.prototype.interfaces_=function(){return[]},As.prototype.getClass=function(){return As},As.overlayOp=function(r,s,f){return new As(r,s).getResultGeometry(f)},As.union=function(r,s){return As.overlayOp(r,s,Zn.UNION)},As.intersection=function(r,s){return As.overlayOp(r,s,Zn.INTERSECTION)},As.symDifference=function(r,s){return As.overlayOp(r,s,Zn.SYMDIFFERENCE)},As.difference=function(r,s){return As.overlayOp(r,s,Zn.DIFFERENCE)};var pa=function(r,s){this._geom=new Array(2).fill(null),this._geom[0]=r,this._geom[1]=s};pa.prototype.getResultGeometry=function(r){var s=null,f=!1,m=null;try{s=Zn.overlayOp(this._geom[0],this._geom[1],r),f=!0}catch(S){if(!(S instanceof Se))throw S;m=S}if(!f)try{s=As.overlayOp(this._geom[0],this._geom[1],r)}catch(S){throw S instanceof Se?m:S}return s},pa.prototype.interfaces_=function(){return[]},pa.prototype.getClass=function(){return pa},pa.overlayOp=function(r,s,f){return new pa(r,s).getResultGeometry(f)},pa.union=function(r,s){return pa.overlayOp(r,s,Zn.UNION)},pa.intersection=function(r,s){return pa.overlayOp(r,s,Zn.INTERSECTION)},pa.symDifference=function(r,s){return pa.overlayOp(r,s,Zn.SYMDIFFERENCE)},pa.difference=function(r,s){return pa.overlayOp(r,s,Zn.DIFFERENCE)};var jl=function(){this.mce=null,this.chainIndex=null;var s=arguments[1];this.mce=arguments[0],this.chainIndex=s};jl.prototype.computeIntersections=function(r,s){this.mce.computeIntersectsForChain(this.chainIndex,r.mce,r.chainIndex,s)},jl.prototype.interfaces_=function(){return[]},jl.prototype.getClass=function(){return jl};var fa=function r(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var s=arguments[0],f=arguments[1];this._eventType=r.DELETE,this._xValue=s,this._insertEvent=f}else if(3===arguments.length){var m=arguments[0],S=arguments[1],k=arguments[2];this._eventType=r.INSERT,this._label=m,this._xValue=S,this._obj=k}},pu={INSERT:{configurable:!0},DELETE:{configurable:!0}};fa.prototype.isDelete=function(){return this._eventType===fa.DELETE},fa.prototype.setDeleteEventIndex=function(r){this._deleteEventIndex=r},fa.prototype.getObject=function(){return this._obj},fa.prototype.compareTo=function(r){return this._xValue<r._xValue?-1:this._xValue>r._xValue?1:this._eventType<r._eventType?-1:this._eventType>r._eventType?1:0},fa.prototype.getInsertEvent=function(){return this._insertEvent},fa.prototype.isInsert=function(){return this._eventType===fa.INSERT},fa.prototype.isSameLabel=function(r){return null!==this._label&&this._label===r._label},fa.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},fa.prototype.interfaces_=function(){return[ne]},fa.prototype.getClass=function(){return fa},pu.INSERT.get=function(){return 1},pu.DELETE.get=function(){return 2},Object.defineProperties(fa,pu);var fu=function(){};fu.prototype.interfaces_=function(){return[]},fu.prototype.getClass=function(){return fu};var as=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var s=arguments[1],f=arguments[2];this._li=arguments[0],this._includeProper=s,this._recordIsolated=f};as.prototype.isTrivialIntersection=function(r,s,f,m){if(r===f&&1===this._li.getIntersectionNum()){if(as.isAdjacentSegments(s,m))return!0;if(r.isClosed()){var S=r.getNumPoints()-1;if(0===s&&m===S||0===m&&s===S)return!0}}return!1},as.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},as.prototype.setIsDoneIfProperInt=function(r){this._isDoneWhenProperInt=r},as.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},as.prototype.isBoundaryPointInternal=function(r,s){for(var f=s.iterator();f.hasNext();){var m=f.next().getCoordinate();if(r.isIntersection(m))return!0}return!1},as.prototype.hasProperIntersection=function(){return this._hasProper},as.prototype.hasIntersection=function(){return this._hasIntersection},as.prototype.isDone=function(){return this._isDone},as.prototype.isBoundaryPoint=function(r,s){return!(null===s||!this.isBoundaryPointInternal(r,s[0])&&!this.isBoundaryPointInternal(r,s[1]))},as.prototype.setBoundaryNodes=function(r,s){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=r,this._bdyNodes[1]=s},as.prototype.addIntersections=function(r,s,f,m){if(r===f&&s===m)return null;this.numTests++;var S=r.getCoordinates()[s],k=r.getCoordinates()[s+1],V=f.getCoordinates()[m],de=f.getCoordinates()[m+1];this._li.computeIntersection(S,k,V,de),this._li.hasIntersection()&&(this._recordIsolated&&(r.setIsolated(!1),f.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(r,s,f,m)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(r.addIntersections(this._li,s,0),f.addIntersections(this._li,m,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},as.prototype.interfaces_=function(){return[]},as.prototype.getClass=function(){return as},as.isAdjacentSegments=function(r,s){return 1===Math.abs(r-s)};var tl=function(r){function s(){r.call(this),this.events=new Mr,this.nOverlaps=null}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.prepareEvents=function(){Ms.sort(this.events);for(var f=0;f<this.events.size();f++){var m=this.events.get(f);m.isDelete()&&m.getInsertEvent().setDeleteEventIndex(f)}},s.prototype.computeIntersections=function(){if(1===arguments.length){var f=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var m=0;m<this.events.size();m++){var S=this.events.get(m);if(S.isInsert()&&this.processOverlaps(m,S.getDeleteEventIndex(),S,f),f.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof as&&Nt(arguments[0],Bn)&&Nt(arguments[1],Bn)){var k=arguments[0],V=arguments[1],de=arguments[2];this.addEdges(k,k),this.addEdges(V,V),this.computeIntersections(de)}else if("boolean"==typeof arguments[2]&&Nt(arguments[0],Bn)&&arguments[1]instanceof as){var Re=arguments[0],yt=arguments[1];arguments[2]?this.addEdges(Re,null):this.addEdges(Re),this.computeIntersections(yt)}},s.prototype.addEdge=function(f,m){for(var S=f.getMonotoneChainEdge(),k=S.getStartIndexes(),V=0;V<k.length-1;V++){var de=new jl(S,V),Re=new fa(m,S.getMinX(V),de);this.events.add(Re),this.events.add(new fa(S.getMaxX(V),Re))}},s.prototype.processOverlaps=function(f,m,S,k){for(var V=S.getObject(),de=f;de<m;de++){var Re=this.events.get(de);if(Re.isInsert()){var yt=Re.getObject();S.isSameLabel(Re)||(V.computeIntersections(yt,k),this.nOverlaps++)}}},s.prototype.addEdges=function(){if(1===arguments.length)for(var f=arguments[0].iterator();f.hasNext();){var m=f.next();this.addEdge(m,m)}else if(2===arguments.length)for(var k=arguments[1],V=arguments[0].iterator();V.hasNext();){var de=V.next();this.addEdge(de,k)}},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(fu),rl=function(){this._min=ee.POSITIVE_INFINITY,this._max=ee.NEGATIVE_INFINITY},Ru={NodeComparator:{configurable:!0}};rl.prototype.getMin=function(){return this._min},rl.prototype.intersects=function(r,s){return!(this._min>s||this._max<r)},rl.prototype.getMax=function(){return this._max},rl.prototype.toString=function(){return st.toLineString(new re(this._min,0),new re(this._max,0))},rl.prototype.interfaces_=function(){return[]},rl.prototype.getClass=function(){return rl},Ru.NodeComparator.get=function(){return hc},Object.defineProperties(rl,Ru);var hc=function(){};hc.prototype.compare=function(r,s){var S=(r._min+r._max)/2,k=(s._min+s._max)/2;return S<k?-1:S>k?1:0},hc.prototype.interfaces_=function(){return[he]},hc.prototype.getClass=function(){return hc};var Mp=function(r){function s(){r.call(this),this._item=null;var m=arguments[1],S=arguments[2];this._min=arguments[0],this._max=m,this._item=S}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.query=function(f,m,S){if(!this.intersects(f,m))return null;S.visitItem(this._item)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(rl),uh=function(r){function s(){r.call(this),this._node1=null,this._node2=null;var m=arguments[1];this._node1=arguments[0],this._node2=m,this.buildExtent(this._node1,this._node2)}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.buildExtent=function(f,m){this._min=Math.min(f._min,m._min),this._max=Math.max(f._max,m._max)},s.prototype.query=function(f,m,S){if(!this.intersects(f,m))return null;null!==this._node1&&this._node1.query(f,m,S),null!==this._node2&&this._node2.query(f,m,S)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(rl),qa=function(){this._leaves=new Mr,this._root=null,this._level=0};qa.prototype.buildTree=function(){Ms.sort(this._leaves,new rl.NodeComparator);for(var r=this._leaves,s=null,f=new Mr;;){if(this.buildLevel(r,f),1===f.size())return f.get(0);s=r,r=f,f=s}},qa.prototype.insert=function(r,s,f){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new Mp(r,s,f))},qa.prototype.query=function(r,s,f){this.init(),this._root.query(r,s,f)},qa.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},qa.prototype.printNode=function(r){rn.out.println(st.toLineString(new re(r._min,this._level),new re(r._max,this._level)))},qa.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},qa.prototype.buildLevel=function(r,s){this._level++,s.clear();for(var f=0;f<r.size();f+=2){var m=r.get(f);if(null===(f+1<r.size()?r.get(f):null))s.add(m);else{var S=new uh(r.get(f),r.get(f+1));s.add(S)}}},qa.prototype.interfaces_=function(){return[]},qa.prototype.getClass=function(){return qa};var du=function(){this._items=new Mr};du.prototype.visitItem=function(r){this._items.add(r)},du.prototype.getItems=function(){return this._items},du.prototype.interfaces_=function(){return[gs]},du.prototype.getClass=function(){return du};var ql=function(){this._index=null;var r=arguments[0];if(!Nt(r,Ts))throw new X("Argument must be Polygonal");this._index=new fl(r)},Fc={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};ql.prototype.locate=function(r){var s=new _r(r),f=new Vl(s);return this._index.query(r.y,r.y,f),s.getLocation()},ql.prototype.interfaces_=function(){return[Bl]},ql.prototype.getClass=function(){return ql},Fc.SegmentVisitor.get=function(){return Vl},Fc.IntervalIndexedGeometry.get=function(){return fl},Object.defineProperties(ql,Fc);var Vl=function(){this._counter=null,this._counter=arguments[0]};Vl.prototype.visitItem=function(r){var s=r;this._counter.countSegment(s.getCoordinate(0),s.getCoordinate(1))},Vl.prototype.interfaces_=function(){return[gs]},Vl.prototype.getClass=function(){return Vl};var fl=function(){this._index=new qa,this.init(arguments[0])};fl.prototype.init=function(r){for(var s=ds.getLines(r).iterator();s.hasNext();){var f=s.next().getCoordinates();this.addLine(f)}},fl.prototype.addLine=function(r){for(var s=1;s<r.length;s++){var f=new _n(r[s-1],r[s]),m=Math.min(f.p0.y,f.p1.y),S=Math.max(f.p0.y,f.p1.y);this._index.insert(m,S,f)}},fl.prototype.query=function(){if(2===arguments.length){var r=arguments[0],s=arguments[1],f=new du;return this._index.query(r,s,f),f.getItems()}3===arguments.length&&this._index.query(arguments[0],arguments[1],arguments[2])},fl.prototype.interfaces_=function(){return[]},fl.prototype.getClass=function(){return fl};var Nu=function(r){function s(){if(r.call(this),this._parentGeom=null,this._lineEdgeMap=new Ws,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Go,2===arguments.length){var m=arguments[1],S=zn.OGC_SFS_BOUNDARY_RULE;this._argIndex=arguments[0],this._parentGeom=m,this._boundaryNodeRule=S,null!==m&&this.add(m)}else if(3===arguments.length){var V=arguments[1],de=arguments[2];this._argIndex=arguments[0],this._parentGeom=V,this._boundaryNodeRule=de,null!==V&&this.add(V)}}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.insertBoundaryPoint=function(f,m){var S=this._nodes.addNode(m).getLabel(),k=1;S.getLocation(f,et.ON)===Ee.BOUNDARY&&k++;var V=s.determineBoundary(this._boundaryNodeRule,k);S.setLocation(f,V)},s.prototype.computeSelfNodes=function(){if(2===arguments.length)return this.computeSelfNodes(arguments[0],arguments[1],!1);if(3===arguments.length){var k=arguments[1],V=arguments[2],de=new as(arguments[0],!0,!1);return de.setIsDoneIfProperInt(V),this.createEdgeSetIntersector().computeIntersections(this._edges,de,k||!(this._parentGeom instanceof hs||this._parentGeom instanceof ki||this._parentGeom instanceof Kn)),this.addSelfIntersectionNodes(this._argIndex),de}},s.prototype.computeSplitEdges=function(f){for(var m=this._edges.iterator();m.hasNext();)m.next().eiList.addSplitEdges(f)},s.prototype.computeEdgeIntersections=function(f,m,S){var k=new as(m,S,!0);return k.setBoundaryNodes(this.getBoundaryNodes(),f.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,f._edges,k),k},s.prototype.getGeometry=function(){return this._parentGeom},s.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},s.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},s.prototype.addPoint=function(){if(arguments[0]instanceof Ho){var f=arguments[0].getCoordinate();this.insertPoint(this._argIndex,f,Ee.INTERIOR)}else arguments[0]instanceof re&&this.insertPoint(this._argIndex,arguments[0],Ee.INTERIOR)},s.prototype.addPolygon=function(f){this.addPolygonRing(f.getExteriorRing(),Ee.EXTERIOR,Ee.INTERIOR);for(var m=0;m<f.getNumInteriorRing();m++){var S=f.getInteriorRingN(m);this.addPolygonRing(S,Ee.INTERIOR,Ee.EXTERIOR)}},s.prototype.addEdge=function(f){this.insertEdge(f);var m=f.getCoordinates();this.insertPoint(this._argIndex,m[0],Ee.BOUNDARY),this.insertPoint(this._argIndex,m[m.length-1],Ee.BOUNDARY)},s.prototype.addLineString=function(f){var m=Sn.removeRepeatedPoints(f.getCoordinates());if(m.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=m[0],null;var S=new go(m,new Er(this._argIndex,Ee.INTERIOR));this._lineEdgeMap.put(f,S),this.insertEdge(S),ve.isTrue(m.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,m[0]),this.insertBoundaryPoint(this._argIndex,m[m.length-1])},s.prototype.getInvalidPoint=function(){return this._invalidPoint},s.prototype.getBoundaryPoints=function(){for(var f=this.getBoundaryNodes(),m=new Array(f.size()).fill(null),S=0,k=f.iterator();k.hasNext();){var V=k.next();m[S++]=V.getCoordinate().copy()}return m},s.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},s.prototype.addSelfIntersectionNode=function(f,m,S){if(this.isBoundaryNode(f,m))return null;S===Ee.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(f,m):this.insertPoint(f,m,S)},s.prototype.addPolygonRing=function(f,m,S){if(f.isEmpty())return null;var k=Sn.removeRepeatedPoints(f.getCoordinates());if(k.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=k[0],null;var V=m,de=S;rr.isCCW(k)&&(V=S,de=m);var Re=new go(k,new Er(this._argIndex,Ee.BOUNDARY,V,de));this._lineEdgeMap.put(f,Re),this.insertEdge(Re),this.insertPoint(this._argIndex,k[0],Ee.BOUNDARY)},s.prototype.insertPoint=function(f,m,S){var k=this._nodes.addNode(m),V=k.getLabel();null===V?k._label=new Er(f,S):V.setLocation(f,S)},s.prototype.createEdgeSetIntersector=function(){return new tl},s.prototype.addSelfIntersectionNodes=function(f){for(var m=this._edges.iterator();m.hasNext();)for(var S=m.next(),k=S.getLabel().getLocation(f),V=S.eiList.iterator();V.hasNext();){var de=V.next();this.addSelfIntersectionNode(f,de.coord,k)}},s.prototype.add=function(){if(1!==arguments.length)return r.prototype.add.apply(this,arguments);var f=arguments[0];if(f.isEmpty())return null;if(f instanceof Kn&&(this._useBoundaryDeterminationRule=!1),f instanceof ki)this.addPolygon(f);else if(f instanceof mn)this.addLineString(f);else if(f instanceof Ho)this.addPoint(f);else if(f instanceof ur)this.addCollection(f);else if(f instanceof hn)this.addCollection(f);else if(f instanceof Kn)this.addCollection(f);else{if(!(f instanceof Yr))throw new Error(f.getClass().getName());this.addCollection(f)}},s.prototype.addCollection=function(f){for(var m=0;m<f.getNumGeometries();m++){var S=f.getGeometryN(m);this.add(S)}},s.prototype.locate=function(f){return Nt(this._parentGeom,Ts)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new ql(this._parentGeom)),this._areaPtLocator.locate(f)):this._ptLocator.locate(f,this._parentGeom)},s.prototype.findEdge=function(){return 1===arguments.length?this._lineEdgeMap.get(arguments[0]):r.prototype.findEdge.apply(this,arguments)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s.determineBoundary=function(f,m){return f.isInBoundary(m)?Ee.BOUNDARY:Ee.INTERIOR},s}(pn),Hl=function(){if(this._li=new Xt,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var r=arguments[0];this.setComputationPrecision(r.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Nu(0,r)}else if(2===arguments.length){var s=arguments[0],f=arguments[1],m=zn.OGC_SFS_BOUNDARY_RULE;s.getPrecisionModel().compareTo(f.getPrecisionModel())>=0?this.setComputationPrecision(s.getPrecisionModel()):this.setComputationPrecision(f.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Nu(0,s,m),this._arg[1]=new Nu(1,f,m)}else if(3===arguments.length){var S=arguments[0],k=arguments[1],V=arguments[2];S.getPrecisionModel().compareTo(k.getPrecisionModel())>=0?this.setComputationPrecision(S.getPrecisionModel()):this.setComputationPrecision(k.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Nu(0,S,V),this._arg[1]=new Nu(1,k,V)}};Hl.prototype.getArgGeometry=function(r){return this._arg[r].getGeometry()},Hl.prototype.setComputationPrecision=function(r){this._resultPrecisionModel=r,this._li.setPrecisionModel(this._resultPrecisionModel)},Hl.prototype.interfaces_=function(){return[]},Hl.prototype.getClass=function(){return Hl};var kl=function(){};kl.prototype.interfaces_=function(){return[]},kl.prototype.getClass=function(){return kl},kl.map=function(){if(arguments[0]instanceof Lr&&Nt(arguments[1],kl.MapOp)){for(var r=arguments[0],s=arguments[1],f=new Mr,m=0;m<r.getNumGeometries();m++){var S=s.map(r.getGeometryN(m));null!==S&&f.add(S)}return r.getFactory().buildGeometry(f)}if(Nt(arguments[0],Xn)&&Nt(arguments[1],kl.MapOp)){for(var k=arguments[0],V=arguments[1],de=new Mr,Re=k.iterator();Re.hasNext();){var yt=Re.next(),gt=V.map(yt);null!==gt&&de.add(gt)}return de}},kl.MapOp=function(){};var Zn=function(r){function s(){var f=arguments[0];r.call(this,f,arguments[1]),this._ptLocator=new Go,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new za,this._resultPolyList=new Mr,this._resultLineList=new Mr,this._resultPointList=new Mr,this._graph=new pn(new Eu),this._geomFact=f.getFactory()}return r&&(s.__proto__=r),(s.prototype=Object.create(r&&r.prototype)).constructor=s,s.prototype.insertUniqueEdge=function(f){var m=this._edgeList.findEqualEdge(f);if(null!==m){var S=m.getLabel(),k=f.getLabel();m.isPointwiseEqual(f)||(k=new Er(f.getLabel())).flip();var V=m.getDepth();V.isNull()&&V.add(S),V.add(k),S.merge(k)}else this._edgeList.add(f)},s.prototype.getGraph=function(){return this._graph},s.prototype.cancelDuplicateResultEdges=function(){for(var f=this._graph.getEdgeEnds().iterator();f.hasNext();){var m=f.next(),S=m.getSym();m.isInResult()&&S.isInResult()&&(m.setInResult(!1),S.setInResult(!1))}},s.prototype.isCoveredByLA=function(f){return!!this.isCovered(f,this._resultLineList)||!!this.isCovered(f,this._resultPolyList)},s.prototype.computeGeometry=function(f,m,S,k){var V=new Mr;return V.addAll(f),V.addAll(m),V.addAll(S),V.isEmpty()?s.createEmptyResult(k,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(V)},s.prototype.mergeSymLabels=function(){for(var f=this._graph.getNodes().iterator();f.hasNext();)f.next().getEdges().mergeSymLabels()},s.prototype.isCovered=function(f,m){for(var S=m.iterator();S.hasNext();){var k=S.next();if(this._ptLocator.locate(f,k)!==Ee.EXTERIOR)return!0}return!1},s.prototype.replaceCollapsedEdges=function(){for(var f=new Mr,m=this._edgeList.iterator();m.hasNext();){var S=m.next();S.isCollapsed()&&(m.remove(),f.add(S.getCollapsedEdge()))}this._edgeList.addAll(f)},s.prototype.updateNodeLabelling=function(){for(var f=this._graph.getNodes().iterator();f.hasNext();){var m=f.next(),S=m.getEdges().getLabel();m.getLabel().merge(S)}},s.prototype.getResultGeometry=function(f){return this.computeOverlay(f),this._resultGeom},s.prototype.insertUniqueEdges=function(f){for(var m=f.iterator();m.hasNext();){var S=m.next();this.insertUniqueEdge(S)}},s.prototype.computeOverlay=function(f){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var m=new Mr;this._arg[0].computeSplitEdges(m),this._arg[1].computeSplitEdges(m),this.insertUniqueEdges(m),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),cu.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(f),this.cancelDuplicateResultEdges();var S=new ji(this._geomFact);S.add(this._graph),this._resultPolyList=S.getPolygons();var k=new el(this,this._geomFact,this._ptLocator);this._resultLineList=k.build(f);var V=new Gl(this,this._geomFact,this._ptLocator);this._resultPointList=V.build(f),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,f)},s.prototype.labelIncompleteNode=function(f,m){var S=this._ptLocator.locate(f.getCoordinate(),this._arg[m].getGeometry());f.getLabel().setLocation(m,S)},s.prototype.copyPoints=function(f){for(var m=this._arg[f].getNodeIterator();m.hasNext();){var S=m.next();this._graph.addNode(S.getCoordinate()).setLabel(f,S.getLabel().getLocation(f))}},s.prototype.findResultAreaEdges=function(f){for(var m=this._graph.getEdgeEnds().iterator();m.hasNext();){var S=m.next(),k=S.getLabel();k.isArea()&&!S.isInteriorAreaEdge()&&s.isResultOfOp(k.getLocation(0,et.RIGHT),k.getLocation(1,et.RIGHT),f)&&S.setInResult(!0)}},s.prototype.computeLabelsFromDepths=function(){for(var f=this._edgeList.iterator();f.hasNext();){var m=f.next(),S=m.getLabel(),k=m.getDepth();if(!k.isNull()){k.normalize();for(var V=0;V<2;V++)S.isNull(V)||!S.isArea()||k.isNull(V)||(0===k.getDelta(V)?S.toLine(V):(ve.isTrue(!k.isNull(V,et.LEFT),"depth of LEFT side has not been initialized"),S.setLocation(V,et.LEFT,k.getLocation(V,et.LEFT)),ve.isTrue(!k.isNull(V,et.RIGHT),"depth of RIGHT side has not been initialized"),S.setLocation(V,et.RIGHT,k.getLocation(V,et.RIGHT))))}}},s.prototype.computeLabelling=function(){for(var f=this._graph.getNodes().iterator();f.hasNext();)f.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},s.prototype.labelIncompleteNodes=function(){for(var f=this._graph.getNodes().iterator();f.hasNext();){var m=f.next(),S=m.getLabel();m.isIsolated()&&(S.isNull(0)?this.labelIncompleteNode(m,0):this.labelIncompleteNode(m,1)),m.getEdges().updateLabelling(S)}},s.prototype.isCoveredByA=function(f){return!!this.isCovered(f,this._resultPolyList)},s.prototype.interfaces_=function(){return[]},s.prototype.getClass=function(){return s},s}(Hl);Zn.overlayOp=function(r,s,f){return new Zn(r,s).getResultGeometry(f)},Zn.intersection=function(r,s){if(r.isEmpty()||s.isEmpty())return Zn.createEmptyResult(Zn.INTERSECTION,r,s,r.getFactory());if(r.isGeometryCollection()){var f=s;return hu.map(r,{interfaces_:function(){return[kl.MapOp]},map:function(m){return m.intersection(f)}})}return r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(s),pa.overlayOp(r,s,Zn.INTERSECTION)},Zn.symDifference=function(r,s){if(r.isEmpty()||s.isEmpty()){if(r.isEmpty()&&s.isEmpty())return Zn.createEmptyResult(Zn.SYMDIFFERENCE,r,s,r.getFactory());if(r.isEmpty())return s.copy();if(s.isEmpty())return r.copy()}return r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(s),pa.overlayOp(r,s,Zn.SYMDIFFERENCE)},Zn.resultDimension=function(r,s,f){var m=s.getDimension(),S=f.getDimension(),k=-1;switch(r){case Zn.INTERSECTION:k=Math.min(m,S);break;case Zn.UNION:k=Math.max(m,S);break;case Zn.DIFFERENCE:k=m;break;case Zn.SYMDIFFERENCE:k=Math.max(m,S)}return k},Zn.createEmptyResult=function(r,s,f,m){var S=null;switch(Zn.resultDimension(r,s,f)){case-1:S=m.createGeometryCollection(new Array(0).fill(null));break;case 0:S=m.createPoint();break;case 1:S=m.createLineString();break;case 2:S=m.createPolygon()}return S},Zn.difference=function(r,s){return r.isEmpty()?Zn.createEmptyResult(Zn.DIFFERENCE,r,s,r.getFactory()):s.isEmpty()?r.copy():(r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(s),pa.overlayOp(r,s,Zn.DIFFERENCE))},Zn.isResultOfOp=function(){if(2===arguments.length){var r=arguments[0],s=arguments[1],f=r.getLocation(0),m=r.getLocation(1);return Zn.isResultOfOp(f,m,s)}if(3===arguments.length){var S=arguments[0],k=arguments[1];switch(S===Ee.BOUNDARY&&(S=Ee.INTERIOR),k===Ee.BOUNDARY&&(k=Ee.INTERIOR),arguments[2]){case Zn.INTERSECTION:return S===Ee.INTERIOR&&k===Ee.INTERIOR;case Zn.UNION:return S===Ee.INTERIOR||k===Ee.INTERIOR;case Zn.DIFFERENCE:return S===Ee.INTERIOR&&k!==Ee.INTERIOR;case Zn.SYMDIFFERENCE:return S===Ee.INTERIOR&&k!==Ee.INTERIOR||S!==Ee.INTERIOR&&k===Ee.INTERIOR}return!1}},Zn.INTERSECTION=1,Zn.UNION=2,Zn.DIFFERENCE=3,Zn.SYMDIFFERENCE=4;var Rl=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Go,this._seg=new _n;var r=arguments[0],s=arguments[1];this._g=r,this._boundaryDistanceTolerance=s,this._linework=this.extractLinework(r)};Rl.prototype.isWithinToleranceOfBoundary=function(r){for(var s=0;s<this._linework.getNumGeometries();s++)for(var f=this._linework.getGeometryN(s).getCoordinateSequence(),m=0;m<f.size()-1;m++)if(f.getCoordinate(m,this._seg.p0),f.getCoordinate(m+1,this._seg.p1),this._seg.distance(r)<=this._boundaryDistanceTolerance)return!0;return!1},Rl.prototype.getLocation=function(r){return this.isWithinToleranceOfBoundary(r)?Ee.BOUNDARY:this._ptLocator.locate(r,this._g)},Rl.prototype.extractLinework=function(r){var s=new Pa;r.apply(s);var f=s.getLinework(),m=$n.toLineStringArray(f);return r.getFactory().createMultiLineString(m)},Rl.prototype.interfaces_=function(){return[]},Rl.prototype.getClass=function(){return Rl};var Pa=function(){this._linework=null,this._linework=new Mr};Pa.prototype.getLinework=function(){return this._linework},Pa.prototype.filter=function(r){if(r instanceof ki){var s=r;this._linework.add(s.getExteriorRing());for(var f=0;f<s.getNumInteriorRing();f++)this._linework.add(s.getInteriorRingN(f))}},Pa.prototype.interfaces_=function(){return[Rr]},Pa.prototype.getClass=function(){return Pa};var Jl=function(){this._g=null,this._doLeft=!0,this._doRight=!0,this._g=arguments[0]};Jl.prototype.extractPoints=function(r,s,f){for(var m=r.getCoordinates(),S=0;S<m.length-1;S++)this.computeOffsetPoints(m[S],m[S+1],s,f)},Jl.prototype.setSidesToGenerate=function(r,s){this._doLeft=r,this._doRight=s},Jl.prototype.getPoints=function(r){for(var s=new Mr,f=ds.getLines(this._g).iterator();f.hasNext();){var m=f.next();this.extractPoints(m,r,s)}return s},Jl.prototype.computeOffsetPoints=function(r,s,f,m){var S=s.x-r.x,k=s.y-r.y,V=Math.sqrt(S*S+k*k),de=f*S/V,Re=f*k/V,yt=(s.x+r.x)/2,gt=(s.y+r.y)/2;if(this._doLeft){var ar=new re(yt-Re,gt+de);m.add(ar)}if(this._doRight){var Gr=new re(yt+Re,gt-de);m.add(Gr)}},Jl.prototype.interfaces_=function(){return[]},Jl.prototype.getClass=function(){return Jl};var Va=function r(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=r.TOLERANCE,this._testCoords=new Mr;var s=arguments[0],f=arguments[1],m=arguments[2];this._boundaryDistanceTolerance=r.computeBoundaryDistanceTolerance(s,f),this._geom=[s,f,m],this._locFinder=[new Rl(this._geom[0],this._boundaryDistanceTolerance),new Rl(this._geom[1],this._boundaryDistanceTolerance),new Rl(this._geom[2],this._boundaryDistanceTolerance)]},ch={TOLERANCE:{configurable:!0}};Va.prototype.reportResult=function(r,s,f){rn.out.println("Overlay result invalid - A:"+Ee.toLocationSymbol(s[0])+" B:"+Ee.toLocationSymbol(s[1])+" expected:"+(f?"i":"e")+" actual:"+Ee.toLocationSymbol(s[2]))},Va.prototype.isValid=function(r){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(r)},Va.prototype.checkValid=function(){if(1===arguments.length){for(var r=arguments[0],s=0;s<this._testCoords.size();s++){var f=this._testCoords.get(s);if(!this.checkValid(r,f))return this._invalidLocation=f,!1}return!0}if(2===arguments.length){var m=arguments[0],S=arguments[1];return this._location[0]=this._locFinder[0].getLocation(S),this._location[1]=this._locFinder[1].getLocation(S),this._location[2]=this._locFinder[2].getLocation(S),!!Va.hasLocation(this._location,Ee.BOUNDARY)||this.isValidResult(m,this._location)}},Va.prototype.addTestPts=function(r){var s=new Jl(r);this._testCoords.addAll(s.getPoints(5*this._boundaryDistanceTolerance))},Va.prototype.isValidResult=function(r,s){var f=Zn.isResultOfOp(s[0],s[1],r),m=!(f^s[2]===Ee.INTERIOR);return m||this.reportResult(r,s,f),m},Va.prototype.getInvalidLocation=function(){return this._invalidLocation},Va.prototype.interfaces_=function(){return[]},Va.prototype.getClass=function(){return Va},Va.hasLocation=function(r,s){for(var f=0;f<3;f++)if(r[f]===s)return!0;return!1},Va.computeBoundaryDistanceTolerance=function(r,s){return Math.min(xo.computeSizeBasedSnapTolerance(r),xo.computeSizeBasedSnapTolerance(s))},Va.isValid=function(r,s,f,m){return new Va(r,s,m).isValid(f)},ch.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Va,ch);var Za=function r(s){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=r.extractFactory(s),this._inputGeoms=s};Za.prototype.extractElements=function(r,s){if(null===r)return null;for(var f=0;f<r.getNumGeometries();f++){var m=r.getGeometryN(f);this._skipEmpty&&m.isEmpty()||s.add(m)}},Za.prototype.combine=function(){for(var r=new Mr,s=this._inputGeoms.iterator();s.hasNext();){var f=s.next();this.extractElements(f,r)}return 0===r.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(r)},Za.prototype.interfaces_=function(){return[]},Za.prototype.getClass=function(){return Za},Za.combine=function(){return 1===arguments.length?new Za(arguments[0]).combine():2===arguments.length?new Za(Za.createList(arguments[0],arguments[1])).combine():3===arguments.length?new Za(Za.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},Za.extractFactory=function(r){return r.isEmpty()?null:r.iterator().next().getFactory()},Za.createList=function(){if(2===arguments.length){var r=arguments[0],s=arguments[1],f=new Mr;return f.add(r),f.add(s),f}if(3===arguments.length){var m=arguments[0],S=arguments[1],k=arguments[2],V=new Mr;return V.add(m),V.add(S),V.add(k),V}};var ts=function(){this._inputPolys=null,this._geomFactory=null,this._inputPolys=arguments[0],null===this._inputPolys&&(this._inputPolys=new Mr)},zc={STRTREE_NODE_CAPACITY:{configurable:!0}};ts.prototype.reduceToGeometries=function(r){for(var s=new Mr,f=r.iterator();f.hasNext();){var m=f.next(),S=null;Nt(m,Bn)?S=this.unionTree(m):m instanceof Lr&&(S=m),s.add(S)}return s},ts.prototype.extractByEnvelope=function(r,s,f){for(var m=new Mr,S=0;S<s.getNumGeometries();S++){var k=s.getGeometryN(S);k.getEnvelopeInternal().intersects(r)?m.add(k):f.add(k)}return this._geomFactory.buildGeometry(m)},ts.prototype.unionOptimized=function(r,s){var f=r.getEnvelopeInternal(),m=s.getEnvelopeInternal();if(!f.intersects(m))return Za.combine(r,s);if(r.getNumGeometries()<=1&&s.getNumGeometries()<=1)return this.unionActual(r,s);var S=f.intersection(m);return this.unionUsingEnvelopeIntersection(r,s,S)},ts.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var r=new ku(ts.STRTREE_NODE_CAPACITY),s=this._inputPolys.iterator();s.hasNext();){var f=s.next();r.insert(f.getEnvelopeInternal(),f)}this._inputPolys=null;var m=r.itemsTree();return this.unionTree(m)},ts.prototype.binaryUnion=function(){if(1===arguments.length){var r=arguments[0];return this.binaryUnion(r,0,r.size())}if(3===arguments.length){var s=arguments[0],f=arguments[1],m=arguments[2];if(m-f<=1){var S=ts.getGeometry(s,f);return this.unionSafe(S,null)}if(m-f==2)return this.unionSafe(ts.getGeometry(s,f),ts.getGeometry(s,f+1));var k=Math.trunc((m+f)/2),V=this.binaryUnion(s,f,k),de=this.binaryUnion(s,k,m);return this.unionSafe(V,de)}},ts.prototype.repeatedUnion=function(r){for(var s=null,f=r.iterator();f.hasNext();){var m=f.next();s=null===s?m.copy():s.union(m)}return s},ts.prototype.unionSafe=function(r,s){return null===r&&null===s?null:null===r?s.copy():null===s?r.copy():this.unionOptimized(r,s)},ts.prototype.unionActual=function(r,s){return ts.restrictToPolygons(r.union(s))},ts.prototype.unionTree=function(r){var s=this.reduceToGeometries(r);return this.binaryUnion(s)},ts.prototype.unionUsingEnvelopeIntersection=function(r,s,f){var m=new Mr,S=this.extractByEnvelope(f,r,m),k=this.extractByEnvelope(f,s,m),V=this.unionActual(S,k);return m.add(V),Za.combine(m)},ts.prototype.bufferUnion=function(){if(1===arguments.length){var r=arguments[0];return r.get(0).getFactory().buildGeometry(r).buffer(0)}if(2===arguments.length){var s=arguments[0],f=arguments[1];return s.getFactory().createGeometryCollection([s,f]).buffer(0)}},ts.prototype.interfaces_=function(){return[]},ts.prototype.getClass=function(){return ts},ts.restrictToPolygons=function(r){if(Nt(r,Ts))return r;var s=Qs.getPolygons(r);return 1===s.size()?s.get(0):r.getFactory().createMultiPolygon($n.toPolygonArray(s))},ts.getGeometry=function(r,s){return s>=r.size()?null:r.get(s)},ts.union=function(r){return new ts(r).union()},zc.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(ts,zc);var Hu=function(){};Hu.prototype.interfaces_=function(){return[]},Hu.prototype.getClass=function(){return Hu},Hu.union=function(r,s){if(r.isEmpty()||s.isEmpty()){if(r.isEmpty()&&s.isEmpty())return Zn.createEmptyResult(Zn.UNION,r,s,r.getFactory());if(r.isEmpty())return s.copy();if(s.isEmpty())return r.copy()}return r.checkNotGeometryCollection(r),r.checkNotGeometryCollection(s),pa.overlayOp(r,s,Zn.UNION)},ue.GeoJSONReader=Et,ue.GeoJSONWriter=Gt,ue.OverlayOp=Zn,ue.UnionOp=Hu,ue.BufferOp=es,Object.defineProperty(ue,"__esModule",{value:!0})}(Ye)},4703:Mt=>{Mt.exports=function ue(){for(var ae={},pe=0;pe<arguments.length;pe++){var b=arguments[pe];for(var c in b)Ye.call(b,c)&&(ae[c]=b[c])}return ae};var Ye=Object.prototype.hasOwnProperty},9652:(Mt,Ye,ue)=>{"use strict";ue.d(Ye,{x0:()=>c});let c=(Z=21)=>crypto.getRandomValues(new Uint8Array(Z)).reduce((ce,be)=>ce+((be&=63)<36?be.toString(36):be<62?(be-26).toString(36).toUpperCase():be>62?"-":"_"),"")}}]);